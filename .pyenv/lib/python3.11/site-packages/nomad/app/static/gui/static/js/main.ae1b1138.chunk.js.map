{"version":3,"sources":["../crystcif-parse/lib/tokens.js","../crystcif-parse/lib/cryst.js","../crystcif-parse/lib/utils.js","../crystcif-parse/lib/symmetry.js","history.js","config.js","components/errors.js","components/api.js","components/LoginLogout.js","components/units/UnitContext.js","components/units/common.js","components/units/Unit.js","components/units/Quantity.js","utils.js","components/DataStore.js","components/archive/metainfo.js","components/Markdown.js","components/Help.js","components/utils/TooltipButton.js","components/datatable/Datatable.js","components/uploads/UploadStatusIcon.js","components/search/Filter.js","components/search/FilterRegistry.js","hooks.js","components/Actions.js","components/search/widgets/WidgetToggle.js","components/plotting/common.js","components/GUIMenu.js","components/search/input/InputHeader.js","components/search/input/InputTooltip.js","components/search/input/InputSection.js","components/visualization/Ellipsis.js","components/search/FilterTitle.js","components/search/widgets/WidgetHeader.js","components/search/widgets/Widget.js","components/search/SearchSuggestion.js","components/search/SearchContext.js","components/visualization/Placeholder.js","components/search/input/InputText.js","components/units/UnitInput.js","components/units/UnitDimensionSelect.js","components/units/UnitSystemSelect.js","components/units/UnitMenu.js","components/nav/MenuBar.js","images/about.svg","components/search/input/InputConfig.js","components/About.js","components/ErrorHandler.js","components/visualization/H5Web.js","components/archive/Browser.js","components/entry/Download.js","components/dataset/DOI.js","components/visualization/NoData.js","components/Quantity.js","../materia/src/js/orthographiccontrols.js","../materia/src/js/viewer.js","../materia/src/js/structureviewer.js","../materia/src/js/convexhull.js","../materia/src/js/brillouinzoneviewer.js","../materia/src/js/convexgeometry.js","components/buttons/LoadingButton.js","components/buttons/DownloadSystemButton.js","components/visualization/Floatable.js","components/visualization/StructureBase.js","components/visualization/Structure.js","components/archive/FilePreview.js","components/entry/EntryContext.js","components/north/NorthTool.js","components/Page.js","components/north/NorthPage.js","components/north/NorthLaunchButton.js","components/archive/FileBrowser.js","components/archive/visualizations.js","components/visualization/BrillouinZone.js","components/plotting/Plot.js","components/visualization/BandStructure.js","components/visualization/Spectra.js","components/visualization/DOS.js","components/visualization/EnergyVolumeCurve.js","components/archive/Overview.js","components/buttons/SourceDialogButton.js","components/visualization/Pagination.js","components/editQuantity/ListEditQuantity.js","components/editQuantity/DateTimeEditQuantity.js","components/editQuantity/StringEditQuantity.js","components/units/useDisplayUnit.js","components/editQuantity/NumberEditQuantity.js","components/editQuantity/EnumEditQuantity.js","components/editQuantity/AutocompleteEditQuantity.js","components/editQuantity/BoolEditQuantity.js","components/editQuantity/OverwriteExistingFileDialog.js","components/uploads/UploadProgressDialog.js","components/editQuantity/FileEditQuantity.js","components/editQuantity/RichTextEditQuantity.js","components/search/SearchSyntaxes.js","components/search/input/InputMetainfo.js","components/search/SearchBar.js","components/uploads/UploadPageContext.js","components/entry/EntryDownloadButton.js","components/entry/properties/PropertyCard.js","components/entry/properties/MaterialCard.js","components/entry/EntryDetails.js","components/material/MaterialDetails.js","components/search/SearchResults.js","components/uploads/SectionSelectDialog.js","components/uploads/SectionSelectAutocomplete.js","components/editQuantity/ReferenceEditQuantity.js","components/uploads/InviteUserDialog.js","components/uploads/EditMembersDialog.js","components/editQuantity/AuthorEditQuantity.js","components/editQuantity/RadioEnumEditQuantity.js","components/visualization/Scrollable.js","components/search/menus/FilterSettings.js","components/search/menus/FilterMenu.js","components/search/input/InputGrid.js","components/search/input/InputCheckbox.js","components/search/input/InputPeriodicTable.js","components/search/widgets/StatisticsBar.js","components/search/input/InputItem.js","components/search/input/InputUnavailable.js","components/search/input/InputField.js","components/plotting/PlotTick.js","components/plotting/PlotLabel.js","components/plotting/PlotAxis.js","components/plotting/PlotBar.js","components/plotting/PlotHistogram.js","components/search/widgets/WidgetHistogram.js","components/search/input/InputRange.js","components/search/menus/FilterSubMenuElements.js","components/search/menus/FilterSubMenuStructure.js","components/search/menus/FilterSubMenuMethod.js","components/search/menus/FilterSubMenuPrecision.js","components/search/menus/FilterSubMenuDFT.js","components/search/menus/FilterSubMenuTB.js","components/search/menus/FilterSubMenuGW.js","components/search/menus/FilterSubMenuBSE.js","components/search/menus/FilterSubMenuDMFT.js","components/search/menus/FilterSubMenuEELS.js","components/search/menus/FilterSubMenuElectronic.js","components/search/menus/FilterSubMenuSolarCell.js","components/search/menus/FilterSubMenuCatalystProperties.js","components/search/menus/FilterSubMenuVibrational.js","components/search/menus/FilterSubMenuMechanical.js","components/search/menus/FilterSubMenuMolecularDynamics.js","components/search/menus/FilterSubMenuELN.js","components/search/menus/FilterSubMenuAuthor.js","components/search/input/InputRadio.js","components/search/menus/FilterSubMenuMetadata.js","components/search/menus/FilterSubMenuOptimade.js","components/search/menus/FilterSubMenuGeometryOptimization.js","components/search/menus/FilterSubMenuCustomQuantities.js","components/search/menus/FilterMainMenu.js","components/search/Query.js","components/plotting/PlotScatter.js","components/search/widgets/WidgetScatterPlot.js","components/search/widgets/WidgetEdit.js","components/search/widgets/WidgetPeriodicTable.js","components/search/widgets/WidgetTerms.js","components/search/widgets/WidgetGrid.js","components/search/widgets/WidgetScatterPlotEdit.js","components/search/widgets/WidgetHistogramEdit.js","components/search/widgets/Dashboard.js","components/search/SearchPage.js","components/editQuantity/QueryEditQuantity.js","components/editQuantity/EditQuantity.js","components/entry/properties/SectionCard.js","components/archive/SectionEditor.js","components/archive/PlotlyFigure.js","components/archive/ArchiveSearchBar.js","components/archive/XYPlot.js","components/archive/ArchiveBrowser.js","components/Histogram.js","components/archive/MetainfoBrowser.js","components/visualization/BandGap.js","components/visualization/GreensFunctions.js","components/visualization/ElectronicProperties.js","components/entry/properties/ElectronicPropertiesCard.js","components/visualization/SolarCell.js","components/visualization/OptoelectronicProperties.js","components/entry/properties/SolarCellPropertiesCard.js","components/visualization/StructureNGL.js","components/entry/properties/MaterialCardTopology.js","components/entry/properties/MaterialCardFormula.js","components/entry/properties/NexusCard.js","components/visualization/HeatCapacity.js","components/visualization/HelmholtzFreeEnergy.js","components/visualization/VibrationalProperties.js","components/entry/properties/VibrationalPropertiesCard.js","components/visualization/MechanicalProperties.js","components/entry/properties/MechanicalPropertiesCard.js","components/visualization/Trajectory.js","components/visualization/ThermodynamicProperties.js","components/entry/properties/ThermodynamicPropertiesCard.js","components/visualization/MeanSquaredDisplacement.js","components/entry/properties/DynamicalPropertiesCard.js","components/visualization/RadialDistributionFunction.js","components/visualization/RadiusOfGyration.js","components/visualization/StructuralProperties.js","components/entry/properties/StructuralPropertiesCard.js","components/visualization/GeometryOptimization.js","components/entry/properties/GeometryOptimizationCard.js","components/entry/properties/SpectroscopicPropertiesCard.js","components/entry/properties/RelatedResourcesCard.js","components/entry/properties/WorkflowCard.js","components/entry/properties/DefinitionsCard.js","components/entry/properties/ReferenceCard.js","components/entry/properties/SampleHistoryCard.js","components/uploads/DeletingReferencesTable.js","components/uploads/DeleteEntriesButton.js","components/entry/OverviewView.js","components/entry/ArchiveEntryView.js","components/entry/ArchiveLogView.js","components/entry/BrowseEntryFilesView.js","components/entry/EntryPage.js","components/uploads/NewUploadButton.js","components/uploads/ExampleUploadButton.js","components/uploads/DeleteUploadsButton.js","components/utils/DialogLink.js","components/utils/WithButton.js","components/uploads/CreateEntry.js","components/uploads/EditMetaDataDialog.js","components/uploads/FilePreview.js","components/uploads/FilesBrowser.js","components/uploads/ProcessingTable.js","components/uploads/UploadName.js","components/nav/MenuBarRoute.js","components/uploads/UploadSearchMenu.js","components/uploads/UploadOverview.js","components/uploads/UploadsPage.js","components/UserdataPage.js","components/AppTokenForm.js","components/APIs.js","components/entry/EntryQuery.js","components/entry/ResolvePID.js","components/dataset/DatasetPage.js","components/dataset/DatasetsPage.js","components/dataset/ResolveDOI.js","components/datatable/DatatableExamples.js","components/editQuantity/SliderEditQuantity.js","components/editQuantity/EditQuantityExamples.js","components/uploads/UploadFilesView.js","components/uploads/UploadProcessingStatus.js","components/archive/PlotExamples.js","components/nav/Routes.js","components/uploads/UploadPage.js","components/nav/MainMenu.js","components/nav/Breadcrumbs.js","components/nav/AppBar.js","components/nav/Navigation.js","components/App.js","index.js","../crystcif-parse/lib/parse.js","../crystcif-parse/index.js","../materia/src/js/object_hash.js"],"names":["sp","ht","eol","module","exports","end_of_line","ordinary_char","nonblank_char","textlead_char","anyprint_char","digit","comments","tok_comments","whitespace","semicolontext","squotestring","dquotestring","uquotestring","quotestring","chrstring","unsigned_int","integer","exponent","float","number","numeric","tag","value","loop_kw","loop_header","loop_body","data_header","data_item","reserved","tokenRegex","tname","start","end","flags","restr","RegExp","mjs","require","mndtable","PeriodicTable","utils","parseCif","symmetry","cellparToCell","cellpar","ab_normal","a_direction","radians","norm","cross","ad","unit","Z","X","subtract","dotMultiply","dot","Y","l","angs","map","degToRad","cosa","Math","cos","sina","sin","i","abs","sign","va","vb","vc","sqrt","multiply","cellToCellpar","cell","lengths","c","angles","j","k","ll","x","angle","acos","PI","push","radToDeg","Atoms","elems","positions","info","scaled","tolerant","symbols","numbers","length","el","is_num","a","getAtomic","getElement","Error","symbol","this","_arrays","_N","_pbc","_inv_cell","_cell","row","includes","inv","check_pos","set_array","_extract_tags","cblock","tags","extracted","undefined","basetype","type","baselen","_atom_types","atype_tags","typevals","atypes","sym","text","slice","get_value","_atom_sites","asite_tags","sitevals","asites","_cellpars","cell_tags","cellpars","val","floor","some","_symops","symopvals","_space_group_symop_operation_xyz","_symmetry_equiv_pos_as_xyz","hallsymbol","_space_group_name_Hall","_symmetry_space_group_name_Hall","symops","parseSymOp","interpretHallSymbol","prototype","name","arr","get_array","get_chemical_symbols","deepClone","get_atomic_numbers","get_cell","get_inv_cell","get_pbc","get_positions","get_scaled_positions","pos","spos","ic","p","readCif","cif","symtol","cifdict","structs","bname","block","sname","pbc","labels","type_symbol","label","Cartn_x","Cartn_y","Cartn_z","fract_x","fract_y","fract_z","fpos","allfpos","allsyms","alllabs","p0","allp","rot","tr","add","mod1","eq","r","shortestPeriodicLength","concat","Array","fill","v","reduce","s","obj","JSON","parse","stringify","v1","v2","n","_deg2rad","deg","rad","includesAll","ans","fx","dx","dy","dz","df","min","symdata","symopstr","xyz","split","symre","rotm","trns","lastIndex","t","res","exec","parseFloat","search","hsym","trim","rotms","trnss","createBrowserHistory","basename","process","urlAbs","url","base","window","location","origin","protocol","absUrl","URL","href","oldProtocol","normalizeConfig","config","isNil","normalize","key","Object","entries","isPlainObject","options","include","keys","filter","exclude","fromEntries","option","forOwn","nomadEnv","version","appBase","replace","apiBase","northBase","guiBase","ui","entry_points","plugins","apps","values","entry_point","entry_point_type","forEach","app","servicesUploadLimit","keycloakBase","keycloakRealm","keycloakClientId","debug","encyclopediaBase","oasis","globalLoginRequired","appTokenMaxExpiresIn","yamlSchemaPrefix","nomadArtifacts","searchQuantities","metainfo","parserMetadata","toolkitMetadata","exampleUploads","category","id","northTools","unitList","unitPrefixes","nomadPrimaryColor","main","light","dark","veryLight","nomadSecondaryColor","nomadFontFamily","join","nomadTheme","createTheme","typography","useNextVariants","fontFamily","fontWeightRegular","fontWeightMedium","palette","primary","secondary","overrides","MuiCssBaseline","backgroundColor","boxSizing","MuiTooltip","tooltip","fontWeight","fontSize","MuiTableRow","root","borderBottom","formatQuantity","parts","toString","electronicRange","dateFormat","msgNormalizationWarning","VersionMismatch","constructor","msg","super","errorContext","React","createContext","errors","raiseError","ErrorSnacksUnstyled","Component","state","error","onError","errorStr","message","startsWith","status","apiMessage","console","log","String","indexOf","setState","onClose","render","children","classes","props","Provider","Snackbar","anchorOrigin","vertical","horizontal","open","handleClose","SnackbarContent","className","errorSnack","style","color","action","IconButton","size","onClick","bind","styles","theme","ErrorSnacks","withStyles","ErrorBoundary","hasError","_error","componentDidCatch","errorInfo","context","document","getElementById","display","useErrors","useContext","contextType","DoesNotExist","NotAuthorized","ApiError","ApiRequestError","handleApiError","e","response","body","description","data","detail","statusText","errorMessage","ResourcesApi","api","apiKey","axios","create","baseURL","path","query","doHttpRequest","get","params","methodName","Api","keycloak","setLoading","nLoading","onFinishLoading","show","onStartLoading","subscriptions","token","Promise","resolve","reject","updateToken","then","headers","catch","datasetId","auth","authHeaders","quantities","input","post","entryId","searchTarget","loadingIndicator","request","method","result","returnRequest","put","delete","noLoading","accept","results","jsonResponse","repairJsonResponse","fullResponse","noHandleErrors","user","prefix","dataset_type","user_id","loadUserInfo","page_size","edit","quantity","many","isArray","apiContext","APIProvider","memo","useKeycloak","useSetRecoilState","apiLoading","useState","setUser","useEffect","authenticated","useMemo","resourcesApi","infoState","atom","default","useApi","VerifyGlobalLogin","verified","setVerified","Fragment","Box","margin","Typography","GlobalLoginRequired","LoginRequired","padding","spacing","alignItems","marginRight","withLoginRequired","onKeycloakEvent","cookies","Cookies","pathname","set","expires","Date","tokenParsed","exp","timeSkew","sameSite","remove","useStyles","makeStyles","link","textDecoration","button","LoginLogout","variant","Link","Button","marginLeft","logout","startIcon","login","UnitMathJS","UNITS","deleteUnit","BASE_DIMENSIONS","splice","getOwnPropertyNames","BASE_UNITS","prop","PREFIXES","NONE","scientific","PINT","prefixes","isAlphaOriginal","isValidAlpha","Set","has","isSpecialChar","charCode","charCodeAt","isGreekLetter","unitToAbbreviationMap","unitDefinitions","def","baseName","dimension","abbreviation","aliases","alias","createUnit","override","unitMap","dimensionMap","oldInfo","startCase","toLower","oldList","units","getUnits","unitContext","UnitProvider","initialUnitSystems","initialSelected","resetUnitSystems","cloneDeep","isReset","setIsReset","unitSystems","setUnitSystems","selectedSystem","setSelectedSystem","currentScope","setCurrentScope","scopes","setScopes","scope","setScope","reset","useCallback","system","setScopeInfo","scopeKey","setSelected","unitSystem","setUnits","old","newSystems","isFunction","selected","useUnitContext","defaultUnitSystem","others","deltaPrefixes","requireValue","requireUnit","parseResults","parseInternal","valueString","Unit","str","index","skipWhitespace","next","isDigit","charAt","revert","oldIndex","parseUnit","unitName","firstC","parseCharacter","toFind","parseNumber","isDigitDot","tentativeNumber","tentativeIndex","TypeError","powerMultiplierCurrent","expectingUnit","SyntaxError","powerMultiplierStack","powerMultiplierStackProduct","uStr","oldC","findUnit","power","delta","dimensions","pop","baseDim","UNIT_SYSTEMS","auto","memoize","endsWith","prefixLen","prefixName","substring","deltaPrefix","DIMENSIONLESS","isString","mathjsUnit","clone","equalBase","abbreviate","showDelta","strNum","strDen","nNum","nDen","getDelta","getName","getPrefix","original","prefixMap","deca","hecto","kilo","mega","giga","tera","peta","exa","zetta","yotta","deci","centi","milli","micro","nano","pico","femto","atto","zepto","yocto","kibi","mebi","gibi","tebi","pebi","exi","zebi","yobi","unitDef","substr","dims","d","to","toDelta","unitMathJS","toSI","toSystem","proposedUnitList","newUnitDefinition","definition","missingBaseDim","newDimensions","baseUnitDefinition","baseUnitList","newUnit","ret","Quantity","normalized","isNumber","normalized_value","denormalize","ignoreOffset","_isDerived","coefficients","conversion_coefficients","mapDeep","unitOffset","offset","unitValue","unitPrefixValue","unitPower","pow","equal","crypto","parserLabels","parser","codeName","codeLabel","capitalize","toUpperCase","setDeep","separator","segments","current","segment","func","newValue","mapRecursive","list","newList","iList","scale","factor","addition","distance","b","sum","now","mergeObjects","source","target","cloned","merge","titleCase","splitStr","toLowerCase","nameList","users","expanded","names","authorList","entry","external_db","authors","entryName","entry_name","entryType","formula","material","chemical_formula_hill","entry_type","simulation","parser_name","program","workflow","workflow_name","program_name","hasWebGL","hasWebGLSupport","w","canvas","createElement","WebGLRenderingContext","getContext","formatNumber","DType","Float","mode","decimals","absValue","toExponential","Number","toFixed","formatted","toLocaleString","approxInteger","formatInteger","Int","formatTimestamp","format","dateStyle","timeStyle","Timestamp","Enum","Boolean","Unknown","numericTypes","multiTypes","getDatatype","type_data","type_kind","getSerializer","dtype","pretty","newVal","valueConv","serializeMetainfo","getUnit","serializer","sleep","ms","setTimeout","tier","log10","suffix","nUsed","nDecimals","delay","pluralize","word","count","inclusive","dictionary","words","lastWord","isPossessive","plural","form","formatLabel","isWaitingForUpdateTestId","stripIndent","code","lines","findIndex","line","indent","trimStart","getLocation","generateEntryId","uploadId","mainfile","mainfileKey","hash","createHash","update","digest","systemMetainfoUrl","refType","freeze","deployment","upload","archive","refRelativeTo","nothing","parseNomadUrl","relativeTo","deploymentUrl","isResolved","isExternal","qualifiedName","versionHash","dataPath","rest","rawPath","bracketPos","apiPos","match","restParts","decodeURIComponent","atPos","dataPathSegments","firstDataPathSegment","resolveNomadUrl","baseUrl","parsedUrl","parsedBaseUrl","resolveNomadUrlNoThrow","relativizeNomadUrl","normalizeNomadUrl","rv","createUploadUrl","rawPathUnescaped","isNaN","rawPathEscaped","urlEncodePath","createEntryUrl","appendDataUrl","dataPathSuffix","urlJoin","components","component","encodeURIComponent","resolveInternalRef","ref","resolveInternalRefSingle","_properties","sub_section","repeats","m_def","parseInt","alphabet","getSuggestions","minLength","normalizer","item","inputNormalized","suggestions","sort","suggestion","download","filename","content","appendChild","remoteData","createObjectURL","click","removeChild","revokeObjectURL","sep","maxsplit","rsplit","getSchemaAbbreviation","schema","parseQuantityName","fullName","dtypeParts","schemaNew","parseOperator","operators","op","getOptions","glob","isEmpty","pattern","minimatch","parseJMESPath","ast","jmespath","compile","validateJMESPath","extras","field","extrasList","recurseAST","node","childFields","childExtras","child","fieldInner","extrasInner","childField","childExtra","cleanse","getDisplayLabel","isArchive","technicalView","labelAnnotation","m_annotations","eln","more","isEmptyString","isUploadVisibleForAll","viewer_groups","addSubscription","storeObj","cb","_subscriptions","removeSubscription","store","subscription","metainfoArchiveFilter","definitions","metadata","dataStoreContext","useDataStore","DataStore","userRef","useRef","storeKey","selectedEntry","entryBreadCrumb","innerText","uploadBreadCrumb","breadcrumb","uploadRef","entryRef","setUpload","setEntry","getUpload","getEntry","uploadStore","entryStore","metainfoDataStore","frozenMetainfoCache","externalInheritanceCache","uploadStoreObj","deletionRequested","apiData","pagination","page","order","order_by","hasUpload","isProcessing","isViewer","isWriter","isMainAuthor","isEditable","isVisibleForAll","isRefreshing","requestOptions","requireUpload","requireEntriesPage","refreshOptions","updateUpload","dataToUpdate","requestRefreshUpload","subscribeToUpload","initiateUploadRefreshIfNeeded","oldStoreObj","newStoreObj","process_running","current_process","viewers","writers","sub","main_author","published","async","refreshUpload","currentPagination","uploadDataMissing","entryDataMissing","pag","pagIs","wrongPagination","every","raise","entryStoreObj","metadataApiData","archiveApiData","originalDefinition","exists","editable","archiveVersion","savedArchiveVersion","archiveHasChanges","requireMetadata","requireArchive","handleArchiveChanged","saveArchive","reload","requestRefreshEntry","getEntryAsync","entryRefreshSatisfiesOptions","subscribeToEntry","mergeArchiveFilter","initiateEntryRefreshIfNeeded","updateEntry","refreshEntry","upload_id","find","u","isEditableArchive","assign","required","fileName","isYaml","isJson","decompress","ignore_mime_type","transformResponse","rawArchive","YAML","processing_logs","oldTimestamp","last_processing_time","newTimestamp","oldRequireArchive","lastRefreshSatisfiesOptions","separatorIndex","lastIndexOf","newArchive","m_ref_archives","stringifiedArchive","entry_hash","getMetainfoAsync","metainfoData","metainfoBaseUrl","getMetainfoBaseUrl","frozenDef","getMetainfoFromDefinition","_result","fetchMetainfoData","_metainfo","parent","Metainfo","currentSystemMetainfoData","_url","_parsedUrl","parsedMetainfoBaseUrl","frozenMetainfo","definition_id","traversAllInheritingSections","getUrlFromDefinition","_allInternalInheritingSections","recursive","inheritingSection","contextValue","getUploadAsync","uploadRefreshSatisfiesOptions","getMetainfoDefAsync","getDefByQualifiedName","getDefByPath","getAllInheritingSections","sectionDef","sectionDefs","_qualifiedName","resetIfNeeded","newStoreKey","resetEntryAndMetainfoCaches","useEntryStoreObj","dataStore","setEntryStoreObj","rawStoreObj","reducedEntryStoreObj","oldFilterKey","onEntryStoreUpdated","satisfiesOptions","lastProcessingTime","newFilterKey","archiveFilterExtends","filter1","filter2","level","obj1","obj2","hasIncludeResolved","value1","value2","f","metainfoContext","GlobalMetainfo","globalMetainfo","useMetainfo","allCustomMetainfos","setAllCustomMetainfos","fetchAllCustomMetainfos","refresh","owner","processed","entry_id","foundCustomMetainfos","customMetainfo","useGlobalMetainfo","setMetainfo","PackageMDef","SectionMDef","QuantityMDef","SubSectionMDef","CategoryMDef","AttributeMDef","quantityUsesFullStorage","variable","attributes","_parent","_data","_getMetainfoAsync","_frozenMetainfoCache","_externalInheritanceCache","_defs","_packageDefs","_defsByNameCache","_packagePrefixCache","_rootSectionsCache","_isParsed","_parse","getDefs","getDefsByName","defQualifiedNameSegments","pkg","shift","sectionName","section_def","section_definitions","part","inner_section_def","inner_section_definitions","packageName","_sections","getPackagePrefixes","getRootSectionDefinitions","extends_base_section","_parentSections","localeCompare","getEntryArchiveDefinition","packages","_addDefIdsToCache","pkgIndex","_addPackage","subDefs","category_definitions","subDef","categories","resolveDefinitionList","_allBaseSections","base_sections","sub_sections","_parentSubSections","resolvedBaseSections","baseSectionRef","baseSection","resolveDefinition","_initSection","baseBaseSection","baseSectionUrl","externalInheritingSections","allSectionAttributes","allQuantityAttributes","createAddAttributes","inherited","createAddAttribute","allAttributes","attribute","_overwritten","quantitiy","quantityAttributes","reverse","_allAttributes","allAttritbutes","createAddProperties","createAddProperty","property","parentDef","parentProperty","parentIndex","_parentProperty","_parentIndex","_unique_id","_package","innerSectionDef","_addSection","extending_sections","sections","extendingSectionDef","addPropertiesFromSections","_addDef","_allProperties","_getAllProperties","addNewProperty","_section","shape","isReference","referencedDefinition","_referencedDefinition","subSectionsSectionDef","_createAllAttributes","unique_id","pkgParentData","_pkgParentData","categoryDef","nameOrDef","defsByName","visitedSubSections","parentSubSections","subSection","references","reference","resolvedUrl","refPath","reducer","preferMainfile","parentUrl","traverse","section","callback","subSectionDef","subSections","childPath","getQuantities","branch","quantityName","sub_section_def","MarkdownLink","RouterLink","marginTop","position","borderRadius","overflow","WebkitOverflowScrolling","lineHeight","marginBottom","extend","h3","h5","h4","h6","paddingLeft","listStyleType","wordBreak","opacity","hint","width","height","overflowX","borderCollapse","borderSpacing","divider","textAlign","paddingRight","whiteSpace","borderLeft","background","paper","maxWidth","moreProps","letters","peek","newProps","remarkPlugins","RemarkMathPlugin","remarkGfm","math","Node","inlineMath","inline","md","HelpButton","forwardRef","heading","IconProps","IconButtonProps","setOpen","handleToggleOpen","HelpDialog","Dialog","DialogTitle","DialogContent","DialogActions","TooltipButton","title","Tooltip","DatatableContext","StaticDatatableContext","combinePagination","total","page_after_value","next_page_after_value","addColumnDefaults","columns","moreDefaults","filterData","column","keySegments","sortable","multiple","align","useDatatableContext","useStaticDatatableContext","DatatablePagePagination","pageSizeValues","onPaginationChanged","TablePagination","rowsPerPageOptions","rowsPerPage","onPageChange","event","newPage","onRowsPerPageChange","useDatatableLoadMorePaginationStyles","flexDirection","justifyContent","flexWrap","DatatableLoadMorePagination","handleClick","CircularProgress","useDateatableScollPaginationStyles","DatatableScrollPagination","loadMessage","useDatatableHeaderStyles","visuallyHidden","border","clip","top","stickyHeader","DatatableHeader","actions","withSelectionFeature","multiSelect","onSelectedChanged","shownColumns","sortingColumns","withSorting","createSortHandler","isAsc","sortableColumns","TableHead","TableRow","TableCell","Checkbox","indeterminate","checked","onChange","columnLabel","placement","sortDirection","TableSortLabel","active","direction","useDatatableRowStyles","rowHover","rowSelected","lighten","rowWithDetails","rowWithUncollapsedDetails","contrastText","rowClickable","cursor","rowActionsCell","paddingTop","paddingBottom","right","rowActionsList","detailsCell","DatatableRow","uncollapsed","onRowUncollapsed","details","progressIcon","getId","numberOfColumns","handleSelect","stopPropagation","hover","clsx","role","tabIndex","colSpan","Collapse","in","timeout","unmountOnExit","useDatatableTableStyles","tableContainer","flexGrow","DatatableTable","noHeader","defaultUncollapsedRow","emptyRows","max","isScrolling","isExtending","scrollParentRef","uncollapsedRow","setUncollapsedRow","handleLoadMore","dataToShow","table","Table","TableBody","process_status","TableContainer","pageStart","loadMore","hasMore","useWindow","getScrollParent","DatatableToolbarActions","selection","hasSelection","useDatatableToolbarStyles","highlight","flex","DatatableToolbar","hideColumns","Toolbar","DatatableColumnSelector","anchorEl","setAnchorEl","onShownColumnsChanged","currentTarget","Popover","transformOrigin","List","ListItem","dense","handleToggle","disableRipple","ListItemText","Datatable","contextProps","setShownColumns","shownColumnsObjects","shownColumn","staticContext","defaultProps","UploadStatusIcon","coauthors","reviewers","shared","isReviewer","isCoauthor","Icon","VisibleIcon","SharedIcon","PrivateIcon","with_embargo","NotVisibleIcon","PublishedIcon","Filter","getRepeatsSection","group","placeholder","exclusive","queryMode","getEnumOptions","aggs","requestQuantity","nested","getRepeatsQuantity","repeats_section","scalar","global","customSerialization","serializerExact","serializerPretty","deserializer","true","false","keywords","aggregatable","widget","getWidgetConfig","metainfoOptions","opt","showinput","autorange","nbins","layout","sm","h","minW","minH","lg","xl","xxl","defaultFilterGroups","defaultFilterData","dtypeMap","idElements","idStructure","idMethod","idDFT","idGW","idBSE","idDMFT","idPrecision","idElectronic","idCatalyst","idMechanical","idSpectroscopic","idMolecularDynamics","idELN","idCustomQuantities","idAuthor","idMetadata","addToGroup","groups","groupName","saveFilter","newConf","registerFilter","subQuantities","subConfig","registerFilterOptions","terms","agg","newQuery","oldQuery","termQuantity","termQuantityBool","termQuantityNonExclusive","termQuantityAll","termQuantityAllNonExclusive","noAggQuantity","nestedQuantity","noQueryQuantity","numberHistogramQuantity","jsonStr","and","elementData","elements","isSet","band_structure_electronic","dos_electronic","greens_functions_electronic","eels","dos_phonon","band_structure_phonon","energy_free_helmholtz","heat_capacity_constant_volume","bulk_modulus","shear_modulus","energy_volume_curve","trajectory","quantityNameSearch","getStaticSuggestions","filters","withFilters","WrappedComponent","WithFilters","initialFilters","yamlOptions","nexusOptions","initialFilterData","initialFilterGroups","defaultFilters","pythonFilterData","mergedFilterGroups","dynamic","loadingYaml","setLoadingYaml","loadingNexus","setLoadingNexus","setFilters","filterGroups","setFilterGroups","nexusFilters","nexusFilterGroups","sectionPath","nx_category","filterPath","newGroups","yamlFilters","yamlFilterGroups","schemaPath","schemaDefinition","apiPath","fetchSchemas","displayName","getWindowSize","windowWidth","innerWidth","windowHeight","innerHeight","useWindowSize","setSize","handleResize","addEventListener","removeEventListener","useBoolState","initialValue","setValue","useSuggestions","quantitiesSuggest","quantitiesAll","debounceTime","loading","setSuggestions","currentRequest","staticSuggestions","fetchSuggestions","flatten","suggestionsList","q","quantitiesFixed","quantitiesDynamic","suggestionsTemp","fixed","promise","esSuggestions","finally","fetchSuggestionsDebounced","debounce","maxWait","trimmedInput","useAsyncError","setError","useActionsStyles","Actions","useDynamicStyles","dynamicStyles","useActionHeaderStyles","minWidth","spacer","ActionHeader","disableSpacer","useActionStyles","Action","disabled","onMouseDown","onMouseUp","TooltipProps","ButtonComponent","ButtonProps","testID","ActionSelect","isStatsTooltipOpen","openStatsTooltip","closeStatsTooltip","items","disableHoverListener","Select","onMouseEnter","onMouseLeave","onOpen","MenuItem","ActionCheckbox","FormControlLabel","control","WidgetToggle","useWidgetValue","useAddWidget","useRemoveWidget","useSearchContext","addWidget","removeWidget","hasWidget","widgetDefault","editing","visible","scales","scalesLimited","getScaler","scaler","domain","range","powScales","powscale","scalePow","adjustedDomain","scaleLog","argMin","iMin","getXAxisLayout","automargin","linecolor","linewidth","mirror","ticks","showline","fixedrange","standoff","font","family","tickfont","getYAxisLayout","getLineStyles","nLines","nKinds","lineStyles","startColor","endColor","colors","chromaScale","dash","presets","new","icon","iconSize","menu","inputVariant","inputSize","aggIndicator","aggCollapse","usePrototypeMenuItemStyles","GUIMenuItem","FormControl","InputLabel","bottom","zIndex","GUIMenu","setVisible","setIcon","useRecoilState","guiState","setIconSize","setMenu","setInputVariant","setInputSize","setAggIndicator","setAggCollapse","preset","useRecoilValue","presetState","handleHotkey","altKey","updatePreset","useRecoilCallback","presetMap","Menu","atomFamily","menuItem","InputHeader","disableWidget","disableStatistics","onChangeScale","actionsAlign","isSettingsOpen","isDragging","setDragging","setNotDragging","isTooltipOpen","openTooltip","closeTooltip","openMenu","closeMenu","handleMouseDown","handleMouseUp","tooltipProps","menuComp","getContentAnchorEl","keepMounted","FormLabel","RadioGroup","Radio","underscores","InputTooltip","unavailable","inputSectionContext","InputSection","disableHeader","useTheme","descFinal","labelFinal","textOverflow","ellipsisFront","Ellipsis","front","useResizeDetector","showTooltip","setShowTooltip","compareSize","compare","scrollWidth","clientWidth","useStaticStyles","grey","down","writingMode","textOrientation","up","transform","FilterTitle","rotation","disableUnit","noWrap","sectionContext","finalLabel","finalUnit","finalDescription","interactive","enterDelay","enterNextDelay","handle","WidgetHeader","handleRemove","full","Cancel","Widget","onEdit","handleEdit","actionsFinal","Edit","anchored","schemaLayout","object","test","isInteger","Infinity","y","schemaWidget","string","strip","schemaAxisBase","nullable","schemaAxis","schemaAxisOptional","schemaMarkers","getWidgetsObject","widgetList","widgets","SearchSuggestion","param","history","SuggestionType","useWidthConstrainedStyles","WidthConstrained","parseQueryString","queryString","qs","comma","removeKeycloak","RouteListener","useLocation","useHistory","useQueryString","useSetFilters","useParseQueries","parseQueries","propTypes","searchContext","SearchContextRaw","resource","initialFiltersLocked","initialColumns","initialRows","initialFilterMenus","initialPagination","initialDashboard","initialFilterValues","initialSearchSyntaxes","suggestionHistorySize","oldPagination","paginationResponse","updatedAggsMap","apiQueue","apiMap","updatedFilters","firstLoad","disableUpdate","indexFilters","indexLocked","contextID","uuidv4","initialFilterPaths","initialFilterAbbreviations","getAbbreviations","storageUnit","displayUnit","getDeep","upload_create_time","entry_create_time","refs","datasets","dataset","dataset_name","rows","filterMenus","dashboard","initialQuery","initialAggs","filterDefaults","filterFullnames","useFilterLocked","useFiltersLocked","useFiltersLockedState","useFilterValue","useSetFilter","useFilterState","useFilters","useFilterNames","useFiltersData","useFilterMaps","useResetFilters","useDynamicQueryModes","aggsFamily","useSetWidget","useWidgetState","useWidgetsValue","useWidgetsState","useResetWidgets","useQuery","useSearchSuggestionsValue","useSetSearchSuggestions","usePagination","useSetPagination","usePaginationState","useAgg","useAggs","useSetAggsResponse","useUpdateFilter","useIsMenuOpen","useSetIsMenuOpen","useIsCollapsed","useSetIsCollapsed","useIsStatisticsEnabled","useSetIsStatisticsEnabled","useApiQuery","useSetApiQuery","useApiData","useSetApiData","useResults","useSetResults","useResultsUsed","useRequired","isMenuOpenState","isCollapsedState","isStatisticsEnabledState","apiDataState","apiQueryState","resultsState","resultsUsedState","suggestionID","localStorage","getItem","searchSuggestionsState","effects","onSet","_","removeItem","setItem","requiredState","filtersDataState","filterNamesState","selector","queryFamily","dynamicQueryModesFamily","filtersState","filterMapsState","paginationState","guiLocked","lockedFamily","lockedState","locks","queryState","isObject","dynamicQueryModesState","widgetFamily","widgetIds","widgetsState","ids","stats","stat","aggsFamilyRaw","aggKeys","selectorFamily","prev","aggsState","aggsResponseFamily","aggsResponseState","subname","setter","dynamicQueryModeSetter","clearEmpty","filterState","filterNames","filtersData","filterAbbreviations","convert","opKeys","fullPath","keyInner","valueInner","valueConverted","queryStringQuery","indices","encode","convertQueryGUIToQS","setAgg","aggResponse","defaults","finalConfig","useSetFiltersData","setResultsUsed","useSetResultsUsed","setResults","setApiData","setApiQuery","setPagination","updateAggsResponse","dynamicQueryModes","filtersLocked","resultsUsed","timestamp","queryChanged","paginationChanged","aggsToUpdate","callbackAgg","callbackHits","aggregations","newAggs","aggsCustomized","filter_name","aggConfig","aggGet","aggFinal","exhausted","convertAggAPIToGUI","newResults","nextTimestamp","nextResolve","apiCall","updateAggs","aggsChanged","changed","apiQuery","customQuery","convertQueryGUIToAPI","lockedQuery","finalQuery","custom_quantities","visibility","convertAggGUIToAPI","convertPaginationGUItoAPI","convertRequiredGUItoAPI","apiCallDebounced","apiCallInterMediate","forceUpdate","reducedAggs","reduceAggs","searchSyntaxes","useParseQuery","parseQuery","useSearchSuggestions","suggestionFilter","usePushSearchSuggestion","newSuggestions","newSuggestion","useRemoveSearchSuggestion","useRefresh","useHits","useAggCall","aggCall","FreeformSearchContext","SearchContext","compose","WithQueryString","firstRender","valueRef","isOperator","newKey","valueGUI","queryModes","queryCustomized","customize","subKey","sectionData","keyNested","valueNested","queryNormalized","filterName","finalKey","convertQuerySingleGUIToAPI","getFilterMaterialPath","finalQueryMode","combine","entrySearch","convertItem","from","acc","apiValue","apiAggs","apiAgg","aggSet","finalAgg","finalQuantity","exclude_from_search","oldAggs","isBoolean","oldAgg","aggParams","aggParamsOld","isEqual","newAgg","getValue","filterLocked","defaultValue","abbreviations","nameAbbreviationPairs","fullname","materialPath","skeleton","Placeholder","margins","left","Skeleton","useInputTextFieldStyles","InputTextField","initialLabel","TextField","hiddenLabel","useInputTextStyles","popupIndicatorOpen","adornmentList","adornment","listbox","InputText","shrink","onAccept","onSelect","onHighlight","onBlur","onFocus","getOptionLabel","groupBy","renderOption","renderGroup","suggestAllOnFocus","showOpenSuggestions","autoHighlight","ListboxComponent","filterOptions","TextFieldProps","InputProps","PaperComponent","disableClearable","disableAcceptOnBlur","validate","disableValidateOnSelect","suggestAll","setSuggestAll","highlightRef","clearInputValue","handleAccept","valid","handleHighlight","reason","handleBlur","handleKeyDown","preventDefault","handleInputChange","Autocomplete","freeSolo","clearOnBlur","inputValue","fullWidth","onInputChange","onHighlightChange","getOptionSelected","selectOnFocus","renderInput","helperText","onKeyDown","InputLabelProps","endAdornment","iconButton","popupIndicator","InputTextQuantity","disableSuggestions","setInputValue","suggestionInput","setSuggestionInput","highlighted","setHighlighted","quantitiesSuggestion","suggestionsAuto","loadingAuto","finalSuggestions","finalLoading","disableSuggestionsFinal","setFilter","handleChange","handleSubmit","useInputStyles","optionText","scrollbarWidth","UnitInput","disableGroup","optional","finalOptions","unitAbbreviation","filtered","ListboxUnit","primaryTypographyProps","secondaryTypographyProps","other","itemData","Children","toArray","itemCount","getChildSize","isValidElement","ListSubheader","gridRef","resetAfterIndex","useResetCache","OuterElementContext","disablePadding","LISTBOX_PADDING","outerElementType","OuterElementType","innerElementType","itemSize","overscanCount","renderRow","outerProps","cloneElement","UnitDimensionSelect","disabledFinal","locked","oldValue","unitString","UnitSystemSelect","handleSystemChange","UnitMenu","onUnitChange","onSystemChange","dimensionOptions","setDimension","dimensionInput","setDimensionInput","cleanValue","dim","px","py","mt","useMenuBarStyles","MenuBar","MenuBarList","header","MenuList","subheader","useMenuBarItemStyles","MenuBarItem","route","matchPath","useMenuBarMenuStyles","menuPopover","pointerEvents","menuPaper","MenuBarMenu","handleOpen","disableElevation","endIcon","PopoverClasses","elevation","_clipPath","_g2","_g3","_g4","_g5","_tspan","_tspan2","_tspan3","_tspan4","_extends","arguments","hasOwnProperty","call","apply","SvgAbout","_ref","svgRef","titleId","viewBox","fillRule","clipRule","strokeLinecap","strokeLinejoin","strokeMiterlimit","clipPath","stroke","strokeWidth","fillOpacity","ForwardRef","InputConfig","maxRows","minRows","readOnly","controlledError","serialized","setSerialized","errorInternal","setErrorInternal","errorFinal","formatLib","handleError","multiline","InfoDialog","DialogProps","DistributionInfo","setTitle","plugin_entry_points","entryPoint","plugin_type","plugin_packages","pluginPackage","entryPoints","CodeInfo","introduction","codeUrl","tableOfFiles","parserSpecific","parserGitUrl","CodeList","withUploadInstructions","categorySizes","codes","codeCategory","nameA","nameB","categoryA","categoryB","sizeA","sizeB","currentCategory","categoryIndex","codeshtml","categoryTmp","html","useCardStyles","InfoCard","xs","Grid","Card","CardContent","container","ErrorHandler","Alert","severity","withErrorHandler","withWebGLErrorHandler","H5Web","initialPath","sidebarOpen","filepath","setFilepath","fname","getExportURL","file","Authorization","File","axiosConfig","disableDarkMode","escapeBadPathChars","Adaptor","initialize","cleanup","itemAdaptor","depends","browserContext","useBrowserStyles","flexFlow","lanesContainer","overflowY","scrollBehavior","lanes","sideLane","Browser","adaptor","rootRef","outerRef","innerRef","useRouteMatch","hdf5Path","setHdf5Path","hdf5Filename","setHdf5Filename","checkHdf5Path","m_nx_data_path","checkHdf5File","m_nx_data_file","useLayoutEffect","getBoundingClientRect","scrollAmmount","scrollLeft","setInternalRender","internalUpdate","computingForUrl","computeLanes","rootPath","oldLanes","newLanes","lane","newLaneCreated","encodeURI","initialized","oldLane","m_attributes","invalidateLanesFromIndex","droppedLane","invalidateLanesWithDependency","dependency","dependencies","Lane","laneContext","useLane","useLaneStyles","borderRight","containerRef","oldScrollValue","updateLane","handleScroll","onScrollToEnd","threshold","scrollHeight","clientHeight","scrollTop","onScroll","onRendered","useItemStyles","rootSelected","rootUnSelected","rootUnSelectedHighlighted","rightPaddedItem","childContainer","ItemLink","itemKey","ItemButton","itemLink","Item","chip","isSelected","wrap","classNames","Chip","Content","Compartment","startCollapsed","onUnfold","collapsed","setCollapsed","ItemChip","useTitleStyles","titleGridItem","sectionLabel","sectionValue","flexShrink","LinkWithCopyToClipboard","onCopy","Title","definitionName","subSectionName","Download","DOIUnstyled","doi","parentheses","DOI","fontStyle","userSelect","NoData","useQuantityStyles","valueContainer","valueAction","valueActionButton","valueActionIcon","alignContent","quantityList","quantityPresets","noLabel","withClipboard","hideIfUnavailable","getRenderFromType","renderValue","clipboardContent","isQuantityString","useLabel","finalValue","PopperProps","disablePortal","nElementMap","ds","RouteLink","dataset_id","comment","last_processing_version","nomad_version","nomad_commit","material_id","MaterialLink","materialId","raw_id","external_id","useMetaInfoTableStyles","tableLayout","MetaInfoTable","quantityTableContext","QuantityTable","useRowStyles","QuantityRow","useCellStyles","QuantityCell","contextData","finalData","SectionTable","showIndex","defCustom","unitLabel","Q","addMethodQuantities","parentKey","metainfoPath","changeEvent","CustomEvent","startEvent","endEvent","STATE","OrthographicControls","domElement","_state","enabled","screen","rotateSpeed","zoomSpeed","panSpeed","enableRotate","enableZoom","enablePan","staticMoving","dynamicDampingFactor","minDistance","maxDistance","rotationCenter","THREE","_prevState","_eye","_movePrev","_moveCurr","_lastAxis","_lastAngle","_lastPosition","_zoomStart","_zoomEnd","_touchZoomDistanceStart","_touchZoomDistanceEnd","_panStart","_panEnd","_zoomed","rotationCenter0","target0","position0","up0","zoom0","zoom","contextmenu","mousedown","mousewheel","touchstart","touchend","touchmove","mousemove","mouseup","dblclick","box","ownerDocument","documentElement","pageXOffset","clientLeft","pageYOffset","clientTop","handleEvent","getMouseOnScreen","pageX","pageY","vector","getMouseOnCircle","rotateCamera","axis","quaternion","eyeDirection","objectUpDirection","objectSidewaysDirection","moveDirection","copy","crossVectors","setLength","zoomFactor","setFromAxisAngle","applyQuaternion","zoomCamera","updateProjectionMatrix","panCamera","mouseChange","objectUp","pan","lengthSq","multiplyScalar","subVectors","checkDistances","addVectors","lookAt","distanceToSquared","dispatchEvent","saveReset","dispose","resetOnDoubleClick","wheelDelta","touches","listener","_listeners","listeners","hasEventListener","listenerArray","array","Viewer","hostElement","scenes","objects","cameraWidth","translation","webglAvailable","rendererDefaults","pixelRatioScale","antialias","shadows","renderer","controlDefaults","speed","controls","setOptions","setupRootElement","setupRenderer","setupScenes","setupLights","setupCamera","changeHostElement","takeScreenShot","imgData","strMime","strDownloadMime","toDataURL","strData","alpha","preserveDrawingBuffer","powerPreference","setPixelRatio","devicePixelRatio","shadowMap","rootElement","setClearColor","autoClear","setBackgroundColor","aspectRatio","camera","z","resize","firstChild","fitCanvas","rotate","rotations","basis","rotateAroundWorldAxis","setRotation","setRotationFromAxisAngle","setTranslation","translate","saveCameraReset","controlsObject","resetCamera","optionsFinal","createCornerPoints","opposite","vertices","len","setFromPoints","fitViewToPoints","points","scene","updateMatrixWorld","canvasWidth","canvasHeight","cornerPos","nPos","screenOrigin","project","round","screenMargin","screenPos","minX","maxX","minY","maxY","centerX","centerY","zoomRight","zoomLeft","zoomUp","zoomDown","newZoom","getZoom","clear","iScene","clearDepth","createCylinder","pos1","pos2","radius","nSegments","dirLen","dirNorm","divideScalar","arrow","edgeGeometry","edge","createLabel","strokeColor","ctx","fillStyle","fontFactor","textBaseline","lineWidth","strokeStyle","strokeText","fillText","texture","needsUpdate","sprite","trueOffset","center","labelRoot","rotWorldMatrix","makeRotationAxis","matrix","setFromRotationMatrix","coordinateTransform","A","Bi","applyMatrix3","alignView","alignments","directions","alignedDirections","alignment","targetVector","finalVector","alignedDirection","setFromUnitVectors","StructureViewer","atomicRadii","elementColors","meshMap","atomConfigMap","configMap","lights","bondFills","atomFills","atomOutlines","axisLabels","label_missing","elementNames","elementNumbers","radii_unknown","covalentRadii","color_unknown","jmolColors","atomDefaults","phong","shininess","outline","smoothness","atoms","bondDefaults","bonds","cellDefaults","dashSize","gapSize","periodicity","latticeConstantDefaults","beta","gamma","latticeConstants","sceneStructure","sceneInfo","atomsObject","bondsObject","angleArcs","latticeConstantsGroup","getElementInfo","toggleShadows","castShadow","receiveShadow","bond","load","structure","isFractional","species","tolerance","atomicNumbers","symb","maxRadii","getRadii","createBasisVectors","fracPos","cartPos","toVectors","toCartesian","B","toScaled","createAtoms","basisVectors","calculateCOP","centerPos","atomPos","getPositionsGlobal","getCOCGlobal","fit","addedMargin","atomGlobalPos","negate","hasInclude","hasExclude","nAtoms","excludeSet","configHash","objectHash","algorithm","updateAtom","bondMaterial","toon","nTones","tones","Uint8Array","gradientMap","minFilter","magFilter","generateMipmaps","getPositionsLocal","num1","num2","configHashI","configHashJ","configI","configJ","radii1","radii2","addBond","convCell","createCell","basisVectorCollapsed","_a","_b","_c","_d","_e","_f","_g","_h","_j","_k","_l","_m","_o","_p","_q","_r","_s","_t","_u","_v","_w","_x","_y","_z","periodicIndices","p1","p2","p3","iBasis","cellBasisColors","angleColors","angleStrokeColors","angleStrokeWidths","angleLabels","angleEnableds","axisEnableds","axisFonts","axisFontSizes","strokeColors","strokeWidths","angleFonts","angleFontSizes","iTrueBasis","axisLabel","axisColor","axisFont","axisFontSize","angleFontSize","angleFont","angleColor","angleLabel","angleStrokeColor","angleStrokeWidth","axisEnabled","angleEnabled","collapsed1","collapsed2","collapsed3","basisVec1","basisVec2","basisVec3","dir","textPos","labelOffset","newBasis","labelOffset1","labelOffset2","axisLabelSprite","cellVectorMaterial","transparent","cellVector","cellVectorLine","cellAxisMaterial","axisStart","axisEnd","cellAxisVectorLine","arrowGeometry","arrowMaterial","rotateX","arcMaterial","normal","angleTo","nArcPoints","getSpacedPoints","arcGeometry","arc","computeLineDistances","xAxis","verticesArray","nVertices","lastArcPointLocal","fromArray","lastArcPointWorld","localToWorld","arcNormal","planeAngle","updateMatrix","angleLabelPos","angleLabelLen","angleLabelObj","worldPos","getObjectByName","wPos","getWorldPosition","COC","vecPos","newPos","getAtom","shadowMapWidth","shadowBias","keyLight","shadow","mapSize","bias","fillLight","backLight","ambientLight","element","invert","atomicNumber","getColor","lineMaterial","basisVector","line1Mat","lineGeometry","secondAddition","line2Mat","line2Geometry","line2","thirdAddition","line3Mat","line3Geometry","line3","line4Mat","line4Geometry","line4","repeat","multipliers","newLabels","aTranslation","bTranslation","cTranslation","iPos","iLabel","iFracPos","setPositions","positionsOriginal","addBoundaryAtoms","xZero","almostEqual","yZero","zZero","fractional","cartPositions","posVector","elementName","coordinate","relDistance","targetAngle","ceil","cylinder","outlineMaterial","side","mesh","atomGeometry","createAtomGeometry","atomMaterial","createAtomMaterial","outlineGeometry","createAtomOutlineGeometry","createAtomOutlineMaterial","atomGroup","removeFromParent","imesh","true_pos","scaledRadius","vectors","vec","getRepetitions","latticeVector","targetSize","vectorLen","HalfEdge","vertex","face","twin","head","tail","point","distanceTo","lengthSquared","setTwin","Face","midpoint","area","constant","outside","mark","e0","e1","e2","compute","getEdge","triangle","getNormal","getMidpoint","getArea","distanceToPoint","ConvexHull","faces","newFaces","assigned","VertexList","unassigned","VertexNode","makeEmpty","setFromObject","geometry","isGeometry","applyMatrix4","matrixWorld","isBufferGeometry","fromBufferAttribute","containsPoint","intersectRay","ray","tNear","tFar","vN","vD","at","intersectsRay","addVertexToFace","append","insertBefore","removeVertexFromFace","removeAllVerticesFromFace","removeSubList","deleteFaceVertices","absorbingFace","faceVertices","appendChain","nextVertex","resolveUnassignedPoints","first","maxFace","computeExtremes","minVertices","maxVertices","getComponent","setComponent","EPSILON","computeInitialHull","plane","closestPoint","v0","v3","extremes","closestPointToPoint","setFromCoplanarPoints","reindexFaces","activeFaces","nextVertexToAdd","eyeVertex","eyeFace","computeHorizon","eyePoint","crossEdge","horizon","twinEdge","oppositeFace","addAdjoiningFace","horizonEdge","addNewFaces","firstSideEdge","previousSideEdge","sideEdge","addVertexToHull","last","insertAfter","BrillouinZoneViewer","sceneRoot","kpoints","offset2D","I","identity","multiplier","voronoi","bzVertices","cells","vpoints","finite","finite2","vpoint","bufferGeometry","normals","setAttribute","faceEdges","faceIndices","currentTriangle","faceEdge","startEdge","currentEdge","currentNormal","neighbour","neighbourNormal","getConvexGeometry","meshMaterial","renderOrder","mesh2","edgeWidth","edgeMaterial","MeshLineMaterial","sizeAttenuation","edgeVertices","scaledVertex","edgeLine","MeshLine","setPoints","edgeMesh","basisLabels","basisFonts","basisFontSizes","lineVertices","dashArray","depthTest","kpathLine","basisLabel","basisColor","basisFont","basisFontSize","basisSprite","kpathMaterial","labelPoints","iSegment","kpathVertices","kpoint","kpointScaled","kpointCart","kpath","labelObject","kpointCartesian","kpointCircle","createCircle","kpointLabel","segmentVector","nPoints","segmentPoint","diameter","beginPath","LoadingButton","buttonProps","formats","pdb","wrapModes","unwrap","WrapModeRadio","DownloadSystemMenu","setFormat","wrapMode","setWrapMode","handleChangeFormat","handleChangeWrapMode","handleClickDownload","responseType","contentDisposition","select","dialogContent","dialogActions","Floatable","onFloat","onResize","actionsHeight","windowRatio","ratio","dialogRoot","maxHeight","useNoReparentStyles","FloatableNoReparent","windowSize","handleFloat","marginAbsolute","Paper","Backdrop","backdrop","legend","minHeight","StructureBase","onWrapModeChange","disableWrapMode","showLatticeConstants","onShowLatticeConstants","disableShowLatticeConstants","showBonds","onShowBonds","disableShowBonds","showCell","onShowCell","disableShowCell","onReset","onTakeScreenshot","onFullscreen","prompt","noData","captureName","disableLegend","disableFileDownload","m_path","systemAnchorEl","setSystemAnchorEl","downloadDisabled","setShowBonds","handleWrapModeChange","handleShowLatticeConstants","setShowCell","handleFullscreen","handleReset","openSystemMenu","takeScreencapture","overlay","Species","FullscreenExit","Fullscreen","GetApp","CameraAlt","ViewList","useSpeciesStyles","grid","gridTemplateColumns","gridGap","justifySelf","alignSelf","textShadow","circle","getRadius","Structure","structuralType","cellType","sizeLimit","bondLimit","fullscreen","setFullscreen","setShowLatticeConstantsState","setShowCellState","setCenter","setFit","setWrapState","showPrompt","setShowPrompt","accepted","setAccepted","setShowBondsState","setSpecies","ready","setReady","throwError","refViewer","setWrap","setShowLatticeConstants","readyRef","refCanvasDiv","hasCell","flattenDeep","refCanvas","loadSystem","isHighQuality","showBondsValue","isSubsystem","focus","toggleFullscreen","pdfjs","GlobalWorkerOptions","workerSrc","useFilePreviewStyles","scrollableContainer","img","viewerText","fileExtensions","maxSizePreview","maxSizeAutoPreview","FilePreviewText","setFailedToPreview","src","alt","requiresLoadedData","enableClipboard","displayObjectSize","FilePreviewPdf","withCredentials","cifData","parseCifStructures","cifStructure","structureData","FilePreview","fileExtension","autoPreview","selectedViewer","viewer","preview","setPreview","failedToPreview","useFallbackViewer","setUseFallbackViewer","dataLoaded","setDataLoaded","encodedPath","useFilePreviewTextStyles","containerDiv","fileContents","contents","setContents","setHasMore","loadFailed","setLoadFailed","nBytes","useFilePreviewPdfStyles","pageDiv","numPages","setNumPages","pageWidth","setPageWidth","onLoadSuccess","renderMode","pageNumber","useEntryStore","entryContext","useEntryContext","EntryContext","cards","finalCards","northToolContext","useNorthTool","launchButtonLabels","stoppButtonLabels","LaunchButton","NorthToolButtons","launch","stop","imageIcon","iconRoot","NorthTool","tool","short_description","path_prefix","with_path","getToolStatus","toolStatus","toolUrl","username","upload_mount_dir","marginY","limitedWidth","limitedHeight","fullHeight","Page","pageWithWidth","disableWidth","useNorthToolStyles","iconImg","screenShotImg","NorthToolAccordion","file_extensions","maintainer","Accordion","AccordionSummary","expandIcon","AccordionDetails","email","curr","extension","tools","useTools","setExpanded","north","_tools","NorthLaunchButton","toolsData","Divider","FileBrowser","uploadUrl","rootTitle","highlightedItem","RawDirectoryAdaptor","lastPage","complete_time","fetchData","elementsByName","directory_metadata","extendedUrl","scrollToNextPage","is_file","RawFileAdaptor","RawDirectoryContent","CustomDropZone","onDrop","classNameNormal","classNameActive","otherProps","setActive","dragTargetsRef","onDragEnter","onDragLeave","targets","targetIdx","onDragOver","onDropped","useRawDirectoryContentStyles","dropzoneLane","dropzoneTop","dropzoneActive","entryPageMainFile","browser","openConfirmDeleteDirDialog","setOpenConfirmDeleteDirDialog","openCreateDirDialog","setOpenCreateDirDialog","openCopyMoveDialog","setOpenCopyMoveDialog","openDuplicateDialog","setOpenDuplicateDialog","setFileName","copyFileName","createDirName","refreshIfNeeded","handleDropFiles","files","formData","FormData","handleDrop","fromEvent","_filePath","dataTransfer","getData","handleCopyMoveFile","moveFile","handleCreateDir","dirName","handleDeleteDir","gotoLane","getRootProps","getInputProps","useDropzone","downloadUrl","DialogContentText","autoFocus","inputRef","RecognizedFileIcon","FileIcon","FolderIcon","file_metadata","archiveUrl","archiveAdaptorFactory","FilePreviewAdaptor","RawFileContent","openConfirmDeleteFileDialog","setOpenConfirmDeleteFileDialog","allNorthTools","applicableNorthTools","niceSize","EntryButton","filesize","MatrixPagination","useMatrixStyles","leftBracket","rightBracket","Matrix","matrixRef","pages","setPages","pageLengths","ii","columnWidth","rowCount","columnCount","rowIndex","columnIndex","rowHeight","fitMargin","BrillouinZone","reciprocal_cell","previousPoint","seg","endpoints_labels","footer","canvasContainer","placeholderRoot","floatable","warning","Plot","floatTitle","metaInfoLink","capture","fixedMargins","placeHolderStyle","noDataStyle","onRelayout","onRedraw","onRelayouting","onHover","onSelected","onSelecting","onDeselect","onWebglContextLost","layoutSubject","disableDefaultActions","throttleResize","setFloat","setRatio","canvasNode","setCanvasNode","attach","sizeReady","setSizeReady","canvasSize","layoutRecoverRef","resetInfo","captureSettings","maxSize","nodata","canvasRef","finalLayout","withTitle","template","annotations","defaultLayout","dragmode","hovermode","showlegend","autosize","yanchor","bgcolor","xaxis","yaxis","yaxis2","scrollZoom","displayModeBar","showTips","responsive","rangeX","rangeY","rangeY2","getLayout","oldLayout","newLayout","fixMargins","currentLayout","subPlots","xMin","xMax","subPlot","getAttribute","totalWidth","Plotly","relayout","requestAnimationFrame","newPlot","subscribe","react","on","hasX","hasY","hasY2","saveLayout","handleCapture","downloadImage","handleDeselect","selections","selectedpoints","useImperativeHandle","allActions","defaultActions","Warning","BandStructure","setFinalData","pathSegments","setPathSegments","energyUnit","energyHighestOccupiedNormalized","isFinite","energy_highest_occupied","plotData","channels","nChannels","nBands","tempSegments","k_path_distances","nKPoints","segmentLength","iKPoint","dist","lineUp","bands","iBand","band","legendgroup","nBand","tmpLayout","tickangle","zeroline","xanchor","computedLayout","labelKPoints","startLabel","prevLabel","endLabel","shapes","iShape","labelKPoint","x0","y0","x1","y1","yref","tickmode","tickvals","ticktext","Spectra","spectraNormalize","setSpectraNormalize","maximumIntensity","maxes","trace","intensities","energies","intensity","valueUnit","DOS","initialLayout","showexponent","setFinalLayout","normalizedToHOE","setNormalizedToHOE","dosNormalize","setDosNormalize","processedData","lineColors","isSpinPolarized","mins","iMethod","dos_method","spinChannels","spin_polarized","spinName","iSpin","densities","normalization_factor","normalization_factors","dosRenormalized","energyHighestOccupied","densitiesUnits","referencedLayout","zeroEnergyRefLayout","processNewDosData","density","density_intensity","values1","values2","processOldDosData","volumeUnit","EnergyVolumeCurve","volumes","traces","curve","plotLayout","useOverviewAtomsStyles","OverviewAtoms","lattice_vectors","periodic","useOverviewDOSStyles","OverviewDOSElectronic","dos","band_gap","OverviewDOSPhonon","useOverviewBandstructurePhononStyles","OverviewBandstructurePhonon","useOverviewBandstructureElectronicStyles","radio","OverviewBandstructureElectronic","setMode","toggleMode","bs","labelPlacement","useOverviewSpectraStyles","OverviewSpectra","useOverviewEquationOfStateStyles","OverviewEquationOfState","eos_fit","fitted_energies","function_name","Overview","ApiDataContext","useCodeStyles","codeContainer","codeActions","Code","ContentButton","buttonContent","DialogButton","buttonComponent","SourceApiDialogButton","help","SourceDialogDivider","CopyToClipboardButton","useSourceApiCallStyles","SourceApiCall","formatedBody","SourceJson","SourceJsonDialogButton","useSourceJsonStyles","stickyContainer","actionContainer","dataToRender","SourceJsonCode","Pagination","showMore","showLess","disableMore","disableLess","loadingMore","onMore","onLess","moreIcon","lessIcon","useListEditQuantityStyles","unSelected","ListEditQuantity","quantityDef","fixedLength","hasFixedLength","configState","showMeta","FoldableList","nTop","nBottom","pageSize","DateTimeEditQuantity","time","dateValue","setDateValue","date","toJSON","renderProps","jsonValue","keyboardIcon","DateEditQuantity","TimeEditQuantity","useHelpAdornmentStyles","withOtherAdornment","HelpAdornment","InputAdornment","useWithHelpStyles","WithHelp","helpDescription","getFieldProps","elnProps","TextFieldWithHelp","TestId","StringEditQuantity","TextFieldWithLinkButton","validateURL","URLEditQuantity","useDisplayUnit","defaultUnit","defaultDisplayUnit","deprecatedDefaultDisplayUnit","defaultDisplayUnitObj","NumberField","dataType","minValue","maxValue","convertInPlace","previousValue","previousNumber","previousUnitLabel","previousNumberPart","fixDigits","toPrecision","getStoredValue","valueInBaseUnit","parseInput","parsedUnit","isValid","storingValue","trimmed","parsedInput","storedValue","numberedStoredValue","debouncedHandleChange","NumberEditQuantity","dimensionBase","setChecked","displayedValue","setDisplayedValue","fieldProps","setUnit","handleUnitChange","UnitSelect","useUnitSelectStyles","submit","handleOptionChange","handleEnter","forcePopupIcon","EnumEditQuantity","ListboxProps","AutocompleteEditQuantity","BoolEditQuantity","booleanLabels","handleCheckboxChange","handleRadioChange","dialog","OverwriteExistingFileDialog","onOverwrite","onCancel","disableEscapeKeyDown","LinearProgressWithLabel","mr","LinearProgress","UploadProgressDialog","uploading","useFileEditQuantityStyles","dropzone","borderTopLeftRadius","borderTopRightRadius","FileEditQuantity","onFailed","askForOverwrite","setAskForOverwrite","dropedFiles","setUploading","uploadFile","overwrite","mainfilePathSegments","mainfileDir","mainfileDirEncoded","fullPaths","onUploadProgress","progressEvent","percentCompleted","loaded","isDragAccept","noClick","dropzoneClassName","handleOverwrite","useStyle","focused","transition","transitionProperty","transitionDuration","transitionTimingFunction","transitionDelay","RichTextEditQuantity","initialHeight","editedValue","setFocus","setInitialized","handleImageUpload","blobInfo","success","failure","progress","blob","base64","handleEditorInit","editor","onInit","init","menubar","toolbar","skin","images_upload_handler","paste_data_images","onEditorChange","DOMPurify","sanitize","opMap","opMapReverse","reString","reOp","reEquality","reLte","reLteGte","reExists","SearchSyntaxes","existence","regex","readme","examples","labelShort","equality","equals","range_bounded","ltegteSandwich","op1","op2","range_half_bounded","ltegte","aNumber","free_text","InputMetainfoControlled","disableValidation","keysSet","textProps","validateFinal","empty","ListboxMetainfo","MetainfoOption","InputMetainfo","dtypes","dtypesRepeatable","disableNonAggregatable","getMetainfoOptions","InputJMESPath","errorParse","extra","useMetainfoOptionStyles","useSuggestionStyles","Suggestion","onDelete","typeTooltip","schemaTmp","queryContainer","SearchBar","includedFormats","formatReadmeList","example","updateFilter","quantitiesAllSet","quantitiesSuggestable","quantitySetSuggestable","assert","filterList","quantitySet","suggestionNames","setSuggestionNames","suggestionQuantities","suggestionsMatch","setSuggestionsMatch","pushSuggestion","removeSuggestion","suggestionsHistory","suggestionsMetainfo","suggestionObject","clearSuggestions","clearInput","checkMetainfo","getSuggestionsMatch","bestSuggestion","targetTmp","valueTmp","errorMeta","errorQuery","err","normalizedSuggestion","quantityFullname","ListboxSuggestion","startAdornment","uploadPageContext","useUploadPageContext","UploadPageContext","setUploadStoreObj","onUploadStoreUpdated","getUrl","EntryDownloadButton","urlSuffix","queryStringData","usePropertyCardStyles","PropertyCard","headerProps","CardHeader","usePropertyCardActionsStyles","PropertyCardActions","CardActions","disableSpacing","usePropertyTitleStyles","textTransform","PropertyTitle","PropertyGrid","usePropertySubGridStyles","PropertySubGrid","usePropertyItemStyles","PropertyItem","usePropertyProvenanceListStyle","PropertyProvenanceList","MuiAccordion","MuiAccordionSummary","MuiAccordionDetails","PropertyProvenanceItem","newPath","traverseDeep","chunk","defaultExpanded","Formula","chemical_formula_reduced","chemical_formula_descriptive","MaterialCard","properties","structures","hasStructures","structure_original","structure_conventional","structure_primitive","hasLatticeParameters","lattice_parameters","hasSymmetry","structureTypes","defaultStructure","structureType","setStructureType","handleStructureChange","urlPrefix","structurePath","structureSection","speciesMap","Map","chemical_symbols","species_at_sites","cartesian_site_positions","dimension_types","toMateriaStructure","structural_type","MaterialButton","MethodMetadata","methodQuantities","hidden","quantityProps","DomainMetadata","VisitEntryAction","TransitionProps","exit","EntryRowActions","flexBasis","useEntryDetailsStyles","entryDetails","entryDetailsContents","entryDetailsRow","entryDetailsActions","EntryDetails","MaterialRowActions","ActionURL","SearchResults","noAction","defaultUncollapsedEntryID","PaperProps","actionComponents","buttons","SearchResultsWithContext","searchDialogContext","search_syntaxes","allFilters","filter_menus","flat","resultsTable","searchBar","getSectionsInfo","dataArchive","referencedSubSections","dataMetainfoDefUrl","itemLabelKey","getItemLabelKey","shownValue","getSchemaInfo","schemaArchive","Details","setSections","schemas","fetch","ListItemIcon","inset","SearchBox","unpublished","setUnpublished","setPublished","uploadContext","setVisibilityFilter","setUploadIdFilter","setProcessedFilter","setPublishedFilter","setMainAuthorFilter","handleCancel","definedFilters","SectionSelectDialog","shownEntries","menuType","found","upload_name","entryFilterOptions","pathFilterOptions","SectionSelectAutocomplete","onValueChanged","showSectionLabel","setEntries","setSelectedEntry","lastInputValue","setLastInputValue","internalError","setInternalError","showPrimary","setShowPrimary","entryNames","mainfiles","queries","requestBody","or","notFoundEntries","handleInputValueChange","debouncedHandleInputChange","newOptions","setSection","updateInputValue","loadSections","handleEntryClicked","referenceEditQuantityContext","CreateNewReferenceDialog","allEntryDataSections","onSuccess","onCanceled","selectedUpload","setSelectedUpload","selectedSection","setSelectedSection","uploads","uploadName","myUploads","othersUploads","authorsID","usersInfo","affiliation","prepareUploads","createNewEntry","processing","handleCreateClick","thisUpload","ReferenceEditQuantity","createEntryDialogOpen","setCreateEntryDialogOpen","processingError","referencedSectionDef","useReferecedSectionDef","referencedSectionQualifiedName","processing_errors","resolveValue","getReferencePath","changeValue","handleValueChange","referencePath","handleSuccess","handleFailed","handleCanceled","addIconButtonToEndAdornment","inheritingSections","referencedValue","previousError","useInviteUserDialogStyles","submitWrapper","submitProgress","InviteUserDialog","submitting","setSubmitting","canSubmit","setCanSubmit","setData","first_name","last_name","inviteUser","responseText","dataKey","editMembersDialogContext","MembersTable","members","setIsChanged","useReducer","bool","member","DeleteAction","fetchUsers","previousQuery","getUsers","withQueryInName","aValue","bValue","AddMember","setRole","newMember","setNewMember","setMembers","isDuplicated","setIsDuplicated","setIsValid","setQuery","handleAdd","htmlFor","native","inputProps","paddingY","isOwner","filteredMembers","EditMembersDialog","isChanged","openConfirmDialog","setOpenConfirmDialog","user_ids","roles","fetchMembers","newCoauthors","newReviewers","fields","AuthorEditQuantity","otherFieldProps","author","setAuthor","setEmail","searching","setSearching","userOnly","searchUsers","affiliation_address","initUser","isValidEmail","handleEmailChange","debouncedSearchUsers","handleUserInputChange","userField","RadioEnumEditQuantity","containerOuter","containerInner","scrollHint","scrollUp","scrollDown","borderTop","useScrollStyles","scrollBar","Scrollable","onBottom","hints","refRoot","isOverflowing","setIsOverflowing","isTop","setIsTop","isBottom","setIsBottom","scrollStyles","offsetHeight","updateScrollPosition","systems","FilterSettings","isStatisticsEnabled","setIsStatisticsEnabled","handleStatsChange","filterMenuContext","paddingHorizontal","collapsedMenuWidth","useFilterMenuTopHeaderStyles","FilterMenuTopHeader","useFilterMenuHeaderStyles","FilterMenuHeader","useFilterMenuStyles","willChange","FilterMenu","onSelectedChange","onOpenChange","onCollapsedChange","onSizeChange","useFilterMenuItemsStyles","headerTextVertical","menuBorder","boxShadow","collapsedActions","FilterMenuItems","headerText","useFilterMenuItemStyles","listIcon","fontsize","gutters","listItem","FilterMenuItem","disableButton","opened","useFilterSubMenusStyles","containerS","containerM","containerL","containerXL","menuS","menuM","menuL","menuXL","FilterSubMenus","nResults","menuStyle","containerStyle","m","useFilterSubMenuStyles","FilterSubMenu","useInputGridStyles","inputGridSpacing","InputGrid","useInputGridItemStyles","InputGridItem","InputCheckbox","useInputCheckboxValueStyles","InputCheckboxValue","useElementStyles","rect","rectDisabled","Element","finalCount","finalScale","textColor","textAnchor","dominantBaseline","usePeriodicTableStyles","aggId","availableValues","elementCountMap","onElementClicked","newValues","cellWidth","cellHeight","shapeRendering","textRendering","xpos","ypos","useInputPeriodicTableStyles","InputPeriodicTable","initialScale","setScale","disableAggSize","rectangle","StatisticsBar","disableValue","disabledBackground","controlLabel","labelContainer","labelPlacementStart","bar","InputItem","disableLabelClick","disableSelect","Control","labelComponent","InputUnavailable","gridAutoFlow","textField","InputField","initialSize","increment","disableSearch","disableOptions","formatLabels","visibleOptions","setVisibleOptions","fixedOptions","nFixedOptions","minSize","requestedAggSize","setRequestedAggSize","incr","receivedAggSize","oldState","handleShowMore","newSize","handleShowLess","searchComponent","optionsComponent","nItems","didNotReceiveMore","noMoreAvailable","nRows","reservedHeight","itemHeight","actionHeight","allLoaded","gridTemplateRows","noMore","aggComp","usePlotTickStyles","PlotTick","thickness","orientation","usePlotLabelStyles","tick","PlotLabel","labelPadding","tickLength","usePlotAxisStyles","labelPositioner","topTick","verticalAxis","horizontalAxis","PlotAxis","labelHeight","labelWidth","overflowLeft","overflowRight","overflowTop","overflowBottom","axisSize","labelSize","rootStyle","axisStyle","labelList","formatTick","fromUnixTime","millisecondsToSeconds","interval","splitMilliseconds","step","startRound","getTime","endRound","intervals","fiveyears","difference","differenceInYears","eachYearOfInterval","getFullYear","twoyears","years","threemonths","differenceInMonths","eachQuarterOfInterval","months","eachMonthOfInterval","weeks","differenceInWeeks","eachWeekOfInterval","days","differenceInDays","eachDayOfInterval","twelvehours","differenceInHours","eachHourOfInterval","sixhours","hours","thirtyminutes","differenceInMinutes","eachMinuteOfInterval","fifteenminutes","minutes","thirtyseconds","differenceInSeconds","fifteensecond","seconds","differences","dur","setup","differencesValid","diff","isWithinInterval","closestDuration","tickRange","degree","reduction","scaleUtils","nMin","getTicks","finalLabelWidth","maxCharacters","siPostfix","PlotBar","startX","endX","startY","endY","highlightStyle","clamp","leaveDelay","histogram","plot","gridColumn","gridRow","slider","square","inputField","inputFieldDate","thumb","inputMargin","PlotHistogram","yAxis","bins","nBins","discretization","dtypeY","tooltipLabel","disableSlider","onRangeChange","onRangeCommit","onMinChange","onMaxChange","onMinBlur","onMaxBlur","onMinSubmit","onMaxSubmit","minXInclusive","maxXInclusive","minError","maxError","minInput","maxInput","minLocal","maxLocal","stepSlider","disableHistogram","disableXTitle","oldRangeRef","isArtificial","isTime","finalBins","bucket","toInternalRange","toExternalRange","rangeInternal","gte","lte","handleRangeCommit","handleRangeChange","calculateSelection","bin","rangeLodash","unitStorage","minAdornment","maxAdornment","positionStart","inputMarginDense","inputMinField","inputMaxField","ampm","invalidDateMessage","InputAdornmentProps","histComp","Slider","onChangeCommitted","valueLabelDisplay","titleComp","titletext","autorangeDescription","WidgetHistogram","setWidget","xFilter","xTitle","xType","xUnit","handleChangeScale","Range","nSteps","setMinLocal","setMaxLocal","setPlotData","validRange","rangeChanged","minInputChanged","maxInputChanged","setRange","setMinError","setMaxError","minInclusive","setMinInclusive","maxInclusive","setMaxInclusive","setMinInput","setMaxInput","fromDisplayUnit","fromStorageUnit","toStorageUnit","minRef","gt","maxRef","lt","aggHistogramConfig","filterBounds","extended_bounds","buckets","aggSliderConfig","aggSlider","minGlobal","maxGlobal","nBuckets","stepHistogram","intervalCustom","steps","cap","capped","indexMin","getInterval","toInternal","minInc","maxInc","limit","limitMin","limitMax","validateRange","handleMinChange","setSeconds","handleMaxChange","handleMinSubmit","handleMaxSubmit","handleMinBlur","handleMaxBlur","useInputRangeStyles","InputRange","initialAutorange","setAutorange","periodicTable","FilterSubMenuElements","FilterSubMenuStructure","FilterSubMenuMethod","FilterSubMenuPrecision","FilterSubMenuDFT","FilterSubMenuTB","FilterSubMenuGW","FilterSubMenuBSE","FilterSubMenuDMFT","FilterSubMenuEELS","FilterSubMenuElectronic","FilterSubMenuSolarCell","FilterSubMenuCatalyst","FilterSubMenuMechanical","FilterSubMenuMolecularDynamics","FilterSubMenuELN","FilterSubMenuAuthor","InputRadio","filterProperties","virtual","useDefinitionStyles","Definition","hasChildren","iconProps","childPathPrefix","FilterSubMenuMetadata","tree","defsSet","addDef","all","public","staging","identifiers","FilterSubMenuOptimade","setValues","optimadeFilters","setOptimadeFilters","renderSuggestion","command","identifier","verify_only","optimade_filter","oldValues","loc","errorIndex","commands","matchAll","semanticError","newOptimadeFilters","allSuggestions","optimadeFilter","validation","prepareOptions","debouncedPrepareSuggestions","setOptimadeFilter","newFilters","FilterSubMenuGeometryOptimization","types","typeOperators","valueKeys","componentMap","EditQuantity","componentProps","elnAnnotation","editQuantityComponents","usesCompatibleComponent","QuantityFilter","operator","_quantityDef","handleIdChange","handleOperatorChange","availableOperators","getOperators","menuMap","precision","dft","tb","gw","bse","dmft","electronic","solarcell","heterogeneouscatalyst","vibrational","FilterSubMenuVibrational","mechanical","molecular_dynamics","geometry_optimization","setLoaded","setQuantities","andFilters","setAndFilters","paths","searchableQuantity","search_quantities","section_path","quantity_path","_description","retrieve","handleFilterChange","handleAndClicked","handleClearClicked","searchEnabled","handleSearchClicked","valueKey","getValueKey","valueKeyWithOperator","searchQuantity","optimade","useFilterMainMenuStyles","FilterMainMenu","menuItems","subMenus","Comp","useQueryChipStyles","chipRoot","chipLabel","QueryChip","queryGroupSpacing","useQueryChipGroupStyles","chips","titleRoot","QueryChipGroup","useQueryOpStyles","QueryOp","QueryAnd","QueryOr","createChips","filterValue","isObj","createChip","single","comp","createRangeChip","comparison","QueryChips","addChipsForSection","newChips","newSection","useQueryStyles","Query","resetFilters","colorlabel","PlotScatter","colorAxis","discrete","onNavigateToEntry","hoverTemplate","xLabel","yLabel","colorLabel","yUnit","colorUnit","scatterType","nOptions","d3","xArray","yArray","colorArray","entryIdArray","textposition","hovertemplate","marker","hoverinfo","colorscale","colorbar","ypad","xpad","hoverlabel","bordercolor","pointIndex","unitX","unitY","unitColor","StyledToggleButtonGroup","styled","ToggleButtonGroup","alert","WidgetScatterPlot","markers","xParsed","yParsed","colorParsed","unitXObj","unitYObj","unitColorObj","displayUnitX","displayUnitY","displayUnitColor","yFilter","colorFilter","yTitle","yType","colorTitle","unitLabelX","unitLabelY","unitLabelColor","setXFilter","setYFilter","hits","dataRaw","hit","hitData","xShape","getShape","yShape","biggestShape","extendFront","colorShape","reduceRec","inp","reduceInner","oldShape","newShape","extendedArray","nTraces","traceArray","extendBack","handleDragModeChanged","handleResetClick","handleSelected","flexItem","ToggleButton","PanTool","CropFree","handleNavigated","inner","extendRec","depth","fillValue","innerShape","innerArray","WidgetEditDialog","paperWidthSm","useEditGroupStyles","WidgetEditGroup","WidgetEditOption","WidgetEditSelect","WidgetPeriodicTable","WidgetPeriodicTableEdit","settings","setSettings","setErrors","schemaWidgetPeriodicTable","isValidSync","validateSyncAt","handleEditAccept","outerContainer","innerContainer","menuItemSelected","WidgetTerms","aggSize","nShown","WidgetTermsEdit","schemaWidgetTerms","cols","breakpoints","nCols","sizes","Layout","locationsFit","getAvailableLocations","bestLocation","locations","epsilon","withinItem","yMax","AB","AM","BC","BM","ABAB","ABAM","BCBC","BCBM","WidgetGrid","setWidgets","validWidth","setValidWidth","breakpoint","getNCols","firstLayout","widgetCopies","widgetCopy","breakpointNames","breakpointSmaller","breakpointBigger","layouts","scatterplot","periodictable","handleLayoutChange","allLayouts","compactType","draggableHandle","autoSize","onLayoutChange","isDraggable","isResizable","isBounded","resizeHandle","ResizeHandle","useHandleStyles","handleAxis","restProps","dtypesNumeric","dtypesColor","nPointsOptions","WidgetScatterPlotEdit","setDimensions","handleErrorQuantity","reach","schemaWidgetScatterPlot","validateSync","handleAcceptQuantity","independentErrors","xEmpty","yEmpty","WidgetHistogramEdit","schemaWidgetHistogram","DashboardAccordion","DashboardAccordionSummary","DashboardAccordionDetails","Dashboard","resetWidgets","handleScatterplot","handlePeriodicTable","handleHistogram","handleTerms","handleExpand","DashboardAction","DashboardExportButton","widgetExport","setWidgetExport","widgetImport","setWidgetImport","widgetImportError","setWidgetImportError","widgetsExport","casted","cast","stripUnknown","sorted","handleSave","widgetsInternal","leftColumn","leftColumnCollapsed","shadowVisible","SearchPage","isMenuOpen","setIsMenuOpen","isCollapsed","setIsCollapsed","SearchDialog","onQueryChanged","queryFilters","filterValues","updateFilters","handleQueryChanged","QueryEditQuantity","storeInArchive","maxData","handleClearResults","limitTags","renderTags","getTagProps","SelectEnumEditQuantity","arrayAction","subSectionAction","PropertyPreview","branding","statusbar","ArchiveButton","SectionPreview","allVisibleProperties","getAllVisibleProperties","SectionCard","archivePath","showJson","setShowJson","row_refs","PropertyEditor","editAnnotation","editComponent","editComponentProps","useSectionEditorStyles","quantityTable","SectionEditor","handleJsonChange","allVisibleQuantities","jsonData","_isEditable","XYPlotError","PlotlyFigure","plotlyGraphObj","toUnit","relativePath","resolvedQuantityDef","resolveSlice","isScalar","pathArr","pathSection","repeatPath","remainPath","allPaths","allNames","repeatDef","label_quantity","getSlicedPaths","withNames","slicedPaths","Names","slicedPath","pathRelative","getValues","Values","pathArray","Point","Value","PointUnit","xUnits","xLabels","yUnits","yLabels","zUnits","zLabels","resolveReferences","zLabel","ArchiveSearchBar","notchedOutline","XYPlot","XPrime","YPrime","xValuesArray","xValues","xPath","isMultiX","yValues","yPath","sameUnit","titlefont","anchor","overlaying","ArchiveBrowser","searchOptions","setSearchOptions","rootSectionDef","isSubscribed","parentName","parentPath","sectionDefUrl","childDef","isSectionDefinitions","pathSections","archiveSearchOptions","ArchiveSaveButton","openErrorDialog","setOpenErrorDialog","setDisabled","handleReload","ArchiveReloadButton","ArchiveConfigForm","setConfig","handleConfigChange","changes","showCodeSpecific","showAllDefined","FormGroup","ArchiveReUploadButton","onchange","archiveRootUrl","archiveRootObj","SectionAdaptor","ArchiveAdaptor","objUrl","isInEln","parsedObjUrl","entryIsEditable","external_refs","metainfoAdaptorFactory","newDefUrl","m_def_id","UnresolvedReferenceAdaptor","QuantityAdaptor","AttributeAdaptor","refUrl","adaptorFactory","attr","text_index","subSectionAdaptor","subSectionIndex","parentRelation","indexStr","resolvedObj","resolvedDef","Section","sectionIsInEln","sectionIsEditable","UnresolvedReference","FullStorageQuantity","Attribute","convertComplexArray","real","imag","complex","notation","lowerExp","upperExp","QuantityItemPreview","render_value","typeLabel","re","im","QuantityValue","getRenderValue","systemUnitQ","dangerouslySetInnerHTML","__html","h5Path","h5UploadId","h5Source","InheritingSections","originalInheritingSectionsRef","currentInheritingSections","getSelectionValue","validSections","showSelection","handleInheritingSectionsChange","sx","FormHelperText","hide","allProperties","filteredProperties","visibleProperties","reversedOrder","m_parent_index","m_parent_sub_section","editableExcluded","propertyName","navEntryId","navButton","jsonButton","deleteButton","removeSubSection","renderQuantityItem","isDefault","renderQuantity","ReferenceValuesList","storage","m_value","subSectionsToRender","subSectionCompartment","SubSection","laneWidth","lane_width","ArchiveTitle","kindLabel","ExternalReferences","getItemLabel","labelQuantity","subSectionKey","showList","PropertyValuesList","usePropertyValuesListStyles","nShownTop","setNShownTop","nShownBottom","setNShownBottom","showSelected","topEnd","bottomStart","bottomEnd","SectionPlots","sortedFigures","annotationPlot","figures","figure","pathIndex","indexedFigures","otherFigures","partition","plots","validPlots","annotationPlots","pathParts","SelectProps","newSelected","selectedIndex","m_unit","Meta","refTypeName","refTypeQualifiedName","isOk","useMetaStyles","graph","metainfoItem","DefinitionLabel","isDefinition","baseQuery","searchResults","setSearchResults","entry_list","entry_references","source_path","referencing_query","target_entry_id","target_path","tooltipContent","Histogram","getValueLabel","numberOfValues","tooltips","card","tooltipHTML","setTooltipHTML","handleItemClicked","numberOfValuesToRender","columnSize","columnsData","containerWidth","offsetWidth","rectColor","svg","columnsG","selectAll","enter","scaleBand","rangeRound","bandwidth","duration","chart","titleTypographyProps","displayEmpty","defCompare","metainfoConfigState","MetainfoBrowser","MetainfoRootAdaptor","sourceBar","textInput","MetainfoConfigForm","packagePrefix","SectionDefAdaptor","SubSectionDefAdaptor","QuantityDefAdaptor","CategoryDefAdaptor","PackageDefAdaptor","AttributeDefAdaptor","MetainfoAdaptor","categoryName","rootSection","packagePrefixes","PackagePrefixAdaptor","DefinitionDocs","defs","categoryDefs","inheritingSectionDef","baseSectionDef","SectionDef","sectionDefAdaptor","attributeDef","SubSectionDef","QuantityDef","DefinitionDetails","AttributeDef","SectionDefContent","metainfoConfig","DefinitionProperties","unused","Attributes","useName","searchAnnotations","hasSearchAnnotations","deprecated","moreKey","derived","dimensionality","links","usage","setUsage","showUsage","setShowUsage","quantityPath","program_names","aggData","use","definitionLabels","Annotations","with","purple","lime","blue","teal","BandGap","extendedColumns","greens_function_iw_im","self_energy_iw_im","greens_function_tau_re","greens_function_freq_im","self_energy_freq_im","GreensFunctions","provenance","plotArray","legendTitle","legendWidth","plotDegeneracy","itemwidth","axisData","oneSpecies","oneSpin","magnetic_state","atomLabels","iAtom","atomData","spinData","iOrb","ElectronicProperties","brillouin_zone","gf","dmftprovenance","bsLayout","dosLayout","bsYSubject","Subject","dosYSubject","handleBSRelayouting","handleDOSRelayouting","ElectronicPropertiesCard","hasDosNew","hasDosOld","hasBs","hasBandGap","hasGf","bsReferences","dosReferences","dos_electronic_new","totalMatch","totalPath","sourceArchive","internalRef","energy_ref","resolveDosNew","resolveDosOld","bg","bz","segmentPath","addBandGaps","bsReferencesIndex","gfReferences","greensFunctions","gfTau","matchTau","tau","pathTau","matchGreensFunctionTau","greens_function_tau","pathGreensFunctionTau","sourceArchiveTau","greensFunctionTau","gfMatsFreq","matchMatsFreq","matsubara_freq","pathMatsFreq","matchGreensFunctionMatsFreq","greens_function_iw","pathGreensFunctionMatsFreq","matchSelfEnergyMatsFreq","self_energy_iw","pathSelfEnergyMatsFreq","sourceArchiveMatsFreq","greensFunctionMatsFreq","selfEnergyMatsFreq","gfImAxis","gfFreq","matchFreq","frequencies","pathFreq","matchGreensFunctionFreq","greens_function_freq","pathGreensFunctionFreq","matchSelfEnergyFreq","self_energy_freq","pathSelfEnergyFreq","sourceArchiveFreq","greensFunctionFreq","selfEnergyFreq","resolveGreensFunctions","SolarCell","efficiency","fill_factor","open_circuit_voltage","short_circuit_current_density","illumination_intensity","device_area","device_architecture","absorber","absorber_fabrication","device_stack","OptoelectronicProperties","bandGap","solarCell","SolarCellPropertiesCard","optoelectronic","solar_cell","canvasParent","StructureNGL","topologyMap","canvasParentRef","setPrompt","setNoData","setDisableShowLatticeContants","setDisableWrapMode","setDisableShowCell","setDisableShowBonds","stageRef","viewerRef","componentsRef","componentRef","alignmentRef","rotationsRef","representationMap","representationRef","selectionRef","asyncError","newEntryId","getPath","atoms_ref","system_id","parent_system","nomadUrl","getSystemAPIQuery","nAtomsAccepted","n_atoms","symbolUpperCase","padStart","vdwRadii","handleShowBonds","repr","setVisibility","handleShowCell","updateState","unitCell","wrapRepresentation","autoView","view","stage","viewerControls","orient","finalQuaternion","back","premultiply","getAlignment","quaternionRotate","setFromEuler","handleTakeScreenshot","makeImage","Stage","cameraType","clipNear","clipFar","clipDist","fogNear","fogFar","loadComponent","componentKey","systemResponse","regexFloat","aPrefix","bPrefix","cPrefix","pbcPrefix","getRoot","addRepresentation","isMonomer","isMolecule","sele","bondRepr","colorScheme","colorValue","bondScale","atomRepr","radiusScale","child_systems","loadFile","ext","defaultRepresentation","metaCell","validBases","invalidBases","fracToCart","makeBasis","cartToFrac","addEdge","secondIndex","isSecondCollapsed","thirdIndex","isThirdCollapsed","addObject3DToStage","infoColor","axisOffset","valid1","valid2","maxRadius","minRadius","createLatticeConstants","topSelection","topParent","isGroup","independent","child_types","isMonomerGroup","representation","opaque","cellVisible","transparency","setParameters","pickingGroup","posNew","posCart","ap","getAtomProxy","positionToVector3","posWrap","wrapPositions","posUnwrap","posFrac","centerOfPos","Vector3","iComp","centerComp","xiSum","zetaSum","theta","xiMean","zetaMean","atan2","getCenterOfPositions","positionFromVector3","_hasCoords","refreshPosition","updateRepresentations","eps","epsArray","remainder","H","D","T","HE","LI","BE","C","N","O","F","NE","NA","MG","AL","SI","P","S","CL","AR","K","CA","SC","TI","V","CR","MN","FE","CO","NI","CU","ZN","GA","GE","AS","SE","BR","KR","RB","SR","ZR","NB","MO","TC","RU","RH","PD","AG","CD","IN","SN","SB","TE","XE","CS","BA","LA","CE","PR","ND","PM","SM","EU","GD","TB","DY","HO","ER","TM","YB","LU","HF","TA","W","RE","OS","IR","PT","AU","HG","TL","PB","BI","PO","AT","RN","FR","RA","AC","TH","PA","U","NP","PU","CM","BK","CF","ES","FM","MD","NO","LR","RF","DB","SG","BH","HS","MT","DS","RG","CN","NH","FL","MC","LV","TS","OG","useMaterialCardStyles","MaterialCardTopology","topologyTrees","topology","roots","atomic_fraction","system_relation","getTopology","tab","setTab","handleTabChange","Topology","MaterialTabs","useTopologyStyles","nodes","nodeIds","TreeView","onNodeToggle","defaultCollapseIcon","defaultExpandIcon","topologyTree","TopologyItem","useTopologyItemStyles","nodeLabelPrimary","nodeLabelSecondary","iconContainer","styleProps","TreeItem","onLabelClick","nodeId","useMaterialTabsStyles","nElems","n_elements","nElemsLabel","tabMap","hasTopology","composition","porosity","largest_cavity_diameter","pore_limiting_diameter","accessible_surface_area","accessible_volume","void_fraction","n_of_channels","sbu","sbu_type","sbu_coordination_number","coreHole","active_orbitals","Tabs","indicatorColor","scrollButtons","TabScrollButtonProps","scrollbutton","Tab","MaterialTab","chemical_formula_iupac","largest_included_sphere_along_free_sphere_path","n_channels","volume","mass_density","atomic_density","crystal_system","bravais_lattice","strukturbericht_designation","space_group_symbol","space_group_number","point_group","hall_number","hall_symbol","prototype_name","prototype_label_aflow","n_electrons_excited","degeneracy","n_quantum_number","l_quantum_symbol","ml_quantum_symbol","ms_quantum_symbol","MaterialCardFormula","useNexusCardStyles","NexusCard","HeatCapacity","tempUnit","capacityUnit","temperatures","heat_capacities","HelmholtzFreeEnergy","VibrationalProperties","freeEnergy","heatCapacity","VibrationalPropertiesCard","hasDos","hasEnergyFree","hasHeatCapacity","dosData","bsData","energyFree","energyFreeData","heatCapacityData","modulusQuantities","MechanicalProperties","evCurves","bulkModulus","shearModulus","MechanicalPropertiesCard","hasEVCurves","hasBulkModulus","hasShearModulus","evCurveData","ev","energies_raw","energies_fit","timeUnit","temperatureUnit","pressureUnit","trajectoryPath","trajectoryError","Trajectory","temperature","pressure","energyPotential","archiveURL","nPlots","ytitle","xtitle","ygap","roworder","iAxis","showticks","showticklabels","subplots","getPlotLayoutVertical","mergedLayout","getPlotTracesVertical","useTrajectoriesStyles","TrajectoriesRaw","trajsIndex","trajsArchive","trajIndex","trajProperties","available_properties","trajArchive","energy_potential","Trajectories","ThermodynamicProperties","ThermodynamicPropertiesCard","distanceUnitSquared","diffusionUnit","msdPath","msdError","MeanSquaredDisplacement","msd","tracesAll","layoutAll","times","diffusionConstant","diffusion_constant_value","D_label","R","diffusion_constant_errors","MeanSquaredDisplacementsRaw","fromEntry","msdAll","msdIndex","msdArchive","MeanSquaredDisplacements","DynamicalPropertiesCard","hasMsd","distanceUnit","rdfPath","rdfError","RadialDistributionFunction","rdf","frame_start","frame_end","rdfPlotShape","PropTypes","oneOfType","arrayOf","oneOf","rdfLabelShape","objectOf","rdfShape","RadialDistributionFunctionsRaw","rdfAll","rdfIndex","rdfArchive","RadialDistributionFunctions","rgPath","rgError","RadiusOfGyration","rg","histnorm","rgPlotShape","rgLabelShape","rgShape","methodology","RadiiOfGyrationRaw","rgIndex","kind","rgArchive","RadiiOfGyration","StructuralProperties","hasRdf","hasRg","StructuralPropertiesCard","GeometryOptimization","convergence","energyDiffTotal","diffValues","initial","diffTotal","convergenceCriteria","convergence_tolerance_energy_difference","energyDiff","tickformat","showspikes","spikethickness","spikedash","spikecolor","spikemode","final_energy_difference","final_displacement_maximum","final_force_maximum","GeometryOptimizationCard","geoOptProps","hasEnergies","n_calculations","hasConvergence","energiesArchive","SpectroscopicPropertiesCard","hasSpectra","spectras","spectra","spectroscopic","spectraReferences","useResourceDetailsStyles","resourceDetails","resourceDetailsContents","resourceDetailsRow","resourceDetailsActions","resourceURL","ResourceDetails","downloadTime","download_time","ResourceActions","RelatedResourcesCard","externalResources","setExternalResources","spg","wyckoffSets","wyckoff_sets","wyckoff","wyckoff_letter","nsites","database_name","is_retrieving_more","useWorkflowGraphStyles","strokeOpacity","archives","resolveSection","sectionKeys","nChildren","task","inputs","outputs","sectionType","getNodes","resolveIndices","maxNodes","resolved","sectionIndices","mid","getLinks","isLinked","linked","output","sourceNodes","targetNodes","sourceNode","targetNode","Graph","setTooltipContent","setCurrentNode","setShowLegend","setEnableForce","circleRadius","markerWidth","scaling","red","blueGrey","nodeShape","whRatio","legendSize","inOutColor","previousNode","dquery","currentNode","enableForce","dragged","zoomTransform","isWorkflow","nodeColor","trimName","svgGroup","gLegend","addLegend","zoomBehaviors","zoomF","force","velocityDecay","alphaDecay","dragBehaviors","sourceEvent","offsetX","offsetY","fy","zoomTo","alphaTarget","restart","gNode","gLink","setNodesPosition","tasks","inouts","rk","bound","isCircle","dr","vx","vy","vr","sy","targetR","offsetxt","offsetyt","offsetxs","offsetys","fLink","tween","setShowNodes","toNumber","qi","handleClickIcon","maxLength","addLinkMarkers","strength","handleMouseOverIcon","handleMouseOutIcon","linkNode","_name","_type","_links","_nodes","restore","WorkflowCard","tooltipPosition","setTooltipPosition","showLegend","workflow2","nodeType","nodesCount","StopSharp","PlayArrowSharp","LabelOff","Label","Undo","onMouseMove","DefinitionsCard","defaultColumns","ReferenceTable","refPool","entry_metadata","ReferenceUsingCard","referencingPool","setReferencingPool","referencedPool","setReferencedPool","openReferencing","setOpenReferencing","openReferenced","setOpenReferenced","targetEntryIds","referencingList","referenced_query","referencedList","HistoryCard","SampleHistoryUsingCard","section_defs","definition_qualified_name","DeletingReferencesTable","entryReferences","brokenEntries","normalizedEntryReferences","target_mainfile","target_upload_id","DeleteEntriesButton","selectedEntries","selectedCount","openDeleteConfirmDialog","setOpenDeleteConfirmDialog","deleteFolders","setDeleteFolders","setEntryReferences","setBrokenEntries","allReferences","handleDelete","include_parent_folders","MetadataSection","rightColumn","editActions","structural","dynamical","energy_fermi","spin_channel","thermodynamic","OverviewView","indexApiData","setResponse","useIndex","archiveTmp","dataMetainfoDef","metainfoDef","setMetainfoDef","useMetainfoDef","overview","getSections","cardComps","cardMap","nexus","relatedResources","isIcon","whyDidYouRender","archiveBrowser","downloadFab","ArchiveEntryView","useLogEntryStyles","amber","exception","LogEntry","keyNames","summaryProps","moreLogs","formControl","seeMore","FilterLogsByLevel","logLevels","onCheckListChanged","FilterLogTagsByKeys","onKeyNamesChanged","uniquekeys","labelId","Input","ArchiveLogView","doesNotExist","setDoesNotExist","setLogLevels","DEBUG","ERROR","CRITICAL","WARNING","INFO","numberOfLogs","setNumberOflogs","setkeyNames","handlekeyNamesChanged","handleCheckListChanged","extendedData","aggregatedKeys","filteredIndices","BrowseEntryFilesView","lastSlash","mainfileDirname","mainfileBasename","errorLogs","errorIcon","verticalAlign","EntryTabs","entryHasProcessingError","EntryPage","currentPath","defaultUrls","urlNoSlash","trimEnd","urls","exact","when","strict","NewUploadButton","clicked","setClicked","ExampleUploadDialog","dialogProps","exampleUploadsConfig","filterExamples","renderCategory","exampleUpload","categoryKey","ExampleUploadButton","isOpen","local_path","DeleteUploadsButton","onConfirm","openDialog","setOpenDialog","uploadIDs","nUploads","uploadText","haveText","DialogLink","linkProps","WithButton","clipboard","nameField","schemaField","radioGroup","addSearchIconToEndAdornment","CreateEntry","builtInTemplates","setBuiltInTemplates","builtInTemplate","setBuiltInTemplate","customTemplate","setCustomTemplate","setName","openEntryAlreadyExistsDialog","setOpenEntryAlreadyExistsDialog","openCreateEntryDialog","setOpenCreateEntryDialog","schemaType","setSchemaType","getReference","templates","findCategory","baseDefinition","categoryLabel","categoryNames","categoryOrder","getTemplatesFromGlobalDefinitions","getTemplates","selectedTemplate","handleBuiltInChange","getTemplateFromDefinition","dataSection","file_name","handleCustomChange","EditComments","EditReferences","onAdd","onRemove","newReference","setNewReference","urlValidation","setUrlValidation","handleChangeReference","validateURLError","apiError","error_reference","ReferencesActions","EditDatasets","userDatasets","onCreate","newDataset","setNewDataset","datasetToAdd","setDatasetToAdd","handleDatasetToAddChanged","handleNewDatasetChanged","handleCreate","addDatasetButton","error_dataset","DatasetsActions","openDatasetUrl","notSubmitted","useEditMetaDataDialogStyles","EditMetaDataDialog","nSelected","setUserDatasets","userDatasetsFetched","setUserDatasetsFetched","setActions","handleDiscardChanges","selectedEntriesObjects","defaultComment","defaultReferences","referencesList","defaultDatasets","datasetsList","datasetFullData","handleOpenDialog","createNewDatasets","promises","create_dataset","submitChanges","oldActions","isCommentChanged","isReferencesChanged","isDatasetChanged","set_comment","add_reference","remove_reference","add_dataset","notSubmittedDataset","remove_dataset","handleSubmitChanges","flatMap","newDatasets","newDatasetsIDs","_dataset","handleSetComment","newActions","handleAddReference","_actions","handleRemoveReference","handleCreateDataset","handleAddDataset","handleRemoveDataset","handleConfirm","scrollRef","useFolderStyles","FileOrFolder","onToggle","disabledProgress","FilesBrower","renderCounter","setRenderCounter","previewPath","setPreviewPath","allData","resultsByPath","renderFileOrFolder","pathPrefix","folderData","defaultSelectedColumns","ProcessingTable","customTitle","selectedQuery","UploadName","setEdit","trimmedValue","MenuBarRoute","routes","itemRoute","UploadSearchMenu","filteredMenus","useDropButtonStyles","dropzoneAccept","common","white","dropzoneReject","DropButton","isDragReject","EmbargoSelect","embargo","disabledReason","PublishUpload","onPublish","setEmbargo","embargo_length","buttonLabel","to_central_nomad","minWith","PublishUploadExternally","isPublished","published_to","server","ProcessingStatus","processing_successful","processing_failed","mainMessage","stepper","stepContent","mixedButtonIcon","SupportedCodes","UploadDocumentation","SchemaDocumentation","UploadOverview","deleteRequested","openEmbargoConfirmDialog","setOpenEmbargoConfirmDialog","setReadme","openEditMembersDialog","setOpenEditMembersDialog","handleIsVisibleForAll","handlePublish","isAuthenticated","Stepper","Step","StepLabel","StepContent","newPagination","publish_time","useUploadCommandStyles","commandContainer","commandMarkup","UploadCommands","uploadCommands","upload_command","upload_progress_command","upload_tar_command","upload_command_form","upload_command_with_name","UploadActions","UploadButton","setUploadCommands","fetchTimer","clearInterval","setInterval","isDisabled","selectedUploads","currentUserUploadsMap","disableDeleteButton","deleteUploads","allSettled","handleDeleteSubmitted","responses","AppTokenForm","setToken","maxDate","subDays","addSeconds","expiresAt","endOfDay","expiresInS","getUnixTime","app_token","limitExpiresInS","limit_value","limitExpiresAt","formatDistanceToNow","DatePicker","autoOk","disablePast","DatasetPage","setDataset","datasetFilter","dataset_create_time","dataset_modified_time","PageContext","DatasetActions","openConfirmDeleteDialog","setOpenConfirmDeleteDialog","openConfirmDoiDialog","setOpenConfirmDoiDialog","handleAssignDoi","DatasetButton","selectedColumns","createExampleData","DetailsExample","ActionsExample","ScrollDatatableExample","exampleData","nextPageAfterValueInt","loadingMessage","LoadMoreDatatableExample","DatatableExamples","SliderEditQuantity","sliderProps","minValueConverted","maxValueConverted","sliderValue","handleChangeValue","convertedValue","enumValues","Example","EditQuantityExamples","setUpdate","propsRef","sectionRef","createDefaultProps","int","UploadFilesView","UploadProcessingStatus","Slide","mountOnEnter","last_status_message","pvdSection","process_time","set_substrate_temperature","substrate_temperature","chamber_pressure","processSection","PVDEvaporation","pvdExamples","plotly_graph_object","processExamples","PlotExamples","setPlots","setKeys","pvdSectionDef","archiveSectionDef","getSection","graphObject","newPlots","newKeys","plotIndex","plotKey","entryRoutes","queryParams","isLoggedIn","pidMatch","pid","pidWithHandle","datasetRoutes","cache","doiMatch","uploadRoutes","propsUploadId","searchRoutes","routeMap","filters_locked","redirect","UploadsPage","uploadsHelp","DatasetsPage","UserdataPage","metainfoHelp","NorthPage","setInfo","useInfo","makeClickable","querySelector","onclick","setText","innerHTML","statistics","n_tutorials","tutorials","nominal","stringValue","consent","allRoutes","addRoute","childRoute","fullRoute","wrapper","Routes","CacheRoute","Route","unmount","saveScrollPosition","commonPathPrefix","RouteButton","routePath","MainMenu","ellipsis","Breadcrumbs","getRef","getFinalBreadcrumb","LoadingIndicator","drawer","logo","logoImg","borderColor","getContrastText","navigation","crumbs","AppBar","disableGutters","ScrollContext","useTermsSnackStyles","termsLink","TermsSnack","setCookie","useCookies","cookieOptions","useBetaSnackStyles","snack","BetaSnack","understood","setUnderstood","isBeta","isTest","usesBetaData","officialUrl","warn","appFrame","Navigation","scrollTo","Keycloak","realm","clientId","App","Helmet","authClient","onEvent","initOptions","onLoad","promiseType","LoadingComponent","DateFnsUtils","unit_systems","ReactRouterRoute","CssBaseline","ReactDOM","tokens","CifValue","prec","num","errormsg","tokenize","eol_re","all_re","all_m","tokenized","line_index","cifsl","slice_i","m_type","parsed","newlines","parseValue","tok","strval","strnum","parseDataBlocks","ciftokens","tagre","data_headers","data_blocks","dh","db","parseDataItems","blocktokens","data_items","vtypes","btokens","btok","valtok","ltok","loop_end","unshift","tagn","loopn","di","ciftext","o","g","write","dispatch","encoding","read","sha1","excludeValues","MD5","keysMD5","getHashes","ignoreUnknown","respectType","respectFunctionNames","respectFunctionProperties","unorderedArrays","unorderedSets","unorderedObjects","replacer","excludeKeys","Function","_object","isBuffer","_array","_date","_symbol","_boolean","_string","_function","_number","_xml","_null","_undefined","_regexp","_uint8array","_uint8clampedarray","_int8array","_uint16array","_int16array","_uint32array","_int32array","_float32array","_float64array","_arraybuffer","_map","_set","_file","lastModfied","_blob","_domwindow","_bigint","_process","_timer","_pipe","_tcp","_udp","_tty","_statwatcher","_securecontext","_connection","_zlib","_context","_nodescript","_httpparser","_dataview","_signal","_fsevent","_tlswrap","buf","writeToStream","self","Buffer","buffer","lYpoI2","toByteArray","fromByteArray","base64js","byteLength","_useTypedArrays","_augment","_isBuffer","readUInt8","_charsWritten","fromCharCode","E","L","SlowBuffer","INSPECT_MAX_BYTES","poolSize","ArrayBuffer","foo","subarray","isEncoding","M","_arr","writeUInt8","readUInt16LE","readUInt16BE","readUInt32LE","readUInt32BE","readInt8","readInt16LE","readInt16BE","readInt32LE","readInt32BE","readFloatLE","readFloatBE","readDoubleLE","readDoubleBE","writeUInt16LE","writeUInt16BE","writeUInt32LE","writeUInt32BE","writeInt8","writeInt16LE","writeInt16BE","writeInt32LE","writeInt32BE","writeFloatLE","writeFloatBE","writeDoubleLE","writeDoubleBE","inspect","toArrayBuffer","_get","ieee754","sha256","md5","createHmac","randomBytes","random","NaN","LN2","nextTick","setImmediate","postMessage","env","argv","addListener","once","off","removeListener","removeAllListeners","emit","binding","cwd","chdir"],"mappings":"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ACA,KACA,KACA,IACA,KACA,IACA,IACA,KACA,IACA,KACA,IACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,IACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,IACA,KACA,KACA,KACA,IACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,IACA,IACA,IACA,IACA,KACA,KACA,KACA,EACA,KACA,IACA,KACA,IACA,KACA7qF,KAAK6qF,cACL7qF,KAAK6qF,cACL7qF,KAAK6qF,cACL7qF,KAAK6qF,cACL7qF,KAAK6qF,cACL7qF,KAAK6qF,cACL7qF,KAAK6qF,eAGT7qF,KAAK+qF,cAAgB,UACrB/qF,KAAKgrF,WAAa,CACdhrF,KAAK+qF,cACL,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UACA,UAEP,CAIDtI,WAAW54E,GAoFP7J,KAAKirF,aAAepiE,gBAAMtL,oBAlFL,CACjBsM,SAAU,CACNqhE,MAAO,CACHC,UAAW,KAGnBC,QAAS,CACLxP,SAAS,EACTvqE,MAAO,UACPG,KAAM,MAEVm6B,QAAS,EACTt6B,MAAO,OACPi2E,OAAQ,WACRp/D,MAAO,EACPmjE,WAAY,MAmEmC9tE,oBAAsB,OAAZ1T,QAAgC,IAAZA,OAAqB,EAASA,EAAQyhF,QACvHtrF,KAAKurF,aAAe1iE,gBAAMtL,oBAlEL,CACjBq+D,SAAS,EACT/xD,SAAU,CACNqhE,MAAO,CACHC,UAAW,KAGnBC,QAAS,CACLxP,SAAS,EACTvqE,MAAO,UACPG,KAAM,MAEVH,MAAO,UACPi2E,OAAQ,IACRpS,UAAW,EACXmW,WAAY,MAmDmC9tE,oBAAsB,OAAZ1T,QAAgC,IAAZA,OAAqB,EAASA,EAAQ2hF,QACvHxrF,KAAKyrF,aAAe5iE,gBAAMtL,oBAlDL,CACjBq+D,SAAS,EACTvqE,MAAO,UACP21C,UAAW,IACX0kC,SAAU,EACVC,QAAS,EACTC,YAAa,EAAC,GAAM,GAAM,KA4CqBruE,oBAAsB,OAAZ1T,QAAgC,IAAZA,OAAqB,EAASA,EAAQ1L,OACvH6B,KAAK6rF,wBAA0BhjE,gBAAMtL,oBA3CL,CAC5Bq+D,SAAS,EACTgQ,YAAa,EAAC,GAAM,GAAM,GAC1BtkC,KAAM,QACN91C,KAAM,GACNq7D,OAAQ,CACJhhC,MAAO,IACPx6B,MAAO,QAEX1R,EAAG,CACCi8E,SAAS,EACTvqE,MAAO,UACP3M,MAAO,KAEX4jB,EAAG,CACCszD,SAAS,EACTvqE,MAAO,UACP3M,MAAO,KAEXrG,EAAG,CACCu9E,SAAS,EACTvqE,MAAO,UACP3M,MAAO,KAEX4+E,MAAO,CACH1H,SAAS,EACTvqE,MAAO,UACP3M,MAAO,UAEXonF,KAAM,CACFlQ,SAAS,EACTvqE,MAAO,UACP3M,MAAO,UAEXqnF,MAAO,CACHnQ,SAAS,EACTvqE,MAAO,UACP3M,MAAO,YAM0D6Y,oBAAsB,OAAZ1T,QAAgC,IAAZA,OAAqB,EAASA,EAAQmiF,kBAChJ,CAMDpJ,cAEI5iF,KAAK4hF,OAAS,GACd5hF,KAAKisF,eAAiB,IAAIxP,SAC1Bz8E,KAAK4hF,OAAO9iF,KAAKkB,KAAKisF,gBACtBjsF,KAAKksF,UAAY,IAAIzP,SACrBz8E,KAAK4hF,OAAO9iF,KAAKkB,KAAKksF,WACtBlsF,KAAKqO,KAAO,IAAIouE,YAChBz8E,KAAKowE,UAAY,IAAIqM,YACrBz8E,KAAKb,KAAO,IAAIs9E,YAChBz8E,KAAKmsF,YAAc,IAAI1P,YACvBz8E,KAAKosF,YAAc,IAAI3P,YACvBz8E,KAAKowE,UAAU3qE,IAAIzF,KAAKmsF,aACxBnsF,KAAKowE,UAAU3qE,IAAIzF,KAAKosF,aACxBpsF,KAAKqsF,UAAY,IAAI5P,YACrBz8E,KAAKqO,KAAK5I,IAAIzF,KAAKowE,WACnBpwE,KAAKisF,eAAexmF,IAAIzF,KAAKqO,MAC7BrO,KAAKksF,UAAUzmF,IAAIzF,KAAKb,MACxBa,KAAKssF,sBAAwB,IAAI7P,YACjCz8E,KAAKowE,UAAU3qE,IAAIzF,KAAKssF,uBAExBtsF,KAAK6hF,QAAU,CAAC7hF,KAAKqO,KAAMrO,KAAKb,KACnC,CAKDotF,iBACI,OAAOvsF,KAAK89C,QACf,CAID0uC,cAAc3xF,GACVmF,KAAKqiF,SAASsB,UAAU/H,QAAU/gF,EAClC,IAAK,IAAI6C,EAAI,EAAGA,EAAIsC,KAAKqqF,OAAO7qF,SAAU9B,EAAG,CAC3BsC,KAAKqqF,OAAO3sF,GACpB+uF,WAAa5xF,CACtB,CACD,IAAK,IAAI6C,EAAI,EAAGA,EAAIsC,KAAKuqF,UAAU/qF,SAAU9B,EAAG,CAC5C,MAAMua,EAAOjY,KAAKuqF,UAAU7sF,GAC5Bua,EAAKy0E,cAAgB7xF,EACrBod,EAAKw0E,WAAa5xF,EAClBod,EAAK4R,SAAS4+D,aAAc,CAC/B,CACD,IAAK,IAAI/qF,EAAI,EAAGA,EAAIsC,KAAKsqF,UAAU9qF,SAAU9B,EAAG,CAC5C,MAAMivF,EAAO3sF,KAAKsqF,UAAU5sF,GAC5BivF,EAAKD,cAAgB7xF,EACrB8xF,EAAKF,WAAa5xF,EAClB8xF,EAAK9iE,SAAS4+D,aAAc,CAC/B,CAIJ,CAgCDmE,KAAKC,GAED7sF,KAAK6sF,UAAYA,EAEjB7sF,KAAKgqF,YAAchqF,KAAK8qF,cAExB9qF,KAAKiqF,cAAgBjqF,KAAKgrF,WAE1B,MAAM8B,OAA2C/rF,IAA5B8rF,EAAS,YAAuCA,EAAS,WACxE3tF,EAAY2tF,EAAS,UACrBE,EAAUF,EAAS,QACnB1uF,EAAO0uF,EAAS,KAChBxW,EAAOxtD,gBAAM,CAAE5nB,KAAM,OAAQ+rF,UAAW,MAAQzvE,oBAAUsvE,EAAS,OACnEjB,EAAciB,EAAS,KAAW,EAAC,GAAO,GAAO,GACvD,IAAIrB,EAAQqB,EAAS,MACrB,IAAK3tF,EAED,OADA8Q,QAAQC,IAAI,oDACL,EAEX,IAAK88E,EAED,OADA/8E,QAAQC,IAAI,8CACL,EAGX,MAAMg9E,EAAsC,kBAAfF,EAAQ,GAC/BA,EAAQ5vF,KAAIR,GAAMA,EAAI,GAAKA,GAAKqD,KAAK2qF,aAAanrF,OAAU,EAAI7C,IAChEowF,EAAQ5vF,KAAI+vF,GAAQltF,KAAK4qF,eAAesC,IAAS,IAGvD,GAFAltF,KAAKmtF,SAAW7vF,KAAK03C,OAAOi4C,EAAc9vF,KAAIR,GAAKqD,KAAKotF,SAASzwF,MAE5D6uF,GAID,IAAKzlF,MAAMoR,QAAQq0E,GAEf,OADAx7E,QAAQC,IAAI,8DACL,OALXu7E,EAAQ,OAQZ,GAAItsF,EAAUM,QAAUytF,EAAcztF,OAElC,OADAwQ,QAAQC,IAAI,iEACL,EAGXjQ,KAAKqtF,mBAAmBlvF,GACxB,IAAImvF,EAAU,GACVC,EAAU,GAyBd,OAvBqB,IAAjBT,GACAQ,EAAUttF,KAAKwtF,UAAUtuF,GACzBquF,EAAUvtF,KAAKytF,YAAYH,GAAS,KAEd,IAAjBR,IACLS,EAAUvtF,KAAKwtF,UAAUtuF,QACV6B,IAAXf,KAAK0tF,IACLJ,EAAUttF,KAAK2tF,SAASJ,GAAS,UAI1BxsF,IAAXf,KAAK0tF,EACL1tF,KAAK4tF,YAAYN,EAASL,EAAerB,GAAa,EAAMvV,IAGvDr2E,KAAK6tF,aACV7tF,KAAK4tF,YAAYL,EAASN,EAAerB,GAAa,EAAOvV,IAMjEr2E,KAAKwsF,cAAcxsF,KAAKiiF,iBAAiBG,QAAQxG,UAC1C,CACV,CAIDkS,aAAa5uF,GACT,MAAM4mF,EAAO5mF,EAAUM,OACjB+oB,EAAM,IAAIk0D,WAChB,IAAK,IAAI/+E,EAAI,EAAGA,EAAIooF,IAAQpoF,EAAG,CAC3B,MAAMiG,EAAMzE,EAAUxB,GACtB6qB,EAAI9iB,IAAI9B,EACX,CAED,OADA4kB,EAAIm/D,aAAa5B,GACVv9D,CACV,CASDqgE,OAAO1pF,GACH,IAAI6uF,EACJ,GAAkB,QAAd7uF,EAAqB,CACrB,MAAM8uF,EAAUhuF,KAAKiuF,qBACrBF,EAAY/tF,KAAK8tF,aAAaE,EACjC,MACI,GAAiB,OAAb9uF,EACL6uF,EAAY/tF,KAAKkuF,mBAEhB,KAAI/2E,kBAAQjY,GAYb,MAAMY,MAAM,6BAXZ,GAAImmB,mBAAS/mB,EAAU,IAAK,CACxB,MAAM8uF,EAAUhuF,KAAKiuF,qBACfzI,EAAStmF,EAAU/B,KAAIO,GAAKswF,EAAQtwF,KAC1CqwF,EAAY/tF,KAAK8tF,aAAatI,EACjC,KACI,CACD,MAAMA,EAASxlF,KAAKwtF,UAAUtuF,GAC9B6uF,EAAY/tF,KAAK8tF,aAAatI,EACjC,CAIJ,CACDxlF,KAAK6kF,UAAUkJ,EAAUvN,gBAAgB,GAC5C,CAYD2N,IAAIjvF,GAAuB,IACnBsmF,EADO/sE,EAAY,uDAAH,EAEhB21E,EAAc,EAClB,GAAkB,SAAdlvF,EACAsmF,EAASxlF,KAAKiuF,qBACdG,EAAcpuF,KAAKmtF,aAElB,KAAIh2E,kBAAQjY,GAYb,MAAMY,MAAM,0BAXZ,GAAImmB,mBAAS/mB,EAAU,IAAK,CACxB,MAAMmvF,EAAgBruF,KAAKiuF,qBAC3BzI,EAAStmF,EAAU/B,KAAIO,GAAK2wF,EAAc3wF,KAC1C0wF,EAAc9wF,KAAK03C,OAAO91C,EAAU/B,KAAIO,GAAKsC,KAAKotF,SAASptF,KAAKitF,cAAcvvF,MACjF,MAEG8nF,EAASxlF,KAAKwtF,UAAUtuF,GACxBsmF,EAASA,EAAOroF,KAAI2G,GAAKA,EAAEse,QAAQ3c,IAAIzF,KAAK+hF,cAKnD,CACD/hF,KAAKulF,gBAAgBC,EAAQ/sE,EAAS21E,EACzC,CAUDj/C,MAAMo6C,GAEF,MAAMC,EAAa,CACf,EAAKxpF,KAAK6tF,aAAa,GAAGzrE,QAC1B,KAAMpiB,KAAK6tF,aAAa,GAAGzrE,QAAQksE,SACnC,EAAKtuF,KAAK6tF,aAAa,GAAGzrE,QAC1B,KAAMpiB,KAAK6tF,aAAa,GAAGzrE,QAAQksE,SACnC,EAAKtuF,KAAK6tF,aAAa,GAAGzrE,QAC1B,KAAMpiB,KAAK6tF,aAAa,GAAGzrE,QAAQksE,UAGvCt/E,MAAMs6E,UAAUC,EAAYC,EAC/B,CA2CD8B,MAAMzhF,GAEEN,gBAAMM,GACNA,EAAU,CAAC,CAAC,GAEPD,wBAAcC,KACnBA,EAAU,CAACA,IAEf,IAAK,IAAIP,KAAUO,EAAS,CACxBP,EAASuf,gBAAMtL,oBAAUvd,KAAKirF,cAAe1tE,oBAAUjU,IACvD,MAAMQ,EAAUR,EAAOQ,QACjBG,EAAUX,EAAOW,QACjBskF,GAAchlF,gBAAMO,GACpB0kF,GAAcjlF,gBAAMU,GAC1B,IAAIowD,EACJ,MAAMo0B,EAASzuF,KAAKitF,cAAcztF,OAClC,GAAI+uF,GAAcC,EACd,MAAM1uF,MAAM,8CAEX,GAAIyuF,EACLl0B,EAAUvwD,OAET,GAAI0kF,EAAY,CACjB,MAAME,EAAa,IAAIhzE,IAAIzR,GAC3BowD,EAAUhU,gBAAMooC,GAAQzkF,QAAOtL,IAAMgwF,EAAW/yE,IAAIjd,IACvD,MAEG27D,EAAUhU,gBAAMooC,UAKbnlF,EAAOQ,eACPR,EAAOW,QACd,MAAM0kF,EAAaC,KAAWtlF,EAAQ,CAAEulF,UAAW,QACnD7uF,KAAKoqF,UAAUuE,GAAcrlF,EAE7B,IAAK,MAAM5L,KAAK28D,EACZr6D,KAAKmqF,cAAczsF,GAAKixF,EACxB3uF,KAAK8uF,WAAWpxF,EAAG4L,EAAQqlF,EAElC,CACJ,CA8BDnD,MAAM3hF,GAEGN,gBAAMvJ,KAAKosF,eACZpsF,KAAKsqF,UAAY,GACjBtqF,KAAKosF,YAAYpF,SAGrB,MAAM/B,EAAep8D,gBAAMtL,oBAAUvd,KAAKurF,cAAehuE,oBAAU1T,GAAW,CAAC,IAE/E,IAAKo7E,EAAarJ,QACd,OAGJ,MAAM9xE,EAAUm7E,EAAan7E,QACvBG,EAAUg7E,EAAah7E,QACvBskF,GAAchlF,gBAAMO,GACpB0kF,GAAcjlF,gBAAMU,GAC1B,IAAIowD,EACJ,MAAMo0B,EAASzuF,KAAKitF,cAAcztF,OAClC,GAAI+uF,GAAcC,EACd,MAAM1uF,MAAM,8CAEX,GAAIyuF,EACLl0B,EAAUvwD,OAET,GAAI0kF,EAAY,CACjB,MAAME,EAAa,IAAIhzE,IAAIzR,GAC3BowD,EAAUhU,gBAAMooC,GAAQzkF,QAAOtL,IAAMgwF,EAAW/yE,IAAIjd,IACvD,MAEG27D,EAAUhU,gBAAMooC,GAGpB,IAAIM,EACJ,GAAI9J,EAAap7D,SAASmlE,KAAM,CAC5B,MAAMC,EAAShK,EAAap7D,SAASmlE,KAAKE,MACpClnC,EAAS,IAAImnC,WAAWF,GAC9B,IAAK,IAAI5wF,EAAI,EAAGA,GAAK4wF,EAAQ5wF,IACzB2pD,EAAO3pD,GAAMA,EAAI4wF,EAAU,IAE/B,MAAMG,EAAc,IAAI3S,eAAkBz0B,EAAQA,EAAOxoD,OAAQ,EAAGi9E,oBACpE2S,EAAYC,UAAY5S,iBACxB2S,EAAYE,UAAY7S,iBACxB2S,EAAYG,iBAAkB,EAC9BR,EAAe,IAAItS,oBAAuB,CACtCprE,MAAO4zE,EAAa5zE,MACpB+9E,YAAaA,GAEpB,MAEGL,EAAe,IAAItS,qBAAwB,CACvCprE,MAAO4zE,EAAa5zE,MACpB85E,UAAWlG,EAAap7D,SAASqhE,MAAMC,YAI/C,MAAM6C,EAAUhuF,KAAKwvF,oBACrB,IAAK,MAAM9xF,KAAK28D,EACZ,IAAK,MAAM97D,KAAK87D,EACZ,GAAI97D,EAAIb,EAAG,CACP,MAAM0pF,EAAO4G,EAAQtwF,GACf2pF,EAAO2G,EAAQzvF,GACfkxF,EAAOzvF,KAAKitF,cAAcvvF,GAC1BgyF,EAAO1vF,KAAKitF,cAAc1uF,GAC1B8pB,EAAWg/D,EAAKjlE,QAAQoY,IAAI4sD,GAAM5nF,SAClCmwF,EAAc3vF,KAAKmqF,cAAczsF,GACjCkyF,EAAc5vF,KAAKmqF,cAAc5rF,GACjCsxF,EAAU7vF,KAAKoqF,UAAUuF,GACzBG,EAAU9vF,KAAKoqF,UAAUwF,GACzBG,EAASF,EAAQ3nE,MAAQloB,KAAKotF,SAASqC,GACvCO,EAASF,EAAQ5nE,MAAQloB,KAAKotF,SAASsC,GACzCrnE,GAAqC,IAAzB48D,EAAa/P,WAAmB6a,EAASC,IACrDhwF,KAAKiwF,QAAQvyF,EAAGa,EAAG6oF,EAAMC,EAAM0H,EAAc9J,EAEpD,CAGZ,CAcD9mF,KAAK0L,GAED,GAAIN,gBAAMvJ,KAAK6tF,cACX,MAAM/tF,MAAM,4DAGXyJ,gBAAMvJ,KAAKkwF,WACZlwF,KAAKowE,UAAUv2D,OAAO7Z,KAAKkwF,UAG/B,MAAMjL,EAAep8D,gBAAMtL,oBAAUvd,KAAKyrF,cAAeluE,oBAAU1T,GAAW,CAAC,IAE/E,GAAIo7E,EAAarJ,QAAS,CACtB,MAAMz9E,EAAO6B,KAAKmwF,WAAW,IAAI1T,WAAiBz8E,KAAK6tF,aAAc7tF,KAAKowF,qBAAsBnL,EAAa2G,YAAa3G,EAAa5zE,MAAO4zE,EAAaj+B,UAAWi+B,EAAayG,SAAUzG,EAAa0G,SAC1M3rF,KAAKkwF,SAAW/xF,EAChB6B,KAAKowE,UAAU3qE,IAAIzF,KAAKkwF,SAC3B,CACJ,CAoEDlE,iBAAiBniF,GACb,IAAIwmF,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAEhG,GAAIroF,gBAAMvJ,KAAK6tF,cACX,MAAM/tF,MAAM,4DAGhBE,KAAKssF,sBAAsBtF,QAC3BhnF,KAAKyqF,WAAa,GAClBzqF,KAAKqsF,UAAUrF,QAEf,MAAM/B,EAAep8D,gBAAMtL,oBAAUvd,KAAK6rF,yBAA0BtuE,oBAAU1T,GAAW,CAAC,IAC1F,IAAKo7E,EAAarJ,QACd,OAGJ,MAAMiW,EAAkB,GACxB,IAAK,IAAIjoB,EAAM,EAAGA,EAAM,IAAKA,EAAK,CAC9B,MAAMkoB,EAAK7M,EAAa2G,YAAYhiB,GAC9BmoB,EAAK9M,EAAa2G,aAAahiB,EAAM,GAAK,GAC1CooB,EAAK/M,EAAa2G,aAAahiB,EAAM,GAAK,GAChD,GAAIkoB,IAAOC,IAAOC,EAAI,CAClBH,EAAgB/yF,KAAK8qE,GACrB,KACH,CACI,GAAIkoB,GAAMC,IAAOC,EAAI,CACtBH,EAAgB/yF,KAAK8qE,GACrBioB,EAAgB/yF,MAAM8qE,EAAM,GAAK,GACjC,KACH,CACJ,CAED,MAAM4a,EAAQxkF,KAAK6tF,aACnB7tF,KAAKyqF,WAAa,GAClBzqF,KAAKb,KAAKsG,IAAIzF,KAAKssF,uBACnBtsF,KAAKb,KAAKsG,IAAIzF,KAAKqsF,WAGnB,IAAI4F,GAAU,EACd,MAAMC,EAAkB,GACxBA,EAAgBpzF,KAAKmmF,EAAatlF,EAAE0R,OACpC6gF,EAAgBpzF,KAAKmmF,EAAa38D,EAAEjX,OACpC6gF,EAAgBpzF,KAAKmmF,EAAa5mF,EAAEgT,OACpC,MAAM8gF,EAAc,GACpBA,EAAYrzF,KAAKmmF,EAAa3B,MAAMjyE,OACpC8gF,EAAYrzF,KAAKmmF,EAAa6G,KAAKz6E,OACnC8gF,EAAYrzF,KAAKmmF,EAAa8G,MAAM16E,OACpC,MAAM+gF,EAAoB,GAC1BA,EAAkBtzF,UAAyIiC,KAA/C,QAAnFuvF,EAAmC,QAA7BD,EAAKpL,EAAa3B,aAA0B,IAAP+M,OAAgB,EAASA,EAAGxjB,cAA2B,IAAPyjB,OAAgB,EAASA,EAAGj/E,OAAuB4zE,EAAapY,OAAOx7D,MAAQ4zE,EAAa3B,MAAMzW,OAAOx7D,OAC7N+gF,EAAkBtzF,UAAwIiC,KAA/C,QAAlFyvF,EAAkC,QAA5BD,EAAKtL,EAAa6G,YAAyB,IAAPyE,OAAgB,EAASA,EAAG1jB,cAA2B,IAAP2jB,OAAgB,EAASA,EAAGn/E,OAAuB4zE,EAAapY,OAAOx7D,MAAQ4zE,EAAa6G,KAAKjf,OAAOx7D,OAC3N+gF,EAAkBtzF,UAAyIiC,KAA/C,QAAnF2vF,EAAmC,QAA7BD,EAAKxL,EAAa8G,aAA0B,IAAP0E,OAAgB,EAASA,EAAG5jB,cAA2B,IAAP6jB,OAAgB,EAASA,EAAGr/E,OAAuB4zE,EAAapY,OAAOx7D,MAAQ4zE,EAAa8G,MAAMlf,OAAOx7D,OAC7N,MAAMghF,EAAoB,GAC1BA,EAAkBvzF,UAAyIiC,KAA/C,QAAnF6vF,EAAmC,QAA7BD,EAAK1L,EAAa3B,aAA0B,IAAPqN,OAAgB,EAASA,EAAG9jB,cAA2B,IAAP+jB,OAAgB,EAASA,EAAG/kD,OAAuBo5C,EAAapY,OAAOhhC,MAAQo5C,EAAa3B,MAAMzW,OAAOhhC,OAC7NwmD,EAAkBvzF,UAAwIiC,KAA/C,QAAlF+vF,EAAkC,QAA5BD,EAAK5L,EAAa6G,YAAyB,IAAP+E,OAAgB,EAASA,EAAGhkB,cAA2B,IAAPikB,OAAgB,EAASA,EAAGjlD,OAAuBo5C,EAAapY,OAAOhhC,MAAQo5C,EAAa6G,KAAKjf,OAAOhhC,OAC3NwmD,EAAkBvzF,UAAyIiC,KAA/C,QAAnFiwF,EAAmC,QAA7BD,EAAK9L,EAAa8G,aAA0B,IAAPgF,OAAgB,EAASA,EAAGlkB,cAA2B,IAAPmkB,OAAgB,EAASA,EAAGnlD,OAAuBo5C,EAAapY,OAAOhhC,MAAQo5C,EAAa8G,MAAMlf,OAAOhhC,OAC7N,MAAMymD,EAAc,CAACrN,EAAa8G,MAAMrnF,MAAOugF,EAAa3B,MAAM5+E,MAAOugF,EAAa6G,KAAKpnF,OACrF+lF,EAAa,CAACxF,EAAatlF,EAAE+E,MAAOugF,EAAa38D,EAAE5jB,MAAOugF,EAAa5mF,EAAEqG,OACzE6tF,EAAgB,CAACtN,EAAa8G,MAAMnQ,QAASqJ,EAAa3B,MAAM1H,QAASqJ,EAAa6G,KAAKlQ,SAC3F4W,EAAe,CAACvN,EAAatlF,EAAEi8E,QAASqJ,EAAa38D,EAAEszD,QAASqJ,EAAa5mF,EAAEu9E,SAC/E6W,EAAY,GAClBA,EAAU3zF,UAA6BiC,IAAxBkkF,EAAatlF,EAAE2nD,KAAqB29B,EAAa39B,KAAO29B,EAAatlF,EAAE2nD,MACtFmrC,EAAU3zF,UAA6BiC,IAAxBkkF,EAAa38D,EAAEg/B,KAAqB29B,EAAa39B,KAAO29B,EAAa38D,EAAEg/B,MACtFmrC,EAAU3zF,UAA6BiC,IAAxBkkF,EAAa5mF,EAAEipD,KAAqB29B,EAAa39B,KAAO29B,EAAa5mF,EAAEipD,MACtF,MAAMorC,EAAgB,GACtBA,EAAc5zF,UAA6BiC,IAAxBkkF,EAAatlF,EAAE6R,KAAqByzE,EAAazzE,KAAOyzE,EAAatlF,EAAE6R,MAC1FkhF,EAAc5zF,UAA6BiC,IAAxBkkF,EAAa38D,EAAE9W,KAAqByzE,EAAazzE,KAAOyzE,EAAa38D,EAAE9W,MAC1FkhF,EAAc5zF,UAA6BiC,IAAxBkkF,EAAa5mF,EAAEmT,KAAqByzE,EAAazzE,KAAOyzE,EAAa5mF,EAAEmT,MAC1F,MAAMmhF,EAAe,GACrBA,EAAa7zF,UAAqIiC,KAA/C,QAA/EmwF,EAA+B,QAAzBD,EAAKhM,EAAatlF,SAAsB,IAAPsxF,OAAgB,EAASA,EAAGpkB,cAA2B,IAAPqkB,OAAgB,EAASA,EAAG7/E,OAAuB4zE,EAAapY,OAAOx7D,MAAQ4zE,EAAatlF,EAAEktE,OAAOx7D,OAChNshF,EAAa7zF,UAAqIiC,KAA/C,QAA/EqwF,EAA+B,QAAzBD,EAAKlM,EAAa38D,SAAsB,IAAP6oE,OAAgB,EAASA,EAAGtkB,cAA2B,IAAPukB,OAAgB,EAASA,EAAG//E,OAAuB4zE,EAAapY,OAAOx7D,MAAQ4zE,EAAa38D,EAAEukD,OAAOx7D,OAChNshF,EAAa7zF,UAAqIiC,KAA/C,QAA/EuwF,EAA+B,QAAzBD,EAAKpM,EAAa5mF,SAAsB,IAAPgzF,OAAgB,EAASA,EAAGxkB,cAA2B,IAAPykB,OAAgB,EAASA,EAAGjgF,OAAuB4zE,EAAapY,OAAOx7D,MAAQ4zE,EAAa5mF,EAAEwuE,OAAOx7D,OAChN,MAAMuhF,EAAe,GACrBA,EAAa9zF,UAAqIiC,KAA/C,QAA/EywF,EAA+B,QAAzBD,EAAKtM,EAAatlF,SAAsB,IAAP4xF,OAAgB,EAASA,EAAG1kB,cAA2B,IAAP2kB,OAAgB,EAASA,EAAG3lD,OAAuBo5C,EAAapY,OAAOhhC,MAAQo5C,EAAatlF,EAAEktE,OAAOhhC,OAChN+mD,EAAa9zF,UAAqIiC,KAA/C,QAA/E2wF,EAA+B,QAAzBD,EAAKxM,EAAa38D,SAAsB,IAAPmpE,OAAgB,EAASA,EAAG5kB,cAA2B,IAAP6kB,OAAgB,EAASA,EAAG7lD,OAAuBo5C,EAAapY,OAAOhhC,MAAQo5C,EAAa38D,EAAEukD,OAAOhhC,OAChN+mD,EAAa9zF,UAAqIiC,KAA/C,QAA/E6wF,EAA+B,QAAzBD,EAAK1M,EAAa5mF,SAAsB,IAAPszF,OAAgB,EAASA,EAAG9kB,cAA2B,IAAP+kB,OAAgB,EAASA,EAAG/lD,OAAuBo5C,EAAapY,OAAOhhC,MAAQo5C,EAAa5mF,EAAEwuE,OAAOhhC,OAChN,MAAMgnD,EAAa,GACnBA,EAAW/zF,UAAiCiC,IAA5BkkF,EAAa3B,MAAMh8B,KAAqB29B,EAAa39B,KAAO29B,EAAa3B,MAAMh8B,MAC/FurC,EAAW/zF,UAAgCiC,IAA3BkkF,EAAa6G,KAAKxkC,KAAqB29B,EAAa39B,KAAO29B,EAAa6G,KAAKxkC,MAC7FurC,EAAW/zF,UAAiCiC,IAA5BkkF,EAAa8G,MAAMzkC,KAAqB29B,EAAa39B,KAAO29B,EAAa8G,MAAMzkC,MAC/F,MAAMwrC,EAAiB,GACvBA,EAAeh0F,UAAiCiC,IAA5BkkF,EAAa3B,MAAM9xE,KAAqByzE,EAAazzE,KAAOyzE,EAAa3B,MAAM9xE,MACnGshF,EAAeh0F,UAAgCiC,IAA3BkkF,EAAa6G,KAAKt6E,KAAqByzE,EAAazzE,KAAOyzE,EAAa6G,KAAKt6E,MACjGshF,EAAeh0F,UAAiCiC,IAA5BkkF,EAAa8G,MAAMv6E,KAAqByzE,EAAazzE,KAAOyzE,EAAa8G,MAAMv6E,MAGnG,IAAK,IAAIuhF,EAAa,EAAGA,EAAa,IAAKA,EAAY,CACnDd,GAAU,EACV,MAAMe,EAAYvI,EAAWwH,GACvBgB,EAAYf,EAAgBD,GAC5BiB,EAAWT,EAAUR,GACrBkB,EAAeT,EAAcT,GAC7BmB,EAAgBN,EAAeb,GAC/BnlB,EAAc8lB,EAAaX,GAC3BlK,EAAc4K,EAAaV,GAC3BoB,EAAYR,EAAWZ,GACvBqB,EAAanB,EAAYF,GACzBsB,EAAajB,EAAYL,GACzBuB,EAAmBpB,EAAkBH,GACrCwB,EAAmBpB,EAAkBJ,GACrCyB,EAAclB,EAAaP,GAC3B0B,EAAepB,EAAcN,GAC7B2B,EAAa5zF,KAAKowF,qBAAqB2C,GACvCc,EAAa7zF,KAAKowF,sBAAsB2C,EAAa,GAAK,GAC1De,EAAa9zF,KAAKowF,sBAAsB2C,EAAa,GAAK,GAC1DgB,EAAYvP,EAAMuO,GAClBiB,EAAYxP,GAAOuO,EAAa,GAAK,GAAG3wE,QACxC6xE,EAAYzP,GAAOuO,EAAa,GAAK,GAAG3wE,QAC9C,GAAIsxE,IAAgBE,EAAY,CAE5B,MAAM7qF,EAAS,IAAI0zE,WAAc,EAAG,EAAG,GACjCyX,EAAMH,EAAU3xE,QAEhB+xE,EAAUD,EAAI9xE,QACfo+D,eAAe,IACpB,IAAI4T,EACAC,EACJ,GAAIR,GAAcC,EACdO,EAAW,IAAI5X,WAAc,EAAG,EAAG,GACnC2X,GAAc,IAAI3X,YAAgBmD,aAAamU,EAAWM,QAEzD,GAAIR,EACLQ,GAAW,IAAI5X,YAAgBmD,aAAamU,EAAWE,GACvDG,GAAc,IAAI3X,YAAgBmD,aAAamU,EAAWM,QAEzD,GAAIP,EACLO,GAAW,IAAI5X,YAAgBmD,aAAamU,EAAWC,GACvDI,GAAc,IAAI3X,YAAgBmD,aAAamU,EAAWM,OAEzD,CACD,MAAMC,GAAe,IAAI7X,YAAgBmD,aAAamU,EAAWC,GAC3DO,GAAe,IAAI9X,YAAgBmD,aAAamU,EAAWE,GACjEG,GAAc,IAAI3X,YAAgBjiD,IAAI85D,GAAc7uF,IAAI8uF,EAC3D,CACDH,EAAY5qF,YACZ4qF,EAAY5T,eAAe,IAC3B2T,EAAQ1uF,IAAI2uF,GACZ,MAAMI,EAAkBx0F,KAAK8nF,YAAYqM,EAASnB,EAAWC,EAAWC,EAAUC,EAAc,IAAI1W,WAAc,EAAK,GAAM3P,EAAaib,GAC1I/nF,KAAKssF,sBAAsB7mF,IAAI+uF,GAC/Bx0F,KAAKyqF,WAAW3rF,KAAK01F,GAErB,MAAMC,EAAqB,IAAIhY,qBAAwB,CACnDprE,MAAO4hF,EACPyB,aAAa,EACb/oD,QAAS,MAEPgpD,EAAaZ,EAAU3xE,QACvBwyE,EAAiB50F,KAAKmnF,eAAep+E,EAAOqZ,QAASuyE,EAAWvyE,QAAQ3c,IAAIsD,GAAS,IAAM,GAAI0rF,GACrGz0F,KAAKssF,sBAAsB7mF,IAAImvF,GAE/B,MAAMC,EAAmB,IAAIpY,qBAAwB,CACjDprE,MAAO,YAELyjF,EAAY90F,KAAK6tF,aAAakF,GAAY3wE,QAC1C2yE,EAAUD,EAAU1yE,QAAQo+D,eAAe,EApHtC,IAoHuDsU,EAAUt1F,UACtEw1F,EAAqBh1F,KAAKmnF,eAAep+E,EAAOqZ,QAAS2yE,EAAS,IAAM,GAAIF,GAClF70F,KAAKssF,sBAAsB7mF,IAAIuvF,GAE/B,MAAMC,EAAgB,IAAIxY,oBAAuB,EAAG,GAAM,GAAK,IACzDyY,EAAgB,IAAIzY,qBAAwB,CAC9CprE,MA3HM,IA6HJs2E,EAAQ,IAAIlL,QAAWwY,EAAeC,GAC5CvN,EAAM98C,SAAS80C,KAAKuU,GACf1T,eAAe,EA9HT,IA8H0B0T,EAAI10F,UACzCmoF,EAAM/G,OAAO,IAAInE,YACjBkL,EAAMwN,SAAS73F,KAAKuB,GAAK,GACzBmB,KAAKssF,sBAAsB7mF,IAAIkiF,EAClC,CACD,GAAIgM,IAAiBC,IAAeC,EAAY,CAE5C,MAAMuB,EAAc,IAAI3Y,sBAAyB,CAC7CprE,MAvIM,EAwIN21C,UAAW,EACX0kC,SAAU,GACVC,QAAS,KAEP0J,GAAS,IAAI5Y,YAAgBmD,aAAamU,EAAWC,GACrDr1F,EAAQo1F,EAAUuB,QAAQtB,GAC1B1M,EAAShqF,KAAK03C,IAAI13C,KAAK+J,IAAI,EAAI,EAAI0sF,EAAUv0F,SAAU,EAAI,EAAIw0F,EAAUx0F,UAAW,GAOpF+1F,EAAa,GACb/P,EAPQ,IAAI/I,gBAAmB,EAAG,EACxC6K,EAAQA,EACR,EAAG3oF,GACH,EACA,GAGqB62F,gBAAgBD,GAC/BE,GAAc,IAAIhZ,mBAAuB6I,cAAcE,GACvDkQ,EAAM,IAAIjZ,QAAWgZ,EAAaL,GACxCM,EAAIC,uBAGJ,MAAMC,EAAQ,IAAInZ,WAAc,EAAG,EAAG,GAChC6C,GAAa,IAAI7C,eAAmBqN,mBAAmB8L,EAAO7B,EAAU3xE,QAAQ5Y,aACtFksF,EAAIpW,WAAWK,KAAKL,GAIpB,MAAMuW,EAAgBJ,EAAYtyD,WAAW0H,SAAS42C,MAChDqU,EAAYD,EAAcr2F,OAAS,EACnCu2F,GAAoB,IAAItZ,YAAgBuZ,UAAUH,EAAiC,GAAjBC,EAAY,IACpFJ,EAAIhQ,oBACJ,MAAMuQ,EAAoBP,EAAIQ,aAAaH,EAAkB3zE,SAEvDi9D,EAAO0U,EACPoC,GAAY,IAAI1Z,YACjBmD,aAAaP,EAAM4W,GACxB,IAAIG,EAAaf,EAAOC,QAAQa,IACb,IAAI1Z,YAClBmD,aAAaoU,EAAWiC,GACKl5F,IAAIsiF,GACjB,IACjB+W,GAAcA,GAElBV,EAAIP,QAAQiB,GAEZV,EAAIhQ,oBACJgQ,EAAIW,eACJ,MAAMC,EAAgBZ,EAAIQ,cAAa,IAAIzZ,YAAgBuZ,UAAUH,EAAsC,GAAtBN,EAAa,EAAI,KAChGgB,EAAgBD,EAAc92F,SACpC82F,EAAc9V,eAAe,EAAI,GAAM+V,GACvC,MAAMC,EAAgBx2F,KAAK8nF,YAAYwO,EAAe/C,EAAW9kF,WAAY6kF,EAAYD,EAAWD,EAAe,IAAI3W,WAAc,EAAK,GAAMgX,EAAkBD,GAClKxzF,KAAKssF,sBAAsB7mF,IAAI+wF,GAC/Bx2F,KAAKyqF,WAAW3rF,KAAK03F,GACrBx2F,KAAKqsF,UAAU5mF,IAAIiwF,EACtB,CACJ,CACJ,CAIDlG,oBACI,OAAOxvF,KAAKd,SACf,CAID+uF,qBACI,MAAMQ,EAASzuF,KAAKd,UAAUM,OACxBi3F,EAAW,GACjBz2F,KAAKmsF,YAAYzG,oBACjB,IAAK,IAAIhoF,EAAI,EAAGA,EAAI+wF,IAAU/wF,EAAG,CAC7B,MAAMua,EAAOjY,KAAKmsF,YAAYuK,gBAAjB,cAAwCh5F,IAC/Ci5F,EAAO,IAAIla,WACjBxkE,EAAK2+E,iBAAiBD,GACtBF,EAAS33F,KAAK63F,EACjB,CACD,OAAOF,CACV,CAIDvI,eACI,IAAI2I,GAAM,IAAIpa,YACTh3E,IAAIzF,KAAK6tF,aAAa,IACtBpoF,IAAIzF,KAAK6tF,aAAa,IACtBpoF,IAAIzF,KAAK6tF,aAAa,IACtBrN,eAAe,IAGpB,OAFAxgF,KAAKqO,KAAKq3E,oBACVmR,EAAM72F,KAAKqO,KAAK6nF,aAAaW,GACtBA,CACV,CAODrJ,UAAUtuF,GACN,MAAM43F,EAAS,GACf,IAAK,IAAIp5F,EAAI,EAAG8T,EAAOtS,EAAUM,OAAQ9B,EAAI8T,IAAQ9T,EACjDo5F,EAAOh4F,MAAK,IAAI29E,YAAgBuZ,UAAU92F,EAAUxB,KAExD,OAAOo5F,CACV,CACDrJ,YAAYvuF,GACR,KADgC,yDACtB,CACN,MAAM63F,EAAS,GACf,IAAK,IAAIr5F,EAAI,EAAG8T,EAAOtS,EAAUM,OAAQ9B,EAAI8T,IAAQ9T,EACjDq5F,EAAOj4F,KAAKI,EAAUxB,GAAG0kB,QAAQinE,aAAarpF,KAAK0tF,IAEvD,OAAOqJ,CACV,CAEG,IAAK,IAAIr5F,EAAI,EAAG8T,EAAOtS,EAAUM,OAAQ9B,EAAI8T,IAAQ9T,EACjDwB,EAAUxB,GAAG2rF,aAAarpF,KAAK0tF,EAG1C,CACDC,SAASzuF,GACL,KAD6B,yDACnB,CACN,MAAM63F,EAAS,GACf,IAAK,IAAIr5F,EAAI,EAAG8T,EAAOtS,EAAUM,OAAQ9B,EAAI8T,IAAQ9T,EACjDq5F,EAAOj4F,KAAKI,EAAUxB,GAAG0kB,QAAQinE,aAAarpF,KAAKopF,KAEvD,OAAO2N,CACV,CAEG,IAAK,IAAIr5F,EAAI,EAAG8T,EAAOtS,EAAUM,OAAQ9B,EAAI8T,IAAQ9T,EACjDwB,EAAUxB,GAAG2rF,aAAarpF,KAAKopF,GAG1C,CAQD4N,QAAQr3E,GACJ,OAAO3f,KAAKmsF,YAAYuK,gBAAjB,cAAwC/2E,GAClD,CACDkjE,cACI7iF,KAAKqqF,OAAS,GACd,MAAM4M,EAAiB,KACjBC,GAAc,KAGdC,EAAW,IAAI1a,oBAAuB,SAAU,KACtD0a,EAASC,OAAOC,QAAQxrD,MAAQorD,EAChCE,EAASC,OAAOC,QAAQvrD,OAASmrD,EACjCE,EAASC,OAAOE,KAAOJ,EAEvBC,EAASC,OAAOnT,OAAOriB,MAPF,GAQrBu1B,EAASC,OAAOnT,OAAO7wC,MARF,GASrB+jD,EAASC,OAAOnT,OAAOnzC,IATF,GAUrBqmD,EAASC,OAAOnT,OAAOj7B,QAVF,GAWrBmuC,EAAStsD,SAASvxB,IAAI,EAAG,EAAG,IAC5BtZ,KAAKisF,eAAexmF,IAAI0xF,GACxBn3F,KAAKqqF,OAAOvrF,KAAKq4F,GAEjB,MAAMI,EAAY,IAAI9a,oBAAuB,SAAU,IACvD8a,EAAUH,OAAOC,QAAQxrD,MAAQorD,EACjCM,EAAUH,OAAOC,QAAQvrD,OAASmrD,EAClCM,EAAUH,OAAOE,KAAOJ,EACxBK,EAAU1sD,SAASvxB,KAAK,GAAI,GAAI,IAEhC,MAAMk+E,EAAY,IAAI/a,oBAAuB,SAAU,KACvD+a,EAAUJ,OAAOC,QAAQxrD,MAAQorD,EACjCO,EAAUJ,OAAOC,QAAQvrD,OAASmrD,EAClCO,EAAUJ,OAAOE,KAAOJ,EACxBM,EAAU3sD,SAASvxB,IAAI,GAAI,GAAI,IAE/B,MAAMm+E,EAAe,IAAIhb,gBAAmB,QAAU,KACtDz8E,KAAKisF,eAAexmF,IAAIgyF,EAC3B,CAMDpK,mBAAmB7I,GAEf,QAAczjF,IAAVyjF,EAIA,OAHAxkF,KAAK6tF,kBAAe9sF,EACpBf,KAAK0tF,OAAI3sF,OACTf,KAAKopF,QAAKroF,GAId,MAAMpB,GAAI,IAAI88E,YAAgBuZ,UAAUxR,EAAM,IACxCl8D,GAAI,IAAIm0D,YAAgBuZ,UAAUxR,EAAM,IACxCnmF,GAAI,IAAIo+E,YAAgBuZ,UAAUxR,EAAM,IAC9CxkF,KAAK6tF,aAAe,CAACluF,EAAG2oB,EAAGjqB,GAC3B,MAAMqvF,EAAI,IAAIjR,WACdiR,EAAEp0E,IAAI3Z,EAAEjB,EAAG4pB,EAAE5pB,EAAGL,EAAEK,EAAGiB,EAAE0vD,EAAG/mC,EAAE+mC,EAAGhxD,EAAEgxD,EAAG1vD,EAAEukF,EAAG57D,EAAE47D,EAAG7lF,EAAE6lF,GAEhDlkF,KAAKowF,qBAAuB,GAC5B,IAAK,IAAI1yF,EAAI,EAAGA,EAAI,IAAKA,EAAG,CACxB,MAAM8B,EAASQ,KAAK6tF,aAAanwF,GAAG8B,SACpCQ,KAAKowF,qBAAqBtxF,KAAKU,EAAS,KAC3C,CACGQ,KAAKowF,qBAAqBhuF,MAAKs1F,GAAWA,KAC1C13F,KAAK0tF,OAAI3sF,EACTf,KAAKopF,QAAKroF,IAGVf,KAAK0tF,EAAIA,EACT1tF,KAAKopF,IAAK,IAAI3M,YAAgBkD,KAAK+N,GAAGiK,SAE7C,CAMDvK,SAASwK,GACL,OAAO53F,KAAKgqF,YAAY4N,IAAiB53F,KAAK6qF,aACjD,CAMDgN,SAASvuF,EAAQsuF,GACb,MAAwB,SAAjBtuF,EAAO+H,MACRrR,KAAKiqF,cAAc2N,IAAiB53F,KAAK+qF,cACzCzhF,EAAO+H,KAChB,CAWD8+E,WAAWpnF,EAAQ8kF,EAAcuC,EAAsBxE,EAAav6E,EAAO21C,EAAW0kC,EAAUC,GAE5F,MAAMxtF,EAAO,IAAIs+E,YACjB,IAAIqb,EAEAA,EADe,IAAbpM,GAA8B,IAAZC,EACL,IAAIlP,sBAAyB,CACxCprE,MAAOA,EACP21C,UAAWA,EACX0kC,SAAUA,EACVC,QAASA,IAIE,IAAIlP,qBAAwB,CACvCprE,MAAOA,EACP21C,UAAWA,IAGnB,IAAK,IAAIq+B,EAAMwI,EAAaruF,OAAQ9B,EAAI,EAAGA,EAAI2nF,IAAO3nF,EAAG,CACrD,MAAMq6F,EAAclK,EAAanwF,GAAG0kB,QAC9Bw0D,EAAYwZ,EAAqB1yF,GAEjCs6F,EAAWF,EAAa11E,QAE9B,KADgBwpE,EAAYluF,KACZk5E,EAAY,CACxB,MAAM4O,EAAS,GACfA,EAAO1mF,KAAKiK,EAAOqZ,SACnBojE,EAAO1mF,KAAKi5F,EAAY31E,QAAQ3c,IAAIsD,IACpC,MAAMkvF,GAAe,IAAIxb,mBAAuB6I,cAAcE,GACxD/2D,EAAO,IAAIguD,QAAWwb,EAAcD,GAC1C75F,EAAKsH,IAAIgpB,GACTA,EAAKknE,sBACR,CAED,MACMuC,EAAiBrK,GADFnwF,EAAI,GAAK2nF,GACmBjjE,QAEjD,MADgBwpE,EAAYluF,KAAOkuF,GAAaluF,EAAI,GAAK,MACzCk5E,EAAY,CACxB,MAAMuhB,EAAWL,EAAa11E,QACxBojE,EAAS,GACfA,EAAO1mF,KAAKo5F,EAAe91E,QAAQ3c,IAAIsD,IACvCy8E,EAAO1mF,KAAKi5F,EAAY31E,QAAQ3c,IAAIyyF,GAAgBzyF,IAAIsD,IACxD,MAAMqvF,GAAgB,IAAI3b,mBAAuB6I,cAAcE,GACzD6S,EAAQ,IAAI5b,QAAW2b,EAAeD,GAC5Ch6F,EAAKsH,IAAI4yF,GACTA,EAAM1C,sBACT,CAED,MACM2C,EAAgBzK,GADFnwF,EAAI,GAAK2nF,GACkBjjE,QAE/C,MADgBwpE,EAAYluF,KAAOkuF,GAAaluF,EAAI,GAAK,MACzCk5E,EAAY,CACxB,MAAM2hB,EAAWT,EAAa11E,QACxBojE,EAAS,GACfA,EAAO1mF,KAAKw5F,EAAcl2E,QAAQ3c,IAAIsD,IACtCy8E,EAAO1mF,KAAKi5F,EAAY31E,QAAQ3c,IAAI6yF,GAAe7yF,IAAIsD,IACvD,MAAMyvF,GAAgB,IAAI/b,mBAAuB6I,cAAcE,GACzDiT,EAAQ,IAAIhc,QAAW+b,EAAeD,GAC5Cp6F,EAAKsH,IAAIgzF,GACTA,EAAM9C,sBACT,CAGD,MADgB/J,EAAYluF,KAAOkuF,GAAaluF,EAAI,GAAK,KAAOkuF,GAAaluF,EAAI,GAAK,MACtEk5E,EAAY,CACxB,MAAM8hB,EAAWZ,EAAa11E,QACxBojE,EAAS,GACfA,EAAO1mF,KAAKo5F,EAAe91E,QAAQ3c,IAAI6yF,GAAe7yF,IAAIsD,IAC1Dy8E,EAAO1mF,KAAKi5F,EAAY31E,QAAQ3c,IAAIyyF,GAAgBzyF,IAAI6yF,GAAe7yF,IAAIsD,IAC3E,MAAM4vF,GAAgB,IAAIlc,mBAAuB6I,cAAcE,GACzDoT,EAAQ,IAAInc,QAAWkc,EAAeD,GAC5Cv6F,EAAKsH,IAAImzF,GACTA,EAAMjD,sBACT,CACJ,CACD,OAAOx3F,CACV,CAID06F,OAAOC,EAAaxL,EAAS9oF,GACzB,MAAM7E,EAAI,IAAI88E,WAAc,EAAG,EAAG,GAC5Bn0D,EAAI,IAAIm0D,WAAc,EAAG,EAAG,GAC5Bp+E,EAAI,IAAIo+E,WAAc,EAAG,EAAG,GAC5Bsa,EAAS,GACTgC,EAAY,GAClB,IAAK,IAAIr7F,EAAI,EAAGA,EAAIo7F,EAAY,KAAMp7F,EAClC,IAAK,IAAIa,EAAI,EAAGA,EAAIu6F,EAAY,KAAMv6F,EAClC,IAAK,IAAIC,EAAI,EAAGA,EAAIs6F,EAAY,KAAMt6F,EAClC,GAAW,GAALd,GAAe,GAALa,GAAe,GAALC,EAAS,CAE/B,MAAMw6F,EAAer5F,EAAEyiB,QAAQo+D,eAAe9iF,GACxCu7F,EAAe3wE,EAAElG,QAAQo+D,eAAejiF,GACxC26F,EAAe76F,EAAE+jB,QAAQo+D,eAAehiF,GAE9C,IAAK,IAAIvB,EAAI,EAAGuU,EAAO87E,EAAQ9tF,OAAQvC,EAAIuU,IAAQvU,EAAG,CAClD,MAAMk8F,GAAO,IAAI1c,YAAgBkD,KAAK2N,EAAQrwF,IAC9Ck8F,EAAK1zF,IAAIuzF,GACTG,EAAK1zF,IAAIwzF,GACTE,EAAK1zF,IAAIyzF,GACT,MAAME,EAAS50F,EAAOvH,GACtB85F,EAAOj4F,KAAKq6F,GACZJ,EAAUj6F,KAAKs6F,EAClB,CACJ,CAIb,IAAK,IAAI17F,EAAI,EAAGA,EAAIq5F,EAAOv3F,SAAU9B,EACjC4vF,EAAQxuF,KAAKi4F,EAAOr5F,IACpB8G,EAAO1F,KAAKi6F,EAAUr7F,GAE7B,CAOD24E,OAAkB,IAAbA,IAAa,yDACd,MAAM9xE,EAAMvE,KAAK6sF,UAAL,IACZ,GAAKtoF,EAAInC,MAAKzC,GAAKA,IAAnB,CAIA,GAAI4J,gBAAMvJ,KAAK0tF,GACX,MAAM5tF,MAAM,sCAIhB,GAAIu2E,EAAM,CACN,MAAM1yE,EAAM3D,KAAK2tF,SAAS3tF,KAAKd,WAAW,GAC1C,IAAK,IAAImmF,EAAM1hF,EAAInE,OAAQ9B,EAAI,EAAGA,EAAI2nF,IAAO3nF,EAAG,CAC5C,MAAM27F,EAAW11F,EAAIjG,GACjB6G,EAAI,KACJ80F,EAAS36F,EAAI26F,EAAS36F,EAAI,EAAI,EAAK26F,EAAS36F,EAAI,EAAK26F,EAAS36F,EAAI,GAClE6F,EAAI,KACJ80F,EAAShqC,EAAIgqC,EAAShqC,EAAI,EAAI,EAAKgqC,EAAShqC,EAAI,EAAKgqC,EAAShqC,EAAI,GAClE9qD,EAAI,KACJ80F,EAASnV,EAAImV,EAASnV,EAAI,EAAI,EAAKmV,EAASnV,EAAI,EAAKmV,EAASnV,EAAI,EACzE,CACDlkF,KAAKs5F,aAAa31F,GAAK,EAC1B,MAEG3D,KAAKs5F,aAAat5F,KAAKu5F,mBAAmB,EArB7C,CAuBJ,CAIDD,aAAap6F,GAA+B,yDAEpCc,KAAKytF,YAAYvuF,GAAW,GAEhC,IAAK,IAAIxB,EAAI,EAAG8T,EAAOtS,EAAUM,OAAQ9B,EAAI8T,IAAQ9T,EAAG,CACpD,MAAMmtC,EAAW3rC,EAAUxB,GACdsC,KAAKg3F,QAAQt5F,GACrBmtC,SAAS80C,KAAK90C,EACtB,CACD7qC,KAAKd,UAAYA,CACpB,CAIDs6F,iBAAiBlM,EAAS9oF,EAAQwoF,GAC9B,IAAK,IAAI3H,EAAMiI,EAAQ9tF,OAAQ9B,EAAI,EAAGA,EAAI2nF,IAAO3nF,EAAG,CAChD,MAAM27F,EAAW/L,EAAQ5vF,GACnBk6F,EAAepzF,EAAO9G,GAGtBgB,EAAI26F,EAAS36F,EACb2wD,EAAIgqC,EAAShqC,EACb60B,EAAImV,EAASnV,EACbuV,EAAQz5F,KAAK05F,YAAY,EAAGh7F,EAAGsB,KAAK6tF,aAAa,GAAIb,GACrD2M,EAAQ35F,KAAK05F,YAAY,EAAGrqC,EAAGrvD,KAAK6tF,aAAa,GAAIb,GACrD4M,EAAQ55F,KAAK05F,YAAY,EAAGxV,EAAGlkF,KAAK6tF,aAAa,GAAIb,GACvDyM,GAASE,GAASC,GAClBtM,EAAQxuF,KAAK,IAAI29E,WAAc,EAAG,EAAG,GAAGh3E,IAAI4zF,IAC5C70F,EAAO1F,KAAK84F,GACZtK,EAAQxuF,KAAK,IAAI29E,WAAc,EAAG,EAAG,GAAGh3E,IAAI4zF,IAC5C70F,EAAO1F,KAAK84F,GACZtK,EAAQxuF,KAAK,IAAI29E,WAAc,EAAG,EAAG,GAAGh3E,IAAI4zF,IAC5C70F,EAAO1F,KAAK84F,GACZtK,EAAQxuF,KAAK,IAAI29E,WAAc,EAAG,EAAG,GAAGh3E,IAAI4zF,IAC5C70F,EAAO1F,KAAK84F,GACZtK,EAAQxuF,KAAK,IAAI29E,WAAc,EAAG,EAAG,GAAGh3E,IAAI4zF,IAC5C70F,EAAO1F,KAAK84F,GACZtK,EAAQxuF,KAAK,IAAI29E,WAAc,EAAG,EAAG,GAAGh3E,IAAI4zF,IAC5C70F,EAAO1F,KAAK84F,GACZtK,EAAQxuF,KAAK,IAAI29E,WAAc,EAAG,EAAG,GAAGh3E,IAAI4zF,IAC5C70F,EAAO1F,KAAK84F,IAEP6B,GAASE,IAAUC,GACxBtM,EAAQxuF,KAAK,IAAI29E,WAAc,EAAG,EAAG,GAAGh3E,IAAI4zF,IAC5C70F,EAAO1F,KAAK84F,GACZtK,EAAQxuF,KAAK,IAAI29E,WAAc,EAAG,EAAG,GAAGh3E,IAAI4zF,IAC5C70F,EAAO1F,KAAK84F,GACZtK,EAAQxuF,KAAK,IAAI29E,WAAc,EAAG,EAAG,GAAGh3E,IAAI4zF,IAC5C70F,EAAO1F,KAAK84F,KAEN6B,GAASE,GAASC,GACxBtM,EAAQxuF,KAAK,IAAI29E,WAAc,EAAG,EAAG,GAAGh3E,IAAI4zF,IAC5C70F,EAAO1F,KAAK84F,GACZtK,EAAQxuF,KAAK,IAAI29E,WAAc,EAAG,EAAG,GAAGh3E,IAAI4zF,IAC5C70F,EAAO1F,KAAK84F,GACZtK,EAAQxuF,KAAK,IAAI29E,WAAc,EAAG,EAAG,GAAGh3E,IAAI4zF,IAC5C70F,EAAO1F,KAAK84F,IAEP6B,IAAUE,GAASC,GACxBtM,EAAQxuF,KAAK,IAAI29E,WAAc,EAAG,EAAG,GAAGh3E,IAAI4zF,IAC5C70F,EAAO1F,KAAK84F,GACZtK,EAAQxuF,KAAK,IAAI29E,WAAc,EAAG,EAAG,GAAGh3E,IAAI4zF,IAC5C70F,EAAO1F,KAAK84F,GACZtK,EAAQxuF,KAAK,IAAI29E,WAAc,EAAG,EAAG,GAAGh3E,IAAI4zF,IAC5C70F,EAAO1F,KAAK84F,KAEP6B,GAAUE,GAAUC,EAInBH,IAASE,GAAUC,EAInBH,GAAUE,IAASC,IACzBtM,EAAQxuF,KAAK,IAAI29E,WAAc,EAAG,EAAG,GAAGh3E,IAAI4zF,IAC5C70F,EAAO1F,KAAK84F,KALZtK,EAAQxuF,KAAK,IAAI29E,WAAc,EAAG,EAAG,GAAGh3E,IAAI4zF,IAC5C70F,EAAO1F,KAAK84F,KALZtK,EAAQxuF,KAAK,IAAI29E,WAAc,EAAG,EAAG,GAAGh3E,IAAI4zF,IAC5C70F,EAAO1F,KAAK84F,GAUnB,CACJ,CAODhK,YAAY1uF,EAAWsF,EAAQD,GAA8B,IAAzBs1F,IAAyB,yDAANxjB,EAAM,uCAEzDr2E,KAAKmsF,YAAYtyE,UAAU7Z,KAAKmsF,YAAY57E,UAC5CvQ,KAAK89C,SAAW,CAAC,EACjB99C,KAAKuqF,UAAY,GACjBvqF,KAAKwqF,aAAe,GAEhBjmF,EAAInC,MAAKzC,IAAoB,IAANA,MACnBk6F,GAA4B,aAAdxjB,EAAKp1E,KACnBjB,KAAKw5F,iBAAiBt6F,EAAWsF,EAAQ6xE,EAAK2W,WAEzC6M,GAAc9zF,MAAMoR,QAAQk/D,IACjCr2E,KAAK64F,OAAOxiB,EAAMn3E,EAAWsF,IAIrC,MAAMs1F,EAAgB,GACtB,IAAK,MAAMn2F,KAAOzE,EAAW,CACzB,MAAM66F,EAAY,IAAItd,WAClBod,GACAE,EAAUt0F,IAAIzF,KAAK6tF,aAAa,GAAGzrE,QAAQo+D,eAAe78E,EAAIjF,IAC9Dq7F,EAAUt0F,IAAIzF,KAAK6tF,aAAa,GAAGzrE,QAAQo+D,eAAe78E,EAAI0rD,IAC9D0qC,EAAUt0F,IAAIzF,KAAK6tF,aAAa,GAAGzrE,QAAQo+D,eAAe78E,EAAIugF,KAG9D6V,EAAUpa,KAAKh8E,GAEnBm2F,EAAch7F,KAAKi7F,EACtB,CAED/5F,KAAKd,UAAY46F,EACjB95F,KAAKu5F,kBAAoBO,EAAc38F,KAAIuB,GAAKA,EAAE0jB,UAClDpiB,KAAKitF,cAAgBzoF,EAErB,IAAK,MAAMozF,KAAgBpzF,EAAQ,CAC/B,MAAMw1F,EAAch6F,KAAK2qF,aAAaiN,GACtC53F,KAAK89C,SAASk8C,GAAe,CAACh6F,KAAKgrF,WAAW4M,GAAe53F,KAAK8qF,cAAc8M,GACnF,CACJ,CAKD8B,YAAY/wE,EAAQsxE,EAAYlC,EAAa/K,GACzC,MAAMkN,EAAeD,EAAatxE,EAElC,OADoBrrB,KAAKK,IAAIo6F,EAAY31E,QAAQo+D,eAAe0Z,GAAa16F,UAC3DwtF,CAMrB,CAODiD,QAAQvyF,EAAGa,EAAG6oF,EAAMC,EAAM0H,EAAcllF,GAEpC,MAAMy9E,EAASz9E,EAAQy9E,OACjB6S,EAActwF,EAAQwhF,WACtB9D,EAAYjqF,KAAK88F,KAAK,KAAO,IAAMD,IACnCE,EAAWr6F,KAAKmnF,eAAeC,EAAMC,EAAMC,EAAQC,EAAWwH,GACpEsL,EAASr3F,KAAO,OAChBhD,KAAKsqF,UAAUxrF,KAAKu7F,GAEpB,MAAMvhD,EAAQ,IAAI2jC,SAIlB,GAHA3jC,EAAM91C,KAAO,OAAStF,EAAI,IAAMa,EAChCu6C,EAAMrzC,IAAI40F,GAENxwF,EAAQuhF,QAAQxP,QAAS,CACzB,MACM1zD,EADWre,EAAQuhF,QAAQ55E,KACR81E,EAAS,EAC5BgT,EAAkB,IAAI7d,qBAAwB,CAAEprE,MAAOxH,EAAQuhF,QAAQ/5E,MAAOkpF,KAAM9d,cACpF2O,EAAUprF,KAAKmnF,eAAeC,EAAMC,EAAMn/D,EAAQo/D,EAAQ,GAAIgT,GACpElP,EAAQpoF,KAAO,UACf81C,EAAMrzC,IAAI2lF,EACb,CACDprF,KAAKosF,YAAY3mF,IAAIqzC,EACxB,CAODg2C,WAAWnvE,EAAOrW,EAAQqlF,GACtB,IAAI0B,EAAIC,EAIR,MAAMsH,EAAe53F,KAAKitF,cAActtE,GAClCkrB,EAAW7qC,KAAKd,UAAUygB,GAC1BsP,EAAO,GAAH,OAAM0/D,EAAN,YAAoBiJ,GACxB4C,EAAOx6F,KAAKkqF,QAAQj7D,GAC1B,GAAI1lB,gBAAMixF,GAAO,CACbx6F,KAAKkqF,QAAQj7D,GAAQ,CAAC,EAEtB,MAAMwrE,EAAez6F,KAAK06F,mBAAmBpxF,EAAQsuF,GAC/C+C,EAAe36F,KAAK46F,mBAAmBtxF,EAAQsuF,GAC/C3/E,EAAO,IAAIwkE,QAAWge,EAAcE,GAG1C,GAFA36F,KAAKkqF,QAAQj7D,GAAMhX,KAAOA,EAEoD,QAAzEo4E,EAAgB,OAAX/mF,QAA8B,IAAXA,OAAoB,EAASA,EAAO8hF,eAA4B,IAAPiF,OAAgB,EAASA,EAAGzU,QAAS,CACvH,MAAMif,EAAkB76F,KAAK86F,0BAA0BxxF,EAAQsuF,GACzD0C,EAAkBt6F,KAAK+6F,0BAA0BzxF,GACjD8hF,EAAU,IAAI3O,QAAWoe,EAAiBP,GAChDt6F,KAAKkqF,QAAQj7D,GAAMm8D,QAAUA,CAChC,CACJ,CAED,MAAM4P,EAAYh7F,KAAKmsF,YAAYuK,gBAAjB,cAAwC/2E,IACrDpW,gBAAMyxF,IACPA,EAAUC,mBAGd,MAAMC,EAAQl7F,KAAKkqF,QAAQj7D,GACrBksE,EAAW,IAAI1e,WACrB0e,EAASxb,KAAK90C,GAEd,MAAMiO,EAAQ,IAAI2jC,SAClB3jC,EAAM91C,KAAO,OAAS2c,EACtB,MAAM1H,EAAOijF,EAAK,KAAS94E,QAG3B,GAFAnK,EAAKjV,KAAO,OACZ81C,EAAMrzC,IAAIwS,GACoE,QAAzEq4E,EAAgB,OAAXhnF,QAA8B,IAAXA,OAAoB,EAASA,EAAO8hF,eAA4B,IAAPkF,OAAgB,EAASA,EAAG1U,QAAS,CACvH,MAAMwP,EAAU8P,EAAK,QAAY94E,QACjCpiB,KAAKwqF,aAAa1rF,KAAKssF,GACvBA,EAAQpoF,KAAO,UACf81C,EAAMrzC,IAAI2lF,EACb,CACDtyC,EAAMjO,SAAS80C,KAAKwb,GACpBn7F,KAAKmsF,YAAY1mF,IAAIqzC,GACrB94C,KAAKuqF,UAAUzrF,KAAKmZ,EACvB,CACDyiF,mBAAmBpxF,EAAQsuF,GAGvB,MAAMtQ,EAA2B,aAAlBh+E,EAAOg+E,OAChBtnF,KAAKotF,SAASwK,GACdtuF,EAAOg+E,OACP8T,EAAe9xF,EAAO4e,MAAQo/D,EAC9B6S,EAAc7wF,EAAO+hF,WACrB9D,EAAYjqF,KAAK88F,KAAK,KAAO,IAAMD,IAEzC,OADqB,IAAI1d,kBAAqB2e,EAAc7T,EAAWA,EAE1E,CACDqT,mBAAmBtxF,EAAQsuF,GACvB,IAAIvH,EAAIC,EAAIC,EACZ,IAAIoK,EACJ,MAAMtpF,EAAQrR,KAAK63F,SAASvuF,EAAQsuF,GACpC,QAA8H72F,KAA9C,QAA1EsvF,EAAgB,OAAX/mF,QAA8B,IAAXA,OAAoB,EAASA,EAAOugB,gBAA6B,IAAPwmE,OAAgB,EAASA,EAAGrB,MAAqB,CACrI,MAAMC,EAAwI,QAA9HsB,EAAgF,QAA1ED,EAAgB,OAAXhnF,QAA8B,IAAXA,OAAoB,EAASA,EAAOugB,gBAA6B,IAAPymE,OAAgB,EAASA,EAAGtB,YAAyB,IAAPuB,OAAgB,EAASA,EAAGrB,MAC5KlnC,EAAS,IAAImnC,WAAWF,GAC9B,IAAK,IAAI5wF,EAAI,EAAGA,GAAK4wF,EAAQ5wF,IACzB2pD,EAAO3pD,GAAMA,EAAI4wF,EAAU,IAE/B,MAAMG,EAAc,IAAI3S,eAAkBz0B,EAAQA,EAAOxoD,OAAQ,EAAGi9E,oBACpE2S,EAAYC,UAAY5S,iBACxB2S,EAAYE,UAAY7S,iBACxB2S,EAAYG,iBAAkB,EAC9BoL,EAAe,IAAIle,oBAAuB,CACtCprE,MAAOA,EACP+9E,YAAaA,GAEpB,MAEGuL,EAAe,IAAIle,qBAAwB,CACvCprE,MAAOA,EACP85E,UAAW7hF,EAAOugB,SAASqhE,MAAMC,UACjCx/C,QAASriC,EAAOqiC,QAChB+oD,YAAgC,IAAnBprF,EAAOqiC,UAG5B,OAAOgvD,CACV,CACDG,0BAA0BxxF,EAAQsuF,GAC9B,IAAIvH,EACJ,MAAM/I,EAA2B,aAAlBh+E,EAAOg+E,OAChBtnF,KAAKotF,SAASwK,GACdtuF,EAAOg+E,OACP8T,EAAe9xF,EAAO4e,MAAQo/D,EAE9Bp/D,GADqF,QAAzEmoE,EAAgB,OAAX/mF,QAA8B,IAAXA,OAAoB,EAASA,EAAO8hF,eAA4B,IAAPiF,OAAgB,EAASA,EAAG7+E,MACtG4pF,EAAe,EAClCjB,EAAc7wF,EAAO+hF,WACrB9D,EAAYjqF,KAAK88F,KAAK,KAAO,IAAMD,IACzC,OAAO,IAAI1d,kBAAqB2e,EAAelzE,EAAOq/D,EAAWA,EACpE,CACDwT,0BAA0BzxF,GACtB,IAAI+mF,EACJ,OAAO,IAAI5T,qBAAwB,CAC/BprE,MAAiF,QAAzEg/E,EAAgB,OAAX/mF,QAA8B,IAAXA,OAAoB,EAASA,EAAO8hF,eAA4B,IAAPiF,OAAgB,EAASA,EAAGh/E,MACrHkpF,KAAM9d,YACN9wC,QAASriC,EAAOqiC,QAChB+oD,YAAgC,IAAnBprF,EAAOqiC,SAE3B,CAKDr7B,SACI,MAAMma,EAASzqB,KAAK4jF,YACd+B,EAAcl7D,EAAOyiC,YACrB04B,EAAen7D,EAAO2qD,aAItB12E,EAAI,IAAI+9E,WAAc,EAAG,EAAG,GAC5B1zE,EAAS,IAAI0zE,WAAc,EAAG,EAAG,GACjC4e,EAAU,CAAC38F,EAAGqK,GACpB,IAAK,IAAIrL,EAAI,EAAGA,EAAI29F,EAAQ77F,SAAU9B,EAAG,CACrC,MAAM49F,EAAMD,EAAQ39F,GACpBsC,KAAKikF,OAAOiS,aAAaoF,GACzBA,EAAItV,QAAQhmF,KAAKikF,QACjBqX,EAAI58F,EAAIpB,KAAK2oF,OAAOqV,EAAI58F,EAAI,GAAKinF,EAAc,GAC/C2V,EAAIjsC,EAAI/xD,KAAK2oF,OAAgB,EAARqV,EAAIjsC,GAASu2B,EAAe,EACpD,CACD,MACMv9D,GADe,IAAIo0D,YAAgBgE,WAAW13E,EAAQrK,GAC9Bc,SACxB0oB,EAAQ,EAAQ5qB,KAAKwpB,IAAIuB,EAAU,IACzC,QAAwBtnB,IAApBf,KAAKyqF,WACL,IAAK,IAAI/sF,EAAI,EAAGA,EAAIsC,KAAKyqF,WAAWjrF,SAAU9B,EAAG,CAC/BsC,KAAKyqF,WAAW/sF,GACxBwqB,MAAM5O,IAAI4O,EAAOA,EAAO,EACjC,CAELlZ,MAAMsB,QACT,CAQDirF,eAAeC,EAAeC,GAC1B,MAAMC,EAAYF,EAAch8F,SAEhC,OADmBlC,KAAK03C,IAAI13C,KAAK6E,MAAMs5F,EAAaC,GAAa,EAAG,EAEvE,EC9yDL,MAAMC,GACF7sF,YAAY8sF,EAAQC,GAChB77F,KAAK47F,OAAS,KACd57F,KAAKk5D,KAAO,KACZl5D,KAAK6f,KAAO,KACZ7f,KAAK87F,KAAO,KACZ97F,KAAK67F,KAAO,KACZ77F,KAAK47F,OAASA,EACd57F,KAAK67F,KAAOA,CACf,CACDE,OACI,OAAO/7F,KAAK47F,MACf,CACDI,OACI,OAAOh8F,KAAKk5D,KAAOl5D,KAAKk5D,KAAK0iC,OAAS,IACzC,CACDp8F,SACI,MAAMu8F,EAAO/7F,KAAK+7F,OACZC,EAAOh8F,KAAKg8F,OAClB,OAAa,OAATA,EACOA,EAAKC,MAAMC,WAAWH,EAAKE,QAE9B,CACX,CACDE,gBACI,MAAMJ,EAAO/7F,KAAK+7F,OACZC,EAAOh8F,KAAKg8F,OAClB,OAAa,OAATA,EACOA,EAAKC,MAAMpb,kBAAkBkb,EAAKE,QAErC,CACX,CACDG,QAAQvU,GAGJ,OAFA7nF,KAAK87F,KAAOjU,EACZA,EAAKiU,KAAO97F,KACLA,IACV,EAEL,MAAMq8F,GACFvtF,YAAYnP,EAAG2oB,EAAGjqB,GACd2B,KAAKq1F,OAAS,IAAI5Y,WAClBz8E,KAAKs8F,SAAW,IAAI7f,WACpBz8E,KAAKu8F,KAAO,EACZv8F,KAAKw8F,SAAW,EAChBx8F,KAAKy8F,QAAU,KACfz8F,KAAK08F,KA/CG,EAgDR18F,KAAK6nF,KAAO,KACZ,IAAI8U,EAAK,IAAIhB,GAASh8F,EAAGK,MACrB48F,EAAK,IAAIjB,GAASrzE,EAAGtoB,MACrB68F,EAAK,IAAIlB,GAASt9F,EAAG2B,MAEzB28F,EAAG98E,KAAOg9E,EAAG3jC,KAAO0jC,EACpBA,EAAG/8E,KAAO88E,EAAGzjC,KAAO2jC,EACpBA,EAAGh9E,KAAO+8E,EAAG1jC,KAAOyjC,EAEpB38F,KAAK6nF,KAAO8U,EACZ38F,KAAK88F,SACR,CACDC,QAAQr/F,GAEJ,IADA,IAAImqF,EAAO7nF,KAAK6nF,KACTnqF,EAAI,GACPmqF,EAAOA,EAAKhoE,KACZniB,IAEJ,KAAOA,EAAI,GACPmqF,EAAOA,EAAK3uB,KACZx7D,IAEJ,OAAOmqF,CACV,CACDiV,UACI,IAAIE,OACaj8F,IAAbi8F,IACAA,EAAW,IAAIvgB,aACnB,IAAI98E,EAAIK,KAAK6nF,KAAKmU,OACd1zE,EAAItoB,KAAK6nF,KAAKkU,OACd19F,EAAI2B,KAAK6nF,KAAKhoE,KAAKk8E,OAMvB,OALAiB,EAAS1jF,IAAI3Z,EAAEs8F,MAAO3zE,EAAE2zE,MAAO59F,EAAE49F,OACjCe,EAASC,UAAUj9F,KAAKq1F,QACxB2H,EAASE,YAAYl9F,KAAKs8F,UAC1Bt8F,KAAKu8F,KAAOS,EAASG,UACrBn9F,KAAKw8F,SAAWx8F,KAAKq1F,OAAOt4F,IAAIiD,KAAKs8F,UAC9Bt8F,IACV,CACDo9F,gBAAgBnB,GACZ,OAAOj8F,KAAKq1F,OAAOt4F,IAAIk/F,GAASj8F,KAAKw8F,QACxC,EAEE,MAAMa,GAAc,WACvB,IACI72F,EAAK,IAAIi2E,WACb,SAAS4gB,IACLr9F,KAAKgtF,WAAa,EAClBhtF,KAAKs9F,MAAQ,GACbt9F,KAAKu9F,SAAW,GAWhBv9F,KAAKw9F,SAAW,IAAIC,EACpBz9F,KAAK09F,WAAa,IAAID,EACtBz9F,KAAKolF,SAAW,EACnB,CAseD,SAASuY,EAAW1B,GAChBj8F,KAAKi8F,MAAQA,EACbj8F,KAAKk5D,KAAO,KACZl5D,KAAK6f,KAAO,KACZ7f,KAAK67F,KAAO,IACf,CAED,SAAS4B,IACLz9F,KAAK+7F,KAAO,KACZ/7F,KAAKg8F,KAAO,IACf,CAuGD,OAtlBAtyF,OAAOqzB,OAAOsgE,EAAWt6F,UAAW,CAChCuiF,cAAe,SAAUE,IACS,IAA1Bz/E,MAAMoR,QAAQquE,IACdx1E,QAAQP,MAAM,uDAEd+1E,EAAOhmF,OAAS,GAChBwQ,QAAQP,MAAM,+DAElBzP,KAAK49F,YACL,IAAK,IAAIlgG,EAAI,EAAGT,EAAIuoF,EAAOhmF,OAAQ9B,EAAIT,EAAGS,IACtCsC,KAAKolF,SAAStmF,KAAK,IAAI6+F,EAAWnY,EAAO9nF,KAG7C,OADAsC,KAAK88F,UACE98F,IACV,EACD69F,cAAe,SAAU5uC,GACrB,IAAIu2B,EAAS,GA0Bb,OAzBAv2B,EAAOy2B,mBAAkB,GACzBz2B,EAAOjlB,UAAS,SAAUzU,GACtB,IAAI73B,EAAGT,EAAGg/F,EACN6B,EAAWvoE,EAAKuoE,SACpB,QAAiB/8F,IAAb+8F,EACA,GAAIA,EAASC,WAAY,CACrB,IAAI3Y,EAAW0Y,EAAS1Y,SACxB,IAAK1nF,EAAI,EAAGT,EAAImoF,EAAS5lF,OAAQ9B,EAAIT,EAAGS,KACpCu+F,EAAQ7W,EAAS1nF,GAAG0kB,SACd47E,aAAazoE,EAAK0oE,aACxBzY,EAAO1mF,KAAKm9F,EAEnB,MACI,GAAI6B,EAASI,iBAAkB,CAChC,IAAIp3D,EAAYg3D,EAAS36D,WAAW0H,SACpC,QAAkB9pC,IAAd+lC,EACA,IAAKppC,EAAI,EAAGT,EAAI6pC,EAAUnZ,MAAOjwB,EAAIT,EAAGS,KACpCu+F,EAAQ,IAAIxf,YACN0hB,oBAAoBr3D,EAAWppC,GAAGsgG,aAAazoE,EAAK0oE,aAC1DzY,EAAO1mF,KAAKm9F,EAGvB,CAER,IACMj8F,KAAKslF,cAAcE,EAC7B,EACD4Y,cAAe,SAAUnC,GAErB,IADA,IAAIqB,EAAQt9F,KAAKs9F,MACR5/F,EAAI,EAAGT,EAAIqgG,EAAM99F,OAAQ9B,EAAIT,EAAGS,IAAK,CAG1C,GAFW4/F,EAAM5/F,GAER0/F,gBAAgBnB,GAASj8F,KAAKgtF,UACnC,OAAO,CACd,CACD,OAAO,CACV,EACDqR,aAAc,SAAUC,EAAK31E,GAKzB,IAHA,IAAI20E,EAAQt9F,KAAKs9F,MACbiB,GAASnvC,IACTovC,EAAOpvC,IACF1xD,EAAI,EAAGT,EAAIqgG,EAAM99F,OAAQ9B,EAAIT,EAAGS,IAAK,CAC1C,IAAIm+F,EAAOyB,EAAM5/F,GAEb+gG,EAAK5C,EAAKuB,gBAAgBkB,EAAIv1F,QAC9B21F,EAAK7C,EAAKxG,OAAOt4F,IAAIuhG,EAAI/rD,WAG7B,GAAIksD,EAAK,GAAKC,GAAM,EAChB,OAAO,KAEX,IAAI52F,EAAY,IAAP42F,GAAcD,EAAKC,EAAM,EAGlC,KAAI52F,GAAK,KAGL42F,EAAK,EAELF,EAAOlhG,KAAK+J,IAAIS,EAAG02F,GAInBD,EAAQjhG,KAAK03C,IAAIltC,EAAGy2F,GAEpBA,EAAQC,GAER,OAAO,IAEd,CASD,OANID,KAAWnvC,IACXkvC,EAAIK,GAAGJ,EAAO51E,GAGd21E,EAAIK,GAAGH,EAAM71E,GAEVA,CACV,EACDi2E,cAAe,SAAUN,GACrB,OAAsC,OAA/Bt+F,KAAKq+F,aAAaC,EAAK93F,EACjC,EACDo3F,UAAW,WAGP,OAFA59F,KAAKs9F,MAAQ,GACbt9F,KAAKolF,SAAW,GACTplF,IACV,EAED6+F,gBAAiB,SAAUjD,EAAQC,GAS/B,OARAD,EAAOC,KAAOA,EACO,OAAjBA,EAAKY,QACLz8F,KAAKw9F,SAASsB,OAAOlD,GAGrB57F,KAAKw9F,SAASuB,aAAalD,EAAKY,QAASb,GAE7CC,EAAKY,QAAUb,EACR57F,IACV,EAEDg/F,qBAAsB,SAAUpD,EAAQC,GAapC,OAZID,IAAWC,EAAKY,UAEI,OAAhBb,EAAO/7E,MAAiB+7E,EAAO/7E,KAAKg8E,OAASA,EAE7CA,EAAKY,QAAUb,EAAO/7E,KAItBg8E,EAAKY,QAAU,MAGvBz8F,KAAKw9F,SAAS3jF,OAAO+hF,GACd57F,IACV,EAEDi/F,0BAA2B,SAAUpD,GACjC,GAAqB,OAAjBA,EAAKY,QAAkB,CAIvB,IAFA,IAAInhG,EAAQugG,EAAKY,QACblhG,EAAMsgG,EAAKY,QACK,OAAblhG,EAAIskB,MAAiBtkB,EAAIskB,KAAKg8E,OAASA,GAC1CtgG,EAAMA,EAAIskB,KAMd,OAJA7f,KAAKw9F,SAAS0B,cAAc5jG,EAAOC,GAEnCD,EAAM49D,KAAO39D,EAAIskB,KAAO,KACxBg8E,EAAKY,QAAU,KACRnhG,CACV,CACJ,EAED6jG,mBAAoB,SAAUtD,EAAMuD,GAChC,IAAIC,EAAer/F,KAAKi/F,0BAA0BpD,GAClD,QAAqB96F,IAAjBs+F,EACA,QAAsBt+F,IAAlBq+F,EAEAp/F,KAAK09F,WAAW4B,YAAYD,OAE3B,CAED,IAAIzD,EAASyD,EACb,EAAG,CAGC,IAAIE,EAAa3D,EAAO/7E,KACTu/E,EAAchC,gBAAgBxB,EAAOK,OAErCj8F,KAAKgtF,UAChBhtF,KAAK6+F,gBAAgBjD,EAAQwD,GAG7Bp/F,KAAK09F,WAAWoB,OAAOlD,GAG3BA,EAAS2D,CACZ,OAAmB,OAAX3D,EACZ,CAEL,OAAO57F,IACV,EAEDw/F,wBAAyB,SAAUjC,GAC/B,IAAkC,IAA9Bv9F,KAAK09F,WAAW/oE,UAAqB,CACrC,IAAIinE,EAAS57F,KAAK09F,WAAW+B,QAC7B,EAAG,CAKC,IAHA,IAAIF,EAAa3D,EAAO/7E,KACpB08D,EAAcv8E,KAAKgtF,UACnB0S,EAAU,KACLhiG,EAAI,EAAGA,EAAI6/F,EAAS/9F,OAAQ9B,IAAK,CACtC,IAAIm+F,EAAO0B,EAAS7/F,GACpB,GA9SR,IA8SYm+F,EAAKa,KAAkB,CACvB,IAAIr0E,EAAWwzE,EAAKuB,gBAAgBxB,EAAOK,OAK3C,GAJI5zE,EAAWk0D,IACXA,EAAcl0D,EACdq3E,EAAU7D,GAEVtf,EAAc,IAAOv8E,KAAKgtF,UAC1B,KACP,CACJ,CAEe,OAAZ0S,GACA1/F,KAAK6+F,gBAAgBjD,EAAQ8D,GAEjC9D,EAAS2D,CACZ,OAAmB,OAAX3D,EACZ,CACD,OAAO57F,IACV,EAED2/F,gBAAiB,WACb,IAIIjiG,EAAGT,EAAGsB,EAJN8I,EAAM,IAAIo1E,WACVznC,EAAM,IAAIynC,WACVmjB,EAAc,GACdC,EAAc,GAGlB,IAAKniG,EAAI,EAAGA,EAAI,EAAGA,IACfkiG,EAAYliG,GAAKmiG,EAAYniG,GAAKsC,KAAKolF,SAAS,GAKpD,IAHA/9E,EAAIs4E,KAAK3/E,KAAKolF,SAAS,GAAG6W,OAC1BjnD,EAAI2qC,KAAK3/E,KAAKolF,SAAS,GAAG6W,OAErBv+F,EAAI,EAAGT,EAAI+C,KAAKolF,SAAS5lF,OAAQ9B,EAAIT,EAAGS,IAAK,CAC9C,IAAIk+F,EAAS57F,KAAKolF,SAAS1nF,GACvBu+F,EAAQL,EAAOK,MAEnB,IAAK19F,EAAI,EAAGA,EAAI,EAAGA,IACX09F,EAAM6D,aAAavhG,GAAK8I,EAAIy4F,aAAavhG,KACzC8I,EAAI04F,aAAaxhG,EAAG09F,EAAM6D,aAAavhG,IACvCqhG,EAAYrhG,GAAKq9F,GAIzB,IAAKr9F,EAAI,EAAGA,EAAI,EAAGA,IACX09F,EAAM6D,aAAavhG,GAAKy2C,EAAI8qD,aAAavhG,KACzCy2C,EAAI+qD,aAAaxhG,EAAG09F,EAAM6D,aAAavhG,IACvCshG,EAAYthG,GAAKq9F,EAG5B,CAKD,OAHA57F,KAAKgtF,UAAY,EAAI5hE,OAAO40E,SAAW1iG,KAAK03C,IAAI13C,KAAKK,IAAI0J,EAAI3I,GAAIpB,KAAKK,IAAIq3C,EAAIt2C,IAC1EpB,KAAK03C,IAAI13C,KAAKK,IAAI0J,EAAIgoD,GAAI/xD,KAAKK,IAAIq3C,EAAIqa,IACvC/xD,KAAK03C,IAAI13C,KAAKK,IAAI0J,EAAI68E,GAAI5mF,KAAKK,IAAIq3C,EAAIkvC,KACpC,CAAE78E,IAAKu4F,EAAa5qD,IAAK6qD,EACnC,EAGDI,mBAAoB,WAChB,IAAIxH,EAAOyH,EAAOC,EAClB,OAAO,gBACWp/F,IAAV03F,IACAA,EAAQ,IAAIhc,SACZyjB,EAAQ,IAAIzjB,SACZ0jB,EAAe,IAAI1jB,YAEvB,IAAImf,EAIAwE,EAAI55F,EAAIC,EAAI45F,EACZ3iG,EAAGT,EAAGsB,EAKN8pB,EAVQ+8D,EAAWplF,KAAKolF,SACxBkb,EAAWtgG,KAAK2/F,kBAChBt4F,EAAMi5F,EAASj5F,IACf2tC,EAAMsrD,EAAStrD,IAOLunC,EAAc,EACxB58D,EAAQ,EACZ,IAAKjiB,EAAI,EAAGA,EAAI,EAAGA,KACf2qB,EAAW2sB,EAAIt3C,GAAGu+F,MAAM6D,aAAapiG,GAAK2J,EAAI3J,GAAGu+F,MAAM6D,aAAapiG,IACrD6+E,IACXA,EAAcl0D,EACd1I,EAAQjiB,GAQhB,IALA0iG,EAAK/4F,EAAIsY,GACTnZ,EAAKwuC,EAAIr1B,GAET48D,EAAc,EACdkc,EAAMn/E,IAAI8mF,EAAGnE,MAAOz1F,EAAGy1F,OAClBv+F,EAAI,EAAGT,EAAI+C,KAAKolF,SAAS5lF,OAAQ9B,EAAIT,EAAGS,KACzCk+F,EAASxW,EAAS1nF,MACH0iG,GAAMxE,IAAWp1F,IAC5BiyF,EAAM8H,oBAAoB3E,EAAOK,OAAO,EAAMkE,IAC9C93E,EAAW83E,EAAatf,kBAAkB+a,EAAOK,QAClC1f,IACXA,EAAcl0D,EACd5hB,EAAKm1F,IAOjB,IAFArf,GAAe,EACf2jB,EAAMM,sBAAsBJ,EAAGnE,MAAOz1F,EAAGy1F,MAAOx1F,EAAGw1F,OAC9Cv+F,EAAI,EAAGT,EAAI+C,KAAKolF,SAAS5lF,OAAQ9B,EAAIT,EAAGS,KACzCk+F,EAASxW,EAAS1nF,MACH0iG,GAAMxE,IAAWp1F,GAAMo1F,IAAWn1F,IAC7C4hB,EAAW/qB,KAAKK,IAAIuiG,EAAM9C,gBAAgBxB,EAAOK,SAClC1f,IACXA,EAAcl0D,EACdg4E,EAAKzE,GAIjB,IAAI0B,EAAQ,GACZ,GAAI4C,EAAM9C,gBAAgBiD,EAAGpE,OAAS,EAIlC,IAFAqB,EAAMx+F,KAAK,IAAIu9F,GAAK+D,EAAI55F,EAAIC,GAAK,IAAI41F,GAAKgE,EAAI75F,EAAI45F,GAAK,IAAI/D,GAAKgE,EAAI55F,EAAID,GAAK,IAAI61F,GAAKgE,EAAID,EAAI35F,IAEzF/I,EAAI,EAAGA,EAAI,EAAGA,IACfa,GAAKb,EAAI,GAAK,EAEd4/F,EAAM5/F,EAAI,GAAGq/F,QAAQ,GAAGX,QAAQkB,EAAM,GAAGP,QAAQx+F,IAEjD++F,EAAM5/F,EAAI,GAAGq/F,QAAQ,GAAGX,QAAQkB,EAAM/+F,EAAI,GAAGw+F,QAAQ,SAOzD,IAFAO,EAAMx+F,KAAK,IAAIu9F,GAAK+D,EAAI35F,EAAID,GAAK,IAAI61F,GAAKgE,EAAID,EAAI55F,GAAK,IAAI61F,GAAKgE,EAAI75F,EAAIC,GAAK,IAAI41F,GAAKgE,EAAI55F,EAAI25F,IAEzF1iG,EAAI,EAAGA,EAAI,EAAGA,IACfa,GAAKb,EAAI,GAAK,EAEd4/F,EAAM5/F,EAAI,GAAGq/F,QAAQ,GAAGX,QAAQkB,EAAM,GAAGP,SAAS,EAAIr/F,GAAK,IAE3D4/F,EAAM5/F,EAAI,GAAGq/F,QAAQ,GAAGX,QAAQkB,EAAM/+F,EAAI,GAAGw+F,QAAQ,IAI7D,IAAKr/F,EAAI,EAAGA,EAAI,EAAGA,IACfsC,KAAKs9F,MAAMx+F,KAAKw+F,EAAM5/F,IAG1B,IAAKA,EAAI,EAAGT,EAAImoF,EAAS5lF,OAAQ9B,EAAIT,EAAGS,IAEpC,IADAk+F,EAASxW,EAAS1nF,MACH0iG,GAAMxE,IAAWp1F,GAAMo1F,IAAWn1F,GAAMm1F,IAAWyE,EAAI,CAClE9jB,EAAcv8E,KAAKgtF,UACnB,IAAI0S,EAAU,KACd,IAAKnhG,EAAI,EAAGA,EAAI,EAAGA,KACf8pB,EAAWroB,KAAKs9F,MAAM/+F,GAAG6+F,gBAAgBxB,EAAOK,QACjC1f,IACXA,EAAcl0D,EACdq3E,EAAU1/F,KAAKs9F,MAAM/+F,IAGb,OAAZmhG,GACA1/F,KAAK6+F,gBAAgBjD,EAAQ8D,EAEpC,CAEL,OAAO1/F,IACV,CACJ,CAzGmB,GA2GpBygG,aAAc,WAEV,IADA,IAAIC,EAAc,GACThjG,EAAI,EAAGA,EAAIsC,KAAKs9F,MAAM99F,OAAQ9B,IAAK,CACxC,IAAIm+F,EAAO77F,KAAKs9F,MAAM5/F,GAvdtB,IAwdIm+F,EAAKa,MACLgE,EAAY5hG,KAAK+8F,EAExB,CAED,OADA77F,KAAKs9F,MAAQoD,EACN1gG,IACV,EAED2gG,gBAAiB,WAEb,IAAgC,IAA5B3gG,KAAKw9F,SAAS7oE,UAAqB,CACnC,IAAIisE,EAAWrkB,EAAc,EAEzBskB,EAAU7gG,KAAKw9F,SAASiC,QAAQ5D,KAChCD,EAASiF,EAAQpE,QAErB,EAAG,CACC,IAAIp0E,EAAWw4E,EAAQzD,gBAAgBxB,EAAOK,OAC1C5zE,EAAWk0D,IACXA,EAAcl0D,EACdu4E,EAAYhF,GAEhBA,EAASA,EAAO/7E,IACnB,OAAmB,OAAX+7E,GAAmBA,EAAOC,OAASgF,GAC5C,OAAOD,CACV,CACJ,EAIDE,eAAgB,SAAUC,EAAUC,EAAWnF,EAAMoF,GAIjD,IAAIpZ,EAFJ7nF,KAAKm/F,mBAAmBtD,GACxBA,EAAKa,KA9ZC,EAiaF7U,EADc,OAAdmZ,EACOA,EAAYnF,EAAKkB,QAAQ,GAKzBiE,EAAUnhF,KAErB,EAAG,CACC,IAAIqhF,EAAWrZ,EAAKiU,KAChBqF,EAAeD,EAASrF,KArgB5B,IAsgBIsF,EAAazE,OACTyE,EAAa/D,gBAAgB2D,GAAY/gG,KAAKgtF,UAE9ChtF,KAAK8gG,eAAeC,EAAUG,EAAUC,EAAcF,GAItDA,EAAQniG,KAAK+oF,IAGrBA,EAAOA,EAAKhoE,IACf,OAAQgoE,IAASmZ,GAClB,OAAOhhG,IACV,EAEDohG,iBAAkB,SAAUR,EAAWS,GAEnC,IAAIxF,EAAO,IAAIQ,GAAKuE,EAAWS,EAAYrF,OAAQqF,EAAYtF,QAI/D,OAHA/7F,KAAKs9F,MAAMx+F,KAAK+8F,GAEhBA,EAAKkB,SAAS,GAAGX,QAAQiF,EAAYvF,MAC9BD,EAAKkB,QAAQ,EACvB,EAGDuE,YAAa,SAAUV,EAAWK,GAC9BjhG,KAAKu9F,SAAW,GAGhB,IAFA,IAAIgE,EAAgB,KAChBC,EAAmB,KACd9jG,EAAI,EAAGA,EAAIujG,EAAQzhG,OAAQ9B,IAAK,CACrC,IAAI2jG,EAAcJ,EAAQvjG,GAEtB+jG,EAAWzhG,KAAKohG,iBAAiBR,EAAWS,GAC1B,OAAlBE,EACAA,EAAgBE,EAIhBA,EAAS5hF,KAAKu8E,QAAQoF,GAE1BxhG,KAAKu9F,SAASz+F,KAAK2iG,EAAS5F,MAC5B2F,EAAmBC,CACtB,CAGD,OADAF,EAAc1hF,KAAKu8E,QAAQoF,GACpBxhG,IACV,EAED0hG,gBAAiB,SAAUd,GACvB,IAAIK,EAAU,GAQd,OAPAjhG,KAAK09F,WAAW1W,QAEhBhnF,KAAKg/F,qBAAqB4B,EAAWA,EAAU/E,MAC/C77F,KAAK8gG,eAAeF,EAAU3E,MAAO,KAAM2E,EAAU/E,KAAMoF,GAC3DjhG,KAAKshG,YAAYV,EAAWK,GAE5BjhG,KAAKw/F,wBAAwBx/F,KAAKu9F,UAC3Bv9F,IACV,EACDyxE,QAAS,WAIL,OAHAzxE,KAAKw9F,SAASxW,QACdhnF,KAAK09F,WAAW1W,QAChBhnF,KAAKu9F,SAAW,GACTv9F,IACV,EACD88F,QAAS,WACL,IAAIlB,EAGJ,IAFA57F,KAAKigG,0BAEwCl/F,KAArC66F,EAAS57F,KAAK2gG,oBAClB3gG,KAAK0hG,gBAAgB9F,GAIzB,OAFA57F,KAAKygG,eACLzgG,KAAKyxE,UACEzxE,IACV,IAcL0J,OAAOqzB,OAAO0gE,EAAW16F,UAAW,CAChC08F,MAAO,WACH,OAAOz/F,KAAK+7F,IACf,EACD4F,KAAM,WACF,OAAO3hG,KAAKg8F,IACf,EACDhV,MAAO,WAEH,OADAhnF,KAAK+7F,KAAO/7F,KAAKg8F,KAAO,KACjBh8F,IACV,EAED++F,aAAc,SAAUp2E,EAAQizE,GAU5B,OATAA,EAAO1iC,KAAOvwC,EAAOuwC,KACrB0iC,EAAO/7E,KAAO8I,EACM,OAAhBizE,EAAO1iC,KACPl5D,KAAK+7F,KAAOH,EAGZA,EAAO1iC,KAAKr5C,KAAO+7E,EAEvBjzE,EAAOuwC,KAAO0iC,EACP57F,IACV,EAED4hG,YAAa,SAAUj5E,EAAQizE,GAU3B,OATAA,EAAO1iC,KAAOvwC,EACdizE,EAAO/7E,KAAO8I,EAAO9I,KACD,OAAhB+7E,EAAO/7E,KACP7f,KAAKg8F,KAAOJ,EAGZA,EAAO/7E,KAAKq5C,KAAO0iC,EAEvBjzE,EAAO9I,KAAO+7E,EACP57F,IACV,EAED8+F,OAAQ,SAAUlD,GAUd,OATkB,OAAd57F,KAAK+7F,KACL/7F,KAAK+7F,KAAOH,EAGZ57F,KAAKg8F,KAAKn8E,KAAO+7E,EAErBA,EAAO1iC,KAAOl5D,KAAKg8F,KACnBJ,EAAO/7E,KAAO,KACd7f,KAAKg8F,KAAOJ,EACL57F,IACV,EAEDs/F,YAAa,SAAU1D,GASnB,IARkB,OAAd57F,KAAK+7F,KACL/7F,KAAK+7F,KAAOH,EAGZ57F,KAAKg8F,KAAKn8E,KAAO+7E,EAErBA,EAAO1iC,KAAOl5D,KAAKg8F,KAEI,OAAhBJ,EAAO/7E,MACV+7E,EAASA,EAAO/7E,KAGpB,OADA7f,KAAKg8F,KAAOJ,EACL57F,IACV,EAED6Z,OAAQ,SAAU+hF,GAad,OAZoB,OAAhBA,EAAO1iC,KACPl5D,KAAK+7F,KAAOH,EAAO/7E,KAGnB+7E,EAAO1iC,KAAKr5C,KAAO+7E,EAAO/7E,KAEV,OAAhB+7E,EAAO/7E,KACP7f,KAAKg8F,KAAOJ,EAAO1iC,KAGnB0iC,EAAO/7E,KAAKq5C,KAAO0iC,EAAO1iC,KAEvBl5D,IACV,EAEDk/F,cAAe,SAAUv/F,EAAG2oB,GAaxB,OAZe,OAAX3oB,EAAEu5D,KACFl5D,KAAK+7F,KAAOzzE,EAAEzI,KAGdlgB,EAAEu5D,KAAKr5C,KAAOyI,EAAEzI,KAEL,OAAXyI,EAAEzI,KACF7f,KAAKg8F,KAAOr8F,EAAEu5D,KAGd5wC,EAAEzI,KAAKq5C,KAAOv5D,EAAEu5D,KAEbl5D,IACV,EACD20B,QAAS,WACL,OAAqB,OAAd30B,KAAK+7F,IACf,IAEEsB,CACV,CA5mB0B,G,mCClFpB,MAAMwE,WAA4BngB,GAerC5yE,YAAY6yE,GACR3yE,MAAM2yE,EAD6B,uDAAJ,CAAC,GAEhC3hF,KAAK2hF,YAAcA,CACtB,CAIDc,WAAW54E,GAgBP7J,KAAKsiF,gBAAkBz5D,gBAAMtL,oBAfL,CACpBsgE,KAAM,CACFjC,SAAS,EACT2G,MAAO,IAEX50B,SAAU,CACNiuB,SAAS,EACT2G,MAAO,IAEXjC,IAAK,CACD1E,SAAS,EACT2G,MAAO,IAEXtB,oBAAoB,IAEiC1jE,oBAAsB,OAAZ1T,QAAgC,IAAZA,OAAqB,EAASA,EAAQ24E,UAChI,CAKDI,cAEI5iF,KAAK4hF,OAAS,GACd5hF,KAAK8hG,UAAY,IAAIrlB,SACrBz8E,KAAK4hF,OAAO9iF,KAAKkB,KAAK8hG,WACtB9hG,KAAKksF,UAAY,IAAIzP,SACrBz8E,KAAK4hF,OAAO9iF,KAAKkB,KAAKksF,WACtBlsF,KAAKqO,KAAO,IAAIouE,YAChBz8E,KAAK8hG,UAAUr8F,IAAIzF,KAAKqO,MACxBrO,KAAKb,KAAO,IAAIs9E,YAChBz8E,KAAKksF,UAAUzmF,IAAIzF,KAAKb,MAExBa,KAAK6hF,QAAU,CAAC7hF,KAAKqO,KAAMrO,KAAKb,KACnC,CACD0jF,cAEI,MAAMsU,EAAW,IAAI1a,oBAAuB,SAAU,KACtD0a,EAAStsD,SAASvxB,IAAI,EAAG,EAAG,IAC5BtZ,KAAK8hG,UAAUr8F,IAAI0xF,GAEnB,MAAMI,EAAY,IAAI9a,oBAAuB,SAAU,IACvD8a,EAAU1sD,SAASvxB,KAAK,GAAI,GAAI,IAChCtZ,KAAK8hG,UAAUr8F,IAAI8xF,GAEnB,MAAMC,EAAY,IAAI/a,oBAAuB,SAAU,KACvD+a,EAAU3sD,SAASvxB,IAAI,GAAI,GAAI,IAC/BtZ,KAAK8hG,UAAUr8F,IAAI+xF,GAEnB,MAAMC,EAAe,IAAIhb,gBAAmB,QAAU,KACtDz8E,KAAK8hG,UAAUr8F,IAAIgyF,EACtB,CA6ED7K,KAAKx5E,EAAMvJ,GACP,IAAIwmF,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAKpF,GAHAzxF,KAAKwkF,MAAQpxE,EAAI,MACjBpT,KAAKynB,SAAWrU,EAAI,SACpBpT,KAAK+hG,QAAU3uF,EAAI,SACdpT,KAAKwkF,QAAUxkF,KAAKynB,SACrB,MAAM3nB,MAAM,+DAGXyJ,gBAAMvJ,KAAKb,OACZa,KAAKb,KAAK6nF,QAETz9E,gBAAMvJ,KAAKqO,OACZrO,KAAKqO,KAAK24E,QAGd,MAkDM/B,EAAep8D,gBAAMtL,oBAlDf,CACRinE,MAAO,CACH99D,OAAQ,IACR4gC,KAAM,QACN91C,KAAM,IACNq7D,OAAQ,CACJhhC,MAAO,IACPx6B,MAAO,QAEX1R,EAAG,CACC+E,MAAO,KAEX4jB,EAAG,CACC5jB,MAAO,KAEXrG,EAAG,CACCqG,MAAO,MAGf+iB,SAAU,CACNpW,MAAO,UACP21C,UAAW,OAEf+6C,QAAS,CACL9F,MAAO,CACHrgB,SAAS,EACTpqE,KAAM,IACNH,MAAO,WAEX3M,MAAO,CACHk3E,SAAS,EACTt0B,KAAM,QACN91C,KAAM,KACNH,MAAO,UACP2wF,SAAU,CAAC,GAAI,KACfn1B,OAAQ,CACJhhC,MAAO,IACPx6B,MAAO,UAInBisF,MAAO,CACHjsF,MAAO,OACPs6B,QAAS,GACTy/C,QAAS,CACLv/C,MAAO,KACPx6B,MAAO,WAIwBkM,oBAAU1T,GAAW,CAAC,IAE3D26E,EAAQxkF,KAAKwkF,MACb/8D,EAAWznB,KAAKynB,SAChBs6E,EAAU/hG,KAAK+hG,QACfrU,EAAI,IAAIjR,WACR98E,GAAI,IAAI88E,YAAgBuZ,UAAUxR,EAAM,IACxCl8D,GAAI,IAAIm0D,YAAgBuZ,UAAUxR,EAAM,IACxCnmF,GAAI,IAAIo+E,YAAgBuZ,UAAUxR,EAAM,IAC9CkJ,EAAEp0E,IAAI3Z,EAAEjB,EAAG4pB,EAAE5pB,EAAGL,EAAEK,EAAGiB,EAAE0vD,EAAG/mC,EAAE+mC,EAAGhxD,EAAEgxD,EAAG1vD,EAAEukF,EAAG57D,EAAE47D,EAAG7lF,EAAE6lF,GAChDlkF,KAAK6tF,aAAe,CAACluF,EAAG2oB,EAAGjqB,GAC3B2B,KAAK0tF,EAAIA,EACT,MAAMuU,GAAI,IAAIxlB,YAAgBylB,WACxB1c,EAAS,GAEf,IAAK,IAAI9nF,GADK,EACOA,GADP,IACqBA,EAC/B,IAAK,IAAIa,GAFC,EAEWA,GAFX,IAEyBA,EAC/B,IAAK,IAAIC,GAHH,EAGeA,GAHf,IAG6BA,EAAG,CAClC,MAAM2jG,EAAa,IAAI1lB,WAAc/+E,EAAGa,EAAGC,GACrCy9F,EAAQj8F,KAAKkpF,oBAAoBlpF,KAAK0tF,EAAGuU,EAAGE,GAAY,GAC9D3c,EAAO1mF,KAAKm9F,EAAMv0B,UACrB,CAIT,MAAM3/D,EAAMq6F,KAAQ5c,GAGpB,IAAI6c,EACJ,IAAK,MAAMlkG,KAAQ4J,EAAIu6F,MAAO,CAE1B,MAAMC,EAAU,GAChB,IAAIC,GAAS,EACTC,GAAU,EACd,IAAK,MAAM9iF,KAASxhB,EAAM,CACtB,IAAe,IAAXwhB,EAAc,CACd6iF,GAAS,EACT,KACH,CACD,MAAME,EAAS36F,EAAI7I,UAAUygB,GAC7B,IAAK,IAAIphB,EAAI,EAAGA,EAAI,IAAKA,EACrB,GAAI6sB,OAAOqG,MAAMixE,EAAOnkG,IAAK,CACzBkkG,GAAU,EACV,KACH,CAELF,EAAQzjG,KAAK4jG,EAChB,CACD,IAAKF,IAAWC,EACZ,SAGJ,MAAM7Z,EAAS,IAAInM,WAAc,EAAG,EAAG,GACjC2I,EAAW,GACjB,IAAK,IAAI1nF,EAAI,EAAGA,EAAI6kG,EAAQ/iG,SAAU9B,EAAG,CACrC,MAAMk+F,GAAS,IAAInf,YAAgBuZ,UAAUuM,EAAQ7kG,IACrD0nF,EAAStmF,KAAK88F,GACdhT,EAAOnjF,IAAIm2F,EACd,CAED,GADAhT,EAAOlB,aAAatC,EAAS5lF,QACzBopF,EAAOppF,SAAW,KAAM,CACxB6iG,EAAajd,EACb,KACH,CACJ,CAGD,MAAM,SAAE0Y,EAAF,MAAYR,GChSA,SAAU9X,GAChC,MAAMmd,EAAiB,IAAIlmB,kBAIrB2I,EAAW,GACXwd,EAAU,GACVtF,GAJa,IAAID,IAAa/X,cAAcE,GAIzB8X,MACzB,IAAK,IAAI5/F,EAAI,EAAGA,EAAI4/F,EAAM99F,OAAQ9B,IAAK,CACnC,MAAMm+F,EAAOyB,EAAM5/F,GACnB,IAAImqF,EAAOgU,EAAKhU,KAEhB,EAAG,CACC,MAAMoU,EAAQpU,EAAKkU,OAAOE,MAC1B7W,EAAStmF,KAAKm9F,EAAMv9F,EAAGu9F,EAAM5sC,EAAG4sC,EAAM/X,GACtC0e,EAAQ9jG,KAAK+8F,EAAKxG,OAAO32F,EAAGm9F,EAAKxG,OAAOhmC,EAAGwsC,EAAKxG,OAAOnR,GACvD2D,EAAOA,EAAKhoE,IACf,OAAQgoE,IAASgU,EAAKhU,KAC1B,CACD8a,EAAeE,aAAa,WAAY,IAAIpmB,0BAA6B2I,EAAU,IACnFud,EAAeE,aAAa,SAAU,IAAIpmB,0BAA6BmmB,EAAS,IAGhF,MAAME,EAAY,GACZC,EAAc,IAAIrnF,IAAI4hF,GAC5B,IAAK,IAAI0F,KAAmBD,EAAa,CACrC,MAAME,EAAW,GACXC,EAAYF,EAAe,KACjC,IAAIG,EAAcH,EAAe,KACjCC,EAASnkG,KAAKokG,EAAUlH,OAAOC,OAC/B,EAAG,CACC,MAAMmH,EAAgBJ,EAAe,OAC/BK,EAAYF,EAAYrH,KAAKD,KAC7ByH,EAAkBD,EAAUhO,OACjB/3F,KAAKK,IAAIylG,EAAcrmG,IAAIumG,GAAmB,IAAM,MAEjEN,EAAkBK,EAClBF,EAAcA,EAAYrH,KAAKj8E,OAG/BojF,EAASnkG,KAAKqkG,EAAYpH,OAAOE,OACjCkH,EAAcA,EAAYtjF,MAE9BkjF,EAAY7sF,OAAO8sF,EACtB,OAAQG,IAAgBD,GACzBJ,EAAUhkG,KAAKmkG,EAClB,CACD,MAAO,CAAEnF,SAAU6E,EAAgBrF,MAAOwF,EAC7C,CDgPmCS,CAAkBlB,GAGxCvpD,EAAQ,IAAI2jC,SAClB3jC,EAAM91C,KAAO,QACb,MAAMwgG,EAAe,IAAI/mB,qBAAwB,CAC7CprE,MAAO4zE,EAAaqY,MAAMjsF,MAC1Bs6B,QAASs5C,EAAaqY,MAAM3xD,QAC5B+oD,aAAa,IAEX8F,EAAO,IAAI/d,QAAWqhB,EAAU0F,GACtChJ,EAAKx3F,KAAO,YACZw3F,EAAK3wE,SAAS0wE,KAAO9d,YACrB+d,EAAKiJ,YAAc,EACnB3qD,EAAMrzC,IAAI+0F,GACV,MAAMkJ,EAAQ,IAAIjnB,QAAWqhB,EAAU0F,EAAaphF,SACpDshF,EAAM1gG,KAAO,YACb0gG,EAAM75E,SAAS0wE,KAAO9d,aACtBinB,EAAMD,YAAc,EACpB3qD,EAAMrzC,IAAIi+F,GACV1jG,KAAKqO,KAAK5I,IAAIqzC,GAEd,MAAM6qD,EAAY1e,EAAaqY,MAAMlS,QAAQv/C,MACvC+3D,EAAe,IAAIC,oBAAiB,CACtCxyF,MAAO4zE,EAAaqY,MAAMlS,QAAQ/5E,MAClC+2E,UAAWub,EACXG,iBAAiB,IAErB,IAAK,MAAMjI,KAAQyB,EAAO,CACtB,MAAMyG,EAAe,GACrB,IAAK,MAAMnI,KAAUC,EAAM,CACvB,IAAImI,EAAepI,EAAOx5E,QAC1B,MAAM5iB,EAASwkG,EAAaxkG,SAC5BwkG,EAAeA,EAAaxjB,eAAe,EAAI,GAAMmjB,EAAYnkG,GACjEukG,EAAajlG,KAAKklG,EACrB,CAED,MAAMC,EAAW,IAAIC,YACrBD,EAASE,UAAUJ,GACnB,MAAMK,EAAW,IAAI3nB,QAAWwnB,EAAUL,GAC1C5jG,KAAKqO,KAAK5I,IAAI2+F,EACjB,CAED,MAAMC,EAAc,CAACpf,EAAaT,MAAM7kF,EAAE+E,MAAOugF,EAAaT,MAAMl8D,EAAE5jB,MAAOugF,EAAaT,MAAMnmF,EAAEqG,OAC5F4/F,EAAa,GACnBA,EAAWxlG,UAAoFiC,KAA9C,QAA/BsvF,EAAKpL,EAAaT,MAAM7kF,SAAsB,IAAP0wF,OAAgB,EAASA,EAAG/oC,MAAsB29B,EAAaT,MAAMl9B,KAAO29B,EAAaT,MAAM7kF,EAAE2nD,MAC1Jg9C,EAAWxlG,UAAoFiC,KAA9C,QAA/BuvF,EAAKrL,EAAaT,MAAMl8D,SAAsB,IAAPgoE,OAAgB,EAASA,EAAGhpC,MAAsB29B,EAAaT,MAAMl9B,KAAO29B,EAAaT,MAAMl8D,EAAEg/B,MAC1Jg9C,EAAWxlG,UAAoFiC,KAA9C,QAA/BwvF,EAAKtL,EAAaT,MAAMnmF,SAAsB,IAAPkyF,OAAgB,EAASA,EAAGjpC,MAAsB29B,EAAaT,MAAMl9B,KAAO29B,EAAaT,MAAMnmF,EAAEipD,MAC1J,MAAMi9C,EAAiB,GACvBA,EAAezlG,UAAoFiC,KAA9C,QAA/ByvF,EAAKvL,EAAaT,MAAM7kF,SAAsB,IAAP6wF,OAAgB,EAASA,EAAGh/E,MAAsByzE,EAAaT,MAAMhzE,KAAOyzE,EAAaT,MAAM7kF,EAAE6R,MAC9J+yF,EAAezlG,UAAoFiC,KAA9C,QAA/B0vF,EAAKxL,EAAaT,MAAMl8D,SAAsB,IAAPmoE,OAAgB,EAASA,EAAGj/E,MAAsByzE,EAAaT,MAAMhzE,KAAOyzE,EAAaT,MAAMl8D,EAAE9W,MAC9J+yF,EAAezlG,UAAoFiC,KAA9C,QAA/B2vF,EAAKzL,EAAaT,MAAMnmF,SAAsB,IAAPqyF,OAAgB,EAASA,EAAGl/E,MAAsByzE,EAAaT,MAAMhzE,KAAOyzE,EAAaT,MAAMnmF,EAAEmT,MAC9J,MAAM0gF,EAAkB,GACxBA,EAAgBpzF,UAAqFiC,KAA/C,QAA/B4vF,EAAK1L,EAAaT,MAAM7kF,SAAsB,IAAPgxF,OAAgB,EAASA,EAAGt/E,OAAuB4zE,EAAaT,MAAMnzE,MAAQ4zE,EAAaT,MAAM7kF,EAAE0R,OACjK6gF,EAAgBpzF,UAAqFiC,KAA/C,QAA/B6vF,EAAK3L,EAAaT,MAAMl8D,SAAsB,IAAPsoE,OAAgB,EAASA,EAAGv/E,OAAuB4zE,EAAaT,MAAMnzE,MAAQ4zE,EAAaT,MAAMl8D,EAAEjX,OACjK6gF,EAAgBpzF,UAAqFiC,KAA/C,QAA/B8vF,EAAK5L,EAAaT,MAAMnmF,SAAsB,IAAPwyF,OAAgB,EAASA,EAAGx/E,OAAuB4zE,EAAaT,MAAMnzE,MAAQ4zE,EAAaT,MAAMnmF,EAAEgT,OACjK,MAAMshF,EAAe,GACrBA,EAAa7zF,UAA2IiC,KAA/C,QAArFgwF,EAAqC,QAA/BD,EAAK7L,EAAaT,MAAM7kF,SAAsB,IAAPmxF,OAAgB,EAASA,EAAGjkB,cAA2B,IAAPkkB,OAAgB,EAASA,EAAG1/E,OAAuB4zE,EAAaT,MAAM3X,OAAOx7D,MAAQ4zE,EAAaT,MAAM7kF,EAAEktE,OAAOx7D,OAClOshF,EAAa7zF,UAA2IiC,KAA/C,QAArFkwF,EAAqC,QAA/BD,EAAK/L,EAAaT,MAAMl8D,SAAsB,IAAP0oE,OAAgB,EAASA,EAAGnkB,cAA2B,IAAPokB,OAAgB,EAASA,EAAG5/E,OAAuB4zE,EAAaT,MAAM3X,OAAOx7D,MAAQ4zE,EAAaT,MAAMl8D,EAAEukD,OAAOx7D,OAClOshF,EAAa7zF,UAA2IiC,KAA/C,QAArFowF,EAAqC,QAA/BD,EAAKjM,EAAaT,MAAMnmF,SAAsB,IAAP6yF,OAAgB,EAASA,EAAGrkB,cAA2B,IAAPskB,OAAgB,EAASA,EAAG9/E,OAAuB4zE,EAAaT,MAAM3X,OAAOx7D,MAAQ4zE,EAAaT,MAAMnmF,EAAEwuE,OAAOx7D,OAClO,MAAMuhF,EAAe,GACrBA,EAAa9zF,UAA2IiC,KAA/C,QAArFswF,EAAqC,QAA/BD,EAAKnM,EAAaT,MAAM7kF,SAAsB,IAAPyxF,OAAgB,EAASA,EAAGvkB,cAA2B,IAAPwkB,OAAgB,EAASA,EAAGxlD,OAAuBo5C,EAAaT,MAAM3X,OAAOhhC,MAAQo5C,EAAaT,MAAM7kF,EAAEktE,OAAOhhC,OAClO+mD,EAAa9zF,UAA2IiC,KAA/C,QAArFwwF,EAAqC,QAA/BD,EAAKrM,EAAaT,MAAMl8D,SAAsB,IAAPgpE,OAAgB,EAASA,EAAGzkB,cAA2B,IAAP0kB,OAAgB,EAASA,EAAG1lD,OAAuBo5C,EAAaT,MAAM3X,OAAOhhC,MAAQo5C,EAAaT,MAAMl8D,EAAEukD,OAAOhhC,OAClO+mD,EAAa9zF,UAA2IiC,KAA/C,QAArF0wF,EAAqC,QAA/BD,EAAKvM,EAAaT,MAAMnmF,SAAsB,IAAPmzF,OAAgB,EAASA,EAAG3kB,cAA2B,IAAP4kB,OAAgB,EAASA,EAAG5lD,OAAuBo5C,EAAaT,MAAM3X,OAAOhhC,MAAQo5C,EAAaT,MAAMnmF,EAAEwuE,OAAOhhC,OAClO,IAAK,IAAIomD,EAAS,EAAGA,EAAS,IAAKA,EAAQ,CACvC,MAAMzyF,EAAS,GACTu4F,EAAcvT,EAAMyN,GACpBlpF,EAAS,IAAI0zE,WAAc,EAAG,EAAG,GACjCyX,GAAM,IAAIzX,YACXuZ,UAAU+B,GACVvX,eAAehhF,GAEdglG,EAAe,CAACz7F,EAAQmrF,GACxB4D,EAAe,IAAI+L,oBAAiB,CACtCxyF,MAAO,OACP+2E,UAAW,MACX0b,iBAAiB,EACjBW,UAAW,IACX/P,aAAa,EACbgQ,WAAW,IAETC,EAAY,IAAIT,YACtBS,EAAUR,UAAUK,GACpB,MAAM/1E,EAAO,IAAIguD,QAAWkoB,EAAW7M,GACvC93F,KAAKb,KAAKsG,IAAIgpB,GAEd,MAAM0lE,GAAU,IAAI1X,YACfkD,KAAKuU,GACL1T,eAAe,EAAIyE,EAAaT,MAAM99D,OAASwtE,EAAI10F,UAClDolG,EAAaP,EAAYpS,GACzB4S,EAAa3S,EAAgBD,GAC7B6S,EAAYR,EAAWrS,GACvB8S,EAAgBR,EAAetS,GAC/BnlB,EAAc8lB,EAAaX,GAC3BlK,EAAc4K,EAAaV,GAC3B+S,EAAchlG,KAAK8nF,YAAYqM,EAASyQ,EAAYC,EAAYC,EAAWC,EAAe,IAAItoB,WAAc,EAAK,GAAM3P,EAAaib,GAC1I/nF,KAAKb,KAAKsG,IAAIu/F,GAEd,MAAM/P,EAAgB,IAAIxY,oBAAuB,EAAG,KAAO,KAAO,IAC5DyY,EAAgB,IAAIzY,qBAAwB,CAAEprE,MAAO,IACrDs2E,EAAQ,IAAIlL,QAAWwY,EAAeC,GAC5CvN,EAAM98C,SAAS80C,KAAKuU,GACpBvM,EAAM/G,OAAO,IAAInE,YACjBkL,EAAMwN,SAAS73F,KAAKuB,GAAK,GACzBmB,KAAKb,KAAKsG,IAAIkiF,EACjB,CAID,MAAMsd,EAAgB,IAAIpB,oBAAiB,CACvCxyF,MAAO4zE,EAAax9D,SAASpW,MAC7B+2E,UAAWnD,EAAax9D,SAASu/B,UACjC88C,iBAAiB,IAGfoB,EAAc,GACpB,IAAK,IAAIC,EAAW,EAAGA,EAAW19E,EAASjoB,SAAU2lG,EAAU,CAE3D,MAAMC,EAAgB,GAChBz9E,EAAUF,EAAS09E,GACzB,IAAK,MAAME,KAAU19E,EAAS,CAC1B,MAAM29E,GAAe,IAAI7oB,YAAgBuZ,UAAUqP,GAC7CE,EAAavlG,KAAKkpF,oBAAoBlpF,KAAK0tF,EAAGuU,EAAGqD,GAAc,GACrEF,EAActmG,KAAKymG,GACnBH,EAActmG,KAAKymG,GACnBL,EAAYpmG,KAAKymG,EACpB,CACD,MAAMZ,EAAY,IAAIT,YACtBS,EAAUR,UAAUiB,GACpB,MAAMI,EAAQ,IAAI/oB,QAAWkoB,EAAWM,GACxCjlG,KAAKb,KAAKsG,IAAI+/F,EACjB,CAGDxlG,KAAKklG,YAAc,IAAIzoB,YACvB,IAAK,MAAMwf,KAASiJ,EAAa,CAC7B,MAAMO,EAAc,IAAIhpB,YACxBgpB,EAAY56D,SAAS80C,KAAKsc,GAC1Bj8F,KAAKklG,YAAYz/F,IAAIggG,EACxB,CAGD,GAFAzlG,KAAKb,KAAKsG,IAAIzF,KAAKklG,aAEfnD,EACA,IAAK,MAAMsD,KAAUtD,EAAS,CAC1B,MAAMr9F,EAAQ2gG,EAAO,GACfC,GAAe,IAAI7oB,YAAgBuZ,UAAUqP,EAAO,IACpDK,EAAkB1lG,KAAKkpF,oBAAoBlpF,KAAK0tF,EAAGuU,EAAGqD,GAAc,GAC1E,GAAIrgB,EAAa8c,QAAQ9F,MAAMrgB,QAAS,CACpC,MAAM+pB,EAAe3lG,KAAK4lG,aAAaF,EAAiBzgB,EAAa8c,QAAQ9F,MAAMzqF,KAAMyzE,EAAa8c,QAAQ9F,MAAM5qF,OACpHrR,KAAKb,KAAKsG,IAAIkgG,EACjB,CACD,GAAI1gB,EAAa8c,QAAQr9F,MAAMk3E,QAAS,CACpC,MAAMiqB,EAAc7lG,KAAK8nF,YAAY4d,EAAiBhhG,EAAOugF,EAAa8c,QAAQr9F,MAAM2M,MAAO4zE,EAAa8c,QAAQr9F,MAAM4iD,KAAM29B,EAAa8c,QAAQr9F,MAAM8M,MAAM,IAAIirE,YAAgBuZ,UAAU/Q,EAAa8c,QAAQr9F,MAAMs9F,UAAW/c,EAAa8c,QAAQr9F,MAAMmoE,OAAOhhC,MAAOo5C,EAAa8c,QAAQr9F,MAAMmoE,OAAOhhC,OAChT7rC,KAAKb,KAAKsG,IAAIogG,EACjB,CACJ,CAER,CAOD1X,MAAgB,IAAZ11E,EAAY,uDAAH,EAET,MAAM+hF,EAAOx6F,KAAKqO,KAAKqoF,gBAAgB,SAASA,gBAAgB,aAChE12F,KAAKqO,KAAKq3E,oBACV,MAAMN,EAAW,GACXyQ,EAAgB2E,EAAKsD,SAAS36D,WAAW0H,SAAS42C,MAClDqU,EAAYD,EAAcr2F,OAAS,EACzC,IAAK,IAAI9B,EAAI,EAAGA,EAAIo4F,IAAap4F,EAC7B0nF,EAAStmF,MAAK,IAAI29E,YAAgBuZ,UAAUH,EAAmB,EAAJn4F,IAG/D,MAAM+4F,EAAW,GACjB,IAAK,IAAI/4F,EAAI,EAAGA,EAAIo4F,IAAap4F,EAAG,CAChC,MAAMiG,EAAMyhF,EAAS1nF,GACrB+4F,EAAS33F,KAAK07F,EAAKtE,aAAavyF,GACnC,CACD3D,KAAKulF,gBAAgBkR,EAAUh+E,EAClC,CAUD02B,MAAMo6C,GAEF,MAAMuc,EAAgB,IAAIrpB,WACpBspB,EAAU/lG,KAAKklG,YAAY30F,SAAS/Q,OAC1C,IAAK,IAAI9B,EAAI,EAAGA,EAAIqoG,IAAWroG,EAAG,CAC9B,MAAMsoG,EAAehmG,KAAKklG,YAAY30F,SAAS7S,GAC/CooG,EAAcrgG,IAAIugG,EAAapP,iBAAiB,IAAIna,YACvD,CAED,MAAM+M,EAAa,CACf,EAAKxpF,KAAK6tF,aAAa,GAAGzrE,QAC1B,KAAMpiB,KAAK6tF,aAAa,GAAGzrE,QAAQksE,SACnC,EAAKtuF,KAAK6tF,aAAa,GAAGzrE,QAC1B,KAAMpiB,KAAK6tF,aAAa,GAAGzrE,QAAQksE,SACnC,EAAKtuF,KAAK6tF,aAAa,GAAGzrE,QAC1B,KAAMpiB,KAAK6tF,aAAa,GAAGzrE,QAAQksE,SACnC,SAAYwX,GAGhB92F,MAAMs6E,UAAUC,EAAYC,EAC/B,CACDoc,aAAa/6D,EAAUo7D,EAAU50F,GAE7B,MAAMoZ,EAASpY,SAASqY,cAAc,UAChClZ,EAAO,IACbiZ,EAAOohB,MAAQr6B,EACfiZ,EAAOqhB,OAASt6B,EAChB,MAAMw2E,EAAMv9D,EAAOG,WAAW,MAE9Bo9D,EAAIke,YACJle,EAAI0N,IAAIlkF,IAAUA,IAAUA,IAAU,EAAG,EAAIlU,KAAKuB,IAClDmpF,EAAIC,UAAY52E,EAChB22E,EAAIhiF,OACJ,MAAMwiF,EAAU,IAAI/L,WAAchyD,GAClC+9D,EAAQC,aAAc,EACtB,MAAM5+D,EAAW,IAAI4yD,kBAAqB,CAAEt/E,IAAKqrF,IAC3CE,EAAS,IAAIjM,UAAa5yD,GAChC6+D,EAAOxgE,MAAM5O,IAAI2sF,EAAUA,EAAU,GACrC,MAAMpd,EAAY,IAAIpM,YAGtB,OAFAoM,EAAUh+C,SAAS80C,KAAK90C,GACxBg+C,EAAUpjF,IAAIijF,GACPG,CACV,E,eEvfU,SAASsd,GAAT,GAA6D,IAAtC,QAACnkD,EAAD,SAAUzxC,KAAa61F,GAAc,EAEzE,OADAA,EAAYpiD,SAAWoiD,EAAYpiD,UAAYhC,EACxC,eAAC1nC,GAAA,EAAD,IAAY8rF,EAAZ,SACJ71F,GAEJ,CCYD,MAAM81F,GAAU,CACdriG,IAAK,CACHU,MAAO,OAET8C,IAAK,CACH9C,MAAO,OAET4hG,IAAK,CACH5hG,MAAO,QAGE6hG,GAAY,CACvBxjF,SAAU,CACRtZ,IAAK,WACL/E,MAAO,WACPyO,YAAa,sBAEfkjE,KAAM,CACJ5sE,IAAK,OACL/E,MAAO,OACPyO,YAAa,uFAEfqzF,OAAQ,CACN/8F,IAAK,SACL/E,MAAO,SACPyO,YAAY,mNAMHszF,GAAgB,IAA6C,IAA5C,MAAC5rG,EAAD,SAAQo3C,EAAR,SAAkB+R,EAAlB,UAA4B9yC,GAAe,EACvE,OAAO,gBAAC43C,GAAA,EAAD,CAAwB72B,UAAU,WAAW/gB,UAAWA,EAAxD,UACL,eAAC06C,GAAA,EAAD,CAAW35B,UAAU,SAArB,uBACA,eAAC45B,GAAA,EAAD,CACEhxD,MAAOA,EACPo3C,SAAUA,EAFZ,SAIGvoC,OAAOC,QAAQ48F,IAAWppG,KAAI,QAAEsM,EAAK2J,GAAP,SAC7B,eAAC+xC,GAAA,EAAD,CAEEtqD,MAAO4O,EACP27C,QAAS,eAAC0G,GAAA,EAAD,CAAOz6C,MAAM,UAAU2yC,SAAUA,IAC1Ct/C,MAAO,eAAC0pC,GAAA,EAAD,CACLD,MAAOo4D,GAAU98F,GAAK0J,YADjB,SAEH,gCAAOC,EAAK1O,WALX+E,EAFsB,QANX,OAAxB,EA+BWi9F,GAAqBx3F,IAAMoI,KAAKpI,IAAMq+B,YAAW,CAAC,EAA6Cnb,KAAS,IAAtD,QAAC1c,EAAD,KAAU5B,EAAV,SAAgB8iC,EAAhB,QAA0BvmC,KAAYggB,GAAe,EAClH,MAAM,IAAC5c,GAAO0E,MACR,WAAC9I,GAAcmD,MACdoZ,EAAQ+6E,GAAajvF,mBAAS,QAC9BkvF,EAAUC,GAAenvF,mBAAS,aAClCsqC,EAAS1tC,GAAcoD,oBAAS,GACjC3G,EAAOkb,QAAQ2qB,GAEfkwD,EAAqBzoF,uBAAawxB,IACtC82D,EAAU92D,EAAMlnB,OAAO9tB,MAAvB,GACC,IAEGksG,EAAuB1oF,uBAAawxB,IACxCg3D,EAAYh3D,EAAMlnB,OAAO9tB,MAAzB,GACC,IAEGmsG,EAAsB3oF,uBAAY,KACtC/J,GAAW,GACXb,EAAIQ,IAAJ,kBACayB,EADb,iBAC6B5B,EAD7B,mBAC4C8X,EAD5C,sBACgEg7E,QAC9D7lG,EACA,CAACkmG,aAAc,OAAQzwF,cAAc,IAEpCvB,MAAMhC,IACL,MAAMi0F,EAAqBj0F,EAASiC,QAAQ,uBAE5Cke,IADmC,OAAlB8zE,QAAkB,IAAlBA,OAAA,EAAAA,EAAoBz/F,MAAM,KAAK,KAA/B,iBAA+CmkB,GAC7C3Y,EAASG,KAA5B,IAED0vC,SAAQ,IAAMxuC,GAAW,KACzBa,MAAM9F,EAXT,GAYC,CAACqG,EAAS5B,EAAM8X,EAAQg7E,EAAUnzF,EAAKpE,IAE1C,OAAO,eAACg7C,GAAA,EAAD,CACHzT,SAAUA,EACV8U,mBAAoB,KACpB96C,aAAc,CAAEC,SAAU,SAAUC,WAAY,SAChDmmC,gBAAiB,CAAEpmC,SAAU,MAAOC,WAAY,SAChD66C,aAAW,EACX56C,KAAMA,EACNV,QAASA,EAPN,SASH,gBAACmI,GAAA,EAAD,CAAKkrC,SAAS,QAAQlY,YAAa,EAAGY,aAAc,EAAG8G,WAAY,EAAnE,UACE,eAACx6B,GAAA,EAAD,CAAY0B,QAAQ,KAAKjM,SAAS,SAAlC,6BAGA,eAACqK,GAAA,EAAD,CAAKuxD,GAAI,IACT,eAAC9H,GAAA,EAAD,CAAWklC,QAAM,EAACtsG,MAAO+wB,EAAQqmB,SAAU60D,EAAoBt1F,KAAK,QAAQ4I,QAAQ,SAAS1V,MAAM,SAASqgE,WAAS,EAArH,SACGr7D,OAAOC,QAAQ08F,IAASlpG,KAAI,IAAmB,IAAjBsM,EAAK5O,GAAW,EAC7C,OAAO,eAACoqD,GAAA,EAAD,CAAoBpqD,MAAO4O,EAA3B,SAAiC5O,EAAM6J,OAAxB+E,EAAtB,MAGJ,eAAC+O,GAAA,EAAD,CAAKuxD,GAAI,IACT,eAAC08B,GAAD,CAAe5rG,MAAO+rG,EAAU30D,SAAU80D,IAC1C,eAACvuF,GAAA,EAAD,CAAKQ,aAAc,EAAGkyB,cAAe,EAArC,SACE,eAAC+C,GAAA,EAAD,UACE,eAACk4D,GAAD,CAAe10F,QAASu1F,EAAqB31F,MAAM,UAAU2wC,QAASA,EAAtE,8BAvBV,K,yBCjGF,MAAMloC,GAAYC,cAAYnI,IAGrB,CACLvD,KAAM,CACJw9B,MAAO,OACPC,OAAQ,QAEVs7D,cAAe,CACbr5F,UAAW,aACX8K,QARY,IAUd,4BAA6B,CAC3Bq6B,WAAW,GAAD,OAXE,GAWF,gBAEZm0D,cAAe,CACbv7D,OAfkB,KAgBlB/9B,UAAW,kBAIF,SAASu5F,GAAT,GAQX,IAR8B,UAChCp2F,EADgC,QAEhCV,EAFgC,MAGhCY,EAHgC,MAIhC3W,EAJgC,SAKhC8V,EALgC,QAMhCg3F,EANgC,SAOhCC,GACC,EAED,MAAM,OAAE17D,EAAF,MAAUD,EAAV,IAAiBzZ,GAAQw6B,eACzBgd,EAAMpyC,iBAAO,CAACqU,MAAO,IAAKC,OAAQ,MAGxCl0B,qBAAU,KACHnd,IACHmvE,EAAIliD,QAAU,CACZmkB,MAAOA,EACPC,OAAQA,KAGR07D,GAAaj+F,gBAAMsiC,IAAWtiC,gBAAMuiC,IACtC07D,EAAS37D,EAAOC,EACjB,GACA,CAACrxC,EAAOoxC,EAAOC,EAAQ07D,IAG1B,MAAMjkD,EAAmBxpC,cAAYnI,IAEnC,MAAM61F,EAAgB,KAGhBhvF,EAAS,GAAO5P,OAAOs4C,YAAesmD,EACtCvmD,EAAer4C,OAAOs4C,YAAc1oC,EACpCuoC,EAAc1jD,KAAK+J,IAAIwB,OAAOo4C,WAHnB,MAG2CxoC,EACtDivF,EAAc1mD,EAAcE,EAC5BymD,EAAQ/9B,EAAIliD,QAAQmkB,MAAQ+9B,EAAIliD,QAAQokB,OAC9C,IAAID,EACAC,EASJ,OARI47D,EAAcC,GAChB97D,EAASqV,EAAgBymD,EAAQ,GAAc,KAC/C77D,EAASoV,EAAeumD,EAAgB,KAExC57D,EAAQmV,EAAc,GACtBlV,EAAUkV,EAAe2mD,EAAQF,EAAgB,GAAc,MAG1D,CACLG,WAAY,CACV/7D,MAAOA,EACPC,OAAQA,EACRrzB,OAAQ,EACRI,QAAS,EACT4zB,SAAU,OACVo7D,UAAW,OACX95F,UAAW,cARf,IAYI4D,EAASmI,GAAU,CAACtJ,QAASA,IAC7BgzC,EAAgBD,EAAiB,CAAC/yC,QAASA,IAEjD,OAAO,uBAAK4hB,IAAKA,EAAKlhB,UAAW+iC,mBAAKtiC,EAAOtD,KAAM6C,GAAYE,MAAOA,EAA/D,UACJ3W,EACG,sBAAK2W,MAAO,CAACy6B,MAAO+9B,EAAIliD,QAAQmkB,MAAOC,OAAQ89B,EAAIliD,QAAQokB,UAC3Dv7B,EAEJ,gBAACu9B,GAAA,EAAD,CAAQi3B,WAAW,EAAOt4B,UAAU,EAAO17B,KAAMtW,EAC/C+V,QAAS,CAACg8B,MAAOgX,EAAcokD,YADjC,UAGE,eAAC55D,GAAA,EAAD,CAAe98B,UAAW,CAACS,EAAOy1F,cAAez1F,EAAO,8BAA8B1E,KAAK,KAA3F,SACGxS,EAAQ8V,EAAW,KAEtB,eAAC09B,GAAA,EAAD,CAAe/8B,UAAWS,EAAO01F,cAAjC,SACE,eAAC/sF,GAAA,EAAD,CAAQ7I,QAAS,IAAM81F,EAAQ9sG,GAA/B,0BAMP,CAmBD6sG,GAAUxvD,aAAe,CACvBr9C,OAAO,GAOT,MAAMgtG,GAAgB,KAChBK,GAAsB/tF,cAAYnI,IAC/B,CACLvD,KAAM,CACJyiC,IAAK,MACL8wB,KAAM,MACNnpD,OAAQ,EACRI,QAAS,EACT4zB,SAAU,OACVo7D,UAAW,OACX95F,UAAW,cAEby+B,MAAO,CACLj6B,QAAS,OACT09B,cAAe,SACfpE,MAAO,OACPC,OAAQ,OACR/9B,UAAW,cAEbygD,KAAM,CACJ3iB,MAAO,OACPC,OAAQ,OACR/9B,UAAW,cAEbs5F,cAAe,CACbv7D,OAAQ27D,GACR15F,UAAW,kBAIJg6F,GAAsB74F,IAAMoI,MAAK,IAQvC,IARwC,UAC7CpG,EAD6C,MAE7CzW,EAF6C,SAG7C8V,EAH6C,QAI7Cg3F,EAJ6C,SAK7CC,EAL6C,SAM7C/6D,EAN6C,OAO7Ch0B,GACI,EAEJ,MAAM9G,EAASm2F,MACT,OAAEh8D,EAAF,MAAUD,EAAV,IAAiBzZ,GAAQw6B,eACzBgd,EAAMpyC,iBAAO,CAACqU,MAAO,IAAKC,OAAQ,MAClCk8D,EAAa5mD,KAInBxpC,qBAAU,KACHnd,IACHmvE,EAAIliD,QAAU,CACZmkB,MAAOA,EACPC,OAAQA,KAGR07D,GAAaj+F,gBAAMsiC,IAAWtiC,gBAAMuiC,IACtC07D,EAAS37D,EAAOC,EACjB,GACA,CAACrxC,EAAOoxC,EAAOC,EAAQ07D,IAE1B,MAAMS,EAAc5pF,uBAAY,KAC9BkpF,GAAWA,GAAX,GACC,CAACA,IAGE/1F,EAAOsG,mBAAQ,KAEnB,MAAMowF,EAAiBzvF,EAAUuvF,EAAW9mD,aACtCA,EAAe8mD,EAAW9mD,aAAegnD,EACzClnD,EAAc1jD,KAAK+J,IAAI2gG,EAAWhnD,YAAavU,GAAYy7D,EAC3DR,EAAc1mD,EAAcE,EAC5BymD,EAAQ/9B,EAAIliD,QAAQmkB,MAAQ+9B,EAAIliD,QAAQokB,OAC9C,IAAID,EACAC,EAQJ,OAPI47D,EAAcC,GAChB97D,EAASqV,EAAgBymD,EACzB77D,EAASoV,EAAeumD,KAExB57D,EAAQmV,EACRlV,EAAUkV,EAAe2mD,EAAQF,IAE5B,CAAC57D,QAAOC,SAAf,GACC,CAACk8D,EAAYv7D,EAAUh0B,IAE1B,OAAO,uBACL2Z,IAAKA,EACLlhB,UAAW+iC,mBAAKtiC,EAAOtD,KAAM6C,GAC7BE,MAAO,CACLy5B,SAAUpwC,EAAQ,QAAU,SAC5BwuD,OAAQxuD,EAAQ,IAAQ,EACxBoxC,MAAOpxC,EAAQ+W,EAAKq6B,MAAQ,OAC5BC,OAAQrxC,EAAQ+W,EAAKs6B,OAAS,OAC9BlB,UAAWnwC,GAAS,GAAM+W,EAAKs6B,OAAS,QACxCvxB,WAAY9f,GAAS,GAAM+W,EAAKq6B,MAAQ,SATrC,UAYL,gBAACs8D,GAAA,EAAD,CAAOh9B,UAAW1wE,EAAQ,EAAI,EAAGyW,UAAWS,EAAO66B,MAAnD,UACE,gBAACh0B,GAAA,EAAD,CAAKK,QAASpe,EAAQ,EAAI,EAAG04C,cAAe14C,EAAQ,EAAI,EAAGyW,UAAWS,EAAO68C,KAA7E,UACE,yBACCj+C,KAEF9V,GACC,eAACwzC,GAAA,EAAD,CAAe/8B,UAAWS,EAAO01F,cAAjC,SACE,eAAC/sF,GAAA,EAAD,CAAQ7I,QAASw2F,EAAjB,wBAMN,eAACG,GAAA,EAAD,CAAUl3F,UAAWS,EAAO02F,SAAUt3F,KAAMtW,EAAOgX,QAASw2F,MAzB9D,IAuCFF,GAAoBjwD,aAAe,CACjCr9C,OAAO,EACPgyC,SAAU,KACVh0B,OAAQ,IC9OV,MAAMqB,GAAYC,cAAYnI,IACrB,CACLvD,KAAM,CAAC,EACP+hE,UAAW,CACTvlC,SAAU,WACVgB,MAAO,OACPC,OAAQ,QAEVxY,QAAS,CACPuX,SAAU,WACV+2B,KAAM,EACNxuB,MAAO,EACPtC,IAAK,EACLkY,OAAQ,EACRz2C,QAAS,OACT09B,cAAe,UAEjBk6B,OAAQ,CACN53D,QAAS,OACT09B,cAAe,MACfgZ,OAAQ,GAEVq/C,OAAQ,CACNr/C,OAAQ,GACRpe,SAAU,WACV+2B,KAAM,EACN9wB,IAAK,EACLkY,OAAQ,GAEV7a,MAAO,CACLjD,aAAct5B,EAAMkH,QAAQ,IAE9ByxC,SAAU,CACR9xC,OAAQ7G,EAAMkH,QAAQ,GACtB8xB,UAAWh5B,EAAMkH,QAAQ,GACzBoyB,aAAct5B,EAAMkH,QAAQ,IAE9B2R,OAAQ,CACNogB,SAAU,WACV0L,KAAM,EACN0S,OAAQ,EACRs/C,UAAW,EACXr9D,aAAct5B,EAAMkH,QAAQ,QAI5B0vF,GAAgBt5F,IAAMoI,MAAK,IAgC3B,IAhC4B,SAChCsvF,EADgC,iBAEhC6B,EAFgC,gBAGhCC,EAHgC,qBAIhCC,EAJgC,uBAKhCC,EALgC,4BAMhCC,EANgC,UAOhCC,EAPgC,YAQhCC,EARgC,iBAShCC,EATgC,SAUhCC,EAVgC,WAWhCC,EAXgC,gBAYhCC,EAZgC,SAahCzmC,EAbgC,QAchC0mC,EAdgC,iBAehCC,EAfgC,aAgBhCC,EAhBgC,MAiBhC7uG,EAjBgC,QAkBhCsyF,EAlBgC,QAmBhC/qC,EAnBgC,OAoBhCunD,EApBgC,OAqBhCC,EArBgC,UAsBhCt4F,EAtBgC,QAuBhCV,EAvBgC,YAwBhCi5F,EAxBgC,cAyBhCC,EAzBgC,oBA0BhCC,EA1BgC,QA2BhCj0F,EA3BgC,KA4BhC5B,EA5BgC,OA6BhC81F,EACA,cAAetlD,EA9BiB,SA+BhC/zC,GACG,EACH,MAAOqmC,EAAUC,GAAe3nC,IAAMwI,SAAS,OACxCmyF,EAAgBC,GAAqB56F,IAAMwI,SAAS,MACrDy4C,EAAUW,cACV//C,EAAOkb,QAAQ2qB,GACfjlC,EAASmI,GAAUtJ,GACnBu5F,EAAmBxgG,gBAAMmM,IAAYnM,gBAAMuK,IAAS61F,EAEpDK,EAAe3rF,uBAAY,SAACxjB,GAA2B,IAApByV,EAAmB,wDAC1Dy4F,GAAeA,EAAYluG,EAAOyV,EACnC,GAAE,CAACy4F,IAEEkB,EAAuB5rF,uBAAY,SAACxjB,EAAOiuG,GAA+B,IAApBx4F,EAAmB,wDAC7Em4F,GAAoBA,EAAiB5tG,EAAOiuG,EAAWx4F,EACxD,GAAE,CAACm4F,IAEEyB,EAA6B7rF,uBAAY,SAACxjB,GAA2B,IAApByV,EAAmB,wDACxEs4F,GAA0BA,EAAuB/tG,EAAOyV,EACzD,GAAE,CAACs4F,IAEEuB,EAAc9rF,uBAAY,SAACxjB,GAA2B,IAApByV,EAAmB,wDACzD44F,GAAcA,EAAWruG,EAAOyV,EACjC,GAAE,CAAC44F,IAEEkB,EAAmB/rF,uBAAY,KACnCirF,GAAgBA,GAAhB,GACC,CAACA,IAEEe,EAAchsF,uBAAY,KAC9B+qF,GAAWA,GAAX,GACC,CAACA,IAEEh+C,EAAW/sC,uBAAawxB,IAC5BgH,EAAYhH,EAAMkH,cAAlB,GACC,IAEGuzD,EAAiBjsF,uBAAawxB,IAClCi6D,EAAkBj6D,EAAMkH,cAAxB,GACC,IAEGsU,EAAYhtC,uBAAY,KAC5Bw4B,EAAY,KAAZ,GACC,IAEG0zD,EAAoBlsF,uBAAY,KACpCgrF,GAAoBA,EAAiBI,EAArC,GACC,CAACJ,EAAkBI,IAGhBe,GAAU1yF,mBAAQ,IAClByxF,EACK,eAACj5B,GAAA,EAAD,CACLC,SAAS,OACTj/D,OACE,eAACgJ,GAAA,EAAD,CAAQjJ,MAAM,UAAUG,KAAK,QAAQC,QAAS,IAAMixD,IAApD,iBAHG,SAQJ6mC,IAEMvnD,EACF,eAAC,GAAD,CAAavpC,OAAQ,IACnB+wF,EACF,eAACxxB,GAAD,CAAQv/D,OAAQ,SADlB,GAGN,CAACupC,EAASunD,EAAQC,EAAQ9mC,IAE7B,OAAO,eAAC4kC,GAAD,CACL,cAAahjD,EACbpzC,UAAW+iC,mBAAKtiC,EAAOtD,KAAM6C,GAC7BzW,MAAOA,EAHF,SAKL,uBAAKyW,UAAWS,EAAOy+D,UAAvB,UACE,sBAAKl/D,UAAWS,EAAO2hB,QAAvB,SACGk3E,KAIH,uBACEt5F,UAAWS,EAAO2hB,QAClBliB,MAAO,CAAC+rD,WAAYqtC,GAAU,SAAW,WAF3C,UAIG/vG,GAAS,eAACie,GAAA,EAAD,CAAYxH,UAAWS,EAAOw8B,MAAO/zB,QAAQ,KAA7C,uBACV,uBAAKlJ,UAAWS,EAAO8Y,OAAvB,UACGla,GACCm5F,GACA,eAACe,GAAD,CAAS1d,QAASA,EAAS77E,UAAWS,EAAO22F,YAGjD,uBAAKp3F,UAAWS,EAAOw4D,OAAvB,UACE,gBAAC7mB,GAAD,WACE,eAACS,GAAD,CAAQ91C,QAAQ,aAAawD,QAAS44F,EAAtC,SACE,eAAC,KAAD,MAEF,eAACtmD,GAAD,CAAQ91C,QAAQ,oBAAoBwD,QAAS24F,EAA7C,SACG3vG,EAAQ,eAACiwG,GAAA,EAAD,IAAoB,eAACC,GAAA,EAAD,MAE/B,eAAC5mD,GAAD,CACE91C,QAAS87F,EACL,8CACA,qCAEJt4F,QAAS64F,EACTtmD,SAAU+lD,EANZ,SAQE,eAACa,GAAA,EAAD,MAEF,eAAC7mD,GAAD,CAAQ91C,QAAQ,gBAAgBwD,QAAS84F,EAAzC,SACE,eAACM,GAAA,EAAD,MAEDjB,GACC,eAAC7lD,GAAD,CAAQ91C,QAAQ,2BAA2BwD,QAAS,KAAQ0+C,EAAQrxD,KAAK8qG,EAAb,EAA5D,SACE,eAACkB,GAAA,EAAD,MAGJ,eAAC/mD,GAAD,CAAQ91C,QAAQ,UAAUwD,QAAS25C,EAAnC,SACE,eAAC,KAAD,SAGJ,eAACs7C,GAAD,CACEhxF,QAASA,EACT5B,KAAMA,EACN8iC,SAAUizD,EACVx5F,QAAS,IAAMy5F,EAAkB,QAEnC,gBAACz/C,GAAA,EAAD,CACE/9C,GAAG,gBACHsqC,SAAUA,EACV8U,mBAAoB,KACpB96C,aAAc,CAAEC,SAAU,SAAUC,WAAY,SAChDmmC,gBAAiB,CAAEpmC,SAAU,MAAOC,WAAY,SAChD66C,aAAW,EACX56C,KAAMA,EACNV,QAASg7C,EARX,UAUE,eAACpG,GAAA,EAAD,UACE,eAACE,GAAA,EAAD,CACEC,QACE,eAACtT,GAAA,EAAD,CACEE,QAAS82D,EACT9kD,SAAUglD,EACV/2D,SAAWpC,IAAYm6D,GAAclB,GAAW,EAAzB,EACvBz3F,MAAM,YAGV3M,MAAM,gBAVI,cAad,eAACugD,GAAA,EAAD,UACE,eAACE,GAAA,EAAD,CACEC,QACE,eAACtT,GAAA,EAAD,CACEE,QAAS22D,EACT3kD,SAAU6kD,EACV52D,SAAWpC,IAAYq6D,GAA4BvB,GAAsB,EAAlD,EACvBt3F,MAAM,YAGV3M,MAAM,4BAVI,aAad,eAACugD,GAAA,EAAD,UACE,eAACE,GAAA,EAAD,CACEC,QACE,eAACtT,GAAA,EAAD,CACEE,QAASi3D,EACTjlD,SAAUmlD,EACVl3D,SAAWpC,IAAYs6D,GAAalB,GAAU,EAAvB,EACvB53F,MAAM,YAGV3M,MAAM,0BAVI,aAad,eAAC+hG,GAAD,CAAe5rG,MAAO+rG,EAAU30D,SAAUg4D,EAAsBjmD,SAAU0kD,EAAiBx3F,UAAWS,EAAO44C,wBA3GvH,IAqJFi+C,GAAc1wD,aAAe,CAC3B2xD,YAAa,UAGAh5B,UAAsBD,GAAiB,4BAAjBA,CAA8Cg4B,KASnF,MAAMuC,GAAmBhxF,cAAYnI,IAC5B,CACLvD,KAAM,CACJwK,QAASjH,EAAMkH,QAAQ,IACvBk5D,UAAW,OACXjmC,UAAW,SACXwG,UAAW,OAEby4D,KAAM,CACJz4F,QAAS,OACT04F,oBAAqB,mBACrBC,QAAQ,GAAD,OAAKt5F,EAAMkH,QAAQ,IAAnB,cAA6BlH,EAAMkH,QAAQ,IAA3C,MACPy5B,UAAW,OAEb7tC,MAAO,CACLymG,YAAa,QACbC,UAAW,SACXC,WAAY,uBAEdC,OAAQ,CACNxgE,aAAc,OACd8F,OAAQ,iBACRu6D,YAAa,SACbC,UAAW,cAIJX,GAAUv7F,IAAMoI,MAAK,IAA2B,IAA1B,QAACy1E,EAAD,UAAU77E,GAAe,EAC1D,MAAMS,EAASo5F,KACT/kF,EAAalO,mBAAQ,KACzB,IAAIkO,EACJ,IACEA,EAAa+mE,EACV5vF,KAAIuB,IAAC,IAASA,EAAG4oF,OAAS5oF,EAAE4oF,WAC5Bp0D,MAAK,CAACvzB,EAAG2oB,IAAO3oB,EAAEi4F,aAAetvE,EAAEsvE,cAC9B,CAAR,MAAQ,CACV,OAAO5xE,CAAP,GACC,CAAC+mE,IAEJ,OAAO/mE,EACH,sBAAK9U,UAAW+iC,mBAAKtiC,EAAOtD,KAAM6C,GAAlC,SACA,sBAAKA,UAAWS,EAAOq5F,KAAvB,SACGje,GAAW/mE,EAAW7oB,KAAI41B,IACzB,MAAMu0D,EAlDhB,SAAmBA,GACjB,MAAM,GAAN,OAA8B,GAApBhqF,KAAKU,KAAKspF,GAApB,KACD,CAgDwBikB,CAAUx4E,EAAKu0D,QAC9B,OAAO,gBAAC,IAAM/uE,SAAP,WACL,sBACErH,UAAWS,EAAO25F,OAClBl6F,MAAO,CACLtD,gBAAiBilB,EAAK1hB,MACtBy6B,OAAQw7C,EACRz7C,MAAOy7C,KAGX,eAAC5uE,GAAA,EAAD,CAAYxH,UAAWS,EAAOjN,MAA9B,SAAsCquB,EAAKruB,UATjBquB,EAAKruB,MAAjC,QAcJ,IAnBJ,IC1VF,MACMoV,GAAYC,cAAYnI,IACrB,CACLvD,KAAM,CAAC,EACP+hE,UAAW,CACTvlC,SAAU,WACVgB,MAAO,OACPC,OAAQ,QAEVxY,QAAS,CACPuX,SAAU,WACV+2B,KAAM,EACNxuB,MAAO,EACPtC,IAAK,EACLkY,OAAQ,EACRz2C,QAAS,OACT09B,cAAe,UAEjBk6B,OAAQ,CACN53D,QAAS,OACT09B,cAAe,MACfgZ,OAAQ,GAEVq/C,OAAQ,CACNr/C,OAAQ,GACRpe,SAAU,WACV+2B,KAAM,EACN9wB,IAAK,EACLkY,OAAQ,GAEVjqC,SAAU,CACR,aAAc,CACZ1N,MAAOiyE,aAAM1xE,EAAMnE,QAAQ6D,OAAOghC,OAAQ,OAG9CnE,MAAO,CACLjD,aAAct5B,EAAMkH,QAAQ,IAE9B2R,OAAQ,CACNogB,SAAU,WACV0L,KAAM,EACN0S,OAAQ,EACRs/C,UAAW,EACXr9D,aAAct5B,EAAMkH,QAAQ,QAI5B0yF,GAAYt8F,IAAMoI,MAAK,IAatB,IAbuB,UAC5BpG,EAD4B,QAE5BV,EAF4B,KAG5B4C,EAH4B,eAI5Bq4F,EAJ4B,SAK5BC,EAL4B,OAM5B9B,EAN4B,YAO5BH,EAP4B,UAQ5BkC,EAR4B,UAS5BC,EAT4B,cAU5BlC,EAV4B,UAW5BvzD,EACA,cAAemO,GACX,EAEJ,MAAO1N,EAAUC,GAAe3nC,IAAMwI,SAAS,OACxCm0F,EAAYC,GAAiBp0F,oBAAS,IACtCixF,EAAsBoD,GAAgCr0F,oBAAS,IAC/DuxF,EAAU+C,GAAoBt0F,oBAAS,IACvCkxE,EAAQqjB,GAAav0F,mBAAS,QAC9By2E,EAAK+d,GAAUx0F,mBAAS,SACxB2+D,EAAM81B,GAAgBz0F,oBAAS,IAC/B00F,EAAYC,GAAiB30F,oBAAS,IACtC40F,EAAUC,GAAe70F,oBAAS,IAClCoxF,EAAW0D,GAAqB90F,oBAAS,IACzCq1E,EAAS0f,GAAc/0F,sBACvBsqC,EAAS1tC,GAAcoD,oBAAS,IAChCg1F,EAAOC,GAAYj1F,oBAAS,GAC7Bk1F,EAAazpD,KACbqmD,GAAkB,IAATp2F,EAET42F,EAAe3rF,uBAAY,SAACxjB,GAA2B,IAApByV,EAAmB,wDAE1D,GADAk8F,EAAkB3xG,GAClB,OAAIgyG,QAAJ,IAAIA,KAAWnlF,QACb,IACEmlF,EAAUnlF,QAAQ8jE,MAAM,CAAC5P,QAAS/gF,IAC9ByV,GAAQu8F,EAAUnlF,QAAQpX,QAE/B,CADC,MAAO0C,GACR,CAEJ,GAAE,IAEG85F,EAAUzuF,uBAAY,SAACxjB,EAAOiuG,GAA+B,IAApBx4F,EAAmB,wDAEhE,GADA67F,EAAatxG,GACb,OAAIgyG,QAAJ,IAAIA,KAAWnlF,QACb,IACImlF,EAAUnlF,QAAQ2uD,KAAKx7E,GACvBgyG,EAAUnlF,QAAQ8jE,MAAM,CAAC5P,QAASktB,IAChCx4F,GAAQu8F,EAAUnlF,QAAQpX,QAE/B,CADC,MAAO0C,GACR,CAEJ,GAAE,IAEG+5F,EAA0B1uF,uBAAY,SAACxjB,GAA2B,IAApByV,EAAmB,wDAErE,GADAy7F,EAA6BlxG,GAC7B,OAAIgyG,QAAJ,IAAIA,KAAWnlF,QACb,IACImlF,EAAUnlF,QAAQskE,iBAAiB,CAACpQ,QAAS/gF,IAC3CyV,GAAQu8F,EAAUnlF,QAAQpX,QAE/B,CADC,MAAO0C,GACR,CAEJ,GAAE,IAEGm3F,EAAc9rF,uBAAY,SAACxjB,GAA2B,IAApByV,EAAmB,wDAEzD,GADA07F,EAAiBnxG,GACjB,OAAIgyG,QAAJ,IAAIA,KAAWnlF,QACb,IACImlF,EAAUnlF,QAAQvpB,KAAK,CAACy9E,QAAS/gF,IAC/ByV,GAAQu8F,EAAUnlF,QAAQpX,QAE/B,CADC,MAAO0C,GACR,CAEJ,GAAE,IAGGm9C,EAAUW,cACV//C,EAAOkb,QAAQ2qB,GACfo2D,EAAWx1E,kBAAO,GAClBq1E,EAAYr1E,iBAAO,MACnBy1E,EAAez1E,iBAAO,MACtB7lB,GAASmI,GAAUtJ,GACnB4lC,IAAgBzhB,kBAAO,OAACwhB,QAAD,IAACA,OAAD,EAACA,EAAWA,WACnCs4C,GAAS32E,mBAAQ,yBAAM1E,QAAN,IAAMA,GAAN,UAAMA,EAAMlU,iBAAZ,aAAM,EAAiBM,MAAvB,GAA+B,CAAC4T,IACjD85F,GAAUp1F,mBAAQ,KACtB,MAAMo1F,IAAU,OAAC95F,QAAD,IAACA,MAAMjV,QAElBgvG,sBAAY/5F,EAAKjV,MAAMg9B,OAAMl1B,GAAW,IAANA,IAKvC,OAHKinG,GAAW95F,IACdA,EAAKjV,UAAO4C,GAEPmsG,CAAP,GACC,CAAC95F,IAMEg6F,GAAY/uF,uBAAYkX,IAKf,OAATA,GAAuC,OAAtBs3E,EAAUnlF,SAAoB6N,IAAS03E,EAAavlF,UACvEmlF,EAAUnlF,QAAQq7D,kBAAkBxtD,GAAM,GAC1Cs3E,EAAUnlF,QAAQymE,IAAIA,EA1JV,IA2JZ0e,EAAUnlF,QAAQpX,UAEpB28F,EAAavlF,QAAU6N,CAAvB,GACC,CAAC44D,IAQEkf,GAAahvF,uBAAYsc,MAAOrc,EAAQuuF,WACtCr/E,IAAM,KAAO,IAAD,EAGhB,MACM8/E,GADM,OAAGhvF,QAAH,IAAGA,GAAH,UAAGA,EAAQpf,iBAAX,aAAG,EAAmBM,SACF,IAC1BqK,EAAU,CACdw4E,SAAU,CACRv0E,gBAAiB,CAAC,UAAW,GAC7Bq0E,UAAW,CAACvG,QAAS0xB,GACrBprB,gBAAiB,EACjBE,QAAS,CAACxG,SAAS,IAErB0P,MAAO,CACLD,WAAYiiB,EAAgB,IAAM,IAClCliB,QAAS,CAACxP,QAAS0xB,IAErB9hB,MAAO,CACL5P,SAAS,EACTyP,WAAYiiB,EAAgB,IAAM,IAClCliB,QAAS,CAACxP,QAAS0xB,KAGvBT,EAAUnlF,QAAU,IAAIqiE,GAAgBkjB,EAAavlF,QAAS7d,GAC9DgjG,EAAUnlF,QAAQklE,KAAKtuE,GACvBuuF,EAAUnlF,QAAQ86D,SAAS,CAACvB,oBAAoB,IAGhD,MAAM8L,EAAUrjF,OAAOC,QAAQkjG,EAAUnlF,QAAQo2B,UAC9C3gD,KAAI,QAAEuH,EAAOvF,GAAT,QAAoB,CACvBuF,MAAOA,EACP2M,MAAOlS,EAAK,GACZmoF,OAAQnoF,EAAK,GACby4F,aAAciV,EAAUnlF,QAAQkjE,eAAelmF,GAJ5C,IAMP+nG,EAAW1f,EAAX,GAlCF,GAoCC,IAGHn1E,qBAAU,KACHxE,IACL45F,EAAStlF,SAAU,EACnBilF,GAAS,GACTr4F,GAAW,IAINg4F,GACC7d,GAASkd,EACXU,GAAc,GAOlBgB,GAAWj6F,EAAMy5F,GACd13F,MAAMy3F,GACN9pD,SAAQ,KACP6pD,GAAS,GACTK,EAAStlF,SAAU,CAAnB,IAJJ,GAMC,CAACtU,EAAMq7E,GAAQ6d,EAAUX,EAAWiB,EAAYS,KAMnDz1F,qBAAU,KACR,IAAK80F,IAAUM,EAAStlF,QACtB,OAIFmlF,EAAUnlF,QAAQs9D,cAClB6nB,EAAUnlF,QAAQg9D,YAAY,CAAC,EAAG,EAAG,EAAG,IAIxC,IAAIkE,EAAS,MACTuF,EAAM,OACNof,EAAiB9e,GAASmd,EAC1BrnB,EAAY,CACd,CAAC,EAAG,EAAG,EAAG,IACV,CAAC,EAAG,EAAG,EAAG,KAERgF,EAAa2jB,GACb,CACA,CAAC,KAAM,KACP,CAAC,QAAS,WAEVnsG,EACa,iBAAb2qG,GAA4C,cAAbA,IACV,SAAnBD,GACF7iB,EAAS,MACTW,EAAa,CACX,CAAC,KAAM,KACP,CAAC,QAAS,OAEgB,OAAnBkiB,GACT7iB,EAAS,MACTW,EAAa,CACX,CAAC,QAAS,KACV,CAAC,KAAM,MAEThF,EAAY,CACV,CAAC,EAAG,EAAG,GAAI,MAEe,OAAnBknB,IACT7iB,EAAS,MACTW,EAAa,CACX,CAAC,QAAS,MAEZhF,EAAY,CACV,CAAC,EAAG,EAAG,GAAI,IACX,CAAC,EAAG,EAAG,EAAG,IACV,CAAC,EAAG,EAAG,EAAG,OAMZ5vD,kBAAO,OAACwhB,QAAD,IAACA,OAAD,EAACA,EAAWA,YACrB02D,EAAUnlF,QAAQ4jE,QAClBiiB,EAAiB9e,GAASmd,EAC1B5B,EAAauD,GAAgB,GACzBL,KACF/C,GAAY,GACZ4C,GAAwB,MAI1BnkB,EAASzyC,EAAUq3D,YAAcr3D,EAAUs3D,MAAQ7kB,EACnDuF,EAAMh4C,EAAUq3D,YAAcr3D,EAAUs3D,MAAQ,OAChDZ,EAAUnlF,QAAQ4jE,MAAM,CACtB,CAAC3/C,QAAS,GACV,CAACA,QAAS,GAAK7hC,QAASqsC,EAAUu+C,aAClC,CAAC/oD,QAAS,EAAG7hC,QAASqsC,EAAUA,aAG7BA,EAAUq3D,cACbD,GAAiB,EACjBvD,EAAauD,GAAgB,IAE3BL,KACF/C,GAAah0D,EAAUq3D,aACvBT,GAAyB52D,EAAUq3D,eAGnCN,KACFJ,GAAQ,EAAMS,GAAgB,GAC9BV,EAAUnlF,QAAQynB,MAAMo6C,IAE1BsjB,EAAUnlF,QAAQ48D,OAAOC,GACzBsoB,EAAUnlF,QAAQkhE,OAAOA,GACzBikB,EAAUnlF,QAAQymE,IAAIA,EAlUR,IAmUd0e,EAAUnlF,QAAQpX,SAClBu8F,EAAUnlF,QAAQo9D,kBAClBonB,EAAO/d,GACP8d,EAAUrjB,GACVt0E,GAAW,EAAX,GAEC,CAAC6hC,EAAWu2D,IAGf,MAAMthD,GAAW/sC,uBAAawxB,IAC5BgH,EAAYhH,EAAMkH,cAAlB,GACC,IAEGsU,GAAYhtC,uBAAY,KAC5Bw4B,EAAY,KAAZ,GACC,IAEG62D,GAAmBrvF,uBAAY,KACnCytF,GAAeD,EAAf,GACC,CAACA,IAEEtB,GAAoBlsF,uBAAY,KACpCwuF,EAAUnlF,QAAQs7D,eAAeymB,EAAjC,GACC,CAACA,IAEEY,GAAchsF,uBAAY,KAC9BwuF,EAAUnlF,QAAQs9D,cAClB6nB,EAAUnlF,QAAQkhE,OAAOA,GACzBikB,EAAUnlF,QAAQymE,IAAIA,EA/VR,IAgWd0e,EAAUnlF,QAAQpX,QAAlB,GACC,CAACs4E,EAAQuF,IAGNqc,GAAU1yF,mBAAQ,IAClBs0F,EACK,eAAC97B,GAAA,EAAD,CACLC,SAAS,OACTj/D,OACE,eAACgJ,GAAA,EAAD,CAAQjJ,MAAM,UAAUG,KAAK,QAAQC,QAAS,KAC5C46F,GAAc,GACdE,GAAY,EAAZ,EAFF,iBAHG,mFAW+DZ,EAX/D,4EAW4Ild,GAX5I,aAaEzsC,EACF,eAAC,GAAD,CAAavpC,OAAQ,IACnB+wF,EACF,eAACxxB,GAAD,CAAQv/D,OAAQ,IAElB,MACN,CAACupC,EAASysC,GAAQ+a,EAAQ4C,EAAYT,IAEzC,OAAO,eAACrE,GAAD,CACL,cAAahjD,EACbpzC,UAAW+iC,mBAAKtiC,GAAOtD,KAAM6C,GAC7BzW,MAAOoxG,EACPtE,QAASmG,GAJJ,SAML,uBAAKx8F,UAAWS,GAAOy+D,UAAvB,UAEE,sBAAKl/D,UAAWS,GAAO2hB,QAAvB,SACGk3E,KAIH,uBACEt5F,UAAWS,GAAO2hB,QAClBliB,MAAO,CAAC+rD,WAAYqtC,GAAU,SAAW,WAF3C,UAIGqB,GAAc,eAACnzF,GAAA,EAAD,CAAYxH,UAAWS,GAAOw8B,MAAO/zB,QAAQ,KAA7C,uBACf,sBAAKlJ,UAAWS,GAAO8Y,OAAQ2H,IAAKg7E,GAApC,UACI1D,GACA,eAACe,GAAD,CAAS1d,QAASA,EAAS77E,UAAWS,GAAO22F,WAGjD,uBAAKp3F,UAAWS,GAAOw4D,OAAvB,UACE,gBAAC7mB,GAAD,WACE,eAACS,GAAD,CAAQ91C,QAAQ,aAAawD,QAAS44F,GAAtC,SACE,eAAC,KAAD,MAEF,eAACtmD,GAAD,CAAQ91C,QAAQ,oBAAoBwD,QAASi8F,GAA7C,SACG7B,EAAa,eAACnB,GAAA,EAAD,IAAoB,eAACC,GAAA,EAAD,MAEpC,eAAC5mD,GAAD,CAAQ91C,QAAQ,gBAAgBwD,QAAS84F,GAAzC,SACE,eAACM,GAAA,EAAD,MAEDjB,GACC,eAAC7lD,GAAD,CAAQ91C,QAAQ,2BAA2BwD,QAAS,KAAQ0+C,EAAQrxD,KAAK8qG,EAAb,EAA5D,SACE,eAACkB,GAAA,EAAD,MAGJ,eAAC/mD,GAAD,CAAQ91C,QAAQ,UAAUwD,QAAS25C,GAAnC,SACE,eAAC,KAAD,SAGJ,gBAACf,GAAA,EAAD,CACE/9C,GAAG,gBACHsqC,SAAUA,EACV8U,mBAAoB,KACpB96C,aAAc,CAAEC,SAAU,SAAUC,WAAY,SAChDmmC,gBAAiB,CAAEpmC,SAAU,MAAOC,WAAY,SAChD66C,aAAW,EACX56C,KAAMA,EACNV,QAASg7C,GARX,UAUA,eAACpG,GAAA,EAAD,UACE,eAACE,GAAA,EAAD,CACEC,QACE,eAACtT,GAAA,EAAD,CACEE,SAASoE,IAAuB0yD,EAChC9kD,SAAU5N,GACVnE,SAAWpC,IAAYm6D,GAAclB,GAAW,EAAzB,EACvBz3F,MAAM,YAGV3M,MAAM,gBAVI,cAad,eAACugD,GAAA,EAAD,UACE,eAACE,GAAA,EAAD,CACEC,QACE,eAACtT,GAAA,EAAD,CACEE,UAAUk7D,KAAmB92D,IAAgBD,EAAUq3D,YAAc7E,GACrE3kD,UAAWkpD,IAAiB92D,GAC5BnE,SAAWpC,IAAYk9D,GAAyBpE,GAAsB,EAA/C,EACvBt3F,MAAM,YAGV3M,MAAM,4BAVI,aAad,eAACugD,GAAA,EAAD,UACE,eAACE,GAAA,EAAD,CACEC,QACE,eAACtT,GAAA,EAAD,CACEE,UAAUk7D,KAAmB92D,IAAgBD,EAAUq3D,YAAcvE,GACrEjlD,UAAWkpD,IAAiB92D,GAC5BnE,SAAWpC,IAAYs6D,GAAalB,GAAU,EAAvB,EACvB53F,MAAM,YAGV3M,MAAM,0BAVI,aAad,eAACugD,GAAA,EAAD,UACE,eAACE,GAAA,EAAD,CACEC,QACE,eAACtT,GAAA,EAAD,CACEE,UAAUk7D,IAAkB72B,EAC5BryB,UAAWkpD,IAAiB92D,GAC5BnE,SAAWpC,IAAYi9D,GAASz2B,EAAMyyB,GAAW,EAA1B,EACvBz3F,MAAM,YAGV3M,MAAM,oBAVI,qBA5FtB,IAkJF8mG,GAAU1zD,aAAe,CACvB2xD,YAAa,YACbkC,UAAW,IACXC,UAAW,IAGEn7B,UAAsBD,GAAiB,4BAAjBA,CAA8Cg7B,KC1iBnFmC,KAAMC,oBAAoBC,UAA1B,wDAAuFF,KAAMrjG,QAA7F,kBAEA,MAAMwjG,GAAuB/zF,cAAWnI,IAAK,CAC3Cm8F,oBAAqB,CACnBliE,MAAO,OACPC,OAAQ,OACRv5B,QAAS,eACTw4B,SAAU,QAEZijE,IAAK,CACHnG,UAAW,OACXp7D,SAAU,YAKRwhE,GAAa,CACjBjrG,KAAM,OACNkrG,eAAgB,CAAC,MAAO,OAAQ,MAAO,MAAO,MAAO,OACrDC,eAAgB,KAChBC,mBAAoB,KACpBviE,MAAO,IACPv7B,OAAQ,IAAyB,IAAxB,SAAEwe,EAAF,KAAYhb,GAAW,EAC9B,OAAO,eAACu6F,GAAD,CAAiBv/E,SAAUA,EAAUhb,KAAMA,GAAlD,GAgFSwmB,GAAU,CAAC2zE,GA7EN,CAChBjrG,KAAM,QACNkrG,eAAgB,CAAC,MAAO,MAAO,OAAQ,MAAO,MAAO,OACrDE,mBAAoB,IACpB99F,OAAQ,IAA2C,IAA1C,QAAEE,EAAF,IAAW7H,EAAX,mBAAgB2lG,GAAyB,EAChD,OAAO,sBACLC,IAAK5lG,EAAKuI,UAAWV,EAAQw9F,IAC7BQ,IAAI,aAAa9+F,QAAS,IAAM4+F,GAAmB,IAFrD,GAMe,CACjBtrG,KAAM,OACNkrG,eAAgB,CAAC,QACjBE,mBAAoB,IACpBK,oBAAoB,EACpB5iE,MAAO,cACPv7B,OAAQ,IAAwB,IAAvB,QAAEE,EAAF,KAAW4C,GAAW,EAI7B,MAH4B,kBAAjBA,EAAKsU,UACdtU,EAAKsU,QAAUrhB,KAAKC,MAAM8M,EAAKsU,UAG/B,eAAClP,GAAA,EAAD,CAAKtH,UAAWV,EAAQu9F,oBAAxB,SACE,eAAC,KAAD,CAAWQ,IAAKn7F,EAAKsU,QAASgnF,iBAAiB,EAAO93B,UAAW,EAAG+3B,mBAAmB,KAF3F,GAOc,CAChB3rG,KAAM,MACNkrG,eAAgB,CAAC,OACjBE,mBAAoB,IACpBviE,MAAO,IACPv7B,OAAQ,IAAkC,IAAjC,IAAE3H,EAAF,mBAAO2lG,GAAyB,EACvC,OAAO,eAACM,GAAD,CACL39B,KAAM,CAAEtoE,IAAKA,EAAKkmG,iBAAiB,GACnCp/F,MAAQA,IACNO,QAAQC,IAAIR,GACZ6+F,GAAmB,EAAnB,GAJJ,GAUkB,CACpBtrG,KAAM,OACNkrG,eAAgB,CAAC,KAAM,MAAO,OAAQ,MAAO,KAAM,MAAO,OAAQ,MAAO,MAAO,SAAU,SAAU,MAAO,WAC3GE,mBAAoB,IACpBviE,MAAO,cACPv7B,OAAQ,QAAC,SAAEwe,EAAF,KAAYhb,GAAb,SAAwB,eAAC,GAAD,CAAO6oB,UAAW7N,EAAUuE,SAAUvf,GAA9D,GAEQ,CAChB9Q,KAAM,MACNkrG,eAAgB,CAAC,OACjBE,mBAAoB,IACpBK,oBAAoB,EACpB5iE,MAAO,IACPv7B,OAAQ,IAAe,IAAd,KAAE8C,GAAW,EACpB,GAA4B,kBAAjBA,EAAKsU,QAAsB,CACpC,MAAMonF,EAAUC,8BAAmB37F,EAAKsU,SAClCsnF,EAAeF,EAAQplG,OAAOK,KAAK+kG,GAAS,IAC5CG,EAAgB,CACpB9wG,KAAM6wG,EAAa1rG,WACnBiB,IAAKyqG,EAAaxrG,UAClBtE,UAAW8vG,EAAavrG,gBACxBspF,QAASiiB,EAAa7rG,wBAExBiQ,EAAKsU,QAAUunF,CAChB,CACD,OACE,sBAAK79F,MAAO,CAAE06B,OAAQ,IAAKD,MAAO,KAAlC,SACE,eAAC,GAAD,CAAWz4B,KAAMA,EAAKsU,WAF1B,IAqGWwnF,OA3FKhgG,IAAMoI,MAAK,IAA+B,IAA9B,SAAEwX,EAAF,KAAYhb,EAAZ,KAAkBtC,GAAW,EAC3D,MAAMhB,EAAUs9F,MACV,IAAEr6F,EAAF,KAAOiD,GAASyB,MAChB,WAAE9I,GAAemD,KAGjB28F,EAAgBr7F,EAAKrM,MAAM,KAAK8Z,MAAMyH,cAC5C,IAAIomF,GAAc,EACdC,EAAiBpB,GACrB,IAAK,MAAMqB,KAAUh1E,GACnB,GAAIg1E,EAAOpB,eAAe3tG,SAAS4uG,IAC7B39F,GAAQ69F,EAAelB,gBAAkB,KAAO,CAClDkB,EAAiBC,EACjBF,EAAc59F,EAAO89F,EAAOlB,mBAC5B,KACD,CAIL,MAAOmB,EAASC,GAAc93F,mBAAS03F,IAChCK,EAAiBnB,GAAsB52F,oBAAS,IAChDg4F,EAAmBC,GAAwBj4F,oBAAS,GAErDtE,EAAOokB,oBACNo4E,EAAYC,GAAiBn4F,oBAAS,GAEvCo4F,EAAch8F,EAAKrM,MAAM,KAAKtK,KAAIwqB,GAAWuK,mBAAmBvK,KAAU1a,KAAK,KACrF,IA+BIqmB,EA/BA3qB,EAAG,UAAM8B,EAAN,uBAA4BqkB,EAA5B,gBAA4CghF,GAqBnD,GApBInnG,EAAIkH,WAAW,OACjBlH,EAAG,UAAME,OAAOC,SAASC,QAAtB,OAA+BJ,IAGpCiP,qBAAU,KACJ23F,IAAYE,GAAmBJ,EAAeZ,yBAAuC1tG,IAAjBqS,EAAKsU,UAE3EtU,EAAKsU,QAAU,KACfjU,EAAIQ,IAAItL,GACLsM,MAAKhC,IACJG,EAAKsU,QAAUzU,EACf48F,GAAc,EAAd,IAED16F,OAAM1F,IACL6+F,GAAmB,GACnBj/F,EAAWI,EAAX,IAEL,GACA,CAAC8/F,EAASE,EAAiBJ,EAAgB34F,EAAM/N,EAAKyK,EAAMw8F,EAAYC,EAAep8F,EAAKpE,KAE1FkgG,EACH,OACE,eAAC/2F,GAAA,EAAD,CAAKC,OAAQ,EAAG0zB,UAAU,SAA1B,SACE,gBAAC7xB,GAAA,EAAD,CAAQ7I,QAAS,IAAM+9F,GAAW,GAAOp1F,QAAQ,YAAY5I,KAAK,QAAQH,MAAM,UAAhF,0BACgBg+F,EAAersG,KAD/B,eAQN,GAAIqsG,EAAeZ,qBAAuBmB,EAExCt8E,EAAU,eAAC5a,GAAA,EAAD,8BACL,GAAK+2F,EAkBVn8E,EAZUo8E,EAYAzB,GAAW39F,OAAO,CAAEwe,WAAUhb,OAAMnL,MAAKyK,OAAMk7F,qBAAoB99F,YAT3E,gBAACgI,GAAA,EAAD,CAAK2zB,UAAU,SAAf,UACE,gBAACzzB,GAAA,EAAD,CAAYrH,MAAM,QAAlB,iCAA+Cg+F,EAAersG,KAA9D,+BACA,eAACsX,GAAA,EAAD,CAAQ7I,QAAS,IAAMk+F,GAAqB,GAAOv1F,QAAQ,YAAY5I,KAAK,QAAQH,MAAM,UAA1F,2CAVJ,IACEiiB,EAAU+7E,EAAe/+F,OAAO,CAAEwe,WAAUhb,OAAMnL,MAAKyK,OAAMk7F,qBAAoB99F,WAGlF,CAFC,MAAOf,GAER,CAeH,OAAO,eAAC+I,GAAA,EAAD,CAAK0yB,aAAc,EAAGyJ,SAAU,EAAG9I,MAAK,UAAKwjE,EAAexjE,OAAS,IAA7B,MAAsCd,SAAS,SAAvF,SACJzX,GADH,IAWF,MAAMy8E,GAA2Bh2F,cAAWnI,IAAK,CAC/Co+F,aAAc,CACZlkE,OAAQ,OACRC,UAAW,OACXj+B,gBAAiB8D,EAAMnE,QAAQC,QAAQb,MAEzCojG,aAAc,CACZx3F,OAAQ7G,EAAMkH,QAAQ,GACtBD,QAAS,EACTtG,QAAS,eACTlB,MAAOO,EAAMnE,QAAQC,QAAQolC,aAC7BxlC,WAAY,yDACZa,SAAU,GACVu1C,SAAU,YAGd,SAAS2qD,GAAT,GAA8C,IAArB,SAAEv/E,EAAF,KAAYhb,GAAQ,EAC3C,MAAMtD,EAAUu/F,MACV,IAAEt8F,GAAQ0E,MACV,WAAE9I,GAAemD,MAChB09F,EAAUC,GAAez4F,mBAAS,OAClCq+B,EAASq6D,GAAc14F,oBAAS,GACjCsqC,EAAUxqB,kBAAO,IAChB64E,EAAYC,GAAiB54F,oBAAS,GACvCm8D,EAAOa,KAEPo7B,EAAch8F,EAAKrM,MAAM,KAAKtK,KAAIwqB,GAAWuK,mBAAmBvK,KAAU1a,KAAK,KAE/E6oC,EAAWz3B,uBAAYsc,WAKvBob,GAAYiM,EAAQt6B,SAAY2oF,IAClCruD,EAAQt6B,SAAU,EAClBjU,EAAIQ,IAAJ,mBACc6a,EADd,gBAC8BghF,GAC5B,CACEppF,QAAgB,OAARwpF,QAAQ,IAARA,OAAA,EAAAA,EAAU1wG,SAAU,EAC5BA,OAAQ,MACR49B,YAAY,EACZC,kBAAkB,GAEpB,CACEC,kBAAmB,GACnB2pE,aAAc,SAEfhyF,MAAKqe,IAKJ,MAAMi9E,EAASj9E,EAAQ9hB,KAEvB,OADA4+F,EAAsB,QAAXG,GACJj9E,EAAQ9xB,MAAf,IAEDyT,MAAKzT,IACJ2uG,GAAYvxF,IAAQA,GAAO,KAAOpd,GAAQ,KAA1C,IAED2T,OAAM1F,IACL6gG,GAAc,GACdH,GAAYvxF,IAAQA,GAAO,IAAM,qCACjCvP,EAAWI,EAAX,IAEDqzC,SAAQ,KAAQd,EAAQt6B,SAAU,CAAlB,IACpB,GACA,CAACoH,EAAUghF,EAAa9tD,EAASquD,EAAYC,EAAev6D,EAASq6D,EAAYD,EAAa18F,EAAKpE,EAAY6gG,IASlH,OAPAt4F,qBAAU,KAES,OAAbs4F,GAAsBluD,EAAQt6B,SAChCouB,GACD,GACA,CAACo6D,EAAUluD,EAASlM,IAGrB,sBAAK5kC,UAAWV,EAAQw/F,aAAxB,SACE,eAAC,KAAD,CACEn6D,UAAW,EACXC,SAAUA,EACVC,QAASA,EACTC,WAAW,EACXC,gBAAiB,IAAM49B,EAAKgB,aAAantD,WACvB,OAAbwoF,EAAoB,CAAE,cAAe9hF,IAA6B,CAAC,EAN1E,SAQE,uBAAKld,UAAWV,EAAQy/F,aAAxB,UACGC,GAAY,GADf,aAOP,CAMD,MAAMM,GAA0Bz2F,cAAWnI,IAAK,CAC9Co+F,aAAc,CACZlkE,OAAQ,OACRC,UAAW,SACXimC,UAAW,SACXphC,OAAQ,gCACR7iC,UAAW,cAEb0iG,QAAS,CACP7/D,OAAQ,sBAGNg+D,GAAiB1/F,IAAMoI,MAAK7G,IAChC,MAAMD,EAAUggG,KACV37B,EAAer9C,oBACdk5E,EAAUC,GAAej5F,mBAAS,OAClCk5F,EAAWC,GAAgBn5F,qBAYlC,OAVAw7D,2BAAgB,KACV2B,EAAantD,SACfmpF,EAAah8B,EAAantD,QAAQwlC,YAAc,GACjD,GACA,IAOD,sBAAKh8C,UAAWV,EAAQw/F,aAAc59E,IAAKyiD,EAA3C,SACE,eAAC,KAAD,CAAUi8B,cANd,YAA8C,IAAf,SAAEJ,GAAY,EAC3CC,EAAYD,EACb,EAImDK,WAAW,SAAUtgG,EAArE,SACGigG,GAAYE,GACX7qG,MAAM2qG,GAAU1qG,OAAO7I,KAAI,CAACm6D,EAAG55D,IAC7B,sBAAKwT,UAAWV,EAAQigG,QAAxB,SACE,eAAC,KAAD,CAAMO,WAAYtzG,EAAI,EAA2BmuC,MAAO+kE,GAAxD,iBAAwClzG,EAAI,KAD9C,oBAAmDA,EAAI,SALjE,IC3RWuzG,GAAiBl1E,IAC5B,MAAM,QAACrmB,GAAWjD,qBAAWy+F,KAAiB,CAAC,EAE/C,OADsB1wE,GAAiB/1B,EAASiL,GAAS,EAAMqmB,EAC/D,EAMWo1E,GAAkB,IACtB1+F,qBAAWy+F,IAOdA,GAAehiG,IAAMC,gBACdiiG,GAAeliG,IAAMoI,MAAK,IAAiC,IAAhC,QAAC5B,EAAD,MAAU27F,EAAV,SAAiB9gG,GAAc,EACrE,MAAMkwB,EAAYpJ,KAClBoJ,EAAUJ,cAAc3qB,GAGxBkC,qBAAU,KACR6oB,EAAU/I,cAAchQ,QAAxB,UAAqCjd,EAArC,YAAgDiL,GACzC,KAAQ+qB,EAAU/I,cAAchQ,aAAU3mB,CAAlC,IACd,CAAC0/B,EAAW/qB,IAGf,MAAM47F,EAAax5F,mBAAQ,KAAO,IAAD,EAE/B,OADmBu5F,IAAK,OAAIzmG,QAAJ,IAAIA,GAAJ,UAAIA,EAAI0e,aAAR,aAAI,EAAW+nF,aAClBtwG,CAArB,GACC,CAACswG,IAEEx2G,EAAQid,mBAAQ,MAAQpC,UAAS27F,MAAOC,KAAc,CAAC57F,EAAS47F,IACtE,OAAO,eAAC,GAAa5gG,SAAd,CAAuB7V,MAAOA,EAA9B,SACJ0V,GADH,I,+CC7EF,MAAMghG,GAAmBriG,IAAMC,gBAExB,SAASqiG,KACd,OAAO/+F,qBAAW8+F,GACnB,CAED,MAAME,GAAqB,CACzB,QAAW,SACX,SAAY,eACZ,QAAW,OACX,SAAY,UAGRC,GAAoB,CACxB,SAAY,cACZ,QAAW,QAGPC,GAAeziG,IAAMoI,MAAK,SAAsB7G,GACpD,OAAO,eAAC6J,GAAA,EAAD,CAAQjJ,MAAM,UAAU+I,QAAQ,YAAY5I,KAAK,WAAYf,GACrE,IAEYmhG,GAAmB1iG,IAAMoI,MAAK,WACzC,MAAM,KAACtU,EAAD,OAAO6uG,EAAP,KAAeC,EAAf,MAAqBtiG,GAASgiG,KACpC,OACE,gBAACh5F,GAAA,EAAD,CAAKjG,QAAQ,OAAO09B,cAAc,MAAlC,UACE,eAAC,GAAD,CAAc80B,WAAS,EAAC/hE,KAAMA,EAAMyO,QAASogG,EAAQ7tD,SAAoB,aAAVx0C,GAAkC,aAAVA,IAAyBA,EAAhH,SACGiiG,GAAmBjiG,IAAU,mBAEpB,YAAVA,GAAiC,aAAVA,IACvB,eAACgJ,GAAA,EAAD,CAAK+B,WAAY,EAAjB,SACE,eAAC,GAAD,CAAclJ,MAAM,UAAU0zD,WAAS,EAACtzD,QAASqgG,EAAM9tD,SAAoB,aAAVx0C,EAAjE,SACGkiG,GAAkBliG,SAM9B,IAKKsK,GAAYC,cAAWnI,IAAK,CAChCvD,KAAM,CAAC,EACP0jG,UAAW,CACTjmE,OAAQ,QAEVkmE,SAAU,CACR7lE,UAAW,SACXL,OAAQ,OACRD,MAAO,OACP7yB,YAAapH,EAAMkH,QAAQ,IAE7BxH,OAAQ,CACNs5B,UAAW,EACX5xB,YAAa,OA2GFi5F,OAvGG/iG,IAAMoI,MAAK,YAAsD,IAAnC,KAAC46F,EAAD,SAAOpjF,EAAP,KAAiBhb,EAAjB,SAAuBvD,GAAW,EAChF,MAAM,KAACvN,EAAD,MAAOmrC,EAAP,QAAc7jC,EAAd,YAAuB6I,EAAvB,kBAAoCg/F,EAApC,KAAuD9pD,EAAvD,YAA6D+pD,EAA7D,UAA0EC,GAAaH,EACvFvgG,EAASmI,MACT,IAACrG,GAAO0E,MACR,WAAC9I,GAAcmD,MAEdhD,EAAOY,GAAYsH,mBAAS,WAE7B46F,EAAgBj0F,uBAAY,IACzB5K,EAAIQ,IAAJ,gBAAiBjR,IACrBiS,MAAKhC,GACGA,EAASG,KAAK5D,QACpB2F,MAAM9F,IACV,CAACoE,EAAKpE,EAAYrM,IAErB4U,qBAAU,KACR,MAAM26F,EAAaD,IACfC,GACFA,EAAWt9F,MAAMs9F,IACfniG,EAASmiG,EAAT,GAEH,GACA,CAACniG,EAAUkiG,IAEd,MAAMT,EAASxzF,uBAAY,KAEzBjO,EAAS,YACTqD,EAAIgC,KAAJ,gBAAkBzS,EAAlB,sBAAoC8rB,IACjC7Z,MAAMhC,IACLjD,QAAQC,IAAIgD,GACZ,IAAIu/F,EAAO,UAAM9nG,EAAN,iBAAwBuI,EAASw/F,SAAjC,YAA6Cx/F,EAASi/F,MAC7DG,GAAap/F,EAASy/F,kBAAoB5+F,IACxCs+F,IACFI,EAAO,UAAMA,EAAN,YAAiBJ,IAE1BI,EAAO,UAAMA,EAAN,YAAiBv/F,EAASy/F,iBAA1B,YAA8C5+F,IAEvD9D,QAAQC,IAAIuiG,GACZ3pG,OAAOkI,KAAKyhG,EAASxvG,GACrBoN,EAAS6C,EAASG,KAAK5D,MAAvB,IAED2F,OAAM/F,IACLC,EAAWD,GACXgB,EAAS,UAAT,GAhBJ,GAkBC,CAACA,EAAUqD,EAAKpE,EAAYrM,EAAMqvG,EAAWvjF,EAAUhb,EAAMs+F,IAE1DN,EAAOzzF,uBAAY,KACvBjO,EAAS,YACTqD,EAAIyC,OAAJ,gBAAoBlT,IACjBiS,MAAMhC,IACLjD,QAAQC,IAAIgD,GACZ7C,EAAS,UAAT,IAED+E,MAAM9F,EALT,GAMC,CAACoE,EAAKpE,EAAYe,EAAUpN,IAEzBnI,EAAQid,mBAAQ,MACpBtI,MAAOA,EACPqiG,OAAQA,EACRC,KAAMA,KACHI,KACD,CAACA,EAAM1iG,EAAOqiG,EAAQC,IAE1B,OAAIvhG,EAEA,eAACghG,GAAiB7gG,SAAlB,CAA2B7V,MAAOA,EAAlC,SACG0V,IAML,eAACghG,GAAiB7gG,SAAlB,CAA2B7V,MAAOA,EAAlC,SACE,gBAAC2d,GAAA,EAAD,CAAKm6F,QAAS,EAAd,UACE,gBAACn6F,GAAA,EAAD,CAAKjG,QAAQ,OAAO09B,cAAc,MAAM/E,aAAc,EAAtD,UACGmd,EACC,eAAC,KAAD,CAAM73C,QAAS,CAACnC,KAAMsD,EAAOqgG,UAA7B,SACE,sBAAK9gG,UAAWS,EAAOogG,UAAWxD,IAAG,UAAK9lG,2BAAL,YAA+B4/C,GAAQmmD,IAAI,WAGlF,eAAC,KAAD,CAAgBh+F,QAAS,CAACnC,KAAMsD,EAAOqgG,YAEzC,eAACx5F,GAAA,EAAD,CAAKm8B,SAAU,EAAf,SACE,gBAACj8B,GAAA,EAAD,WAAY,+BAAIy1B,GAASnrC,EAAMsH,GAAW,uCAASA,EAAT,UAA1C,KAA2E6nG,GAAqBh/F,UAGpG,eAACy+F,GAAD,QAIP,I,+DC/JM,MAED93F,GAAYC,cAAWnI,IAAK,CAChCmzD,UAAW,CACTxqD,WAAY3I,EAAMkH,QAAQ,GAC1BE,YAAapH,EAAMkH,QAAQ,IAE7B85F,aAAc,CACZ/mE,MAAO,OACPY,SAT6B,KASC76B,EAAMkH,QAAQ,GAC5C0yB,YAAa55B,EAAMkH,QAAQ,GAC3BszB,aAAcx6B,EAAMkH,QAAQ,GAC5ByB,WAAY,OACZvB,YAAa,QAEf65F,cAAe,CACb/mE,OAAQ,QAEVgnE,WAAY,CACVloE,UAAWh5B,EAAMkH,QAAQ,GACzBoyB,aAAct5B,EAAMkH,QAAQ,QAIjB,SAASi6F,GAAT,GAA+E,IAAjE,aAACH,EAAD,cAAeC,EAAf,QAA8B7wD,EAA9B,SAAuCzxC,KAAam8B,GAAY,EAC3F,MAAMl8B,EAAUsJ,KACVlI,EAAQy6C,eAER2mD,EAAgB,uBACpB9hG,UAAW+iC,mBAAK,CACd,CAACzjC,EAAQu0D,YAAa6tC,EACtB,CAACpiG,EAAQoiG,cAAeA,EACxB,CAACpiG,EAAQqiG,eAAgBA,OAEvBnmE,EANgB,UAQnBsV,GAAW,eAACtpC,GAAA,EAAD,2BACVspC,GAAWzxC,KAGf,OAAIsiG,EACK,yBAASnmE,EAAWx7B,UAAWV,EAAQqiG,cAAvC,SACL,eAAC,KAAD,CAAWI,cAAY,EAAvB,SACG,QAAC,OAACnnE,GAAF,SAAc,uBAAK16B,MAAO,CAAC06B,OAAQA,GAArB,UACb,sBAAK16B,MAAO,CAAC06B,OAAQl6B,EAAMkH,QAAQ,MACnC,sBAAK1H,MAAO,CAAC06B,OAAQA,EAASl6B,EAAMkH,QAAQ,IAA5C,SACGk6F,MAHJ,MASE,sBAAK9hG,UAAWV,EAAQsiG,cAAgBpmE,EAAxC,SACJsmE,GAGN,CCxCM,MAKDE,GAAqBn5F,cAAWnI,IAAK,CACzCuB,YAAa,CACX,mBAAoB,CAClBy3B,UAAW,iBAGfuoE,QAAS,CACPrnE,OAAQ,QAEVsnE,cAAe,CACbvnE,MAAO,YAILwnE,GAAqBnkG,IAAMoI,MAAK,YAAyC,OAAT7G,GAAQ,EAC5E,MAAM,MACJjB,EADI,MAEJ2+B,EAFI,KAGJka,EAHI,gBAIJirD,EAJI,WAKJC,EALI,kBAMJpB,EANI,YAOJh/F,GAAeq+F,KACXhhG,EAAU0iG,KAEhB,OACE,gBAACM,GAAA,EAAD,IAAe/iG,EAAf,UACE,eAACgjG,GAAA,EAAD,CACEC,WAAY,eAAC,KAAD,IADd,SAGE,gBAACzjC,GAAA,EAAD,CAAMG,WAAS,EAAC79B,UAAU,MAAMz5B,QAAS,EAAzC,UACE,eAACm3D,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACGs1B,EACC,eAAC,KAAD,UACE,sBACEn3C,UAAWV,EAAQ2iG,QACnB5E,IAAG,UAAK9lG,2BAAL,YAA+B4/C,GAClCmmD,IAAI,WAIR,eAAC,KAAD,MAGJ,eAACv+B,GAAA,EAAD,CAAMl9C,MAAI,EAACi9C,GAAI,EAAf,SACE,eAACt3D,GAAA,EAAD,UAAY,6BAAIy1B,QAEjBgkE,GACC,eAACliC,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACra,GAAA,EAAD,UACGy5F,MAIP,eAACliC,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACa,YAAVvjB,GACC,eAAC+mE,GAAA,EAAD,CAAM/kE,KAAK,QAAQH,MAAM,UAAU3M,MAAM,mBAKjD,eAACivG,GAAA,EAAD,UACE,gBAAC1jC,GAAA,EAAD,CAAMG,WAAS,EAACt3D,QAAS,EAAzB,UACE,eAACm3D,GAAA,EAAD,CAAMl9C,MAAI,EAACi9C,GAAI,EAAf,SACE,eAACt3D,GAAA,EAAD,UACE,eAAC,GAAD,CAAUxH,UAAWV,EAAQ2C,YAA7B,SACGA,GAAe,mCAItB,eAAC88D,GAAA,EAAD,CAAMl9C,MAAI,EAACi9C,GAAI,EAAf,SACE,gBAACx3D,GAAA,EAAD,CAAKjG,QAAQ,OAAO09B,cAAc,SAAlC,UACGsjE,GACC,gBAAC76F,GAAA,EAAD,WACE,8CAAoB66F,EACjBp2G,KAAI,CAACo2G,EAAY5zF,IAChB,eAACtF,GAAA,EAAD,CAEElR,KAAI,iBAAYoqG,EAAWK,OAF7B,SAIGL,EAAWvwG,MAHP2c,KAKNzZ,QAAO,CAACgzD,EAAM26C,IAAS,CAAC36C,EAAM,KAAM26C,QAI5CP,GAAmBA,EAAgB9zG,OAAS,GAC3C,gBAACkZ,GAAA,EAAD,WACE,mDAAyB46F,EACtBn2G,KAAI,CAAC22G,EAAWn0F,IAAU,gCAAmBm0F,GAARn0F,KACrCzZ,QAAO,CAACgzD,EAAM26C,IAAS,CAAC36C,EAAM,KAAM26C,QAI3C,eAACr7F,GAAA,EAAD,CAAKm8B,SAAU,EAAf,kBACA,eAACi9D,GAAD,gBAOb,IAsDc34F,UAhDG/J,IAAMoI,MAAK,KAC3B,MAAMy8F,EAAQC,MACP7qF,EAAU8qF,GAAev8F,mBAAS,WAEnC+uD,EAAepoD,uBAAY6zF,IAC/B+B,GAAYp5G,GAASA,IAAUq3G,EAAKlvG,KAAO,KAAOkvG,EAAKlvG,MAAvD,GACC,CAACixG,IAEJ,OACE,gBAAClB,GAAD,CAAMH,cAAY,EAAlB,UACE,eAACp6F,GAAA,EAAD,CAAKoyB,UAAW,EAAhB,SACE,gBAAClyB,GAAA,EAAD,CAAY0B,QAAQ,KAAK/I,MAAM,UAA/B,wBACa,uCADb,iCAIF,eAACmH,GAAA,EAAD,CAAKm6F,QAAS,EAAd,SACE,eAACj6F,GAAA,EAAD,wNAMF,eAACF,GAAA,EAAD,CAAKm6F,QAAS,EAAd,SACE,eAACj6F,GAAA,EAAD,wQAOF,eAACF,GAAA,EAAD,CAAKm6F,QAAS,EAAd,SACGjpG,OACEK,KAAKgqG,GACL52G,KAAIsM,IAAG,CAAMzG,KAAMyG,EAAK0kC,MAAO1kC,KAAQsqG,EAAMtqG,OAC7CtM,KAAI,CAAC+0G,EAAMvyF,IACV,eAAC,GAAD,CAAuBuyF,KAAMA,EAA7B,SACE,eAAC,GAAD,CACE/oF,SAAU+oF,EAAKlvG,OAASmmB,EACxB8oB,SAAU,IAAMw0B,EAAayrC,MAHjBvyF,SA3B1B,KA6CK,SAASq0F,KAAY,IAAD,EACzB,OAAI,OAACppG,QAAD,IAACA,GAAD,UAACA,EAAIspG,aAAL,OAAC,EAAWt4B,QAGTu4B,EAFE,CAAC,CAGX,CChKcC,OA3BWllG,IAAMoI,MAAK,YAA+C,IAApB,MAACy8F,KAAUtjG,GAAQ,EACjFsjG,EAAQA,GAAS,GACjB,MAAMxnG,EAAaynG,KACbK,EAAY3qG,OAAOK,KAAKwC,GAC3BvC,QAAOkoG,GAAQ6B,EAAMxzG,SAAS2xG,KAC9B/0G,KAAIsM,IAAG,CAAMzG,KAAMyG,EAAK0kC,MAAO1kC,KAAQ8C,EAAW9C,OAErD,OAAyB,IAArB4qG,EAAU70G,OACL,KAIP,eAAC03C,GAAA,EAAD,UACGm9D,EACEl3G,KAAI,CAAC+0G,EAAMvyF,IACV,iCACE,eAAC,GAAD,CAAWuyF,KAAMA,KAAUzhG,IAC1BkP,IAAUjW,OAAOK,KAAKsqG,GAAW70G,OAAS,GAAK,eAAC80G,GAAA,EAAD,MAFxCpC,EAAKlvG,SAOxB,ICiBcuxG,OAZKrlG,IAAMoI,MAAK,IAAqD,IAApD,UAACk9F,EAAD,UAAYC,EAAZ,gBAAuBC,EAAkB,MAAU,EACjF,MAAMriC,EAAUv6D,mBAAQ,IACf,IAAI68F,GAAoBH,EAAWC,EAAWC,IACpD,CAACF,EAAWC,EAAWC,IAE1B,OAAO,eAAC,GAAD,CAASriC,QAASA,GAAzB,IASF,MAAMsiC,WAA4BpjC,GAChCziE,YAAY0lG,EAAWrmE,EAAOumE,GAC5B1lG,QACA,MAAMiiB,EAAYpB,GAAc2kF,GAChC,GAAIvjF,EAAUhwB,OAASquB,GAAQG,OAAQ,MAAM,IAAI3vB,MAAJ,sCAAyC00G,IACtF,IAAKvjF,EAAUjB,WAAY,MAAM,IAAIlwB,MAAJ,qCAAwC00G,IACzEx0G,KAAK+vB,cAAgBkB,EAAUlB,cAC/B/vB,KAAKw0G,UAAYA,EACjBx0G,KAAK8uB,SAAWmC,EAAUnC,SAC1B9uB,KAAK8T,KAAOmd,EAAUnd,KACtB9T,KAAKmuC,MAAQA,EACbnuC,KAAK00G,gBAAkBA,EACvB10G,KAAK07B,cAAW36B,EAChBf,KAAKoT,UAAOrS,EACZf,KAAKu7D,eAAYx6D,EACjBf,KAAKg0E,aAAc,EACnBh0E,KAAKu0E,aAAe,IAAI74D,IAAI,CAAC1b,KAAK8uB,WAClC9uB,KAAKyT,SAAM1S,EACXf,KAAK+W,UAAY,GACjB/W,KAAK40G,cAAW7zG,CACjB,CACD4wE,UACE,OAAO3xE,KAAKu0E,YACb,CACe,iBAAC9gE,EAAKgtB,GAAY,IAAD,EAC/BzgC,KAAKyT,IAAMA,EACXzT,KAAK40G,SAAW,EAChB,MAAMl8E,QAAuB+H,EAAUb,eAAe5/B,KAAK+vB,cAAe/vB,KAAK8uB,UAAU,GAAM,GAC/F9uB,KAAKu7D,UAAL,UAAiB7iC,EAAejJ,cAAhC,aAAiB,EAAuBolF,cACxC70G,KAAK07B,SAAWhD,EAAeY,iBACzBt5B,KAAK80G,WACZ,CACDrjC,iBACSzxE,KAAKoT,IACb,CACc,kBAAI,IAAD,MAChB,MAAM08F,EAAcn+E,GAAc3xB,KAAK8T,MACvC,GAAI9T,KAAK+vB,gBAAkBtlB,EAAS,MAAM,IAAI3K,MAAM,qEACpD,MAAMmT,QAAiBjT,KAAKyT,IAAIQ,IAAT,mBAAyBjU,KAAK8uB,SAA9B,mBAAiDghF,EAAjD,8CAAkG9vG,KAAK+W,UAAvG,iBAAyH/W,KAAK40G,WAC/IG,GAAiB,UAAA/0G,KAAKoT,YAAL,eAAW2hG,iBAAkB,CAAC,EACrD9hG,EAAS+hG,mBAAmB1hF,QAAQnoB,SAAQusF,IAAaqd,EAAerd,EAAQ10F,MAAQ00F,CAA/B,IACzD,MAAMsd,EAAqB,UAAAh1G,KAAKoT,YAAL,SAAW4hG,mBAAX,OACvBh1G,WADuB,IACvBA,MADuB,UACvBA,KAAMoT,YADiB,aACvB,EAAY4hG,mBAAmBlvG,OAAOmN,EAAS+hG,mBAAmB1hF,SAClErgB,EAAS+hG,mBAAmB1hF,QAC1Bkb,EAAQv7B,EAAS4lB,WAAW2V,MAClCxuC,KAAKoT,KAAO,CAAC4hG,qBAAoBD,iBAAgBvmE,QAClD,CACgB,kBAAC/kC,GAAM,IAAD,EACT,cAARA,IACFA,EAAMzJ,KAAK00G,iBAEb,MAAMO,EAAcljF,GAAQ/xB,KAAKw0G,UAAWtiF,mBAAmBzoB,IAC/D,IAAIiuF,EAAO,UAAG13F,KAAKoT,YAAR,aAAG,EAAW2hG,eAAetrG,GACxC,MAAQiuF,GAAW13F,KAAK40G,SAAW50G,KAAK+W,UAAY/W,KAAKoT,KAAKo7B,OAAO,CACnE,MAAMp7B,QAAapT,KAAKk1G,mBACxBxd,EAAO,OAAGtkF,QAAH,IAAGA,OAAH,EAAGA,EAAM2hG,eAAetrG,EAChC,CACD,GAAIiuF,EACF,OAAIA,EAAQyd,QACH,IAAIC,GAAeH,EAAavd,EAAS13F,KAAK07B,UAE9C,IAAIi5E,GAAoBM,EAAaxrG,EAAK,MAGrD,MAAM,IAAI3J,MAAM,aAAe2J,EAChC,CAEqB,yBAAI,IAAD,EACvB,GAAI,UAAAzJ,KAAKoT,YAAL,SAAWo7B,OAASxuC,KAAK40G,SAAW50G,KAAK+W,UAAY/W,KAAKoT,KAAKo7B,MAGjE,OAFAxuC,KAAK40G,SAAW50G,KAAK40G,SAAW,QAC1B50G,KAAK80G,YACJ90G,KAAKoT,IAEf,CAEkB,oBAACy8B,EAAOklC,SACN/0E,KAAKk1G,oBAEtBngC,GAEH,CAEe,iBAACllC,EAAOklC,GACtB,GAAgC,GAA5BllC,EAAMlnB,OAAOwsD,aAAoB,KAAOtlC,EAAMlnB,OAAOysD,aAAc,OAClDp1E,KAAKk1G,oBAEtBngC,GAEH,CACF,CAEDzkE,SACE,OAAO,eAAC+kG,GAAD,CACLtlF,cAAe/vB,KAAK+vB,cAAejB,SAAU9uB,KAAK8uB,SAAUhb,KAAM9T,KAAK8T,KACvEq6B,MAAOnuC,KAAKmuC,MAAOumE,gBAAiB10G,KAAK00G,gBACzCh5E,SAAU17B,KAAK07B,UAClB,EAGI,MAAM45E,GAAiBpmG,IAAMoI,MAAM7G,IACxC,MAAM,SAACF,EAAD,OAAWglG,EAAX,gBAAmBC,EAAnB,gBAAoCC,KAAoBC,GAAcjlG,GACrE6hC,EAAQqjE,GAAaj+F,oBAAS,GAC/Bk+F,EAAiBp+E,iBAAO,IAExBq+E,EAAcx3F,uBAAYrL,IAC9BA,EAAEyxD,iBACFzxD,EAAE+gC,kBACF6hE,EAAeluF,QAAQ5oB,KAAKkU,EAAE2V,QAC9BgtF,GAAU,EAAV,GACC,CAACA,IAEEG,EAAcz3F,uBAAYrL,IAC9BA,EAAEyxD,iBACFzxD,EAAE+gC,kBACF,MAAMgiE,EAAUH,EAAeluF,QACzBsuF,EAAYD,EAAQ5lG,QAAQ6C,EAAE2V,SACjB,IAAfqtF,IACFD,EAAQh7F,OAAOi7F,EAAW,GAC1BJ,EAAeluF,QAAUquF,GAEtBA,EAAQv2G,QACXm2G,GAAU,EACX,GACA,CAACA,IAEEM,EAAa53F,uBAAYrL,IAC7BA,EAAEyxD,iBACFzxD,EAAE+gC,iBAAF,GACC,IAEGmiE,EAAY73F,uBAAYrL,IAC5BA,EAAEyxD,iBACFzxD,EAAE+gC,kBACF4hE,GAAU,GACVC,EAAeluF,QAAU,GACzB6tF,EAAOviG,EAAP,GACC,CAACuiG,EAAQI,IAEZ,OAAO,sBACLzkG,UAAWohC,EAASmjE,EAAkBD,EACtCK,YAAaA,EACbC,YAAaA,EACbG,WAAYA,EACZV,OAAQW,KACJR,EANC,SAQJnlG,GARH,IAkBI4lG,GAA+Bp8F,cAAWnI,IAAK,CACnDwkG,aAAc,CACZvqE,MAAO,OACP08D,UAAW,QAEb8N,YAAa,CACXxqE,MAAO,OACPpzB,OAAQ,EACRI,QAAS,GAEXy9F,eAAgB,CACdzqE,MAAO,OACP08D,UAAW,OACXz6F,gBAAiB8D,EAAMnE,QAAQ2/C,KAAK,UAGxC,SAASioD,GAAT,GAAiG,IAAD,QAAnE,cAACtlF,EAAD,SAAgBjB,EAAhB,KAA0Bhb,EAA1B,MAAgCq6B,EAAhC,gBAAuCumE,EAAvC,SAAwDh5E,GAAW,EAC9F,MAAMlrB,EAAU2lG,KACV11E,EAAYpJ,KACZk/E,EAAiB,UAAGtF,YAAH,iBAAG,EAAiB95E,gBAApB,aAAG,EAA2BpI,SAC/CynF,EAAU/jG,qBAAWm/D,IACrBiC,EAAOphE,qBAAWgiE,IAClBtkB,EAAUW,cACVg/C,EAAcn+E,GAAc7d,IAC5B,IAAEL,GAAQ0E,MACTs+F,EAA4BC,GAAiCh/F,oBAAS,IACtEi/F,EAAqBC,GAA0Bl/F,oBAAS,IACxDm/F,EAAoBC,GAAyBp/F,oBAAS,IACtDq/F,EAAqBC,GAA0Bt/F,oBAAS,IACxDulB,EAAUg6E,GAAev/F,mBAAS,IACnCw/F,EAAe1/E,mBACf2/E,EAAgB3/E,oBAChB,WAAEnoB,GAAemD,KAEjB4kG,EAAkB/4F,uBAAYsc,MAAOT,EAAaC,KAGtD,GAAIA,EAAYlB,UAAW,CAAC,IAAD,EACzB,MAAMyE,EAAem2C,EAAKxB,QAAQ9W,UAC5B39B,EAAY,UAAGzD,EAAY1K,cAAf,aAAG,EAAoBolF,cACpChhC,EAAKxB,QAAQ2B,YAIPp2C,IAAiBF,GAAiBvD,EAAYjB,cAEvDs9E,EAAQniC,8BAA8BvlD,IAJtC+kD,EAAKxB,QAAQ9W,UAAY39B,EACzBi2C,EAAKxB,QAAQ2B,aAAc,EAK9B,IACA,CAACwiC,EAAS3iC,EAAM/kD,IAEnBlX,qBAAU,KACRw/F,OAAgBr2G,EAAW0/B,EAAUtI,UAAUpI,EAAejB,IACvD2R,EAAUzG,kBAAkBjK,EAAejB,EAAUsoF,GAAiB,GAAM,KAClF,CAAC32E,EAAW1Q,EAAejB,EAAUsoF,IAExC,MAAMC,EAAkBh5F,uBAAai5F,IAEnC,MAAMC,EAAW,IAAIC,SACrB,IAAK,MAAMvmC,KAAQqmC,EACjBC,EAASzY,OAAO,OAAQ7tB,GAE1Bx9D,EAAIwC,IAAJ,mBAAoB6Y,EAApB,gBAAoCghF,GAAeyH,GAChDtiG,MAAKhC,GAAYwtB,EAAU5G,aAAa9J,EAAejB,EAAU,CAACW,OAAQxc,EAASG,SACnF+B,OAAM1F,GAASJ,EAAWI,IAF7B,GAGC,CAACsgB,EAAejB,EAAUghF,EAAazgG,EAAYoE,EAAKgtB,IAErDg3E,EAAap5F,uBAAYsc,UAAc,IAAD,EAE1C,MAAM28E,QAAcI,aAAU1kG,GACxB2kG,EAAS,UAAG3kG,EAAE4kG,oBAAL,aAAG,EAAgBC,QAAQ,OACtCP,EAAM93G,OACR63G,EAAgBC,GACPK,GACLA,EAAUp3G,SAAS,YACvBo3G,EAAUp3G,SAAS4vD,EAAQrnD,SAASuQ,SAAS5R,MAAM,SAAS,MAC1DwvG,EAAYU,EAAUl2G,MAAMk2G,EAAUxnG,QAAQ,UAAU1I,MAAM,KAAKhG,MAAM,GAAGwL,KAAK,MACjF6pG,GAAsB,GAEzB,GACA,CAAC3mD,EAAQrnD,SAASuQ,SAAUg+F,EAAiBJ,EAAaH,IAEvDgB,EAAsB9kG,IAC1B8jG,GAAsB,GACtBE,GAAuB,GACvBvjG,EAAIwC,IAAJ,mBAAoB6Y,EAApB,gBAAoCghF,EAApC,yBAAgE98F,EAAE+kG,SAAlE,qCAAuG96E,EAAvG,sBAA6Hi6E,EAAaxvF,QAAQ7sB,QAC/Ioa,MAAKhC,GAAYwtB,EAAU5G,aAAa9J,EAAejB,EAAU,CAACW,OAAQxc,EAASG,SACnF+B,OAAM1F,GAASJ,EAAWI,IAF7B,EAKIuoG,EAAkB,KACtBpB,GAAuB,GACvB,MAAMqB,EAAUd,EAAczvF,QAAQ7sB,MACtC,GAAIo9G,EAAS,CACX,MAAMj+C,EAAWjoC,GAAQ+9E,EAAa59E,mBAAmB+lF,IACzDxkG,EAAIgC,KAAJ,mBAAqBqZ,EAArB,2BAAgDkrC,IAC7C/kD,MAAKhC,GAAYwtB,EAAU5G,aAAa9J,EAAejB,EAAU,CAACW,OAAQxc,EAASG,SACnF+B,MAAM9F,EACV,GAGG6oG,EAAkB,KACtBxB,GAA8B,GAC9BjjG,EAAIyC,OAAJ,mBAAuB4Y,EAAvB,gBAAuCghF,IACpC76F,MAAKhC,IACJ,GAAwB,kBAAb8b,UAAmC,KAATjb,GAAeyiG,IAAsBziG,IAAQyiG,EAAkB1mG,WAAWiE,EAAO,KAG/G,CACL,MAAMqkG,EAAWtkC,EAAKl0D,MAAQ,EAAIk0D,EAAKl0D,MAAQ,EAAI,EACnDwwC,EAAQrxD,KAAK03G,EAAQtkC,MAAMxqD,QAAQywF,GAAUrkG,KAC9C,MAJCq8C,EAAQrxD,KAAR,kCAAwCgwB,IAK1C2R,EAAU5G,aAAa9J,EAAejB,EAAU,CAACW,OAAQxc,EAASG,MAAlE,IAED+B,MAAM9F,EAXT,GAcI,aAAE+oG,EAAF,cAAgBC,GAAkBC,aAAY,CAAC/C,OAAQ8B,IAE7D,GAAKxjC,EAAKxB,QAAQj/D,KAEX,CAEL,MAAMmlG,EAAW,kBAAczpF,EAAd,gBAA8BghF,EAA9B,kBACjB,OACE,eAACwF,GAAD,CAAgBC,OAAQkC,EAAYjC,gBAAiBhlG,EAAQ4lG,aAAcX,gBAAiBjlG,EAAQ8lG,eAApG,SACE,gBAAC9/B,GAAD,WACE,eAACc,GAAD,CACEnpC,MAAOA,EACPzpC,MAAM,SACNuJ,QAAS6F,EACTm9B,QACE,gBAACg/B,GAAA,EAAD,CAAMG,WAAS,EAAClgC,eAAe,gBAAgBmmC,KAAK,SAASv9D,QAAS,EAAtE,UACE,gBAACm3D,GAAA,EAAD,CAAMl9C,MAAI,EAAV,UACE,eAACxhB,GAAA,EAAD,CAAYC,KAAK,QAAQC,QAAS,IAAMulG,GAAuB,GAAOhzD,UAAWtoB,GAAyB,KAAbuB,EAA7F,SACE,eAACmR,GAAA,EAAD,CAASD,MAAM,iBAAf,SACE,eAAC,KAAD,QAGJ,gBAACL,GAAA,EAAD,CACI/8B,KAAMgmG,EACN1mG,QAAS,IAAM2mG,GAAuB,GAF1C,UAII,gBAAChpE,GAAA,EAAD,WACE,gBAACwqE,GAAA,EAAD,wBAA6B,6BAAIv7E,IAAjC,OACA,eAACglC,GAAA,EAAD,CACE8C,WAAS,EACThsB,YAAY,iBACZ0/D,WAAS,EACTC,SAAUxB,EACV91C,aAAY,iBAAYnkC,EAASx1B,MAAM,KAAKsT,QAAQ,SAGxD,gBAACkzB,GAAA,EAAD,WACE,eAAC3zB,GAAA,EAAD,CAAQ7I,QAAS,IAAMulG,GAAuB,GAA9C,oBACA,eAAC18F,GAAA,EAAD,CAAQ7I,QAAUuB,GAAM8kG,EAAmB,IAAI9kG,EAAG+kG,SAAU,SAA5D,gCAIR,eAAC9nC,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACxhB,GAAA,EAAD,CAAYC,KAAK,QAAQC,QAAS,IAAM+kG,EAAQriC,yBAAyBN,EAAKl0D,OAA9E,SACE,eAACyuB,GAAA,EAAD,CAASD,MAAM,4BAAf,SACE,eAAC,KAAD,UAIN,eAAC8hC,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAAC,GAAD,CACEd,UAAW1gB,KAAYyyC,UAAU,EAAOxyC,KAAK,QAC7CvD,QAAQ,uBACRtF,IAAK4vG,EAHP,SAKE,eAAC,KAAD,QAIF78E,GACE,eAACu0C,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,0BAASqlF,IAAT,UACE,2BAAWC,MACX,eAAC9mG,GAAA,EAAD,CAAYC,KAAK,QAAjB,SACE,eAAC48B,GAAA,EAAD,CAASD,MAAM,8CAAf,SACE,eAAC,KAAD,aAOVzS,GACE,gBAACu0C,GAAA,EAAD,CAAMl9C,MAAI,EAAV,UACE,eAACxhB,GAAA,EAAD,CAAYC,KAAK,QAAQC,QAAS,IAAMmlG,GAAuB,GAA/D,SACE,eAACxoE,GAAA,EAAD,CAASD,MAAM,oBAAf,SACE,eAAC,KAAD,QAGJ,gBAACL,GAAA,EAAD,CACE/8B,KAAM4lG,EACNtmG,QAAS,IAAMumG,GAAuB,GAFxC,UAIE,gBAAC5oE,GAAA,EAAD,WACE,eAACwqE,GAAA,EAAD,qCACA,eAACv2C,GAAA,EAAD,CACEw2C,WAAS,EACTC,SAAUvB,EACV7xC,UAAYz1B,IACQ,UAAdA,EAAMpmC,KACRuuG,GACD,OAGP,gBAAC/pE,GAAA,EAAD,WACE,eAAC3zB,GAAA,EAAD,CAAQ7I,QAAS,IAAMmlG,GAAuB,GAA9C,oBACA,eAACt8F,GAAA,EAAD,CAAQ7I,QAAS,IAAMumG,IAAvB,yBAMRt8E,GACE,gBAACoS,GAAA,EAAD,CACE/8B,KAAM8lG,EACNxmG,QAAS,IAAMymG,GAAsB,GAFvC,UAIE,gBAAC9oE,GAAA,EAAD,WACE,gBAACwqE,GAAA,EAAD,wBAA6B,6BAAIv7E,IAAjC,OACA,eAACglC,GAAA,EAAD,CACE8C,WAAS,EACThsB,YAAY,iBACZ0/D,WAAS,EACTC,SAAUxB,EACV91C,aAAcnkC,EAASx1B,MAAM,KAAKsT,QAAQ,QAG9C,gBAACkzB,GAAA,EAAD,WACE,eAAC3zB,GAAA,EAAD,CAAQ7I,QAAS,IAAMqlG,GAAsB,GAA7C,oBACA,eAACx8F,GAAA,EAAD,CAAQ7I,QAAUuB,GAAM8kG,EAAmB,IAAI9kG,EAAG+kG,SAAU,SAA5D,kBACA,eAACz9F,GAAA,EAAD,CAAQ7I,QAAUuB,GAAM8kG,EAAmB,IAAI9kG,EAAG+kG,SAAU,SAA5D,wBAKNr8E,GACE,gBAACu0C,GAAA,EAAD,CAAMl9C,MAAI,EAAV,UACE,eAACxhB,GAAA,EAAD,CAAYC,KAAK,QAAQC,QAAS,IAAMilG,GAA8B,GAAtE,SACE,eAACtoE,GAAA,EAAD,CAASD,MAAM,qBAAf,SACE,eAAC,KAAD,QAGJ,gBAACL,GAAA,EAAD,CACE/8B,KAAM0lG,EACNpmG,QAAS,IAAMqmG,GAA8B,GAF/C,UAIE,eAAC1oE,GAAA,EAAD,UACE,gBAACwqE,GAAA,EAAD,0CAA+C,6BAAI1kG,IAAnD,SAEF,gBAACm6B,GAAA,EAAD,WACE,eAAC3zB,GAAA,EAAD,CAAQ7I,QAAS,IAAMilG,GAA8B,GAAQ+B,WAAS,EAAtE,oBACA,eAACn+F,GAAA,EAAD,CAAQ7I,QAASymG,EAAjB,8BAQhB,eAACzhC,GAAD,UAEI5C,EAAKxB,QAAQj/D,KAAK4hG,mBAAmB73G,KAAIu6F,GACvC,uBAAyBjmF,QAAS,IAAMwlG,EAAYvf,EAAQ10F,MAA5D,SACE,eAACkzE,GAAD,CACE7tB,KAAMqvC,EAAQyd,QAAWzd,EAAQztE,YAAc0uF,KAAqBC,KAAYC,KAChF9iC,QAAS2hB,EAAQ10F,KACjBgjE,YAAa0xB,EAAQ10F,OAAS0xG,EAC9Bv+B,KAAMuhB,EAAQztE,aAAeytE,EAAQztE,YAAYzf,QAAQ,WAAY,IAAIA,QAAQ,UAAW,SAJ9F,SAMGktF,EAAQ10F,MAJmB+uB,GAAQje,EAAM4jF,EAAQ10F,QAH3C00F,EAAQ10F,YA/Ib8Q,IA+JnB,CArKC,OAAO,eAAC0iE,GAAD,UAAoB,eAAC99D,GAAA,EAAD,2BAAN5E,EAsKxB,CAUM,MAAMshG,WAAuB7jC,GAKlCziE,YAAY0lG,EAAWphG,EAAMsoB,GAC3B1sB,QACA,MAAMiiB,EAAYpB,GAAc2kF,GAChC,GAAIvjF,EAAUhwB,OAASquB,GAAQG,OAAQ,MAAM,IAAI3vB,MAAJ,sCAAyC00G,IACtF,IAAKvjF,EAAUjB,WAAY,MAAM,IAAIlwB,MAAJ,qCAAwC00G,IACzEx0G,KAAK+vB,cAAgBkB,EAAUlB,cAC/B/vB,KAAK8uB,SAAWmC,EAAUnC,SAC1B9uB,KAAK8T,KAAOmd,EAAUnd,KACtB9T,KAAKoT,KAAOA,EACZpT,KAAK07B,SAAWA,EAChB17B,KAAKu0E,aAAe,IAAI74D,IAAI,CAAC1b,KAAK8uB,UACnC,CACD6iD,UACE,OAAO3xE,KAAKu0E,YACb,CACe,iBAAC9gE,EAAKgtB,GAEpB,GADAzgC,KAAKygC,UAAYA,GACZzgC,KAAKoT,KAAM,CACd,MAAMH,QAAiBQ,EAAIQ,IAAJ,kBAAmBjU,KAAK8uB,SAAxB,mBAA2C9uB,KAAK8T,OACvE9T,KAAKoT,KAAOH,EAAS6lG,aACtB,CACF,CACgB,kBAACrvG,GAChB,GAAY,YAARA,EAAmB,CACrB,MAAMsvG,EAAannF,GAAe5xB,KAAK+vB,cAAe/vB,KAAK8uB,SAAU9uB,KAAKoT,KAAKkvB,WACzE,QAAC5S,SAAiB1vB,KAAKygC,UAAUrE,cAAcp8B,KAAK+vB,cAAe/vB,KAAKoT,KAAKkvB,UAAU,EAAO,KAGpG,OAAO02E,GAAsBD,EAAYrpF,SAFlB1vB,KAAKygC,UAAUpC,iBAAiBhP,KACvB6V,4BAEjC,CAAM,GAAY,YAARz7B,EACT,OAAO,IAAIwvG,GAAmBj5G,KAAK8uB,SAAU9uB,KAAK8T,KAAM9T,KAAKoT,KAEhE,CACD9C,SACE,OAAO,eAAC4oG,GAAD,CACLnpF,cAAe/vB,KAAK+vB,cAAejB,SAAU9uB,KAAK8uB,SAAUhb,KAAM9T,KAAK8T,KACvEV,KAAMpT,KAAKoT,KAAMsoB,SAAU17B,KAAK07B,UAAe17B,KAAK8T,KACvD,EAGH,MAAMmlG,WAA2B1nC,GAC/BziE,YAAYggB,EAAUhb,EAAMV,GAC1BpE,QACAhP,KAAK8uB,SAAWA,EAChB9uB,KAAK8T,KAAOA,EACZ9T,KAAKoT,KAAOA,CACb,CACD9C,SAAU,IAAD,EACP,OAAO,eAACkI,GAAA,EAAD,CAAKkrC,SAAU,QAASjX,SAAU,SAAUZ,MAAM,OAAlD,SACL,eAAC,GAAD,CAAa/c,SAAU9uB,KAAK8uB,SAAUhb,KAAM9T,KAAK8T,KAAMtC,KAAI,UAAExR,KAAKoT,YAAP,aAAE,EAAW5B,QAE3E,EAGH,SAAS0nG,GAAT,GAA0E,IAAD,UAAjD,cAACnpF,EAAD,SAAgBjB,EAAhB,KAA0Bhb,EAA1B,KAAgCV,EAAhC,SAAsCsoB,GAAW,EACvE,MAAM66E,EAAiB,UAAGtF,YAAH,iBAAG,EAAiB95E,gBAApB,aAAG,EAA2BpI,SAC/CynF,EAAU/jG,qBAAWm/D,IACrBiC,EAAOphE,qBAAWgiE,IAClBtkB,EAAUW,cACVrwB,EAAYpJ,MACZ,IAAE5jB,GAAQ0E,MACV,WAAE9I,GAAemD,MAChB2mG,EAA6BC,GAAkC1hG,oBAAS,GACzEo4F,EAAcn+E,GAAc7d,GAC5BykG,EAAW,kBAAczpF,EAAd,gBAA8BghF,EAA9B,0BACXuJ,EAAgBrF,KAChBsF,EAAuBxhG,mBAAQ,KACnC,IAAKuhG,GAA0C,kBAAlBA,GAA8B3vG,OAAOK,KAAKsvG,GAAe75G,OAAS,EAC7F,MAAO,GAET,MAAM2vG,EAAgBr7F,EAAKrM,MAAM,KAAK8Z,MAAMyH,cAC5C,OAAOtf,OAAOK,KAAKsvG,GAChBrvG,QAAOP,IACN,MAAMyoG,EAAOmH,EAAc5vG,GAC3B,OAAW,OAAJyoG,QAAI,IAAJA,OAAA,EAAAA,EAAMoB,kBAAmBpB,EAAKoB,gBAAgB/yG,SAAS4uG,EAA9D,GAHJ,GAKC,CAACkK,EAAevlG,IAIbunB,EAAgBmF,GADEptB,EAAKkvB,UAA+B,aAAnB,UAAAuxC,EAAKh0D,YAAL,eAAWpW,KACKsmB,EAAgB,KAAM3c,EAAKkvB,UAAU,EAAO,KAGrG1qB,qBAAU,KAAO,IAAD,IACyC,EAAtC,OAAbyjB,QAAa,IAAbA,KAAe3L,SAAf,UAA0BmkD,EAAKh0D,YAA/B,iBAA0B,EAAWwyD,eAArC,OAA0B,EAAoBjsE,MAC5Ci1B,EAAc3L,WAAd,UAA0BmkD,EAAKh0D,KAAKwyD,eAApC,aAA0B,EAAmBjsE,MAC/CowG,EAAQriC,yBAAyBN,EAAKl0D,OAEzC,GACA,CAAC62F,EAAS3iC,EAAMx4C,IAmBnB,IAAIk+E,EAAU78G,EAAMyrB,EAqBpB,OApBI/U,EAAK5B,KAAO,KACb9U,EAAMyrB,GAAU,CAAC,KAAM,KACf/U,EAAK5B,KAAO,KACpB9U,EAAMyrB,GAAU,CAAC,KAAM,KACf/U,EAAK5B,KAAO,OACpB9U,EAAMyrB,GAAU,CAAC,KAAM,MAKtBoxF,EAHA78G,EACE0W,EAAK5B,KAAO2W,EAAS,IAEf,UAAM7qB,KAAK2oF,MAAM7yE,EAAK5B,KAAO2W,GAA7B,YAAwCzrB,EAAxC,aAAiD0W,EAAK5B,KAAtD,WAGA,UAAMlU,KAAK2oF,MAAkB,GAAZ7yE,EAAK5B,KAAY2W,GAAU,GAA5C,YAAkDzrB,EAAlD,aAA2D0W,EAAK5B,KAAhE,WAIF,UAAM4B,EAAK5B,KAAX,UAIR,gBAACglE,GAAD,CAEEjkE,QAAQ,OAAO09B,cAAc,SAASnE,OAAO,OAC7CqH,cAAe,EAAG1G,SAAS,UAH7B,UAKE,eAAC6qC,GAAD,CACEnpC,MAAO/6B,EAAKpQ,KACZ0B,MAAM,OACNuJ,QAAS6F,EACTm9B,QACE,gBAACg/B,GAAA,EAAD,CAAMG,WAAS,EAAClgC,eAAe,gBAAgBmmC,KAAK,SAASv9D,QAAS,EAAtE,UACG1F,EAAKkvB,UACJ,eAAC2tC,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACymF,GAAD,CAAa9jG,QAAStC,EAAKkvB,SAAUrQ,UAAW1gB,KAAYC,KAAK,QAAjE,SACE,eAAC,KAAD,QAIN,eAACy+D,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAAC,GAAD,CACEd,UAAW1gB,KAAYyyC,UAAU,EAAOxyC,KAAK,QAC7CvD,QAAQ,qBACRtF,IAAK4vG,EAHP,SAKE,eAAC,KAAD,QAIF78E,GACE,gBAACu0C,GAAA,EAAD,CAAMl9C,MAAI,EAAV,UACE,eAACxhB,GAAA,EAAD,CAAYC,KAAK,QAAQC,QAAS,IAAM2nG,GAA+B,GAAvE,SACE,eAAChrE,GAAA,EAAD,CAASD,MAAM,mBAAf,SACE,eAAC,KAAD,QAGJ,gBAACL,GAAA,EAAD,CACE/8B,KAAMooG,EACN9oG,QAAS,IAAM+oG,GAA+B,GAFhD,UAIE,eAACprE,GAAA,EAAD,UACE,gBAACwqE,GAAA,EAAD,qCAA0C,6BAAIplG,EAAKpQ,OAAnD,SAEF,gBAACirC,GAAA,EAAD,WACE,eAAC3zB,GAAA,EAAD,CAAQ7I,QAAS,IAAM2nG,GAA+B,GAAQX,WAAS,EAAvE,oBACA,eAACn+F,GAAA,EAAD,CAAQ7I,QAnFH,KACvB2nG,GAA+B,GAC/B3lG,EAAIyC,OAAJ,mBAAuB4Y,EAAvB,gBAAuCghF,IACpC76F,MAAKhC,IACJ,GAAIa,IAASyiG,EAEXpmD,EAAQrxD,KAAR,kCAAwCgwB,QACnC,CACL,MAAMqpF,EAAWtkC,EAAKl0D,MAAQ,EAAIk0D,EAAKl0D,MAAQ,EAAI,EACnDwwC,EAAQrxD,KAAK03G,EAAQtkC,MAAMxqD,QAAQywF,GAAUrkG,KAC9C,CACD2sB,EAAU5G,aAAa9J,EAAejB,EAAU,CAACW,OAAQxc,EAASG,MAAlE,IAED+B,MAAM9F,EAXT,EAiFkB,8BAQhB,gBAAConE,GAAD,WACE,eAAC,GAAD,CAAUx/D,SAAS,WAAW7D,KAAM,CAACqmG,SAAUF,GAAW70G,MAAM,cAC/D0O,EAAK6W,aACJ,eAAC,GAAD,CAAUhT,SAAS,SAAS7D,KAAM,CAAC8T,OAAQ9T,EAAK6W,eAEjD7W,EAAKkvB,UACJ,eAAC,GAAD,CAAUrrB,SAAS,UAAU7D,KAAM,CAACsC,QAAStC,EAAKkvB,UAAWurB,QAAM,EAAC6qB,eAAa,OAGrF,gBAACjC,GAAD,WACGrjE,EAAKkvB,UACJ,eAAC4zC,GAAD,CAAMH,QAAQ,UAAd,SACE,eAACr9D,GAAA,EAAD,+BAGJ,eAACw9D,GAAD,CAAMH,QAAQ,UAAd,SACE,eAACr9D,GAAA,EAAD,wBAED4gG,EAAqB95G,OAAS,GAC7B,eAAC,GAAD,CAAmBsvB,SAAUA,EAAUhb,KAAMA,EAAMigG,MAAOuF,SAtEzDxlG,EA0EV,CC/rBM,SAASsX,GAAT,GAAwD,IAAxC,MAACvwB,EAAD,IAAQ6e,EAAR,QAAaU,EAAb,KAAsB1d,KAAS+T,GAAQ,EAC5D2J,EAAUA,GAAW,QACrBV,EAAMA,GAAO,EAEb,IAAIm2D,EAAO,IACX,QAAc9uE,IAAVlG,GAAiC,OAAVA,EACzB,GAAqB,kBAAVA,EAAoB,CAC7B,MAAM6kB,EAAM7kB,EAAMswB,cAAczR,IACzBioB,EAAG3uB,GAAK0M,EAAIjY,MAAM,KAEvBooE,EADE78D,GANM,GAMQA,IANR,EAODnY,EAAMwwB,QAPL,GAOoB7gB,QAAQ,UAAW,IAExC,kCAAOm3B,EAAElzB,WAAWjE,QAAQ,MAAO,IAAnC,SAAiD,+BAAMwI,MAEjE,MACC68D,EAAOh1E,EAAM4T,WAGjB,OAAO,gBAACiK,GAAA,EAAD,IAAgBjI,EAAO2J,QAASA,EAAS,cAAY,8BAArD,UAAoFy1D,EAAMnzE,GAAQ,yCAAaA,OACvH,CAQD,SAASg9G,GAAT,GAAqD,IAA3B,OAACl6G,EAAD,KAASs5B,EAAT,SAAemZ,GAAW,EAClD,OAAO,gBAAC,KAAD,CACLn5B,QAAS,EACTs3D,WAAS,EACT79B,UAAU,MACVrC,eAAe,SACfn3B,WAAW,SALN,UAOL,eAAC,KAAD,CAASga,MAAI,EAAb,SACE,eAACzY,GAAA,EAAD,CAAQ0pC,SAAmB,IAATlrB,EAAYtnB,KAAK,QAAQC,QAAS,IAAMwgC,EAASnZ,EAAO,GAA1E,oBAIF,eAAC,KAAD,CAAS/F,MAAI,EAAb,SACE,eAACra,GAAA,EAAD,UAAaogB,MAEf,eAAC,KAAD,CAAS/F,MAAI,EAAb,SACE,eAACzY,GAAA,EAAD,CAAQ9I,KAAK,QAAQwyC,SAAUlrB,EAAO,IAAMt5B,EAAQiS,QAAS,IAAMwgC,EAASnZ,EAAO,GAAnF,sBAKL,CAOD,MAAM6gF,GAAkB5/F,cAAWnI,IAAK,CACtCvD,KAAM,CACJkE,QAAS,OACT09B,cAAe,MACfl3B,WAAY,UACZ2qC,SAAU,IACVxT,eAAgB,UAElB0pE,YAAa,CACX/tE,MAAOj6B,EAAMkH,QAAQ,GACrB83B,OAAQ,kBACRgkC,YAAa,OACb57D,aAAcpH,EAAMkH,QAAQ,IAE9BkwE,OAAQ,CACNn9C,MAAO,QAETguE,aAAc,CACZhuE,MAAOj6B,EAAMkH,QAAQ,GACrB83B,OAAQ,kBACRtE,WAAY,OACZ/xB,YAAa3I,EAAMkH,QAAQ,QAGxB,SAASghG,GAAT,GAAgD,IAAhC,OAAC9uG,EAAD,MAAS09B,EAAT,OAAgBivD,EAAhB,KAAwB12F,GAAO,EACpD,MAAMqxE,EAAU96C,mBACVuiF,EAAYviF,oBACXwiF,EAAOC,GAAYviG,mBAAS,IAAI3R,MAAMzI,KAAK03C,IAAI,EAAGtM,EAAMlpC,OAAS,IAAIwG,KAAK,IAC3Ek0G,EAAc,GACd1pG,EAAUmpG,KAEhB,IAAIQ,EAAK,EACT,IAAK,IAAIz8G,EAAIgrC,EAAMlpC,OAAQ9B,EAAI,EAAGA,IAChCw8G,EAAYp7G,KAAKkM,EAAOxL,QACxBwL,EAASA,EAAOgvG,EAAMG,MAGxB,MAAMC,EAAc5iF,iBAAO,IAErB6iF,EAAW1iB,EAAS3sF,EAAOxL,OAASkpC,EAAMlpC,OAAS,EAAIwL,EAAO,GAAGxL,OAAS,EAC1E86G,EAAc3iB,EAASjvD,EAAMlpC,OAAS,EAAIwL,EAAO,GAAGxL,OAAS,EAAIwL,EAAOxL,OACxEssC,EAASxuC,KAAK+J,IAAI,IAHN,IAGYgzG,EAAW,GAAiB,IAE1DnnC,2BAAgB,KAEZ6mC,EAAUryF,QAAQtW,MAAMy6B,MADb,QAAT5qC,EAC8B,OAEhC,UAAmCqxE,EAAQ5qD,QAAQwlC,YAAc,EAAjE,MAEFktD,EAAY1yF,QAAUpqB,KAAK03C,IAAI,IAAKs9B,EAAQ5qD,QAAQwlC,YAAc,GAAKotD,EAAvE,IAGF,IAAIz/G,EAAQ6tC,EAAMlpC,OAAS,EAAI,QAAC,SAAC+6G,EAAD,YAAWC,GAAZ,SAA6BxvG,EAAOwvG,GAAaD,EAAjD,EAA6D,QAAC,YAACC,GAAF,SAAmBxvG,EAAOwvG,EAA1B,EAK5F,OAJI7iB,IACF98F,EAAQ6tC,EAAMlpC,OAAS,EAAI,QAAC,SAAC+6G,EAAD,YAAWC,GAAZ,SAA6BxvG,EAAOuvG,GAAUC,EAA9C,EAA6D,QAAC,SAACD,GAAF,SAAgBvvG,EAAOuvG,EAAvB,GAGnF,gBAAC,IAAMhiG,SAAP,WACL,uBAAK6Z,IAAKkgD,EAASphE,UAAWV,EAAQnC,KAAtC,UACE,sBAAK6C,UAAWV,EAAQopG,YAAaxoG,MAAO,CAAC06B,OAAQA,GAArD,kBACA,sBAAK1Z,IAAK2nF,EAAW7oG,UAAWV,EAAQw4E,OAAxC,SACE,eAAC,KAAD,UACG,QAAC,MAACn9C,GAAF,SACC,eAAC,KAAD,CACEyuE,YAAaA,EACbF,YAAaA,EAAY1yF,QACzBokB,OAAQA,EACRuuE,SAAUA,EACVI,UA9BM,GA+BN5uE,MAAOA,EANT,SAQG,QAAC,MAACz6B,KAAUX,GAAZ,SAAuB,eAAC,GAAD,CAAQW,MAAO,CAACi7B,WAAY,YAAaj7B,GAAQvW,MAAOA,EAAM4V,IAArF,GATJ,MAcL,sBAAKS,UAAWV,EAAQqpG,aAAczoG,MAAO,CAAC06B,OAAQA,GAAtD,qBAEDkuE,EAAM78G,KAAI,CAAC27B,EAAMnZ,IAAU,eAACnH,GAAA,EAAD,CAAKC,OAAQ,EAAb,SAC1B,eAACihG,GAAD,CACEl6G,OAAQ06G,EAAYv6F,GAAQmZ,KAAMA,EAClCmZ,SAAWnZ,GAASmhF,EAAS,IAAID,EAAMv4G,MAAM,EAAGke,GAAQmZ,KAASkhF,EAAMv4G,MAAMke,EAAQ,QAHxCA,OAOpD,CC7HM,MACD+6F,GAAY,IACZ5gG,GAAYC,cAAYnI,IACrB,CACLvD,KAAM,CAAC,EACP0gC,OAAQ,CACNx8B,QAAS,OACTs5B,MAAO,OACPC,OAAQ,OACRmE,cAAe,UAEjBk6B,OAAQ,CACN/9B,aAAcx6B,EAAMkH,QAAQ,GAC5BvG,QAAS,OACT09B,cAAe,MACfgZ,OAAQ,GAEVx+B,OAAQ,CACN8rB,KAAM,EACN0S,OAAQ,EACRs/C,UAAW,EACXr9D,aAAct5B,EAAMkH,QAAQ,QAI5B6hG,GAAgBzrG,IAAMoI,MAAK,IAM1B,IAN2B,UAChCpG,EADgC,QAEhCV,EAFgC,KAGhC4C,EAHgC,YAIhCq2F,EACA,cAAenlD,GACX,EACJ,MAAOunD,EAAYC,GAAiBp0F,oBAAS,IACtCsqC,EAAS1tC,GAAcoD,oBAAS,GACjCm1F,EAAYr1E,iBAAO,MACnB7lB,EAASmI,GAAUtJ,GAMnB48F,EAAY/uF,uBAAYkX,IACf,OAATA,GAGsB,OAAtBs3E,EAAUnlF,UAGdmlF,EAAUnlF,QAAQq7D,kBAAkBxtD,GACpCs3E,EAAUnlF,QAAQymE,IAAIusB,IACtB7N,EAAUnlF,QAAQpX,SAAlB,GACC,IAGGsB,EAAQy6C,eACdz0C,qBAAU,KACHxE,IAAQy5F,EAAUnlF,UAGvBmlF,EAAUnlF,QAAU,IAAIm6E,QAAoB9gG,GAA5C,GACC,CAACqS,IAGJwE,qBAAU,KACR,IAAKxE,EACH,OAIF,MACM2uF,EAAU,GACVt6E,EAAW,GACXkzD,EAAY,CAChB6J,MAJYt8D,GAAM9U,EAAKwnG,gBAAiB,OAKxC7Y,QAASA,EACTt6E,SAAUA,GAEZ,IAAIozF,EACAlzF,EAAU,GACd,IAAK,MAAMmzF,KAAO1nG,EAAKuU,QAAS,CAC9B,MAAMnjB,EAASs2G,EAAIC,iBACbz/G,EAAQw/G,EAAI/Y,QAAQ,GACpBxmG,EAAMu/G,EAAI/Y,QAAQtgG,OAAO,GAAG,KAC7Bo5G,GAAkBA,GAAiBxyF,GAAS/sB,EAAOu/G,IAAkB,QAEpElzF,EAAQnoB,OAAS,GACnBioB,EAAS3oB,KAAK6oB,GAGhBA,EAAU,GACVA,EAAQ7oB,KAAKxD,QACEyF,IAAXyD,GACFu9F,EAAQjjG,KAAK,CAAC0F,EAAO,GAAIlJ,KAG7BqsB,EAAQ7oB,KAAKvD,QACEwF,IAAXyD,GACFu9F,EAAQjjG,KAAK,CAAC0F,EAAO,GAAIjJ,IAE3Bs/G,EAAgBt/G,CACjB,CAEDksB,EAAS3oB,KAAK6oB,GAEd,MAAM9d,EAAU,CACd26E,MAAO,CACLl9B,KAAM,2BACN5gC,OAAQ,KACRlV,KAAM,IACN7R,EAAG,CAAE0R,MAAO,WACZiX,EAAG,CAAEjX,MAAO,WACZhT,EAAG,CAAEgT,MAAO,YAEdoW,SAAU,CACRpW,MAAOO,EAAMnE,QAAQC,QAAQf,MAE/B2wF,MAAO,CACLlS,QAAS,CACPv/C,MAAO,OAGXk2D,QAAS,CACPr9F,MAAO,CACL2M,MAAOO,EAAMnE,QAAQC,QAAQf,KAC7B26C,KAAM,2BACN91C,KAAM,MAERyqF,MAAO,CACL5qF,MAAOO,EAAMnE,QAAQC,QAAQf,KAC7B6E,KAAM,OAMZq7F,EAAUnlF,QAAQklE,KAAKjS,EAAW9wE,GAClCgjG,EAAUnlF,QAAQg9D,YAAY,CAAC,EAAG,EAAG,EAAG,IACxCmoB,EAAUnlF,QAAQynB,MAAM,CACtB,CAAC,KAAM,KACP,CAAC,QAAS,cAEZ09D,EAAUnlF,QAAQ48D,OAAO,CACvB,CAAC,EAAG,EAAG,EAAG,IACV,CAAC,EAAG,EAAG,EAAG,MAEZuoB,EAAUnlF,QAAQ86D,SAAS,CAACvB,oBAAoB,EAAOX,IAAK,CAAC1E,SAAS,KACtEixB,EAAUnlF,QAAQymE,IAAIusB,IACtB7N,EAAUnlF,QAAQpX,SAClBu8F,EAAUnlF,QAAQo9D,kBAClBxwE,GAAW,EAAX,GACC,CAAClB,EAAMxB,IAEV,MAAM87F,EAAmBrvF,uBAAY,KACnCytF,GAAeD,EAAf,GACC,CAACA,IAEEtB,EAAoBlsF,uBAAY,KACpCwuF,EAAUnlF,QAAQs7D,eAAeymB,EAAjC,GACC,CAACA,IAEEY,EAAchsF,uBAAY,KAC9BwuF,EAAUnlF,QAAQs9D,cAClB6nB,EAAUnlF,QAAQymE,IAAIusB,IACtB7N,EAAUnlF,QAAQpX,QAAlB,GACC,IAGH,OAAa,IAAT8C,EACK,eAAC4kE,GAAD,CAAQ9mE,UAAW+iC,mBAAK/iC,EAAWS,EAAOtD,QAG/C2zC,EACK,eAAC,GAAD,CACL5nC,QAAQ,OACRlJ,UAAW+iC,mBAAK/iC,EAAWS,EAAOtD,MAClC,wBAAgBi2C,EAAhB,kBAIG,eAACgjD,GAAD,CACL,cAAahjD,EACbpzC,UAAW+iC,mBAAKtiC,EAAOtD,KAAM6C,GAC7BzW,MAAOoxG,EACPtE,QAASmG,EAJJ,SAML,uBAAKx8F,UAAWS,EAAOo9B,OAAvB,UACG88D,GAAc,eAACnzF,GAAA,EAAD,CAAY0B,QAAQ,KAApB,4BACf,sBAAKlJ,UAAWS,EAAO8Y,OAAQ2H,IAAKg7E,IACpC,sBAAKl8F,UAAWS,EAAOw4D,OAAvB,SACE,gBAAC7mB,GAAD,WACE,eAACS,GAAD,CAAQ91C,QAAQ,aAAawD,QAAS44F,EAAtC,SACE,eAAC,KAAD,MAEF,eAACtmD,GAAD,CAAQ91C,QAAQ,oBAAoBwD,QAASi8F,EAA7C,SACG7B,EAAa,eAACnB,GAAA,EAAD,IAAoB,eAACC,GAAA,EAAD,MAEpC,eAAC5mD,GAAD,CAAQ91C,QAAQ,gBAAgBwD,QAAS84F,EAAzC,SACE,eAACM,GAAA,EAAD,eAlBV,IAuCF8P,GAAc7iE,aAAe,CAC3B2xD,YAAa,kBAGAh5B,UAAsBD,GA9Nd,iCA8NcA,CAA0BmqC,K,gCCrN/D,MAAM7gG,GAAYC,cAAYnI,IACrB,CACLvD,KAAM,CACJw9B,MAAO,OACPC,OAAQ,OACRjB,SAAU,YAEZmwE,OAAQ,CACN5uE,aAAcx6B,EAAMkH,QAAQ,GAC5BvG,QAAS,OACT09B,cAAe,MACfgZ,OAAQ,GAEVmnB,UAAW,CACTvlC,SAAU,WACVgB,MAAO,OACPC,OAAQ,QAEVxY,QAAS,CACPuX,SAAU,WACV+2B,KAAM,EACNxuB,MAAO,EACPtC,IAAK,EACLkY,OAAQ,EACRz2C,QAAS,OACT09B,cAAe,UAEjBgrE,gBAAiB,CACf1kE,KAAM,EACNgyD,UAAW,GAEb2S,gBAAiB,CACft5C,KAAM,EACNxuB,MAAO,EACPvI,SAAU,YAEZswE,UAAW,CACTtvE,MAAO,OACPC,OAAQ,QAEV6X,OAAQ,CACNpN,KAAM,GAER6kE,QAAS,CACP/pG,MAAOO,EAAMnE,QAAQ2tG,QAAQzuG,KAC7Bk+B,SAAU,WACVoe,OAAQ,EACR2Y,KAAM,MACN9wB,IAAK,YAILuqE,GAAOnsG,IAAMoI,KAAKi2B,sBAAW,CAAC,EA4BjC9iB,KAAY,IA5BqB,KAClCrX,EADkC,OAElCqnC,EAFkC,OAGlCnxC,EAHkC,WAIlCgyG,EAJkC,aAKlCC,EALkC,QAMlCC,EANkC,aAOlCC,EAPkC,UAQlCvqG,EARkC,QASlCV,EATkC,iBAUlCkrG,EAVkC,YAWlCC,EAXkC,QAYlCP,EAZkC,WAalCQ,EAbkC,SAclCC,EAdkC,cAelCC,EAfkC,QAgBlCC,EAhBkC,QAiBlC3S,EAjBkC,WAkBlC4S,EAlBkC,YAmBlCC,EAnBkC,WAoBlCC,EApBkC,QAqBlCzqG,EArBkC,mBAsBlC0qG,EAtBkC,cAuBlCC,EAvBkC,sBAwBlCC,EAxBkC,QAyBlCprE,EAzBkC,eA0BlCqrE,EACA,cAAeh4D,GACH,EACZ,MAAO7pD,EAAO8hH,GAAY7kG,oBAAS,GAC7B9F,EAAQy6C,eACRwS,EAAcrnC,kBAAO,IACpBmwE,EAAO6U,GAAY9kG,mBAAS,IAC5B+kG,EAAYC,GAAiBhlG,qBAC9BilG,EAASnlF,oBACRolF,EAAWC,GAAgBnlG,oBAAS,IACpCsqC,EAAS1tC,GAAcoD,oBAAS,GACjCiqD,EAAUnqC,mBACV24B,EAAUW,eACV,OAAEhlB,EAAF,MAAUD,EAAV,IAAiBzZ,GAAQw6B,eACzBkwD,EAAatlF,iBAAO,CAAC,GACrBulF,EAAmBvlF,mBACnBwlF,EAAYxlF,mBAGZylF,EAAkBnlG,mBAAQ,KAC9B,MAAMolG,EAAU,KAChB,IAAIrxE,EAAOC,EACP67D,EAAQ,GACV97D,EAAQqxE,EACRpxE,EAASoxE,EAAUvV,IAEnB97D,EAAQqxE,EAAUvV,EAClB77D,EAASoxE,GASX,OADiBz0F,GAAa+yF,EANP,CACrB5vF,OAAQ,MACRigB,MAAOA,EACPC,OAAQA,EACRzY,SAAU,QAGZ,GACC,CAACmoF,EAAS7T,IAEPh2F,GAASmI,GAAU,CAACtJ,QAASA,IAC/BmrG,IACFhqG,GAAOwrG,OAASxB,GAEdD,IACF/pG,GAAOonC,YAAc2iE,GAQvB,MAAM0B,GAAY/+F,uBAAYkX,IACxBA,IACGspC,EAAYn3C,UACfi1F,EAAOj1F,SAAU,EAEjBg1F,EAAcnnF,IAQhBA,EAAKgsB,iBAAiB,SAAUvuC,IAC9BA,EAAEyxD,iBACFzxD,EAAE+gC,iBAAF,KAGJqpE,GAAU11F,QAAU6N,CAApB,GACC,IAIG8nF,GAAcvlG,mBAAQ,KAAO,IAAD,QAChC,MAAMwlG,GAAkB,OAAN7iE,QAAM,IAANA,GAAA,UAAAA,EAAQtM,aAAR,eAAe3sC,QAAf,OAAuBi5C,QAAvB,IAAuBA,GAAvB,UAAuBA,EAAQ8iE,gBAA/B,iBAAuB,EAAkBpvE,aAAzC,aAAuB,EAAyB3sC,QAAhD,OAAwDi5C,QAAxD,IAAwDA,GAAxD,UAAwDA,EAAQ+iE,mBAAhE,aAAwD,EAAqBp7G,MAAK2wB,GAAI,OAAIA,QAAJ,IAAIA,OAAJ,EAAIA,EAAMvxB,QAC5Gi8G,EAAgB,CACpBC,SAAU,MACVC,WAAW,EACXC,YAAY,EACZC,UAAU,EACVN,SAAU,eAGV9kG,OAAQ,CACNxb,EAAG2U,EAAMkH,QAAQ,GACjBlT,EAAGgM,EAAMkH,QAAQ,KACjBhR,EAAG8J,EAAMkH,QAAQwkG,EAAY,EAAI,GACjCh1F,EAAG1W,EAAMkH,QAAQ,IAEnBq1B,MAAO,CACLmZ,KAAM,CACJC,OAAQ31C,EAAMxE,WAAWE,YAE3BwwG,QAAS,UAEXxV,OAAQ,CACNyV,QAAS,2BACTz2D,KAAM,CACJC,OAAQ31C,EAAMxE,WAAWE,WACzBkE,KAAM,KAGVwsG,MAAO,CACLl3D,YAAY,EACZvM,WAAW,EACXwM,UAAW,OACXC,UAAW,EACXC,QAAQ,EACRC,MAAO,UACPC,UAAU,EACVC,YAAY,EACZjZ,MAAO,CACLkZ,SAAU,GACVC,KAAM,CACJC,OAAQ31C,EAAMxE,WAAWE,WACzBkE,KAAM,GACNH,MAAO,QAETm2C,SAAU,CACRD,OAAQ31C,EAAMxE,WAAWE,WACzBkE,KAAM,GACNH,MAAO,UAIb4sG,MAAO,CACLn3D,YAAY,EACZvM,WAAW,EACXwM,UAAW,OACXC,UAAW,EACXC,QAAQ,EACRC,MAAO,UACPC,UAAU,EACVhZ,MAAO,CACLkZ,SAAU,GACVC,KAAM,CACJC,OAAQ31C,EAAMxE,WAAWE,WACzBkE,KAAM,GACNH,MAAO,SAGXm2C,SAAU,CACRD,OAAQ,2BACR/1C,KAAM,GACNH,MAAO,SAGX6sG,OAAQ,CACNp3D,YAAY,EACZvM,WAAW,EACXwM,UAAW,OACXC,UAAW,EACXC,QAAQ,EACRC,MAAO,UACPC,UAAU,EACVhZ,MAAO,CACLkZ,SAAU,EACVC,KAAM,CACJC,OAAQ,2BACR/1C,KAAM,GACNH,MAAO,SAGXm2C,SAAU,CACRD,OAAQ,2BACR/1C,KAAM,GACNH,MAAO,UAKb,OADkBoX,GAAagyB,EAAQgjE,EACvC,GACC,CAAChjE,EAAQ7oC,IAGN+oD,GAAc7iD,mBAAQ,IAOnB2Q,GAAanf,EANE,CACpB60G,YAAY,EACZC,gBAAgB,EAChBC,UAAU,EACVC,YAAY,KAGb,CAACh1G,IAGJsO,qBAAU,KAAO,IAAD,MACdolG,EAAUt1F,QAAU,CAChB62F,OAAM,OAAElB,SAAF,IAAEA,IAAF,UAAEA,GAAaW,aAAf,aAAE,EAAoB33D,MAC5Bm4D,OAAM,OAAEnB,SAAF,IAAEA,IAAF,UAAEA,GAAaY,aAAf,aAAE,EAAoB53D,MAC5Bo4D,QAAO,OAAEpB,SAAF,IAAEA,IAAF,UAAEA,GAAaa,cAAf,aAAE,EAAqB73D,MAC9B5tC,OAAM,OAAE4kG,SAAF,IAAEA,QAAF,EAAEA,GAAa5kG,OAJzB,GAMC,CAAC4kG,KAOJ,MAAMqB,GAAYrgG,uBAAa8Q,IAAY,IAAD,IACtC,MAAMwvF,EAAYphG,oBAAU6/F,GAAU11F,QAAQ+yB,QAAUsiE,EAAiBr1F,SAAW,CAAC,GAChFi3F,EAAUX,QAAOW,EAAUX,MAAQ,CAAC,GACpCW,EAAUV,QAAOU,EAAUV,MAAQ,CAAC,GACpCU,EAAUT,SAAQS,EAAUT,OAAS,CAAC,GAC3C,MAAMU,EAAYn2F,GAAa0G,EAAQwvF,GAiBvC,OAdIlD,IACFmD,EAAUZ,MAAMl3D,YAAa,EAC7B83D,EAAUX,MAAMn3D,YAAa,EAC7B83D,EAAUV,OAAOp3D,YAAa,EAC9B83D,EAAUnmG,OAASukG,EAAUt1F,QAAQjP,QAGvCmmG,EAAU/yE,OAAQ,UAAAixE,EAAWp1F,eAAX,eAAoBmkB,QAAS+yE,EAAU/yE,MACzD+yE,EAAU9yE,QAAS,UAAAgxE,EAAWp1F,eAAX,eAAoBokB,SAAU8yE,EAAU9yE,OAGvDnX,kBAAQiqF,EAAUZ,MAAM33D,SAAQu4D,EAAUZ,MAAM33D,MAAQs4D,EAAUX,MAAM33D,OACxE1xB,kBAAQiqF,EAAUX,MAAM53D,SAAQu4D,EAAUX,MAAM53D,MAAQs4D,EAAUV,MAAM53D,OACxE1xB,kBAAQiqF,EAAUV,OAAO73D,SAAQu4D,EAAUV,OAAO73D,MAAQs4D,EAAUT,OAAO73D,OACxEu4D,CAAP,GACD,CAACxB,GAAW3B,IAIToD,GAAaxgG,uBAAY,KAC7B,GAAIo9F,GAAgB2B,GAAU11F,QAC5B,IAGE,MAAMo3F,EAAgBvhG,oBAAU6/F,GAAU11F,QAAQ+yB,QAClDqkE,EAAcd,MAAMl3D,YAAa,EACjCg4D,EAAcb,MAAMn3D,YAAa,EACjCg4D,EAAcZ,OAAOp3D,YAAa,EAC7Bg4D,EAAcrmG,SAAQqmG,EAAcrmG,OAAS,CAAC,GACnD,MAAMsmG,EAAW3B,GAAU11F,QAAQnX,SAAS,GAAGA,SAAS,GAAGA,SAAS,GAAGA,SAAS,GAAGA,SACnF,IAAKyuG,EAAMC,GAAQ,MAACl+G,OAAWA,GAC/B,IAAK,MAAMm+G,KAAWH,EAAU,CAC9B,MAAMt0F,EAASy0F,EAAQ3uG,SAAS,GAC1BqxD,EAAOlvC,SAASjI,EAAO00F,aAAa,MACpC/rE,EAAQwuB,EAAOlvC,SAASjI,EAAO00F,aAAa,UAClDH,GAAQA,GAAQp9C,EAAOo9C,EAAOp9C,EAAOo9C,EACrCC,GAAQA,GAAQ7rE,EAAQ6rE,EAAO7rE,EAAQ6rE,CACxC,CACD,MAAMG,EAAahC,GAAU11F,QAAQwlC,YACrC4xD,EAAcrmG,OAAOxb,EAAI+hH,EACzBF,EAAcrmG,OAAO7S,EAAIw5G,EAAaH,EACtCt9C,EAAQj6C,QAAUnK,oBAAUuhG,EAAcrmG,QAC1C4mG,KAAOC,SAASlC,GAAU11F,QAASo3F,EAGpC,CAFC,MAAO9rG,GACPhD,QAAQC,IAAI,yCAA0C+C,EACvD,CACF,GACA,CAACoqG,GAAW3B,IAGfvoC,2BAAgB,KACd,GAAIrnC,GAASC,EAGX,GAFA0wE,EAAS3wE,EAAQC,GACjBgxE,EAAWp1F,QAAU,CAACmkB,QAAOC,UACzB+yB,EAAYn3C,QACdm1F,GAAa,OACR,CAOL,MAAMpiE,EAASikE,KACXpC,EACFzzG,OAAO02G,uBAAsB,KAG3BF,KAAOC,SAASlC,GAAU11F,QAAS+yB,GACnCokE,IAAY,KAGdQ,KAAOC,SAASlC,GAAU11F,QAAS+yB,GACnCokE,KAEH,CACF,GACA,CAACzB,GAAWvxE,EAAOC,EAAQwwE,EAAgBuC,GAAYH,KAK1DxrC,2BAAgB,KACd,IAAK9/D,IAASwpG,EAEZ,aADa,IAATxpG,GAAgBkB,GAAW,IAIjC,MAAMmmC,EAASikE,GAAUrB,IACrBx+C,EAAYn3C,SACd23F,KAAOG,QAAQpC,GAAU11F,QAAStU,EAAMqnC,EAAQkgB,IAChDgiD,EAAOj1F,SAAU,EACjBm3C,EAAYn3C,SAAU,EAGlB00F,GACFA,EAAcqD,WAAUhlE,IAGtB,MAAMmkE,EAAYn2F,GAAagyB,EAAQ2iE,GAAU11F,QAAQ+yB,QACzD5xC,OAAO02G,uBAAsB,KAC3BF,KAAOC,SAASlC,GAAU11F,QAASk3F,EAAnC,GADF,IAKJtqG,GAAW,IAIX+qG,KAAOK,MAAMtC,GAAU11F,QAAStU,EAAMqnC,EAAQkgB,IAGhDkkD,MAGuB,IAAnBlC,EAAOj1F,UACLo0F,GACFsB,GAAU11F,QAAQi4F,GAAG,qBAAsB7D,GAEzCD,GACFuB,GAAU11F,QAAQi4F,GAAG,gBAAiB9D,GAEpCD,GACFwB,GAAU11F,QAAQi4F,GAAG,kBAAmB/D,GAEtCG,GACFqB,GAAU11F,QAAQi4F,GAAG,eAAgB5D,GAEnCC,GACFoB,GAAU11F,QAAQi4F,GAAG,kBAAmB3D,GAEtCC,GACFmB,GAAU11F,QAAQi4F,GAAG,mBAAoB1D,GAEvCC,GACFkB,GAAU11F,QAAQi4F,GAAG,kBAAmBzD,GAEtCzqG,GACF2rG,GAAU11F,QAAQi4F,GAAG,eAAgBluG,GAEnC0qG,GACFiB,GAAU11F,QAAQi4F,GAAG,0BAA2BxD,GAElDQ,EAAOj1F,SAAU,EAClB,GAEA,CAAC00F,EAAeX,EAAcgB,EAAY59C,EAAazrD,EAAMunD,GAAa0iD,GAAaT,EAAWQ,GAAWxB,EAAYE,EAAe+C,GAAYH,KAIvJ9mG,qBAAU,KAAO,IAAD,EACVokG,GAAU,OAAIoB,SAAJ,IAAIA,IAAJ,UAAIA,GAAW11F,eAAf,OAAI,EAAoBi4F,IACpCvC,GAAU11F,QAAQi4F,GAAG,kBAAmB3D,EACzC,GACA,CAACA,EAAYoB,KAGhB,MAAM/S,GAAchsF,uBAAY,KAC9B,UAAI++F,SAAJ,IAAIA,OAAW11F,QAAS,CAGtB,MAAMk4F,GAAQr2G,gBAAMyzG,EAAUt1F,QAAQ62F,QAChCsB,GAAQt2G,gBAAMyzG,EAAUt1F,QAAQ82F,QAChCsB,GAASv2G,gBAAMyzG,EAAUt1F,QAAQ+2F,SACjCE,EAAYD,KACZjkE,EAAS,IACVkkE,EACHX,MAAO,IAAIW,EAAUX,MAAOzjE,WAAYqlE,EAAMv5D,MAAOu5D,EAAO,IAAI5C,EAAUt1F,QAAQ62F,QAAUI,EAAUX,MAAM33D,OAC5G43D,MAAO,IAAIU,EAAUV,MAAO1jE,WAAYslE,EAAMx5D,MAAOw5D,EAAO,IAAI7C,EAAUt1F,QAAQ82F,QAAUG,EAAUV,MAAM53D,OAC5G63D,OAAQ,IAAIS,EAAUT,OAAQ3jE,WAAYulE,EAAOz5D,MAAOy5D,EAAQ,IAAI9C,EAAUt1F,QAAQ+2F,SAAWE,EAAUT,OAAO73D,QAEpHg5D,KAAOC,SAASlC,GAAU11F,QAAS+yB,GACnCokE,KACAzV,GAAWA,GACZ,IACA,CAACgU,GAAWhU,EAASyV,GAAYH,KAG9BqB,GAAa1hG,uBAAY,KAAO,IAAD,EACnC0+F,EAAiBr1F,QAAUnK,oBAAS,OAAC6/F,SAAD,IAACA,IAAD,UAACA,GAAW11F,eAAZ,aAAC,EAAoB+yB,OAAzD,GACC,CAAC2iE,KAGEnV,GAAc5pF,uBAAY,KAC9B0hG,KACAxD,GAAU9hH,EAAV,GACC,CAACA,EAAOslH,KAGLC,GAAgB3hG,uBAAY,KAChCghG,KAAOY,cAAc7C,GAAU11F,QAASu1F,EAAxC,GACC,CAACG,GAAWH,IAGfrlG,qBAAU,KACR,SAASsoG,EAAerwE,GACtB,GAAI,CAAC,SAAU,UAAUtvC,SAASsvC,EAAMpmC,KAAM,CAC5C,MAAMgxC,EAAS2iE,GAAU11F,QAAQ+yB,cAC1BA,EAAO0lE,WACd,MAAM/sG,EAAOgqG,GAAU11F,QAAQtU,KAC/BA,EAAKjI,SAAQusF,WACJA,EAAQ0oB,cAAf,IAEFf,KAAOK,MAAMtC,GAAU11F,QAAStU,EAAMqnC,GACtCyhE,GAAcA,GACf,CACF,CAED,OADArzG,OAAO04C,iBAAiB,UAAW2+D,GAC5B,IAAMr3G,OAAO24C,oBAAoB,UAAW0+D,EAAnD,GACC,CAAC9C,GAAWlB,IAEfmE,8BAAoB51F,GAAQ,MAC1BrM,QACEisF,IACD,EACDqD,mBACEzF,IACD,EACDuT,UACEwE,IACD,EACDD,aACEA,IACD,EACDT,SAASp1E,GAAW,IAAD,EACjB,aAAIkzE,GAAU11F,eAAd,OAAI,EAAmB+yB,OAAQ,CAC7B,MAAMmkE,EAAY10E,EAASkzE,GAAU11F,QAAQ+yB,QAC7C4kE,KAAOC,SAASlC,GAAU11F,QAASk3F,EACpC,CACF,MAIH,MAAMpU,GAAU1yF,mBAAQ,IAClBkqC,EACK,eAAC,GAAD,CACLvpC,OAAQ,EACRvH,UAAWS,GAAOupG,gBAClB1qG,QAAS,CAACixD,SAAUi6C,GACpBthG,QAAQ,OACR,wBAAgBkqC,EAAhB,mBAEgB,IAATlxC,EACF,eAAC4kE,GAAD,CAAQxnE,QAAS,CAACuoC,YAAapnC,GAAOwrG,QAAS,wBAAgB74D,EAAhB,aAEjD,MACN,CAACtC,EAAS5uC,EAAMzB,GAAQ+pG,EAAkBp3D,IAGvCg8D,GAAaxoG,mBAAQ,KACzB,MAAMyoG,EAAiBlE,EACnB,KACA,uCACF,eAACt4D,GAAD,CAAoB91C,QAAQ,aAAawD,QAAS44F,GAAlD,SACE,eAAC,KAAD,KADU,SAGZ,eAACtmD,GAAD,CAAyB91C,QAAQ,oBAAoBwD,QAASw2F,GAA9D,SACGxtG,EAAQ,eAACiwG,GAAA,EAAD,IAAoB,eAACC,GAAA,EAAD,KADnB,cAGZ,eAAC5mD,GAAD,CAAsB91C,QAAQ,gBAAgBwD,QAASuuG,GAAvD,SACE,eAACnV,GAAA,EAAD,KADU,WAGX0Q,GAAgB,eAACx3D,GAAD,CAAsB91C,QAAQ,2BAA2BwD,QAAS,KAAQ0+C,EAAQrxD,KAAKy8G,EAAb,EAA1E,SACf,eAACzQ,GAAA,EAAD,KAD2B,cAI/B,OAAQyV,GAAkBtvE,EACtB,sBAAK//B,UAAWS,GAAOqpG,OAAvB,SACE,gBAAC13D,GAAD,WAAUi9D,EAAgBtvE,OAE5B,IAJJ,GAKC,CAACA,EAASorE,EAAuB5hH,EAAOulH,GAAe/X,GAAaoC,GAAal6C,EAASorD,EAAc5pG,KAM3G,OAAO,eAAC6G,GAAA,EAAD,CACLtH,UAAW+iC,mBAAKtiC,GAAOtD,KAAM6C,GAC7B,cAAaozC,EAFR,SAIL,eAACgjD,GAAD,CACEp2F,UAAWS,GAAOwpG,UAClB1gH,MAAOA,EACP8sG,QAASU,GAHX,SAKE,uBAAK/2F,UAAWS,GAAOy+D,UAAvB,UAEE,sBAAKl/D,UAAWS,GAAO2hB,QAAvB,SACGk3E,KAIH,uBACEt5F,UAAWS,GAAO2hB,QAClBliB,MAAO,CAAC+rD,WAAYqtC,GAAU,SAAW,WAF3C,UAIG/vG,GAAS,eAACie,GAAA,EAAD,CAAY0B,QAAQ,KAApB,SAA0BkhG,IACpC,sBAAKpqG,UAAWS,GAAOspG,gBAAiB7oF,IAAKA,EAA7C,SAEE,sBAAKA,IAAKgrF,GAAWhsG,MAAO,CAACy6B,MAAO,OAAQC,OAAQ,OAAQjB,SAAU,YAAtE,SACGuwE,GAAW,eAAChtE,GAAA,EAAD,CAASD,MAAOitE,EAAhB,SACV,eAACoF,GAAA,EAAD,CAAStvG,UAAWS,GAAOypG,gBAIhCkF,YA7BT,KAwEFjF,GAAKvjE,aAAe,CAClBwjE,WAAY,GACZG,cAAc,EACda,gBAAgB,GAGHjB,UCtpBf,MAAMoF,GAAgBvxG,IAAMoI,MAAK,IAO1B,IAAD,MAP4B,KAChClE,EADgC,OAEhCqnC,EAFgC,UAGhCvpC,EAHgC,MAIhC8L,EAJgC,KAKhC/b,KACGsmE,GACC,EACJ,MAAOoT,EAAW+lC,GAAgBhpG,mBAAUtE,OAAcrS,EAAPqS,IAC5CutG,EAAcC,GAAmBlpG,wBAAS3W,GAC3C8/G,EAAa/oG,mBAAQ,IAAM,IAAI2H,GAAK,UAAU,IAC9C7N,EAAQy6C,eAGRy0D,EAAkChpG,mBAAQ,IACzC1E,EAGQ,gBAATnS,EACK,CAAC,CAAC,GAAG,IAELmS,EAAKjW,KAAI6nB,GACT+7F,mBAAS/7F,EAAEg8F,yBAGP,CAAC,IAAIj7F,GAASf,EAAEg8F,wBAAyBH,GAAYx7F,SAASrI,GAAOniB,SAAS,GAF9E,CAAC,GAAG,KAPR,CAAC,MAACkG,OAAWA,KAarB,CAACqS,EAAMytG,EAAY7jG,EAAO/b,IAK7B2W,qBAAU,KACR,IAAKxE,EAEH,YADAstG,EAAattG,GAIf,MAEM6tG,EAAW,GACXC,EAAW9tG,EAAKjW,KAAI6nB,GAAKA,EAAE2C,QAAQ,GAAV,SAAyBnoB,SAClD+uB,EAAQm5B,GAAcw5D,EAASh7G,QAAO,CAACvG,EAAG2oB,IAAM3oB,EAAI2oB,GAAG,GAAI,KAAM44F,EAAS1hH,OAAS,EAAI0hH,EAAS,GAAK,MAAMl2G,SACjHoI,EAAKjI,SAAQ,CAAC6Z,EAAGte,KACf,MAAMy6G,EAAYn8F,EAAE2C,QAAQ,GAAV,SAAyBnoB,OACrC4hH,EAASp8F,EAAE2C,QAAQ,GAAV,SAAyB,GAAG,GAAGnoB,OAIxC6hH,EAAe,GACrB,QAAsCtgH,IAAlCikB,EAAE2C,QAAQ,GAAG25F,iBAAgC,CAC/C,IAAI9hH,EAAS,EACb,IAAK,MAAMmoB,KAAW3C,EAAE2C,QAAS,CAC/B,MAAM25F,EAAmB,GACnBC,EAAW55F,EAAO,SAAa,GAAGnoB,OAClClE,EAAQqsB,EAAO,QAAa,GAE5B65F,EAAgBn5F,GAAS/sB,EADnBqsB,EAAO,QAAalmB,OAAO,GAAG,IAE1C,IAAK,IAAIggH,EAAU,EAAGA,EAAUF,IAAYE,EAAS,CACnD,MACMC,EAAOr5F,GAAS/sB,EADPqsB,EAAO,QAAa85F,IAEnCH,EAAiBxiH,KAAKU,EAASkiH,EAChC,CACDliH,GAAUgiH,EACV75F,EAAQ25F,iBAAmBA,EAC3BD,EAAaviH,KAAKwiH,EACnB,CACF,MACC,IAAK,MAAM35F,KAAW3C,EAAE2C,QACtB05F,EAAaviH,KAAK6oB,EAAQ25F,kBAG9BV,EAAgBS,GAGhB,IAAIvtG,EAAO,GACX,IAAK,MAAM6T,KAAW3C,EAAE2C,QACtB7T,EAAOA,EAAKhO,OAAO6hB,EAAQ25F,kBAC3BD,EAAaviH,KAAK6oB,EAAQ25F,kBAI5B,MAAMK,EAASpzF,EAAM1O,OAAOhlB,MAE5B,GAAkB,IAAdsmH,EAAiB,CACnB,MAAM1yF,EAAOF,EAAM1O,OAAOhlB,MACpB+mH,EAAQ,GACd,IAAK,IAAIC,EAAQ,EAAGA,EAAQT,IAAUS,EACpCD,EAAM9iH,KAAK,IAEb,IAAK,MAAM6oB,KAAW3C,EAAE2C,QACtB,IAAK,IAAIk6F,EAAQ,EAAGA,EAAQT,IAAUS,EAAO,CAC3C,MAAMN,EAAW55F,EAAO,SAAa,GAAGnoB,OACxC,IAAK,IAAIiiH,EAAU,EAAGA,EAAUF,IAAYE,EAC1CG,EAAMC,GAAO/iH,KAAK6oB,EAAO,SAAa,GAAG85F,GAASI,GAErD,CAIH,IAAK,IAAIC,KAAQF,EACfE,EAAO,IAAI/7F,GAAS+7F,EAAMjB,GAAYx7F,SAASrI,GAAOniB,QACR,IAA1CimH,EAAgCp6G,GAAG,KACrCo7G,EAAOr8G,GAAIq8G,GAAOhB,EAAgCp6G,GAAG,KAEvDu6G,EAASniH,KACP,CACEJ,EAAGoV,EACHu7C,EAAGyyD,EACH7gH,KAAM,UACN+pB,KAAM,QACN4yF,YAAY,EACZmE,YAAa/8F,EAAEhiB,KACfyrB,KAAMA,GAIb,CAGD,MAAMmzF,EAAQ,GACd,IAAK,IAAIC,EAAQ,EAAGA,EAAQT,IAAUS,EACpCD,EAAM9iH,KAAK,IAEb,IAAK,MAAM6oB,KAAW3C,EAAE2C,QAAS,CAC/B,IAAK,IAAIk6F,EAAQ,EAAGA,EAAQT,IAAUS,EAAO,CAC3C,MAAMN,EAAW55F,EAAO,SAAa,GAAGnoB,OACxC,IAAK,IAAIiiH,EAAU,EAAGA,EAAUF,IAAYE,EAC1CG,EAAMC,GAAO/iH,KAAK6oB,EAAO,SAAa,GAAG85F,GAASI,GAErD,CACD/tG,EAAOA,EAAKhO,OAAO6hB,EAAQ25F,iBAC5B,CAGD,IAAK,IAAKU,EAAOF,KAASF,EAAMj4G,UAC9Bm4G,EAAO,IAAI/7F,GAAS+7F,EAAMjB,GAAYx7F,SAASrI,GAAOniB,QACR,IAA1CimH,EAAgCp6G,GAAG,KACrCo7G,EAAOr8G,GAAIq8G,GAAOhB,EAAgCp6G,GAAG,KAEvDu6G,EAASniH,KACP,CACEJ,EAAGoV,EACHu7C,EAAGyyD,EACH9+G,KAAMgiB,EAAEhiB,KACR/B,KAAM,UACN+pB,KAAM,QACN4yF,WAAsB,IAAVoE,QAA0BjhH,IAAXikB,EAAEhiB,KAC7B++G,YAAa/8F,EAAEhiB,KACfyrB,KAAMkzF,IAMC,gBAAT1gH,GAA0B6/G,EAAgC,GAAG,IAAMp6G,IAAM0M,EAAK5T,OAAS,GACzFyhH,EAASniH,KAAK,CACZJ,EAAG,CAACoV,EAAK,GAAIA,EAAKA,EAAKtU,OAAS,IAChC6vD,EAAG,CAAC,EAAG,GACPrsD,KAAM,mBACN46G,YAAY,EACZ38G,KAAM,OACN+pB,KAAM,QACNyD,KAAM,CACJpd,MAAO,OACPw6B,MAAO,IAGZ,IAGH60E,EAAaO,EAAb,GACC,CAAC7tG,EAAMxB,EAAOoL,EAAO6jG,EAAY5/G,EAAM6/G,IAG1C,MAAMmB,EAAYnqG,mBAAQ,KACxB,MAAM2lG,EAAgB,CACpBO,MAAO,CACLkE,UAAW,EACX16D,SAAU,CACRh2C,KAAM,IAER2wG,UAAU,GAEZlE,MAAO,CACL9vE,MAAO,CACL3sC,KAAK,WAAD,OAAaq/G,EAAWx7F,SAASrI,GAAOtY,QAAxC,MAENy9G,SAAmB,gBAATlhH,GAEZktC,MAAO,CACL3sC,KAAM,CACJA,KAAM,mBAGVo8G,YAAY,EACZtV,OAAQ,CACN5pG,EAAG,EACH2wD,EAAG,EACH+yD,QAAS,QACTtE,QAAS,SACTx2D,KAAM,CACJ91C,KAAM,MAIZ,OAAOiX,GAAagyB,EAAQgjE,EAA5B,GACC,CAAChjE,EAAQx5C,EAAM4/G,EAAY7jG,IAGxBqlG,EAAiBvqG,mBAAQ,KAC7B,QAAa/W,IAATqS,IAA+B,IAATA,QAAmCrS,IAAjB4/G,EAC1C,MAAO,CAAC,EAGV,MAAMn8G,EAAS,GACT89G,EAAe,GACrB,IAAK,IAAInd,EAAW,EAAGA,EAAW/xF,EAAK,GAAGuU,QAAQnoB,SAAU2lG,EAAU,CACpE,MAAMx9E,EAAUvU,EAAK,GAAGuU,QAAQw9E,GAC1Bod,EAAa56F,EAAQozF,iBACvBpzF,EAAQozF,iBAAiB,GACzB,GACJ,GAAiB,IAAb5V,EACF3gG,EAAO1F,KAAKyjH,GACZD,EAAaxjH,KAAK6hH,EAAaxb,GAAU,QACpC,CACL,MAAMqd,EAAYh+G,EAAOA,EAAOhF,OAAS,GACrCgjH,IAAcD,IAChB/9G,EAAOA,EAAOhF,OAAS,GAAvB,UAA+BgjH,EAA/B,YAA4CD,GAE/C,CACD,MAAME,EAAW96F,EAAQozF,iBACrBpzF,EAAQozF,iBAAiB,GACzB,GACJv2G,EAAO1F,KAAK2jH,GACZH,EAAaxjH,KAAK6hH,EAAaxb,GAAU1jG,OAAO,GAAG,GACpD,CAED,MAAMihH,EAAS,GACf,IAAK,IAAIC,EAAS,EAAGA,EAASL,EAAa9iH,OAAS,IAAKmjH,EAAQ,CAC/D,MAAMC,EAAcN,EAAaK,GACjCD,EAAO5jH,KAAK,CACVmC,KAAM,OACN4hH,GAAID,EACJE,GAAI,EACJC,GAAIH,EACJI,GAAI,EACJC,KAAM,QACNx0F,KAAM,CACJpd,MAAO,OACPw6B,MAAO,EACPqc,KAAM,cAGX,CASD,MARc,CACZw6D,OAAQA,EACR1E,MAAO,CACLkF,SAAU,QACVC,SAAUb,EACVc,SAAU5+G,GAGd,GACC,CAAC4O,EAAMutG,IAGJtD,EAAcvlG,mBAAQ,IACnB2Q,GAAa45F,EAAgBJ,IACnC,CAACI,EAAgBJ,IAEpB,OAAO,eAAC,GAAD,CACL7uG,KAAMunE,EACNlgC,OAAQ4iE,EACR/B,WAAY,iBACZF,QAAS0F,EAAgC,GAAG,GAAK,KAAOlyG,GACxD2sG,aAAcnoG,EAAI,UAAGA,EAAK,UAAR,aAAG,EAASw2F,OAAS,KACvC14F,UAAWA,KACPq2D,GAPN,IA0BFk5C,GAAc3oE,aAAe,CAC3B72C,KAAM,cAGOuvE,UAAiB,iCAAjBA,CAAmDiwC,IC7SlE,MAAMI,GAAa,IAAIphG,GAAK,SAMtB4jG,GAAUn0G,IAAMoI,MAAK,IAMpB,IANqB,KAC1BlE,EAD0B,OAE1BqnC,EAF0B,UAG1BvpC,EACA,cAAeozC,KACZijB,GACC,EACJ,MAAOoT,EAAW+lC,GAAgBhpG,mBAAUtE,OAAcrS,EAAPqS,GAC7CxB,EAAQy6C,gBACR,MAACrvC,GAASgC,MACT43B,EAAUC,GAAe3nC,IAAMwI,SAAS,OACxC4rG,EAAkBC,GAAuB7rG,oBAAS,GAGnDuqG,EAAYnqG,mBAAQ,KACxB,QAAa/W,IAATqS,EACF,OAEF,MAAMqqG,EAAgB,CACpBG,YAAY,EACZtV,OAAQ,CACN5pG,EAAG,EACH2wD,EAAG,EACH+yD,QAAS,QACTtE,QAAS,OAEXG,MAAO,CACL9vE,MAAO,CACL3sC,KAAM,uBAGVw8G,MAAO,CACL7vE,MAAO,CACL3sC,KAAK,wBAAD,OAA0Bq/G,GAAWx7F,SAASrI,GAAOtY,QAArD,QAIV,OAAO+jB,GAAagyB,EAAQgjE,EAA5B,GACC,CAAChjE,EAAQz9B,EAAO5J,IAGbowG,EAAmB1rG,mBAAQ,KAC/B,IAAK1E,EAAM,OACX,MAAMqwG,EAAQrwG,EAAKjW,KAAIumH,GAASpmH,KAAK03C,OAAO0uE,EAAMC,eAClD,OAAOrmH,KAAK03C,OAAOyuE,EAAnB,GACC,CAACrwG,IAIJwE,qBAAU,KACR,IAAKxE,EAEH,YADAstG,EAAattG,GAKf,MAAM6tG,EAAW,GACXp5D,EAAaH,GAAct0C,EAAK5T,OAAQoS,GAC9C,QAAyB7Q,IAArByiH,EACF,IAAK,IAAI9lH,EAAI,EAAGA,EAAI0V,EAAK5T,SAAU9B,EAAG,CACpC,MAAMgmH,EAAQtwG,EAAK1V,GACbkmH,EAAW,IAAI79F,GAAS29F,EAAME,SAAU/C,IAAYx7F,SAASrI,GAAOniB,QACpE8oH,EAAcL,EAChBI,EAAMC,YAAYxmH,KAAK0mH,GAAcA,EAAYL,IACjDE,EAAMC,YACV1C,EAASniH,KACP,CACEJ,EAAGklH,EACHv0D,EAAGs0D,EACH3gH,KAAK,GAAD,OAAKoQ,EAAK1V,GAAGgH,MAAb,YAAsBhH,GAC1BuD,KAAM,UACN+pB,KAAM,QACNyD,KAAMo5B,EAAWnqD,IAGtB,CAEHgjH,EAAaO,EAAb,GACC,CAAC7tG,EAAMxB,EAAOoL,EAAOsmG,EAAkBE,IAE1C,MAAMzyG,EAAOkb,QAAQ2qB,GACfwU,EAAW/sC,uBAAawxB,IAC5BgH,EAAYhH,EAAMkH,cAAlB,GACC,IACGsU,EAAYhtC,uBAAY,KAC5Bw4B,EAAY,KAAZ,GACC,IAEH,OAAO,eAACr+B,GAAA,EAAD,CAAKjG,QAAQ,OAAO09B,cAAc,SAASnE,OAAO,OAAOD,MAAM,OAA/D,SACL,gBAACrzB,GAAA,EAAD,CAAK+9B,KAAK,WAAV,UACE,eAAC,GAAD,CACAnjC,KAAMunE,EACNlgC,OAAQwnE,EACR3G,WAAY,UACZpqG,UAAWA,EACX,wBAAgBozC,GAChBrT,QACE,eAAC8S,GAAD,CAAQ91C,QAAQ,UAAUwD,QAAS25C,EAAnC,SACE,eAAC,KAAD,SAGAmc,IAGJ,eAACld,GAAA,EAAD,CACE/9C,GAAG,gBACHsqC,SAAUA,EACV8U,mBAAoB,KACpB96C,aAAc,CAAEC,SAAU,SAAUC,WAAY,SAChDmmC,gBAAiB,CAAEpmC,SAAU,MAAOC,WAAY,SAChD66C,aAAW,EACT56C,KAAMA,EACNV,QAASg7C,EARb,SAUA,eAACpG,GAAA,EAAD,UACE,eAACE,GAAA,EAAD,CAAkBC,QAChB,eAACtT,GAAA,EAAD,CACEG,SAAU,KACRsxE,GAAqBD,EAArB,EAEFjyG,MAAM,UACN2gC,QAASsxE,IAGX5+G,MAAM,2BAVI,uBA1BlB,IAuDF2+G,GAAQvrE,aAAe,CACrB,cAAe,WAGF04B,UApJa,0BAoJbA,CAA+B6yC,ICxJ9C,MAAMxC,GAAa,IAAIphG,GAAK,SACtBqkG,GAAY,IAAIrkG,GAAK,WAErBskG,GAAM70G,IAAMoI,MAAK,IAOhB,IAAD,QAPkB,KACtBlE,EADsB,OAEtBqnC,EAFsB,UAGtBvpC,EAHsB,KAItBjQ,EACA,cAAeqjD,KACZijB,GACC,EACJ,MAAM,MAACvqD,GAASgC,KAGVglG,EAAgBlsG,mBAAQ,IAerB2Q,GAAagyB,EAdE,CACpBujE,MAAO,CACLiG,aAAc,QACd1pE,WAAW,EACX4nE,SAAmB,gBAATlhH,GAEZ28G,YAAY,EACZtV,OAAQ,CACN5pG,EAAG,EACH0jH,QAAS,QACTtE,QAAS,SACTzuD,EAAG,MAIN,CAAC5U,EAAQx5C,KAEL05E,EAAW+lC,GAAgBhpG,mBAAUtE,OAAcrS,EAAPqS,IAC5CiqG,EAAa6G,GAAkBxsG,mBAASssG,IACxCG,EAAiBC,GAAsB1sG,oBAAS,GACjD9F,EAAQy6C,gBACPg4D,EAAcC,GAAmB5sG,oBAAS,IAC1Ck/B,EAAUC,GAAe3nC,IAAMwI,SAAS,MAM/CE,qBAAU,KACR,IAAKxE,EAEH,YADAstG,EAAattG,GAKf,MACMmxG,EAA4B,SADlBnxG,EAAK5T,OAAS,EAAI4T,EAAK,GAAG9I,aAAUvJ,GAoSxD,SAA2BqS,EAAM4J,EAAOgnG,EAAeG,EAAiBvyG,EAAO3Q,EAAMojH,GAInF,MAAMx8D,EAAa,CAAC,QAAS,OACvB28D,EAAa,CAAC,UAAW,WAEzBvD,EAAW,GACjB,IAAIj7F,EACJ,MAAMy+F,EAAkB,GAClBC,EAAO,GACPjB,EAAQ,GACd,IAAK,MAAOkB,EAASC,KAAexxG,EAAKzJ,UAAW,CAClD,MAAMwK,EAAaywG,EAAW5hH,KAAO4hH,EAAW5hH,KAAO,GACjD6hH,EAAeD,EAAWE,eAAiB,EAAI,EACrDL,EAAgB3lH,KAAsB,IAAjB+lH,GACrB,MAAME,EAA4B,IAAjBF,EAAqB,CAAC,IAAK,KAAO,CAAC,IAEpD,IAAK,IAAIG,EAAQ,EAAGA,EAAQH,EAAcG,IAAS,CAEjD,MAAMC,EAAYL,EAAWK,UAAUD,GACjCE,EAAuBN,EAAWO,sBAAsBH,GAC9D,IAAII,EAQAC,EANFD,OAD2BrkH,IAAzBmkH,GAAsCb,EACtBY,EAAU9nH,KAAI6nB,GAAKA,EAAIkgG,IAEvBD,EAKP,gBAAThkH,GACFokH,EAAwB,EACxBr/F,GAAa,QAEqCjlB,IAA9C6jH,EAAW5D,wBAAwBgE,IACrCK,EAAwB,EACxBr/F,GAAa,IAEbq/F,EAAwB,IAAIt/F,GAAS6+F,EAAW5D,wBAAwBgE,GAAQnE,IAAYx7F,SAASrI,GAAOniB,QAC5GmrB,GAAa,GAKjB,IAAI49F,EAAW,IAAI79F,GAAS6+F,EAAWhB,SAASoB,GAAQnE,IAAYx7F,SAASrI,GAAOniB,QACtD,IAA1BwqH,IACFzB,EAAWn+G,GAAIm+G,GAAWyB,IAE5B,MAAMC,EAAiB,IAAIv/F,GAASq/F,EAAiBtB,IAAWz+F,SAASrI,GAAOniB,QAChF6pH,EAAK5lH,KAAKxB,KAAK+J,OAAOi+G,IACtB7B,EAAM3kH,KAAKxB,KAAK03C,OAAOswE,IACvB,MAAM72F,EAAO,CACXod,MAAO,EACPqc,KAAML,EAAWm9D,GACjB3zG,MAAOmzG,EAAWG,IAEpB1D,EAASniH,KACP,CACEJ,EAAG4mH,EACHj2D,EAAGu0D,EACH5gH,KAAK,GAAD,OAAKmR,GAAL,OAAkB4wG,EAASC,IAC/B/jH,KAAM,UACN+pB,KAAM,QACN4yF,WAA4B,KAAfzpG,GAAsC,IAAjB0wG,EAClCp2F,KAAMA,GAGX,CACF,CAGD,MAAM43B,EAAQ,CAAC/oD,KAAK+J,OAAOq9G,GAAOpnH,KAAK03C,OAAOyuE,IAC9C,IAAI8B,EAEFA,EADEv/F,EACiB,CACjBi4F,MAAO,CACL9vE,MAAO,CACL3sC,KAAK,2BAAD,OAA6Bq/G,GAAWx7F,SAASrI,GAAOtY,QAAxD,MAENy9G,UAAU,IAIK,CACjBlE,MAAO,CACL9vE,MAAO,CACL3sC,KAAK,WAAD,OAAaq/G,GAAWx7F,SAASrI,GAAOtY,QAAxC,QAKZ,MAAM8gH,EAAsB/8F,GAAau7F,EAAeuB,GAGlDlD,EAAiB55F,GACrB,CACEu1F,MAAO,CACL7vE,MAAO,CACL3sC,KAAM6iH,EAAY,UAAMP,GAAUz+F,SAASrI,GAAOtY,SAAhC,iBAAsDo/G,GAAUz+F,SAASrI,GAAOtY,UAEpG2hD,MAAOA,GAETiiD,OAAQ,CACNhhD,KAAM,CACJ91C,KAAM,MAIZg0G,GAGF,MAAO,CACL7qC,UAAWsmC,EACX5D,YAAagF,EACbr8F,WAAYA,EAEf,CAvZOy/F,CAAkBryG,EAAM4J,EAAOgnG,EAAeG,EAAiBvyG,EAAO3Q,EAAMojH,GAuKpF,SAA2BjxG,EAAM4J,EAAOgnG,EAAeG,EAAiBvyG,EAAO3Q,EAAMojH,GACnF,MAAMpD,EAAW,GACjB,IAAIj7F,EACJ,MAAM0+F,EAAO,GACPjB,EAAQ,GACR2B,EAAkBhyG,EAAKjW,KAAI6nB,IAC/B,MAAMigG,EAAYZ,EAChBr/F,EAAEigG,UAAU9nH,KAAI,CAACuoH,EAAS/lG,IACnB+lG,EAAQvoH,KAAIwoH,GAAqBA,EAAoB3gG,EAAEmgG,sBAAsBxlG,OAEpFqF,EAAEigG,UACJ,MAAO,IAAIjgG,EAAGigG,UAAWA,EAAzB,IAEI/D,EAAWkE,EAAgBjoH,KAAI6nB,GAAKA,EAAEigG,UAAUzlH,SAChD+uB,EAAQm5B,GAAcw5D,EAASh7G,QAAO,CAACvG,EAAG2oB,IAAM3oB,EAAI2oB,GAAG,GAAI,KAAM44F,EAAS1hH,OAAS,EAAI0hH,EAAS,GAAK,MAAMl2G,SACjHo6G,EAAgBj6G,SAAQ6Z,IAEtB,IAAIqgG,EACS,gBAATpkH,GACFokH,EAAwB,EACxBr/F,GAAa,QAEqBjlB,IAA9BikB,EAAEg8F,yBACJqE,EAAwB,EACxBr/F,GAAa,IAEbq/F,EAAwB,IAAIt/F,GAASf,EAAEg8F,wBAAyBH,IAAYx7F,SAASrI,GAAOniB,QAC5FmrB,GAAa,GAKjB,MAAMm7F,EAAYn8F,EAAEigG,UAAUzlH,OAC9B,IAAIokH,EAAW,IAAI79F,GAASf,EAAE4+F,SAAU/C,IAAYx7F,SAASrI,GAAOniB,QACpE,MAAM+qH,EAAU,IAAI7/F,GAASf,EAAEigG,UAAU,GAAInB,IAAWz+F,SAASrI,GAAOniB,QACxE,IAAIgrH,EACJnB,EAAK5lH,KAAKxB,KAAK+J,OAAOu+G,IACtBnC,EAAM3kH,KAAKxB,KAAK03C,OAAO4wE,IACL,IAAdzE,IACF0E,EAAU,IAAI9/F,GAASf,EAAEigG,UAAU,GAAInB,IAAWz+F,SAASrI,GAAOniB,QAClE6pH,EAAK5lH,KAAKxB,KAAK+J,OAAOw+G,IACtBpC,EAAM3kH,KAAKxB,KAAK03C,OAAO6wE,KAEK,IAA1BR,IACFzB,EAAWn+G,GAAIm+G,GAAWyB,IAG5B,MAAM52F,EAAOF,EAAM1O,OAAOhlB,MACR,IAAdsmH,GACFF,EAASniH,KACP,CACEJ,EAAGmnH,EACHx2D,EAAGu0D,EACH3iH,KAAM,UACN+pB,KAAM,QACN4yF,YAAY,EACZnvF,KAAMF,EAAM1O,OAAOhlB,QAIzBomH,EAASniH,KACP,CACEJ,EAAGknH,EACHv2D,EAAGu0D,EACH5gH,KAAMgiB,EAAEhiB,KACR/B,KAAM,UACN+pB,KAAM,QACN4yF,gBAAuB78G,IAAXikB,EAAEhiB,KACdyrB,KAAMA,GARV,IAaF,MAAM43B,EAAQ,CAAC/oD,KAAK+J,OAAOq9G,GAAOpnH,KAAK03C,OAAOyuE,IAEjC,gBAATxiH,GAA0BkjH,GAC5BlD,EAASniH,KAAK,CACZJ,EAAG2nD,EACHgJ,EAAG,CAAC,EAAG,GACPrsD,KAAM,mBACN46G,YAAY,EACZ38G,KAAM,OACN+pB,KAAM,QACNyD,KAAM,CACJpd,MAAO,OACPw6B,MAAO,KAMb,MAAMw2E,EAAiB55F,GACrB,CACEw1F,MAAO,CACL9vE,MAAO,CACL3sC,KAAK,WAAD,OAAaq/G,GAAWx7F,SAASrI,GAAOtY,QAAxC,OAGRs5G,MAAO,CACL7vE,MAAO,CACL3sC,KAAM6iH,EAAY,UAAMP,GAAUz+F,SAASrI,GAAOtY,SAAhC,iBAAsDo/G,GAAUz+F,SAASrI,GAAOtY,UAEpG2hD,MAAOA,EACP87D,UAAU,GAEZ7Z,OAAQ,CACNhhD,KAAM,CACJ91C,KAAM,MAIZwyG,GAGF,MAAO,CACLrpC,UAAWsmC,EACX5D,YAAagF,EACbr8F,WAAYA,EAEf,CA7RO8/F,CAAkB1yG,EAAM4J,EAAOgnG,EAAeG,EAAiBvyG,EAAO3Q,EAAMojH,GAE5EE,IACF7D,EAAa6D,EAAc5pC,WAC3BupC,EAAeK,EAAclH,aAC7B+G,EAAmBG,EAAcv+F,YAClC,GACA,CAAC5S,EAAM4J,EAAOgnG,EAAeG,EAAiBvyG,EAAO3Q,EAAMojH,IAE9D,MAAMtzG,EAAOkb,QAAQ2qB,GACfwU,EAAW/sC,uBAAawxB,IAC5BgH,EAAYhH,EAAMkH,cAAlB,GACC,IACGsU,EAAYhtC,uBAAY,KAC5Bw4B,EAAY,KAAZ,GACC,IAEH,OAAO,uCACL,eAAC,GAAD,CACEzjC,KAAMunE,EACNlgC,OAAQ4iE,EACR/B,WAAW,oBACXF,SAA6B,IAApB+I,EAA4Bv1G,GAA0B,KAC/D2sG,aAAcnoG,EAAI,UAAGA,EAAK,UAAR,aAAG,EAASw2F,OAAS,KACvC,cAAatlD,EACbpzC,UAAWA,EACX+/B,QACE,eAAC8S,GAAD,CAAQ91C,QAAQ,UAAUwD,QAAS25C,EAAU,cAAY,mBAAzD,SACE,eAAC,KAAD,SAGAmc,IAGN,eAACld,GAAA,EAAD,CACEzT,SAAUA,EACV8U,mBAAoB,KACpB96C,aAAc,CAAEC,SAAU,SAAUC,WAAY,SAChDmmC,gBAAiB,CAAEpmC,SAAU,MAAOC,WAAY,SAChD66C,aAAW,EACX56C,KAAMA,EACNV,QAASg7C,EAPX,SASE,eAACpG,GAAA,EAAD,UACE,eAACE,GAAA,EAAD,CACEC,QACE,eAACtT,GAAA,EAAD,CACEG,SAAU,KACRqyE,IAAgBlxG,EAAK,GAAG+xG,uBAAyBd,KAAkBA,GAAnE,EAEFhzG,MAAM,UACN2gC,QAASqyE,EACTrgE,WAAU,OAAC5wC,QAAD,IAACA,GAAD,UAACA,EAAO,UAAR,OAAC,EAAW+xG,wBAAyB/xG,EAAK,GAAG+xG,sBAAsBhqF,OAAMtgC,QAAmBkG,IAAVlG,MAGhG6J,MAAM,2BAZI,qBA1BlB,IA8DFq/G,GAAIjsE,aAAe,CACjB72C,KAAM,cAGOuvE,UAAiB,oCAAjBA,CAAsDuzC,IC1IrE,MAAMlD,GAAa,IAAIphG,GAAK,SACtBsmG,GAAa,IAAItmG,GAAK,YAEtBumG,GAAoB92G,IAAMoI,MAAK,IAK9B,IAL+B,KACpClE,EADoC,UAEpClC,EAFoC,MAGpC8L,EACA,cAAesnC,GACX,EACJ,MAAOq2B,EAAW+lC,GAAgBhpG,mBAAUtE,OAAcrS,EAAPqS,GAC7CxB,EAAQy6C,eAGRgO,EAAUviD,mBAAQ,KACtB,IAAK1E,EACH,MAAO,MAACrS,OAAWA,OAAWA,GAIhC,MAAMklH,EAAU7yG,EAAKA,KAAK,GAAG6yG,QACvBlgB,EAAU3yF,EAAKA,KAAK,GAAG6yG,QAAQzmH,OAC/B66D,EAAU,IAAIt0D,MAAMggG,GAC1B,IAAK,IAAIroG,EAAI,EAAGA,EAAIqoG,IAAWroG,EAAG28D,EAAQ38D,GAAKA,EAI/C,OAHA28D,EAAQnnC,MAAK,CAACvzB,EAAG2oB,IACR29F,EAAQtmH,GAAKsmH,EAAQ39F,IAAM,EAAI29F,EAAQtmH,GAAKsmH,EAAQ39F,GAAK,EAAI,IAE/D+xC,CAAP,GACC,CAACjnD,IAMJwE,qBAAU,KACR,IAAKxE,EAEH,YADAstG,EAAattG,GAIf,MAAM8yG,EAAS,GACf,IAAIxoH,EAAI,EACR,MAAMmqD,EAAaH,GAAct0C,EAAKA,KAAK5T,OAAQoS,GACnD,IAAK,MAAMu0G,KAAS/yG,EAAKA,KAAM,CAC7B,MAAMswG,EAAQ,CACZhlH,EAAG,IAAIqnB,GAASs0C,EAAQl9D,KAAIO,GAAKyoH,EAAMF,QAAQvoH,KAAKqoH,IAAY1gG,SAASrI,GAAOniB,QAChFw0D,EAAG,IAAItpC,GAASs0C,EAAQl9D,KAAIO,GAAKyoH,EAAMvC,SAASlmH,KAAKmjH,IAAYx7F,SAASrI,GAAOniB,QACjFmI,KAAMmjH,EAAMnjH,KACZ+iD,QAAe,IAANroD,GAAW,aACpBuD,KAAM,UACNwtB,KAAMo5B,EAAWnqD,IAEnBwoH,EAAOpnH,KAAK4kH,KACVhmH,CACH,CACDgjH,EAAawF,EAAb,GACC,CAAC9yG,EAAM4J,EAAOpL,EAAOyoD,IAExB,MAAM+rD,EAAatuG,mBAAQ,IACpB1E,EAIE,CACLwqG,YAAY,EACZtV,OAAQ,CACN5pG,EAAG,GACH2wD,EAAG,EACH+yD,QAAS,UAEXpE,MAAO,CACL7vE,MAAO,CACL3sC,KAAK,gBAAD,OAAkBukH,GAAW1gG,SAASrI,GAAOtY,QAA7C,MAENy9G,UAAU,GAEZlE,MAAO,CACL9vE,MAAO,CACL3sC,KAAK,WAAD,OAAaq/G,GAAWx7F,SAASrI,GAAOtY,QAAxC,MAENy9G,UAAU,IApBL,MAuBR,CAAC/uG,EAAM4J,IAEV,OAAO,eAAC,GAAD,CACL5J,KAAMunE,EACNlgC,OAAQ2rE,EACR9K,WAAW,sBACXC,aAAY,OAAEnoG,QAAF,IAAEA,OAAF,EAAEA,EAAMw2F,OACpB14F,UAAWA,EACX,cAAaozC,GANf,IA2BaksB,UAAiB,sCAAjBA,CAAwDw1C,IC1HvE,MAAMK,GAAyBtsG,aAAW,CACxC1L,KAAM,CACJw9B,MAAO,QACPC,OAAQ,QACRrzB,OAAQ,UAGC6tG,GAAgBp3G,IAAMoI,MAAK,IAAqB,IAApB,IAAC4E,EAAD,QAAM+tB,GAAa,EAC1D,MAAM74B,EAAQi1G,KACR/nG,EAASxG,mBAAQ,MACrB,QAAWmyB,EAAQ8iD,QACnB,KAAQ9iD,EAAQs8E,gBACZ,IAAIxgG,GAASkkB,EAAQs8E,gBAAiB,SAASthG,GAAG,YAAYpqB,aAC9DkG,EACJ,UAAa,IAAIglB,GAASkkB,EAAQ/qC,UAAW,SAAS+lB,GAAG,YAAYpqB,QACrE,IAAOovC,EAAQu8E,YACb,CAACv8E,IAEL,OAAO,eAAC,GAAD,CACL/4B,UAAWE,EAAM/C,KACjB+E,KAAMkL,GAFR,IAWImoG,GAAuB1sG,aAAW,CACtC1L,KAAM,CACJw9B,MAAO,QACPC,OAAQ,QACRrzB,OAAQ,UAGCiuG,GAAwBx3G,IAAMoI,MAAK,IAA4B,IAA3B,IAAC4E,EAAD,QAAM+tB,EAAN,MAAejtB,GAAW,EACzE,MAAM5L,EAAQq1G,KACRrzG,EAAO0E,mBAAQ,IAAO,CAAC,CAC3BxN,QAAS,MACTs5G,SAAU35E,EAAQ25E,SAClBqB,UAAWh7E,EAAQuE,MAAMrxC,KAAIwpH,GAAOA,EAAI9rH,QACxCmmH,wBAAyB/2E,EAAQ28E,SAC7BtpH,KAAK03C,OAAO/K,EAAQ28E,SAASzpH,KAAIuB,GAAKA,EAAEsiH,gCACxCjgH,KACD,CAACkpC,IAEN,OAAO,eAAC,GAAD,CACL/4B,UAAWE,EAAM/C,KACjB+E,KAAMA,EACN4J,MAAOA,EACP/b,KAAK,cAJP,IAaW4lH,GAAoB33G,IAAMoI,MAAK,IAA4B,IAA3B,IAAC4E,EAAD,QAAM+tB,EAAN,MAAejtB,GAAW,EACrE,MAAM5L,EAAQq1G,KACRrzG,EAAO0E,mBAAQ,IAAO,CAAC,CAC3B8rG,SAAU35E,EAAQ25E,SAClBqB,UAAWh7E,EAAQuE,MAAMrxC,KAAIwpH,GAAOA,EAAI9rH,WACrC,CAACovC,IAEN,OAAO,eAAC,GAAD,CACL/4B,UAAWE,EAAM/C,KACjB+E,KAAMA,EACN4J,MAAOA,EACP/b,KAAK,eAJP,IAaI6lH,GAAuC/sG,aAAW,CACtD1L,KAAM,CACJw9B,MAAO,QACPC,OAAQ,QACRrzB,OAAQ,UAGCsuG,GAA8B73G,IAAMoI,MAAK,IAA4B,IAA3B,IAAC4E,EAAD,QAAM+tB,EAAN,MAAejtB,GAAW,EAC/E,MAAM5L,EAAQ01G,KACR1zG,EAAO0E,mBAAQ,IAAO,CAAC,CAC3B6P,QAASsiB,EAAQtiB,QACjBizF,gBAAiB3wE,EAAQ2wE,mBACtB,CAAC3wE,IAEN,OAAO,eAAC,GAAD,CACL/4B,UAAWE,EAAM/C,KACjB+E,KAAMA,EACN4J,MAAOA,EACP/b,KAAK,eAJP,IAaI+lH,GAA2CjtG,aAAW,CAC1D1L,KAAM,CACJw9B,MAAO,QACPC,OAAQ,QACRrzB,OAAQ,QAEVwuG,MAAO,CACL10G,QAAS,OACT29B,eAAgB,YAGPg3E,GAAkCh4G,IAAMoI,MAAK,IAA4B,IAA3B,IAAC4E,EAAD,QAAM+tB,EAAN,MAAejtB,GAAW,EACnF,MAAOgO,EAAMm8F,GAAWzvG,mBAAS,MAC3B0vG,EAAa/oG,uBAAawxB,IAC9Bs3E,EAAQt3E,EAAMlnB,OAAO9tB,MAArB,GACC,CAACssH,IAEE/1G,EAAQ41G,KACR5zG,EAAO0E,mBAAQ,IAAO,CAAC,CAC3B6P,QAASsiB,EAAQtiB,QACjBizF,gBAAiB3wE,EAAQ2wE,gBACzBoG,wBAAyB/2E,EAAQ28E,SAC7BtpH,KAAK03C,OAAO/K,EAAQ28E,SAASzpH,KAAIuB,GAAKA,EAAEsiH,gCACxCjgH,KACD,CAACkpC,IACAwQ,EAAS3iC,mBAAQ,MACrBmmG,MAAO,CACL1jE,WAAW,EACX8L,MAAO,IAAItgC,GAASrX,GAAiB,iBAAiB2W,SAASrI,GAAOniB,YAEtE,CAACmiB,IAECqqG,EAAK,eAAC,GAAD,CACTn2G,UAAWE,EAAM/C,KACjB+E,KAAMA,EACNqnC,OAAQA,EACRz9B,MAAOA,IAGT,OAAO5J,EAAK,GAAGwnG,gBACX,uCACU,OAAT5vF,EACGq8F,EACA,eAAC,GAAD,CACAn2G,UAAWE,EAAM/C,KACjB+E,KAAM62B,IAGV,eAAC6e,GAAA,EAAD,CAAa72B,UAAU,WAAW/gB,UAAWE,EAAM61G,MAAnD,SACE,gBAACp7D,GAAA,EAAD,CACEvrD,KAAG,EACH,aAAW,WACX0C,KAAK,WACLo+D,aAAa,KACbnvB,SAAUm1E,EACVl2G,UAAWE,EAAM61G,MANnB,UAQE,eAAC9hE,GAAA,EAAD,CACEtqD,MAAM,KACNuqD,QAAS,eAAC0G,GAAA,EAAD,CAAOz6C,MAAM,YACtB3M,MAAM,iBACN4iH,eAAe,QAEjB,eAACniE,GAAA,EAAD,CACEtqD,MAAM,KACNuqD,QAAS,eAAC0G,GAAA,EAAD,CAAOz6C,MAAM,YACtB3M,MAAM,iBACN4iH,eAAe,gBAKrBD,CAjCJ,IAyCIE,GAA2BxtG,aAAW,CAC1C1L,KAAM,CACJw9B,MAAO,QACPC,OAAQ,QACRrzB,OAAQ,UAGC+uG,GAAkBt4G,IAAMoI,MAAK,IAA4B,IAA3B,IAAC4E,EAAD,QAAM+tB,EAAN,MAAejtB,GAAW,EACnE,MAAM5L,EAAQm2G,KAEd,OAAO,eAAC,GAAD,CACLr2G,UAAWE,EAAM/C,KACjB+E,KAAM,CAAC62B,GACPwQ,OAAQ,CAACwjE,MAAO,CAAC1jE,WAAW,IAC5Bv9B,MAAOA,GAJT,IAaIyqG,GAAmC1tG,aAAW,CAClD1L,KAAM,CACJw9B,MAAO,QACPC,OAAQ,QACRrzB,OAAQ,UAGCivG,GAA0Bx4G,IAAMoI,MAAK,IAA4B,IAA3B,IAAC4E,EAAD,QAAM+tB,EAAN,MAAejtB,GAAW,EAC3E,MAAM5L,EAAQq2G,KACRr0G,EAAO,CAAC,CACZ6yG,QAASh8E,EAAQg8E,QACjBrC,SAAU35E,EAAQ25E,SAClB5gH,KAAM,QAUR,OARAinC,EAAQ09E,QAAQx8G,SAAQgjF,IACtB/6E,EAAKtU,KAAK,CACRmnH,QAASh8E,EAAQg8E,QACjBrC,SAAUz1B,EAAIy5B,gBACd5kH,KAAMmrF,EAAI05B,eAHZ,IAOK,eAAC,GAAD,CACL32G,UAAWE,EAAM/C,KACjB+E,KAAM,CAACA,KAAMA,GACb4J,MAAOA,GAHT,IAYW8qG,GAAW54G,IAAMoI,MAAM7G,IAClC,MAAM,IAACyL,GAAOzL,GACR,MAACuM,GAASgC,KACVlL,EAAOjL,OAAOC,SAASK,KAAK1B,MAAM,KAAK8Z,MAAM9Z,MAAM,KAAK,GAE9D,MAAiB,kBAAbyU,EAAIlZ,MAAqC,8BAAT8Q,EAC3B,eAACozG,GAAD,IAAqCz2G,EAAOuM,MAAOA,IACpC,kBAAbd,EAAIlZ,MAAqC,0BAAT8Q,EAClC,eAACizG,GAAD,IAAiCt2G,EAAOuM,MAAOA,IAChC,UAAbd,EAAIlZ,MAA6B,UAAT8Q,EAC1B,eAACwyG,GAAD,IAAmB71G,EAAOuM,MAAOA,IAClB,QAAbd,EAAIlZ,MAA2B,mBAAT8Q,EACxB,eAAC4yG,GAAD,IAA2Bj2G,EAAOuM,MAAOA,IAC1B,QAAbd,EAAIlZ,MAA2B,eAAT8Q,EACxB,eAAC+yG,GAAD,IAAuBp2G,EAAOuM,MAAOA,IACtB,aAAbd,EAAIlZ,KACN,eAACwkH,GAAD,IAAqB/2G,EAAOuM,MAAOA,IACpB,oBAAbd,EAAIlZ,KACN,eAAC0kH,GAAD,IAA6Bj3G,EAAOuM,MAAOA,IAE7C,IAAP,I,8CChQK,MAAM+qG,GAAiB74G,IAAMC,gBAE9B64G,GAAgBjuG,cAAWnI,IAAK,CACpCq2G,cAAe,CACb11G,QAAS,OACT09B,cAAe,MACfl3B,WAAY,cAEduV,KAAM,CACJqmB,SAAU,EACV5J,SAAU,OACVlyB,QAAS,YACTiyB,aAAc,EACdh9B,gBAAiB8D,EAAMnE,QAAQC,QAAQZ,UACvCqB,SAAU,GACVb,WAAY,YACZ++B,WAAY,OAEd67E,YAAa,CACXt9E,UAAWh5B,EAAMkH,QAAQ,QAGhBqvG,GAAOj5G,IAAMoI,MAAK,YAAuB,IAAT,KAACgX,GAAO,EACnD,MAAM9d,EAAUw3G,KAChB,OAAO,eAAC,IAAMzvG,SAAP,UACL,uBAAKrH,UAAWV,EAAQy3G,cAAxB,UACE,sBAAK/2G,UAAWV,EAAQ8d,KAAxB,SACGA,IAEH,sBAAKpd,UAAWV,EAAQ03G,YAAxB,SACE,eAAC,mBAAD,CAAiB1mH,KAAM8sB,EAAM+oD,OAAQ,IAAM,KAA3C,SACE,eAACjpC,GAAA,EAAD,CAASD,MAAM,oBAAf,SACE,eAAC58B,GAAA,EAAD,UACE,eAAC,KAAD,gBAOb,IASY62G,GAAgBl5G,IAAMoI,MAAK,SAAuB7G,GAC7D,MAAM,QAACxC,EAAD,SAAUsC,EAAV,cAAoB83G,EAApB,gBAAmCjkE,EAAnC,YAAoDC,GAAe5zC,EAEnEyJ,EAASpC,mBAAQ,IACd5I,IAAMwb,cACX05B,EACA,IAAIC,GACJgkE,IAED,CAACjkE,EAAiBikE,EAAehkE,IAEpC,OAAO,gBAAC,IAAM9rC,SAAP,WACJhI,EACAtC,EACG,eAACmgC,GAAA,EAAD,CAASD,MAAOlgC,EAAhB,SAA0BiM,IAC1BA,IAGP,IASDkuG,GAActwE,aAAe,CAC3BsM,gBAAiB7yC,MAMZ,MAAM+2G,GAAep5G,IAAMoI,MAAK,SAAsB7G,GAC3D,MAAM,QAACxC,EAAD,gBAAUs6G,EAAV,KAA2BlgE,EAA3B,MAAiC3jD,EAAjC,MAAwCypC,EAAxC,SAA+C59B,EAA/C,YAAyD61F,KAAgBr4B,GAAet9D,GACvFM,EAAM48B,GAAWj2B,oBAAS,GAEjC,OAAO,eAAC,GAAD,CACLzJ,QAASA,EACTm2C,gBAAiBmkE,IAAoB7jH,EAAQ4V,KAAS/I,MACtD8yC,YAAa,IAAI+hD,EAAa30F,QAAS,IAAMk8B,GAAQ,IACrD06E,cAAe3jH,GAAS2jD,GAAQ,eAAC,KAAD,IAJ3B,SAML,gBAACva,GAAA,EAAD,IAAYigC,EAAah9D,KAAMA,EAA/B,UACGo9B,GAAS,eAACJ,GAAA,EAAD,UAAcI,IACxB,eAACH,GAAA,EAAD,UACGz9B,IAEH,eAAC09B,GAAA,EAAD,UACE,eAAC3zB,GAAA,EAAD,CAAQ7I,QAAS,IAAMk8B,GAAQ,GAA/B,yBAMP,IAWY66E,GAAwBt5G,IAAMoI,MAAK,YAAgF,IAAjD,YAACnE,EAAD,SAAc5C,EAAd,YAAwB61F,KAAgB31F,GAAQ,EAC7H,MAAMg4G,EAAI,qKACmEl+G,EADnE,mDAEaE,EAFb,MAIV,OAAO,gBAAC,GAAD,CAAc0jC,MAAM,MAAMlgC,QAAQ,MAAMm4F,YAAaA,KAAiB31F,EAAtE,UACL,eAAC,GAAD,CAAUjP,KAAM2R,GAAes1G,IAC/B,eAACC,GAAD,IACCn4G,IAEJ,IAUKo4G,GAAwBz5G,IAAMoI,MAAK,YAAwC,IAAT,KAACgX,GAAO,EAC9E,OAAO,eAAC,mBAAD,CAAiB9sB,KAAM8sB,GAAQ,GAAI+oD,OAAQ,IAAM,KAAjD,SACL,eAACjpC,GAAA,EAAD,CAASD,MAAM,oBAAf,SACE,eAAC58B,GAAA,EAAD,UACE,eAAC,KAAD,SAIP,IAKKq3G,GAAyB7uG,cAAWnI,IAAK,CAC7CvD,KAAM,CAAC,EACPwH,QAAS,CACPg2B,MAAO,OACPt5B,QAAS,OACT09B,cAAe,MACf9hC,SAAU,GACVb,WAAY,YACZyL,WAAY,UAEdjD,OAAQ,CACN4tC,SAAU,GACVx1C,WAAY,QAEdogB,KAAM,CACJqmB,SAAU,EACV97B,QAAS,YACTkyB,SAAU,OACVD,aAAc,EACdh9B,gBAAiB8D,EAAMnE,QAAQC,QAAQZ,UACvCu/B,WAAY,OAEdmB,QAAS,CACP5C,UAAWh5B,EAAMkH,QAAQ,GACzBoyB,aAAct5B,EAAMkH,QAAQ,GAC5BvG,QAAS,aAGAs2G,GAAgB35G,IAAMoI,MAAK,SAAiB7G,GACvD,MAAMmoB,EAAUnmB,qBAAWs1G,KACrB,OAACjyG,EAAD,IAASnN,EAAT,YAAcwK,EAAd,KAA2BD,EAA3B,SAAiCD,GAAY,IAAI2lB,KAAYnoB,GAC7DD,EAAUo4G,KAChB,IAAIE,EAUJ,OATI51G,IAEF41G,EAAeziH,KAAKE,UAClB2M,GACA,CAAClQ,EAAMnI,IAAUmI,EAAK6M,WAAW,UAAO9O,EAAYlG,GACpD,IAIG,uBAAKqW,UAAWV,EAAQnC,KAAxB,UACL,eAAC,GAAD,CAAU7M,KAAM2R,IAChB,eAACuF,GAAA,EAAD,CAAYxH,UAAWV,EAAQg9B,QAASpzB,QAAQ,QAAhD,SAAwD,2CACxD,uBAAKlJ,UAAWV,EAAQqF,QAAxB,UACE,uBAAM3E,UAAWV,EAAQsF,OAAzB,SAAkCA,IAClC,uBAAM5E,UAAWV,EAAQ8d,KAAzB,SAAgC3lB,IAChC,eAAC,GAAD,CAAuB2lB,KAAM3lB,OAE9BmgH,GAAgB,uBAAK53G,UAAWV,EAAQqF,QAASzE,MAAO,CAAC2H,WAAY,SAArD,UACf,uBAAM7H,UAAWV,EAAQsF,OAAzB,kBACA,uBAAM5E,UAAWV,EAAQ8d,KAAzB,SAAgCw6F,IAChC,eAAC,GAAD,CAAuBx6F,KAAMw6F,OAE/B,eAACpwG,GAAA,EAAD,CAAYxH,UAAWV,EAAQg9B,QAASpzB,QAAQ,QAAhD,SAAwD,4CACxD,eAAC2uG,GAAD,CAAY31G,KAAMH,MAErB,IASY+1G,GAAyB95G,IAAMoI,MAAK,YAAgE,IAAhC,YAACnE,EAAD,KAAcC,KAAS3C,GAAQ,EAC9G,OAAO,gBAAC,GAAD,CAAc09B,MAAM,OAAOlgC,QAAQ,eAAgBwC,EAAnD,UACJ0C,GAAe,gBAAC,IAAMoF,SAAP,WACd,eAAC,GAAD,CAAU/W,KAAM2R,IAChB,eAACu1G,GAAD,OAEF,eAACK,GAAD,CAAY31G,KAAMA,MAErB,IAMK61G,GAAsBlvG,cAAWnI,IAAK,CAC1Cs3G,gBAAiB,CACfjgE,OAAQ,EACRpd,MAAO,OACPC,OAAQ,EACRjB,SAAU,SACV+2B,KAAM,GAERunD,gBAAiB,CACft+E,SAAU,YAEZv5B,OAAQ,CACNu5B,SAAU,WACVuI,MAAO,EACPtC,IAAK,OACL2c,UAAW,0BAGFs7D,GAAa75G,IAAMoI,MAAK,IAAuB,IAAtB,KAAClE,KAAS3C,GAAW,EACzD,MAAMkB,EAASs3G,KACTG,EAA+B,kBAATh2G,EAAoBA,EAAO,CAACA,KAAMA,GAG9D,IAAIkb,EAAO,KACX,IACEA,EAAOjoB,KAAKE,UAAU6M,GAAM,CAACpQ,EAAMnI,IAAUmI,EAAK6M,WAAW,UAAO9O,EAAYlG,GAAO,EAC/E,CAAR,MAAQ,CAEV,OAAO,uCACJyzB,GAAQ,sBAAKpd,UAAWS,EAAOu3G,gBAAvB,SACP,sBAAKh4G,UAAWS,EAAOw3G,gBAAvB,SACE,sBAAKj4G,UAAWS,EAAOL,OAAvB,SACE,eAAC,GAAD,CAAuBgd,KAAMA,UAInC,eAAC9V,GAAA,EAAD,CAAK+vF,UAAU,OAAOh2F,QAAQ,OAAOwG,WAAW,SAAhD,SACE,eAAC,KAAD,CACEw1F,IAAK6a,EACL1a,iBAAiB,EACjB93B,UAAW,EACX+3B,mBAAmB,KACfl+F,QAdV,IAuBW44G,GAAiBn6G,IAAMoI,MAAK,YAAiC,IAAT,KAAClE,GAAO,EAEvE,MAAMkb,EAAOjoB,KAAKE,UAAU6M,GAAM,CAACpQ,EAAMnI,IAAUmI,EAAK6M,WAAW,UAAO9O,EAAYlG,GAAO,GAC7F,OAAO,eAAC,GAAD,CAAMyzB,KAAMA,GACpB,IAKYo6F,GAAuBj4G,GAAU,eAAC+H,GAAA,EAAD,CAAKm6F,QAAS,EAAd,SAAiB,eAAC2B,GAAA,EAAD,M,yBClS/D,MAAMgV,GAAap6G,IAAMoI,MAAK,IAWvB,IAXwB,SAC7BiyG,EAD6B,SAE7BC,EAF6B,YAG7BC,EAH6B,YAI7BC,EAJ6B,YAK7BC,EAL6B,OAM7BC,EAN6B,OAO7BC,EAP6B,QAQ7BzvG,EACA,cAAekqC,KACZj0B,GACC,EACJ,MAAMy5F,EAAW,CACf,SAAY,KACZ,KAAQ,eAAC,KAAD,IACR,GAAM,eAAC,KAAD,KACN1vG,GACI2vG,EAAW,CACf,SAAY,KACZ,KAAQ,eAAC,KAAD,IACR,GAAM,eAAC,KAAD,KACN3vG,GACF,OAAO,gBAAC5B,GAAA,EAAD,CAAKjG,QAAQ,UAAW8d,EAAM,cAAai0B,EAA3C,UACJilE,GAAY,eAACn7E,GAAA,EAAD,CAASD,MAAOw7E,EAAc,aAAeF,EAAc,2BAA6B,GAAxF,SACX,gCACE,gBAACtjB,GAAD,CACE30F,KAAK,QACLC,QAASm4G,EACT5nE,QAAS2nE,EACT3lE,SAAUylE,EAJZ,UAKEK,EALF,mBASHN,GAAY,gBAAClvG,GAAA,EAAD,CAAQ9I,KAAK,QAAQwyC,SAAU0lE,EAC1Cj4G,QAASo4G,EADE,UAEXE,EAFW,iBAZf,IAmCFT,GAAWxxE,aAAe,CACxB19B,QAAS,YAGIkvG,UC/Df,MAAMU,GAA4BjwG,cAAWnI,IAAK,CAChDvD,KAAM,CACJoK,OAAO,MAAD,OAAQ7G,EAAMkH,QAAQ,GAAtB,MACND,QAAQ,KAAD,OAAOjH,EAAMkH,QAAQ,GAArB,MACP+yB,MAAO,OACPt5B,QAAS,OACT09B,cAAe,MACfomC,KAAM,SACNt9D,WAAY,UAEdo1B,MAAO,CACLwG,SAAU,EACVtjC,MAAO+7C,KAAK,KACZnzC,eAAgB,OAChBxB,OAAO,MAAD,OAAQ7G,EAAMkH,QAAQ,GAAtB,MACNuzB,WAAY,SACZ95B,QAAS,OACTrE,WAAY,QAEd6Q,SAAU,CACRstB,WAAY,UAEd49E,WAAY,CACV,UAAW,CACTn8G,gBAAiBs/C,KAAK,OAG1Bnc,QAAS,CAAC,MA2EGi5E,OAxEUh7G,IAAMoI,MAAK,YAAgF,IAAD,MAArD,MAACzc,EAAD,SAAQo3C,EAAR,UAAkBhgB,EAAlB,YAA6Bk4F,KAAgB15G,GAAQ,EACjH,MAAMD,EAAUw5G,MACTj5G,EAAM48B,GAAWj2B,oBAAS,GAC3B0yG,EAAch/F,OAAM,UAAC++F,EAAYzhF,aAAb,aAAC,EAAoB,IACzC2hF,GAAkB54F,MAAM24F,GACxB9gH,EAASwgD,YAAewgE,IACxB5lH,EAAQsxB,GAAgBm0F,GAAa,EAAd,OAAoB7gH,QAApB,IAAoBA,OAApB,EAAoBA,EAAQihH,UAEzD,IAAI1xC,EACAwxC,EACFxxC,EAAeh+E,GAAS,IAAIA,IAAWkL,MAAMqkH,GAAapkH,UAAKjF,IAE/D83E,EAAeh+E,GAAS,IAAIA,IAAW,GACvCg+E,EAAY/5E,UAAKiC,IAGnB,MAAM0lE,EAAepoD,uBAAY,CAAC0U,EAAMpT,KACtC,GAAIsyB,EAAU,CACZ,IAAIpqB,EAAW9hB,MAAMoR,QAAQ4b,GAAQ,IAC/B8lD,EAAYp3E,MAAM,EAAGke,MACtBoT,KACC8lD,EAAYp3E,MAAMke,EAAQ,IAC5B,IACEk5D,EAAYp3E,MAAM,EAAGke,GACzBoT,KACI8lD,EAAYp3E,MAAMke,EAAQ,IAGhC,GAAK0qG,EAGH,IAAK,IAAI3sH,EAAImqB,EAASroB,OAAS,EAAG9B,GAAK0sH,EAAa1sH,IAClDmqB,EAAWA,EAASpmB,MAAM,EAAG/D,QAH/BmqB,EAAWA,EAAS7d,QAAOnP,QAAmBkG,IAAVlG,GAAiC,OAAVA,GAA4B,KAAVA,IAM/Eo3C,EAASpqB,EACV,IACA,CAACoqB,EAAU4mC,EAAauxC,EAAaC,IAElCh6E,EAAchyB,uBAAY,KAC9BsvB,GAAQ58B,IAASA,GAAjB,GACC,IAEH,OAAO,eAACyH,GAAA,EAAD,CAAKoyB,UAAW,EAAGM,aAAc,EAAjC,SACL,eAACs/E,GAAD,CACE9lH,MAAOA,EACPwM,UAAWV,EACXO,KAAMA,EACNU,QAAS4+B,EACTo6E,KAAM,GACNC,QAAS,EACTC,SAAU,GAPZ,SASG9xC,EAAY17E,KAAI,CAAC41B,EAAMpT,IACtB,eAACnH,GAAA,EAAD,CAAKoyB,UAAW,EAAGrwB,WAAY,EAAGvB,YAAa,EAA/C,SAA+D9J,IAAMwb,cAAcuH,EAAW,CAC5Fp3B,MAAOk4B,EACPkf,SAAUp3C,GAAS4rE,EAAa5rE,EAAO8kB,GACvCwqG,YAAaA,EACbxqG,MAAOA,KACJlP,KALkDkP,QAU9D,I,2CC7FM,MAAMirG,GAAuB17G,IAAMoI,MAAM7G,IAC9C,MAAM,YAAC05G,EAAD,MAActvH,EAAd,SAAqBo3C,EAArB,OAA+BrmB,EAA/B,KAAuCi/F,KAASnV,GAAcjlG,GAC7Dq6G,EAAWC,GAAgBrzG,mBAAS7c,GAAS,MAC9CyO,EAASwgD,YAAewgE,IACxB5lH,EAAQsxB,GAAgBm0F,GAAa,EAAd,OAAoB7gH,QAApB,IAAoBA,OAApB,EAAoBA,EAAQihH,UAEzD3yG,qBAAU,KACRmzG,GAAaC,IAAI,aAAInwH,IACZ,OAAJmwH,QAAI,IAAJA,GAAA,UAAAA,EAAMC,cAAN,oBAAAD,KAAoBA,KAAUnwH,EAAQmwH,EAAOnwH,EAC9C,IAFa,GAAjB,GAIC,CAACA,IAEJ,MAcMqwH,EAAc,CAClB15G,KAAM,QACN4I,QAAS,SACTouC,aAAc,SACduc,WAAW,EACXrgE,MAAOA,EACP7J,MAAOiwH,EACP74E,SArBmB5zB,uBAAa2sG,IAEhC,GADAD,EAAaC,GACT/4E,EACF,GAAa,OAAT+4E,EACF/4E,OAASlxC,OACJ,CACL,MAAMoqH,EAAS,OAAGH,QAAH,IAAGA,OAAH,EAAGA,EAAMC,SACpBE,GACFl5E,EAASk5E,EAEZ,CACF,GACA,CAACl5E,EAAU84E,OAUTrV,GAGL,OAAImV,EACK,eAAC,KAAD,IACDK,EACJt/F,OAAQA,GAAM,QACdw/F,aAAc,eAAC,KAAD,MAGT,eAAC,KAAD,IACDF,EACJt/F,OAAQA,GAAM,UAAOjd,GAAP,WAEjB,IAUU08G,GAAmBn8G,IAAMoI,MAAM7G,GACnC,eAACm6G,GAAD,IAA0Bn6G,EAAOmb,OAAQjd,OAQrC28G,GAAmBp8G,IAAMoI,MAAM7G,GACnC,eAACm6G,GAAD,CAAsBC,MAAI,KAAKp6G,M,yDCzDxC,MAAMo9B,GAAa3+B,IAAMoI,MAAK,IAA2B,IAA1B,MAAC62B,EAAD,YAAQh7B,GAAiB,EACtD,MAAOpC,EAAM48B,GAAWj2B,oBAAS,GAEjC,OAAO,gBAAC,IAAMa,SAAP,WACJpF,GAAe,eAAC5B,GAAA,EAAD,CAAYC,KAAK,QAAQC,QAAS,IAAMk8B,GAAQ,GAAhD,SACb,eAAC,KAAD,CAAiBx/B,SAAS,YAE5B4C,GAAQ,gBAAC+8B,GAAA,EAAD,CAAQ/8B,KAAMA,EAAd,UACP,eAACg9B,GAAA,EAAD,UACGI,IAEH,eAACH,GAAA,EAAD,UACE,eAAC,GAAD,UAAW76B,MAEb,gBAAC86B,GAAA,EAAD,WACE,uBAAM78B,MAAO,CAACujC,SAAU,KACxB,eAACr6B,GAAA,EAAD,CAAQ7I,QAAS,IAAMk8B,GAAQ,GAAQt8B,MAAM,YAA7C,2BAbN,IA0BIk6G,GAAyBxxG,cAAWnI,IAAK,CAC7CvD,KAAM,CAAC,EACPm9G,mBAAoB,CAClBxyG,YAAapH,EAAMkH,QAAQ,QAIlB2yG,GAAgBv8G,IAAMoI,MAAK,IAA+C,IAA9C,MAAC62B,EAAD,YAAQh7B,EAAR,mBAAqBq4G,GAAwB,EACpF,MAAMh7G,EAAU+6G,KAChB,OAAO,eAACG,GAAA,EAAD,CACL7gF,SAAS,MACT35B,UAAWs6G,EAAqBh7G,EAAQg7G,mBAAqBh7G,EAAQnC,KAFhE,SAIL,eAAC,GAAD,CAAY8/B,MAAOA,EAAOh7B,YAAaA,KAJzC,IAaIw4G,GAAoB5xG,cAAWnI,IAAK,CACxCvD,KAAM,CACJw9B,MAAO,OACP,gBAAiB,CACf,UAAW,CACTt5B,QAAS,cAMJq5G,GAAW18G,IAAMoI,MAAM7G,IAClC,MAAM,MAAC/L,EAAD,gBAAQmnH,KAAoBnW,GAAcjlG,EAC1CD,EAAUm7G,KAChB,OAAO,gBAACnzG,GAAA,EAAD,CAAKjG,QAAQ,OAAOwG,WAAW,SAAS7H,UAAWV,EAAQnC,KAA3D,UACL,eAACmK,GAAA,EAAD,CAAKm8B,SAAU,KAAO+gE,IACrBmW,GACC,eAACrzG,GAAA,EAAD,UACE,sBAAKlM,GAAG,OAAR,SACE,eAAC,GAAD,CAAY6hC,MAAOzpC,EAAOyO,YAAa04G,UAL/C,IAgBK,SAASC,GAAc3B,GAAc,IAAD,EACzC,MAAM9zF,EAAG,OAAG8zF,QAAH,IAAGA,GAAH,UAAGA,EAAa/zF,qBAAhB,aAAG,EAA4BC,KAClC,UAACpE,KAAc85F,IAAe,OAAH11F,QAAG,IAAHA,OAAA,EAAAA,EAAM,KAAM,CAAC,EAE9C,OADA01F,EAASrvH,KAAOqvH,EAASrvH,MAAQytH,EAAYztH,KACtC,CACLmvH,gBAAiB1B,EAAYh3G,eAC1B44G,EAEN,CAEM,MAAMC,GAAoB98G,IAAMoI,KAAKpI,IAAMq+B,YAAW,CAAC98B,EAAO2hB,KACnE,MAAM,mBAACo5F,EAAD,MAAqB9mH,EAArB,gBAA4BmnH,EAAiB,cAAeI,KAAWvW,GAAcjlG,EACrFD,EAAUm7G,KAChB,OAAO,eAAC1pD,GAAA,EAAD,CACLy2C,SAAUtmF,EACVlhB,UAAWV,EAAQnC,KACnBo1D,WAAaooD,GAAmB,CAACrmD,aAC/B,sBAAKl5D,GAAG,OAAR,SACE,eAACm/G,GAAD,CAAet9E,MAAOzpC,EAAOyO,YAAa04G,EAAiBL,mBAAoBA,OAGnF9mH,MAAOA,EACP,cAAaunH,KACTvW,EACJ76G,MAAO66G,EAAW76G,OAAS,IAX7B,KAsBWqxH,GAAqBh9G,IAAMoI,MAAM7G,IAC5C,MAAM,YAAC05G,EAAD,SAAcl4E,KAAayjE,GAAcjlG,EACzCnH,EAASwgD,YAAewgE,IACxB5lH,EAAQsxB,GAAgBm0F,GAAa,EAAd,OAAoB7gH,QAApB,IAAoBA,OAApB,EAAoBA,EAAQihH,UAEnD9jD,EAAepoD,uBAAaxjB,IAC5Bo3C,GACFA,EAAmB,KAAVp3C,OAAekG,EAAYlG,EACrC,GACA,CAACo3C,IACJ,OAAO,eAAC+5E,GAAD,CACLjnD,WAAS,EAAC3qD,QAAQ,SAAS5I,KAAK,QAChCygC,SAAUpC,GAAS42B,EAAa52B,EAAMlnB,OAAO9tB,UACzCixH,GAAc3B,MACdzU,EACJhxG,MAAOA,GALT,IAkCWynH,GAA0Bj9G,IAAMoI,KAAKpI,IAAMq+B,YAAW,CAAC98B,EAAO2hB,KACzE,MAAM,mBAACo5F,EAAD,MAAqB9mH,EAArB,MAA4B7J,EAA5B,gBAAmCgxH,EAAiB,cAAeI,KAAWvW,GAAcjlG,EAC5FD,EAAUm7G,KAEVS,EAAc/tG,uBAAaxjB,IAC/B,IACE,OAAOoxB,QAAQ,IAAI/iB,IAAIrO,GAGxB,CAFC,MAAOmY,GACP,OAAO,CACR,IACA,IAEH,OAAO,eAACivD,GAAA,EAAD,CACLb,aAAcvmE,EACd4U,WAAiB1O,IAAVlG,IAAwBuxH,EAAYvxH,GAC3CwqE,gBAAsBtkE,IAAVlG,GAAuBuxH,EAAYvxH,GAAS,GAAK,sBAC7D69G,SAAUtmF,EACVlhB,UAAWV,EAAQnC,KACnBo1D,WAAY,CAAC+B,aACX,uCACIqmD,GACF,sBAAKv/G,GAAG,OAAR,SACE,eAACm/G,GAAD,CAAet9E,MAAOzpC,EAAOyO,YAAa04G,EAAiBL,mBAAoBA,MAI/EY,EAAYvxH,IACZ,eAAC0W,GAAA,EAAD,CAAY,aAAW,YAAYE,QAAS,IAAM5I,OAAOkI,KAAKlW,EAAO,UAArE,SACE,eAAC,KAAD,UAKR6J,MAAOA,EACP,cAAa,qBACTgxG,GAvBN,KAkCW2W,GAAkBn9G,IAAMoI,MAAM7G,IACzC,MAAM,YAAC05G,EAAD,SAAcl4E,KAAayjE,GAAcjlG,EACzCnH,EAASwgD,YAAewgE,IACxB5lH,EAAQsxB,GAAgBm0F,GAAa,EAAd,OAAoB7gH,QAApB,IAAoBA,OAApB,EAAoBA,EAAQihH,UAEnD9jD,EAAepoD,uBAAaxjB,IAC5Bo3C,GACFA,EAAmB,KAAVp3C,OAAekG,EAAYlG,EACrC,GACA,CAACo3C,IAEJ,OAAO,eAACk6E,GAAD,CACLpnD,WAAS,EAAC3qD,QAAQ,SAAS5I,KAAK,QAChCygC,SAAUpC,GAAS42B,EAAa52B,EAAMlnB,OAAO9tB,UACzCixH,GAAc3B,MACdzU,EACJhxG,MAAOA,GALT,ICzPK,SAAS4nH,GAAenC,GAAc,IAAD,MAC1C,MAAM,MAACntG,GAASgC,MACV,WAAC3P,GAAcmD,KACf+5G,EAAcz0G,mBAAQ,IAAMqyG,EAAYztH,MAAQ,IAAI+iB,GAAK0qG,EAAYztH,OAAO,CAACytH,IAC7E/tG,EAAYmwG,GAAeA,EAAYnwG,WAAU,IAChDowG,mBAAoBC,GAAgCX,GAAc3B,GACnEqC,GAAgC,OAAXrC,QAAW,IAAXA,GAAA,UAAAA,EAAa/zF,qBAAb,mBAA4B7jB,eAA5B,mBAAsC,UAAtC,eAA0C7V,OAAQ+vH,EA4B7E,OA1BuB30G,mBAAQ,KAC7B,IAAKsE,EAAW,OAChB,IAAIswG,EAOJ,GAAIF,EAAoB,CACtB,IACEE,EAAwB,IAAIjtG,GAAK+sG,EAGlC,CAFC,MAAOx5G,GACP3D,EAAW,uCAAD,OAAwC86G,EAAYnnH,KAApD,wBACX,CACG0pH,EAAsBtwG,WAAU,KAAUmwG,EAAYnwG,WAAU,IAClE/M,EAAW,uCAAD,OAAwC86G,EAAYnnH,KAApD,iDAGb,MACC0pH,EAAwB,IAAIjtG,GAAK8sG,GAAalnG,SAASrI,GAGzD,OAAO0vG,CAAP,GACC,CAACF,EAAoBD,EAAanwG,EAAW+tG,EAAa96G,EAAY2N,GAG1E,CCTM,MAAM2vG,GAAcz9G,IAAMoI,MAAM7G,IACrC,MAAM,SAACwhC,EAAD,cAAW+yB,EAAX,UAA0B5oD,EAA1B,MAAqCvhB,EAArC,SAA4C+xH,EAA5C,SAAsDC,EAAtD,KAAgEnwH,EAAhE,SAAsEowH,EAAtE,YAAgF95D,EAAhF,eAA6F+5D,EAA7F,aAA6GhrE,KAAiB2zD,GAAcjlG,GAC3IhB,EAAO2zC,GAAY1rC,mBAAS,IAC7Bs1G,EAAgBx1F,iBAAO,IACvBy1F,EAAiBz1F,mBACjB01F,EAAoB11F,iBAAM,OAACw7B,QAAD,IAACA,OAAD,EAACA,EAAatuD,SACxCyoH,EAAqB31F,iBAAO,KAC3BstC,EAAYe,GAAiBnuD,mBAAS,IAEvC01G,EAAY/uG,uBAAaxjB,GACtBA,EAAMwyH,YAAY,IACtB7iH,QAAQ,UAAW,MACnBA,QAAQ,MAAO,IACfA,QAAQ,MAAO,MACjB,IAEG8iH,EAAiBjvG,uBAAY,CAACxjB,EAAOm4D,KACzC,MAAMu6D,EAAmBhkH,gBAAM1O,IAAU0O,gBAAM7M,GAC3C7B,EACA,IAAIkrB,GAASlrB,EAAOm4D,GAAa/tC,GAAGvoB,GAAM7B,QAC9C,OAAO0yH,GAAmBH,EAAUhiG,OAAOmiG,GAA3C,GACC,CAACH,EAAW1wH,IAOfkb,qBAAU,KACR,GAAKrO,gBAAM7M,GAkBJ,CACL,MAAMooE,EAAcv7D,gBAAM1O,IAAU42B,MAAM52B,GAAU,GAAKqV,OAAOrV,GAChEmyH,EAActlG,QAAUo9C,EACxBe,EAAcf,EACf,MArBC,GAAIioD,EAAgB,CAClB,IAAIpgG,EACCpjB,gBAAM1O,IAAUA,IAAUoyH,EAAevlG,UAAsB,OAAXsrC,QAAW,IAAXA,OAAA,EAAAA,EAAatuD,WAAYwoH,EAAkBxlG,QAEzFne,gBAAM1O,IAAU42B,MAAM52B,GAC/B8xB,EAAS,GACAjwB,GAAQs2D,IACjBrmC,EAAS,IAAI5G,GAASlrB,EAAO6B,GAAMuoB,GAAG+tC,GAAan4D,SAJnD8xB,EAASwgG,EAAmBzlG,QAM9BwlG,EAAkBxlG,QAAlB,OAA4BsrC,QAA5B,IAA4BA,OAA5B,EAA4BA,EAAatuD,QACzCuoH,EAAevlG,QAAU7sB,EACzBsyH,EAAmBzlG,QAAUiF,EAC7B,MAAMm4C,EAAan4C,GAAUygG,EAAUhiG,OAAOuB,IAC9CqgG,EAActlG,QAAUo9C,EACxBe,EAAcf,GACdE,EAAcF,EACf,CAKF,GACA,CAACjqE,EAAOm4D,EAAat2D,EAAMqwH,EAAgB/nD,EAAeooD,IAI7D,MAAMI,EAAanvG,uBAAa7I,IAC9B,GAAIjM,gBAAMiM,IAAoB,KAAVA,EAElB,OADA23G,EAAmBzlG,QAAU,GACtB,CAAC,EAIV,MAAOhrB,KAAM+wH,EAAP,MAAmB5yH,EAAnB,YAA0B2kB,EAA1B,MAAuC/P,GAASnJ,GAAMkP,EAAO,CAAC4G,YAAWgD,cAAc,IAK7F,GAJA+tG,EAAmBzlG,QAAUlI,EACzBiuG,IACFP,EAAkBxlG,QAAU+lG,EAAW/oH,SAErC+K,EACF,MAAO,CAACA,SAIV,IAAIi+G,GAAU,EAQd,GAPI,CAAC,QAAS,QAAS,OAAOntH,SAASqsH,GACrCc,EAAUtiG,OAAO+jC,UAAUt0D,GAClB,CAAC,SAAU,SAAU,QAAQ0F,SAASqsH,GAC/Cc,EAAUtiG,OAAO+jC,UAAUt0D,IAAUA,GAAS,EACrC,CAAC,UAAW,UAAW,SAAS0F,SAASqsH,KAClDc,GAAWj8F,MAAM52B,KAEd6yH,EACH,MAAO,CAACj+G,MAAM,gDAAD,OAAkDm9G,EAAlD,MAIf,MAAMe,EAAeviG,OAAOkiG,EAAezyH,EAAO4yH,GAAcz6D,IAChE,IAAKvhC,MAAMk8F,GAAe,CACxB,IAAKl8F,MAAMq7F,IAAaA,EAAWa,EACjC,MAAO,CAACl+G,MAAO,sDAA+Cq9G,IAAcpwH,EAAI,YAAQA,EAAR,KAAkB,KAEpG,IAAK+0B,MAAMo7F,IAAaA,EAAWc,EACjC,MAAO,CAACl+G,MAAO,qDAA8Co9G,IAAcnwH,EAAI,YAAQA,EAAR,KAAkB,IAEpG,CAED,MAAO,CAAC7B,MAAOA,EAAO6B,KAAM+wH,EAA5B,GACC,CAACb,EAAUxwG,EAAW42C,EAAas6D,EAAgBR,EAAUD,EAAUnwH,IAGpE+pE,EAAepoD,uBAAaymD,IAEhC,MAAM8oD,EAAO,OAAG9oD,QAAH,IAAGA,OAAH,EAAGA,EAAY18D,OAC5B,GAAIwlH,IAAYZ,EAActlG,QAC5B,OAIFslG,EAActlG,QAAUkmG,EACxBxqE,EAAS,IAIT,MAAMyqE,EAAcL,EAAWI,IACxB/yH,MAAOH,EAAR,MAAgB+U,GAASo+G,EACzBhoG,EAAUgoG,EAAYnxH,MAAQs2D,EAEpC,GAAIvjD,EACF2zC,EAAS3zC,QAMT,GAJKs9G,IACHlnD,EAAcsnD,EAAmBzlG,SACjCs9C,EAAcmoD,EAAmBzlG,UAE/BuqB,EAAU,CACZ,MAAM67E,EAAcR,EAAe5yH,EAAQmrB,GAC3ConG,EAAevlG,QAAUomG,EACzB,MAAMC,EAAsB3iG,OAAO0iG,GACnC77E,EAAUxgB,MAAMs8F,QAA6ChtH,EAAtBgtH,EAAiCloG,GACxEm/C,EAActqE,EACf,CACF,GACA,CAAC8yH,EAAYx6D,EAAa+5D,EAAgB96E,EAAU+yB,EAAesoD,IAGhEU,EAAwBl2G,mBAAQ,IAAMkrC,mBAASyjB,EAAc,MAAM,CAACA,IAIpE/B,EAAoBrmD,uBAAYwxB,IACpCg2B,EAAch2B,EAAMlnB,OAAO9tB,OACvBknD,GACFisE,EAAsBn+E,EAAMlnB,OAAO9tB,MACpC,GACA,CAACknD,EAAcisE,IAGZzpD,EAAalmD,uBAAY,KAC7BooD,EAAa3B,EAAb,GACC,CAAC2B,EAAc3B,IAElB,OAAO,eAACknD,GAAD,CACLjnD,WAAS,EAAC3qD,QAAQ,SAAS5I,KAAK,QAChC3W,MAAOqV,OAAO40D,GACdjC,OAAQ0B,EACR90D,QAASA,EACT41D,WAAY51D,EACZwiC,SAAUyyB,EACVY,UAAYz1B,IAA8B,UAAdA,EAAMpmC,KAAiBg9D,EAAa3B,EAAb,EACnD,cAAY,gCACR4wC,GATN,IA0BWuY,GAAqB/+G,IAAMoI,MAAM7G,IAAW,IAAD,EACtD,MAAM,YAAC05G,EAAD,MAActvH,EAAd,SAAqBo3C,KAAayjE,GAAcjlG,EAChD87G,EAAcz0G,mBAAQ,IAAMqyG,EAAYztH,MAAQ,IAAI+iB,GAAK0qG,EAAYztH,OAAO,CAACytH,IAC7E/tG,EAAYmwG,GAAeA,EAAYnwG,WAAU,GACjD8xG,EAAgB3B,GAAeA,EAAYnwG,WAAU,IACpD41B,EAASm8E,GAAcz2G,oBAAS,IAChC02G,EAAgBC,GAAqB32G,oBAAS,IAC9C80G,mBAAoBC,KAAiC6B,GAAcxC,GAAc3B,GAClFn3D,EAAcs5D,GAAenC,GAC7B7gH,EAASwgD,YAAewgE,IACxB5lH,EAAQsxB,GAAgBm0F,GAAa,EAAd,OAAoB7gH,QAApB,IAAoBA,OAApB,EAAoBA,EAAQihH,WAClD7tH,EAAM6xH,GAAW72G,mBAASs7C,GAGjCp7C,qBAAU,KACR22G,EAAQv7D,EAAR,GACC,CAACA,IAGJ,MAAMnpD,EAAUiO,mBAAQ,KACtB,MAAMkF,EAAQ,IAAIC,GAASb,IAAYjf,KAAIuB,GAAK,IAAI+gB,GAAK/gB,GAAGgG,UAI5D,OAHAhI,GAAQsgB,EAAMle,KAAKpC,EAAKgI,SACxB6nH,GAAevvG,EAAMle,KAAKytH,EAAY7nH,SACtCsuD,GAAeh2C,EAAMle,KAAKk0D,EAAYtuD,SAC/B,IAAI,IAAIgX,IAAIsB,GAAnB,GACC,CAACg2C,EAAau5D,EAAanwG,EAAW1f,IAGnC+pE,EAAepoD,uBAAY,CAACxjB,EAAO6B,KACvCu1C,EAASp3C,GACT0zH,EAAQ7xH,EAAR,GACC,CAACu1C,IAGEyyB,EAAoBrmD,uBAAa+vG,IACrCC,EAAkBD,EAAlB,GACC,IAGGI,EAAmBnwG,uBAAawH,IACpC,IAAKmsB,GAAWm4E,EAAYztH,MAAQmpB,IAAYtc,gBAAM1O,GAAQ,CAC5D,MAAMizH,EAAc,IAAI/nG,GAASqF,OAAOgjG,GAAiBvoG,GAASZ,GAAGklG,EAAYztH,MAAM7B,QACvFo3C,EAAS67E,EACV,CACDS,EAAQ,IAAI9uG,GAAKoG,GAAjB,GACC,CAACmsB,EAASo8E,EAAgBn8E,EAAUk4E,EAAYztH,KAAM7B,IAEzD,OAAO,gBAAC2d,GAAA,EAAD,CAAKjG,QAAQ,OAAb,UACL,eAACo6G,GAAD,CACE9xH,MAAOA,EACPo3C,SAAUw0B,EACVzB,cAAeN,EACftoD,UAAWA,EACX2wG,eAAgB/6E,EAChBt1C,KAAI,OAAEytH,QAAF,IAAEA,OAAF,EAAEA,EAAaztH,KACnBs2D,YAAat2D,EACbkwH,SAAQ,UAAEzC,EAAYlpH,YAAd,aAAE,EAAkBqrB,aACxBgiG,KACA5Y,EACJhxG,MAAOA,IAERhI,GACC,gBAAC8b,GAAA,EAAD,CAAKjG,QAAQ,OAAb,UACE,eAAC67B,GAAA,EAAD,CAASD,MAAO,mEAAhB,SACE,eAAC2D,GAAA,EAAD,CACEG,SAAUpC,GAASs+E,EAAWt+E,EAAMlnB,OAAOqpB,SAC3C3gC,MAAM,UACN2gC,QAASA,MAGb,eAACy8E,GAAD,CAAY5kH,QAASA,EAASnN,KAAMA,EAAM0f,UAAW8xG,EAAej8E,SAAUu8E,SAvBpF,IAkCWE,GAAsB30G,cAAWnI,IAAK,CACjDvD,KAAM,CACJw9B,MAAO,aAIE4iF,GAAav/G,IAAMoI,MAAK,IAAqD,IAApD,QAACzN,EAAD,KAAUnN,EAAV,SAAgBu1C,EAAhB,UAA0B71B,EAA1B,SAAqC4nC,GAAc,EACvF,MAAMxzC,EAAUk+G,MACTj/G,EAAO2zC,GAAY1rC,sBACnB7c,EAAO8mD,GAAYjqC,mBAAShb,EAAKgI,UACjCqM,EAAM48B,GAAWj2B,oBAAS,GAGjCE,qBAAU,KACRlb,GAAQilD,EAASjlD,EAAKgI,QAAtB,GACC,CAAChI,IAGJ,MAAMiyH,EAAStwG,uBAAanc,IAC1B,MAAM,KAACxF,EAAD,MAAO+S,GAASnJ,GAAMpE,EAAK,CAACka,YAAWiD,aAAa,IACtD5P,EACF2zC,EAAS3zC,GAETwiC,EAASv1C,EACV,GACA,CAAC0f,EAAW61B,IAETyyB,EAAoBrmD,uBAAY,CAACwxB,EAAOh1C,KAC5CuoD,IACAzB,EAAS9mD,EAAT,GACC,IAEG+zH,EAAqBvwG,uBAAY,CAACwxB,EAAOh1C,KAC7CuoD,IACAurE,EAAO9zH,EAAP,GACC,CAAC8zH,IAEE1nD,EAAenvD,mBAAQ,IACpBjO,GACN,CAACA,IAGEglH,EAAcxwG,uBAAawxB,IACb,UAAdA,EAAMpmC,MACRkkC,GAAQ,GACRghF,EAAO9zH,GACPg1C,EAAMkE,kBACNlE,EAAM40B,iBACP,GACA,CAACkqD,EAAQ9zH,IAEZ,OAAO,eAAC8pE,GAAA,EAAD,CACLzzD,UAAWV,EAAQnC,KACnBmD,KAAK,QACLozD,UAAQ,EACR5gB,SAAUA,EACV8qE,gBAAc,EACdnrD,kBAAgB,EAChB9oE,MAAOA,EACPgP,QAASo9D,EACTlE,eAAiB54D,GAAWA,EAC5Bo5D,cAAgB15D,GAAYA,EAC5Bm7D,cAAeN,EACfzyB,SAAU28E,EACV79G,KAAMA,EACNi0C,OAAQ,KAA6B,KAAjBnqD,EAAMuN,QAAiBulC,GAAQ,EAAO,EAC1Dt9B,QAAS,IAAMs9B,GAAQ,GACvBk1B,OAAQ,IAAM8rD,EAAO9zH,GACrBuqE,YAAclxD,GAAW,eAAC+tD,GAAA,EAAD,IACnB/tD,EACJxP,MAAM,OACN,cAAc,4BACd0V,QAAQ,SACR3K,QAASA,EACT41D,WAAY51D,EACZ61D,UAAWupD,EACXprD,WAAY,IACPvvD,EAAOuvD,eA1BhB,IC3TWsrD,GAAmB7/G,IAAMoI,MAAM7G,IAAW,IAAD,MACpD,MAAM,YAAC05G,EAAD,MAActvH,EAAd,SAAqBo3C,EAArB,YAA+Bhf,KAAgByiF,GAAcjlG,EAC7D69G,EAAaxC,GAAc3B,GAC3B7gH,EAASwgD,YAAewgE,IACxB5lH,EAAQsxB,GAAgBm0F,GAAa,EAAd,OAAoB7gH,QAApB,IAAoBA,OAApB,EAAoBA,EAAQihH,UAEnD9jD,EAAepoD,uBAAYxjB,IAC3Bo3C,GACFA,EAAmB,KAAVp3C,OAAekG,EAAYlG,EACrC,GACA,CAACo3C,IAEJ,MAAqC,YAAhC,UAAAk4E,EAAYlpH,YAAZ,eAAkBsrB,YAA0D,SAAhC,UAAA49F,EAAYlpH,YAAZ,eAAkBqrB,iBAA6CvrB,IAArBopH,EAAYlpH,KAC9F,eAAC,KAAD,CACL2jE,UAAQ,EACR/6D,QAASopB,GAAe,GACxBgf,SAAU,CAACpC,EAAOh1C,IAAU4rE,EAAa5rE,GACzCgoE,OAAShzB,GAAU42B,EAAa52B,EAAMlnB,OAAO9tB,OAC7Cm0H,aAAc,CAAC59G,MAAO,CAACy2F,UAAW,UAClChtG,MAAOA,GAAS,KAChBuqE,YAAalxD,GACX,eAAC83G,GAAD,IACM93G,EACJkG,QAAQ,SAAS5I,KAAK,QAAQuzD,WAAS,KACnCupD,KACA5Y,EACJhxG,MAAOA,MAMR,eAACsnH,GAAD,CACL7kB,QAAM,EAAC/sF,QAAQ,SAAS5I,KAAK,QAAQg6G,oBAAkB,EAACzmD,WAAS,EACjElqE,MAAOA,GAAS,GAChBo3C,SAAUpC,GAAS42B,EAAa52B,EAAMlnB,OAAO9tB,UACzCyzH,KACA5Y,EACJhxG,MAAOA,EANF,mBAQJylH,EAAYlpH,YARR,aAQJ,EAAkBqrB,UAAUnvB,KAAI41B,GAC/B,eAACkyB,GAAA,EAAD,CAAUpqD,MAAOk4B,EAAjB,SACGA,GADyBA,MAThC,ICjCWk8F,GAA2B//G,IAAMoI,MAAM7G,IAClD,MAAM,YAAC05G,EAAD,MAActvH,EAAd,SAAqBo3C,KAAayjE,GAAcjlG,EAChDnH,EAASwgD,YAAewgE,IACxB5lH,EAAQsxB,GAAgBm0F,GAAa,EAAd,OAAoB7gH,QAApB,IAAoBA,OAApB,EAAoBA,EAAQihH,UAEnD9jD,EAAepoD,uBAAY,CAACwxB,EAAOh1C,KACvCA,EAAQA,GAASg1C,EAAMlnB,OAAO9tB,MAC1Bo3C,GACFA,EAAoB,OAAVp3C,GAA4B,KAAVA,OAAgBkG,EAAYlG,EACzD,GACA,CAACo3C,IAEJ,OAAO,eAAC,KAAD,CACLpoC,QAASsgH,EAAYlpH,KAAKqrB,UAC1B2lB,SAAUw0B,EACVuoD,aAAc,CAAC59G,MAAO,CAACy2F,UAAW,UAClChtG,MAAOA,GAAS,KAChBuqE,YAAalxD,GACX,eAAC83G,GAAD,IACM93G,EACJkG,QAAQ,SAAS5I,KAAK,QAAQuzD,WAAS,KACnC+mD,GAAc3B,MACdzU,EACJhxG,MAAOA,KAXb,ICTWwqH,GAAmBhgH,IAAMoI,MAAK,SAA0B7G,GACnE,MAAM,YAAC05G,EAAD,MAActvH,EAAd,SAAqBo3C,EAArB,cAA+Bk9E,KAAkBzZ,GAAcjlG,EAC/D69G,EAAaxC,GAAc3B,GAC3B7gH,EAASwgD,YAAewgE,IACxB5lH,EAAQsxB,GAAgBm0F,GAAa,EAAd,OAAoB7gH,QAApB,IAAoBA,OAApB,EAAoBA,EAAQihH,UAEnD6E,EAAuB/wG,uBAAYrL,IACvC,MAAMnY,EAAQmY,EAAE2V,OAAOqpB,QACnBC,GACFA,EAASp3C,EACV,GACA,CAACo3C,IAEEo9E,EAAoBhxG,uBAAYrL,IACpC,MAAMnY,EAA2B,SAAnBmY,EAAE2V,OAAO9tB,OAA8C,UAAnBmY,EAAE2V,OAAO9tB,YAA4BkG,EACnFkxC,GACFA,EAASp3C,EACV,GACA,CAACo3C,IAEJ,OACE,eAAC25E,GAAD,IAAc0C,EAAY5pH,MAAOA,EAAjC,SACGyqH,EACC,gBAACrmE,GAAA,EAAD,WACE,eAAC8C,GAAA,EAAD,UAAYlnD,IACZ,eAACmnD,GAAA,EAAD,CAAYvrD,KAAG,EAACzF,MAAOqV,OAAOrV,GAAQo3C,SAAUo9E,EAAhD,SACG3lH,OAAOK,KAAKolH,GAAehyH,KAAIsM,GAC9B,eAAC07C,GAAA,EAAD,CACEtqD,MAAO4O,EAEP27C,QAAS,eAAC0G,GAAA,EAAD,IAAW4pD,IACpBhxG,MAAOyqH,EAAc1lH,IAFhBA,UAQb,eAAC07C,GAAA,EAAD,CACEC,QACE,eAACtT,GAAA,EAAD,CACEG,SAAUm9E,EACV/9G,MAAM,UACN2gC,SAAmB,IAAVn3C,EACTk3C,mBAAyBhxC,IAAVlG,KACX66G,IAGRhxG,MAAOA,KAKhB,IC1DKoV,GAAYC,cAAWnI,IAAK,CAChC09G,OAAQ,CACNzjF,MAAO,OACP6X,SAAU,SAmCC6rE,OA/BqBrgH,IAAMoI,MAAK,IAAmD,IAAlD,KAACvG,EAAD,KAAOqC,EAAP,QAAaxD,EAAb,YAAsB4/G,EAAtB,SAAmCC,GAAc,EAC/F,MAAMj/G,EAAUsJ,KAEhB,OAAO,eAAC,IAAMvB,SAAP,UACL,gBAACu1B,GAAA,EAAD,CAAQt9B,QAAS,CAACg8B,MAAOh8B,EAAQ8+G,QAASv+G,KAAMA,EAAM2+G,sBAAoB,EAAC,cAAY,6BAAvF,UACE,eAAC3hF,GAAA,EAAD,6BACA,eAACC,GAAA,EAAD,UACE,eAACwqE,GAAA,EAAD,UACG5oG,GAAO,kGAGZ,gBAACq+B,GAAA,EAAD,WACE,uBAAM78B,MAAO,CAACujC,SAAU,KACxB,eAACr6B,GAAA,EAAD,CAAQ7I,QAASg+G,EAAUp+G,MAAM,YAAjC,gBAGA,eAACiJ,GAAA,EAAD,CAAQ7I,QAAS,IAAM+9G,EAAYp8G,GAAO/B,MAAM,YAAhD,wBAbN,ICXF,SAASs+G,GAAwBl/G,GAC/B,OACE,gBAAC+H,GAAA,EAAD,CAAKjG,QAAQ,OAAOwG,WAAW,SAA/B,UACE,eAACP,GAAA,EAAD,CAAKqzB,MAAM,OAAO+jF,GAAI,EAAtB,SACE,eAACC,GAAA,EAAD,CAAgBz1G,QAAQ,iBAAkB3J,MAE5C,eAACiI,GAAA,EAAD,CAAY0B,QAAQ,QAAQ/I,MAAM,gBAAlC,mBAAsD/T,KAAK2oF,MACzDx1E,EAAM5V,OADR,SAKL,CAKc,SAASi1H,GAAT,GAA4C,IAAd,UAACC,GAAY,EACtD,OAAIA,GAA2B,IAAdA,EACP,gBAACjiF,GAAA,EAAD,CAAQ/8B,MAAI,EAAZ,UACN,eAACg9B,GAAA,EAAD,iCACA,eAACC,GAAA,EAAD,UACE,eAACx1B,GAAA,EAAD,CAAKqzB,MAAO,IAAZ,SACE,eAAC8jF,GAAD,CAAyB90H,MAAOk1H,WAKnC,IACR,CChBD,MAAMC,GAA4Bj2G,cAAWnI,IAAK,CAChDq+G,SAAU,CACRr/E,OAAQ,GAEV0lE,eAAgB,CACdxoG,gBAAiB8D,EAAMnE,QAAQC,QAAQf,KACvCujH,oBAAqB,EACrBC,qBAAsB,EACtB,kCAAmC,CACjC9+G,MAAOO,EAAMnE,QAAQC,QAAQolC,mBAI7Bs9E,GAAmBlhH,IAAMoI,MAAK7G,IAClC,MAAMD,EAAUw/G,MACV,SAAC/9E,EAAD,SAAWo+E,EAAX,YAAqBlG,EAArB,MAAkCtvH,KAAU66G,GAAcjlG,GAC1D,MAACkP,GAAS+1F,GACV,SAAC5mF,EAAD,SAAWqI,GAAY85E,MAAmB,CAAC,GAC3C,IAACx9F,GAAO0E,MACPm4G,EAAiBC,GAAsB74G,oBAAS,GACjD84G,EAAch5F,iBAAO,KACpBu4F,EAAWU,GAAgB/4G,mBAAS,MACrCm8D,EAAOa,KACPprE,EAASwgD,YAAewgE,IACxB5lH,EAAQsxB,GAAgBm0F,GAAa,EAAd,OAAoB7gH,QAApB,IAAoBA,OAApB,EAAoBA,EAAQihH,UAEnDmG,EAAaryG,uBAAY,SAACi5F,GAA8B,IAAvBqZ,EAAsB,wDAC3D,MAAMC,EAAuBz5F,EAASpI,SAAStnB,MAAM,KAC/CopH,EAAcD,EAAqBnvH,MAAM,EAAGmvH,EAAqBpxH,OAAS,GAAGyN,KAAK,KAClF6jH,EAAqBD,EAAYppH,MAAM,KAAKtK,KAAIwqB,GAAWuK,mBAAmBvK,KAAU1a,KAAK,KACnG,IAAI8jH,EAAYzZ,EAAMn6G,KAAK8zE,GAAS4/C,EAAcA,EAAc,IAAM5/C,EAAKjuE,KAAOiuE,EAAKjuE,OAEvF,MAAMu0G,EAAW,IAAIC,SAUrB,OATI2S,EAAYzhF,MAAMlpC,OAAS,EAC7B83G,EAAMnsG,SAAS8lE,IACbsmC,EAASzY,OAAO,OAAQ7tB,EAAxB,KAGFsmC,EAASzY,OAAO,OAAQwY,EAAM,IAC9ByZ,EAAYA,EAAU,IAGjB,IAAIl8G,SAAQ,CAACC,EAASC,KAC3BtB,EAAIwC,IAAJ,mBACc6Y,EADd,gBAC8BgiG,EAD9B,gCACwEH,GACtEpZ,EAAU,CACRyZ,iBAAmBC,IACjB,MAAMC,EAAmB5zH,KAAK2oF,MAA8B,IAAvBgrC,EAAcE,OAAgBF,EAAcziF,OACjFiiF,EAAaS,EAAb,IAIHj8G,MAAKhC,GAAY6B,EAAQ,CAAC7B,WAAU89G,gBACpC57G,OAAM1F,GAASsF,EAAOtF,KACtBqzC,SAAQ,KACP2tE,EAAa,KAAb,GAZJ,GAeH,GAAE,CAACh9G,EAAKqb,EAAUqI,EAAUgzF,IAEvB9S,EAAkBh5F,uBAAYi5F,IAAU,IAAD,EACvC,OAACA,QAAD,IAACA,GAAD,UAACA,EAAQ,UAAT,OAAC,EAAYt0G,OAIjBwtH,EAAY9oG,QAAU4vF,EACtBoZ,EAAWpZ,GAAOriG,MAAK,IAA4B,IAA3B,SAAChC,EAAD,UAAW89G,GAAe,EAC5C9+E,GACFA,EAAS8+E,EACV,IACA57G,OAAM1F,IACkB,8EAArBA,EAAMM,WACRwgH,GAAmB,GAEnBF,EAAS,IAAIvwH,MAAM2P,GACpB,IATH,GAWC,CAACihH,EAAYz+E,EAAUo+E,IAEpB5pD,EAAepoD,uBAAYwxB,IAC/B,MAAMh1C,EAAQg1C,EAAMlnB,OAAO9tB,MACvBo3C,GACFA,EAASp3C,EACV,GACA,CAACo3C,KAEE,aAACmmE,EAAD,cAAeC,EAAf,KAA8BtnG,EAA9B,aAAoCqgH,GAAgB9Y,aAAY,CAAC/C,OAAQ8B,EAAiBga,SAAS,IACnGC,EAAoBF,EAAe5gH,EAAQ8lG,eAAiB9lG,EAAQy/G,SAEpEsB,EAAkBlzG,uBAAai5F,IAAW,IAAD,EACzC,OAACA,QAAD,IAACA,GAAD,UAACA,EAAQ,UAAT,OAAC,EAAYt0G,OAIjB0tH,EAAWpZ,GAAO,GACfriG,MAAK,IAA4B,IAA3B,SAAChC,EAAD,UAAW89G,GAAe,EAC3B9+E,GACFA,EAAS8+E,EACV,IAEF57G,OAAM1F,IACL4gH,EAAS,IAAIvwH,MAAM2P,GAAnB,IAEJ8gH,GAAmB,GAAnB,GACC,CAACt+E,EAAUo+E,EAAUK,IAExB,OACE,0BAAStY,EAAa,CAAClnG,UAAWogH,IAAlC,UACE,eAACxB,GAAD,CAAsBC,UAAWA,IACjC,2BAAW1X,MACX,eAACp2C,GAAA,EAAD,CACEpnE,MAAOA,GAAS,GAAIo3C,SAAUw0B,EAC9Bj1D,KAAK,QAAQ4I,QAAQ,SAAS2qD,WAAS,EACvCrgE,MAAOA,KACHgxG,EACJjyC,WAAY,CACV+B,aACE,gBAAC,IAAMjtD,SAAP,WACE,eAAChH,GAAA,EAAD,CAAYC,KAAK,QAAQC,QAASV,EAAlC,SACE,eAACq9B,GAAA,EAAD,CAASD,MAAM,mCAAf,SACE,eAAC,KAAD,QAGH0lC,GAAQh5E,GACP,eAACm7E,GAAD,CAAYxkE,KAAK,QAAQukE,aAAmBh1E,IAAV4e,EAAsBwqG,EAAYnnH,KAAlC,UAA4CmnH,EAAYnnH,KAAxD,YAAgE2c,WAM5G,eAAC,GAAD,CACE5O,KAAMu/G,EACNl9G,KAAMo9G,EAAY9oG,QAClB8nG,YAAa+B,EACb9B,SAAU,IAAMc,GAAmB,OA5BzC,IAuCaH,U,+BCxJf,MAAMoB,GAAWz3G,cAAWnI,IAAK,CAC/BvD,KAAM,CACJC,aAAc,gCACd48B,aAAc,GAEhBumF,QAAS,CACPC,WAAY,6DACZC,mBAAoB,sBACpBC,mBAAoB,QACpBC,yBAA0B,+BAC1BC,gBAAiB,MACjBxjH,aAAa,aAAD,OAAesD,EAAMnE,QAAQC,QAAQf,WA8EtColH,OA1Ec7iH,IAAMoI,MAAM7G,IACvC,MAAMD,EAAUghH,MACV,YAACrH,EAAD,MAActvH,EAAd,SAAqBo3C,EAArB,OAA+BnG,GAAUr7B,EACzCuhH,EAAgBlmF,GAAU,IAC1BxiC,EAASwgD,YAAewgE,IACxB5lH,EAAQsxB,GAAgBm0F,GAAa,EAAd,OAAoB7gH,QAApB,IAAoBA,OAApB,EAAoBA,EAAQihH,UACnD7oE,EAAelqB,iBAAO38B,GACtBo3H,EAAcz6F,iBAAO38B,IACpB4yG,EAAOykB,GAAYx6G,oBAAS,IAC5Bs8D,EAAam+C,GAAkBz6G,oBAAS,GAE3Cu6G,EAAYvqG,UAAY7sB,IAG1Bo3H,EAAYvqG,QAAU7sB,EACtB6mD,EAAah6B,QAAU7sB,GAGzB,MAAM4rE,EAAepoD,uBAAaxjB,IAChCo3H,EAAYvqG,QAAU7sB,EAClBo3C,GACFA,EAAmB,KAAVp3C,OAAekG,EAAYlG,EACrC,GACA,CAACo3C,IAEEmgF,EAAoB/zG,uBAAY,CAACg0G,EAAUC,EAASC,EAASC,KACjEF,EAAQ,QAAUD,EAASI,OAAOxxH,KAAO,WAAaoxH,EAASK,SAA/D,GACC,IAEGC,EAAmBt0G,uBAAYu0G,IACnCT,GAAe,EAAf,GACC,CAACA,IAEJ,OACE,gBAACrpE,GAAA,EAAD,CAAaic,WAAS,EAAC0sD,QAAShkB,EAAOv8F,UAAWu8F,EAAQj9F,EAAQihH,QAAUjhH,EAAQnC,KAApF,UACE,eAACmK,GAAA,EAAD,CAAKm6F,QAAS,EAAd,SACE,eAAC/mD,GAAA,EAAD,UAAYlnD,MAEd,eAAC8T,GAAA,EAAD,CAAKszB,OAAQkoC,EAAc,UAAYg+C,EAAvC,SACE,eAAC,KAAD,CACEa,OAAQ,CAAChjF,EAAO+iF,IAAWD,EAAiBC,GAC5CE,KAAM,CACJ3uC,QAAQ,EACRr4C,OAAQkmF,EACRe,SAAS,EACTjoH,QAAS,CACP,iEACA,kCACA,wDAEFkoH,QAAS,2KAITC,KAAM,QACNC,sBAAuBd,EACvBe,mBAAmB,GAErBC,eAAgB3sD,EAChB3D,QAAS,IAAMovD,GAAS,GACxBrvD,OAAQ,IAAMqvD,GAAS,GACvBxwE,aAAc2xE,KAAUC,SAAS5xE,EAAah6B,SAAW,UA5BjE,I,+FCpDF,MAAM6rG,GAAQ,CACZ,KAAM,MACN,KAAM,MACN,IAAK,KACL,IAAK,MAEDC,GAAe,CACnB,KAAM,MACN,KAAM,MACN,IAAK,KACL,IAAK,MAGDC,GAAW,iCACXC,GAAO,YACPC,GAAa,IAAIj4H,OAAJ,YAAgB+3H,GAAhB,sBAAsCA,GAAtC,OACbG,GAAQl4H,OAAO,KAAD,OAAM+3H,GAAN,iBAAuBC,GAAvB,iBAAoCD,GAApC,OACdI,GAAW,IAAIn4H,OAAJ,YAAgB+3H,GAAhB,iBAAiCC,GAAjC,iBAA8CD,GAA9C,iBAA+DC,GAA/D,iBAA4ED,GAA5E,OACXK,GAAW,IAAIp4H,OAAJ,YAAgB+3H,GAAhB,mBAEJM,GAAiB,CAC5BC,UAAW,CACTC,MAAOH,GACPxtH,MAAQkP,IACN,MAAMimB,EAASjmB,EAAMib,MAAMqjG,IAC3B,MAAO,CACL9gG,gBAAgB,GAAD,OAAKyI,EAAO,GAAZ,QACf9S,OAAQ,aACR9tB,MAAO4gC,EAAO,GAHhB,EAMFy4F,OAAQ,4EACRC,SAAU,CAAC,oBACXzvH,MAAO,kBACP0vH,WAAY,aAEdC,SAAU,CACRJ,MAAON,GACPrtH,MAAQkP,IACN,MAAM8+G,EAAS9+G,EAAMib,MAAMkjG,IACrBhrG,EAAS2rG,EAAO,GACtB,MAAO,CACLthG,gBAAgB,GAAD,OAAKshG,EAAO,GAAZ,cAAoBA,EAAO,IAC1C3rG,SACA9tB,MAAOy5H,EAAO,GAHhB,EAMFJ,OAAQ,uDACRC,SAAU,CAAC,0BACXzvH,MAAO,iBACP0vH,WAAY,YAEdG,cAAe,CACbN,MAAOJ,GACPvtH,MAAQkP,IACN,MAAMg/G,EAAiBh/G,EAAMib,MAAMojG,IAC7Bl0H,EAAI60H,EAAe,GACnBC,EAAMD,EAAe,GACrBlsG,EAAIksG,EAAe,GACnBE,EAAMF,EAAe,GACrBn2H,EAAIm2H,EAAe,GACnB7rG,EAASL,EACTztB,EAAQ,CACZ,CAAC24H,GAAaiB,IAAO90H,EACrB,CAAC4zH,GAAMmB,IAAOr2H,GAEhB,MAAO,CACL20B,gBAAgB,GAAD,OAAKwhG,EAAe,GAApB,YAA0BA,EAAe,GAAzC,YAA+CA,EAAe,GAA9D,YAAoEA,EAAe,GAAnF,YAAyFA,EAAe,IACvH7rG,SACA9tB,QAHF,EAMFq5H,OAAQ,wJACRC,SAAU,CACR,wCACA,qFAEFzvH,MAAO,wBACP0vH,WAAY,SAEdO,mBAAoB,CAClBV,MAAOL,GACPttH,MAAQkP,IACN,MAAMo/G,EAASp/G,EAAMib,MAAMmjG,IACrBj0H,EAAIi1H,EAAO,GACXpgG,EAAKogG,EAAO,GACZtsG,EAAIssG,EAAO,GACXC,EAAU,KAAK3lE,KAAKvvD,GACpBgpB,EAASksG,EAAUvsG,EAAI3oB,EAEvB9E,EAAQ,CAAC,CAAC04H,GAAM/+F,IADRqgG,EAAUl1H,EAAI2oB,GAElC,MAAO,CACC0K,gBAAgB,GAAD,OAAK4hG,EAAO,GAAZ,YAAkBA,EAAO,GAAzB,YAA+BA,EAAO,IACrDjsG,SACA9tB,QAHR,EAMIq5H,OAAQ,yJACRC,SAAU,CACR,kCACA,+EAEFzvH,MAAO,6BACP0vH,WAAY,SAEdU,UAAW,CACTb,MAAO,OACP3tH,MAAQkP,IACC,CACLwd,gBAAiBxd,EACjBmT,OAAQ,uBACR9tB,MAAO2a,IAGX0+G,OAAQ,2IACRC,SAAU,CAAC,uBACXzvH,MAAO,kBACP0vH,WAAY,cCpGHW,GAA0B7lH,IAAMoI,MAAK,IAmB3C,IAnB4C,MACjD5S,EADiD,MAEjD7J,EAFiD,QAGjDgP,EAHiD,MAIjD4F,EAJiD,SAKjDo0D,EALiD,SAMjD5xB,EANiD,SAOjD0wB,EAPiD,SAQjDD,EARiD,OASjDG,EATiD,QAUjDnzD,EAViD,SAWjDs3D,EAXiD,eAYjDxD,EAZiD,WAajDC,EAbiD,eAcjDC,EAdiD,MAejD5qB,EAfiD,QAgBjDkJ,EAhBiD,kBAiBjDgzE,EAjBiD,wBAkBjDlxD,GACI,EAGJ,MAAM,KAAE/5D,EAAF,QAAQkrH,EAAR,OAAiBjrH,GAAW8N,mBAAQ,KACxC,MAAM/N,EAAOL,OAAOK,KAAKF,GACnBorH,EAAU,IAAIv5G,IAAI3R,IAClB,OAAEC,GAAW4oB,GAAe7oB,EAAM,GACxC,MAAO,CAAEA,OAAMkrH,UAASjrH,SAAxB,GACC,CAACH,IAEEqrH,EAAYp9G,mBAAQ,KACjB,CACLpT,WACG8+D,KAEJ,CAAC9+D,EAAO8+D,IAGL2xD,EAAgB92G,uBAAaxjB,IACjC,GAAIm6H,EACF,MAAO,CAAC5wD,OAAO,EAAM30D,WAAO1O,GAE9B,MAAMq0H,GAASv6H,GAA0B,IAAjBA,EAAM2E,OAC9B,OAAIwnE,GAAYouD,EACP,CAAChxD,OAAO,EAAM30D,WAAO1O,GACnBq0H,EACF,CAAChxD,OAAO,EAAO30D,MAAO,2BAE3Bo0D,EACKA,EAAShpE,GACLo6H,EAAQt5G,IAAI9gB,GAGlB,CAACupE,OAAO,EAAM30D,WAAO1O,GAFnB,CAACqjE,OAAO,EAAO30D,MAAM,iBAAD,OAAmB5U,EAAnB,uBAE7B,GACC,CAACgpE,EAAUoxD,EAASjuD,EAAUguD,IAG3BlhF,EAAez1B,uBAAa5U,IACxB,OAARk5D,QAAQ,IAARA,KAAWl5D,EAAKI,EAAQJ,GAAxB,GACC,CAACk5D,EAAU94D,IAGR05D,EAAgBllD,uBAAY,CAACg8B,EAAD,KAA0B,IAApB,WAAEyqB,GAAiB,EACrDqC,EAAWn9D,EAAO86D,GAEtB,OADIhsB,IAAOquB,EAAWA,EAASj0C,MAAK,CAACvzB,EAAG2oB,IAAMze,EAAQlK,GAAGm5C,MAAQjvC,EAAQye,GAAGwwB,MAAQ,GAAK,KAClFquB,CAAP,GACC,CAACt9D,EAASG,EAAQ8uC,IAErB,OAAO,eAAC0pB,GAAD,CACL3nE,MAAOA,GAAS,KAChB4U,MAAOA,EACPwiC,SAAUA,EACV0wB,SAAU7uB,EACV4uB,SAAUA,EACVG,OAAQA,EACRnzD,QAASA,EACTujB,YAAalpB,EACbu5D,iBAAkB+xD,GAClB7xD,eAAgB0xD,EAChBxxD,eAAgBA,EAChBD,WAAYA,EACZT,QAASlqB,GAAK,CAAMrvC,IAAD,oBAASI,QAAT,IAASA,GAAT,UAASA,EAAUJ,UAAnB,aAAS,EAAgBqvC,KAA9B,GACdoqB,YAAapqB,GAASoqB,GACtBH,eAAgB54D,GAAUA,EAC1Bo5D,cAAeA,EACfvhB,QAASA,EACTihB,aAAe32D,GAAO,eAACgpH,GAAD,CAAgBhpH,GAAIA,EAAIzC,QAASA,IACvDg6D,SAAUsxD,EACVrxD,wBAAyBA,GApB3B,IAsDFixD,GAAwBj9E,aAAe,CACrCpzC,MAAO,YAQF,MAAM6wH,GAAgBrmH,IAAMoI,MAAK,IAKjC,IALkC,OACvCk+G,EADuC,iBAEvCC,EAFuC,uBAGvCC,KACGrlG,GACC,EACJ,MAAM,WAAEye,GAAe2W,KAIjB57C,EAAUiO,mBAAQ,IACf69G,GAAmB7mF,EAAY0mF,EAAQC,EAAkBC,IAC/D,CAAC5mF,EAAY0mF,EAAQC,EAAkBC,IAE1C,OAAO,eAACX,GAAD,CACLlrH,QAASA,KACLwmB,GAFN,IAoBWulG,GAAgB1mH,IAAMoI,KAAKpI,IAAMq+B,YAAW,CAAC,EAKvDnb,KAAS,IAL8C,OACxDojG,EADwD,iBAExDC,EAFwD,uBAGxDC,KACGrlG,GACM,EACT,MAAM,WAAEye,GAAe2W,MAIhB57C,EAASorH,GAAWn9G,mBAAQ,KACjC,MAAMjO,EAAU8rH,GAAmB7mF,EAAY0mF,EAAQC,EAAkBC,GAEzE,MAAO,CAAC7rH,EADQ,IAAI6R,IAAIhS,OAAOK,KAAKF,IACpC,GACC,CAACilC,EAAY0mF,EAAQC,EAAkBC,IAGpC7xD,EAAWxlD,uBAAaxjB,IAC5B,MAAM,SAACoc,EAAD,KAAWnD,EAAX,OAAiBqhB,EAAQ1lB,MAAOomH,EAAhC,OAA4C5hG,GAAUa,GAAcj6B,GAC1E,GAAIg7H,EACF,MAAO,CAACzxD,OAAO,EAAO30D,MAAO,qDAE/B,IAAMwlH,EAAQt5G,IAAI1E,GAChB,MAAO,CAACmtD,OAAO,EAAO30D,MAAM,iBAAD,OAAmBwH,EAAnB,wBAE7B,IAAK,MAAM6+G,KAAS3gG,EAClB,IAAK2Z,EAAWgnF,GACd,MAAO,CAAC1xD,OAAO,EAAO30D,MAAM,iBAAD,OAAmBqmH,EAAnB,wBAG/B,OAAIhnF,EAAW73B,GAAUsiC,iBAAmBtiC,IAAanD,EAAOmgB,EACvD,CAACmwC,OAAO,EAAO30D,MAAM,iBAAD,OAAmBwH,EAAnB,yHAEtB,CAACmtD,OAAO,EAAM30D,WAAO1O,EAA5B,GACC,CAACk0H,EAASnmF,IAEb,OAAO,eAACimF,GAAD,CACLlrH,QAASA,EACTg6D,SAAUA,EACVC,yBAAuB,EACvB1xC,IAAKA,KACD/B,GALN,KAqBWglG,GAAkBnmH,IAAMq+B,YAAW,CAAC98B,EAAO2hB,KACtD,MAAM,SAAE7hB,KAAag3D,GAAU92D,EAGzB+2D,EAAWt4D,IAAMu4D,SAASC,QAAQn3D,GAClCo3D,EAAYH,EAAShoE,OAGrBooE,EAAgBlyC,GACbxmB,IAAM24D,eAAenyC,IAAUA,EAAMz0B,OAAS6mE,KANpC,GADF,GAmBXC,EAAUE,GAAcN,GAE9B,OAAO,sBAAKv1C,IAAKA,EAAV,SACL,eAAC,GAAoB1hB,SAArB,CAA8B7V,MAAO0sE,EAArC,SACE,eAACrwB,GAAA,EAAD,CAAMixB,gBAAc,EAApB,SACE,eAAC,KAAD,CACEX,SAAUA,EACV17B,QAZC67B,EAAY,EACf,IACAH,EAASrqE,IAAIyqE,GAAc1hE,QAAO,CAACvG,EAAG2oB,IAAM3oB,EAAI2oB,GAAG,IAU3B,EAAI8/C,GAC1Bv8B,MAAM,OACNzZ,IAAK21C,EACLM,iBAAkBC,GAClBC,iBAAiB,KACjBC,SAAW7oD,GAAUioD,EAAaJ,EAAS7nD,IAC3C8oD,cAAe,EACfd,UAAWA,EATb,SAWGe,UAdT,IAyBWN,GAAkB,EACzBF,GAAsB/4D,wBAAc,CAAC,GAE9Bm5D,GAAmBp5D,IAAMq+B,YAAW,CAAC98B,EAAO2hB,KACvD,MAAMu2C,EAAal2D,qBAAWy1D,IAC9B,OAAO,sBAAK91C,IAAKA,KAAS3hB,KAAWk4D,GAArC,IAGWzF,GAAehvD,GAAW,CACrC,eAAC4zD,GAAA,EAAD,CAAgC71C,UAAU,MAA1C,mBACM/d,EAAO4kC,MADb,iBAAoB5kC,EAAOzK,KAG3ByK,EAAO3D,UAGF,SAAS03D,GAAc70D,GAC5B,MAAMgf,EAAMoF,iBAAO,MAMnB,OALA5f,qBAAU,KACW,MAAfwa,EAAI1K,SACN0K,EAAI1K,QAAQsgD,gBAAgB,GAAG,EAChC,GACA,CAAC50D,IACGgf,CACR,CAEM,SAASs2C,GAAT,GAA4C,IAAzB,KAAEt1D,EAAF,MAAQuM,EAAR,MAAevO,GAAS,EAChD,OAAOlC,IAAM05D,aAAax1D,EAAKuM,GAAQ,CACrCvO,MAAO,IACFA,EACH0/B,IAAK1/B,EAAM0/B,IAAMs3B,KAGtB,CAIM,MAAM2tD,GAA0Bh8G,cAAWnI,IAAK,CACrDg1D,WAAY,CACVjyB,SAAU,EACV5I,UAAW,SACX,uBAAwB,CACtBx5B,QAAS,QAEX,qBAAsB,OACtBs0D,eAAgB,QAElBhZ,OAAQ,CACNxhB,WAAY,UAEdliC,OAAQ,CACN0hC,MAAO,OACPt5B,QAAS,OACTwG,WAAY,UAIZ,iBAAkB,CAChBokD,WAAY,SACZnkD,YAAapH,EAAMkH,SAAS,IAC5BvG,QAAS,OACTs5B,MAAOj6B,EAAMkH,QAAQ,GACrByB,WAAY3I,EAAMkH,QAAQ,GAC1BC,WAAY,SACZm3B,eAAgB,UAElB,uBAAwB,CACtBitB,WAAY,gBAILm4D,GAAiB,IAAoB,IAAD,YAAlB,GAAChpH,EAAD,QAAKzC,GAAa,EAC/C,MAAM8H,EAASokH,KACT5rH,EAASN,EAAQyC,GACjBoB,EAAUvD,EAAOuD,UAAP,UAAkBvD,EAAOqb,kBAAzB,aAAkB,EAAmBvO,WAAY9M,EAAOV,IAClEgjB,EAAQtiB,EAAOsiB,QAAP,UAAgBtiB,EAAOqb,kBAAvB,aAAgB,EAAmBiH,OAC3CwH,EAASD,GAAsB7pB,EAAO8pB,SAAP,UAAiB9pB,EAAOqb,kBAAxB,aAAiB,EAAmByO,SACnEtmB,EAAYxD,EAAOwD,YAAe8e,GAASwH,EAAV,UAChCxH,EADgC,YACvBwH,EAAM,YAAQA,GAAW,IACrC,MACE9gB,EAAchJ,EAAOgJ,cAAP,UAAsBhJ,EAAOqb,kBAA7B,aAAsB,EAAmBrS,aAE7D,OAAO,uBAAKjC,UAAWS,EAAOxH,OAAvB,UACL,eAACotC,GAAA,EAAD,CACE7pC,QAASA,EACTC,UAAWA,EACXuD,UAAWS,EAAOi1D,WAClBS,uBAAwB,CAACn2D,UAAWS,EAAOk8C,QAC3CyZ,yBAA0B,CAACp2D,UAAWS,EAAOk8C,UAE9C16C,GACC,eAACi7B,GAAA,EAAD,CAASD,MAAOh7B,GAAe,GAA/B,SACE,sBAAKjC,UAAU,cAAf,SACE,eAAC,KAAD,CAAiB/C,SAAS,QAAQkD,MAAM,iBAXhD,EAgCF,SAASskH,GAAmB7mF,EAAY0mF,EAAQC,EAAkBC,GAChE,OAAOhsH,OAAOQ,YACZR,OAAOC,QAAQmlC,GACZ9kC,QAAO,IAAkB,IAAhBP,EAAK2J,GAAU,EACvB,GAAIsiH,IAA2BtiH,EAAK6mC,aAAc,OAAO,EACzD,MAAMxtB,EAAK,OAAGrZ,QAAH,IAAGA,OAAH,EAAGA,EAAMqZ,MAIpB,OAHmB,OAAJrZ,QAAI,IAAJA,KAAMof,QAAN,OACXijG,QADW,IACXA,OADW,EACXA,EAAkB95G,IAAI8Q,GADX,OAEX+oG,QAFW,IAEXA,OAFW,EAEXA,EAAQ75G,IAAI8Q,EAChB,IAEDtvB,KAAI,QAAEsM,EAAK2J,GAAP,QAAiB,CAAC3J,EAAK,CAC1BA,IAAKA,EACL+b,WAAYpS,GAFT,IAKV,CC3YM,MAAM4iH,GAAsBj8G,cAAWnI,IAAK,CACjDvD,KAAM,CACJw9B,MAAO,OACPC,OAAQ,OACRv5B,QAAS,OACTwG,WAAY,SACZ,QAAS,CACLC,YAAapH,EAAMkH,QAAQ,IAE/B,mBAAoB,CAChBE,YAAa,GAKjB,YAAa,CACXmkD,WAAY,UAEd,kBAAmB,CACjBA,WAAY,YAGhBzvD,QAAS,CACPinC,SAAU,EACVtI,WAAY,SACZN,UAAW,SACX,uBAAwB,CACtBx5B,QAAS,QAEX,qBAAsB,OACtBs0D,eAAgB,YAGdovD,GAAa,IAAsC,IAAD,QAApC,WAAC9iG,EAAD,SAAa+iG,EAAb,QAAuBjoH,GAAa,EACtD,MAAMkoH,GAAehjG,EAAWlyB,OAASmvD,GACrC,qDADiB,UAEjB2jE,GAAe5gG,EAAWlyB,aAFT,aAEjB,EAAiCizH,SAAW,GAC1CxvH,GAASyuB,EAAWlyB,OAASmvD,GAC/B,OADW,UAEX2jE,GAAe5gG,EAAWlyB,aAFf,aAEX,EAAiCmzH,aAAe,GAC9CziH,EAASqkH,KACf,IAAI/hG,EAAQvmB,EACZ,GAAIylB,EAAWlyB,OAASmvD,GAAqB,CAC3C,MAAM,KAACt8C,EAAMmgB,OAAQmiG,GAAaliG,GAAkBf,EAAW3d,OAC/D9H,EAAUoG,EACVmgB,EAASmiG,CACV,MACC1oH,EAAUylB,EAAW3d,MAGvB,OAAO,uBAAKtE,UAAWS,EAAOtD,KAAvB,UACL,eAACqK,GAAA,EAAD,CAAYxH,UAAWS,EAAOjE,QAA9B,SACE,eAAC0gC,GAAA,EAAD,CAASD,MAAOlgC,GAAW,GAAIkkC,UAAU,SAASgc,WAAY,IAAKC,eAAgB,IAAnF,SACE,gCAAO1gD,QAGVylB,EAAWg9B,QACR,eAAC/hB,GAAA,EAAD,CAASD,MAAM,6BAAf,SACA,eAAC58B,GAAA,EAAD,CAAYL,UAAU,SAASM,KAAK,QAAQC,QAAUo+B,IACpDA,EAAM40B,iBACN50B,EAAMkE,kBACE,OAARmiF,QAAQ,IAARA,MAAQ,EAHV,SAKE,eAAC,KAAD,CAAW/nH,SAAS,QAAQkD,MAAM,eAGpC,KAEH8hB,EAAWg9B,QACR,eAAC/hB,GAAA,EAAD,CAASD,MAAM,sBAAf,SACA,eAAC,KAAD,CAAahgC,SAAS,QAAQkD,MAAM,aAEpC,KAEH4iB,EACG,eAACma,GAAA,EAAD,CAASD,MAAK,0BAAqBla,GAAnC,SACF,eAACvb,GAAA,EAAD,CAAY0B,QAAQ,UAApB,SAA+B4Z,GAAsBC,OAEnD,KAEJ,eAACma,GAAA,EAAD,CAASD,MAAOgoF,EAAhB,SACE,eAAC5/C,GAAA,EAAD,CAAM/kE,KAAK,QAAQ9M,MAAOA,QA/B9B,EA2CWoV,GAAYC,cAAWnI,IAAK,CACvCvD,KAAM,CACJw9B,MAAO,OACPt5B,QAAS,OACT09B,cAAe,UAEjBzD,MAAO,CACLX,MAAO,QAETnlB,OAAQ,CACNolB,OAAQl6B,EAAMkH,QAXU,KAYxBvG,QAAS,OACT09B,cAAe,MACfl3B,WAAY,UAEds9G,eAAgB,CACd9tB,UAAW32F,EAAMkH,QAjBO,KAkBxB8xB,UAAWh5B,EAAMkH,QAAQ,IACzB+yB,MAAO,OACPt5B,QAAS,OACT09B,cAAe,MACfl3B,WAAY,cAEd0sD,WAAY,CACV5sD,QAAS,QAOPy9G,GAAYpnH,IAAMoI,MAAK,IAGtB,IAAD,QAHwB,WAC5B/B,EAD4B,UAE5BrE,GACI,EACJ,MAAMS,EAASmI,MACT,QACJglC,EADI,WAEJhQ,EAFI,gBAGJglB,EAHI,gBAIJ4B,EAJI,cAKJmI,EALI,qBAMJE,EANI,wBAOJE,EAPI,0BAQJG,EARI,iBASJ/I,EATI,eAUJuI,EAVI,gBAWJnJ,EAXI,WAYJ4J,EAZI,WAaJlI,GACE1Q,KAEE8wE,EAAkB7sH,OACrBK,KAAKgqH,IACL/pH,QAAQP,IAAD,cAAS,OAACm0D,QAAD,IAACA,GAAD,UAACA,EAAgB3zD,eAAjB,OAAC,EAAyB1J,SAASkJ,GAA5C,IACJ+sH,EAAmBD,EACtBp5H,KAAKsM,IAAS,IAAD,QACZ,MAAM0qH,EAAQ,UAAGJ,GAAetqH,UAAlB,iBAAG,EAAqB0qH,gBAAxB,aAAG,EAA+Bh3H,KAAKs5H,GAAD,aAAmBA,KAAWxpH,KAAK,MACvF,MAAM,QAAN,iBAAe8mH,GAAetqH,UAA9B,aAAe,EAAqB/E,MAApC,yBAAgDqvH,GAAetqH,UAA/D,aAAgD,EAAqByqH,OAArE,oCAA0GC,EAA1G,iBAEDlnH,KAAK,OACD63D,EAAYe,GAAiBnuD,mBAAS,KACtCouD,EAAiBC,GAAsBruD,mBAAS,KAChDjI,EAAO2zC,GAAY1rC,oBAAS,GAC7BwjD,EAAgB7F,IAChBqhE,EAAehhE,IACfoI,EAAaD,IACb66C,EAAWlhF,oBAEVsqB,EAAe60E,EAAkBC,GAAyB9+G,mBAAQ,KACvE,IAAI++G,EAAwBt+C,EAG5B,GAAIhjE,EAAY,CACd,IAAK,MAAM0B,KAAY1B,EACrBuhH,KACE7/G,EAASjU,OAAS47C,IAAsBjjC,cAAImzB,EAAY73B,EAASjU,MAD7D,mBAEQiU,EAASjU,KAFjB,mDAKRu1E,EAAe,IAAIhjE,GACnBshH,EAAyB,IAAIn7G,IAC3B68D,EACGp7E,KAAIolD,GAAKA,EAAEv/C,OACXgH,QAAOhH,IAAI,aAAIA,IAAS47C,KAAT,UAA+B9P,EAAW9rC,UAA1C,aAA+B,EAAkBmwB,WAArD,IAIjB,KAAM,CACL0jG,EAAyB,IAAIn7G,IAAI,CAC/B,4BACA,yCACA,8CACA,mCACA,2CACA,yCACA,iBAEF,MAAMq7G,EAAa,IAAIj4E,GACvBi4E,EAAW5rH,SAAQo3C,GAAKs0E,EAAuBpxH,IAAI88C,KACnDg2B,EAAew+C,EAAW55H,KAAK6F,IAAD,CAAYA,OAAMwO,KAAM,MAGtDqlH,EAAuBpxH,IAAIm5C,IAC3B25B,EAAaz5E,KAAK,CAACkE,KAAM47C,IAC1B,CACD,MAAMo4E,EAAc,IAAIt7G,IAAI68D,EAAap7E,KAAKolD,GAAMA,EAAEv/C,QACtD,MAAO,CAACu1E,EAAcy+C,EAAaH,EAAnC,GACC,CAACthH,EAAYu5B,EAAYgQ,KAErBm4E,EAAiBC,GAAsBx/G,mBAASk/G,GACjDO,EAAuBr/G,mBAAQ,IAC5BgqC,EAAc93C,QAAQu4C,GAAM00E,EAAgBt7G,IAAI4mC,EAAEv/C,SACxD,CAAC8+C,EAAem1E,KAEZG,EAAkBC,GAAuB3/G,mBAAS,IACnD4/G,EAAiBr5D,IACjBs5D,EAAmBn5D,IACnBo5D,EAAqBz5D,EAAqB+G,IACzC2yD,EAAqBz1E,GAAWJ,GAAeu1E,EAAsBR,EAAkB7wD,EAAiBh3B,IAGxG7b,EAAalpB,GAAQ+N,mBAAQ,KAClC,MAAMmb,EAAc,CAAC,EAErB,IAAK,MAAME,KAAcikG,EACvBnkG,EAAYE,EAAW1pB,KAAO0pB,EAGhC,IAAK,MAAMA,KAAcqkG,EACvBvkG,EAAYE,EAAW1pB,KAAO0pB,EAGhC,IAAK,MAAMA,KAAcskG,EAAqB,CAC5C,IAAIjiH,EAAOvU,EACPkyB,EAAW9mB,WAAauyC,IAC1B39C,EAAOmvD,GACP56C,EAAQ2d,EAAWt4B,QAEnBoG,EAAOmvD,GACP56C,EAAK,UAAM2d,EAAW9mB,SAAjB,cAA+B8mB,EAAWt4B,QAEjD,MAAM68H,EAAmB,IAAIznE,GAAiB,CAACz6C,QAAOvU,SAChDwI,EAAMiuH,EAAiBjuH,IACxBkS,cAAIsX,EAAaxpB,KACpBwpB,EAAYxpB,GAAOiuH,EAEtB,CACD,MAAO,CAACzkG,EAAavpB,OAAOK,KAAKkpB,GAAjC,GACC,CAACmkG,EAAkBI,EAAoBC,IAEpCE,EAAmBt5G,uBAAY,KACnC0nD,EAAmB,IACnBsxD,EAAoB,GAApB,GACC,IAEGO,EAAav5G,uBAAY,KAC7B+kC,GAAS3zC,GAASA,OAAQ1O,EAAY,OACtC8kE,EAAc,IACdE,EAAmB,GAAnB,GACC,IAGG8xD,EAAgBx5G,uBAAarb,IACjC,MAAMmxB,EAAW2/B,EAAgB9wD,IAASA,EAC1C,OAAK2zH,EAAiBh7G,IAAIwY,GAGtB2a,EAAW3a,GAAU8V,QAChB,CAAC9V,EAAD,mCAEF,CAACA,OAAUpzB,GALT,MAACA,EAAD,wBAA6BiC,EAA7B,sBAKT,GACC,CAAC2zH,EAAkB7nF,EAAYglB,IAG5BgkE,EAAsBz5G,uBAAa7I,IAAW,IAAD,IAEjD,GAAI,UADJA,EAAK,UAAGA,SAAH,aAAG,EAAOpN,cACX,QAAC,EAAO5I,OACV,MAAO,GAET,MAAMyzB,EAAc,GACpB,IAAK,MAAMxpB,KAAO8sH,EAAiB,CAEjBxC,GAAetqH,GAAKwqH,MAAM/kE,KAAK15C,IAE3Cyd,EAAYn0B,KAAK,IAAImxD,GAAiB,CAACz6C,QAAOvU,KAAMwI,IAEzD,CACD,OAAOwpB,CAAP,GACC,CAACsjG,IAIEpyD,EAAe9lD,uBAAa5U,IAChC,IAAI0pB,EAAaF,EAAYxpB,GAC7B,IAAK0pB,EAAY,CAAC,IAAD,EACf,MAAM4kG,EAAiB9kG,EAAYlpB,EAAK,IACxC,IAAkB,OAAdguH,QAAc,IAAdA,GAAA,UAAAA,EAAgBviH,aAAhB,eAAuBpN,WAAvB,OAAkCqB,QAAlC,IAAkCA,OAAlC,EAAkCA,EAAKrB,QAIzC,YADAg7C,EAAS,qBAFTjwB,EAAa4kG,CAKhB,CACD,GAAI5kG,EAAWlyB,OAASmvD,GAEtB,YADAyV,EAAc1yC,EAAW3d,OAK3B,MAAMoW,EAASmoG,GAAe5gG,EAAWlyB,OAClC0nB,OAAQqvG,EAAWn9H,MAAOo9H,EAA3B,gBAAqCjlG,GAAmBpH,EAAOtlB,MAAM6sB,EAAW3d,QAG/EmT,EAAQuvG,GAAaL,EAAcG,GAC1C,IAAIn9H,EAAOs9H,EACX,IAAKD,EACH,IACEr9H,EAAQijE,EAAWn1C,EAAQsvG,EAG5B,CAFC,MAAOG,GACPD,EAAU,yCAAqCxvG,EAArC,8BACX,CAIH,MAAMlZ,EAAQyoH,GAAaC,EAC3B,GAAI1oH,EAEF,YADA2zC,EAAS3zC,GAMP0jB,EAAWlyB,OAASmvD,IACtB8K,GAAct8C,IACL,IAAIA,EAAKoa,SAAU,SAAUD,MAAO,WAK/C29F,EAAa,CAAC/tG,EAAQ/J,IACpB,MAAMswB,EAAWJ,EAAWnmB,GAAQumB,SACpC,OAAc,OAANtjB,QAAM,IAANA,OAAA,EAAAA,EAAQlnB,SAAU0rD,IAAmCj9B,EAAWlyB,OAASmvD,IAA+B7mD,gBAAMqV,KAASswB,EAC3Hr0C,EACA,IAAI6gB,IAAI,IAAIkD,KAAQ/jB,GAFxB,IAOF,MAAMw9H,EAAuB,IAAIpoE,GAAiB98B,GAClDklG,EAAqB7iH,MAAQwd,EAE7BskG,EAAee,GACfV,IACAC,GAAY,GACX,CAACC,EAAeD,EAAYD,EAAkB7oF,EAAY/kC,EAAM+zD,EAAYw5D,EAAgBrkG,EAAayjG,EAAcx7D,IAKpHmJ,EAAkBhmD,uBAAY,CAAC5U,EAAK66D,KACxC,GAAe,aAAXA,EAAuB,CAAC,IAAD,EACzB,MAAMnxC,EAAU,UAAGF,EAAYxpB,UAAf,aAAG,EAAkB+L,MACjC2d,IACFulF,EAAShxF,QAAQ7sB,MAAQs4B,EAE5B,IACA,CAACF,IAGEyxC,GAAoBrmD,uBAAa7I,IAAW,IAAD,EAI/C,GAHA4tC,GAAS3zC,GAASA,OAAQ1O,EAAY,OACtC8kE,EAAcrwD,KACdA,EAAK,UAAGA,SAAH,aAAG,EAAOpN,QAGb,YADAuvH,IAKFN,EAAoBS,EAAoBtiH,IAGxC,MAAM/N,EAAQ+N,EAAM/N,MAAM,IAAK,GAC/B,IAAIuvH,EAAcJ,EAClB,GAAqB,IAAjBnvH,EAAMjI,OAAc,CACtB,MAAMgrC,EAAe/iC,EAAM,GAAGW,OACxBkwH,EAAmBxkE,EAAgBtpB,GACrCosF,EAAsBj7G,IAAI6uB,IAC5BwsF,EAAc,IAAIt7G,IAAI,CAAC8uB,IACvBh1B,EAAQ/N,EAAM,GAAGW,QACRwuH,EAAsBj7G,IAAI28G,KACnCtB,EAAc,IAAIt7G,IAAI,CAAC48G,IACvB9iH,EAAQ/N,EAAM,GAAGW,OAEpB,CACD8uH,EAAmBF,GACnBjxD,EAAmBvwD,EAAnB,GACC,CAACohH,EAAuB9iE,EAAiBgkE,EAAqBH,IAEjE,OAAO,eAACn/G,GAAA,EAAD,CAAKtH,UAAW+iC,mBAAK/iC,EAAWS,EAAOtD,MAAvC,SACL,eAAC85F,GAAA,EAAD,CAAOj3F,UAAWS,EAAO66B,MAAzB,SACE,eAACg2B,GAAD,CACE3nE,MAAOiqE,GAAc,KACrB7yB,SAAUyyB,GACV/B,SAAUwB,EACVzB,SAAUyB,EACVvB,YAAayB,EACbpxC,YAAalpB,EACb65D,qBAAmB,EACnBP,eAAyB,OAAVyB,QAAU,IAAVA,OAAA,EAAAA,EAAY18D,WAAZ,UAAuB6qB,EAAYlpB,EAAK,WAAxC,iBAAuB,EAAsByL,aAA7C,aAAuB,EAA6BpN,QACnEk7D,iBAAkBi1D,GAClB/0D,eAAgB,CACdppD,QAAS,WACT2+B,YAAa,kCACbr0C,MAAO+K,QAAS1O,EAChB0O,QAASA,EACT81D,gBAAiB,CAAE9C,QAAQ,GAC3BjxD,KAAM,UAERiyD,WAAY,CACV+0D,eAAgB,eAAC,KAAD,CAAYtnH,UAAWS,EAAO8zD,WAAYp0D,MAAM,WAChEm0D,aAAc,eAACp3B,GAAA,EAAD,CAASD,MAAM,yBAAf,SACZ,eAACb,GAAD,CACEG,UAAW,CAACt/B,SAAU,SACtBs+B,SAAS,KACTj7B,KAAK,QACLg8B,QAAQ,kBACRhsC,KAAI,oSAMdg1H,OAGM9d,SAAUA,GAEZ31C,eAAgB54D,GAAUA,EAC1Bo5D,cAAgB15D,GAAYA,EAC5Bm4C,QAASA,EACTihB,aAAe32D,IAAD,aAAQ,eAAC2pH,GAAD,CACpB9iG,WAAYF,EAAY3mB,GACxB4pH,SAAU,IAAMqB,EAAiBtkG,EAAY3mB,GAAI7C,KACjDwE,QAASglB,EAAY3mB,GAAIrL,OAASmvD,GAAzB,UAA+CthB,EAAW7b,EAAY3mB,GAAIkJ,cAA1E,aAA+C,EAAmCrC,iBAAcpS,GAH7F,OA1CpB,IAiEImnE,GAAsB/4D,wBAAc,CAAC,GAC9BopH,GAAoBrpH,IAAMq+B,YAAW,CAAC98B,EAAO2hB,KACxD,MAAM,SAAE7hB,KAAag3D,GAAU92D,EAGzB+2D,EAAWt4D,IAAMu4D,SAASC,QAAQn3D,GAClCo3D,EAAYH,EAAShoE,OAGrBooE,EAAgBlyC,GACbxmB,IAAM24D,eAAenyC,IAAUA,EAAMz0B,OAAS6mE,KANpC,GADF,GAmBXC,EAAUE,GAAcN,GAE9B,OAAO,sBAAKv1C,IAAKA,EAAV,SACL,eAAC,GAAoB1hB,SAArB,CAA8B7V,MAAO0sE,EAArC,SACE,eAACrwB,GAAA,EAAD,CAAMixB,gBAAc,EAApB,SACE,eAAC,KAAD,CACEX,SAAUA,EACV17B,QAZC67B,EAAY,EACf,IACAH,EAASrqE,IAAIyqE,GAAc1hE,QAAO,CAACvG,EAAG2oB,IAAM3oB,EAAI2oB,GAAG,IAU3B,EAAI8/C,GAC1Bv8B,MAAM,OACNzZ,IAAK21C,EACLM,iBAAkBC,GAClBC,iBAAiB,KACjBC,SAAW7oD,GAAUioD,EAAaJ,EAAS7nD,IAC3C8oD,cAAe,EACfd,UAAWA,EATb,SAWGe,UAdT,IAyBIJ,GAAmBp5D,IAAMq+B,YAAW,CAAC98B,EAAO2hB,KAChD,MAAMu2C,EAAal2D,qBAAWy1D,IAC9B,OAAO,sBAAK91C,IAAKA,KAAS3hB,KAAWk4D,GAArC,IAGa2tD,UChhBR,MAAMmC,GAAoBvpH,IAAMC,gBAEhC,SAASupH,KACd,OAAOjmH,qBAAWgmH,GACnB,CAmCcE,OAjCWzpH,IAAMoI,MAAK,YAAkD,IAAvB,SAACwX,EAAD,SAAWve,GAAW,EACpF,MAAMkwB,EAAYpJ,KAClBoJ,EAAUJ,cAAcvR,GACxB,MAAO4J,EAAgBkgG,GAAqBlhH,mBAAS+oB,EAAUtI,UAAU1tB,EAASqkB,IAE5E+pG,EAAuBx6G,uBAAY,CAAC6b,EAAaC,KACrDy+F,EAAkBz+F,EAAlB,GACC,CAACy+F,IAEJhhH,qBAAU,IACD6oB,EAAUzG,kBAAkBvvB,EAASqkB,EAAU+pG,GAAsB,GAAM,IACjF,CAACp4F,EAAW3R,EAAU+pG,IAEzB,MAAM1oE,EAAUW,cAQhB,OANAl5C,qBAAU,KACJ8gB,EAAejpB,OAASipB,EAAejpB,iBAAiBkD,IAAgB+lB,EAAeC,mBACzFw3B,EAAQrxD,KAAKg6H,GAAO,eAAgB,IAAI5vH,IAAIL,OAAOC,SAASK,MAAMkQ,UACnE,IAGI,eAACo/G,GAAkB/nH,SAAnB,CAA4B7V,MAAO69B,EAAnC,SACJnoB,GAEJ,IC6BcwoH,OA9Da7pH,IAAMoI,MAAK,SAA6B7G,GAClE,MAAM,QAACxC,EAAD,SAAU+1C,EAAV,YAAoBoiD,EAApB,KAAiCv5F,EAAjC,MAAuCkH,GAAStD,GAC/CmmC,EAAUC,GAAen/B,mBAAS,MAOnCo8B,EAAgBklF,IACpBniF,EAAY,MACZ,MAAMoiF,EAAkBllH,EAClBquB,EAAQruB,EAAMopD,YAAc,UAC5Bx0D,EAAG,UAAM8B,EAAN,uBAA4BuuH,EAA5B,kBAA+C52F,EAA/C,uBAAmE/7B,KAAKE,UAAU0yH,IAC3FpwH,OAAOC,SAASi0B,OAAOp0B,EAAvB,EAOF,OAAO,gBAAC,IAAM4P,SAAP,WACL,eAAChH,GAAA,EAAD,IACM60F,EACJpiD,SAAUA,EACVvyC,QArBgBo+B,IAClBA,EAAMkE,kBACN8C,EAAYhH,EAAMkH,cAAlB,EAoBE3lC,MAAOvE,EAAO,CAACwE,MAAO,SAAW,KAJnC,SAME,eAAC+8B,GAAA,EAAD,CAASD,MAAOlgC,GAAW,WAA3B,SACE,eAAC,KAAD,QAGJ,gBAACo8C,GAAA,EAAD,CACEzT,SAAUA,EACV7lC,KAAMkb,QAAQ2qB,GACdvmC,QAlBgB,KAClBwmC,EAAY,KAAZ,EAcA,UAKE,eAACoO,GAAA,EAAD,CAAUxzC,QAAS,IAAMqiC,EAAa,OAAtC,gCACA,eAACmR,GAAA,EAAD,CAAUxzC,QAAS,IAAMqiC,EAAa,oBAAtC,iCAGL,I,sBCjBD,MAKMolF,GAAwBn/G,cAAWnI,IAAK,CAC5Cu4D,OAAQ,CACNh3B,cAAevhC,EAAMkH,QAAQ,GAC7ByvF,UAAW,EACX5zD,SAAU,KAEZrhB,QAAS,CACPwY,OAAQ,OACRD,MAAO,OACP99B,UAAW,aACXw6F,UAAW,GAEbj3F,OAAQ,CACN0H,YAAapH,EAAMkH,QAAQ,GAC3B8xB,UAAWh5B,EAAMkH,QAAQ,IAE3Bs3D,UAAW,CACT79D,QAAS,OACT09B,cAAe,SACfnE,OAAQ,OACRD,MAAO,YAGJ,SAASstF,GAAT,GAA8D,IAAxC,UAACjoH,EAAD,SAAYX,KAAa6oH,GAAc,EAClE,MAAMznH,EAASunH,KAEf,OAAO,eAAChpD,GAAA,EAAD,CAAMh/D,UAAWA,EAAW,cAAY,gBAAxC,SACL,uBAAKA,UAAWS,EAAOy+D,UAAvB,UACE,eAACipD,GAAA,EAAD,IACMD,EACJloH,UAAWS,EAAOw4D,OAClB35D,QAAS,CAACc,OAAQK,EAAOL,UAE3B,eAAC6+D,GAAA,EAAD,CAAaj/D,UAAWS,EAAO2hB,QAA/B,SACG/iB,QAIR,CAYD,MAAM+oH,GAA+Bv/G,cAAWnI,IAAK,CACnDvD,KAAM,CACJkM,WAAY,YAGT,SAASg/G,GAAT,GAA0C,IAAb,SAAChpH,GAAW,EAC9C,MAAMoB,EAAS2nH,KACf,OAAO,eAACE,GAAA,EAAD,CAAaC,gBAAc,EAA3B,SACL,sBAAKvoH,UAAWS,EAAOtD,KAAvB,SACGkC,KAGN,CASD,MAAMmpH,GAAyB3/G,cAAWnI,IAAK,CAC7CvD,KAAM,CACJsrH,cAAe,OACfxrH,SAAU,cAGP,SAASyrH,GAAT,GAAmD,IAA5B,MAACzrF,EAAD,MAAQgB,EAAR,UAAej+B,GAAY,EACvD,MAAMS,EAAS+nH,KACf,OAAOvrF,EACH,eAACz1B,GAAA,EAAD,CACA0B,QAAQ,SACR+0B,MAAOA,GAAS,SAChBj+B,UAAW+iC,mBAAK/iC,EAAWS,EAAOtD,MAHlC,SAIA8/B,IACA,IACL,CAWM,SAAS0rF,GAAT,GAA8C,IAAxB,UAAC3oH,EAAD,SAAYX,GAAW,EAClD,OAAO,eAAC0/D,GAAA,EAAD,CAAMG,WAAS,EAACt3D,QAvGL,EAuG2B5H,UAAWA,EAAWE,MAAO,CAAC06B,OAAQ,QAA5E,SACJv7B,GAEJ,CAUD,MAAMupH,GAA2B//G,cAAWnI,IAAK,CAC/CvD,KAAM,CACJy9B,OAAO,eAAD,OAAiBl6B,EAAMkH,QAtHb,GAsHV,YAGH,SAASihH,GAAT,GAAsC,IAAb,SAACxpH,GAAW,EAC1C,MAAMoB,EAASmoH,KACf,OAAO,eAAC7pD,GAAA,EAAD,CAAMG,WAAS,EAACt3D,QA3HL,EA2H2B5H,UAAWS,EAAOtD,KAAxD,SACJkC,GAEJ,CAUD,MAAMypH,GAAwBjgH,cAAWnI,IAAK,CAC5Cu8B,MAAO,CACLjD,aAAct5B,EAAMkH,QAAQ,IAE9Bi2B,OAAQ,CACNlD,MAAO,OACPC,OAAQ,OACRv5B,QAAS,OACT09B,cAAe,UAEjB3c,QAAS,CACPijB,KAAM,EACNgyD,UAAW,OAGR,SAAS0xB,GAAT,GASH,IATyB,MAC3B9rF,EAD2B,MAE3BgB,EAF2B,UAG3Bj+B,EAH2B,QAI3BV,EAJ2B,SAK3BD,EAL2B,OAM3Bu7B,EAN2B,UAO3By8D,KACGhhC,GACF,EACD,MAAM51D,EAASqoH,GAAsB,CAACxpH,QAASA,IAC/C,OAAO,eAACy/D,GAAA,EAAD,CACLl9C,MAAI,KACAw0C,EACJr2D,UAAWA,EACXE,QACI7H,gBAAMuiC,KAAYviC,gBAAMg/F,KAAe,CAACz8D,OAAQA,EAAQy8D,UAAWA,GALlE,SAQL,uBAAKr3F,UAAWS,EAAOo9B,OAAvB,UACE,eAAC6qF,GAAD,CAAezrF,MAAOA,EAAOj9B,UAAWS,EAAOw8B,QAC/C,sBAAKj9B,UAAWS,EAAO2hB,QAAvB,SACG/iB,QAIR,CAYD0pH,GAAaniF,aAAe,CAC1BhM,OAAQ,SAMV,MAAMouF,GAAiCngH,cAAWnI,IAAK,CACrDm9B,OAAQ,CACNlD,MAAO,OACPC,OAAQ,OACRv5B,QAAS,OACT09B,cAAe,UAEjB3c,QAAS,CACPijB,KAAM,EACNgyD,UAAW,OAGR,SAAS4xB,GAAT,GAA2E,IAA3C,UAACjpH,EAAD,QAAYV,EAAZ,SAAqBD,KAAag3D,GAAQ,EAC/E,MAAM51D,EAASuoH,GAA+B,CAAC1pH,QAASA,IACxD,OAAO,eAACy/D,GAAA,EAAD,CAAMl9C,MAAI,KAAKw0C,EAAOr2D,UAAWA,EAAjC,SACL,sBAAKA,UAAWS,EAAOo9B,OAAvB,SACE,sBAAK79B,UAAWS,EAAO2hB,QAAvB,SACG/iB,OAIR,CAQD,MAAMijG,GAAY1hG,cAAYF,IAAD,CAC3BuX,SAAU,CACR1Q,OAAQ7G,EAAMkH,QAAQ,OAFRhH,CAIdsoH,MAEE3mB,GAAmB3hG,cAAYF,IAAD,CAClCvD,KAAM,CACJwK,QAAQ,KAAD,OAAOjH,EAAMkH,QAAQ,GAArB,MACPyvF,UAAW32F,EAAMkH,QAAQ,GACzB,aAAc,CACZyvF,UAAW32F,EAAMkH,QAAQ,KAG7Bwa,QAAS,CACP7a,OAAQ,EACR,aAAc,CACZA,OAAQ,IAGZ0Q,SAAU,CAAC,KAdYrX,CAerBuoH,MAEE1mB,GAAmB7hG,cAAYF,IAAD,CAClCvD,KAAM,CACJoK,OAAQ,EACRI,QAAQ,KAAD,OAAOjH,EAAMkH,QAAQ,GAArB,UAHchH,CAKrBwoH,MAKSC,GAAyBrrH,IAAMoI,MAAK,IAAmC,IAAlC,MAAC62B,EAAD,KAAQ/6B,EAAR,KAAcU,EAAd,QAAoB86B,GAAa,EAEjF,MAAM4kB,EAAO17C,mBAAQ,KACnB,IAAK1E,EAAM,OAEX,MAAMmC,EAAa,GACnB,IAAK,MAAO9L,EAAK5O,KtF7Od,SAAsBo0D,GAA2B,IAAnB+K,EAAkB,wDACrD,MAAMrV,EAAQ,GACR3a,EAAW,CAAC5jC,EAAK0N,KACrB,IAAK,MAAOrK,EAAK5O,KAAU6O,OAAOC,QAAQvD,GAAM,CAC9C,MAAMo0H,EAAU,IAAI1mH,GACpB0mH,EAAQ17H,KAAK2K,GACT5O,GAAS+O,wBAAc/O,GACzBmvC,EAASnvC,EAAO2/H,GAEhB71E,EAAM7lD,KAAK,CAACk7D,EAAW,IAAIwgE,GAAW/wH,EAAK5O,GAE9C,GAGH,OADAmvC,EAASilB,EAAQ,IACVtK,CACR,CsF8N8B81E,CAAarnH,GAAM,GAC5CmC,EAAWzW,KAAK,CACdmY,SAAS,GAAD,OAAc,KAATnD,EAAc,GAAd,UAAsBA,EAAtB,MAAL,OAAqCrK,EAAIwD,KAAK,MACtDpS,MAAOA,IAIX,OAAO6/H,gBAAMnlH,EAAYq5B,EAAzB,GACC,CAACx7B,EAAMU,EAAM86B,IAEhB,OAAKx7B,EAIE,gBAAC,GAAD,CAAWunH,iBAAe,EAACxvD,UAAW,EAAtC,UACL,eAAC,GAAD,CAAkBz9B,gBAAiB,CAACl8B,KAAM,SAAUkiG,WAAY,eAAC,KAAD,IAAhE,SACE,eAACkmB,GAAD,CAAezrF,MAAOA,MAExB,eAAC,GAAD,UACE,eAACksC,GAAD,UACG7mB,EAAKr2D,KAAKmD,GACT,eAACi6E,GAAD,UACGj6E,EAAInD,KAAK4xC,GAAW,eAAC0rC,GAAD,IAEf1rC,GADCA,EAAO93B,aAFE3W,EAAI,GAAG2W,mBAVxB,IAGT,ICrSK,SAAS2jH,GAAT,GAA0B,IAAT,KAACxnH,GAAO,EAU9B,OAAO,eAAC,GAAD,CACL6D,SAVe7D,IAAU,IAAD,EACxB,MAAMyW,EAAQ,OAAGzW,QAAH,IAAGA,GAAH,UAAGA,EAAMiD,eAAT,aAAG,EAAewT,SAChC,OAAKA,EAIEA,EAASC,uBAAyBD,EAASgxG,0BAA4BhxG,EAASixG,6BAH9E,IAGT,EAImBp2H,MAAM,UAAUmpD,QAAM,EAACz6C,KAAMA,EAChDD,YAAY,oFAEf,CDiTDonH,GAAuBziF,aAAe,CACpClJ,QAAS,GCtJImsF,OAnJM7rH,IAAMoI,MAAK,IAAmC,IAAD,kCAAjC,MAACqI,EAAD,WAAQq7G,EAAR,QAAoBtrG,GAAa,EAEhE,MAAMurG,EAAU,OAAGt7G,QAAH,IAAGA,GAAH,UAAGA,EAAOtJ,eAAV,iBAAG,EAAgB2kH,kBAAnB,aAAG,EAA4BC,WACzCC,GAA0B,OAAVD,QAAU,IAAVA,OAAA,EAAAA,EAAYE,sBAAZ,OACpBF,QADoB,IACpBA,OADoB,EACpBA,EAAYG,0BADQ,OAEpBH,QAFoB,IAEpBA,OAFoB,EAEpBA,EAAYI,qBACRC,GAAiC,OAAVL,QAAU,IAAVA,GAAA,UAAAA,EAAYE,0BAAZ,eAAgCI,sBAAhC,OAC3BN,QAD2B,IAC3BA,GAD2B,UAC3BA,EAAYG,8BADe,aAC3B,EAAoCG,sBADT,OAE3BN,QAF2B,IAE3BA,GAF2B,UAE3BA,EAAYI,2BAFe,aAE3B,EAAiCE,oBAC7BC,EAAW,OAAG77G,QAAH,IAAGA,GAAH,UAAGA,EAAOtJ,eAAV,iBAAG,EAAgBwT,gBAAnB,aAAG,EAA0B5tB,SAGxCw/H,EAAiB,CAAC,EASxB,IAAIC,EARAT,GACFvxH,OAAOK,KAAKkxH,GAAY9vH,SAAS1B,IAC/B,MAAMzG,EAAOqkB,qBAAW5d,EAAIhC,MAAM,KAAK8Z,OACvCk6G,EAAehyH,GAAOzG,CAAtB,IAMAi4H,IAAetmG,kBAAQsmG,KACrB,uBAAwBA,EAC1BS,EAAmB,qBACV,2BAA4BT,EACrCS,EAAmB,yBACT/mG,kBAAQsmG,KAClBS,EAAmBhyH,OAAOK,KAAKkxH,GAAY,KAG/C,MAAOU,EAAeC,GAAoBlkH,mBAASgkH,GAE7CG,EAAwBx9G,uBAAawxB,IACzC+rF,EAAiB/rF,EAAMlnB,OAAO9tB,MAA9B,GACC,IAEH,GAAI,OAAC8kB,QAAD,IAACA,GAAD,UAACA,EAAOtJ,eAAR,QAAC,EAAgBwT,SACnB,OAAO,KAIT,MAAMiyG,EAAS,UAAMjzH,OAAOC,SAASuQ,SAAS5X,MAAMkJ,EAAQnL,QAA7C,uCACTs6E,EAAU,UAAGn6D,EAAMtJ,eAAT,iBAAG,EAAewT,gBAAlB,aAAG,EAAyB+vD,YACtCmiD,EAAa,wCAAoCJ,GACjDK,EAAgB,OAAGtsG,QAAH,IAAGA,GAAH,UAAGA,EAASrZ,eAAZ,iBAAG,EAAkB2kH,kBAArB,iBAAG,EAA8BC,kBAAjC,aAAG,EAA2CU,GAC9D/xB,EAAM,UAAMkyB,EAAN,YAAmBH,GACzB9uC,EAAYmvC,GpC+eb,SAA4BnvC,GACjC,GAAKA,EAIL,IAGE,MAAMovC,EAAa,IAAIC,IAAIrvC,EAAUE,QAAQ5vF,KAAIgJ,GAAK,CAACA,EAAEnD,KAAMmD,EAAEg2H,iBAAiB,OAWlF,MATsB,CACpBpvC,QAASF,EAAUuvC,iBAAiBj/H,KAAIuB,GAAKu9H,EAAWhoH,IAAIvV,KAC5DP,KAAM0uF,EAAU05B,gBACZ,IAAIxgG,GAAS8mE,EAAU05B,gBAAiB,SAASthG,GAAG,YAAYpqB,aAChEkG,EACJ7B,UAAW,IAAI6mB,GAAS8mE,EAAUwvC,yBAA0B,SAASp3G,GAAG,YAAYpqB,QACpFg/F,YAAY,EACZt1F,IAAKsoF,EAAUyvC,gBAAkBzvC,EAAUyvC,gBAAgBn/H,KAAKuB,KAAQA,SAAKqC,EAKhF,CAFC,MAAO0O,GACP,MAAO,CAAC,CACT,CACF,CoCtgBuC8sH,CAAmBP,GAGnD70B,EAAS+zB,GAAiB,eAACpyE,GAAA,EAAD,UAC9B,eAACjE,GAAA,EAAD,CACEhqD,MAAO8gI,EACP1pF,SAAU4pF,EACVn3H,MAAM,YAHR,SAKGgF,OAAOC,QAAQ8xH,GAAgBt+H,KAAI,QAAE8D,EAAM+B,GAAR,SAClC,eAACiiD,GAAA,EAAD,CAAqBpqD,MAAOoG,EAA5B,SAAmC+B,GAApB/B,EADmB,QAKxC,OAAO,gBAACk4H,GAAD,CAAchrF,MAAM,WAAW78B,OAAQ61F,EAAvC,UACL,gBAAC0yB,GAAD,WACE,eAACI,GAAD,CAAc9rF,MAAM,cAAc6hC,GAAI,EAAGlkC,OAAO,OAAhD,SACE,gBAACuuC,GAAD,CAAejnE,KAAMuM,EAArB,UACE,eAAC46D,GAAD,UACE,eAACE,GAAD,CAAcrmC,QAAS,EAAvB,SACE,eAACwmF,GAAD,CAASxnH,KAAMuM,QAGnB,eAAC46D,GAAD,UACE,eAACE,GAAD,CAAcxjE,SAAS,uCAEzB,eAACsjE,GAAD,UACE,eAACE,GAAD,CAAcxjE,SAAS,4BAA4Bm9B,QAAS,MAE9D,eAACmmC,GAAD,UACE,eAACE,GAAD,CAAcxjE,SAAS,uCAI7B,eAACgjH,GAAD,CAAc9rF,MAAM,YAAY6hC,GAAI,EAAGlkC,OAAO,QAA9C,SACGovF,EACG,eAAC,GAAD,CACA9nH,KAAMy5E,EACN4e,eAAc,UAAE9rF,EAAMtJ,eAAR,iBAAE,EAAewT,gBAAjB,aAAE,EAAyB2yG,gBACzC9wB,SAAUiwB,EAAcl0H,MAAM,KAAK8Z,MACnCqoF,OAAQA,EACR,cAAY,oBAEZ,eAAC5xB,GAAD,MAEN,eAACiiD,GAAD,CAAc9rF,MAAM,WAAW6hC,GAAI,EAAGlkC,OAAO,OAAOy8D,UAAU,QAA9D,SACGizB,EACG,gBAACnhD,GAAD,CAAejnE,KAAMuM,EAArB,UACA,gBAAC46D,GAAD,WACE,eAACE,GAAD,CAAcxjE,SAAS,6CACvB,eAACwjE,GAAD,CAAcxjE,SAAS,iDAEzB,gBAACsjE,GAAD,WACE,eAACE,GAAD,CAAcxjE,SAAS,iDACvB,eAACwjE,GAAD,CAAcxjE,SAAS,oDAEzB,gBAACsjE,GAAD,WACE,eAACE,GAAD,CAAcxjE,SAAS,0CACvB,eAACwjE,GAAD,CAAcxjE,SAAS,mDAGzB,eAAC+gE,GAAD,MAGN,eAACiiD,GAAD,CAAc9rF,MAAM,qBAAqB6hC,GAAI,EAAGlkC,OAAO,OAAOy8D,UAAU,QAAxE,SACG+yB,EACG,gBAACjhD,GAAD,CAAejnE,KAAMuM,EAArB,UACA,gBAAC46D,GAAD,WACE,eAACE,GAAD,CAAcxjE,SAAQ,UAAK8kH,EAAL,2BACtB,eAACthD,GAAD,CAAcxjE,SAAQ,UAAK8kH,EAAL,2BACtB,eAACthD,GAAD,CAAcxjE,SAAQ,UAAK8kH,EAAL,8BAExB,gBAACxhD,GAAD,WACE,eAACE,GAAD,CAAcxjE,SAAQ,UAAK8kH,EAAL,6BAA+Cr3H,MAAM,WAC3E,eAAC+1E,GAAD,CAAcxjE,SAAQ,UAAK8kH,EAAL,4BAA8Cr3H,MAAM,WAC1E,eAAC+1E,GAAD,CAAcxjE,SAAQ,UAAK8kH,EAAL,6BAA+Cr3H,MAAM,cAE7E,eAAC61E,GAAD,UACE,eAACE,GAAD,CAAcrmC,QAAS,EAAGn9B,SAAQ,UAAK8kH,EAAL,uBAGpC,eAAC/jD,GAAD,SAGPtsE,GAAoBouE,GACnB,eAACy/C,GAAD,UACE,eAACkD,GAAD,CAAgB3iD,WAAYA,EAA5B,sCAxEN,IC1FK,MAAM4iD,GAAiBxtH,IAAMoI,MAAK,IAAa,IAAD,QAAX,KAAClE,GAAU,EACnD,MAAMupH,EAAmB,GACnB1hD,EAAsB,SAAC70E,EAAK80E,GAA4B,IAAjB0hD,EAAgB,uDAAP,GACpD,MAAMrsH,EAAW,CAAC,EAClB7G,OAAOK,KAAK3D,GAAK+E,SAAQ1B,IACvB,GAAImzH,EAAOr8H,SAASkJ,GAClB,OAEF,MAAM5O,EAAQuL,EAAIqD,GACd1D,MAAMoR,QAAQtc,IAA2B,kBAAVA,EAC7BA,EAAM2E,OAAS,GACjBm9H,EAAiB79H,KAAK,CAACmY,SAAS,GAAD,OAAKikE,EAAL,YAAkBzxE,KAE1C5O,aAAiB6O,SAC1B6G,EAAS9G,GAAO5O,EACjB,IAEH6O,OAAOK,KAAKwG,GAAUpF,SAAQ1B,GAAOwxE,EAAoB1qE,EAAS9G,GAAV,UAAmByxE,EAAnB,YAAgCzxE,KACzF,EAWD,OAVA,OAAI2J,QAAJ,IAAIA,GAAJ,UAAIA,EAAMiD,eAAV,OAAI,EAAeP,QACjBmlE,EAAoB7nE,EAAKiD,QAAQP,OAAQ,kBAE3C,OAAI1C,QAAJ,IAAIA,GAAJ,UAAIA,EAAMiD,eAAV,OAAI,EAAeggB,KACjB4kD,EAAoB7nE,EAAKiD,QAAQggB,IAAK,cAAe,CAAC,QAAS,WAAY,iBAG7EsmG,EAAiB79H,KAAK,CAACmY,SAAU,eACjC0lH,EAAiB79H,KAAK,CAACmY,SAAU,eAE1B,eAAC,GAAD,CAAUs/B,MAAI,EAAd,SACJomF,EAAiBx/H,KAAI,WAAK0/H,GAAL,SACpB,eAAC,GAAD,IAEMA,EACJhvE,QAAM,EACNz6C,KAAMA,EACNulE,mBAAiB,GAJZkkD,EAAc5lH,SAFD,KADxB,IAgBW6lH,GAAiB5tH,IAAMoI,MAAK,IAAa,IAAZ,KAAClE,GAAU,EACnD,OAAO,uCACL,eAAC,GAAD,CAAUmjC,MAAI,EAAd,SACE,eAACqkF,GAAD,CAASxnH,KAAMA,MAEjB,eAACspH,GAAD,CAAgBtpH,KAAMA,MAJxB,IA2CW2pH,GAAmB7tH,IAAMoI,MAAK,IAAuB,IAAtB,KAAClE,KAAS3C,GAAW,EAE/D,OAAI2C,EAAKgnB,gBACA,KAOF,eAACgU,GAAA,EAAD,CACL4uF,gBAAiB,CAACC,MAAM,GACxB9uF,MAAM,uBAFD,SAIL,eAACqrE,GAAD,IACM/oG,EACJiF,QAAStC,EAAKkvB,YANlB,IAcW46F,GAAkBhuH,IAAMoI,MAAM7G,GAClC,eAAC+H,GAAA,EAAD,CAAKjG,QAAS,OAAQ4qH,UAAW,OAAQjtF,eAAgB,WAAzD,SACL,eAAC6sF,GAAD,IAAsBtsH,EAAOwhB,UAAW1gB,KAAxC,SAAoD,eAAC,KAAD,UAIlD6rH,GAAwBrjH,cAAWnI,IAAK,CAC5CyrH,aAAc,CACZnqF,WAAYthC,EAAMkH,QAAQ,GAC1B0yB,YAAa55B,EAAMkH,QAAQ,GAC3BszB,aAAcx6B,EAAMkH,QAAQ,IAE9BwkH,qBAAsB,CACpB/qH,QAAS,OACTs5B,MAAO,OACPpzB,OAAQ,KAEV8kH,gBAAiB,CACfnxF,aAAcx6B,EAAMkH,QAAQ,IAE9B0kH,oBAAqB,CACnBjrH,QAAS,OACT4qH,UAAW,OACXxoF,SAAU,EACVwiC,WAAY,EACZjnC,eAAgB,WAChBhF,aAAct5B,EAAMkH,QAAQ,GAC5B8xB,UAAWh5B,EAAMkH,QAAQ,QA8Cd2kH,OA1CavuH,IAAMoI,MAAK,IAAa,IAAZ,KAAClE,GAAU,EACjD,MAAM5C,EAAU4sH,KAEhB,OACE,uBAAKlsH,UAAWV,EAAQ6sH,aAAxB,UACE,uBAAKnsH,UAAWV,EAAQ8sH,qBAAxB,UACE,sBAAKpsH,UAAWV,EAAQ+sH,gBAAxB,SACE,eAACT,GAAD,CAAgB1pH,KAAMA,MAGxB,sBAAKlC,UAAWV,EAAQ+sH,gBAAiBnsH,MAAO,CAACujC,SAAU,EAAG+O,SAAU,eAAxE,SACE,gBAAC,GAAD,CAAUxyC,UAAWV,EAAQ+sH,gBAAiBxuF,QAAM,EAApD,UACE,eAAC,GAAD,CAAU93B,SAAS,UAAU7D,KAAMA,IACnC,eAAC,GAAD,CAAU6D,SAAS,aAAa7D,KAAMA,IACtC,eAAC,GAAD,CAAU6D,SAAS,UAAU7D,KAAMA,IACnC,eAAC,GAAD,CAAU6D,SAAS,WAAW7D,KAAMA,SAIxC,sBAAKlC,UAAWV,EAAQ+sH,gBAAiBnsH,MAAO,CAACq7B,SAAU,MAAOL,aAAc,GAAhF,SACE,gBAAC,GAAD,CAAU2C,QAAM,EAAhB,UACE,eAAC,GAAD,CAAU93B,SAAS,WAAW7D,KAAMA,IACpC,eAAC,GAAD,CAAU6D,SAAS,WAAW7D,KAAMA,IACpC,eAAC,GAAD,CAAU6D,SAAS,YAAY7D,KAAMA,IACrC,eAAC,GAAD,CAAU6D,SAAS,SAAS7D,KAAMA,IAClC,eAAC,GAAD,CAAU6D,SAAS,cAAc7D,KAAMA,YAK7C,sBAAKlC,UAAWV,EAAQgtH,oBAAxB,SACE,eAACT,GAAD,CAAkB1rH,MAAM,UAAU+B,KAAMA,EAAxC,sCA5BN,ICtJK,MAAMsqH,GAAqBxuH,IAAMoI,MAAK,IAAsB,IAArB,KAAClE,KAASid,GAAU,EAChE,OAAO,eAACosG,GAAD,CAAgB3iD,WAAY1mE,EAAKwmE,eAAiBvpD,EAAM4B,UAAW1gB,KAAnE,SACL,eAAC,KAAD,KADF,ICiBWosH,GAAYzuH,IAAMoI,MAAK,IAAqB,IAApB,OAAChG,EAAD,KAAS8B,GAAU,EACtD,MAAM,KAACU,GAAQghB,GAAcxjB,EAAOwC,MACpC,IAAI3K,EAAO6rB,KAAS9sB,OAAOkL,EAAMU,GAEjC,OADA3K,EAAOgO,kBAAQhO,GAAQA,EAAK,GAAKA,EAC1B,eAACilC,GAAA,EAAD,CAASD,MAAO78B,EAAO6B,aAAe,GAAtC,SACL,eAAC5B,GAAA,EAAD,CAAYpI,KAAMA,EAAMwf,OAAO,SAA/B,SAAwC,eAAC,KAAD,OAD1C,IAYWi1G,GAAgB1uH,IAAMoI,MAAK,IAajC,IAAD,cAbmC,QACvCs3B,EADuC,SAEvC0iB,EAFuC,KAGvCkC,EAHuC,WAIvC6C,EAJuC,YAKvCJ,EALuC,SAMvC4nE,EANuC,kBAOvCzsF,EAPuC,0BAQvC0sF,EARuC,MASvC3vF,EACA,cAAemW,EAVwB,WAWvCy5E,KACGroB,GACC,EACJ,MAAM,KAACtiG,EAAD,WAAOylB,EAAP,cAAmBqiC,GAAiB7E,IACpCwG,EAAW5G,KACVl3C,EAAUN,GAAe/G,mBAAS,IAAIgE,KAE7C9D,qBAAU,KACJw5B,GACFA,EAAkBryB,EACnB,GACA,CAACqyB,EAAmBryB,IAEvB,MAAMhL,EAAQ+D,mBAAQ,IACH,QAAbiH,EACK89C,EAEF,CAACv6B,SAAU,IAAIvjB,KACrB,CAACA,EAAU89C,IAER5rB,EAAU5yB,uBAAajL,IAC3B,MAAM4qH,EAAmB,GACzB,IAAK,MAAOv0H,EAAK5O,KAAU6O,OAAOC,Q1Fq/C/B,SAAuBL,GAC5B,MAAMO,EAAU,CAAC,EACjB,IAAK,MAAMM,KAAUsqB,GAAWnrB,GAC9BO,EAAQM,GAAUb,EAAOO,QAAQM,GAEnC,OAAON,CACR,C0F3/C6C05D,CAAc/P,EAAKviB,UAAW,CACtE,MAAMhf,EAAY,CAChB,IAAO,eAAC0rG,GAAD,CAAqBrsH,OAAQzW,EAAOuY,KAAMA,GAA1B3J,IACvB5O,EAAMoG,MACJgxB,GACF+rG,EAAiBl/H,KAAKmzB,EAEzB,CAMD,MALiB,YAAbq/B,EACF0sE,EAAiBl/H,KAAK,eAACo+H,GAAD,CAA8C9pH,KAAMA,GAA/B,2BACrB,cAAbk+C,GACT0sE,EAAiBl/H,KAAK,eAAC4+H,GAAD,CAAmDtqH,KAAMA,GAAjC,6BAEzC4qH,CAAP,GACC,CAACxqE,EAAMlC,IAEV,GAAI38B,kBAAQia,GACV,OAAO,eAAC0hC,GAAA,EAAD,CAAOC,SAAS,UAAhB,8GAKT,GAAyB,IAArB13C,EAAW2V,MACb,OAAO,eAAC91B,GAAA,EAAD,yBAGT,IAAKmgB,EAAW2V,MACd,OAAO,eAAC91B,GAAA,EAAD,4BAIT,IAAIg7B,EACAuqF,EACyB,IAAD,EAAX,YAAb3sE,IACF5d,GAAc,OAAJ8f,QAAI,IAAJA,GAAA,UAAAA,EAAM9f,eAAN,eAAepjC,SAAUmtH,GAC9BI,IAAUI,EAAU,eAAC,GAAD,CAAqBhwH,QAAQ,iBAAiB8F,MAAOA,MAGhF,OAAO,eAACo0F,GAAA,EAAD,CAAO,cAAa7jD,KAAYy5E,EAAhC,SACL,gBAAC,GAAD,CACE3qH,KAAMA,EACNylB,WAAYA,EACZ2W,oBAAqB0rB,EACrBtsB,SAAgB,OAAPA,QAAO,IAAPA,OAAA,EAAAA,EAAS/kC,UAAWH,OAAOsB,OAAO4jC,EAAQ/kC,SACnDwnC,aAAY,OAAEzC,QAAF,IAAEA,OAAF,EAAEA,EAAS7vB,SACvBA,SAAc,OAAJy0C,QAAI,IAAJA,GAAA,UAAAA,EAAMrd,iBAAN,SAAiBylC,QAAU78D,OAAWhe,EAChD6yC,MAAOzpC,GAAUA,EAAOm4B,SACxB8O,kBAAuB,OAAJoiB,QAAI,IAAJA,GAAA,UAAAA,EAAMrd,iBAAN,SAAiBylC,QAAUn9D,OAAc1d,KACxD20G,EATN,UAWE,eAAC,GAAD,CAAkBvnE,MAAK,UAAK1iB,GAAcrY,EAAK5T,QAAxB,YAAmCiuB,GAAU0gB,GAAS,SAAUtV,EAAW2V,OAAO,GAAM,EAAML,OAAQptC,EAAY,WAAzI,UACO,OAAJyyD,QAAI,IAAJA,GAAA,UAAAA,EAAMrd,iBAAN,eAAiBylC,UAChB,eAAC,GAAD,CAAyBzlC,WAAS,EAAlC,SACG8nF,MAIP,eAAC,GAAD,CACEhtF,QAAa,OAAJuiB,QAAI,IAAJA,GAAA,UAAAA,EAAMviB,eAAN,SAAe2qC,QAAU3qC,OAAUlwC,EAC5C2yC,QAAa,OAAJ8f,QAAI,IAAJA,GAAA,UAAAA,EAAM9f,eAAN,SAAekoC,QAAUloC,OAAU3yC,EAC5C+zC,sBAAuBgpF,GAA6B1qH,EAAKwpB,MAAKt8B,GAAOA,EAAIgiC,WAAaw7F,IAHxF,SAKE,eAAC,GAAD,CAA6BzsH,MAAM,UAAnC,6BAxBN,IA4CFusH,GAAc9lF,aAAe,CAC3B,cAAe,kBAMV,MAAMomF,GAA2BhvH,IAAMoI,MAAM7G,IAClD,MAAM,QAACm+B,EAAD,SAAU0iB,EAAV,KAAoBkC,EAApB,WAA0B6C,EAA1B,YAAsCJ,GAAexQ,KAE3D,OAAO,eAACm4E,GAAD,CACLhvF,QAASA,EACT0iB,SAAUA,EACVkC,KAAMA,EACN6C,WAAYA,EACZJ,YAAaA,KACTxlD,GANN,I,wBC5IF,MAAM0tH,GAAsBjvH,IAAMC,gBAC5BiD,GAAUmL,oBAAS,OAAC3S,QAAD,IAACA,GAAD,WAACA,EAAIG,YAAL,mBAAC,GAAUlB,eAAX,cAAC,GAAmBF,SAC7CyI,GAAQgsH,gBAAgBn0H,aAAUlJ,EAElC,MAAMs9H,GAAa,IAAI3iH,IAAIu/B,IAAwBvxC,OAAOK,KAAP,OAAYqI,SAAZ,IAAYA,IAAZ,WAAYA,GAASksH,oBAArB,cAAY,GAAuBz0H,SACnF1M,KAAI6M,IACH,MAAM8uC,EAAK,OAAGmC,SAAH,IAAGA,QAAH,EAAGA,GAAsBjxC,GACpC,OAAO8uC,EAAQ/yC,MAAMm6D,KAAKpnB,GAAS,EAAnC,IACCylF,QAECzkH,GAAYC,cAAWnI,IAAK,CAChC09G,OAAQ,CACNzjF,MAAO,OACP6X,SAAU,KACV6kD,UAAW,KAEbnB,cAAe,CAAC,EAEhBo3B,aAAc,CACZxsD,UAAW,SACX61B,UAAW,KAEb42B,UAAW,CACTlsH,QAAS,OACToiC,SAAU,EACVsU,OAAQ,EACRn7C,gBAAiB,uBAEnBgxC,QAAS,CACPlU,UAAW,QAWRjQ,eAAe+jG,GAAgBjrH,EAAKgtB,EAAWiJ,EAAWpH,GAAW,IAAD,MACzE,IAAIrvB,EACJ,IACEA,QAAiBQ,EAAIgC,KAAJ,wBAAkC,CACjD2sB,MAAO,UACPruB,MAAO,CACLuuB,SAAUA,EACVD,WAAW,IAKhB,CAFC,MAAOrvB,GACP,MAAO,EACR,CACD,MAAM2rH,EAAW,UAAG1rH,SAAH,iBAAG,EAAUG,YAAb,iBAAG,EAAiB,UAApB,aAAG,EAAqBsc,QACzC,IAAKivG,EAAa,OAClB,MAAMz2F,EAAWx+B,OAAOK,KAAK40H,GAAa30H,QAAQP,GAAQ,UAAWk1H,EAAYl1H,KAC3Em1H,EAAwB,GAC9B,GAAI12F,EAAS1oC,OAAS,EACpB,IAAK,MAAMyqC,KAAW/B,EAAU,CAC9B,MAEM22F,EAAqB1tG,GAFbwtG,EAAY10F,GAASxX,MACvBksG,EAAYxnG,SAASwF,UAArB,UAAoClyB,EAApC,oBAAuDk0H,EAAYxnG,SAASwF,UAA5E,oBAAiG2F,QAAavhC,GAEpHm/B,QAAmBO,EAAUX,oBAAoB++F,GACvD70F,GAAS20F,EAAY10F,GAAU/J,EAAY+J,GAAS,CAACA,EAAS/J,EAAYpsB,KAAU,IAAD,EACjF,MAAMse,EAAMsX,GAAa,IAAIA,GAAW,GACxC,GAAItX,IACD8N,EAAWE,iBAAmBhO,GAA9B,UAAqC8N,EAAW0F,wBAAhD,OAAqC,EAA6BzoC,KAAI8sC,GAAWA,EAAQ7J,iBAAgB7/B,SAAS6xB,IAAO,CAAC,IAAD,YAC1H,MAAM0sG,EAAeC,GAAgB7+F,GAC/Bl9B,EAAO87H,GAAgB70F,EAAQ60F,GACrCF,EAAsB9/H,KAAK,CAACkE,KAAMA,EAAM25B,UAAS,UAAE1pB,SAAF,iBAAE,EAAUG,YAAZ,iBAAE,EAAiB,UAAnB,aAAE,EAAqBupB,UAAW2F,SAAQ,UAAErvB,SAAF,iBAAE,EAAUG,YAAZ,iBAAE,EAAiB,UAAnB,aAAE,EAAqBkvB,SAAUxuB,KAAMA,GACnI,IAEJ,CAGH,OADmB8qH,GAAyB,IAC1BzhI,KAAIusC,IAAc,IAAD,QACjC,MAAMswB,EAAoB,OAATtwB,QAAS,IAATA,KAAW51B,MAA2B,UAAnB41B,EAAU51B,MAAuC,SAAnB41B,EAAU51B,KAA3D,iBAAgF6qH,QAAhF,IAAgFA,GAAhF,UAAgFA,EAAaxnG,gBAA7F,aAAgF,EAAuBpI,SAAvG,YAAmH2a,EAAU51B,MAA7H,OAAsI6qH,QAAtI,IAAsIA,GAAtI,UAAsIA,EAAaxnG,gBAAnJ,aAAsI,EAAuBpI,SAC9K,MAAO,CACLrqB,MAAOglC,EAAU1mC,KAAV,UAAoB0mC,EAAU1mC,KAA9B,sBAAyC0mC,QAAzC,IAAyCA,OAAzC,EAAyCA,EAAW51B,KAApD,wBAAmE41B,QAAnE,IAAmEA,OAAnE,EAAmEA,EAAW51B,MACrFkmD,SAAUA,EACVjrC,SAAQ,OAAE4vG,QAAF,IAAEA,GAAF,UAAEA,EAAaxnG,gBAAf,aAAE,EAAuBpI,SACjCrF,WAAU,OAAEi1G,QAAF,IAAEA,GAAF,UAAEA,EAAaxnG,gBAAf,aAAE,EAAuBzN,WACnC4Y,SAAUoH,EAAUpH,SACpB3F,UAAW+M,EAAU/M,UACrBqiG,WAAYt1F,EAAU1mC,MAAQg3D,EAC9Bn/D,MAAO6uC,EAAU51B,KACjBV,KAAMs2B,EATR,GAYH,CAEM/O,eAAeskG,GAAcn9F,EAAgBQ,GAAW,IAAD,IAC5D,MACM48F,EAAa,iBADUp9F,EAAeI,yBAAwB,EAAM,CAACI,SAAUA,KAChD,UAAlB,aAAG,EAAmBe,MAEzC,OADiB,OAAG67F,QAAH,IAAGA,GAAH,UAAGA,EAAehoG,mBAAlB,aAAG,EAA4BqN,qBAC7BpnC,KAAI+iC,IAAe,IAAD,MACnC,MAAM85B,EAAQ,iBAAMklE,QAAN,IAAMA,GAAN,UAAMA,EAAe/nG,gBAArB,aAAM,EAAyBpI,SAA/B,YAA2CmR,EAAWl9B,MACpE,MAAO,CACL0B,MAAOw7B,EAAWl9B,KAClBg3D,SAAUA,EACVjrC,SAAQ,OAAEmwG,QAAF,IAAEA,GAAF,UAAEA,EAAe/nG,gBAAjB,aAAE,EAAyBpI,SACnCrF,WAAU,OAAEw1G,QAAF,IAAEA,GAAF,UAAEA,EAAe/nG,gBAAjB,aAAE,EAAyBzN,WACrC4Y,SAAU48F,EAAc/nG,SAASmL,SACjCznC,MAAOqlC,EAAWl9B,KAClBg8H,WAAY9+F,EAAWl9B,MAAQg3D,EAC/B5mD,KAAM,CAAC8sB,WAAYA,EAAYxQ,QAASwvG,GAR1C,GAWH,CAED,MAAMC,GAAUjwH,IAAMoI,MAAK,IAAa,IAAZ,KAAClE,GAAU,EACrC,MAAM,IAACK,GAAO0E,KACRmqB,EAAQ,OAAGlvB,QAAH,IAAGA,OAAH,EAAGA,EAAMkvB,SACjBR,EAAiBW,KACjBhC,EAAYpJ,MACZ,sBAAC48B,GAAyBxO,KAC1B4V,EAAgBpH,EAAsB,CAAC,4CACtC/rB,EAAUk3F,GAAe1nH,sBAE1B,SAACqH,EAAD,kBAAWqyB,GAAqB3+B,qBAAW0rH,IAiBjD,OAfAvmH,qBAAU,KACJ0qB,GAAYR,GAGhBnH,iBAAwB,IAAD,EACrB,aAAI0gC,EAAc,iDAAlB,OAAI,EAAyD1/C,IAAI,sCAAuC,CACtG,MAAM0jH,QAAgBJ,GAAcn9F,EAAgBQ,GACpD88F,EAAYC,EACb,KAAM,CACL,MAAM51F,QAAmBi1F,GAAgBjrH,EAAKgtB,EAAW46B,EAAc,0CAA2C/4B,GAClH88F,EAAY31F,EACb,CACF,CAVC61F,EAUD,GACA,CAAC7rH,EAAKgtB,EAAW6B,EAAU+4B,EAAev5B,IAExCoG,EAKH,eAACkiC,GAAA,EAAD,CAAUhzB,OAAK,EAAf,SACGlP,EAAS/qC,KAAI,CAAC8sC,EAAStqB,KACtB,MAAMy2D,EAAar3D,GAAYkrB,EAAQ3H,WAAavjB,EAASujB,UAAY2H,EAAQpvC,QAAUkkB,EAASlkB,MACpG,OACE,gBAACoqD,GAAA,EAAD,CAA2CpqD,MAAOovC,EAAQvlC,MAAO+M,QAAS,IAAM2/B,EAAkBnH,GAAlG,UACGmsC,GAAc,eAACmpD,GAAA,EAAD,UACb,eAAC,KAAD,CAAO,cAAY,iBAErB,eAAChoF,GAAA,EAAD,CAAcioF,OAAQppD,EAAtB,SACGnsC,EAAQvlC,UALb,UAAkB49B,EAAlB,YAA8B3iB,EAAQ,GADxC,MAPG,EAGT,IAsBIivB,GAAO,OAAGx8B,SAAH,IAAGA,QAAH,EAAGA,GAASw8B,QACnB4kB,GAAI,OAAGphD,SAAH,IAAGA,QAAH,EAAGA,GAASohD,KAKtB,SAASisE,GAAT,GAAmE,IAAhD,KAAC1uH,EAAD,SAAO0+G,EAAP,kBAAiBr+E,EAAjB,SAAoCryB,GAAW,EAChE,MAAMvO,EAAUsJ,MACV,KAACpD,GAAQyB,MACRnO,EAAQw8D,GAAa9uD,mBAAS,YAC9BgoH,EAAaC,GAAkBjoH,oBAAS,IACxCgjB,EAAWklG,GAAgBloH,oBAAS,IACrC,aACJy8C,EADI,WAEJE,EAFI,iBAGJL,EAHI,gBAIJ0B,EACA5W,QAASi4E,GACPtxE,KACE4V,EAAgBrH,IAChBlV,EAAUuV,EAAW,IAAIgqE,IAC5Br0H,QACCA,GAAqB,eAAXA,GACC,cAAXA,GACW,cAAXA,GACW,cAAXA,GACW,wBAAXA,IACCqxD,EAAcrxD,MAEb0sH,EAAehhE,IACfmqE,EAAgBnH,KAChBxnB,EAAeD,MACf,SAACniF,GAAY+wG,GAAiB3uB,EAC9B4uB,EAAsB3rE,EAAa,cACnC4rE,EAAoB5rE,EAAa,aACjC6rE,EAAqB7rE,EAAa,aAClC8rE,EAAqB9rE,EAAa,aAClC+rE,EAAsB/rE,EAAa,uBAEnCgsE,EAAe9hH,uBAAY,KAC/BoxG,GAAU,GACT,CAACA,IAEJ73G,qBAAU,KACRooH,GAAmB,GACnBC,EAAmBvlG,IAAcglG,OAAc3+H,EAAY25B,GAC5C,YAAX1wB,GACF81H,OAAoB/+H,GACpBm/H,OAAoBn/H,GACpBg/H,OAAkBh/H,IACE,SAAXiJ,GACT81H,EAAoB,QACpBI,OAAoBn/H,GACpBg/H,OAAkBh/H,IACE,cAAXiJ,GACT81H,OAAoB/+H,GACpBm/H,EAAoB,CAACxpH,EAAK8jB,KAAM,CAACye,UAAW,SAC5C8mF,OAAkBh/H,IACE,WAAXiJ,IACT81H,OAAoB/+H,GACpBm/H,OAAoBn/H,GACpBg/H,EAAkBjxG,GACnB,GACA,CAAC9kB,EAAQ0wB,EAAWglG,EAAaK,EAAmBG,EAAqBJ,EAAqBG,EAAoBD,EAAoBlxG,EAAUpY,IAEnJ,MAAMipB,EAAe7nB,mBAAQ,MAC3BiH,SAAUA,EACVqyB,kBAAmBA,KACjB,CAACA,EAAmBryB,IAElBqhH,EAAiBtoH,mBAAQ,IACtBpO,OAAOsB,OAAO8zC,GAAS90C,QAAOnP,QAClBkG,IAAVlG,KAER,CAACikD,IASEvpC,EAAauC,mBAAQ,KACzB,IAAIvC,EAAa,IAAImG,IAAI,CACvB,aACA,WACA,uBACA,4BACA,yCACA,8CACA,mCACA,2CACA,yCACA,iBAQF,MANsB,IAAIq7G,GAEvB/sH,QAAOu4C,IAAC,aAAKhtC,EAAWoG,IAAI4mC,KAAhB,UAAsBv2C,EAAiBu2C,UAAvC,aAAsB,EAAqBpvB,WAA/C,IACRhoB,SAAQo3C,GAAKhtC,EAAW9P,IAAI88C,KAC/BhtC,EAAa,IAAIA,GAAYpY,KAAK6F,IAAD,CAAYA,OAAMwO,KAAM,MACzD+D,EAAWzW,KAAK,CAACkE,KAAM47C,KAChBrpC,CAAP,GACC,CAACwhH,IAEJ,OAAO,eAACoH,GAAoBztH,SAArB,CAA8B7V,MAAO8kC,EAArC,SACL,gBAACmO,GAAA,EAAD,CAAQt9B,QAAS,CAACg8B,MAAOh8B,EAAQ8+G,QAASv+G,KAAMA,EAAM,cAAY,wBAAlE,UACE,gBAACi9B,GAAA,EAAD,CAAe98B,UAAWV,EAAQ42F,cAAlC,UACE,eAAC,GAAD,CAAW7xF,WAAYA,EAAYrE,UAAWV,EAAQiuH,YACtD,eAAC/lH,GAAA,EAAD,CAAYxH,UAAWV,EAAQsuC,QAAS1kC,QAAQ,QAAhD,qBAGA,gBAAC5B,GAAA,EAAD,CAAKjG,QAAQ,OAAb,UACE,eAACu2C,GAAA,EAAD,UACE,gBAAC+C,GAAA,EAAD,CAAYvrD,KAAG,EAAf,UACE,eAAC6kD,GAAA,EAAD,CACEtqD,MAAO,UACPuqD,QACE,eAAC0G,GAAA,EAAD,CACE9Z,QAAoB,YAAXhoC,EACTyH,QAAS,IAAM+0D,EAAU,aAG7B9hE,MAAM,QAER,eAACygD,GAAA,EAAD,CACEtqD,MAAO,OACPuqD,QACE,eAAC0G,GAAA,EAAD,CACE9Z,QAAoB,SAAXhoC,EACTyH,QAAS,IAAM+0D,EAAU,UAG7B9hE,MAAM,cAER,eAACygD,GAAA,EAAD,CACEtqD,MAAO,YACPuqD,QACE,eAAC0G,GAAA,EAAD,CACE9Z,QAAoB,cAAXhoC,EACTyH,QAAS,IAAM+0D,EAAU,eAG7B9hE,MAAM,qBAER,eAACygD,GAAA,EAAD,CACEtqD,MAAO,SACPuqD,QACE,eAAC0G,GAAA,EAAD,CACE9Z,QAAoB,WAAXhoC,EACTyH,QAAS,IAAM+0D,EAAU,YAG7B9hE,MAAM,0BAIZ,gBAAC8T,GAAA,EAAD,CAAKjG,QAAQ,OAAb,UACE,eAAC4yC,GAAA,EAAD,CACEC,QAAS,eAACtT,GAAA,EAAD,CACPG,SAAUpC,GAAS+vF,EAAa/vF,EAAMlnB,OAAOqpB,SAC7C3gC,MAAM,UACN2gC,QAAStX,EACT13B,KAAK,cAEP0B,MAAM,cAER,eAACygD,GAAA,EAAD,CACEC,QAAS,eAACtT,GAAA,EAAD,CACPG,SAAUpC,GAAS8vF,EAAe9vF,EAAMlnB,OAAOqpB,SAC/C3gC,MAAM,UACN2gC,QAAS0tF,EACT18H,KAAK,gBAEP0B,MAAM,mBAGT07H,EAAe5gI,OAAS,GAAK,eAAC+2E,GAAA,EAAD,CAAM7xE,MAAK,cAAS07H,EAAe5gI,OAAxB,iBAAuCiuB,GAAU,SAAU2yG,EAAe5gI,QAAQ,IAAU6R,MAAM,UAAU6kH,SAAU,IApG9JxsH,OAAOK,KAAK+0C,GAAS3zC,SAAQ1B,IAClCitH,EAAa,CAACjtH,OAAK1I,GAAnB,SAqGE,sBAAKmQ,UAAWV,EAAQguH,aAAxB,SACE,eAACN,GAAD,CACEJ,0BAAyB,OAAE/+G,QAAF,IAAEA,OAAF,EAAEA,EAAUujB,SACrC6O,aAAa,EACb0sF,UAAQ,SAId,gBAAC5vF,GAAA,EAAD,WACE,uBAAM78B,MAAO,CAACujC,SAAU,KACxB,eAACr6B,GAAA,EAAD,CAAQ7I,QAAS0uH,EAAc9uH,MAAM,YAArC,2BAMP,CAjMDu9B,GAAQ7vB,SAnIa,CACnB,aACA,aACA,UACA,eAgIFy0C,GAAK9f,QAAU,CAACkoC,SAAS,EAAMtrE,OAAQ6uH,IACvC3rE,GAAKviB,QAAU,CAAC2qC,SAAS,GAiOVykD,OA1Bf,SAA6B5vH,GAC3B,MAAM,KAACM,EAAD,kBAAOqgC,EAAP,SAA0BryB,EAA1B,SAAoC0wG,EAApC,cAA8Cp0D,GAAiB5qD,EAErE,OAAKM,EAEE,eAAC0tD,GAAD,CACLnN,SAAQ,OAAEl/C,SAAF,IAAEA,QAAF,EAAEA,GAASk/C,SACnBK,kBAAiB,OAAEv/C,SAAF,IAAEA,QAAF,EAAEA,GAASymB,WAC5B24B,eAAgB5iB,GAChB6iB,YAAa+B,GACb9B,mBAAkB,OAAEt/C,SAAF,IAAEA,QAAF,EAAEA,GAASksH,aAC7B/sE,qBAAsB8J,EACtBvJ,sBAAqB,OAAE1/C,SAAF,IAAEA,QAAF,EAAEA,GAASgsH,gBAChC9xH,GAAG,gBARE,SAUL,eAACmzH,GAAD,CAAW1uH,KAAMA,EAAM0+G,SAAUA,EAAUr+E,kBAAmBA,EAAmBryB,SAAUA,MAZ3E,IAcnB,EC1YD,MAAMmmD,GAAoB,CAAC/6D,EAAQtP,MAC1BA,IAAQsP,EAAOm4B,WAAaznC,EAAMynC,UAAYn4B,EAAOtP,QAAUA,EAAMA,OAGxEs8H,GAAuB,CAAC,CAAC,KAAQ,aAAc,KAAQ,IAAK,CAAC,KAAQ,WAAY,KAAQ,KACzFR,GAAmB,IAAIj7G,IAAI,CAAC,aAAc,aAU1C6nD,GAAgB,CAAC15D,EAAS2F,KAC9B,MAAMs1D,EAAU,OAAGt1D,QAAH,IAAGA,OAAH,EAAGA,EAAOs1D,WAC1B,GAAIA,EAAY,CACd,MAAMt2D,EAAQs2D,EAAWr9D,MAAM,KACzBgiB,GAAiB,OAALjb,QAAK,IAALA,OAAA,EAAAA,EAAQ,KAAM,GAC1BsF,GAAY,OAALtF,QAAK,IAALA,OAAA,EAAAA,EAAQ,KAAM,GACrB8xH,EAAe,GACrB,cAAOz2H,QAAP,IAAOA,OAAP,EAAOA,EAASG,QAAOG,IACrB,GAAwB,UAApBA,EAAOo2H,SAAsB,CAC/B,MAAMC,EAjBcr2H,IAClB,GAAN,OAAUA,EAAO4kB,SAAjB,YAA6B5kB,EAAOuf,WAApC,YAAkDvf,EAAOs2H,aAAet2H,EAAOwyB,UAA/E,YAA4FxyB,EAAOm4B,SAAnG,YAA+Gn4B,EAAO60H,YAgBpG0B,CAAmBv2H,GAAQsmB,MAAM,IAAI/0B,OAAO+tB,EAAUT,cAAe,OAInF,OAHU,OAAN7e,QAAM,IAANA,KAAQm4B,UAAYk+F,GACtBF,EAAaxhI,KAAKqL,EAAOm4B,UAEpBk+F,CACR,CACC,QAAU,OAANr2H,QAAM,IAANA,MAAQm4B,WAAYg+F,EAAa//H,SAAS4J,EAAOm4B,YAnBlCn4B,IACnB,GAAN,OAAUA,EAAO4kB,SAAjB,YAA6B5kB,EAAOtP,MAApC,YAA6CsP,EAAO4kB,SAApD,aAAiE5kB,EAAOtP,MAAxE,YAAiFsP,EAAO4kB,SAAxF,YAAoG5kB,EAAOzF,OAmB5Fi8H,CAAkBx2H,GAAQsmB,MAAM,IAAI/0B,OAAOoY,EAAKkV,cAAe,MAIzE,GAEJ,CACC,MAAO,EACR,EAmOY43G,OAhOf,SAAmCnwH,GACjC,MAAM,YAAC20D,EAAD,eAAcy7D,EAAd,MAA8BhmI,EAA9B,iBAAqCimI,EAArC,cAAuDzlE,EAAvD,QAAsE3rD,GAAWe,GACjF,IAACgD,GAAO0E,MACR,WAAC9I,GAAcmD,KACfsvB,EAAiBW,KACjBhC,EAAYpJ,MACXyuC,EAAiBC,GAAsBruD,mBAAS,KAChD/N,EAASo3H,GAAcrpH,mBAAS,KAChCggB,EAAespG,GAAoBtpH,wBAAS3W,IAC5CkyB,GAAe2uB,GAAeu1E,GAAsBR,GAAkB7wD,EAAiB5qB,KACvF4pB,EAAYe,GAAiBnuD,mBAAS,CAAChK,QAAS,GAAIC,UAAW,MAC/DszH,EAAgBC,GAAqBxpH,mBAAS,CAAChK,QAAS,GAAIC,UAAW,MACvE9D,EAAS44E,GAAc/qE,mBAAS,KAChCypH,EAAeC,GAAoB1pH,mBAAS,KAC5C2pH,EAAaC,GAAkB5pH,oBAAUopH,GAEhDlpH,qBAAU,KACRwpH,EAAiB,IACjB,MAAMG,EAAatuG,EAAYjpB,QAAOmpB,GAAsC,eAAxBA,EAAW9mB,WAA2BlP,KAAIg2B,GAAcA,EAAWt4B,QACjH2mI,EAAYvuG,EAAYjpB,QAAOmpB,GAAsC,aAAxBA,EAAW9mB,WAAyBlP,KAAIg2B,GAAcA,EAAWt4B,QAC9G4mI,EAAU,GAUhB,IATc,OAAVF,QAAU,IAAVA,OAAA,EAAAA,EAAY/hI,QAAS,GACvBiiI,EAAQ3iI,KAAK,CAAC,iBAAkByiI,KAErB,OAATC,QAAS,IAATA,OAAA,EAAAA,EAAWhiI,QAAS,GACtBiiI,EAAQ3iI,KAAK,CAAC,eAAgB0iI,IAEhC,OAAI3mI,QAAJ,IAAIA,KAAOynC,UACTm/F,EAAQ3iI,KAAK,CAAC,SAAYjE,EAAMynC,WAEX,IAAnBm/F,EAAQjiI,OAAc,OAC1B,MAAMkiI,EAAc,CAClBt/F,MAAO,UACPn4B,QAAS,CAAC,aAAc,WAAY,SACpC8J,MAAO,CACL6pC,IAAK,CACHyd,EACA,CAACsmE,GAAIF,MAIXhuH,EAAIgC,KAAJ,gBAA0BisH,GAAazsH,MAAKhC,IAAa,IAAD,EACtD,MAAMG,EAAI,OAAGH,QAAH,IAAGA,GAAH,UAAGA,EAAUG,YAAb,aAAG,EAAgBjW,KAAImsB,IACxB,CACLqT,UAAWrT,EAAMqT,UACjB8jG,YAAan3G,EAAMm3G,YACnBn+F,SAAUhZ,EAAMgZ,SAChBvT,SAAUzF,EAAMyF,SAChBrF,WAAYJ,EAAMI,WAClBs1G,WAAY,GACZuB,SAAU,YAEd,IAAIqB,EAAkB,IAAIlmH,IAC1B6lH,EAAWp2H,SAAQse,IACZrW,EAAKjW,KAAImsB,GAASA,EAAMI,aAAYnpB,SAASkpB,IAChDm4G,EAAgBn8H,IAAIgkB,EACrB,IAEH+3G,EAAUr2H,SAAQ4jB,IACX3b,EAAKjW,KAAImsB,GAASA,EAAMyF,WAAUxuB,SAASwuB,IAC9C6yG,EAAgBn8H,IAAIspB,EACrB,IAEC,OAAJ3b,QAAI,IAAJA,KAAM8f,MAAK,CAACvzB,EAAG2oB,KAAO3oB,EAAE+pB,YAAc/pB,EAAEovB,YAAczG,EAAEoB,YAAcpB,EAAEyG,UAAY,GAAK,IACzF6yG,EAAkB,IAAIA,GAAiB1uG,MAAK,CAACvzB,EAAG2oB,IAAM3oB,GAAK2oB,EAAI,GAAK,IACpEy4G,EAAW3tH,EAAKtN,OAAO87H,EAAgBzkI,KAAIssB,IAClC,CAACsF,SAAUtF,EAAWC,WAAYD,EAAW82G,SAAU,aADhE,IAGCprH,OAAM1F,IACPJ,EAAWI,EAAX,GA5BF,GA8BC,CAACgE,EAAK4nD,EAAehsD,EAAY4jB,EAAap4B,IAEjD,MAAMgnI,EAAyBxjH,uBAAaxjB,IAC1CkrE,EAAmBlrE,EAAMmuB,cAAzB,GACC,IAEG84G,EAA6BhqH,mBAAQ,IAClCkrC,mBAAS6+E,EAAwB,MACvC,CAACA,IAEEn9D,EAAoBrmD,uBAAY,CAACwxB,EAAOh1C,KACxB,YAAX,OAALg1C,QAAK,IAALA,OAAA,EAAAA,EAAO5uC,QACT4kE,EAAc,CAACn4D,QAAS7S,EAAO8S,UAAW9S,IAC1CinI,EAA2BjnI,GAC5B,GACA,CAACinI,IAEJlqH,qBAAU,KACR,MAAMmqH,EAAa,GACnBp4H,EAAQwB,SAAQme,IACdy4G,EAAWjjI,KAAKwqB,GACZoO,GAAiBpO,EAAMgZ,WAAa5K,EAAchiB,SACpDgiB,EAAcwQ,SAAS/8B,SAAQ8+B,IAC7B83F,EAAWjjI,KAAKmrC,EAAhB,GAEH,IAECpgC,EAAQrK,SAAWuiI,EAAWviI,QAAWqK,EAAQsxB,OAAM,CAAChxB,EAAQwV,IAAUxV,IAAW43H,EAAWpiH,MAClG8iE,EAAWs/C,EACZ,GACA,CAACp4H,EAASE,EAAS6tB,IAEtB,MAAM+uC,EAAepoD,uBAAY,CAACi5C,EAAGz8D,KACnCgrE,EAAc,CAACn4D,QAAO,OAAE7S,QAAF,IAAEA,OAAF,EAAEA,EAAOm/D,SAAUrsD,UAAS,OAAE9S,QAAF,IAAEA,OAAF,EAAEA,EAAOmkI,aAC3DkC,EAAkB,CAACxzH,QAAO,OAAE7S,QAAF,IAAEA,OAAF,EAAEA,EAAOm/D,SAAUrsD,UAAS,OAAE9S,QAAF,IAAEA,OAAF,EAAEA,EAAOmkI,aAC/D6B,EAAehmI,EAAf,GACC,CAACgmI,IAEEmB,EAAa3jH,uBAAY,CAAC6pB,EAAUrtC,EAAOonI,KAE/C,GADAjB,EAAiB,CAACtrH,QAAS7a,EAAMynC,SAAU4F,SAAUA,IACjD+5F,EACFp8D,EAAc,CAACn4D,QAAQ,GAAD,OAAK7S,EAAMk0B,SAAX,KAAwBphB,UAAU,GAAD,OAAK9S,EAAMk0B,SAAX,WAClD,CACL,MAAMkb,EAAO,OAAG/B,QAAH,IAAGA,OAAH,EAAGA,EAAUtL,MAAKqN,GAAWA,EAAQpvC,SAAR,OAAkBA,QAAlB,IAAkBA,OAAlB,EAAkBA,EAAOA,SACnE,GAAKovC,EAMH47B,EAAc,CAACn4D,QAAO,OAAEu8B,QAAF,IAAEA,OAAF,EAAEA,EAAS+vB,SAAUrsD,UAAS,OAAEs8B,QAAF,IAAEA,OAAF,EAAEA,EAAS+0F,aAC/DkC,EAAkB,CAACxzH,QAAO,OAAEu8B,QAAF,IAAEA,OAAF,EAAEA,EAAS+vB,SAAUrsD,UAAS,OAAEs8B,QAAF,IAAEA,OAAF,EAAEA,EAAS+0F,iBAPvD,CAAC,IAAD,EACZtvH,EAAQ,oCACR,MAAMoE,EAAY,OAALjZ,QAAK,IAALA,GAAA,UAAAA,EAAO60B,eAAP,SAAgBX,SAAiB,OAALl0B,QAAK,IAALA,KAAOA,OAAyB,UAAhBA,EAAMA,OAAqC,SAAhBA,EAAMA,MAAjD,UAAuEA,EAAM60B,QAAQX,SAArF,mBAAiGl0B,QAAjG,IAAiGA,OAAjG,EAAiGA,EAAOA,OAAUA,EAAM60B,QAAQX,SAAY,GACrL82C,EAAc,CAACn4D,QAASoG,EAAMnG,UAAWmG,IACzCotH,EAAkB,CAACxzH,QAASoG,EAAMnG,UAAWmG,GAC9C,CAIF,IACA,CAACpE,IAEEwyH,EAAe7jH,uBAAY,SAACxjB,GAAqC,IAAD,MAA7BonI,EAA6B,wDACpE,UAAI5mE,EAAc,iDAAlB,OAAI,EAAyD96D,SAAS,sCACpE0+H,GAAcn9F,EAAgBjnC,EAAMynC,UACjCrtB,MAAKizB,GAAY85F,EAAW95F,EAAUrtC,EAAOonI,KAEhDvD,GAAgBjrH,EAAKgtB,EAAW46B,EAAc,0CAA/B,OAA0ExgE,QAA1E,IAA0EA,OAA1E,EAA0EA,EAAOynC,UAC7FrtB,MAAKizB,GAAY85F,EAAW95F,EAAUrtC,EAAOonI,IAEnD,GAAE,CAACxuH,EAAKgtB,EAAW46B,EAAev5B,EAAgBkgG,IAEnDpqH,qBAAU,KACHupH,IACM,OAALtmI,QAAK,IAALA,KAAOynC,UAAP,OAAmBznC,QAAnB,IAAmBA,KAAOA,MAC5BqnI,EAAarnI,IAEbgrE,EAAc,CAACn4D,QAAS,GAAIC,UAAW,KACvCuzH,EAAkB,CAACxzH,QAAS,GAAIC,UAAW,MAE9C,GACA,CAACwzH,EAAee,EAAcxyH,EAAS7U,IAE1C,MAAMsnI,EAAqB9jH,uBAAY,CAACwxB,EAAO1lC,KAC7C0lC,EAAMkE,uBACgBhzC,IAAlB22B,GAA+BvtB,EAAOm4B,WAAa5K,EAAchiB,QACnEsrH,OAAiBjgI,GAEjBmhI,EAAa/3H,GAAQ,EACtB,GACA,CAAC+3H,EAAcxqG,IAEZ6sC,EAAalmD,uBAAawxB,IAC1BixF,GACFQ,GAAe,GAEjBz7D,EAAco7D,EAAd,GACC,CAACA,EAAgBH,IAEpB,YAAgB//H,IAAZ8I,EACK,KA4BF,eAAC86D,GAAA,EAAD,CACH9pE,MAAOA,GAAS,KAChBqqE,kBAAmBA,GACnBr7D,QAASA,EACTm7D,cAAeN,EACfzyB,SAAUw0B,EACV3D,QAAUjzB,GAAUyxF,GAAe,GACnCz+D,OAAQ0B,EACRxB,eAAiB54D,GAAWA,EAAO60H,YAAc,GACjDz7D,cAAeA,GACf6B,YAAaA,EACbnC,aApCiB,CAAC94D,EAAQsG,IACJ,UAApBtG,EAAOo2H,SACT,OAAIp2H,QAAJ,IAAIA,KAAQm4B,SACH,eAACiV,GAAA,EAAD,CAEL7pC,SAAe,OAANvD,QAAM,IAANA,OAAA,EAAAA,EAAQuf,aAAcvf,EAAO4kB,SACtCphB,UAAiB,OAANxD,QAAM,IAANA,KAAQs2H,YAAR,uBAAsCt2H,EAAOs2H,aAA7C,qBAA2Et2H,EAAOwyB,WAC7FlrB,QAAUo+B,GAAUsyF,EAAmBtyF,EAAO1lC,GAC9C,cAAa,kCAJRA,EAAOm4B,UAMP,eAACiV,GAAA,EAAD,CAEL5pC,WAAiB,OAANxD,QAAM,IAANA,OAAA,EAAAA,EAAQuf,aAAcvf,EAAO4kB,SACxCtd,QAAUo+B,GAAUA,EAAMkE,kBAC1B,cAAa,oCAHF,OAAN5pC,QAAM,IAANA,OAAA,EAAAA,EAAQuf,aAAcvf,EAAO4kB,UAM/B,eAACwoB,GAAA,EAAD,CAELioF,OAAO,EACP9xH,QAAO,OAAEvD,QAAF,IAAEA,OAAF,EAAEA,EAAQzF,MACjB,cAAa,uBAJR,iBACGyF,QADH,IACGA,OADH,EACGA,EAAQm4B,SADX,mBACuBn4B,QADvB,IACuBA,OADvB,EACuBA,EAAQtP,QAmBtCiqE,YAAau8D,EAAcv8D,EAAWp3D,QAAUo3D,EAAWn3D,YAAc,GACzEi3D,UAAQ,GAEb,ECvOD,MAAMw9D,GAA+BlzH,IAAMC,mBAAcpO,GAMzD,MAAM+Y,GAAYC,cAAWnI,IAAK,CAChC09G,OAAQ,CACNzjF,MAAO,OACP6X,SAAU,SAWd,MAAM2+E,GAA2BnzH,IAAMoI,MAAK,IAAoE,IAAnE,qBAACgrH,EAAD,KAAuBvxH,EAAvB,UAA6BwxH,EAA7B,SAAwClS,EAAxC,WAAkDmS,GAAgB,EAC7G,MAAMhyH,EAAUsJ,MACV,cAACiW,EAAD,SAAgBjB,GAAYmiF,GAAc,MAAQ,CAAC,GACnD,KAACv6F,EAAD,IAAOjD,GAAO0E,MACd,WAAC9I,GAAcmD,MACd3X,EAAO8mD,GAAYjqC,mBAAS,KAC5Bub,EAAagvB,GAAkBvqC,mBAAS,KACxC+qH,EAAgBC,GAAqBhrH,mBAAS,OAC9C44G,EAAiBC,GAAsB74G,oBAAS,IAChDirH,EAAiBC,GAAsBlrH,qBAE9CE,qBAAU,KACRgrH,EAAkB,OAACN,QAAD,IAACA,OAAD,EAACA,EAAuB,IA6BlC,OAAJ5rH,QAAI,IAAJA,KAAM8jB,KAAOzpB,GA5BM4pB,WACrB,MACMkoG,SADiBpvH,EAAIQ,IAAJ,gDACEb,KAAKjW,KAAIsyB,IAChC,MAAMqzG,EAAah0G,IAAaW,EAAOkN,UAClClN,EAAOgxG,YAAP,UAAwBhxG,EAAOgxG,YAA/B,kBAA6D,cAC7DhxG,EAAOgxG,YAAchxG,EAAOgxG,YAA5B,qBAAwDhxG,EAAOkN,WACpE,OAAIjmB,EAAK8jB,MAAQ/K,EAAOgL,YACf,CAAC/1B,MAAOo+H,EAAYnmG,UAAWlN,EAAOkN,UAAWlC,YAAahL,EAAOgL,YAAaqe,MAAO,cAEzF,CAACp0C,MAAOo+H,EAAYnmG,UAAWlN,EAAOkN,UAAWlC,YAAahL,EAAOgL,YAC7E,IAEGsoG,EAAYF,EAAQ74H,QAAOylB,QAA2B1uB,IAAjB0uB,EAAOqpB,QAC5CkqF,EAAgBH,EAAQ74H,QAAOylB,QAA2B1uB,IAAjB0uB,EAAOqpB,QACtD,GAAIkqF,EAAcxjI,OAAS,EAAG,CAC5B,MAAMyjI,EAAY,IAAIvnH,IAAIsnH,EAAc7lI,KAAIsyB,GAAUA,EAAOgL,eAEvDvR,SADiBzV,EAAIQ,IAAJ,wBAAyBlO,MAAMm6D,KAAK+iE,GAAWh2H,KAAK,gBACrD,KAChBi2H,EAAY,CAAC,EACnBh6G,EAAM/d,SAAQuL,GAASwsH,EAAUxsH,EAAKG,SAAW,CAAC7T,KAAM0T,EAAK1T,KAAMmgI,YAAazsH,EAAKysH,eACrFH,EAAc73H,SAAQskB,IAAW,IAAD,QAC9BA,EAAM,MAAN,mBAA+B,UAAAyzG,EAAUzzG,EAAOgL,oBAAjB,SAA+B0oG,YAA/B,oBAAgDD,EAAUzzG,EAAOgL,oBAAjE,aAAgD,EAA+Bz3B,KAA/E,uBAAwFkgI,EAAUzzG,EAAOgL,oBAAzG,aAAwF,EAA+B0oG,YAAvH,eAAwID,EAAUzzG,EAAOgL,oBAAzJ,aAAwI,EAA+Bz3B,KAAtM,IAEFi/C,EAAe8gF,EAAUj9H,OAAOk9H,GACjC,MACC/gF,EAAe4gF,EAChB,EAGDO,EACD,GACA,CAAC3vH,EAAKpE,EAAYyf,EAAlB,OAA4BpY,QAA5B,IAA4BA,OAA5B,EAA4BA,EAAM8jB,IAAKzpB,EAAMuxH,IAEhD,MAAMe,EAAiBhlH,uBAAY,SAAC4e,GAAiC,IAAvB0zF,EAAsB,wDAClE,MAAMjhG,EAAU,CACdtc,KAAM,CACJqf,MAAO8M,GAAqBojG,EAAiB,CAAC5yG,gBAAejB,SAAU2zG,EAAe9lG,YAAY,KAGtG,OAAO,IAAI9nB,SAAQ,CAACC,EAASC,KAC3BtB,EAAIwC,IAAJ,kBAAmBwsH,EAAe9lG,UAAlC,2BAA8DM,EAA9D,sEAAoI0zF,GAAajhG,GAC9Iza,MAAKhC,IAAa,IAAD,IAEhB,GAAoD,aAAxC,OAARA,QAAQ,IAARA,GAAA,UAAAA,EAAUqwH,kBAAV,mBAAsBh6G,aAAtB,eAA6BqsB,gBAA8B,CAAC,IAAD,IAC7D,IAAIlmC,EAAQ,kCAC8B,IAAD,IAAzC,UAAIwD,QAAJ,IAAIA,GAAJ,UAAIA,EAAUqwH,kBAAd,iBAAI,EAAsBh6G,aAA1B,OAAI,EAA6Bla,OAC/BK,EAAK,UAAMA,EAAN,4BAAwBwD,QAAxB,IAAwBA,GAAxB,UAAwBA,EAAUqwH,kBAAlC,iBAAwB,EAAsBh6G,aAA9C,aAAwB,EAA6Bla,QAE5D2F,EAAO,IAAIjV,MAAM2P,GAClB,MACCqF,EAAQ7B,EACT,IAEFkC,OAAM1F,IACLsF,EAAOtF,EAAP,GAdJ,GAiBH,GAAE,CAACkzH,EAAiB5yG,EAAlB,OAAiC0yG,QAAjC,IAAiCA,OAAjC,EAAiCA,EAAgB9lG,UAAWlpB,IAEzD89G,EAAkBlzG,uBAAajL,IACnCiwH,EAAejwH,GAAM,GAClB6B,MAAKhC,IACJsvH,EAAUtvH,EAASqwH,WAAnB,IAEDnuH,OAAM1F,IACL4gH,EAAS,IAAIvwH,MAAM2P,GAAnB,IAEJ8gH,GAAmB,EAAnB,GACC,CAAC8S,EAAgBhT,EAAUkS,IAExBgB,EAAoBllH,uBAAY,KACpCglH,EAAexoI,GACZoa,MAAKhC,IACJsvH,EAAUtvH,EAASqwH,WAAnB,IAEDnuH,OAAM1F,IACoB,8EAArBA,EAAMM,WACRwgH,GAAmB,GAEnBF,EAAS,IAAIvwH,MAAM2P,GACpB,GATL,GAWC,CAAC4zH,EAAgBhT,EAAUkS,EAAW1nI,IASzC,OAPA+c,qBAAU,KACR,GAAIqb,EAAYzzB,OAAS,EAAG,CAC1B,MAAMgkI,EAAavwG,EAAY2J,MAAKnN,GAAUX,IAAaW,EAAOkN,YAClE+lG,EAAkBc,EACnB,IACA,CAACvwG,EAAanE,IAEV,gBAAC,IAAMvW,SAAP,WACL,gBAACu1B,GAAA,EAAD,CAAQt9B,QAAS,CAACg8B,MAAOh8B,EAAQ8+G,QAASv+G,KAAMA,EAAM2+G,sBAAoB,EAAC,cAAY,0BAAvF,UACE,eAAC3hF,GAAA,EAAD,UAA6B,OAAf40F,QAAe,IAAfA,KAAiB3/H,KAAjB,uCAAwD2/H,EAAgB3/H,MAAxE,yBACd,gBAACgrC,GAAA,EAAD,WACE,eAAC,KAAD,CACEnkC,QAASopB,EACT7hB,MAAO,CAACy6B,MAAO,OAAQsH,cAAe,IACtClB,SAAU,CAACpC,EAAOh1C,IAAU6nI,EAAkB7nI,GAC9CA,MAAO4nI,EACPv9D,kBAAmB,CAAC/6D,EAAQtP,IAAUsP,EAAOwyB,YAAc9hC,EAAM8hC,UACjEqmC,QAAU74D,GAAWA,EAAO2uC,MAC5BiqB,eAAiB54D,GAAWA,EAAOzF,MACnC0gE,YAAclxD,GAAW,eAAC+tD,GAAA,EAAD,IAAe/tD,EAAQxP,MAAM,gBAAgB0V,QAAQ,cAE3D,OAApBkoH,QAAoB,IAApBA,OAAA,EAAAA,EAAsB9iI,QAAS,EAAI,eAAC,KAAD,CAClCqK,QAASy4H,EACTlxH,MAAO,CAACy6B,MAAO,OAAQsH,cAAe,IACtClB,SAAU,CAACpC,EAAOh1C,IAAU+nI,EAAmB/nI,GAC/CA,MAAO8nI,EACPz9D,kBAAmB,CAAC/6D,EAAQtP,IAAUsP,EAAOi2B,iBAAmBvlC,EAAMulC,eACtE2iC,eAAiB54D,GAAWA,EAAOnH,KACnCoiE,YAAclxD,GAAW,eAAC+tD,GAAA,EAAD,IAAe/tD,EAAQxP,MAAM,qBAAqB0V,QAAQ,aAChF,GACL,eAAC6nD,GAAA,EAAD,CACE7wD,MAAO,CAACy6B,MAAO,QACfnnC,MAAO,OACP7J,MAAOA,EACPuf,QAAQ,SACR63B,SAAUpC,GAAS8R,EAAS9R,EAAMlnB,OAAO9tB,OACzC,cAAY,uBAEd,eAAC29G,GAAA,EAAD,UACG39G,EAAK,qBAAiBA,EAAjB,iBAAwC,QAGlD,gBAACozC,GAAA,EAAD,WACE,uBAAM78B,MAAO,CAACujC,SAAU,KACxB,eAACr6B,GAAA,EAAD,CAAQ7I,QAAS,IAAM+wH,IAAcnxH,MAAM,YAA3C,oBAGA,eAACiJ,GAAA,EAAD,CAAQ7I,QAAS8xH,EAAmBv/E,UAAWnpD,KAAS,OAAC4nI,QAAD,IAACA,KAAgB9lG,WAAWtrB,MAAM,YAA1F,0BAKJ,eAAC,GAAD,CACEN,KAAMu/G,EACNl9G,KAAMvY,EACN20H,YAAa+B,EACb9B,SAAU,IAAMc,GAAmB,OAjDvC,IA6DWz6C,GAAW5mE,IAAMq+B,YAAW,WAAuCnb,GAAM,IAAD,QAA1B,QAAC2jD,KAAYtlE,GAAa,EACnF,MAAMi5B,EAvLCj3B,qBAAW2vH,IAwLZtuH,EAAI,OAAG41B,QAAH,IAAGA,OAAH,EAAGA,EAAW7uC,MACxB,OAAO,eAAC,QAAD,IACD4V,EACJ,6BAAqBslE,GACrB9wD,GAAE,yCAA6BykB,QAA7B,IAA6BA,GAA7B,UAA6BA,EAAWha,eAAxC,aAA6B,EAAoBiN,UAAjD,4BAAuE+M,QAAvE,IAAuEA,GAAvE,UAAuEA,EAAWha,eAAlF,aAAuE,EAAoB4S,SAA3F,iBAA4GxuB,IAEjH,IA2Oc2vH,OAtOev0H,IAAMoI,MAAK,SAA+B7G,GAAQ,IAAD,IAC7E,MAAM,IAAC9H,GAAOsoG,GAAc,MAAQ,CAAC,GAC/B,YAACkZ,EAAD,MAActvH,EAAd,SAAqBo3C,EAArB,MAA+BtyB,GAASlP,GACvC6Y,EAAO4O,GAAYxgB,mBAAS,OAC5B3G,EAAM48B,GAAWj2B,oBAAS,IAC1BgsH,EAAuBC,GAA4BjsH,oBAAS,IAC7D,KAAChB,EAAD,IAAOjD,GAAO0E,MACd,WAAC9I,GAAcmD,MACd/C,EAAO2zC,GAAY1rC,mBAAS,CAACjI,WAAO1O,EAAW6iI,qBAAiB7iI,IACjE8yE,EAAOa,KACPj0C,EAAYpJ,KACZwsG,EApMR,SAAgC1Z,GAC9B,OAAOryG,mBAAQ,KACb,MAAM8wB,EAAuBuhF,EAAYlpH,KAAK4nC,sBAC9C,OAAOD,EAAqBnW,QAAUoQ,GAAe+F,EAAqBH,SAAWG,CAArF,GACC,CAACuhF,GACL,CA+L8B2Z,CAAuB3Z,GAC9C4Z,EAAiCjsH,mBAAQ,WAAM+rH,QAAN,IAAMA,OAAN,EAAMA,EAAsBzjG,gBAAgB,CAACyjG,IAE5FjsH,qBAAU,KACR,IAAK/c,GAAmB,KAAVA,EAGZ,OAFAuoD,EAAS,CAAC3zC,MAAO,KAAMm0H,gBAAiB,YACxC1rG,EAAS,MAGUyC,WACnB,IAAKhyB,EACH,OAEF,MAAMghC,EAAc5Y,GAAgBl2B,EAAO8N,GAC3C,GAAIghC,EAAY1oC,OAASquB,GAAQI,SAAWia,EAAY1oC,OAASquB,GAAQrjB,SACvE,MAAM,IAAInM,MAAJ,sDAAyD6pC,EAAY1oC,KAArE,qBAAsFpG,IAE9F,IAAIkZ,EAAQ,CACVuuB,SAAUqH,EAAYj0B,SAExB,OAAIi0B,QAAJ,IAAIA,KAAa7a,WACf/a,EAAQ,CAAC4oB,UAAWgN,EAAY7a,YAAa/a,IAE/C,MAcMX,SAdiBK,EAAIgC,KAAJ,wBAAkC,CACvD2sB,MAAO,UACPruB,MAAOA,EACP,SAAY,CACV,SAAY,CACV,UAAa,IACb,SAAY,IACZ,SAAY,IACZ,kBAAqB,OAGxB,CACDoC,WAAW,KAES/C,KACtB,GAAIA,EAAK5T,OAAS,EAAG,CACnB,MAAMkwB,EAAUtc,EAAK,GAAGsc,QAAQyH,SACS,IAArCzH,EAAQs0G,kBAAkBxkI,QAC5B04B,EAAS,CAACr9B,MAAOA,EAAO60B,QAASA,IACjC0zB,EAAS,CAAC3zC,MAAO,KAAMm0H,gBAAiB,SAExC1rG,EAAS,MACTkrB,EAAS,CAAC3zC,MAAO,KAAMm0H,gBAAiB,6DAE3C,MACC1rG,EAAS,MACTkrB,EAAS,CAAC3zC,MAAO,8CAA+Cm0H,gBAAiB,MAClF,EAEHK,EAAc,GACb,CAACxwH,EAAK9K,EAAK9N,IAEd,MAAMqpI,EAAmB7lH,uBAAaxjB,GAC3B,OAALA,QAAK,IAALA,KAAOynC,UAAP,OAAmBznC,QAAnB,IAAmBA,KAAO8hC,WAA1B,OAAuC9hC,QAAvC,IAAuCA,KAAOiZ,KAC1C,cAAN,OAAqBjZ,EAAM8hC,UAA3B,oBAAgD9hC,EAAMynC,SAAtD,YAAkEznC,EAAMiZ,MAC1D,OAALjZ,QAAK,IAALA,KAAOynC,UAAP,OAAmBznC,QAAnB,IAAmBA,KAAO8hC,UAC7B,cAAN,OAAqB9hC,EAAM8hC,UAA3B,oBAAgD9hC,EAAMynC,SAAtD,SACK,OAAIznC,QAAJ,IAAIA,KAAOynC,SACV,qBAAN,OAA4BznC,EAAMynC,SAAlC,cAEA,GAED,IAEG6hG,EAAc9lH,uBAAaxjB,IAC3Bo3C,GACFA,EAASp3C,EACV,GACA,CAACo3C,IAEEmyF,EAAoB/lH,uBAAaxjB,IACrC,MAAMwpI,EAAgBH,EAAgB,OAACrpI,QAAD,IAACA,OAAD,EAACA,EAAOuY,MAC9C+wH,EAAYE,GACZ12F,GAAQ,EAAR,GACC,CAACw2F,EAAaD,IAEXnuD,EAAUj+D,mBAAQ,IACjB2Z,MAAM9R,GAGFwqG,EAAYnnH,KAFb,GAAN,OAAUmnH,EAAYnnH,KAAtB,YAA8B2c,IAI/B,CAACwqG,EAAaxqG,KAEX,gBAACksG,EAAD,iBAAkBiV,KAAqBprB,GAAcoW,GAAc3B,GACnE7gH,EAASwgD,YAAewgE,IACxB5lH,EAAQsxB,GAAgBm0F,GAAa,EAAd,OAAoB7gH,QAApB,IAAoBA,OAApB,EAAoBA,EAAQihH,UAEnD+Z,EAAgBjmH,uBAAaxjB,IACjC8oI,GAAyB,GACzB,MAAMU,EAAgBH,EAAiB,CACrCx6G,WAAY7uB,EAAMyuB,MAAMyF,SACxB4N,UAAW9hC,EAAM8hC,UACjB2F,SAAUznC,EAAMynC,WAElB6hG,EAAYE,GACZnsG,EAAS,CAACr9B,MAAOwpI,EAAc58H,MAAM,KAAK,GAAIioB,QAAS70B,EAAMyuB,OAA7D,GACC,CAAC66G,EAAaD,IAEXK,EAAelmH,uBAAa5O,IAChCk0H,GAAyB,GACzBt0H,EAAWI,EAAX,GACC,CAACJ,IAEEm1H,EAAiBnmH,uBAAY,KACjCslH,GAAyB,EAAzB,GACC,IAEGtoE,EAAgBvjD,mBAAQ,MAAQ,yCAA0C,CAACisH,MAAmC,CAACA,IAE/GU,EAA8BpmH,uBAAY,CAACmnD,EAAcv0B,KAC7D,MAAM1gC,EAAWrB,IAAMu4D,SAASC,QAAQlC,EAAa/0D,MAAMF,UAI3D,OAHA0gC,EAAQ9lC,SAAQs6D,IACdl1D,EAASzR,KAAK2mE,EAAd,IAEKv2D,IAAM05D,aAAapD,EAAc,CAAC,EAAGj1D,EAA5C,GACC,IAEG+xH,EAAuBxqH,mBAAQ,KACnC,MAAM4sH,EAAqBjkG,EAAUR,yBAAyB4jG,GAE9D,MADoB,CAACA,GAAsB/9H,OAAO4+H,GAC/B16H,QAAOigC,KAAaA,EAAQrE,iBAAiBhJ,MAAKsJ,GAA8C,mCAA/BA,EAAY9F,kBAAhG,GACC,CAACK,EAAWojG,IAET5yF,EAAUn5B,mBAAQ,KACtB,MAAMm5B,EAAU,GA4BhB,OA3BKp2C,IAA6B,OAApBynI,QAAoB,IAApBA,OAAA,EAAAA,EAAsB9iI,QAAS,GAC3CyxC,EAAQnyC,KAAK,eAACyS,GAAA,EAAD,CAAiCC,KAAM,QAASwyC,WAAU,OAACttC,QAAD,IAACA,KAAM8jB,KAAK/oB,QAAS,IAAMkyH,GAAyB,GAA9G,SACX,eAACv1F,GAAA,EAAD,CAASD,MAAM,oCAAf,SACE,eAAC,KAAD,OAF0B,iBAMhC8C,EAAQnyC,KAAK,eAACyS,GAAA,EAAD,CAA+BC,KAAM,QAASC,QAAS,IAAMk8B,GAAQ,GAArE,SACX,eAACS,GAAA,EAAD,CAASD,MAAM,4BAAf,SACE,eAAC,KAAD,OAF0B,eAK1B0lC,GAAQh5E,IAAU4U,EAAMA,QAC1BwhC,EAAQnyC,KAGN,eAAC0Z,GAAA,EAAD,CAAKjG,QAAQ,OAAb,SACE,eAACyjE,GAAD,CAEExkE,KAAK,QAAQukE,QAASA,EACtBE,SAAUH,GACVztB,KAAM,eAAC,KAAD,KAHD,0BAOXpX,EAAQnyC,KAAK,eAACk3E,GAAD,CAAmCxkE,KAAK,QAAQukE,QAASA,GAAxC,oBAEzB9kC,CAAP,GACC,CAACp2C,EAAOg5E,EAAMkC,EAASr/D,EAAMjH,EAAMA,MAAO6yH,IAEvCqC,EAAkB7sH,mBAAQ,KAAO,IAAD,IACpC,MAAMjd,GAAa,OAALyuB,QAAK,IAALA,GAAA,UAAAA,EAAOzuB,aAAP,eAAc4M,MAAM,KAAK,KAAM,GAC7C,OAAO6hB,EAAQ,CAACgZ,SAAQ,OAAEhZ,QAAF,IAAEA,GAAF,UAAEA,EAAOoG,eAAT,aAAE,EAAgB4S,SAAUznC,MAAOA,EAAM2P,QAAQ,eAAgB,MAAOklB,QAAO,OAAEpG,QAAF,IAAEA,OAAF,EAAEA,EAAOoG,SAAW,IAA3H,GACC,CAACpG,IAEEskD,EAAcvvD,uBAAa5O,IAC/B2zC,GAASwhF,IAAa,IAASA,EAAen1H,MAAOA,KAArD,GACC,IAEH,OAAI5U,QAA6BkG,IAApB4jI,EACJ,KAGF,eAACvC,GAA6B1xH,SAA9B,CAAuC7V,MAAO8pI,EAA9C,SACL,gBAACnsH,GAAA,EAAD,CAAKjG,QAAQ,OAAO09B,cAAc,MAAMl3B,WAAW,SAAnD,UACE,gBAACP,GAAA,EAAD,CAAKm8B,SAAU,EAAf,UACE,eAAC,GAAD,CACEksF,eAAgBuD,EAChBvpI,MAAO8pI,EACPtpE,cAAeA,EACf3rD,QAASk+D,EACTkzD,iBAAkBA,EAClB17D,YAAclxD,GAEV,eAAC+tD,GAAA,EAAD,IACM/tD,EACJkG,QAAQ,SACR3K,SAAUA,EAAMA,QAASA,EAAMm0H,iBAC/Bv+D,WAAY51D,EAAMA,OAASA,EAAMm0H,gBACjCngE,WAAY,IACPvvD,EAAOuvD,WACV+B,aAAci/D,EAA4BvwH,EAAOuvD,WAAW+B,aAAcv0B,OAExEykE,EACJhxG,MAAOA,EACPq0C,YAAa,oCACb,cAAY,8BAKpB,eAACspF,GAAD,CAA0BtxH,KAAM2yH,EAAuBpB,qBAAsBA,EAAsBC,UAAW+B,EAAejU,SAAUkU,EAAc/B,WAAYgC,OAEnK,eAAC,GAAD,CACEzzH,KAAMA,EACN0+G,SAAU,IAAM9hF,GAAQ,GACxByD,kBAAmBgzF,EACnBrlH,SAAUuK,GAAS,CAACgZ,SAAQ,OAAEhZ,QAAF,IAAEA,GAAF,UAAEA,EAAOoG,eAAT,aAAE,EAAgB4S,SAAUznC,MAAK,OAAEyuB,QAAF,IAAEA,GAAF,UAAEA,EAAOzuB,aAAT,aAAE,EAAc4M,MAAM,KAAK,IACxF4zD,cAAeA,QAItB,ICzcM,MAAMwpE,GAA4B9qH,cAAWnI,IAAK,CACvDsI,OAAQ,CACNK,WAAY3I,EAAMkH,QAAQ,IAE5Bw2G,OAAQ,CACNzjF,MAAO,QAETi5F,cAAe,CACbrsH,OAAQ7G,EAAMkH,QAAQ,GACtB+xB,SAAU,YAEZk6F,eAAgB,CACdl6F,SAAU,WACViG,IAAK,MACL8wB,KAAM,MACNh3B,WAAY,GACZrwB,YAAa,QAIJyqH,GAAmB91H,IAAMoI,MAAK,SAA0B7G,GACnE,MAAMD,EAAUq0H,MACT9zH,EAAM48B,GAAWj2B,oBAAS,IAC1ButH,EAAYC,GAAiBxtH,oBAAS,IACtCytH,EAAWC,GAAgB1tH,oBAAS,IACpCjI,EAAO2zC,GAAY1rC,mBAAS,OAC5BtE,EAAMiyH,GAAW3tH,mBAAS,CAC/B4tH,WAAY,GACZC,UAAW,GACX3xB,MAAO,GACPuvB,YAAa,MAET,IAAE1vH,GAAQ0E,KAEVnH,EAAcqN,uBAAY,CAACwxB,EAAOy0B,KACvB,kBAAXA,GACF32B,GAAQ,EACT,GACA,CAACA,IAEE+4B,EAAeroD,uBAAY,KAC/B6mH,GAAc,GAEdzxH,EAAI+xH,WAAWpyH,GAAM6B,MAAK,KACxBiwH,GAAc,GACdv3F,GAAQ,EAAR,IACCx4B,OAAM1F,IACP,IAAIG,EAAU,GAAKH,EACnB,IACEG,EAAUvJ,KAAKC,MAAMmJ,EAAMoG,QAAQ4vH,cAAcpyH,QAAU,GAAK5D,CACnD,CAAb,MAAOuD,GAAM,CACfowC,EAASxzC,GACTs1H,GAAc,GACdE,GAAa,EAAb,GAVF,GAYC,CAAChyH,EAAM8xH,EAAev3F,EAASyV,EAAU3vC,IAEtCgzD,EAAepoD,uBAAY,CAAC5U,EAAK5O,KACrC,MAAMupE,EAAQvpE,IAAU6O,OAAOK,KAAKqJ,GAAMwpB,MAAK8oG,KAAaj8H,IAAQi8H,GAAWtyH,EAAKsyH,MACpFL,EAAQ,IAAKjyH,EAAM,CAAC3J,GAAM5O,IAC1BuqI,EAAahhE,EAAb,GACC,CAACihE,EAASjyH,EAAMgyH,IAEbr6D,EAAa1sD,uBAAY,KAC7BsvB,GAAQ,EAAR,GACC,CAACA,IAEEn4B,EAAQ,CAAC/L,EAAK/E,IAAU,eAACu9D,GAAA,EAAD,CAC5B7nD,QAAQ,SACR1V,MAAOA,EACP7J,MAAOuY,EAAK3J,GACZwoC,SAAUpC,GAAS42B,EAAah9D,EAAKomC,EAAMlnB,OAAO9tB,OAClD4d,OAAO,SACPssD,WAAS,IACX,OAAO,gBAAC,IAAMxsD,SAAP,WACL,eAAC+B,GAAA,EAAD,CAAQpJ,UAAWV,EAAQ0J,OACzBzI,QAASs5D,EACT15D,MAAM,YAAY2yC,SAAUihF,EAF9B,6BAMA,gBAACn3F,GAAA,EAAD,CACEt9B,QAAS,CAAEg8B,MAAOh8B,EAAQ8+G,QAC1Bv+G,KAAMA,EACNV,QAASW,EAAa0+G,sBAAoB,EAH5C,UAIE,eAAC3hF,GAAA,EAAD,yCACA,gBAACC,GAAA,EAAD,WACE,eAACwqE,GAAA,EAAD,gaAQC/oG,GAAS,eAAC+oG,GAAA,EAAD,CAAmBnnG,MAAM,QAAzB,SACP5B,IAEF+F,EAAM,QAAS,SACfA,EAAM,aAAc,cACpBA,EAAM,YAAa,aACnBA,EAAM,cAAe,kBAExB,gBAACy4B,GAAA,EAAD,WACE,eAAC3zB,GAAA,EAAD,CAAQ7I,QAAST,EAAagzC,SAAUihF,EAAxC,oBAGA,uBAAK/zH,UAAWV,EAAQs0H,cAAxB,UACE,eAACxqH,GAAA,EAAD,CAAQ7I,QAASi1D,EAAcr1D,MAAM,UAAU2yC,UAAWmhF,EAA1D,oBAGCF,GAAc,eAAC30F,GAAA,EAAD,CAAkB9+B,KAAM,GAAIN,UAAWV,EAAQu0H,4BAKvE,IClFYY,GAA2Bz2H,IAAMC,gBAExC2K,GAAYC,cAAWnI,IAAK,CAChC09G,OAAQ,CACNzjF,MAAO,YAIX,SAAS+5F,KACP,MAAM,QAACC,EAAD,aAAUC,GAAgBrzH,qBAAWkzH,IACrCloE,EAAcsoE,sBAAWC,IAASA,IAAM,GAExCp3F,EAAU,CACd,CAACnlC,IAAK,OAAQ0lC,MAAO,OAAQ7+B,OAAQ21H,GAAUA,EAAOjjI,MACtD,CAACyG,IAAK,cAAe0lC,MAAO,OAAQ7+B,OAAQ21H,GAAUA,EAAO9C,aAC7D,CACE15H,IAAK,OACL0lC,MAAO,OACP7+B,OAAQ21H,GAA2B,gBAAhBA,EAAO/xF,KAAyB+xF,EAAO/xF,KACtD,gBAAC2Q,GAAA,EAAD,CAAQhqD,MAAOorI,EAAO/xF,KACtBjC,SAAWpC,IACTo2F,EAAO/xF,KAAOrE,EAAMlnB,OAAO9tB,MAC3BirI,GAAa,GACbroE,GAAa,EAJf,UAOA,eAACxY,GAAA,EAAD,CAAUpqD,MAAO,YAAjB,uBACA,eAACoqD,GAAA,EAAD,CAAUpqD,MAAO,WAAjB,2BAKR,OAAO,eAAC,GAAD,CAAW+zC,QAASA,EAASx7B,KAAMyyH,EAAnC,SACL,eAAC,GAAD,CAAgB50F,QAASi1F,MAE5B,CAEM,MAAMC,GAAa,CAAC1yH,EAAK2yH,EAAeppF,IACtC,IAAInoC,SAAQ,CAACC,EAASC,KAC3BtB,EAAI4yH,SAAS,CAAC1vH,OAAQqmC,IACnB/nC,MAAKiU,IACJ,MAAMo9G,EAAkBp9G,EAAMlf,QAAO0M,IAAuD,IAA/CA,EAAK1T,KAAKgmB,cAAc7Y,QAAQ6sC,KAC7EspF,EAAgBpzG,MAAK,CAACvzB,EAAG2oB,KACvB,MAAMi+G,EAAS5mI,EAAEqD,KAAKgmB,cAChBw9G,EAASl+G,EAAEtlB,KAAKgmB,cACtB,OAAIu9G,EAAO12H,WAAWmtC,IACZ,EACCwpF,EAAO32H,WAAWmtC,GACpB,EAEA,CACR,IAEHloC,EAAQwxH,EAAgB7kI,MAAM,EAAG,GAAjC,IAED0T,OAAMijH,IACLrjH,EAAOqjH,EAAP,GAjBJ,IAsBJ,SAASqO,GAAT,GAAgC,OAATh2H,GAAQ,EAC7B,MAAM,IAACgD,EAAD,WAAMpE,GAAcoB,GACnByjC,EAAMwyF,GAAWhvH,mBAAS,cAC1Bub,EAAagvB,GAAkBvqC,mBAAS,KACxCivH,EAAWC,GAAgBlvH,mBAAS,KACrC,QAACmuH,EAAD,WAAUgB,EAAV,aAAsBf,GAAgBrzH,qBAAWkzH,KAChDmB,EAAcC,GAAmBrvH,oBAAS,IAC1Cg2G,EAASsZ,GAActvH,oBAAS,IAChC3D,EAAOkzH,GAAYvvH,mBAAS,IAE7BgtD,EAAoBrmD,uBAAY,CAACwxB,EAAOh1C,KAC5C,MAAMmiD,EAAWniD,EAAMmuB,cACjBg0B,EAASntC,WAAWkE,IAAiC,IAAvBkf,EAAYzzB,QAA2B,KAAVuU,GAC/DoyH,GAAW1yH,EAAKM,EAAOipC,GACpB/nC,KAAKgtC,GACL9sC,OAAMijH,IACLn2E,EAAe,IACf5yC,EAAW+oH,EAAX,IAGN6O,EAASjqF,EAAT,GACC,CAACvpC,EAAKM,EAAO1E,EAAY4jB,EAAYzzB,SAElCsiI,EAA6BhqH,mBAAQ,IACzCkrC,mBAAS0hB,EAAmB,MAC3B,CAACA,IAEE+B,EAAepoD,uBAAY,CAACwxB,EAAOh1C,KACnCA,GAAK,OAAIA,QAAJ,IAAIA,KAAOgc,SAClB+vH,EAAa/rI,GACbmsI,GAAW,GACXD,EAAgBlB,EAAQ1oI,KAAI8oI,GAAUA,EAAOpvH,UAAStW,SAAS1F,EAAMgc,WAErEmwH,GAAW,EACZ,GACA,CAACnB,IAEEqB,EAAY7oH,uBAAY,KACxB61B,IACG2xF,EAAQ1oI,KAAI8oI,GAAUA,EAAOpvH,UAAStW,SAASomI,EAAU9vH,SAK5DkwH,GAAgB,IAJhBJ,EAAS,KAAWzyF,EACpB2yF,GAAWhB,GAAW,IAAIA,EAASc,KACnCb,GAAa,IAIhB,GACA,CAACD,EAASc,EAAWzyF,EAAM4xF,EAAce,IAE5C,OAAO,gBAAC,IAAMtuH,SAAP,WACL,eAAC,KAAD,CACEnH,MAAO,CAACy6B,MAAO,QACfhiC,QAASopB,EACT8vC,eAAgB54D,GAAWA,EAAOg5H,YAAP,UAAwBh5H,EAAOnH,KAA/B,aAAwCmH,EAAOg5H,YAA/C,KAAgEh5H,EAAOnH,KAClGkiE,kBAAmB,CAAC/6D,EAAQtP,MAAUA,GAAQsP,EAAO0M,UAAYhc,EAAMgc,QACvEmuD,cAAe88D,EACf7vF,SAAUw0B,EACVrB,YAAalxD,GACX,eAAC+tD,GAAA,EAAD,IACM/tD,EACJkG,QAAQ,SACR5I,KAAK,QACL9M,MAAM,kDACNq0C,YAAY,gBACZtgC,OAAO,SACPssD,WAAS,MAIf,eAACvsD,GAAA,EAAD,CAAK+B,WAAY,EAAjB,SACE,eAAC7B,GAAA,EAAD,CAAYkkH,QAASkK,EAAcz1H,MAAM,QAAzC,gEAIF,gBAACy3C,GAAA,EAAD,CAAa1uC,QAAQ,SAAS5I,KAAK,QAAQuzD,WAAS,EAApD,UACE,eAAChc,GAAA,EAAD,CAAYo+E,QAAQ,OAApB,sCACA,gBAACtiF,GAAA,EAAD,CACEuiF,QAAM,EACNn1F,SAAWpC,GAAU62F,EAAQ72F,EAAMlnB,OAAO9tB,OAC1CwsI,WAAY,CACVrkI,KAAM,OACNsJ,GAAI,QALR,UAQE,yBAAQzR,MAAO,YAAf,uBACA,yBAAQA,MAAO,WAAf,4BAGJ,eAAC2d,GAAA,EAAD,CAAKjG,QAAQ,OAAO29B,eAAe,MAAMo3F,SAAU,EAAnD,SACE,eAAChtH,GAAA,EAAD,CAAQ7I,QAASy1H,EAAW71H,MAAM,UAAU+I,QAAQ,YAAY4pC,SAAU8iF,IAAiBpZ,EAA3F,qBAKL,CAMD,MAAMwY,GAAeh3H,IAAMoI,MAAM7G,IAC/B,MAAM,KAAC2C,GAAQ3C,GACT,QAACo1H,EAAD,WAAUgB,EAAV,aAAsBf,GAAgBrzH,qBAAWkzH,IAQjD4B,EAAwB,gBAAdn0H,EAAK8gC,KAErB,OAAO,eAAC3iC,GAAA,EAAD,CAAYyyC,SAAUujF,EAAS91H,QARjB,KACnB,MAAM+1H,EAAkB3B,EAAQ77H,QAAOi8H,KAAYA,EAAOpvH,UAAYzD,EAAKyD,WAC3EgwH,EAAWW,GACX1B,GAAa,EAAb,EAK2D,cAAY,uBAAlE,SACL,eAAC13F,GAAA,EAAD,CAASD,MAAM,oBAAf,SACE,eAAC,KAAD,OAFJ,IAsIas5F,OA5HW,IAAsB,IAArB,KAAC12H,EAAD,QAAO48B,GAAa,EAC7C,MAAMn9B,EAAUsJ,MACV,IAACrG,GAAO0E,MACR,WAAC9I,GAAcmD,MACf,SAACsc,EAAD,OAAWW,EAAX,aAAmBoK,GAAgB6+F,MAClCmN,EAASgB,GAAcnvH,mBAAS,KAChCgwH,EAAW5B,GAAgBpuH,oBAAS,IACpCiwH,EAAmBC,GAAwBlwH,oBAAS,GAErD2uH,EAAWhoH,uBAAY,CAACwpH,EAAUC,IAC/B,IAAIjzH,SAAQ,CAACC,EAASC,KAC3BtB,EAAIQ,IAAJ,wBAAyB4zH,EAAS56H,KAAK,eACpCgI,MAAKhC,IACJ,MAAM4yH,EAAU5yH,EAAQ,KAAS9V,KAAI,CAAC8oI,EAAQtmH,KAC5CsmH,EAAO/xF,KAAO4zF,EAAMnoH,GACbsmH,KAETnxH,EAAQ+wH,EAAR,IAED1wH,OAAM1F,GAASsF,EAAO,IAAIjV,MAAM,8BAAgC2P,KARnE,KAUD,CAACgE,IAEEs0H,EAAe1pH,uBAAY,KAC/B,MAAMwpH,EAAW,CAACp4G,EAAOgL,aAAa30B,OAAO2pB,EAAOuoB,UAAWvoB,EAAOwoB,WAChE6vF,EAAQ,CAAC,eAAehiI,OAAO2pB,EAAOuoB,UAAU76C,KAAIm6D,GAAK,cAAc7nC,EAAOwoB,UAAU96C,KAAIm6D,GAAK,cACvG,OAAO+uE,EAASwB,EAAUC,EAA1B,GACC,CAACzB,EAAU52G,IAEd7X,qBAAU,KACH7G,IAIL81H,EAAW,IACXf,GAAa,GACbiC,IACG9yH,KAAK4xH,GACL1xH,MAAM9F,GAFT,GAGC,CAAC04H,EAAch3H,EAAM1B,IAExB,MA+BMswB,EAAe7nB,mBAAQ,MAC3B+tH,QAASA,EACTgB,WAAYA,EACZa,UAAWA,EACX5B,aAAcA,KACZ,CAACD,EAASgB,EAAYa,EAAW5B,IAErC,OAAO,eAACH,GAAyBj1H,SAA1B,CAAmC7V,MAAO8kC,EAA1C,SACL,eAAC,IAAMpnB,SAAP,UACGxH,GAAQ,gBAAC+8B,GAAA,EAAD,CAAQt9B,QAAS,CAACg8B,MAAOh8B,EAAQ8+G,QAASv+G,KAAMA,EAAM2+G,sBAAoB,EAAC,cAAY,sBAAvF,UACP,eAAC3hF,GAAA,EAAD,kCACA,gBAACC,GAAA,EAAD,WACE,eAACwqE,GAAA,EAAD,kJAGA,eAAClE,GAAA,EAAD,IACA,eAACmyB,GAAD,CAAWhzH,IAAKA,EAAKpE,WAAYA,IACjC,eAACu2H,GAAD,OAEF,gBAAC33F,GAAA,EAAD,WACE,eAAC,GAAD,IACA,uBAAM78B,MAAO,CAACujC,SAAU,KACxB,eAACr6B,GAAA,EAAD,CAAQ7I,QA9BM,KAChBi2H,EACFE,GAAqB,GAErBj6F,GAAQ,EACT,EAyBqCt8B,MAAM,YAAtC,oBAGA,eAACiJ,GAAA,EAAD,CAAQ7I,QAnDY,KAC1B,GAAIi2H,EAAW,CACb,MAAMM,EAAenC,EAAQ77H,QAAOi8H,GAA0B,cAAhBA,EAAO/xF,OAAsB/2C,KAAI8oI,GAAUA,EAAOpvH,UAC1FoxH,EAAepC,EAAQ77H,QAAOi8H,GAA0B,aAAhBA,EAAO/xF,OAAqB/2C,KAAI8oI,GAAUA,EAAOpvH,UAC/FpD,EAAIgC,KAAJ,mBAAqBqZ,EAArB,SAAsC,CACpC,SAAY,CACV,UAAak5G,EACb,UAAaC,KAEdhzH,MAAKoB,IACNwjB,EAAa,CAACpK,OAAQpZ,EAAQjD,OAC9Bu6B,GAAQ,EAAR,IACCx4B,OAAMijH,GAAO/oH,EAAW+oH,IAC5B,MACCzqF,GAAQ,EACT,EAoC2CqW,UAAW0jF,EAAWr2H,MAAM,YAAlE,uBAIF,gBAACy8B,GAAA,EAAD,CACE/8B,KAAM42H,EACN,mBAAiB,2BAFnB,UAIE,eAAC35F,GAAA,EAAD,UACE,eAACwqE,GAAA,EAAD,CAAmBlsG,GAAG,2BAAtB,oEAIF,gBAAC2hC,GAAA,EAAD,WACE,eAAC3zB,GAAA,EAAD,CAAQ7I,QAAS,IAAMm2H,GAAqB,GAAQnvB,WAAS,EAA7D,oBACA,eAACn+F,GAAA,EAAD,CAAQ7I,QAvEW,KAC3Bm2H,GAAqB,GACrBj6F,GAAQ,EAAR,EAqEQ,iCAjCV,ECtRF,MAAM7zB,GAAYC,cAAWnI,IAAK,CAChClN,MAAO,CACL6V,WAAY3I,EAAMkH,QAAQ,IAE5BovH,OAAQ,CACNr8F,MAAO,OACPjB,UAAWh5B,EAAMkH,QAAQ,QA6NdqvH,OAzNmBj5H,IAAMoI,MAAM7G,IAAW,IAAD,oBACtD,MAAM,YAAC05G,EAAD,SAAcl4E,KAAayjE,GAAcjlG,GACzC,gBAACo7G,KAAoBuc,GAAmB1yB,EACxCllG,EAAUsJ,MACV,IAACrG,GAAO0E,MACR,WAAC9I,GAAcmD,MACd61H,EAAQC,GAAa5wH,wBAAS3W,IAC9B2V,EAAMiB,GAAWD,wBAAS3W,IAC1B6yG,EAAO20B,GAAY7wH,mBAAQ,OAACg+F,QAAD,IAACA,GAAD,UAACA,EAAY76G,aAAb,aAAC,EAAmB+4G,QAC/C7/F,EAAOkzH,GAAYvvH,mBAAS,KAC5Bub,EAAagvB,GAAkBvqC,mBAAS,KACxC8wH,EAAWC,GAAgB/wH,oBAAS,GACrCgxH,EAAW5wH,mBAAQ,iBAAsC,UAAhC,UAAAqyG,EAAYlpH,YAAZ,eAAkBsrB,UAAxB,GAA8C,CAAC49F,IAClE7gH,EAASwgD,YAAewgE,IACxB5lH,EAAQsxB,GAAgBm0F,GAAa,EAAd,OAAoB7gH,QAApB,IAAoBA,OAApB,EAAoBA,EAAQihH,UAEnDoe,EAActqH,uBAAaxjB,IAC/B,MAAMmiD,EAAWniD,EAAMmuB,cACjBg0B,EAASntC,WAAWkE,IAAiC,IAAvBkf,EAAYzzB,QAA2B,KAAVuU,GAC/DoyH,GAAW1yH,EAAKM,EAAOipC,GACpB/nC,KAAKgtC,GACL9sC,OAAMijH,IACL/oH,EAAW+oH,GACXn2E,EAAe,GAAf,IAGNglF,EAASjqF,GACTyrF,GAAa,EAAb,GACC,CAACh1H,EAAKpE,EAAY0E,EAAOkf,IAEtBwzC,EAAepoD,uBAAY,CAAC5U,EAAK5O,KACrC,GAAIo3C,EAAU,CACZ,IAAIpqB,EAAW,IAAIwgH,GACP,SAAR5+H,GACFw4C,EAAepnD,EAAQ,CAACA,GAAS,IAC7BA,GACFgtB,EAAQ,QAAR,OAAsBhtB,QAAtB,IAAsBA,OAAtB,EAAsBA,EAAOgc,QAC7BgR,EAAQ,WAAR,OAAyBhtB,QAAzB,IAAyBA,OAAzB,EAAyBA,EAAOyqI,WAChCz9G,EAAQ,UAAR,OAAwBhtB,QAAxB,IAAwBA,OAAxB,EAAwBA,EAAO0qI,UAC/B19G,EAAQ,YAAR,OAA0BhtB,QAA1B,IAA0BA,OAA1B,EAA0BA,EAAOsoI,YACjCt7G,EAAQ,oBAAR,OAAkChtB,QAAlC,IAAkCA,OAAlC,EAAkCA,EAAO+tI,2BAClC/gH,EAAQ,MACf0gH,OAASxnI,GACTunI,EAAUzgH,IAEVA,OAAW9mB,GAGTlG,EACFgtB,EAASpe,GAAO5O,SAETgtB,EAASpe,GAGpBwoC,EAASpqB,GAA6C,IAAjCne,OAAOK,KAAK8d,GAAUroB,OAAeqoB,OAAW9mB,EACtE,IACA,CAACsnI,EAAQp2F,IAEZr6B,qBAAU,KAAO,IAAD,EACG+iB,WACf,GAAI9jB,EAAS,CACX,MAAMqS,QAAczV,EAAI4yH,SAAS,CAACxvH,QAASA,IACvCqS,EAAM1pB,OAAS,GACjByiD,EAAe/4B,GACfvR,EAAQuR,EAAM,MAEd+4B,EAAe,IACftqC,OAAQ5W,GAEX,MACC4W,OAAQ5W,GACRkhD,EAAe,GAChB,EAGH4mF,CAAQ,UAACT,EAAgBvtI,aAAjB,aAAC,EAAuBgc,SAEC,kBAA7B,OAAO6+F,QAAP,IAAOA,OAAP,EAAOA,EAAY76G,QAAsB66G,EAAW76G,MAAM0F,SAAS,KACrEkT,EAAI4yH,SAAS,CAACzyB,MAAO8B,EAAW76G,QAC7Boa,MAAKiU,IACAA,EAAM1pB,OAAS,GACjBinE,EAAa,OAAQv9C,EAAM,IAC3B+4B,EAAe,CAAC/4B,EAAM,MAEtB+4B,EAAe,GAChB,IAGLqmF,EAAS,OAAC5yB,QAAD,IAACA,OAAD,EAACA,EAAY76G,MACvB,GACA,CAAC4Y,EAAKgzD,EAAc2hE,EAAgBvtI,MAAO66G,EAAW76G,MAAOsvH,EAAYjyG,UAE5E,MAAM4wH,EAAezqH,uBAAaxjB,IAAUA,GAAQA,EAAM41B,MAAM,+BAAsC,IAEhGs4G,EAAoB1qH,uBAAaxjB,IACrC0tI,EAAS1tI,GACLiuI,EAAajuI,IACf4rE,EAAa,QAAS5rE,EACvB,GACA,CAAC4rE,EAAcqiE,IAEZE,EAAuBlxH,mBAAQ,IAAMkrC,mBAAS2lF,EAAa,MAAM,CAACA,IAElEM,EAAwB5qH,uBAAY,CAACwxB,EAAOh1C,KAC1Cg1C,GAASA,EAAM5uC,MAAuB,WAAf4uC,EAAM5uC,OAGnCwnI,GAAa,GACbO,EAAqBnuI,GAArB,GACC,CAACmuI,IAEEE,EACJ,eAAC,KAAD,CACEr/H,QAASopB,EACT8vC,eAAgB54D,GAAUA,EAAUA,EAAOg5H,YAAP,UAAwBh5H,EAAOnH,KAA/B,aAAwCmH,EAAOg5H,YAA/C,KAAgEh5H,EAAOnH,KAAQ,GACnHkiE,kBAAmB,CAAC/6D,EAAQtP,IAAUo4B,GAAep4B,GAASA,EAAMgc,SAAW1M,EAAO0M,UAAYhc,EAAMgc,QACxGmuD,cAAeikE,EACfh3F,SAAU,CAACpC,EAAOh1C,IAAU4rE,EAAa,OAAQ5rE,GACjDA,MAAO6b,GAAQuc,EAAY7wB,MAAK+H,GAAUA,EAAO0M,UAAYH,EAAKG,UAAWH,EAAO,KACpF0uD,YAAalxD,GACX,eAAC83G,GAAD,CACE96G,UAAWV,EAAQ03H,UACfh0H,EACJuvD,WAAa+kE,EAAY,CACvBhjE,aAAegjE,GAAa,eAAC9c,GAAA,EAAD,CAAgB7gF,SAAS,MAAzB,SAC1B,eAACyF,GAAA,EAAD,CAAkBj/B,MAAM,UAAUG,KAAM,QAExC0C,EAAOuvD,WACXrpD,QAAQ,SACR5I,KAAK,QACLunC,YAAY,uBACZtgC,OAAO,SACPssD,WAAS,KACL+mD,GAAc3B,GAClBzlH,MAAQgkI,EAAWhkI,EAAQ,iBAG/B,cAAY,uBAIhB,OAAO,eAAC,IAAM6T,SAAP,UACJmwH,EAAWQ,EACV,gBAAC1wH,GAAA,EAAD,CAAKoyB,UAAW,EAAGM,aAAc,EAAjC,UACE,eAAC0gB,GAAA,EAAD,CAAW35B,UAAU,SAArB,SACGvtB,IAEFwkI,EACD,eAACxwH,GAAA,EAAD,CAAYxH,UAAWV,EAAQ9L,MAAO0V,QAAS,UAA/C,SACG,kCAEH,eAAC4xG,GAAD,CACEtnH,MAAO,aACP0V,QAAQ,SACR5I,KAAK,QACLunC,YAAY,aACZsuF,WAAY,CAACj6D,WAAW,OAACsoC,QAAD,IAACA,GAAD,UAACA,EAAY76G,aAAb,QAAC,EAAmBgc,UAC5Chc,MAAK,OAAE66G,QAAF,IAAEA,GAAF,UAAEA,EAAY76G,aAAd,aAAE,EAAmByqI,WAC1BrzF,SAAUpC,GAAS42B,EAAa,aAAc52B,EAAMlnB,OAAO9tB,OAC3DkqE,WAAS,IAEX,eAACinD,GAAD,CACE96G,UAAWV,EAAQ03H,OACnBxjI,MAAO,YACP0V,QAAQ,SACR5I,KAAK,QACLunC,YAAY,YACZsuF,WAAY,CAACj6D,WAAW,OAACsoC,QAAD,IAACA,GAAD,UAACA,EAAY76G,aAAb,QAAC,EAAmBgc,UAC5Chc,MAAK,OAAE66G,QAAF,IAAEA,GAAF,UAAEA,EAAY76G,aAAd,aAAE,EAAmB0qI,UAC1BtzF,SAAUpC,GAAS42B,EAAa,YAAa52B,EAAMlnB,OAAO9tB,OAC1DkqE,WAAS,IAEX,eAACinD,GAAD,CACE96G,UAAWV,EAAQ03H,OACnBxjI,MAAO,cACP0V,QAAQ,SACR5I,KAAK,QACLunC,YAAY,cACZsuF,WAAY,CAACj6D,WAAW,OAACsoC,QAAD,IAACA,GAAD,UAACA,EAAY76G,aAAb,QAAC,EAAmBgc,UAC5Chc,MAAK,OAAE66G,QAAF,IAAEA,GAAF,UAAEA,EAAY76G,aAAd,aAAE,EAAmBsoI,YAC1BlxF,SAAUpC,GAAS42B,EAAa,cAAe52B,EAAMlnB,OAAO9tB,OAC5DkqE,WAAS,IAEX,eAACinD,GAAD,CACE96G,UAAWV,EAAQ03H,OACnBxjI,MAAO,QACP0V,QAAQ,SACR5I,KAAK,QACLunC,YAAY,gBACZsuF,WAAY,CAACj6D,WAAW,OAACsoC,QAAD,IAACA,GAAD,UAACA,EAAY76G,aAAb,QAAC,EAAmBgc,UAC5Chc,MAAO+4G,EACP3hE,SAAUpC,GAASk5F,EAAkBl5F,EAAMlnB,OAAO9tB,OAClD4U,OAAQq5H,EAAal1B,GACrBvuC,YAAayjE,EAAal1B,IAAU,0BACpC7uC,WAAS,IAEX,eAACinD,GAAD,CACE96G,UAAWV,EAAQ03H,OACnBxjI,MAAO,UACP0V,QAAQ,SACR5I,KAAK,QACLunC,YAAY,sBACZsuF,WAAY,CAACj6D,WAAW,OAACsoC,QAAD,IAACA,GAAD,UAACA,EAAY76G,aAAb,QAAC,EAAmBgc,UAC5Chc,MAAK,OAAE66G,QAAF,IAAEA,GAAF,UAAEA,EAAY76G,aAAd,aAAE,EAAmB+tI,oBAC1B32F,SAAUpC,GAAS42B,EAAa,sBAAuB52B,EAAMlnB,OAAO9tB,OACpEkqE,WAAS,QAhEjB,ICxJK,MAAMokE,GAAwBj6H,IAAMoI,MAAM7G,IAAW,IAAD,EACzD,MAAM,YAAC05G,EAAD,MAActvH,EAAd,SAAqBo3C,KAAayjE,GAAcjlG,EAChD69G,EAAaxC,GAAc3B,GAC3B7gH,EAASwgD,YAAewgE,IACxB5lH,EAAQsxB,GAAgBm0F,GAAa,EAAd,OAAoB7gH,QAApB,IAAoBA,OAApB,EAAoBA,EAAQihH,UAEnD9jD,EAAepoD,uBAAaxjB,IAC5Bo3C,GACFA,EAAmB,KAAVp3C,OAAekG,EAAYlG,EACrC,GACA,CAACo3C,IAEJ,OACE,eAAC25E,GAAD,IAAc0C,EAAY5pH,MAAOA,EAAjC,SACE,gBAACokD,GAAA,EAAD,WACE,eAAC8C,GAAA,EAAD,UAAYlnD,IACZ,eAACmnD,GAAA,EAAD,CAAYvrD,KAAG,EAAf,mBACG6pH,EAAYlpH,YADf,aACG,EAAkBqrB,UAAUnvB,KAAI41B,GAC/B,eAACoyB,GAAA,EAAD,CACEtqD,MAAOk4B,EACPqyB,QACE,eAAC0G,GAAA,EAAD,CACE9Z,QAASn3C,IAAUk4B,EACnBthB,QAAS,IAAMg1D,EAAa1zC,MACxB2iF,IAGRhxG,MAAOquB,GARWA,WAP9B,I,mECZF,MAAMjZ,GAAYC,cAAWnI,IAC3B,MAAMk2C,EAAaw7B,aAAM1xE,EAAMnE,QAAQ2/C,KAAK,KAAM,GAC5CrF,EAAWu7B,aAAM1xE,EAAMnE,QAAQ2/C,KAAK,KAAM,IAChD,MAAO,CACL/+C,KAAM,CACJw9B,MAAO,OACPC,OAAQ,QAEVs9F,eAAgB,CACdv9F,MAAO,OACPC,OAAQ,OACRjB,SAAU,YAEZw+F,eAAgB,CACdx9F,MAAO,OACPC,OAAQ,OACRkmC,UAAW,SACXjkE,UAAW,cAEbu7H,WAAY,CACVrgF,OAAQ,EACRpe,SAAU,WACVgB,MAAO,OACPC,OAAQ,SACRS,WAAY+2C,aAAM1xE,EAAMnE,QAAQ8+B,WAAWr0B,QAAS,IACpD3F,QAAS,OACTwG,WAAY,SACZm3B,eAAgB,SAChB06B,cAAe,QAEjB2+D,SAAU,CACRh9F,WAAW,yBAAD,OAA2Bwb,EAA3B,gBAA2CD,EAA3C,UACVkB,OAAQ,GAEVwgF,WAAY,CACVC,UAAU,aAAD,OAAe73H,EAAMnE,QAAQ2/C,KAAK,MAC3C7gB,WAAW,yBAAD,OAA2Bub,EAA3B,gBAA6CC,EAA7C,UACVjX,IAAK,GAlCT,IAsCI44F,GAAkB3vH,cAAYnI,IAAD,CACjC+3H,UAAW,CACT33D,UAAW,SACX,uBAAwB,CACtBz/D,QAAS,QAEX,qBAAsB,OACtBs0D,eAAgB,YAId+iE,GAAa16H,IAAMoI,MAAK,IASvB,IATwB,SAC7BuyH,EAD6B,UAE7BF,EAF6B,MAG7BG,EAH6B,OAI7B9uB,EAJ6B,UAK7B9pG,EAL6B,QAM7BV,EAN6B,SAO7BD,EACA,cAAe+zC,GACX,EACJ,MAAMylF,EAAUvyG,oBACV,OAAEsU,EAAF,IAAU1Z,GAAQw6B,gBAClB,aAAE1L,GAAiBE,MAClB4oF,EAAeC,GAAoBvyH,oBAAS,IAC5CwyH,EAAOC,GAAYzyH,oBAAS,IAC5B0yH,EAAUC,GAAe3yH,oBAAS,GACnC/F,EAASmI,GAAU,CAACtJ,QAASA,IAC7B85H,EAAeZ,GAAgB,CAACl5H,QAAS,CAACm5H,UAAS,OAAEn5H,QAAF,IAAEA,OAAF,EAAEA,EAASm5H,aAoCpE,OAhCA/xH,qBAAU,KACR,MAAM8/E,EAAO,OAAGqyC,QAAH,IAAGA,OAAH,EAAGA,EAASriH,QACzB,GAAIgwE,EAAS,CACX,MAAMviB,EAAeuiB,EAAQviB,aAAeuiB,EAAQ6yC,aAEpDN,EADoB90D,EAAe,EAEpC,IACA,CAACrpC,EAAQoV,IAGZtpC,qBAAU,KACR,MAAM8/E,EAAO,OAAGqyC,QAAH,IAAGA,OAAH,EAAGA,EAASriH,QAEzB,SAAS8iH,IACP,MAAMr1D,EAAeuiB,EAAQviB,aAAeuiB,EAAQ6yC,aAC9CvhF,EAAS1rD,KAAK2oF,MAAMyR,EAAQriB,YAAcF,EAC1CrkC,EAAMxzC,KAAK2oF,MAAMyR,EAAQriB,YAAc,EAC7C80D,EAASr5F,GAAO,MAChBu5F,EAAYrhF,GAAU,MAClBA,GAAU6gF,GACZA,GAEH,CAED,GAAInyC,EAEF,OADAA,EAAQn2C,iBAAiB,SAAUipF,GAAsB,GAClD,WACL9yC,EAAQl2C,oBAAoB,SAAUgpF,GAAsB,EAC7D,CACF,GACA,CAACX,IAEG,sBAAK34H,UAAW+iC,mBAAK/iC,EAAWS,EAAOtD,MAAO,cAAai2C,EAA3D,SACL,uBAAKpzC,UAAW+iC,mBAAKtiC,EAAOy3H,gBAA5B,UACIU,GAASE,IAAkBE,GAAU,sBAAKh5H,UAAW+iC,mBAAKtiC,EAAO23H,WAAY33H,EAAO63H,YAA/C,SACrC,eAAC,KAAD,CAAgBn4H,MAAM,aAExB,sBAAK+gB,IAAK23G,EAAS74H,UAAW+iC,mBAAKtiC,EAAO03H,gBAAiBM,GAAaW,EAAaX,WAArF,SACE,uBAAKv3G,IAAKA,EAAV,UACG7hB,EACAyqG,OAGH8uB,GAASE,IAAkBI,GAAa,sBAAKl5H,UAAW+iC,mBAAKtiC,EAAO23H,WAAY33H,EAAO43H,UAA/C,SACxC,eAAC,KAAD,CAAgBl4H,MAAM,iBAZ5B,IA6BFu4H,GAAW9xF,aAAe,CACxB6xF,WAAW,EACXG,OAAO,GAGMF,UCzIf,MAAM9vH,GAAYC,cAAYnI,IACrB,CACLvD,KAAM,CAAC,EAEPk8C,SAAU,CACR1e,MAAO,SAET4+F,QAAS,CACPhyH,OAAQ7G,EAAMkH,QAAQ,GACtB8xB,UAAWh5B,EAAMkH,QAAQ,QAuChB4xH,OAnCQx7H,IAAMoI,MAAK,IAI3B,IAJ4B,UACjCpG,EADiC,QAEjCV,EACA,cAAe8zC,GACX,EACJ,MAAM3yC,EAASmI,GAAUtJ,IACnB,uBACJulD,EADI,0BAEJC,GACEvQ,MACGklF,EAAqBC,GAA0B,CAAC70E,IAA0BC,KAE3E60E,EAAoBxsH,uBAAY,CAACwxB,EAAOh1C,KAC5C+vI,EAAuB/vI,EAAvB,GACC,CAAC+vI,IAEJ,OAAO,sBAAK15H,UAAW+iC,mBAAKtiC,EAAOtD,KAAM6C,GAAY,cAAaozC,EAA3D,SACL,eAACW,GAAA,EAAD,UACE,eAACE,GAAA,EAAD,CACEC,QAAS,eAACtT,GAAA,EAAD,CACPE,QAAS24F,EACT14F,SAAU44F,IAEZnmI,MAAM,gCAPZ,ICNK,MAAMomI,GAAoB57H,IAAMC,gBACjC47H,GAAoB,IACbC,GAAqB,IAG5BC,GAA+BlxH,cAAWnI,IACvC,CACLvD,KAAM,CACJ6kC,WAAYthC,EAAMkH,QAAQ,KAC1BszB,aAAcx6B,EAAMkH,QAAQiyH,IAC5Bv/F,YAAa55B,EAAMkH,QAAQiyH,KAE7B58F,MAAO,CACL57B,QAAS,OACTwG,WAAY,SACZ5K,SAAU,UACVy8B,WAAY,EACZM,cAAe,OAIRggG,GAAsBh8H,IAAMoI,MAAK,IAIvC,IAJwC,MAC7C62B,EAD6C,QAE7C8C,EAF6C,UAG7C//B,GACI,EACJ,MAAMS,EAASs5H,KACf,OAAO,sBAAK/5H,UAAW+iC,mBAAK/iC,EAAWS,EAAOtD,MAAvC,SACL,gBAACi1C,GAAD,WACE,eAACM,GAAD,UACE,eAAClrC,GAAA,EAAD,CAAYxH,UAAWS,EAAOw8B,MAAO/zB,QAAQ,WAA7C,SAAyD+zB,MAE1D8C,MALL,IAkBIk6F,GAA4BpxH,cAAWnI,IACpC,CACLvD,KAAM,CACJy9B,OAAQl6B,EAAMkH,QAAQ,GACtBq6B,cAAevhC,EAAMkH,QAAQ,KAC7Bo6B,WAAYthC,EAAMkH,QAAQ,IAC1B0yB,YAAa55B,EAAMkH,QAAQiyH,IAC3B3+F,aAAcx6B,EAAMkH,QAAQiyH,IAC5Bx4H,QAAS,OACT09B,cAAe,SACfC,eAAgB,UAElB/B,MAAO,CACL57B,QAAS,OACTwG,WAAY,SACZ5K,SAAU,eAIHi9H,GAAmBl8H,IAAMoI,MAAK,IAKpC,IALqC,MAC1C62B,EAD0C,QAE1C8C,EAF0C,UAG1C//B,EACA,cAAeozC,GACX,EACJ,MAAM3yC,EAASw5H,KACf,OAAO,sBAAKj6H,UAAW+iC,mBAAK/iC,EAAWS,EAAOtD,MAAO,cAAai2C,EAA3D,SACL,gBAAChB,GAAD,WACE,eAACM,GAAD,UACE,eAAClrC,GAAA,EAAD,CAAYxH,UAAWS,EAAOw8B,MAAO/zB,QAAQ,SAA7C,SAAuD+zB,MAExD8C,MALL,IAmBIo6F,GAAsBtxH,cAAWnI,IAE9B,CACLvD,KAAM,CACJN,UAAW,aACXwE,QAAS,OACTs4B,SAAU,WACVoF,cAAe,SACfpE,MAAM,GAAD,OAPK,GAOL,OACLC,OAAQ,OACR,oBAAqB,OACrB2hB,UAAW,OACXikE,WAAY,kBACZ4Z,WAAY,aAEd10D,UAAW,CACT,oBAAoB,eAApB,OAAoC/qC,KAApC,QACA4hB,UAAU,eAAD,OAAiB5hB,KAAjB,aAKF0/F,GAAar8H,IAAMoI,MAAK,IAS9B,IAT+B,SACpCyH,EADoC,iBAEpCysH,EAFoC,KAGpCz6H,EAHoC,aAIpC06H,EAJoC,UAKpC70D,EALoC,kBAMpC80D,EANoC,UAOpCx6H,EAPoC,SAQpCX,GACI,EACJ,MAAMoB,EAAS05H,MACR75H,EAAM6vC,GAAW3pC,mBAAS,KAE3B+uD,EAAepoD,uBAAawJ,IAE9B4jH,EADE5jH,IAAa9I,GAGFH,KAAQA,IAEvB4sH,GAAoBA,EAAiB3jH,EAArC,GACC,CAAC9I,EAAUysH,EAAkBC,IAEhC,OAAO,sBAAKv6H,UAAW+iC,mBAAK/iC,EAAWS,EAAOtD,KAAMuoE,GAAajlE,EAAOilE,WAAjE,SACL,eAACk0D,GAAkBp6H,SAAnB,CAA4B7V,MAAO,CACjCkkB,SAAUA,EACVkzB,SAAUw0B,EACV11D,KAAMA,EACN06H,aAAcA,EACdj6H,KAAMA,EACNm6H,aAActqF,EACdu1B,UAAWA,EACX80D,kBAAmBA,GARrB,SAUGn7H,KAXL,IA0BIq7H,GAA2B7xH,cAAWnI,IACnC,CACLvD,KAAM,CACJN,UAAW,aACXwE,QAAS,OACT09B,cAAe,SACfpE,MAAO,OACPC,OAAQ,OACRh+B,gBAAiB8D,EAAMnE,QAAQ8+B,WAAWC,MAC1Cyc,OAAQ,GAEV4iF,mBAAoB,CAClBt5H,QAAS,OACTwG,WAAY,SACZ8xB,SAAU,WACVuI,MAAO,UACPtC,IAAK,SACLhF,OAAO,GAAD,OAAKk/F,GAAL,OACNv9E,UAAW,iBAEblF,KAAM,CACJ1d,SAAU,WACVuI,MAAO,EACPtC,IAAK,EACLkY,OAAQ,EACR4Y,KAAM,EACN7zD,UAAW,cAEb+9H,WAAY,CACVC,UAAU,mBAAD,OAAqBn6H,EAAMnE,QAAQ6D,OAAOyN,WAErDlG,QAAS,CACPs6B,cAAc,GAAD,OAAKvhC,EAAMkH,QAAQ,KAAnB,OAEfoB,OAAQ,CACNlB,YAAa,EACb,oBAAqB,OACrBy0C,UAAW,OACXikE,WAAY,kBACZ4Z,WAAY,aAEd1O,OAAQ,CACNrqH,QAAS,QAEXw4B,SAAU,CACRA,SAAU,WAEZhjB,KAAM,CACJmrB,WAAY,GAEdk9B,UAAW,CACT79D,QAAS,OACT09B,cAAe,SACfnE,OAAQ,QAEVxY,QAAS,CACPijB,KAAM,EACNgyD,UAAW,GAEbyjC,iBAAkB,CAChB94F,WAAYthC,EAAMkH,QAAQ,IAC1B0yB,YAAa55B,EAAMkH,QAAQiyH,IAC3B3+F,aAAcx6B,EAAMkH,QAAQiyH,SAIrBkB,GAAkB/8H,IAAMoI,MAAK,IAGnC,IAHoC,UACzCpG,EADyC,SAEzCX,GACI,EAEJ,MAAMoB,EAASi6H,MACT,KAAE76H,EAAF,aAAQ06H,EAAR,UAAsB70D,EAAtB,kBAAiC80D,GAAsBj5H,qBAAWq4H,KACjEl0F,EAAUC,GAAe3nC,IAAMwI,SAAS,MACzCmzC,EAAiB5+B,QAAQ2qB,GAGzBwU,EAAW/sC,uBAAawxB,IAC5BgH,EAAYhH,EAAMkH,cAAlB,GACC,IACGsU,EAAYhtC,uBAAY,KAC5Bw4B,EAAY,KAAZ,GACC,IAOH,OAAO,uBAAK3lC,UAAW+iC,mBAAK/iC,EAAWS,EAAOtD,MAAvC,UACL,sBAAK6C,UAAW+iC,mBAAKtiC,EAAO42C,KAAMx3C,GAAQY,EAAOm6H,WAAYl1D,GAAajlE,EAAOirH,QAAjF,SACE,uBAAK1rH,UAAWS,EAAOy+D,UAAvB,UACE,eAAC86D,GAAD,IACA,eAACE,GAAD,CACEj9F,MAAM,UACN8C,QAAS,uCACP,eAAC8S,GAAD,CACE91C,QAAS,mBACTwD,QAAS,KACPi6H,GAAkB9sH,IAAQA,IAC1B6sH,GAAa,EAAb,EAJJ,SAQE,eAAC,KAAD,CAAet9H,SAAS,YAE1B,eAAC41C,GAAD,CACE91C,QAAQ,UACRwD,QAAS25C,EAFX,SAIE,eAAC,KAAD,CAAUj9C,SAAS,YAErB,eAACk8C,GAAA,EAAD,CACEzT,SAAUA,EACV7lC,KAAM85C,EACNx6C,QAASg7C,EACTK,mBAAoB,KACpB96C,aAAc,CAAEC,SAAU,SAAUC,WAAY,SAChDmmC,gBAAiB,CAAEpmC,SAAU,MAAOC,WAAY,SAChD66C,aAAW,EAPb,SASE,+BACE,eAAC,GAAD,aAKR,sBAAKz6C,UAAWS,EAAO2hB,QAAvB,SACE,eAAC,GAAD,UACE,uBAAKpiB,UAAWS,EAAOkH,QAAvB,UACE,eAACy7F,GAAA,EAAD,IACA,eAACp9D,GAAA,EAAD,CAAME,OAAK,EAAClmC,UAAWS,EAAOoW,KAA9B,SACGxX,gBAOb,uBAAKW,UAAW+iC,oBAAM2iC,GAAajlE,EAAOirH,QAA1C,UACE,eAACt5E,GAAD,CAASpyC,UAAWS,EAAOq6H,iBAA3B,SACGp1D,GAAa,eAAC7yB,GAAD,CACZ91C,QAAS,mBACTwD,QAAS,KACPi6H,GAAkB,EAAlB,EAEFx6H,UAAWS,EAAOuI,OALN,SAOZ,eAAC,KAAD,CAAkB/L,SAAS,cAG/B,eAACuK,GAAA,EAAD,CACExH,UAAW+iC,mBAAKtiC,EAAOu6H,WAAYv6H,EAAOk6H,oBAC1CzxH,QAAQ,SAFV,0BA9DJ,IA+EI+xH,GAA0BpyH,cAAWnI,IAClC,CACLvD,KAAM,CACJk6F,UAAU,GAAD,OAJI,IAIJ,QAEX7jG,MAAO,CACLi1H,cAAe,cAEjByS,SAAU,CACRC,SAAU,OACV3oF,SAAU,UAEZikC,MAAO,CACLptE,WAAY3I,EAAMkH,QAAQ,GAC1B3K,SAAU,UAEZm+H,QAAS,CACP9gG,YAAa55B,EAAMkH,QApBN,GAqBbszB,aAAcx6B,EAAMkH,QApBN,OAsBhByzH,SAAU,CACR1hG,SAAU,WACViB,OAAO,GAAD,OAvBO,IAuBP,QAERmF,QAAS,CACP1+B,QAAS,OACT09B,cAAe,SACfzE,YAAa55B,EAAMkH,QA9BN,GA+BbszB,aAAcx6B,EAAMkH,QA9BN,OAgChBozB,QAAS,CACPL,MAAO,OACP/9B,gBAAiB8D,EAAMnE,QAAQ2/C,KAAK,UAI7Bo/E,GAAiBt9H,IAAMoI,MAAK,IAOlC,IAPmC,GACxChL,EADwC,MAExC5H,EAFwC,QAGxC+M,EAHwC,QAIxCw/B,EAJwC,cAKxCw7F,EALwC,MAMxCprG,GACI,EACJ,MAAM1vB,EAASw6H,KACTv6H,EAAQy6C,gBACR,SAAEttC,EAAF,KAAYhO,EAAZ,SAAkBkhC,GAAax/B,qBAAWq4H,IAC1Cz6F,EAAco8F,OAAgB1rI,EAAa0Q,GAAWwgC,EACtDy6F,EAAS37H,GAAQzE,IAAOyS,EAE9B,OAAO,uBAAK7N,UAAWS,EAAOtD,KAAvB,WACH3J,GAAS2rC,IACX,gBAAC8G,GAAA,EAAD,CACEj9B,SAAUm2B,EACVn/B,UAAWS,EAAO46H,SAClB/7H,QAAS,CAAC87H,QAAS36H,EAAO26H,SAC1B76H,QAAS4+B,GAAW,KAAWA,EAAY/jC,IAJ7C,UAMG5H,GAAS,eAAC6yC,GAAA,EAAD,CACRnmC,MAAO,CAACmJ,WAAY3I,EAAMkH,QA/Dd,IA+DsBuoB,IAClCgmC,uBAAwB,CACtBh2D,MAAOq7H,EAAS,UAAY,UAC5Bx7H,UAAWS,EAAOjN,OAEpBgJ,QAAShJ,EACT,wCAAgC4H,KAEjC+jC,GAAe,eAACkvF,GAAA,EAAD,CAAcruH,UAAWS,EAAOy6H,SAAhC,SACd,eAAC,KAAD,CAAkB/6H,MAAOq7H,EAAS,UAAY,SAAUx7H,UAAWS,EAAOg2E,aAG7E12C,GAAW,sBACV//B,UAAWS,EAAOs/B,QAClB7/B,MAAO,CAACmJ,WAAY3I,EAAMkH,QA7EZ,IA6EoBuoB,IAFxB,SAIT4P,IAEH,eAACqjE,GAAA,EAAD,CAASpjG,UAAWS,EAAOu6B,YA3B7B,IAuCFsgG,GAAe10F,aAAe,CAC5BzW,MAAO,GAGT,MAAMsrG,GAA0B5yH,cAAWnI,IAKlC,CACLvD,KAAM,CACJ46C,OAAQ,EACR12C,QAAS,OACT09B,cAAe,SACfpF,SAAU,WACVuI,MAAO,EACPtC,IAAK,EACLkY,OAAQ,EACRnd,MAAM,GAAD,OAVO,GAUP,OACL/9B,gBAAiB8D,EAAMnE,QAAQ8+B,WAAWC,MAC1C,oBAAqB,OACrBihB,UAAW,OACXikE,WAAY,kBACZ/8E,SAAU,EACV5mC,UAAW,aACXu9H,WAAY,aAEd10D,UAAW,CACTrkE,QAAS,QAEXq6H,WAAY,CACV,oBAAoB,cAApB,OA1BW,GA0BX,QACAn/E,UAAU,cAAD,OA3BE,GA2BF,SAEXo/E,WAAY,CACV,oBAAoB,cAApB,OA7BW,GA6BX,QACAp/E,UAAU,cAAD,OA9BE,GA8BF,SAEXq/E,WAAY,CACV,oBAAoB,cAApB,OAhCW,GAgCX,QACAr/E,UAAU,cAAD,OAjCE,GAiCF,SAEXs/E,YAAa,CACX,oBAAoB,cAApB,OAnCY,GAmCZ,QACAt/E,UAAU,cAAD,OApCG,GAoCH,SAEXlF,KAAM,CACJ1d,SAAU,WACVuI,MAAO,EACPtC,IAAK,EACLkY,OAAQ,EACRj7C,UAAW,aACXwE,QAAS,OACT09B,cAAe,UAEjB3c,QAAS,CACPijB,KAAM,EACNgyD,UAAW,GAEbykC,MAAO,CACLnhG,MAAM,GAAD,OAvDM,GAuDN,QAEPohG,MAAO,CACLphG,MAAM,GAAD,OAzDM,GAyDN,QAEPqhG,MAAO,CACLrhG,MAAM,GAAD,OA3DM,GA2DN,QAEPshG,OAAQ,CACNthG,MAAM,GAAD,OA7DO,GA6DP,QAEP3xB,OAAQ,CACNlB,YAAa,OAKNo0H,GAAiBl+H,IAAMoI,MAAK,IAElC,IAAD,QAFoC,SACxC/G,GACI,EACJ,MAAM,WAAE8lD,GAAe5Q,KACjB4nF,EAAQ,UAAGh3E,WAAH,iBAAG,EAAcx9B,kBAAjB,aAAG,EAA0B2V,MACrC78B,EAASg7H,MACT,KAAE57H,EAAF,aAAQ06H,EAAR,KAAsBj6H,EAAtB,UAA4BolE,GAAcnkE,qBAAWq4H,KACpDwC,EAAWC,GAAkB,CAClCpnI,EAAG,CAACwL,EAAOq7H,MAAOr7H,EAAOi7H,YACzBY,EAAG,CAAC77H,EAAOs7H,MAAOt7H,EAAOk7H,YACzB5vI,EAAG,CAAC0U,EAAOu7H,MAAOv7H,EAAOm7H,YACzB/xF,GAAI,CAACppC,EAAOw7H,OAAQx7H,EAAOo7H,cAC3Bv7H,GAEF,OAAO,eAAC22F,GAAA,EAAD,CACLh9B,UAAW,EACXj6D,UAAW+iC,mBAAKtiC,EAAOtD,KAAM0C,GAAQw8H,GAFhC,SAIL,uBAAKr8H,UAAW+iC,mBAAKtiC,EAAO42C,KAAM+kF,EAAW12D,GAAajlE,EAAOilE,WAAjE,UACE,eAACs0D,GAAD,CACE/8F,MAAO5kC,gBAAM8jI,GAAY,aAAe5/G,GAAU,SAAU4/G,GAAU,GACtEp8F,QAAS,eAAC8S,GAAD,CACP91C,QAAQ,gBACRwD,QAAS,KAAQg6H,GAAa,EAAb,EACjBv6H,UAAWS,EAAOuI,OAHX,SAKP,eAAC,KAAD,CAAe/L,SAAS,cAG5B,sBAAK+C,UAAWS,EAAO2hB,QAAvB,SACG/iB,QAhBP,IA0BIk9H,GAAyB1zH,cAAWnI,IAAK,CAC7CvD,KAAM,CACJw9B,MAAO,OACPC,OAAQ,OACRv5B,QAAS,OACT09B,cAAe,UAEjB2sF,OAAQ,CACNrqH,QAAS,QAEXsG,QAAS,CACPs6B,cAAevhC,EAAMkH,QAAQ,KAC7B0yB,YAAa55B,EAAMkH,QAAQiyH,IAC3B3+F,aAAcx6B,EAAMkH,QAAQiyH,KAE9Bz3G,QAAS,CACPijB,KAAM,EACNgyD,UAAW,OAIFmlC,GAAgBx+H,IAAMoI,MAAK,IAMjC,IANkC,GACvChL,EADuC,MAEvC5H,EAFuC,KAGvC8M,EAHuC,QAIvCy/B,EAJuC,SAKvC1gC,GACI,EACJ,MAAMoB,EAAS87H,MACT,SAAE1uH,EAAF,aAAY4sH,GAAiBl5H,qBAAWq4H,IACxC/kF,EAAUz5C,IAAOyS,EAOvB,OANAnH,qBAAU,KACJmuC,GACF4lF,EAAan6H,EACd,GACA,CAACA,EAAMu0C,EAAS4lF,IAEZ,uBAAKz6H,UAAW+iC,mBAAKtiC,EAAOtD,MAAO03C,GAAWp0C,EAAOirH,QAArD,UACL,eAACwO,GAAD,CAAkBj9F,MAAOzpC,EAAOusC,QAASA,EAAS,2CAAmC3kC,KACrF,sBAAK4E,UAAWS,EAAO2hB,QAAvB,SACE,eAAC,GAAD,UACG/iB,QAJP,IAgBFm9H,GAAc51F,aAAe,CAC3BtmC,KAAM,KClmBR,MACMm8H,GAAqB5zH,cAAWnI,IAAK,CACzCvD,KAAM,CACJm9B,YAAa55B,EAAMkH,QAAQ80H,GAC3BxhG,aAAcx6B,EAAMkH,QAAQ80H,QAGzB,SAASC,GAAT,GAAgC,IAAb,SAACt9H,GAAW,EACpC,MAAMoB,EAASg8H,KACf,OAAO,sBAAKz8H,UAAWS,EAAOtD,KAAvB,SACL,eAAC4hE,GAAA,EAAD,CAAMG,WAAS,EAACt3D,QAVK,EAUsB1H,MAAO,CAACw5B,UAAW,GAA9D,SACGr6B,KAGN,CASD,MAAMu9H,GAAyB/zH,cAAWnI,IAAK,CAC7CvD,KAAM,CACJ68B,aAAct5B,EAAMkH,QAAQ80H,IAE9Bt6G,QAAS,CACPkY,YAAa55B,EAAMkH,QAAQ80H,IAC3BxhG,aAAcx6B,EAAMkH,QAAQ80H,KAE9B1hG,QAAS,CACP3xB,WAAY3I,EAAMkH,SAAQ,GAC1BE,YAAapH,EAAMkH,SAAQ,GAC3B8xB,UAAWh5B,EAAMkH,SAAQ,GACzBoyB,aAAct5B,EAAMkH,QAAQ80H,IAC5B9/H,gBAAiB8D,EAAMnE,QAAQ2/C,KAAK,UAGjC,SAAS2gF,GAAT,GAAuD,IAAhC,QAACv9H,EAAD,SAAUD,KAAag3D,GAAQ,EAC3D,MAAM51D,EAASm8H,GAAuB,CAACt9H,QAASA,IAChD,OAAO,gBAACy/D,GAAA,EAAD,CAAMl9C,MAAI,KAAKw0C,EAAOr2D,UAAWS,EAAOtD,KAAxC,UACL,eAACimG,GAAA,EAAD,CAASpjG,UAAWS,EAAOu6B,UAC3B,sBAAKh7B,UAAWS,EAAO2hB,QAAvB,SACG/iB,MAGN,CAODw9H,GAAcj2F,aAAe,CAAC,ECxD9B,MAAMh+B,GAAYC,cAAWnI,IAAK,CAChCvD,KAAM,CACJw9B,MAAO,OACPt5B,QAAS,OACTwG,WAAY,aACZm3B,eAAgB,SAChBD,cAAe,SACfliC,UAAW,kBA0DAigI,OAnDO9+H,IAAMoI,MAAK,IAQ1B,IAR2B,SAChCL,EADgC,MAEhCvS,EAFgC,YAGhCyO,EAHgC,aAIhCuuC,EAJgC,UAKhCxwC,EALgC,QAMhCV,EACA,cAAe8zC,GACX,EACJ,MAAM1yC,EAAQy6C,eACR16C,EAASmI,GAAU,CAACtJ,QAASA,EAASoB,MAAOA,KAC7C,WAACk9B,EAAD,eAAaslB,EAAb,gBAA6BL,GAAmBtO,MAC/Cz7C,EAAQw8D,GAAapS,EAAen9C,GACrCkqD,EAAepN,EAAgB98C,GAG/BiF,EAAM4yB,EAAW73B,GACjBq1C,EAAYn5C,IAAW,OAAI+I,QAAJ,IAAIA,OAAJ,EAAIA,EAAK/I,cAAe,GAC/Co5C,EAAa7nD,IAAK,OAAIwX,QAAJ,IAAIA,OAAJ,EAAIA,EAAKxX,OAC3BqkE,GAAUx/D,gBAAM43D,IAAiBjlD,EAAIu9B,OACrCv3C,EAAMg/D,GAAShlD,EAAKlS,EAAQm3D,EAAczf,GAE1C+kB,EAAepoD,uBAAY,CAACwxB,EAAOh1C,KACvC2rE,EAAU3rE,EAAV,GACC,CAAC2rE,IAEJ,OAAO,sBAAKt1D,UAAW+iC,mBAAK/iC,EAAWS,EAAOtD,MAAO,cAAai2C,EAA3D,SACL,eAAClW,GAAA,EAAD,CAASD,MAAOme,EAAhB,SACE,eAACnH,GAAA,EAAD,CACEC,QAAS,eAACtT,GAAA,EAAD,CACPzgC,MAAM,YACN2yC,SAAU+kB,EACV/2B,QAAS9vC,EACT+vC,SAAUw0B,IAEZ/hE,MAAO,eAACgU,GAAA,EAAD,UAAa6zC,SAT1B,IA8BF,MAAM0hF,GAA8Bl0H,cAAWnI,IAAK,CAClDvD,KAAM,CACJ,kBAAmB,CACjB2K,aAAc,IAGlBosC,QAAS,CACPvsC,QAAS,OAGAq1H,GAAqBh/H,IAAMoI,MAAK,IAOtC,IAPuC,SAC5CL,EAD4C,YAE5C9D,EAF4C,MAG5CtY,EAH4C,UAI5CqW,EAJ4C,QAK5CV,EACA,cAAe8zC,GACX,EACJ,MAAM1yC,EAAQy6C,eACR16C,EAASs8H,GAA4B,CAACz9H,QAASA,EAASoB,MAAOA,KAC/D,WAACk9B,EAAD,eAAaslB,GAAkB3O,MAC9Bz7C,EAAQw8D,GAAapS,EAAen9C,GAGrCiF,EAAM4yB,EAAW73B,GACjBq1C,EAAYn5C,IAAW,OAAI+I,QAAJ,IAAIA,OAAJ,EAAIA,EAAK/I,cAAe,GAE/CszD,EAAepoD,uBAAY,KAC/BmoD,GAAU5nD,IACR,MAAMiJ,EAAWjJ,EAAM,IAAIlD,IAAIkD,GAAO,IAAIlD,IAE1C,OADAmM,EAASlM,IAAI9gB,GAASgtB,EAAS3R,OAAOrb,GAASgtB,EAASpiB,IAAI5K,GACrDgtB,CAAP,GAHF,GAKC,CAAC2+C,EAAW3rE,IAEf,OAAO,sBAAKqW,UAAW+iC,mBAAK/iC,EAAWS,EAAOtD,MAAO,cAAai2C,EAA3D,SACL,eAAClW,GAAA,EAAD,CAASD,MAAOme,EAAhB,SACE,eAACxa,GAAA,EAAD,CACEzgC,MAAM,YACN2gC,UAAShoC,GAASA,EAAO2R,IAAI9gB,GAC7Bo3C,SAAUw0B,EACVv1D,UAAWS,EAAOyzC,QAClB5zC,KAAK,aAPX,ICrGI28H,GAAmBp0H,cAAWnI,IAAK,CACvCpQ,KAAM,CACJ8L,WAAYsE,EAAMxE,WAAWE,WAC7BtH,KAAM4L,EAAMnE,QAAQjM,KAAK0W,QACzB6/D,WAAY,OACZnN,cAAe,QAEjBwjE,KAAM,CACJ1c,WAAY,iBACZ1+E,OAAQ,UACR,UAAW,CACThpC,OAAQ,8CAGZqkI,aAAc,CACZr7F,OAAQ,OACR,UAAW,CACThpC,OAAQ,UAGZtF,MAAO,CACLyJ,SAAU,OACVD,WAAY,KAEdxT,OAAQ,CACNyT,SAAU,WAEZwf,MAAO,CACLxf,SAAU,eAIRmgI,GAAUp/H,IAAMoI,MAAK,IAapB,IAbqB,EAC1B5Y,EAD0B,EAE1B2wD,EAF0B,MAG1BxjB,EAH0B,OAI1BC,EAJ0B,QAK1B4rD,EAL0B,SAM1B34E,EAN0B,SAO1BilC,EAP0B,QAQ1BvyC,EAR0B,kBAS1Bi5C,EAT0B,IAU1B1V,EAV0B,MAW1BrnB,EAX0B,MAY1BzF,GACI,EACJ,MAAMvW,EAASw8H,KACTv8H,EAAQy6C,eACRlG,EAASruC,mBAAQ,IAAMouC,GAAUh+B,EAAO,CAAC,EAAG8sB,GAAM,CAAC,GAAK,KAAK,CAAC9sB,EAAO8sB,IACrEu5F,EAAaz2H,mBAAQ,IAAM0T,GAAcmC,GAAS,IAAI,CAACA,IACvD6gH,EAAa12H,mBAAQ,IAAMquC,EAAOx4B,IAAQ,CAACA,EAAOw4B,IAClD2iB,EAAgB9kB,IAAajlC,EAC7B1N,EAAQ0N,EACVnN,EAAMnE,QAAQE,UAAUhB,KACxBq3C,EACE,OACA0G,EACE94C,EAAMnE,QAAQC,QAAQd,MACtB+lC,aAAQ/gC,EAAMnE,QAAQC,QAAQd,MAAO,EAAI4hI,GAC3CzmD,EAAcjf,EAChBl3D,EAAMnE,QAAQjM,KAAKwiD,SACnB,OACEyqF,EAAY1vH,EACd,QACAilC,EACEpyC,EAAMnE,QAAQjM,KAAKwiD,SACnBpyC,EAAMnE,QAAQjM,KAAK0W,QAEnBm4B,EAAchyB,uBAAY,KAC1ByqD,GACJr3D,GAAWA,GAAX,GACC,CAACA,EAASq3D,IAEb,OAAO,eAAC16B,GAAA,EAAD,CAASD,MAAOupD,EAAQ10F,KAAxB,SACL,+BACE,uBACE,cAAa00F,EAAQ10F,KACrBtE,EAAGA,EACH2wD,EAAGA,EACHxjB,MAAOA,EACPC,OAAQA,EACR+gC,OAAQkb,EACRjb,YAAa,EACb9mE,KAAMqL,EACNH,UAAW+iC,mBAAKtiC,EAAOy8H,KAAMtlE,GAAiBn3D,EAAO08H,cACrD58H,QAAS4+B,IAEX,uBACE3xC,EAAGA,EAAI,GAAMmtC,EACbwjB,EAAGA,EAAI,IAAOvjB,EACd9lC,KAAMyoI,EACNC,WAAW,SACXC,iBAAiB,SACjBz9H,UAAW+iC,mBAAKtiC,EAAOnQ,KAAMmQ,EAAOjN,OANtC,SAM+CgzF,EAAQ33F,SAEvD,uBACErB,EAAGA,EAAI,IAAOmtC,EACdwjB,EAAGA,EAAI,IAAOvjB,EACd9lC,KAAMyoI,EACNC,WAAW,QACXC,iBAAiB,UACjBz9H,UAAW+iC,mBAAKtiC,EAAOnQ,KAAMmQ,EAAOjX,QANtC,SAMgDg9F,EAAQh9F,UAEtDgwD,GAAqB,uBACrBhsD,EAAGA,EAAI,IAAOmtC,EACdwjB,EAAGA,EAAI,IAAOvjB,EACd9lC,KAAMyoI,EACNC,WAAW,MACXC,iBAAiB,OACjBz9H,UAAW+iC,mBAAKtiC,EAAOnQ,KAAMmQ,EAAOjX,QANf,SAMyB6zI,QApCpD,IA4DIK,GAAyB70H,cAAWnI,IAAK,CAC7CvD,KAAM,CACJk6F,UAAW,EACX5zD,SAAU,EACV9I,MAAO,OACPC,OAAQ,OACRjB,SAAU,YAEZulC,UAAW,CACTvlC,SAAU,WACViG,IAAKl/B,EAAMkH,SAAS,IACpB8oD,KAAM,MACNz1B,UAAW,cAGFrwC,GAAgBoT,IAAMoI,MAAK,IASjC,IATkC,SACvCL,EADuC,QAEvC8uC,EAFuC,MAGvC79B,EAHuC,SAIvC6mC,EAJuC,kBAKvCrE,EALuC,MAMvCmkF,EANuC,UAOvC39H,EACA,cAAeozC,GACX,EACJ,MAAM3yC,EAASi9H,MACT,OAAE9iG,EAAF,MAAUD,EAAV,IAAiBzZ,GAAQw6B,gBACzB,eAACwH,EAAD,OAAiBmB,EAAjB,uBAAyBQ,GAA0BtQ,KACnDklF,EAAsB50E,KACrB/rD,EAAQw8D,GAAapS,EAAen9C,GAErC8lC,EAAMwY,EAAOt+C,EAAU8uC,EAAS8oF,EADpB/2H,mBAAQ,MAAQ7W,KAAM,WAAW,KAE7C6tI,EAAkBh3H,mBAAQ,KAC9B,MAAMi3H,EAAkB,CAAC,EAEzB,OADG,OAAHhyF,QAAG,IAAHA,OAAA,EAAAA,EAAK3pC,OAAQ2pC,EAAI3pC,KAAKjI,SAAStQ,IAAYk0I,EAAgBl0I,EAAMA,OAASA,EAAM8yB,KAArC,IACpCohH,CAAP,GACC,CAAChyF,IACJ2N,GAAoBqE,IAEhBxlD,gBAAMmhD,IAAsBigF,EAAsBjgF,GAEtD,MAAMskF,EAAmB3wH,uBAAaq5E,IACpClxB,GAAU5nD,IACR,IAAIqwH,EACJ,GAAIrwH,EAAK,EACS,OAAGA,QAAH,IAAGA,OAAH,EAAGA,EAAKjD,IAAI+7E,IACf94E,EAAI1I,OAAOwhF,GAAW94E,EAAInZ,IAAIiyF,GAC3Cu3C,EAAY,IAAIvzH,IAAIkD,EACrB,MACCqwH,EAAY,IAAIvzH,IAAI,CAACg8E,IAEvB,OAAOu3C,CAAP,GATF,GAWC,CAACzoE,IAEExxB,EAAMl9B,mBAAQ,IACXilC,EACHz/C,KAAK03C,OAAO+H,EAAI3pC,KACfpJ,QAAOG,KAAU,OAACH,QAAD,IAACA,KAAQ2R,IAAIxR,EAAOtP,UACrCsC,KAAIgN,GAAUA,EAAOwjB,SACtB,GACH,CAACovB,EAAK/yC,IAIHklI,GAAarjG,EAAQ,EAAc,IAAe,GAClDsjG,GAAcrjG,EAAS,EAAc,IAAc,GAEzD,OAAO,uBAAK1Z,IAAKA,EAAKlhB,UAAW+iC,mBAAKtiC,EAAOtD,KAAM6C,GAAY,cAAaozC,EAArE,UACL,sBACEzY,MAAM,OACNC,OAAO,OACPwgC,QAAO,cAASzgC,GAAS,EAAlB,YAAuBC,GAAU,GACxCsjG,eAAe,gBACfC,cAAc,gBALhB,SAOIxjG,GAASC,GACT+R,GAAYC,SAAS3gD,KAAKu6F,GACxB,eAAC42C,GAAD,CAEE52C,QAASA,EACT1zC,UAAW8qF,EAAgBp3C,EAAQ33F,QACnC0R,QAAS,IAAMu9H,EAAiBt3C,EAAQ33F,QACxCgf,SAAQ,OAAE/U,QAAF,IAAEA,OAAF,EAAEA,EAAQ2R,IAAI+7E,EAAQ33F,QAC9Bi1C,IAAKA,EACLrnB,MAAOmhH,EAAgBp3C,EAAQ33F,QAC/BmoB,MAAOA,EACPxpB,EAxBM,GAwBQg5F,EAAQ43C,KAAO,IAAMJ,EAvB9B,GAwBL7/E,EAzBM,GAyBQqoC,EAAQ63C,KAAO,IAAMJ,EAxB9B,GAyBLtjG,MAAOqjG,EACPpjG,OAAQqjG,EACRzkF,kBAAmBA,GAZdgtC,EAAQ10F,UAiBrB,sBAAKkO,UAAWS,EAAOy+D,UAAvB,SACE,eAAC,GAAD,CACEn5D,SAAS,YACTvS,MAAM,+DA/BZ,IAkDF5I,GAAcg8C,aAAe,CAC3B+2F,MAAO,UACP,cAAe,iBAOjB,MAAMW,GAA8Bz1H,cAAWnI,IAAK,CAClDvD,KAAM,CACJkE,QAAS,OACT09B,cAAe,cAGbw/F,GAAqBvgI,IAAMoI,MAAK,IAU7B,IAV8B,SACnCL,EADmC,MAEnCvS,EAFmC,YAGnCyO,EAHmC,QAInC4yC,EAJmC,aAKnC2pF,EALmC,SAMnC3gF,EANmC,kBAOnCrE,EAPmC,MAQnCmkF,EARmC,UASnC39H,GACI,EACN,MAAMS,EAAS69H,MACRtnH,EAAOynH,GAAYj4H,mBAASg4H,IAC7B,WAAC5gG,GAAc2W,KAGfvpC,EAAM4yB,EAAW73B,GACjBq1C,EAAYn5C,IAAW,OAAI+I,QAAJ,IAAIA,OAAJ,EAAIA,EAAK/I,cAAe,GAC/Co5C,EAAa7nD,IAAK,OAAIwX,QAAJ,IAAIA,OAAJ,EAAIA,EAAKxX,OAEjC,OAAO,uBAAKwM,UAAW+iC,mBAAKtiC,EAAOtD,KAAM6C,GAAlC,UACL,eAAC,GAAD,CACE+F,SAAUA,EACVvS,MAAO6nD,EACPp5C,YAAam5C,EACbpkC,MAAOA,EACPyiC,cAAeglF,EACfjlF,kBAAmBA,EACnBklF,gBAAc,EACd7gF,SAAUA,IAEZ,eAACjzD,GAAD,CACEmb,SAAUA,EACV8uC,QAASA,EACT79B,MAAOA,EACP6mC,SAAUA,EACVrE,kBAAmBA,EACnBmkF,MAAOA,MAjBX,IAkCFY,GAAmB33F,aAAe,CAChC43F,aAAc,UAGDD,UCxUf,MAAM31H,GAAYC,cAAWnI,IAAK,CAChCvD,KAAM,CAAC,EAEP+hE,UAAW,CACTvlC,SAAU,WACVgB,MAAO,OACPC,OAAQ,QAEV+jG,UAAW,CACT/hI,gBAAiB8D,EAAMnE,QAAQC,QAAQd,MACvCi/B,MAAO,OACPC,OAAQ,OACR,oBAAqB,OACrB2hB,UAAW,OACXikE,WAAY,kBACZz6E,gBAAiB,cACjBq0F,WAAY,aAEdzwI,MAAO,CACLgwC,SAAU,WACVuI,MAAOxhC,EAAMkH,QAAQ,GACrBg4B,IAAK,EACLkY,OAAQ,OAqDG8mF,OAlDO5gI,IAAMoI,MAAK,IAa1B,IAb2B,IAChC09B,EADgC,MAEhCn6C,EAFgC,MAGhCqtB,EAHgC,SAIhCnJ,EAJgC,SAKhClO,EALgC,SAMhCmzC,EANgC,aAOhC+rF,EAPgC,QAQhC9hI,EARgC,QAShCwD,EATgC,UAUhCP,EAVgC,QAWhCV,EACA,cAAe8zC,GACX,EACJ,MAAM3yC,EAASmI,GAAUtJ,GACnBoB,EAAQy6C,eAGRlG,EAASruC,mBAAQ,IAAMoQ,EAAQg+B,GAAUh+B,EAAO,CAAC,EAAG8sB,IAASn6C,GAAUA,GAAO,CAACqtB,EAAO8sB,IACtFu5F,EAAaz2H,mBAAQ,IAAM0T,GAAc3wB,GAAS,IAAI,CAACA,IACvD2zI,EAAa12H,mBAAQ,IAAMquC,EAAOtrD,IAAQ,CAACA,EAAOsrD,IAExD,OAAO,sBAAK10C,QAASA,EAASP,UAAW+iC,mBAAK/iC,EAAWS,EAAOtD,MAAO,cAAai2C,EAA7E,SACL,eAAClW,GAAA,EAAD,CAAS+D,UAAU,SAASgc,WAAY,EAAGhgB,MAAOlgC,GAAW,GAA7D,SACE,uBAAKiD,UAAWS,EAAOy+D,UAAvB,UACE,sBAAKl/D,UAAWS,EAAOk+H,UAAWz+H,MAAO,CACvCq8C,UAAW58C,EAAQ,iBAAa29H,EAAb,sBAAuCA,EAAvC,KACnB1gI,gBAAiBk2C,EAAWpyC,EAAMnE,QAAQ6D,OAAO0+H,mBAAsBjxH,EAAWnN,EAAMnE,QAAQE,UAAUb,UAAY8E,EAAMnE,QAAQC,QAAQZ,cAE5IijI,GAAgB,eAACr3H,GAAA,EAAD,CAAYxH,UAAWS,EAAO9W,MAAOuW,MAAO,CAACC,MAAO2yC,EAAWpyC,EAAMnE,QAAQjM,KAAKwiD,cAAWjjD,GAA7F,SAA0GwtI,UAPlI,IC5CK,MACDz0H,GAAYC,cAAWnI,IAAK,CAChCvD,KAAM,CACJw9B,MAAO,OACPC,OAJ2B,GAK3BjB,SAAU,YAEZolG,aAAc,CACZpkG,MAAO,OACPC,OAAQ,OACRrzB,OAAQ,GAEVy3H,eAAgB,CACdpkG,OAAQ,OACRD,MAAO,QAETskG,oBAAqB,CACnB13H,OAAQ,GAEV23D,UAAW,CACTvlC,SAAU,WACViB,OAAQ,OACRD,MAAO,QAETnnC,MAAO,CACLmmC,SAAU,WACViG,IAAK,EACL8wB,KAAMhwD,EAAMkH,QAAQ,IACpBs6B,MAAO,EACP4V,OAAQ,EACR/d,WAAY,OACZkB,UAAW,SACX55B,QAAS,OACTwG,WAAY,UAEdq3H,IAAK,CACHvlG,SAAU,WACViG,IAAKl/B,EAAMkH,QAAQ,IACnB8oD,KAAM,EACNxuB,MAAO,EACP4V,OAAQp3C,EAAMkH,QAAQ,SAGpBu3H,GAAYnhI,IAAMoI,MAAK,IAmBtB,IAnBuB,MAC5Bzc,EAD4B,MAE5B6J,EAF4B,SAG5Bqa,EAH4B,SAI5BkzB,EAJ4B,SAK5B+R,EAL4B,QAM5B/1C,EAN4B,QAO5BmM,EAP4B,IAQ5B46B,EAR4B,MAS5BrnB,EAT4B,MAU5BzF,EAV4B,kBAW5BwiC,EAX4B,eAY5B48D,EAZ4B,kBAa5BgpB,EAb4B,cAc5BC,EAd4B,UAe5Br/H,EAf4B,QAgB5BV,EACA,cAAe8zC,KACZ5X,GACC,EACJ,MAAM/6B,EAASmI,GAAUtJ,GAEnBu9C,EAAarpD,GAAK,UAAO7J,GACzB4rE,EAAepoD,uBAAawxB,KAC3BmU,GAAY/R,GAAUA,EAASpC,EAAOh1C,GAAQkkB,EAAxB,GAC1B,CAAClkB,EAAOmpD,EAAU/R,EAAUlzB,IAE/B,IAAIyxH,EACY,UAAZp2H,EACFo2H,EAAU1kF,KACW,aAAZ1xC,IACTo2H,EAAU1+F,MAIZ,MAAM2+F,EAAiB,uBAAKv/H,UAAWS,EAAOy+D,UAAvB,WACnB1lB,GAAqB,eAAC,GAAD,CACrBx5C,UAAWS,EAAOy+H,IAClBp7F,IAAKA,EACLn6C,MAAO8yB,EACPzF,MAAOA,EACPnJ,SAAUA,EACVilC,SAAUA,IAEZ,sBAAK9yC,UAAWS,EAAOjN,MAAO0M,MAAQs5C,OAAsC3pD,EAAlB,CAACqyC,MAAO,QAAlE,SACE,eAAChF,GAAA,EAAD,CACE+D,UAAU,QACVgc,WAAY,IACZhgB,MAAOlgC,GAAW,GAHpB,SAKE,eAACyK,GAAA,EAAD,CAAYm1C,QAAM,EAAlB,SAAoBE,WAK1B,OAAO,sBAAK78C,UAAW+iC,mBAAK/iC,EAAWS,EAAOtD,MAAO,cAAai2C,EAA3D,SACJisF,EACGE,EACA,eAACtrF,GAAA,EAAD,CACA/zC,MAAO,CAACw5D,cAAe0lE,EAAoB,YAASvvI,GACpDmQ,UAAWS,EAAOs+H,aAClBz/H,QAAS,CACP9L,MAAOiN,EAAOu+H,eACdC,oBAAqBx+H,EAAOw+H,qBAE9B7oB,eAAgBA,EAChBtjE,SAAUA,EACVoB,QAAS,eAACorF,EAAD,CACPx+F,QAASjzB,EACTvN,KAAK,SACLH,MAAM,YACNI,QAASg1D,EACTzjE,KAAM+qD,EACN38C,MAAO,CACLyH,QAAS,EACT+xD,cAAgB0lE,EAAoB,YAASvvI,EAC7CiY,YAAiC,UAAnBsuG,GAA8B,OAAIvmH,EAChDwZ,WAAgC,QAAnB+sG,GAA4B,OAAIvmH,MAE3C2rC,IAENhoC,MAAO+rI,KA1Bb,IAoDFJ,GAAUv4F,aAAe,CACvBwvE,eAAgB,OAGH+oB,UCjKf,MAAMv2H,GAAYC,cAAWnI,IAAK,CAChCvD,KAAM,CACJypE,UAAW,SACXzmE,MAAOO,EAAMnE,QAAQjM,KAAKwiD,cAGf,SAAS0sF,GAAT,GAAwC,IAAd,UAACx/H,GAAY,EACpD,MAAMS,EAASmI,KACf,OAAO,eAACpB,GAAA,EAAD,CAAYxH,UAAW+iC,mBAAK/iC,EAAWS,EAAOtD,MAA9C,qDAGR,CCMD,MAAMyL,GAAYC,cAAWnI,IAAK,CAChCvD,KAAM,CACJw9B,MAAO,OACPt5B,QAAS,OACTwG,WAAY,aACZm3B,eAAgB,SAChBD,cAAe,SACfliC,UAAW,cAEbqiE,UAAW,CACTvkC,MAAO,QAETm/D,KAAM,CACJn/D,MAAO,OACPt5B,QAAS,OACTo+H,aAAc,UAEhBne,SAAU,CACRj4G,WAAY3I,EAAMkH,QAAQ,KAE5B83H,UAAW,CACT1lG,aAAct5B,EAAMkH,QAAQ,QAG1B+3H,GAAa3hI,IAAMoI,MAAK,IAiBvB,IAAD,gBAjByB,SAC7BL,EAD6B,MAE7BvS,EAF6B,YAG7ByO,EAH6B,QAI7B4yC,EAJ6B,GAK7BiqB,EAL6B,aAM7B0/D,EAN6B,YAO7BoB,EAP6B,UAQ7BC,EAR6B,kBAS7BrmF,EAT6B,cAU7BsmF,EAV6B,eAW7BC,EAX6B,mBAY7BrrE,EAZ6B,aAa7BsrE,EAb6B,UAc7BhgI,EAd6B,QAe7BV,EACA,cAAe8zC,GACX,EACJ,MAAM1yC,EAAQy6C,gBACR,WACJvd,EADI,OAEJymB,EAFI,WAGJgJ,EAHI,eAIJnK,EAJI,uBAKJ2B,GACEtQ,KACEklF,EAAsB50E,IACtBpkD,EAASmI,GAAU,CAACtJ,QAASA,EAASoB,MAAOA,KAC5Cu/H,EAAgBC,GAAqB15H,qBACtCgxC,EAAeoB,YAAeR,GAAS,iBACvCX,EAAcmB,YAAeR,GAAS,iBACrCphC,EAAOynH,GAAYj4H,mBAASg4H,IAAY,UAAI5gG,EAAW73B,UAAf,aAAI,EAAsBiR,QAAS,UAClFwiC,EAAoBnhD,gBAAMmhD,IAAsBigF,EAAsBjgF,EAOtE,MAAM2mF,EAAev5H,mBAAQ,KAAO,IAAD,EACjC,OAAOvO,gBAAMunI,GAAN,UACHhiG,EAAW73B,UADR,aACH,EAAsBpN,aACtB9I,CAFJ,GAGC,CAAC+vI,EAAahiG,EAAY73B,IACvBq6H,EAAgBD,GAAgB3nI,OAAOK,KAAKsnI,GAAc7xI,OAC1D+xI,EAAUN,EAAiB,EAAIH,GAAeQ,IAAf,UAAgCxiG,EAAW73B,UAA3C,iBAAgC,EAAsBkiC,YAAtD,iBAAgC,EAA4B2D,aAA5D,aAAgC,EAAmCtrC,MAClGunC,GAAc,UAAAjK,EAAW73B,UAAX,eAAsB8hC,cAAe,aAClDy4F,EAAkBC,GAAuB/5H,mBAAS65H,GACnDG,EAAOh6H,mBAASq5H,GAAaQ,GAAS,IACrCvvF,EAAS1tC,GAAcoD,oBAAS,GACjCukD,EAAYnkD,mBAAQ,KAAO,IAAD,EAC9B,MAAMxO,EAAS,CAACrI,KAAM,QAASuQ,KAAM+/H,GAI/B1nI,EAAO,UAAGilC,EAAW73B,UAAd,aAAG,EAAsBpN,QAEtC,OADIA,IAASP,EAAOQ,QAAUJ,OAAOK,KAAKF,IACnCP,CAAP,GACC,CAACioI,EAASziG,EAAY73B,IACnB8lC,EAAMwY,EAAOt+C,EAAU8uC,IAAYkrF,KAAoBvmF,GAAqB2mF,GAAe,SAAUp1E,GACrGuC,EAAUD,EAAWtnD,EAAU,UAC/B06H,EAAe,OAAG50F,QAAH,IAAGA,GAAH,UAAGA,EAAK3pC,YAAR,aAAG,EAAW5T,QAC5BwK,EAAQw8D,IAAapS,EAAen9C,GACrCg1C,IAAcglF,KAA8B,OAAHl0F,QAAG,IAAHA,KAAK3pC,MAAQ2pC,EAAI3pC,KAAK5T,OAAS,GACxEwkD,GAAWiI,GAIXgb,GAAenvD,mBAAQ,KAC3B,GAAIu5H,EACF,OAAOA,EAET,UAAIt0F,QAAJ,IAAIA,KAAK3pC,KAAM,CACb,MAAMinC,EAAM,CAAC,EACP6iE,EAAU5/G,KAAK+J,IAAImqI,EAAkBz0F,EAAI3pC,KAAK5T,QACpD,IAAK,IAAI9B,EAAI,EAAGA,EAAIw/G,IAAWx/G,EAAG,CAChC,MAAM7C,EAAQkiD,EAAI3pC,KAAK1V,GACvB28C,EAAIx/C,EAAMA,OAAS,CAAC6J,MAAO7J,EAAMA,MAClC,CACD,OAAOw/C,CACR,CACD,MAAO,CAAC,CAAR,GACC,CAACg3F,EAAct0F,EAAKy0F,IAIvB55H,qBAAU,KACR,MAAMyiC,EAAM,CAAC,EACb,IAAK,MAAO5wC,EAAK5O,KAAU6O,OAAOC,QAAQs9D,IACxC5sB,EAAI5wC,GAAO,CACTuoC,UAAShoC,GAASA,EAAO2R,IAAIlS,GAC7B/E,MAAOwsI,EAAe/iH,GAAYtzB,EAAM6J,OAAS7J,EAAM6J,MACvDs/C,UAAW0G,GAGf,UAAI3N,QAAJ,IAAIA,KAAK3pC,KACP,IAAK,MAAMvY,KAASkiD,EAAI3pC,KAAM,CAC5B,MAAM3J,EAAM5O,EAAMA,MACZkkB,IAAW/U,GAASA,EAAO2R,IAAIlS,GAC/BmoI,EAAWv3F,EAAI5wC,GACfu6C,GAAWjlC,GAAmC,IAAhBlkB,EAAM8yB,MACtCikH,IACFA,EAASjkH,MAAQ9yB,EAAM8yB,MACvBikH,EAAS5tF,SAAWA,EAEvB,CAEHotF,EAAkB/2F,EAAlB,GACC,CAAC0C,EAAK/yC,EAAQi9D,GAAcvc,EAAmBwmF,IAGlD,MAAMW,GAAiBxzH,uBAAY,KACjC/J,GAAW,GACX,IAAIw9H,EAAUN,EAAmBE,EACjClzE,EAAQ,CAACv9D,KAAM,QAASuQ,KAAMsgI,IAAW7+H,IAAc,IAAD,GACxC,OAARA,QAAQ,IAARA,GAAA,UAAAA,EAAUG,YAAV,eAAgB5T,UAAWgyI,IAC7BM,EAAUN,GAEZl9H,GAAW,GACXm9H,EAAoBK,EAApB,GALF,GAOC,CAACtzE,EAASkzE,EAAMF,IAGbO,GAAiB1zH,uBAAY,KACjCozH,GAAoB7yH,IAClB,MAAMkzH,EAAUx0I,KAAK03C,IAAIp2B,EAAM8yH,EAAMH,GAErC,OADA/yE,EAAQ,CAACv9D,KAAM,QAASuQ,KAAMsgI,IAAU,SACjCA,CAAP,GAHF,GAKC,CAACtzE,EAASkzE,EAAMH,IAGb9qE,GAAepoD,uBAAY,CAACwxB,EAAOpmC,EAAKsV,KAC5C,MAAMgjH,EAAa,IAAIoP,GACvBpP,EAAWt4H,GAAKuoC,QAAUjzB,EAC1B,MAAMizB,EAAUtoC,OAAOC,QAAQo4H,GAC5B/3H,QAAO,QAAEP,EAAK5O,GAAP,SAAkBA,EAAMm3C,OAAxB,IACP70C,KAAI,QAAEsM,EAAK5O,GAAP,SAAkB4O,CAAlB,IACP+8D,GAAU,IAAI9qD,IAAIs2B,GAAlB,GACC,CAACw0B,GAAW2qE,IAGTa,GAAkBl6H,mBAAQ,IACvBk5H,EACH,KACA,eAAC,GAAD,CAAc/kF,YAAaA,GAA3B,SACA,sBAAK/6C,UAAWS,EAAOy+D,UAAvB,SACE,eAACzK,GAAD,CACEz0D,UAAWS,EAAOi/H,UAClB35H,SAAUA,EACV+sC,SAAUA,GACV4hB,mBAAoBA,EACpB7sB,YAAaA,EACbgsB,WAAS,SAIhB,CAACisE,EAAe/kF,GAAat6C,EAAQsF,EAAU+sC,GAAU4hB,EAAoB7sB,IAG1Ek5F,GAAmBn6H,mBAAQ,KAC/B,GAAIm5H,EACF,OAGF,MAAMiB,EAASn1F,EAAMrzC,OAAOK,KAAKk9D,IAAcznE,OAAS+xI,EAClDY,GAAoB5oI,gBAAMooI,IAA2BA,EAAkBH,EACvEY,GAAkB7oI,gBAAM+nI,IAAyBE,GAAoBF,EAErE/nB,GAAW8nB,KADJc,GAAqBC,GAI5B5oB,GAAW6nB,GAEZG,EAAmBE,GAAQH,EAE1Bc,EAAQ/0I,KAAK88F,KAAK83C,EAASliE,EAAK,IAEtC,IAAIsiE,EACJ,GAAoB,OAAhB3pF,EAAsB,CACxB,MAAM4pF,EFvNmB,GEuNNF,EACbG,EAAgBjpB,GAAYC,EAJd,GAI0C,EAC9D8oB,EAAiBJ,EAAS,EAAKK,EAAaC,OAAgBzxI,CAC7D,MAAM,GAAoB,QAAhB4nD,EAAuB,CAChC,MAAM4pF,EF3NmB,GE2NNj1I,KAAK03C,IAAIu8F,EAAUvhE,EAAK,GAAIqiE,GACzCI,GAAalpI,gBAAM+nI,IAAkBR,GAAeQ,EAE1DgB,EAAiBC,GADKlB,GAAgBoB,EAAa,EAT/B,GAWrB,CAED,MAAMz9F,EAAM+H,EAAMz/C,KAAK03C,OAAO+H,EAAI3pC,KAAKjW,KAAIgN,GAAUA,EAAOwjB,SAAU,EAChEg3B,EAAQwsF,GAAkB,sBAC9BjgI,UAAWS,EAAOq5F,KAClB55F,MAAO,CAACshI,iBAAiB,UAAD,OAAYL,EAAZ,WAFM,SAI7B3oI,OAAOC,QAAQwnI,GAAgBh0I,KAAI,QAAEsM,EAAK5O,GAAP,SAClC,eAAC,GAAD,CAEEA,MAAO4O,EACP/E,MAAO7J,EAAM6J,MACbqa,SAAUlkB,EAAMm3C,QAChBgS,SAAUnpD,EAAMmpD,SAChB0G,kBAAmBA,EACnBzY,SAAUw0B,GACVrsD,QAAQ,WACR46B,IAAKA,EACLrnB,MAAO9yB,EAAM8yB,MACbzF,MAAOA,GAVFze,EAF2B,MAiBhCkpI,GAAY,OAAH51F,QAAG,IAAHA,OAAA,EAAAA,EAAKqf,YAAau1E,IAAoBH,EACrD,IAAIoB,EAyBJ,OAvBEA,EADEvB,EACQ1sF,EACmB,IAApBgtF,EACC,eAACjB,GAAD,IACA3zF,GAAwB,OAAjB2L,EAOP,uCACP/D,EACD,eAAC,GAAD,CACE4kE,SAAUA,EACVC,SAAUA,EACVC,YAAakpB,EACbhpB,YAAa3nE,EACbpX,UAAW,GACXi/E,OAAQkoB,GACRnoB,OAAQioB,QAfF,eAAC,GAAD,CACRz3H,QAAQ,OACR,wBAAgBkqC,EAAhB,gBACA7rC,OAAQ,IAgBL,sBAAKvH,UAAWS,EAAOy+D,UAAWh/D,MAAO,CAAC06B,OAAQwmG,GAAlD,SACJM,GADH,GAGC,CACD3B,EACAvmF,EACA3N,EACAkqB,GACAsqE,EACAF,EACAM,EACAH,EACAE,EACA1hE,EACArnB,EACAwoF,EACAx/H,EACA+2C,EACAooF,EACArqE,GACAv+C,EACA2pH,GACAE,GACA/vF,EACAsvF,EACAhtF,IAIF,OAAO,uBAAKpzC,UAAW+iC,mBAAK/iC,EAAWS,EAAOtD,MAAO,cAAai2C,EAA3D,UACL,eAAC,GAAD,CACErtC,SAAUA,EACVvS,MAAOA,EACPyO,YAAaA,EACb+U,MAAOA,EACPyiC,cAAeglF,EACfjlF,kBAAmBA,IAEpBsnF,GACAC,KAVH,IAiCFpB,GAAW/4F,aAAe,CACxBk4B,GAAI,IAGS6gE,U,sBC3Vf,MAAMgC,GAAoB94H,cAAWnI,IAAK,CACxCvD,KAAM,CACJP,gBAAiB8D,EAAMnE,QAAQ2/C,KAAK,UAGlC0lF,GAAW5jI,IAAMoI,MAAK,IAOrB,IAPsB,OAC3B9X,EAD2B,UAE3BuzI,EAF2B,YAG3BC,EAH2B,UAI3B9hI,EAJ2B,QAK3BV,EACA,cAAe8zC,GACX,EACJ,MAAM3yC,EAASkhI,GAAkBriI,GACjC,OAAO,sBACLU,UAAW+iC,mBAAK/iC,EAAWS,EAAOtD,MAClC+C,MAAuB,aAAhB4hI,EACH,CAACnnG,MAAOrsC,EAAQssC,OAAQinG,GACxB,CAAClnG,MAAOknG,EAAWjnG,OAAQtsC,GAE/B,cAAa8kD,GANf,IAmBFwuF,GAASh7F,aAAe,CACtBt4C,OAAQ,EACRuzI,UAAW,GAGED,UCpCf,MAAMG,GAAqBl5H,cAAWnI,IAAK,CACzCvD,KAAM,CACJkE,QAAS,OACTwG,WAAY,UAEdjI,WAAY,CACVo/B,eAAgB,aAChBn3B,WAAY,SACZk3B,cAAe,iBACfwd,UAAW,oBAEb58C,SAAU,CACRo/B,cAAe,MACfC,eAAgB,WAChBud,UAAW,mBAEb/oD,MAAO,CACLumC,WAAY,EACZksC,WAAY,EACZxiC,SAAU,GAEZu+F,KAAM,CACJ/7D,WAAY,EACZxiC,SAAU,OAIRw+F,GAAYjkI,IAAMoI,MAAK,IAStB,IATuB,MAC5B5S,EAD4B,KAE5B8M,EAF4B,aAG5B4hI,EAH4B,WAI5BC,EAJ4B,YAK5BL,EAL4B,UAM5B9hI,EAN4B,QAO5BV,EACA,cAAe8zC,GACX,EACJ,MAAM3yC,EAASshI,GAAmBziI,GAClC,OAAO,uBAAKU,UAAW+iC,mBAAK/iC,EAAWS,EAAOqhI,GAAcrhI,EAAOtD,MAAO,cAAai2C,EAAhF,UACL,eAAC5rC,GAAA,EAAD,CACExH,UAAWS,EAAOjN,MAClB0M,MAAO,CAACjD,SAAUqD,GAClBq8C,QAAM,EAHR,SAIEnpD,IAEF,sBAAK0M,MAAO,CAACmlC,KAAK,OAAD,OAAS68F,EAAT,SACjB,eAAC,GAAD,CACEliI,UAAWS,EAAOjN,MAClBlF,OAAQ6zI,EACRL,YAAaA,MAXjB,IA2BFG,GAAUr7F,aAAe,CACvBtmC,KAAM,EACN4hI,aAAc,EACdJ,YAAa,cAGAG,UCjEf,MAAMG,GAAoBv5H,cAAWnI,IAAK,CACxCvD,KAAM,CACJkE,QAAS,OACTs4B,SAAU,WACVE,SAAU,UAEZ62B,KAAM,CACJ3xB,cAAe,MACfnE,OAAQ,QAEVkd,OAAQ,CACN/Y,cAAe,iBACfpE,MAAO,QAETqkG,eAAgB,CACdrlG,SAAU,YAEZ0oG,gBAAiB,CACf1oG,SAAU,YAEZ2oG,QAAS,CACP3oG,SAAU,WACViG,IAAK,EACLsC,MAAO,GAETqgG,aAAc,CACZ5oG,SAAU,WACVgB,MAAO,EACPuH,MAAO,EACPtlC,gBAAiB8D,EAAMnE,QAAQ2/C,KAAK,MAEtCsmF,eAAgB,CACd7oG,SAAU,WACViB,OAAQ,EACRgF,IAAK,EACLhjC,gBAAiB8D,EAAMnE,QAAQ2/C,KAAK,UAIlCumF,GAAWzkI,IAAMoI,MAAK,IAmBE,IAnBD,IAC3BjQ,EAD2B,IAE3B2tC,EAF2B,MAG3BvoB,EAH2B,KAI3BzB,EAJ2B,SAK3BC,EAL2B,MAM3B/C,EAN2B,OAO3B1jB,EAP2B,YAQ3BovI,EAR2B,WAS3BC,EAT2B,UAU3B1hG,EAV2B,WAW3BkhG,EAX2B,aAY3BD,EAZ2B,aAa3BU,EAb2B,cAc3BC,EAd2B,YAe3BC,EAf2B,eAgB3BC,EAhB2B,UAiB3B/iI,EAjB2B,QAkB3BV,EACA,cAAe8zC,GAAY,EAC3B,MAAM3yC,EAAS2hI,GAAkB9iI,IAC3B,OAACs7B,EAAD,MAASD,EAAT,IAAgBzZ,GAAOw6B,eACvBomF,EAAc,CAClBpxE,KAAM,WACN5Y,OAAQ,cACR7W,GACI+hG,EAA2B,aAAhBlB,EACblnG,EACAD,EACEsoG,EAA6B,aAAhBnB,EACfY,EACAC,EAGE1tF,EAASruC,mBACb,IAAMouC,GAAUh+B,EAAO,CAAC7gB,EAAK2tC,GAAM,CAAC,EAAGk/F,KACvC,CAAChsH,EAAO7gB,EAAK2tC,EAAKk/F,IAGpBD,EAAiB1qI,gBAAM0qI,GAAkB,EAAIA,EAC7CD,EAAczqI,gBAAMyqI,GAA8B,WAAd7hG,EAAyB,EAAI,EAAK6hG,EACtEF,EAAevqI,gBAAMuqI,GAA+B,WAAd3hG,EAAyB,EAAI,EAAK2hG,EACxEC,EAAgBxqI,gBAAMwqI,GAAgC,SAAd5hG,EAAuB,EAAI,EAAK4hG,EACxE,MAAMK,EAAYt8H,mBAAQ,KACjB,CACL8yB,WAAYopG,EACZ9gG,WAAY8gG,EACZ9oG,cAAe+oG,EACf9gG,cAAe8gG,EACfj7H,aAAc+6H,EACd3nG,aAAc2nG,EACdx5H,YAAau5H,EACbtoG,YAAasoG,KAEd,CAACG,EAAgBH,EAAcC,EAAeC,IAC3CK,EAAYv8H,mBAAQ,KACxB,IAAIu8H,EAYJ,MAXkB,SAAdliG,EACFkiG,EAAY,CACVvjG,IAAKkjG,EACLhrF,OAAQirF,EAAiB,GAEJ,WAAd9hG,IACTkiG,EAAY,CACVzyE,KAAMkyE,EAAe,EACrB1gG,MAAO2gG,EAAgB,IAGpBM,CAAP,GACC,CAACJ,EAAgBH,EAAcC,EAAeC,EAAa7hG,IAExDmiG,EAAYx8H,mBAAQ,KACxB,IAAKo8H,EACH,MAAO,GAIT,MAAMK,EAAc15I,GACX4xB,IAAU3B,GAAMiB,UACnBH,aAAO/wB,EAAO,SACdgwB,GAAahwB,EAAO4xB,EAAOzB,EAAMC,GAIvC,GAAI9T,kBAAQ3S,GACV,OAAOA,EAAOrH,KAAK+1I,IAAD,IAAeA,EAAMxuI,MAAO6vI,EAAWrB,EAAKxuI,OAAQf,IAAKwiD,EAAO+sF,EAAKvvI,KAAOuwI,MAShG,IAAIhC,EAAoB,WAAVhqH,GAAgC,QAAVA,EAChC5qB,KAAK6E,MAAM+xI,GAAYC,EAFX,KAGZ72I,KAAK6E,OAAO6yC,EAAM3tC,IAAQ2tC,EAAMmR,EAAOwxC,OAAOu8C,GAAYC,EAH9C,OAShB,OAHAjC,EAAS50I,KAAK03C,IAAI,EAAGk9F,GAGjB7qI,IAAQ2tC,EACH,CAAC,CACNtwC,MAAO6vI,EAAWltI,GAClB1D,IAAK,IjG/BN,SAAkB0D,EAAK2tC,EAAKtuC,GAAgE,IAA7DwhB,EAA4D,uDAApD,SAAUuE,EAA0C,uCAAnCzB,EAAmC,uDAA5B,aAAcC,EAAc,uDAAH,EAC7F,GAAIwB,IAAU3B,GAAMiB,UAAW,CAC7B,MAAMzwB,EAAQk5I,aAAaC,aAAsBptI,IAC3C9L,EAAMi5I,aAAaC,aAAsBz/F,IACzC0/F,EAAW,CAACp5I,QAAOC,OAGnBo5I,EAAqBC,GAAS,IAAmB,IAAlB,MAACt5I,EAAD,IAAQC,GAAS,EACpD,MAAMs5I,EAAav3I,KAAK88F,KAAK06C,aAAQx5I,GAASs5I,GACxCG,EAAWz3I,KAAK6E,MAAM2yI,aAAQv5I,GAAOq5I,GAC3C,OAAOvuF,gBAAMwuF,EAAYE,EAAW,GAAG53I,KAAIuB,GAAKA,EAAIk2I,GAApD,EAIII,EAAY,CAChBC,UAAW,CACTC,WAAY,CAAC35I,EAAKD,IAAU65I,aAAkB55I,EAAKD,GAAS,EAC5DmM,MAAQitI,GAAaU,aAAmBV,GAAU1qI,QAAOtL,KAC9CA,EAAE22I,cAAgB,KAE7BzpH,OAAQ,QAEV0pH,SAAU,CACRJ,WAAY,CAAC35I,EAAKD,IAAU65I,aAAkB55I,EAAKD,GAAS,EAC5DmM,MAAQitI,GAAaU,aAAmBV,GAAU1qI,QAAOtL,KAC9CA,EAAE22I,cAAgB,KAE7BzpH,OAAQ,QAEV2pH,MAAO,CACLL,WAAYC,KACZ1tI,MAAO2tI,KACPxpH,OAAQ,QAEV4pH,YAAa,CACXN,WAAY,CAAC35I,EAAKD,IAAUm6I,aAAmBl6I,EAAKD,GAAS,EAC7DmM,MAAOiuI,KACP9pH,OAAQ,YAEV+pH,OAAQ,CACNT,WAAYO,KACZhuI,MAAOmuI,KACPhqH,OAAQ,OAEViqH,MAAO,CACLX,WAAYY,KACZruI,MAAOsuI,KACPnqH,OAAQ,SAEVoqH,KAAM,CACJd,WAAYe,KACZxuI,MAAOyuI,KACPtqH,OAAQ,SAEVuqH,YAAa,CACXjB,WAAY,CAAC35I,EAAKD,IAAU86I,aAAkB76I,EAAKD,GAAS,GAC5DmM,MAAQitI,GAAa2B,aAAmB3B,GAAU1qI,QAAOtL,GACxC,IAAIgd,IAAI,CAAC,QAAS,UACnBC,IAAIiQ,aAAOltB,EAAG,WAE9BktB,OAAQ,QAEV0qH,SAAU,CACRpB,WAAY,CAAC35I,EAAKD,IAAU86I,aAAkB76I,EAAKD,GAAS,EAC5DmM,MAAQitI,GAAa2B,aAAmB3B,GAAU1qI,QAAOtL,GACxC,IAAIgd,IAAI,CAAC,OAAQ,QAAS,QAAS,UACpCC,IAAIiQ,aAAOltB,EAAG,WAE9BktB,OAAQ,QAEV2qH,MAAO,CACLrB,WAAYkB,KACZ3uI,MAAO4uI,KACPzqH,OAAQ,QAEV4qH,cAAe,CACbtB,WAAY,CAAC35I,EAAKD,IAAUm7I,aAAoBl7I,EAAKD,GAAS,GAC9DmM,MAAQitI,GAAagC,aAAqBhC,EAAU,CAACE,KAAM,KAC3DhpH,OAAQ,QAEV+qH,eAAgB,CACdzB,WAAY,CAAC35I,EAAKD,IAAUm7I,aAAoBl7I,EAAKD,GAAS,GAC9DmM,MAAQitI,GAAagC,aAAqBhC,EAAU,CAACE,KAAM,KAC3DhpH,OAAQ,QAEVgrH,QAAS,CACP1B,WAAYuB,KACZhvI,MAAOivI,KACP9qH,OAAQ,QAEVirH,cAAe,CACb3B,WAAY,CAAC35I,EAAKD,IAAUw7I,aAAoBv7I,EAAKD,GAAS,GAC9DmM,MAAOktI,EAAkB,KACzB/oH,OAAQ,WAEVmrH,cAAe,CACb7B,WAAY,CAAC35I,EAAKD,IAAUw7I,aAAoBv7I,EAAKD,GAAS,GAC9DmM,MAAOktI,EAAkB,MACzB/oH,OAAQ,WAEVorH,QAAS,CACP9B,WAAY4B,KACZrvI,MAAOktI,EAAkB,KACzB/oH,OAAQ,YAQNqrH,EAAc,CAAC,EACrBvtI,OAAOC,QAAQqrI,GACZ7pI,SAAQ,IAAmB,IAAjB+rI,EAAKC,GAAW,EAAEF,EAAYC,GAAOC,EAAMjC,WAAW35I,EAAKD,EAAzC,IAG/B,MAAM87I,EAAmB1tI,OAAOC,QAAQstI,GACrCjtI,QAAO,QAAEktI,EAAKG,GAAP,SAAiBA,GAAQ3wI,CAAzB,IACPvJ,KAAI,QAAE+5I,EAAKG,GAAP,QAAiB,CAACH,EAAKlC,EAAUkC,GAAKzvI,MAAMitI,GAAU1qI,QAAOtL,GAAK44I,aAAiB54I,EAAGg2I,KAAtF,IACJ1qI,QAAO,QAAEktI,EAAKhwF,GAAP,SAAkBA,EAAM1nD,QAAUkH,CAAlC,IACPvJ,KAAI,QAAE+5I,EAAKhwF,GAAP,QAAkB,CAACgwF,EAAK55I,KAAKK,IAAIupD,EAAM1nD,OAASkH,GAAIwgD,EAApD,IAGP,IAAKkwF,EAAiB53I,OACpB,MAAO,GAKT,MAAM+3I,EAAkBH,EACrBlxI,QAAO,CAACgzD,EAAM26C,IAAS36C,EAAK,GAAK26C,EAAK,GAAK36C,EAAO26C,IAC/C3sD,EAAQqwF,EAAgB,GACxBJ,EAAQnC,EAAUuC,EAAgB,IAIxC,OAAOrwF,EAAM/pD,KAAIuB,IAAC,CAAM7D,MAAOi6I,aAAQp2I,GAAIw0I,KAAMtnH,aAAOltB,EAAGy4I,EAAMvrH,WAClE,CAEC,GAAc,QAAV1D,EAAiB,CACnB,MAAMsvH,EAAYxiG,EAAM3tC,EAClBowI,EAASn6I,KAAK6E,MAAM7E,KAAK8vB,MAAMoqH,IAC/BE,EAAYp6I,KAAK88F,KAAKq9C,EAAS/wI,GAErC,OADgB2/C,gBAAM,EAAGoxF,EAAS,EAAGA,EAAS/wI,EAAIgxI,EAAY,GAC/Cv6I,KAAIuB,IACjB,MAAM7D,EAAQyC,KAAKwpB,IAAI,GAAIpoB,GAC3B,MAAO,CAAC7D,QAAOq4I,KAAMroH,GAAahwB,EAAO4xB,EAAOzB,EAAMC,GAAtD,GAGH,CAAM,CACL,MAAMusH,EAAYxiG,EAAM3tC,EAmBxB,OAhBwBswI,GAFJ,CAAC,GAAK,GAAK,IAAM,GAAK,EAAG,EAAG,IAAK,EAAG,IACzCr6I,KAAKwpB,IAAI,GAAKxpB,KAAK2oF,MAAM3oF,KAAK8vB,MAAMoqH,MAEhDxtI,QAAOtL,GAAK+tB,IAAU3B,GAAMY,KAAMhtB,EAAI,IAAM,IAC5CvB,KAAIuB,GAAK,CAACA,EAAGpB,KAAK6E,MAAMq1I,EAAY94I,MACpCsL,QAAO,QAAE0qI,EAAUkD,GAAZ,SAAsBA,GAAQlxI,CAA9B,IACPvJ,KAAI,IAAuB,IAArBu3I,EAAUkD,GAAU,EACzB,MAAM/C,EAAav3I,KAAK88F,KAAK/yF,EAAMqtI,GAC7BK,EAAWz3I,KAAK6E,MAAM6yC,EAAM0/F,GAKlC,OAJcruF,gBAAMwuF,EAAYE,EAAW,GAAG53I,KAAIuB,IAChD,MAAM7D,EAAS6D,EAAIg2I,EACnB,MAAO,CAAC75I,QAAOq4I,KAAMroH,GAAahwB,EAAO4xB,EAAOzB,EAAMC,GAAtD,GAEF,IAEDjhB,QAAQk9C,GAAUA,EAAM1nD,QAAUkH,IAClCvJ,KAAK+pD,GAAU,CAACA,EAAO5pD,KAAKK,IAAIupD,EAAM1nD,OAASkH,MAC/CR,QAAO,CAACgzD,EAAM26C,IAAS36C,EAAK,GAAK26C,EAAK,GAAK36C,EAAO26C,IAC9B,EACxB,CAEJ,CiGtIUgkC,CAASxwI,EAAK2tC,EAAKk9F,EAAQhqH,EAAOuE,EAAOzB,EAAMC,GACnD9tB,KAAI,IAAoB,IAAnB,KAAC+1I,EAAD,MAAOr4I,GAAW,EACtB,MAAO,CACL6J,MAAOwuI,EACPvvI,IAAKwiD,EAAOtrD,GAASq5I,EAFvB,GAFJ,GAOC,CAACA,EAAUznH,EAAO0nH,EAAW3vI,EAAQwwC,EAAK3tC,EAAK8+C,EAAQn7B,EAAMC,EAAU/C,IAMpE4vH,EAAkBhgI,mBAAQ,KAC9B,GAAI+7H,EACF,OAAOA,EAET,MAAMkE,EAAyB,OAATzD,QAAS,IAATA,KAAW90I,OAC7BlC,KAAK03C,OAAOs/F,EAAUn3I,KAAIuH,GAASA,EAAMA,MAAMlF,UAC/C,EAEJ,OADc6zI,EAAaD,EAA+B,IAAhB2E,EAAuBnE,CACjE,GACC,CAACC,EAAYS,EAAWjB,EAAYD,EAAcQ,IAErD,OAAO,uBACLxhH,IAAKA,EACLlhB,UAAW+iC,mBAAK/iC,EAAWS,EAAOwgC,GAAYxgC,EAAOtD,MACrD,cAAai2C,GAAM,oBAAiBnS,GACpC/gC,MAAOgjI,EAJF,UAML,uBACEljI,UAAWS,EAAOu+H,eAClB9+H,MAAuB,aAAhB4hI,EACH,CAACnnG,MAAOisG,EAAiBhsG,OAAQ,QACjC,CAACA,OAAQ8nG,EAAcR,EAAeC,EAAYxnG,MAAO,QAJ/D,UAOGyoG,EAAUn3I,KAAI,CAAC,EAAcO,KAAf,IAAC,IAACiG,EAAD,MAAMe,GAAP,SAAqB,sBAElCwM,UAAWS,EAAO4hI,gBAClBniI,MAAuB,aAAhB4hI,EACH,CAAChqF,OAAO,GAAD,OAAW,IAANrlD,EAAL,KAAmByvC,MAAO,GACjC,CAACwuB,KAAK,GAAD,OAAW,IAANj+D,EAAL,KAAmBmtC,IAAK,GALC,SAQlC,eAAC,GAAD,CACEpsC,MAAOA,EACP0uI,aAAcA,EACd5hI,KAAMoiI,EACNP,WAAYA,EACZL,YAAaA,KAZVt1I,EADQ,IAgBE,aAAhBs1I,GAA8B,sBAAK9hI,UAAWS,EAAO6hI,QAAvB,SAC7B,eAAC,GAAD,CAAUR,YAAaA,EAAaxzI,OAAQ6zI,SAGhD,sBAAKniI,UAAWS,EAAO,GAAD,OAAIqhI,EAAJ,SAAwB5hI,MAAOijI,MAjCvD,IA2DFV,GAAS77F,aAAe,CACtB87F,YAAa,GACbP,WAAY,EACZD,aAAc,EACdlrH,MAAO,SACP7M,YAAY,EACZ28H,WAAW,EACX/sH,SAAU,GAGG0oH,UC1Pf,MAAML,GAAoBv5H,cAAWnI,IAAK,CACxCvD,KAAM,CACJw8B,SAAU,WACVmI,OAAQ,UACRlH,OAAQ,OACRN,YAAa,MACbY,aAAc,OAEhBgkC,UAAW,CACTvlC,SAAU,WACVgB,MAAO,OACPC,OAAQ,QAEV+jG,UAAW,CACThkG,MAAO,OACPC,OAAQ,OACR,oBAAqB,OACrB2hB,UAAW,OACXikE,WAAY,kBACZz6E,gBAAiB,cACjBq0F,WAAY,YACZx9H,gBAAiB8D,EAAMnE,QAAQC,QAAQZ,UACvC+9B,SAAU,aAEZyL,UAAW,CACTzL,SAAU,WACViG,IAAK,EACLkY,OAAQ,EACRl7C,gBAAiB8D,EAAMnE,QAAQE,UAAUb,eAIvCmrI,GAAU/oI,IAAMoI,MAAK,IAUG,IAVF,OAC1B4gI,EAD0B,KAE1BC,EAF0B,OAG1BC,EAH0B,KAI1BC,EAJ0B,SAK1Bt5H,EAL0B,QAM1B9Q,EAN0B,QAO1BwD,EAP0B,UAQ1BP,EAR0B,QAS1BV,EACA,cAAe8zC,GAAY,EAC3B,MAAM3yC,EAAS2hI,GAAkB9iI,GAE3B6/B,EAAchyB,uBAAawxB,IAC/Bp+B,GAAWA,EAAQo+B,EAAnB,GACC,CAACp+B,IAEE6mI,EAAiBxgI,mBAAQ,KACZ,IAAbiH,EACK,CAACo+C,WAAY,WAEL,IAAbp+C,EACK,CACL6iD,KAAM,KACNxuB,MAAO,MAGJ,CACLwuB,KAAK,GAAD,OAAK22E,gBAAoB,IAAdx5H,EAAS,GAAU,EAAG,KAAjC,KACJq0B,MAAM,GAAD,OAAKmlG,gBAA0B,KAAnB,EAAIx5H,EAAS,IAAW,EAAG,KAAvC,OAEN,CAACA,IAEJ,OAAO,sBACLtN,QAAS4+B,EACTn/B,UAAW+iC,mBAAK/iC,EAAWS,EAAOtD,MAClC+C,MAAO,CAACwwD,KAAK,GAAD,OAAc,IAATs2E,EAAL,KAAsB9kG,MAAM,GAAD,OAAkB,KAAZ,EAAI+kG,GAAV,MACvC,cAAa7zF,EAJR,SAML,eAAClW,GAAA,EAAD,CAAS+D,UAAU,SAASgc,WAAY,EAAGqqF,WAAY,EAAGrqG,MAAOlgC,GAAW,GAAI05E,OAAK,EAArF,SACE,sBAAKz2E,UAAWS,EAAOy+D,UAAvB,SACE,sBAAKl/D,UAAWS,EAAOk+H,UAAWz+H,MAAO,CAACq8C,UAAU,UAAD,OAAY4qF,EAAOD,EAAnB,MAAnD,SACE,sBACElnI,UAAWS,EAAO2kC,UAClBllC,MAAOknI,WAXjB,IAiCFL,GAAQngG,aAAe,CAAC,EAGTmgG,UCxFf,MAAMn+H,GAAYC,cAAWnI,IAAK,CAChCvD,KAAM,CACJw9B,MAAO,OACPC,OAAQ,OACR/9B,UAAW,cAEbqiE,UAAW,CACTvkC,MAAO,OACPC,OAAQ,OACRv5B,QAAS,OACT09B,cAAe,SACfl3B,WAAY,SACZm3B,eAAgB,UAElBuoG,UAAW,CACT5sG,MAAO,OACPC,OAAQ,QAEVf,SAAU,CACRwL,KAAM,WACN1K,MAAO,OACPC,OAAQ,QAEVk/D,KAAM,CACJn/D,MAAO,OACPC,OAAQ,OACR/9B,UAAW,aACXwE,QAAS,OACT04F,oBAAqB,WACrBynC,iBAAkB,WAClBtmG,aAAcx6B,EAAMkH,QAAQ,KAC5Bq6B,cAAevhC,EAAMkH,QAAQ,MAE/B4/H,KAAM,CACJC,WAAY,EACZC,QAAS,EACT/tG,SAAU,YAEZpgB,OAAQ,CACNohB,MAAO,OACPC,OAAQ,OACRjB,SAAU,WACVE,SAAU,UAEZ8tG,OAAQ,CACN5vF,OAAQ,GACRpe,SAAU,WACVme,QAAS,GACT4Y,KAAM,EACNxuB,MAAO,GAET6qE,MAAO,CACL06B,WAAY,EACZC,QAAS,EACT9sG,OAAQ,QAEVgtG,OAAQ,CACNH,WAAY,EACZC,QAAS,GAEX56B,MAAO,CACL26B,WAAY,EACZC,QAAS,GAEXG,WAAY,CACVnuG,UAAW,EACXM,aAAc,EACdyJ,SAAU,EACV+O,SAAU,SACVjX,SAAU,UAEZusG,eAAgB,CACdvsG,SAAU,SAEZwsG,MAAO,CACL,WAAY,CACVlN,UAAW,0CAEb,iBAAkB,CAChBA,UAAW,0CAGf59F,MAAO,CACLwG,SAAU,EACVp6B,WAAY3I,EAAMkH,QAAQ,IAC1BE,YAAapH,EAAMkH,QAAQ,KAK7BogI,YAAa,CACXhmG,WAAY,GACZC,cAAe,IAEjBmvB,UAAW,CACT13B,UAAW,kBAEb+Y,OAAQ,CACN7X,OAAQ,OACRyK,KAAM,WACN/K,YAAa,OACbY,aAAc,OACd75B,QAAS,OACTwG,WAAY,UAEdzY,IAAK,CACHsqC,UAAWh5B,EAAMkH,QAAQ,KACzB+yB,MAAO,OACPt5B,QAAS,OACT09B,cAAe,MACfC,eAAgB,SAChBn3B,WAAY,kBA6dDogI,OA1dOjqI,IAAMoI,MAAK,IAqC1B,IArC2B,MAChCs+E,EADgC,MAEhCwjD,EAFgC,KAGhCC,EAHgC,MAIhChzF,EAJgC,KAKhCuuF,EALgC,MAMhC0E,EANgC,eAOhCC,EAPgC,OAQhCC,EARgC,SAShCx1F,EATgC,aAUhCy1F,EAVgC,UAWhCnjG,EAXgC,cAYhCojG,EAZgC,cAahCC,EAbgC,cAchCC,EAdgC,YAehCC,EAfgC,YAgBhCC,EAhBgC,UAiBhCC,EAjBgC,UAkBhCC,EAlBgC,YAmBhCC,EAnBgC,YAoBhCC,EApBgC,QAqBhCzoI,EArBgC,cAsBhC0oI,EAtBgC,cAuBhCC,EAvBgC,UAwBhClpI,EAxBgC,QAyBhCV,EAzBgC,UA0BhC8pC,EA1BgC,SA2BhC+/F,EA3BgC,SA4BhCC,EA5BgC,SA6BhCC,EA7BgC,SA8BhCC,EA9BgC,SA+BhCC,EA/BgC,SAgChCC,EAhCgC,WAiChCC,EAjCgC,iBAkChCC,EAlCgC,cAmChCC,EACA,cAAev2F,GACX,EACJ,MAAM3yC,EAASmI,GAAUtJ,GAenBgzC,EAdmBzpC,cAAYnI,IACnC,MAAMP,EAAQilC,EAAY1kC,EAAMnE,QAAQE,UAAUhB,KAAOiF,EAAMnE,QAAQC,QAAQf,KAC/E,MAAO,CACLssI,MAAO,CACL,OAAS,aAAT,OAAuB5nI,GACvB,oBAAqB,CACnBvD,gBAAiBqsI,EAAgB9oI,EAAQ,SAE3C,oBAAqB,CACnBvD,gBAAiBssI,EAAgB/oI,EAAQ,UAP/C,GAYoBkyC,GAEhBmF,EAAeoB,YAAeR,GAAS,iBACvCwxF,EAActjH,mBAEdujH,GAAgBnG,GAAyB,KAAb,OAAJyE,QAAI,IAAJA,OAAA,EAAAA,EAAM75I,QAC9Bw7I,EAASplD,EAAMnpE,QAAU3B,GAAMiB,UACrC6oH,EAAOmG,EAHiB,EAGgBzB,EAAQ1E,EAIhD,IAAIvuD,EAAO00D,EAAenlD,EAAMvuF,IAPR,EAOgCuuF,EAAM5gD,IAC1DukG,IACGhwI,gBAAM88E,KACTA,GAAQuuD,IAKZ,MAAOqG,EAAW30D,EAAMC,GAAQzuE,mBAAQ,KACtC,GAAIvO,gBAAM8vI,GACR,MAAO,CAAC,KAAM,KAAM,MAEtB,MACM9yD,EAAOjpF,KAAK03C,OAAOqkG,EAAKl8I,KAAI41B,GAAQA,EAAKpF,SACzCw4B,EAASD,GAAUkzF,EAAMlxH,MAAO,CAFzB,EAEgCq+D,IAS7C,MAAO,CARW8yD,EAAKl8I,KAAK+9I,IACnB,IACFA,EACH5/I,MAAO4/I,EAAOrgJ,MACdU,IAAK2/I,EAAOrgJ,MAAQ+5I,EACpB1sH,MAAOi+B,EAAO+0F,EAAOvtH,WARZ,EAWY44D,EAAzB,GACC,CAAC8yD,EAAMzE,EAAMwE,EAAMlxH,QAIhBizH,EAAkB98H,uBAAagoC,GAC3BkzF,IAAmBhwI,gBAAK,OAAC88C,QAAD,IAACA,OAAD,EAACA,EAAQ,IACrC,CAACA,EAAM,GAAIA,EAAM,GAAKuuF,GACtBvuF,GACH,CAACkzF,EAAgB3E,IAGdwG,EAAkB/8H,uBAAagoC,GAC3BkzF,IAAmBhwI,gBAAK,OAAC88C,QAAD,IAACA,OAAD,EAACA,EAAQ,IACrC,CAACA,EAAM,GAAIA,EAAM,GAAKuuF,GACtBvuF,GACH,CAACkzF,EAAgB3E,IAEdyG,EAAgBvjI,mBAAQ,IACrBqjI,EAAgB,QAAC90F,QAAD,IAACA,OAAD,EAACA,EAAOi1F,IAAR,OAAaj1F,QAAb,IAAaA,OAAb,EAAaA,EAAOk1F,OAC1C,CAACl1F,EAAO80F,IAILK,EAAoBn9H,uBAAY,CAACwxB,EAAOwW,KAC5CuzF,GAAiBA,EAAc/pG,EAAOurG,EAAgB/0F,GAAtD,GACC,CAACuzF,EAAewB,IAGb/qG,GAAchyB,uBAAY,CAACwxB,EAAO9c,KACtCthB,GAAWA,EAAQo+B,EAAOkrG,EACtB,CAAChoH,EAAKz3B,MAAOy3B,EAAKz3B,OAClB,CAACy3B,EAAKz3B,MAAOi+I,EAAiBxmH,EAAKz3B,MAAQy3B,EAAKx3B,KAFpD,GAGC,CAACw/I,EAActpI,EAAS8nI,IAIrBkC,GAAoBp9H,uBAAY,CAACwxB,EAAOwW,KACvCszF,IAGLtzF,EAAQ+0F,EAAgB/0F,GAGpBy0F,EAAYpzH,SACdozH,EAAYpzH,QAAQ,KAAO2+B,EAAM,IACjCy0F,EAAYpzH,QAAQ,KAAO2+B,EAAM,KAGnCy0F,EAAYpzH,QAAU2+B,EACtBszF,EAAc9pG,EAAOwW,IAArB,GACC,CAACszF,EAAeyB,IAGbM,GAAqBr9H,uBAAY,CAACs9H,EAAKt1F,KAC3C,IAAK/P,EACH,OAAO,EAET,GAAIykG,EACF,OAAOY,EAAIrgJ,QAAU+/I,EAAc,GAErC,MAAM3G,EAAWiH,EAAIpgJ,IAAMogJ,EAAIrgJ,MACzB+L,EAAMkxI,iBAAOlyF,EAAM,GAAKs1F,EAAIrgJ,OAASo5I,EAAU,EAAG,GAClD1/F,EAAMujG,iBAAOlyF,EAAM,GAAKs1F,EAAIrgJ,OAASo5I,EAAU,EAAG,GAExD,QADa1/F,EAAM3tC,GACP,KAGRA,GAAO,GAAK2tC,GAAO,GAGhB,CAAC3tC,EAAK2tC,GAAb,GACC,CAACsB,EAAWykG,EAAcM,IAGvB3C,GAAO5gI,mBAAQ,IACfvO,gBAAM0xI,IAAc1xI,gBAAMqsF,EAAMvuF,MAAQkC,gBAAM88E,GACzC,KAEF,sBAAKn1E,UAAWS,EAAO8Y,OAAvB,SACJ/gB,OAAOsB,OAAOiwI,GAAW99I,KAAI,CAAC41B,EAAMr1B,IAC5B,eAAC,GAAD,CACLw6I,QAASnlH,EAAKz3B,MAAQs6F,EAAMvuF,MAAQg/E,EAAOuP,EAAMvuF,KACjD8wI,MAAOplH,EAAKx3B,IAAMq6F,EAAMvuF,MAAQg/E,EAAOuP,EAAMvuF,KAC7C+wI,OAAQ,EACRC,KAAMtlH,EAAK7K,MAEXja,QAAO,UAAKwd,GAAcsH,EAAKpF,OAAxB,YAAkCF,GAAUgsH,EAAc1mH,EAAKpF,OAAO,IAC7E9c,UAAQ,EACRk/H,cAAY,EACZhxH,SAAU28H,GAAmB3oH,EAAMsoH,GACnC5pI,QAAUo+B,GAAUQ,GAAYR,EAAO9c,IALlCr1B,QASV,CAACu9I,EAAWrlD,EAAMvuF,IAAKg/E,EAAM10E,EAAO8Y,OAAQixH,GAAoBL,EAAehrG,GAAaopG,IAGzFz7B,GAAQlmG,mBAAQ,KACpB,GAAIvO,gBAAM0xI,IAAc1xI,gBAAMqsF,EAAMvuF,MAAQkC,gBAAM88E,GAChD,OAAO,KAET,IAAI7hF,EAGJ,GAAIu2I,EAAc,CAChB,MAAMr0H,EAAS6yH,EAAiB,GAAM3E,EAAO,EAC7CpwI,EAAS,CAAC,CACRE,MAAOu2I,EAAU,GAAG3/I,MACpBqI,IAAKs3I,EAAU,GAAG3/I,MAAQorB,GAG7B,MAAM,GAAI6yH,EAAgB,CACzB,MAAMj+I,EAAQs5I,EAAOt3I,KAAK88F,KAAKxE,EAAMvuF,IAAMutI,GACrCr5I,EAAMq5I,EAAOt3I,KAAK6E,MAAMkkF,EAAOuuD,GACrCpwI,EAASo3I,gBAAYtgJ,EAAOC,GAAK4B,KAAIuB,IAAC,CACpCgG,MAAOhG,EACPiF,IAAKjF,EAAI,GAAMk2I,KAElB,CAED,MAAMvtI,EAAM,IAAI0e,GAAS6vE,EAAMvuF,IAAKuuF,EAAMimD,aAAa52H,GAAG2wE,EAAMl5F,MAAM7B,QAChEm6C,EAAM,IAAIjvB,GAASsgE,EAAMuP,EAAMimD,aAAa52H,GAAG2wE,EAAMl5F,MAAM7B,QAEjE,OAAO,eAAC,GAAD,CACLs3C,UAAU,SACV9qC,IAAKA,EACL2tC,IAAKA,EACLhqB,KAAK,aACLxmB,OAAQA,EACRqvI,WAAY,GACZC,aAAc,GACdrnH,MAAOmpE,EAAMnpE,MACbvb,UAAWS,EAAOqsG,OATpB,GAWC,CAACi9B,EAAWrlD,EAAMvuF,IAAKuuF,EAAMimD,YAAax1D,EAAMkzD,EAAgBwB,EAAcnlD,EAAMnpE,MAAO9a,EAAOqsG,MAAOpoB,EAAMl5F,KAAMk4I,KAEjHkH,GAAcC,IAAgBjkI,mBAAQ,IACpC8iI,EACH,MAAC75I,OAAWA,GACZ,CACF,CACEy3H,eAAgB,eAAC9M,GAAA,EAAD,CACd7gF,SAAS,QACTr6B,QAAS,CAACwrI,cAAerqI,EAAO2wD,WAFlB,kBAIhB9xD,QAAS,CAACyrI,iBAAkBtqI,EAAOunI,cAErC,CACE1gB,eAAgB,eAAC9M,GAAA,EAAD,CACd7gF,SAAS,QACTr6B,QAAS,CAACwrI,cAAerqI,EAAO2wD,WAFlB,kBAIhB9xD,QAAS,CAACyrI,iBAAkBtqI,EAAOunI,gBAGtC,CAAC0B,EAAkBjpI,IAGtB,IAAIuqI,GAuCAC,GArCFD,GADEtmD,EAAMnpE,QAAU3B,GAAMiB,UACR,eAAC,KAAD,CACdtc,QAAS4qI,EACTr2F,SAAUA,EACVqhB,WAAYg1E,EACZ+B,MAAM,EACNlrI,UAAW+iC,mBAAKtiC,EAAOonI,WAAYpnI,EAAOqnI,gBAC1C5+H,QAAQ,SACRouC,aAAa,SACb9jD,MAAM,aACNknB,OAAM,UAAKjd,GAAL,UACN9T,MAAO0/I,EACP8B,mBAAmB,GACnBC,oBAAqB,CAAEzxG,SAAU,OACjC63B,SAAWsoD,IACT6uB,EAAY7uB,GACZivB,EAAYjvB,EAAZ,EAEF/4E,SAAU4nG,EACVh3E,OAAQk3E,EACRz0E,UAAYz1B,IAA8B,UAAdA,EAAMpmC,KAAmBwwI,EAAYM,EAAW,IAG9D,eAACx4E,GAAD,CACdtyD,QAAS4qI,EACTr2F,SAAUA,EACVqhB,WAAYg1E,EACZnpI,UAAWS,EAAOonI,WAClBt1E,WAAYq4E,GACZp3I,MAAOk2I,EAAmB,MAAQ,IAClC//I,MAAO0/I,EACPtoG,SAAU4nG,EACVh3E,OAAQk3E,EACRz0E,UAAYz1B,IAA8B,UAAdA,EAAMpmC,KAAmBwwI,EAAYM,EAAW,IAO9E4B,GADEvmD,EAAMnpE,QAAU3B,GAAMiB,UACR,eAAC,KAAD,CACdtc,QAAS6qI,EACTt2F,SAAUA,EACVqhB,WAAYi1E,EACZ8B,MAAM,EACNlrI,UAAW+iC,mBAAKtiC,EAAOonI,WAAYpnI,EAAOqnI,gBAC1C5+H,QAAQ,SACRouC,aAAa,SACb9jD,MAAM,WACNknB,OAAM,UAAKjd,GAAL,UACN9T,MAAO2/I,EACP6B,mBAAmB,GACnBC,oBAAqB,CAAEzxG,SAAU,OACjC63B,SAAWsoD,IACT8uB,EAAY9uB,GACZkvB,EAAYlvB,EAAZ,EAEF/4E,SAAU6nG,EACVj3E,OAAQm3E,EACR10E,UAAYz1B,IAA8B,UAAdA,EAAMpmC,KAAmBywI,EAAYM,EAAW,IAG9D,eAACz4E,GAAD,CACdtyD,QAAS6qI,EACTt2F,SAAUA,EACVqhB,WAAYi1E,EACZppI,UAAWS,EAAOonI,WAClBt1E,WAAYs4E,GACZr3I,MAAOk2I,EAAmB,MAAQ,IAClC//I,MAAO2/I,EACPvoG,SAAU6nG,EACVj3E,OAAQm3E,EACR10E,UAAYz1B,IAA8B,UAAdA,EAAMpmC,KAAmBywI,EAAYM,EAAW,IAKhF,MAAMv8B,GAAQnmG,mBAAQ,IAChBvO,gBAAM+8E,IAAS/8E,gBAAMg9E,GAChB,KAEF,eAAC,GAAD,CACLp0C,UAAU,OACV9qC,IAAKi/E,EACLtxC,IAAKuxC,EACLv7D,KAAK,KACL9C,MAAOkxH,EAAMlxH,MACbuE,MAAO+sH,EACPtoI,UAAWS,EAAOssG,SAEnB,CAACu7B,EAAQjzD,EAAMD,EAAM8yD,EAAMlxH,MAAOvW,EAAOssG,QAG5C,IAAIs+B,GAEFA,GADmB,KAAb,OAAJlD,QAAI,IAAJA,OAAA,EAAAA,EAAM75I,QACG,eAACkxI,GAAD,IACFnnI,gBAAM8vI,IAA0B,OAAjB3wF,EACb,eAAC,GAAD,CACTtuC,QAAQ,OACR,wBAAgBkqC,EAAhB,gBACA7rC,OAAQ,IAGC,sBAAKvH,UAAWS,EAAOo5B,SAAvB,SACT,uBAAK75B,UAAWS,EAAOq5F,KAAvB,UACGiT,GACD,uBAAK/sG,UAAWS,EAAO+mI,KAAvB,UACGA,IACCgB,GACA,eAAC8C,GAAA,EAAD,CACEx4F,SAAUA,GAAY+2F,GAAiB10D,EAAOuP,EAAMvuF,MAASkyI,EAC7DloI,MAAOilC,EAAY,YAAc,UACjCjvC,IAAKuuF,EAAMvuF,IACX2tC,IAAKqxC,EACLuuD,KAAMA,EACN/5I,MAAOwgJ,EACPppG,SAAUwpG,GACVgB,kBAAmBjB,EACnBkB,kBAAkB,MAClBlsI,QAAS,CAACyoI,MAAOtnI,EAAOsnI,OAASz1F,EAAcy1F,OAC/C/nI,UAAWS,EAAOknI,YAIxB,sBAAK3nI,UAAWS,EAAOmnI,SACtB96B,QAKP,MAAM2+B,GAAY,sBAAKzrI,UAAWS,EAAOw8B,MAAvB,SAChB,eAAC,GAAD,CACEl3B,SAAU2+E,EAAM3+E,SAChBvS,MAAOkxF,EAAMznD,MACbzxC,KAAMk5F,EAAMl5F,KACZ0d,QAAQ,UACRlJ,UAAWS,EAAOirI,UAClB/uF,QAAQ,MAIZ,OAAO,sBAAK38C,UAAW+iC,mBAAK/iC,EAAWS,EAAOtD,MAAO,cAAai2C,EAA3D,SACL,uBAAKpzC,UAAWS,EAAOy+D,UAAvB,WACIwqE,GAAoB,sBAAK1pI,UAAW+iC,mBAAKtiC,EAAO8mI,UAAR,OAAmBjoI,QAAnB,IAAmBA,OAAnB,EAAmBA,EAASioI,WAAhD,SAA6D8D,MACjF1B,GAAiB8B,GACnB,sBAAKzrI,UAAWS,EAAOrR,IAAvB,SACGg6C,EACG,uCACC4hG,GACCtB,IAAqBI,EACnB,sBAAK9pI,UAAWS,EAAOgyC,OAAvB,SACE,eAAC64F,GAAA,EAAD,CACEx4F,SAAUA,GAAay2F,IAAaC,EACpCrpI,MAAOilC,EAAY,YAAc,UACjCjvC,IAAKozI,EACLzlG,IAAK0lG,EACL9F,KAAM+F,EACN9/I,MAAO,CAACwrD,EAAMi1F,IAAKj1F,EAAMk1F,KACzBtpG,SAAU0nG,EACV8C,kBAAmB7C,EACnB8C,kBAAkB,UAGtB,sBAAKxrI,UAAWS,EAAOw8B,QAE1BguG,MAED,WA1BV,I,UC/fK,MAAMU,GAAuB,4CACvBC,GAAkB5tI,IAAMoI,MAAK,IAWnC,IAVP,GACEhL,EADF,MAEE6hC,EAFF,YAGEh7B,EAHF,EAIEzU,EAJF,EAKE2wD,EALF,MAME7U,EANF,UAOED,EAPF,UAQED,EARF,UASEppC,GACI,EACJ,MAAM,WAAE49B,EAAF,aAAc8lB,GAAiBnP,MAC/B,MAACzoC,GAASgC,KACV+9H,EAAYnoF,EAAatoD,GAGzBspF,EAAQ99E,mBAAQ,KACpB,MAAMklI,EAAUluG,EAAWpwC,EAAEuY,UACvBgmI,EAASv+I,EAAEyvC,OAASnY,GAAgBgnH,GACpCE,EAAK,OAAGF,QAAH,IAAGA,OAAH,EAAGA,EAASvwH,MACjB0wH,EAAQz+I,EAAEhC,KACZ,IAAI+iB,GAAK/gB,EAAEhC,MACX,IAAI+iB,GAAKu9H,EAAQtgJ,MAAQ,iBAAiB2oB,SAASrI,GAEvD,MAAO,IACFte,EACHyvC,MAAO8uG,EACPvgJ,KAAMygJ,EACN1wH,MAAOywH,EAJT,GAMC,CAACpuG,EAAYpwC,EAAGse,IAEb4xC,EAAavwC,uBAAY,KAC7B0+H,GAAUn+H,IAAgB,IAAIA,EAAKknC,SAAS,KAA5C,GACC,CAACi3F,IAEEK,EAAoB/+H,uBAAaxjB,IACrCkiJ,GAAUn+H,IAAgB,IAAIA,EAAKywC,EAAG,IAAIzwC,EAAIywC,EAAGnnC,MAAOrtB,MAAxD,GACC,CAACkiJ,IAEJ,OAAO,eAACruF,GAAD,CACLpiD,GAAIA,EACJ6hC,MAAOA,GAAS,YAChBh7B,YAAaA,EACbw7C,OAAQC,EACR19C,UAAWA,EACX+/B,QAAS,uCACP,eAACiU,GAAD,CACEj3C,QAAS4uI,GACTn4I,MAAM,YACN7J,MAAO0/C,EACPtI,SAAWp3C,GAAUkiJ,GAAUn+H,IAAG,IAASA,EAAK27B,UAAW1/C,QAE7D,eAAC0pD,GAAD,CACE1pD,MAAOw0D,EAAEnnC,MACTre,QAASm8C,GACT/3C,QAAQ,qBACRgkC,SAAUmrG,OAjBT,SAqBL,eAACC,GAAD,CACEznD,MAAOA,EACPwjD,MAAO/pF,EACPtJ,SAAS,EACTuzF,MAAO9+F,EACPuU,UAAU,EACVxU,UAAWA,EACXD,UAAWA,EACXu0F,MAAOviI,KA7BX,IClCIwN,GAAYC,cAAWnI,IAAK,CAChCvD,KAAM,CACJw9B,MAAO,OACPC,OAAQ,QAEV2sG,UAAW,CAAC,MAGD4E,GAAQnuI,IAAMoI,MAAK,IAczB,IAd0B,MAC/Bs+E,EAD+B,MAE/BwjD,EAF+B,OAG/BkE,EAH+B,QAI/Bv3F,EAJ+B,MAK/BuzF,EAL+B,iBAM/BsB,EAN+B,cAO/BC,EAP+B,UAQ/BtgG,EAR+B,UAS/BD,EAT+B,MAU/Bu0F,EAV+B,UAW/B39H,EAX+B,QAY/BV,EACA,cAAe8zC,GACX,EACJ,MAAM,WAACxV,EAAD,OAAaymB,EAAb,eAAqBnB,EAArB,uBAAqC2B,GAA0BtQ,KAC/DqI,EAAiBr7C,qBAAWy5C,IAC5B15B,EAAO,OAAGs7B,QAAH,IAAGA,OAAH,EAAGA,EAAgBt7B,QAC1Bm4G,EAAsB50E,IACtBpkD,EAASmI,GAAU,CAACtJ,aACnBxG,EAAQw8D,GAAapS,EAAewhC,EAAM3+E,WAC1CwjI,EAAU8C,GAAe7lI,sBACzBgjI,EAAU8C,GAAe9lI,sBACzBupG,EAAUw8B,GAAe/lI,mBAAS,CAACk+E,QAAOwjD,UAC3Cp3F,EAAUxqB,kBAAO,GACjBqnC,EAAcrnC,kBAAO,GACrBkmH,EAAalmH,mBACbmmH,EAAenmH,kBAAO,GACtBomH,EAAkBpmH,kBAAO,GACzBqmH,EAAkBrmH,kBAAO,IACxB6uB,EAAOy3F,GAAYpmI,mBAAS,CAAC4jI,SAAKv6I,EAAWw6I,SAAKx6I,KAClDs5I,EAAU0D,GAAermI,oBAAS,IAClC4iI,EAAU0D,GAAetmI,oBAAS,IAClCumI,EAAcC,GAAmBxmI,oBAAS,IAC1CymI,EAAcC,GAAmB1mI,oBAAS,GAC3C4+B,EAAYrqB,QAAQjiB,GAC1B4wI,EAAmBrxI,gBAAMqxI,IAAqBjQ,EAAsBiQ,EAGpE,MAAM1+H,EAAM4yB,EAAW8mD,EAAM3+E,UACvB4kI,EAAc/jI,mBAAQ,IAAe,IAAI2H,IAAQ,OAAHvD,QAAG,IAAHA,OAAA,EAAAA,EAAKxf,OAAQ,kBAAoB,CAACwf,IAChFq9H,EAAiB3jD,EAAMnpE,QAAU3B,GAAMY,IAAM,OAAI3qB,EACjDi6I,EAASplD,EAAMnpE,QAAU3B,GAAMiB,UAC/BumC,EAAY96B,kBAAO,IAIlB+iH,GAAU8D,IAAe3mI,mBAASsjI,EAAS,IAAIxhI,KAAS,KACxDghI,GAAU8D,IAAe5mI,mBAASsjI,EAAS,IAAIxhI,KAAS,IAGzD+kI,GAAkBlgI,uBAAYrU,GAC3BA,aAAkB+b,GACrB/b,EAAOib,GAAG42H,GAAahhJ,QACvBmP,GACH,CAAC6xI,IAGE2C,GAAkBngI,uBAAYrU,GAC1BgxI,EACJhxI,EACAA,aAAkB+b,GAChB/b,EAAOib,GAAG42H,GACV,IAAI91H,GAAS/b,EAAQ6xI,IAC1B,CAACA,EAAab,IAGXyD,GAAgBpgI,uBAAYrU,GACxBgxI,EACJhxI,EACAA,aAAkB+b,GAChB/b,EAAOib,GAAG42H,GACV,IAAI91H,GAAS/b,EAAQ4rF,EAAMl5F,MAAMuoB,GAAG42H,IACzC,CAACb,EAAQplD,EAAMl5F,KAAMm/I,IAKlB6C,GAASlnH,iBAAO+mH,GAAgBh1I,gBAAK,OAACS,QAAD,IAACA,OAAD,EAACA,EAAQsxI,KAAd,OAAqBtxI,QAArB,IAAqBA,OAArB,EAAqBA,EAAQ20I,GAA7B,OAAkC30I,QAAlC,IAAkCA,OAAlC,EAAkCA,EAAQsxI,MAC1EsD,GAASpnH,iBAAO+mH,GAAgBh1I,gBAAK,OAACS,QAAD,IAACA,OAAD,EAACA,EAAQuxI,KAAd,OAAqBvxI,QAArB,IAAqBA,OAArB,EAAqBA,EAAQ60I,GAA7B,OAAkC70I,QAAlC,IAAkCA,OAAlC,EAAkCA,EAAQuxI,MAC1EuD,GAAqBhnI,mBAAQ,KACjC,MAAMinI,EAAgB/0I,EAAU,CAC9B3C,IAAKk3I,GAAgBh1I,gBAAMS,EAAOsxI,KAAOtxI,EAAO20I,GAAK30I,EAAOsxI,KAC5DtmG,IAAKupG,GAAgBh1I,gBAAMS,EAAOuxI,KAAOvxI,EAAO60I,GAAK70I,EAAOuxI,WAC1Dx6I,EACJ,IAAI2/D,EACAs+E,EAGJ,GAAI1sF,EAAU5qC,QACZs3H,EAAkBD,EAClBr+E,GAAsB,OAItB,GAAInmB,EACFykG,EAAkBD,EAClBr+E,GAAsB,MACjB,GAGe12D,IAAU+0I,EAAa13I,IAAMq3I,GAAOh3H,SAAWq3H,EAAa/pG,IAAM4pG,GAAOl3H,UAE3Fs3H,EAAkBD,EAClBr+E,GAAsB,IAItBs+E,EAAkBh1I,EACbT,gBAAMm1I,GAAOh3H,cAAW3mB,EAAY,CAACsG,IAAKq3I,GAAOh3H,QAASstB,IAAK4pG,GAAOl3H,cACvE3mB,EACJ2/D,GAAsB,EAEzB,CAEH,OAAQs6E,IAAWzB,EACf,CAACt4I,KAAM,YAAag+I,QAAS3F,EAAO54E,sBAAqBs+E,mBACzD,CAAC/9I,KAAM,YAAayzI,SAAU6E,EAAgB74E,sBAAqBs+E,kBAFvE,GAGC,CAACh1I,EAAQu0I,GAAiBvD,EAAQzB,EAAgBD,EAAO/+F,IACtDwC,GAAMwY,EAAOqgC,EAAM3+E,SAAU8uC,IAAY60F,EAA7B,UAAkD/L,EAAlD,cAAqEiQ,IACvFlnI,qBAAU,KACHrO,gBAAMwzC,MACTuV,EAAU5qC,SAAU,EACrB,GACA,CAACq1B,KAIJ,MAAMmiG,GAAkBpnI,mBAAQ,MAAQ7W,KAAM,UAAWy/D,qBAAqB,KAAQ,IAChFy+E,GAAY5pF,EAAOqgC,EAAM3+E,SAAU8uC,GAAW60F,EAA5B,UAAiD/L,EAAjD,WAAiEqQ,KAGlFE,GAAWC,IAAavnI,mBAAQ,KACrC,IAAIsnI,EACAC,EACJ,GAAIzE,EAAkB,CAAC,IAAD,IACpBwE,EAAS,OAAGD,SAAH,IAAGA,IAAH,UAAGA,GAAW/rI,YAAd,aAAG,EAAkB,GAC9BisI,EAAS,OAAGF,SAAH,IAAGA,IAAH,UAAGA,GAAW/rI,YAAd,aAAG,EAAkB,EAC/B,KAAM,CAAC,IAAD,EACL,MAAMksI,GAAc,OAAHviG,SAAG,IAAHA,IAAA,UAAAA,GAAK3pC,YAAL,eAAW5T,SAAU,EACtC,GAAiB,IAAb8/I,EACFF,EAAYriG,GAAI3pC,KAAK,GAAGvY,MACxBwkJ,EAAYD,OACP,GAAIE,EAAW,EAAG,CACvB,IAAK,MAAMpE,KAAUn+F,GAAI3pC,KACnB7J,gBAAM61I,KACRA,EAAYlE,EAAOrgJ,OAErBwkJ,EAAYnE,EAAOrgJ,OAAS0+I,EAAiB,EAAIx8F,GAAI23F,UAEnDnrI,gBAAM61I,KACRA,EAAYriG,GAAI3pC,KAAK,GAAGvY,OAEtB0O,gBAAM81I,KACRA,EAAYtiG,GAAI3pC,KAAK2pC,GAAI3pC,KAAK5T,OAAS,GAAG3E,OAAS0+I,EAAiB,EAAIx8F,GAAI23F,UAE/E,CACF,CAED,OADA71E,EAAYn3C,SAAU,EACf,CAAC03H,EAAWC,EAAnB,GACC,CAACtiG,GAAKoiG,GAAWvE,EAAkBrB,IAEhCgG,GAAa,OAAGxiG,SAAH,IAAGA,QAAH,EAAGA,GAAK23F,SAErB1wF,GADcz6C,gBAAM61I,KAAc71I,gBAAM81I,KAAc91I,gBAAM88C,GAM5Ds0F,GAAa7iI,mBAAQ,KACzB,GAAIyhI,EACF,OAAOA,EAET,GAAIhwI,gBAAMmxI,IAAanxI,gBAAMkxI,GAC3B,OAEF,MAEM+E,ErGhHH,SAAqB3kJ,EAAO4kJ,EAAOhzH,GAAoB,IAAbizH,IAAY,yDAC3D,MAAMhL,EAAW75I,EAAQ4kJ,EACnBhI,EAASn6I,KAAKwpB,IAAI,GAAKxpB,KAAK2oF,MAAM3oF,KAAK8vB,MAAMsnH,KAE7CM,EAAY2C,GADE,CAAC,GAAK,GAAK,IAAM,GAAK,EAAG,EAAG,IAAK,EAAG,IACdF,GAAQztI,QAAOtL,IACvD,MAAMihJ,GAASD,GAAOhhJ,GAAKg2I,EACrBtwE,EAAQ33C,IAAU3B,GAAMY,KAAMhtB,EAAI,IAAM,EAC9C,OAAOihJ,GAAUv7E,CAAjB,IAGIw7E,EADcn6I,GAAIuvI,GAAYN,GAAUv3I,KAAIuB,GAAKpB,KAAKK,IAAIe,KACnCwH,OAAOygD,GAAQ,GAC5C,OAAOquF,EAAU4K,EAClB,CqGoG0BC,CADT,IAAI95H,GADF20H,EAAWD,EACSoB,EAAY32H,WAAWD,GAAG2wE,EAAMl5F,MAAM7B,QAChCyiJ,EAAQ1nD,EAAMnpE,OACxD,OAAO,IAAI1G,GAASy5H,EAAgB5pD,EAAMl5F,MAAMuoB,GAAG42H,GAAahhJ,OAAhE,GACC,CAAC6/I,EAAUD,EAAUlB,EAAgB+D,EAAQ1nD,EAAMnpE,MAAOmpE,EAAMl5F,KAAMm/I,IAGzEjkI,qBAAU,KACJ2iC,IAAWyH,EAAQt6B,SAAU,EAAlB,GACd,CAAC1d,EAAQuwC,IAGZ3iC,qBAAU,KACHrO,gBAAMwzC,MACTiF,EAAQt6B,SAAU,EACnB,GACA,CAACq1B,KAKJnlC,qBAAU,KACJoqC,EAAQt6B,SAAWne,gBAAK,OAACwzC,SAAD,IAACA,QAAD,EAACA,GAAK3pC,OAIlCqqI,EAAY,CACV7nD,MAAO,CACL3+E,SAAU2+E,EAAM3+E,SAChBva,KAAMk5F,EAAMl5F,KACZm/I,YAAaA,EACbpvH,MAAOmpE,EAAMnpE,MACb0hB,MAAOynD,EAAMznD,MACb9mC,IAAKozI,EACLzlG,IAAK0lG,GAEPtB,QACAxE,KAAM2K,GACNnsI,KAAM2pC,GAAI3pC,MAZZ,GAcC,CAAC4uC,EAASs3F,EAAOv8F,GAAK09F,EAAUC,EAAU6E,GAAe1D,EAAajmD,EAAM3+E,SAAU2+E,EAAMl5F,KAAMk5F,EAAMnpE,MAAOmpE,EAAMznD,MAAOynD,EAAM1tE,MAAOkxH,IAI5I,MAAM0G,GAAazhI,uBAAYrU,IACpBgxI,GAAUa,EACfhxH,GAAa,IAAI9E,GAAS/b,EAAQ6xI,GAAa52H,GAAG2wE,EAAMl5F,MAAM7B,SAC9DmP,GACH,CAAC6xI,EAAab,EAAQplD,EAAMl5F,OAK/Bkb,qBAAU,KACR,IAAI2jI,EACAD,EACAj0I,EACA2tC,EACA+qG,GAAS,EACTC,GAAS,EAGb,MAAMC,EAAQ,CAACxmG,EAAQzvC,EAAQ3C,KAC7B,MAAMugB,EAAOvgB,EAAM/J,KAAK+J,IAAM/J,KAAK03C,IACnC,OAAIuF,EACKvwC,EAEA4d,EAAK6xB,EAAQzvC,EACrB,EAEGk2I,EAAW,CAACzmG,EAAQzvC,IAAWi2I,EAAMxmG,EAAQzvC,GAAQ,GACrDm2I,EAAW,CAAC1mG,EAAQzvC,IAAWi2I,EAAMxmG,EAAQzvC,GAAQ,GAEtDT,gBAAM61I,KAAe71I,gBAAM81I,MAE1B91I,gBAAMS,IACRsxI,EAAM8D,GACN7D,EAAM8D,GACNh4I,EAAM+3I,GACNpqG,EAAMqqG,IAEGr1I,aAAkB+b,IAC3Bu1H,EAAMtxI,EAAOib,GAAG42H,GAAahhJ,QAC7B0gJ,EAAMvxI,EAAOib,GAAG42H,GAAahhJ,QAC7BwM,EAAM64I,EAASd,GAAW9D,GAC1BtmG,EAAMmrG,EAASd,GAAW9D,KAK1BwE,EAASx2I,gBAAMS,EAAO20I,IACtBqB,EAASz2I,gBAAMS,EAAO60I,IACtBvD,EAAMtxI,EAAOsxI,KAAOtxI,EAAO20I,GAC3BpD,EAAMvxI,EAAOuxI,KAAOvxI,EAAO60I,GAC3BvD,EAAMA,aAAev1H,GAAWu1H,EAAIr2H,GAAG42H,GAAahhJ,QAAUygJ,EAC9DC,EAAMA,aAAex1H,GAAWw1H,EAAIt2H,GAAG42H,GAAahhJ,QAAU0gJ,EAE1DhyI,gBAAM+xI,IACRj0I,EAAM64I,EAASd,GAAW7D,GAC1BD,EAAMj0I,GAENA,EAAM64I,EAASd,GAAW9D,GAExB/xI,gBAAMgyI,IACRvmG,EAAMmrG,EAASd,GAAW/D,GAC1BC,EAAMvmG,GAENA,EAAMmrG,EAASd,GAAW9D,IAG9BmD,GAAOh3H,QAAUrgB,EACjBu3I,GAAOl3H,QAAUstB,EACjBkpG,EAAgB6B,GAChB3B,EAAgB4B,GAChBzC,EAAYl2I,GACZm2I,EAAYxoG,GACZ8oG,EAAS,CAACxC,IAAKA,EAAKC,IAAKA,IACzB8C,GAAYyB,GAAWxE,IACvBgD,GAAYwB,GAAWvE,IACvByC,IACAD,IACD,GACA,CAACqB,GAAWC,GAAWr1I,EAAQ6xI,EAAaiE,GAAY5jI,EAAK8+H,EAAQzgG,IAIxE,MAAM6lG,GAAgB/hI,uBAAagoC,IAC7B20F,GACK30F,EAAM,GAAKA,EAAM,IAAM,KAG/B,CAAC20F,IAGEqF,GAAkBhiI,uBAAaxjB,IAEnC,IAAIqH,EAII,IAAD,GALHq4C,IAAWyH,EAAQt6B,SAAU,GAE7BszH,IACFngJ,EAAMylJ,WAAW,EAAG,GACpBp+I,EAAM4yI,aAAQj6I,IAEdqH,EAAG,UAAGrH,EAAM8tB,cAAT,aAAG,EAAc9tB,MAEtB+iJ,EAAgBl2H,SAAU,EAC1B22H,GAAYn8I,GACZ87I,IACAD,GAAa,GACZ,CAAC/C,EAAQzgG,IAGNgmG,GAAkBliI,uBAAaxjB,IAGnC,IAAIqH,EAII,IAAD,GANHq4C,IAAWyH,EAAQt6B,SAAU,GACjCs6B,EAAQt6B,SAAU,EAEdszH,IACFngJ,EAAMylJ,WAAW,EAAG,GACpBp+I,EAAM4yI,aAAQj6I,IAEdqH,EAAG,UAAGrH,EAAM8tB,cAAT,aAAG,EAAc9tB,MAEtBgjJ,EAAgBn2H,SAAU,EAC1B42H,GAAYp8I,GACZ87I,IACAD,GAAa,GACZ,CAAC/C,EAAQzgG,IAGNimG,GAAkBniI,uBAAaxjB,IACnC,IAAI4U,EACJ,GAAIurI,EACGttB,aAAQ7yH,GAGXA,EAAQi6I,aAAQj6I,GAFhB4U,EAAQ,0BAIL,CACL,MAAM/U,EAAS0wB,OAAOnjB,WAAWpN,GAC7B42B,MAAM/2B,GACR+U,EAAQ,yBAER5U,EAAQ4jJ,GAAc/jJ,EAEzB,EACIsgJ,EAASngJ,EAAQA,EAAMA,OAASwrD,EAAMk1F,MACzC9rI,EAAQ,wCAENA,EACFsuI,EAAYtuI,IAEZmuI,EAAgBl2H,SAAU,EAC1B8+C,GAAU5nD,IACD,CACL08H,IAAKzgJ,EACL0gJ,IAAKiD,GAAgBj1I,gBAAK,OAACqV,QAAD,IAACA,OAAD,EAACA,EAAK28H,KAAOb,EAAW97H,EAAI28H,SAG3D,GACA,CAACP,EAAQx0E,EAAWg4E,GAAiBC,GAAe/D,EAAUr0F,IAG3Do6F,GAAkBpiI,uBAAaxjB,IACnC,IAAI4U,EACJ,GAAIurI,EACGttB,aAAQ7yH,GAGXA,EAAQi6I,aAAQj6I,GAFhB4U,EAAQ,wBAIL,CACL,MAAM/U,EAAS0wB,OAAOnjB,WAAWpN,GAC7B42B,MAAM/2B,GACR+U,EAAQ,yBAER5U,EAAQ4jJ,GAAc/jJ,EAEzB,EACIsgJ,EAASngJ,EAAQA,EAAMA,OAASwrD,EAAMi1F,MACzC7rI,EAAQ,yCAENA,EACFuuI,EAAYvuI,IAEZouI,EAAgBn2H,SAAU,EAC1B8+C,GAAU5nD,IACD,CACL08H,IAAKkD,GAAgBj1I,gBAAK,OAACqV,QAAD,IAACA,OAAD,EAACA,EAAK08H,KAAOb,EAAW77H,EAAI08H,KACtDC,IAAK1gJ,MAGV,GACA,CAACmgJ,EAAQx0E,EAAWg4E,GAAiBC,GAAehE,EAAUp0F,IAM3Dm1F,GAAoBn9H,uBAAawxB,IACrC,MAAMh1C,EAAQ6iJ,EAAWh2H,SACpBne,gBAAM1O,IAAU8iJ,EAAaj2H,UAChC8+C,EAAU,CACR80E,IAAKkD,GAAgB3jJ,EAAM,IAC3B0gJ,IAAKiD,GAAgB3jJ,EAAM,MAE7B8iJ,EAAaj2H,SAAU,EACxB,GACA,CAAC8+C,EAAWg4E,KAIT/C,GAAoBp9H,uBAAY,SAACwxB,EAAOh1C,GAA4B,IAArBgpE,IAAoB,yDACnEtpB,IAAWyH,EAAQt6B,SAAU,GACjC,MAAM08C,GAASP,GAAYu8E,GAAcvlJ,GACrCupE,IACFu5E,EAAaj2H,SAAU,EACvBg2H,EAAWh2H,QAAU7sB,EACrBijJ,EAAS,CAACxC,IAAKzgJ,EAAM,GAAI0gJ,IAAK1gJ,EAAM,KACpCwjJ,GAAYyB,GAAWjlJ,EAAM,KAC7ByjJ,GAAYwB,GAAWjlJ,EAAM,KAC7BqjJ,GAAgB,GAChBE,GAAgB,GAChBJ,IACAD,IAEH,GAAE,CAACqC,GAAe1C,EAAYoC,GAAYvlG,IAIrCmmG,GAAgBriI,uBAAY,KAChCu/H,EAAgBl2H,SAAW84H,GAAgBjG,GAA3C,GACC,CAACA,GAAUiG,GAAiB5C,IAIzB+C,GAAgBtiI,uBAAY,KAChCw/H,EAAgBn2H,SAAW+4H,GAAgBjG,GAA3C,GACC,CAACA,GAAUiG,GAAiB5C,IAE/B,OAAO,sBAAK3sI,UAAW+iC,mBAAK/iC,EAAWS,EAAOtD,MAAO,cAAai2C,EAA3D,SACL,eAAC,GAAD,CACE+0F,KAAI,OAAEp4B,QAAF,IAAEA,OAAF,EAAEA,EAAU7tG,KAChBwiF,MAAK,OAAEqrB,QAAF,IAAEA,OAAF,EAAEA,EAAUrrB,MACjBwjD,MAAK,OAAEn4B,QAAF,IAAEA,OAAF,EAAEA,EAAUm4B,MACjBxE,KAAI,OAAE3zB,QAAF,IAAEA,OAAF,EAAEA,EAAU2zB,KAChBuF,cAAe8D,EACf7D,cAAe+D,EACfn6F,SAAUA,GACVs1F,MAAOA,EACPjzF,MAAOA,EACP/P,UAAWA,EACXijG,eAAgBA,EAChBE,aAAcjnH,EAAU,QAAU,QAClCgnH,OAAQ1uH,GAAMY,IACdiuH,cAAe8B,GACf7B,cAAe4B,GACfzB,UAAW2G,GACX1G,UAAW2G,GACX9G,YAAawG,GACbvG,YAAayG,GACbtG,YAAauG,GACbtG,YAAauG,GACbjwI,QAAS,CAACioI,UAAS,OAAEjoI,QAAF,IAAEA,OAAF,EAAEA,EAASioI,WAC9BhnI,QAAS,CAACo+B,EAAOh1C,KACf4gJ,GAAkB5rG,EAAOh1C,GAAO,GAChC2gJ,GAAkB3rG,EAAOh1C,EAAzB,EAEFw/I,SAAUA,EACVC,SAAUA,EACVC,SAAUA,GACVC,SAAUA,GACVC,SAAUA,EACVC,SAAUA,EACVpgG,UAAWA,EACXqgG,WAAYA,GACZC,iBAAkBA,EAClBC,cAAeA,EACf,wBAAgBv2F,EAAhB,iBAtCJ,IAoEF+4F,GAAMvlG,aAAe,CACnBwlG,OAAQ,GACRhE,MAAO,GACPzK,MAAO,UACP,cAAe,cAMjB,MAAM+R,GAAsB7mI,cAAWnI,IAAK,CAC1CvD,KAAM,CACJkE,QAAS,OACT09B,cAAe,UAEjBwoG,UAAW,CACT3sG,OAAQ,YAGN+0G,GAAa3xI,IAAMoI,MAAK,IAavB,IAbwB,MAC7B5S,EAD6B,SAE7BuS,EAF6B,YAG7B9D,EAH6B,OAI7BmqI,EAJ6B,QAK7Bv3F,EAL6B,aAM7B2pF,EAN6B,MAO7B4J,EAP6B,iBAQ7BsB,EAR6B,iBAS7BkG,EAT6B,MAU7BjS,EAV6B,UAW7B39H,EACA,cAAeozC,GACX,EACJ,MAAM,WAACxV,GAAc2W,MACf,MAACzoC,GAASgC,KACVrN,EAASivI,MACR14H,EAAOynH,GAAYj4H,mBAASg4H,GAAgB5gG,EAAW73B,GAAUiR,OAClEuE,EAAQqiB,EAAW73B,GAAUwV,MAC7BuuH,EAASvuH,IAAU3B,GAAMiB,WACxBwuB,EAAWwmG,GAAgBrpI,mBAASnO,gBAAMu3I,GAAoB9F,EAAS8F,GACxEpiJ,EAAIoZ,mBAAQ,iBAChB,CACEb,WACAwV,QACA/vB,KAAM,IAAI+iB,IAAK,UAAAqvB,EAAW73B,UAAX,eAAsBva,OAAQ,iBAAiB2oB,SAASrI,GAJzD,GAMf,CAAC/F,EAAU63B,EAAYriB,EAAOzP,IAC3BqyC,EAAIv3C,mBAAQ,MAAQoQ,MAAOA,KAAS,CAACA,IAGrChM,EAAM4yB,EAAW73B,GACjBq1C,EAAYn5C,IAAW,OAAI+I,QAAJ,IAAIA,OAAJ,EAAIA,EAAK/I,cAAe,GAC/Co5C,EAAa7nD,IAAK,OAAIwX,QAAJ,IAAIA,OAAJ,EAAIA,EAAKxX,OAG3BusC,EAAU,eAACiU,GAAD,CACdrqD,MAAO0/C,EACP71C,MAAM,OACNuJ,QAAS4uI,GACT5qG,SAAWp3C,GAAUkmJ,EAAalmJ,KAGpC,OAAO,uBAAKqW,UAAW+iC,mBAAKtiC,EAAOtD,KAAM6C,GAAlC,UACL,eAAC,GAAD,CACExM,MAAO6nD,EACPt1C,SAAUA,EACV9D,YAAam5C,EACbpkC,MAAOA,EACPyiC,cAAeglF,EACfjlF,kBAAmBkwF,EACnB3pG,QAASA,IAEX,eAACosG,GAAD,CACEznD,MAAOl3F,EACP06I,MAAO/pF,EACPiuF,OAAQA,EACRv3F,QAASA,EACTuzF,MAAOA,EACPsB,iBAAkBA,EAClBC,eAAa,EACbtgG,UAAWA,EACXD,WAAS,EACTu0F,MAAOA,EACPr+H,QAAS,CAACioI,UAAW9mI,EAAO8mI,WAC5B,cAAan0F,MAtBjB,IA0CFu8F,GAAW/oG,aAAe,CACxBwlG,OAAQ,GACRhE,MAAO,GACPzK,MAAO,UACP,cAAe,cAGFgS,UC7oBf,MAAM/mI,GAAYC,cAAWnI,IAAK,CAChCo5F,KAAM,CACJpgE,UAAWh5B,EAAMkH,QAAQ,IAE3BkoI,cAAe,CACbl1G,OAAQ,aAgEGm1G,OA5De/xI,IAAMoI,MAAK,IAGlC,IAHmC,GACxChL,KACG+jB,GACC,EACJ,MAAM,SAACtR,EAAD,KAAWhO,GAAQ0B,qBAAWq4H,IAC9B/kF,EAAUh1C,GAAQzE,IAAOyS,EACzBpN,EAASmI,KAEf,OAAO,eAAC4zH,GAAD,CAAephI,GAAIA,KAAQ+jB,EAA3B,SACL,gBAACw9G,GAAD,CAAW38H,UAAWS,EAAOq5F,KAA7B,UACE,eAAC+iC,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,4BACT8uC,QAASA,EACT70C,UAAWS,EAAOqvI,kBAGtB,eAACjT,GAAD,CAAe/9D,GAAI,EAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,yCACT8uC,QAASA,EACTkrF,gBAAc,MAGlB,eAAClD,GAAD,CAAe/9D,GAAI,EAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,0CACT8uC,QAASA,EACTkrF,gBAAc,MAGlB,eAAClD,GAAD,CAAe/9D,GAAI,EAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,4CACT8uC,QAASA,EACTkrF,gBAAc,MAGlB,eAAClD,GAAD,CAAe/9D,GAAI,EAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,8CACT8uC,QAASA,EACThN,YAAY,iBACZk4F,gBAAc,MAGlB,eAAClD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,8BACT8uC,QAASA,EACT6uF,KAAM,UA1Cd,IC4DasM,OAhFgBhyI,IAAMoI,MAAK,IAGnC,IAHoC,GACzChL,KACG+jB,GACC,EACJ,MAAM,SAACtR,EAAD,KAAWhO,GAAQ0B,qBAAWq4H,IAC9B/kF,EAAUh1C,GAAQzE,IAAOyS,EAE/B,OAAO,eAAC2uH,GAAD,CAAephI,GAAIA,KAAQ+jB,EAA3B,SACL,gBAACw9G,GAAD,WACE,eAACE,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,mCACT8uC,QAASA,EACTirF,eAAa,MAGjB,eAACjD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,4CACT8uC,QAASA,EACTiqB,GAAI,EACJghE,eAAa,MAGjB,eAACjD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,2CACT8uC,QAASA,EACTiqB,GAAI,GACJghE,eAAa,MAGjB,eAACjD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,+CACT8uC,QAASA,EACTkrF,gBAAc,MAGlB,eAAClD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,2CACT8uC,QAASA,EACT+qF,YAAa,MAGjB,eAAC/C,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,wDACT8uC,QAASA,MAGb,eAACgoF,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,wCACT8uC,QAASA,EACTkrF,gBAAc,MAGlB,eAAClD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,wCACT8uC,QAASA,EACTkrF,gBAAc,MAGlB,eAAClD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,+CACT8uC,QAASA,EACTkrF,gBAAc,UA/DtB,ICsBakQ,OA7BajyI,IAAMoI,MAAK,IAGhC,IAHiC,GACtChL,KACG+jB,GACC,EACJ,MAAM,SAACtR,EAAD,KAAWhO,GAAQ0B,qBAAWq4H,IAC9B/kF,EAAUh1C,GAAQzE,IAAOyS,EAE/B,OAAO,eAAC2uH,GAAD,CAAephI,GAAIA,KAAQ+jB,EAA3B,SACL,gBAACw9G,GAAD,CAAW/0H,QAAS,EAApB,UACE,eAACi1H,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,yCACT8uC,QAASA,MAGb,eAACgoF,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,4CACT8uC,QAASA,EACTkrF,gBAAc,UAZtB,ICkDamQ,OAxDgBlyI,IAAMoI,MAAK,IAGnC,IAHoC,GACzChL,KACG+jB,GACC,EACJ,MAAM,SAACtR,EAAD,KAAWhO,GAAQ0B,qBAAWq4H,IAC9B/kF,EAAUh1C,GAAQzE,IAAOyS,EAE/B,OAAO,eAAC2uH,GAAD,CAAephI,GAAIA,KAAQ+jB,EAA3B,SACL,gBAACw9G,GAAD,WACE,eAACE,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,qDACT8uC,QAASA,EACTiqB,GAAI,GACJghE,eAAa,MAGjB,eAACjD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,kDACT8uC,QAASA,EACTiqB,GAAI,GACJihE,gBAAc,MAGlB,eAAClD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,gDACT8uC,QAASA,EACTiqB,GAAI,GACJghE,eAAa,MAGjB,eAACjD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,uDACT8uC,QAASA,EACTiqB,GAAI,GACJghE,eAAa,MAGjB,eAACjD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,iDACT8uC,QAASA,EACTiqB,GAAI,GACJghE,eAAa,UAvCrB,IC6DaqQ,OAnEUnyI,IAAMoI,MAAK,IAG7B,IAH8B,GACnChL,KACG+jB,GACC,EACJ,MAAM,SAACtR,EAAD,KAAWhO,GAAQ0B,qBAAWq4H,IAC9B/kF,EAAUh1C,GAAQzE,IAAOyS,EAE/B,OAAO,eAAC2uH,GAAD,CACLphI,GAAIA,EACJ2kC,QAAS,eAACi9F,GAAD,CACPj3H,SAAS,6BACTpc,MAAM,MACNsY,YAAY,0BAEVkd,EAPC,SASL,gBAACw9G,GAAD,WACE,eAACE,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,mDACT8uC,QAASA,EACTiqB,GAAI,GACJghE,eAAa,MAGjB,eAACjD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,oDACT8uC,QAASA,EACTiqB,GAAI,OAGR,eAAC+9D,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,6DACT8uC,QAASA,EACTiqB,GAAI,OAGR,eAAC+9D,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,mEACT8uC,QAASA,EACTiqB,GAAI,OAGR,eAAC+9D,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,wDACT8uC,QAASA,EACTirF,eAAa,MAGjB,eAACjD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,kDACT8uC,QAASA,EACTirF,eAAa,UAlDrB,IC+BasQ,OAvCSpyI,IAAMoI,MAAK,IAG5B,IAH6B,GAClChL,KACG+jB,GACC,EACJ,MAAM,SAACtR,EAAD,KAAWhO,GAAQ0B,qBAAWq4H,IAC9B/kF,EAAUh1C,GAAQzE,IAAOyS,EAE/B,OAAO,eAAC2uH,GAAD,CACLphI,GAAIA,EACJ2kC,QAAS,eAACi9F,GAAD,CACPj3H,SAAS,6BACTpc,MAAM,KACNsY,YAAY,yBAEVkd,EAPC,SAQL,gBAACw9G,GAAD,WACE,eAACE,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,oCACT8uC,QAASA,EACTiqB,GAAI,GACJghE,eAAa,MAGjB,eAACjD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,iDACT8uC,QAASA,EACTiqB,GAAI,GACJghE,eAAa,UAtBrB,ICwCauQ,OA/CSryI,IAAMoI,MAAK,IAG5B,IAH6B,GAClChL,KACG+jB,GACC,EACJ,MAAM,SAACtR,EAAD,KAAWhO,GAAQ0B,qBAAWq4H,IAC9B/kF,EAAUh1C,GAAQzE,IAAOyS,EAE/B,OAAO,eAAC2uH,GAAD,CACLphI,GAAIA,EACJ2kC,QAAS,eAACi9F,GAAD,CACPj3H,SAAS,6BACTpc,MAAM,KACNsY,YAAY,yBAEVkd,EAPC,SAQL,gBAACw9G,GAAD,WACE,eAACE,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,oCACT8uC,QAASA,EACTiqB,GAAI,GACJghE,eAAa,MAGjB,eAACjD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,mDACT8uC,QAASA,EACTiqB,GAAI,GACJghE,eAAa,MAGjB,eAACjD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,8CACT8uC,QAASA,EACTiqB,GAAI,GACJghE,eAAa,UA9BrB,ICwDawQ,OA/DUtyI,IAAMoI,MAAK,IAG7B,IAH8B,GACnChL,KACG+jB,GACC,EACJ,MAAM,SAACtR,EAAD,KAAWhO,GAAQ0B,qBAAWq4H,IAC9B/kF,EAAUh1C,GAAQzE,IAAOyS,EAE/B,OAAO,eAAC2uH,GAAD,CACLphI,GAAIA,EACJ2kC,QAAS,eAACi9F,GAAD,CACPj3H,SAAS,6BACTpc,MAAM,MACNsY,YAAY,0BAEVkd,EAPC,SAQL,gBAACw9G,GAAD,WACE,eAACE,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,qCACT8uC,QAASA,EACTiqB,GAAI,GACJghE,eAAa,MAGjB,eAACjD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,uCACT8uC,QAASA,EACTiqB,GAAI,GACJghE,eAAa,MAGjB,eAACjD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,oDACT8uC,QAASA,EACTiqB,GAAI,GACJghE,eAAa,MAGjB,eAACjD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,+CACT8uC,QAASA,EACTiqB,GAAI,GACJghE,eAAa,MAGjB,eAACjD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,wCACT8uC,QAASA,EACTiqB,GAAI,GACJghE,eAAa,UA9CrB,ICiEayQ,OAvEWvyI,IAAMoI,MAAK,IAG9B,IAH+B,GACpChL,KACG+jB,GACC,EACJ,MAAM,SAACtR,EAAD,KAAWhO,GAAQ0B,qBAAWq4H,IAC9B/kF,EAAUh1C,GAAQzE,IAAOyS,EAE/B,OAAO,eAAC2uH,GAAD,CACLphI,GAAIA,EACJ2kC,QAAS,eAACi9F,GAAD,CACPj3H,SAAS,6BACTpc,MAAM,OACNsY,YAAY,2BAEVkd,EAPC,SAQL,gBAACw9G,GAAD,WACE,eAACE,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,sDACT8uC,QAASA,EACTiqB,GAAI,GACJghE,eAAa,MAGjB,eAACjD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,qDACT8uC,QAASA,EACTiqB,GAAI,GACJghE,eAAa,MAGjB,eAACjD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,gDACT8uC,QAASA,EACTiqB,GAAI,GACJghE,eAAa,MAGjB,eAACjD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,mCACT8uC,QAASA,EACTiqB,GAAI,GACJghE,eAAa,MAGjB,eAACjD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,oCACT8uC,QAASA,EACTiqB,GAAI,GACJghE,eAAa,MAGjB,eAACjD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,yDACT8uC,QAASA,EACTiqB,GAAI,GACJghE,eAAa,UAtDrB,IC0Ca0Q,OAhDWxyI,IAAMoI,MAAK,IAG9B,IAH+B,GACpChL,KACG+jB,GACC,EACJ,MAAM,SAACtR,EAAD,KAAWhO,GAAQ0B,qBAAWq4H,IAC9B/kF,EAAUh1C,GAAQzE,IAAOyS,EAE/B,OAAO,eAAC2uH,GAAD,CACLphI,GAAIA,EACJ2kC,QAAS,eAACi9F,GAAD,CACPj3H,SAAS,6BACTpc,MAAM,OACNsY,YAAY,2BAEVkd,EAPC,SAQL,eAACw9G,GAAD,UACE,eAACE,GAAD,CAAe/9D,GAAI,GAAnB,SACE,gBAAC,GAAD,CACE/lC,QAAQ,2DACRmiB,eAAa,EACbrG,QAASA,EAHX,UAKE,eAAC,GAAD,CACE9uC,SAAS,yEACT8uC,QAASA,EACTiqB,GAAI,KAEN,eAAC,GAAD,CACE/4D,SAAS,sEACT8uC,QAASA,IAEX,eAAC,GAAD,CACE9uC,SAAS,sEACT8uC,QAASA,IAEX,eAAC,GAAD,CACE9uC,SAAS,sEACT8uC,QAASA,YA9BnB,ICuDa47F,OA/DiBzyI,IAAMoI,MAAK,IAGpC,IAHqC,GAC1ChL,KACG+jB,GACC,EACJ,MAAM,SAACtR,EAAD,KAAWhO,GAAQ0B,qBAAWq4H,IAC9B/kF,EAAUh1C,GAAQzE,IAAOyS,EAE/B,OAAO,eAAC2uH,GAAD,CAAephI,GAAIA,KAAQ+jB,EAA3B,SACL,gBAACw9G,GAAD,WACE,eAACE,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,wBACT8uC,QAASA,EACTirF,eAAa,MAGjB,eAACjD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,gBAAC,GAAD,CACE/lC,QAAQ,mEACR8b,QAASA,EAFX,UAIE,eAAC,GAAD,CACE9uC,SAAS,wEACT8uC,QAASA,EACTirF,eAAa,IAEf,eAAC,GAAD,CACE/5H,SAAS,yEACT8uC,QAASA,SAIf,eAACgoF,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/lC,QAAQ,0DACR8b,QAASA,EAFX,SAIE,eAAC,GAAD,CACE9uC,SAAS,yEACT8uC,QAASA,EACTirF,eAAa,QAInB,eAACjD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/lC,QAAQ,+CACR8b,QAASA,EAFX,SAIE,eAAC,GAAD,CACE9uC,SAAS,8DACT8uC,QAASA,EACTirF,eAAa,YA7CvB,ICkEa4Q,OA1EgB1yI,IAAMoI,MAAK,IAGnC,IAHoC,GACzChL,KACG+jB,GACC,EACJ,MAAM,SAACtR,EAAD,KAAWhO,GAAQ0B,qBAAWq4H,IAC9B/kF,EAAUh1C,GAAQzE,IAAOyS,EAE/B,OAAO,eAAC2uH,GAAD,CAAephI,GAAIA,KAAQ+jB,EAA3B,SACL,eAACw9G,GAAD,UACE,gBAACE,GAAD,CAAe/9D,GAAI,GAAnB,UACE,eAAC,GAAD,CACE/4D,SAAS,0DACT8uC,QAASA,IAEX,eAAC,GAAD,CACE9uC,SAAS,2DACT8uC,QAASA,IAEX,eAAC,GAAD,CACE9uC,SAAS,oEACT8uC,QAASA,IAEX,eAAC,GAAD,CACE9uC,SAAS,6EACT8uC,QAASA,IAEX,eAAC,GAAD,CACE9uC,SAAS,sEACT8uC,QAASA,IAEX,eAAC,GAAD,CACE9uC,SAAS,2DACT8uC,QAASA,IAEX,eAAC,GAAD,CACE9uC,SAAS,mEACT8uC,QAASA,IAEX,eAAC,GAAD,CACE9uC,SAAS,4DACT8uC,QAASA,IAEX,eAAC,GAAD,CACE9uC,SAAS,wDACT8uC,QAASA,IAEX,eAAC,GAAD,CACE9uC,SAAS,oEACT8uC,QAASA,IAEX,eAAC,GAAD,CACE9uC,SAAS,wEACT8uC,QAASA,IAEX,eAAC,GAAD,CACE9uC,SAAS,oEACT8uC,QAASA,IAEX,eAAC,GAAD,CACE9uC,SAAS,yDACT8uC,QAASA,IAEX,eAAC,GAAD,CACE9uC,SAAS,4DACT8uC,QAASA,UAzDjB,IC4Fa87F,OAlGe3yI,IAAMoI,MAAK,IAGlC,IAHmC,GACxChL,KACG+jB,GACC,EACJ,MAAM,SAACtR,EAAD,KAAWhO,GAAQ0B,qBAAWq4H,IAC9B/kF,EAAUh1C,GAAQzE,IAAOyS,EAE/B,OAAO,eAAC2uH,GAAD,CAAephI,GAAIA,KAAQ+jB,EAA3B,SACL,gBAACw9G,GAAD,WACE,eAACE,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,6CACT8uC,QAASA,MAGb,eAACgoF,GAAD,CAAe/9D,GAAI,GAAnB,SACE,gBAAC,GAAD,CACE/lC,QAAQ,kDACR8b,QAASA,EAFX,UAIE,eAAC,GAAD,CACA9uC,SAAS,uDACT8uC,QAASA,IAET,eAAC,GAAD,CACA9uC,SAAS,6DACT8uC,QAASA,IAET,eAAC,GAAD,CACA9uC,SAAS,uEACT8uC,QAASA,IAET,eAAC,GAAD,CACA9uC,SAAS,wEACT8uC,QAASA,SAIb,eAACgoF,GAAD,CAAe/9D,GAAI,GAAnB,SACE,gBAAC,GAAD,CACE/lC,QAAQ,iDACR8b,QAASA,EAFX,UAIE,eAAC,GAAD,CACA9uC,SAAS,sDACT8uC,QAASA,IAET,eAAC,GAAD,CACA9uC,SAAS,6DACT8uC,QAASA,IAET,eAAC,GAAD,CACA9uC,SAAS,uEACT8uC,QAASA,SAIb,eAACgoF,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,wEACT8uC,QAASA,MAGb,eAACgoF,GAAD,CAAe/9D,GAAI,GAAnB,SACE,gBAAC,GAAD,CACE/lC,QAAQ,wCACRmiB,eAAa,EACbrG,QAASA,EAHX,UAKE,eAAC,GAAD,CACE9uC,SAAS,sDACT8uC,QAASA,IAEX,eAAC,GAAD,CACE9uC,SAAS,2DACT8uC,QAASA,IAEX,eAAC,GAAD,CACE9uC,SAAS,sDACT8uC,QAASA,IAEX,eAAC,GAAD,CACE9uC,SAAS,iEACT8uC,QAASA,IAEX,eAAC,GAAD,CACE9uC,SAAS,qDACT8uC,QAASA,aAhFnB,ICca47F,OAvBiBzyI,IAAMoI,MAAK,IAGpC,IAHqC,GAC1ChL,KACG+jB,GACC,EACJ,MAAM,SAACtR,EAAD,KAAWhO,GAAQ0B,qBAAWq4H,IAC9B/kF,EAAUh1C,GAAQzE,IAAOyS,EAE/B,OAAO,eAAC2uH,GAAD,CAAephI,GAAIA,KAAQ+jB,EAA3B,SACL,eAACw9G,GAAD,UACE,eAACE,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,yBACT8uC,QAASA,EACTirF,eAAa,SANrB,IC8Da8Q,OAnEiB5yI,IAAMoI,MAAK,IAGpC,IAHqC,GAC1ChL,KACG+jB,GACC,EACJ,MAAM,SAACtR,EAAD,KAAWhO,GAAQ0B,qBAAWq4H,IAC9B/kF,EAAUh1C,GAAQzE,IAAOyS,EAE/B,OAAO,eAAC2uH,GAAD,CAAephI,GAAIA,KAAQ+jB,EAA3B,SACL,gBAACw9G,GAAD,WACE,eAACE,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,wBACT8uC,QAASA,EACTirF,eAAa,MAGjB,eAACjD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,gBAAC,GAAD,CACE/lC,QAAQ,6CACR8b,QAASA,EAFX,UAIE,eAAC,GAAD,CACE9uC,SAAS,kDACT8uC,QAASA,EACT+qF,YAAa,IAEf,eAAC,GAAD,CACE75H,SAAS,mDACT8uC,QAASA,SAIf,eAACgoF,GAAD,CAAe/9D,GAAI,GAAnB,SACE,gBAAC,GAAD,CACE/lC,QAAQ,8CACR8b,QAASA,EAFX,UAIE,eAAC,GAAD,CACE9uC,SAAS,mDACT8uC,QAASA,EACTirF,eAAa,IAEf,eAAC,GAAD,CACE/5H,SAAS,oDACT8uC,QAASA,SAIf,eAACgoF,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/lC,QAAQ,oDACR8b,QAASA,EAFX,SAIE,eAAC,GAAD,CACE9uC,SAAS,yDACT8uC,QAASA,EACT+qF,YAAa,YAjDvB,ICgCaiR,OAvCwB7yI,IAAMoI,MAAK,IAG3C,IAH4C,GACjDhL,KACG+jB,GACC,EACJ,MAAM,SAACtR,GAAYtM,qBAAWq4H,IACxB/kF,EAAUz5C,IAAOyS,EAEvB,OAAO,eAAC2uH,GAAD,CAAephI,GAAIA,KAAQ+jB,EAA3B,SACL,eAACw9G,GAAD,UACE,eAACE,GAAD,CAAe/9D,GAAI,GAAnB,SACE,gBAAC,GAAD,CACE/lC,QAAQ,8CACRmiB,eAAa,EACbrG,QAASA,EAHX,UAKE,eAAC,GAAD,CACE9uC,SAAS,mEACT8uC,QAASA,EACTirF,eAAa,EACbE,cAAY,IAEd,eAAC,GAAD,CACEj6H,SAAS,0FACT+5H,eAAa,EACbjrF,QAASA,IAEX,eAAC,GAAD,CACE9uC,SAAS,sFACT8uC,QAASA,YArBnB,ICwEai8F,OAhFU9yI,IAAMoI,MAAK,IAG7B,IAH8B,GACnChL,KACG+jB,GACC,EACJ,MAAM,SAACtR,EAAD,KAAWhO,GAAQ0B,qBAAWq4H,IAC9B/kF,EAAUh1C,GAAQzE,IAAOyS,EAE/B,OAAO,eAAC2uH,GAAD,CACLphI,GAAIA,EACJ2kC,QAAS,eAACi9F,GAAD,CACPj3H,SAAS,aACTpc,MAAM,OACNsY,YAAY,0BAEVkd,EAPC,SASL,gBAACw9G,GAAD,WACE,eAACE,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,uBACT8uC,QAASA,EACTiqB,GAAI,GACJghE,eAAa,MAGjB,eAACjD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,mBACT8uC,QAASA,EACTiqB,GAAI,GACJghE,eAAa,MAGjB,eAACjD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,sBACT8uC,QAASA,EACTiqB,GAAI,GACJghE,eAAa,MAGjB,eAACjD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,0BACT8uC,QAASA,EACTiqB,GAAI,GACJghE,eAAa,MAGjB,eAACjD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,oBACT8uC,QAASA,EACT2E,mBAAiB,EACjBumF,gBAAc,MAGlB,eAAClD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,2BACT8uC,QAASA,EACT2E,mBAAiB,EACjBumF,gBAAc,MAGlB,eAAClD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,sBACT8uC,QAASA,EACT2E,mBAAiB,EACjBumF,gBAAc,UA/DtB,IC2CagR,OAlDa/yI,IAAMoI,MAAK,IAGhC,IAHiC,GACtChL,KACG+jB,GACC,EACJ,MAAM,SAACtR,EAAD,KAAWhO,GAAQ0B,qBAAWq4H,IAC9B/kF,EAAUh1C,GAAQzE,IAAOyS,EAE/B,OAAO,eAAC2uH,GAAD,CAAephI,GAAIA,KAAQ+jB,EAA3B,SACL,gBAACw9G,GAAD,WACE,eAACE,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,eACT8uC,QAASA,EACTkrF,gBAAc,MAGlB,eAAClD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,qBACT8uC,QAASA,MAGb,eAACgoF,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,cACT8uC,QAASA,EACTirF,eAAa,MAGjB,eAACjD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,wBACT8uC,QAASA,MAGb,eAACgoF,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,eACT8uC,QAASA,EACT2E,mBAAiB,EACjBumF,gBAAc,UAjCtB,I,qBCLF,MAAMn3H,GAAYC,cAAWnI,IAAK,CAChCvD,KAAM,CACJw9B,MAAO,OACPt5B,QAAS,OACTwG,WAAY,aACZm3B,eAAgB,SAChBD,cAAe,SACfliC,UAAW,kBAiEAm0I,OA9DIhzI,IAAMoI,MAAK,IASvB,IATwB,SAC7BL,EAD6B,MAE7BvS,EAF6B,YAG7ByO,EAH6B,aAI7BuuC,EAJ6B,QAK7B73C,EAL6B,UAM7BqH,EAN6B,QAO7BV,EACA,cAAe8zC,GACX,EACJ,MAAM1yC,EAAQy6C,gBACR,WAAEvd,EAAF,eAAcslB,EAAd,gBAA8BL,GAAoBtO,KAClD9zC,EAASmI,GAAU,CAACtJ,QAASA,EAASoB,MAAOA,KAC5C5H,EAAQw8D,GAAapS,EAAen9C,GACrCkqD,EAAepN,EAAgB98C,GAG/BiF,EAAM4yB,EAAW73B,GACjB8xD,GAAUx/D,gBAAM43D,IAAiBryB,EAAW73B,GAAUwiC,OACtD6S,EAAYn5C,IAAW,OAAI+I,QAAJ,IAAIA,OAAJ,EAAIA,EAAK/I,cAAe,GAC/Co5C,EAAa7nD,IAAK,OAAIwX,QAAJ,IAAIA,OAAJ,EAAIA,EAAKxX,OAC3BxC,EAAMg/D,GAAShlD,EAAKlS,EAAQm3D,EAAczf,GAE1C+kB,EAAepoD,uBAAY,CAACwxB,EAAOpmC,EAAKsV,KAC5CynD,EAAU/8D,EAAV,GACC,CAAC+8D,IAEJ,OAAO,uBAAKt1D,UAAW+iC,mBAAK/iC,EAAWS,EAAOtD,MAAO,cAAai2C,EAA3D,UACL,eAAC,GAAD,CACErtC,SAAUA,EACVvS,MAAO6nD,EACPp5C,YAAam5C,EACb7B,eAAa,EACbC,mBAAiB,IAElB7gD,GAAWH,OAAOC,QAAQE,GAAS1M,KAAI,QAAEsM,EAAK5O,GAAP,SACtC,eAAC,GAAD,CAEEA,MAAO4O,EACP/E,MAAO7J,EAAM6J,MACbs/C,SAAU+kB,GAAUluE,EAAMmpD,SAC1BjlC,SAAU7c,IAAQuH,EAClBwoC,SAAUw0B,EACVx4D,QAASpT,EAAMoT,QACfmM,QAAQ,QACRswC,mBAAiB,GARZjhD,EAF+B,MAR1C,IC3BF,MAAM04I,GAAmBjmI,KAASA,EAAIlZ,KAAK6M,WAAW,OAASqM,EAAIkmI,SAE7DC,GAAsBtoI,cAAWnI,IAAK,CAC1CvD,KAAM,CAAC,EACP0kB,KAAM,CACJ,UAAW,CACTjlB,gBAAiB8D,EAAMnE,QAAQ2/C,KAAK,MAEtCpa,OAAQ,UACRnH,MAAO,OACPt5B,QAAS,OACT09B,cAAe,MACfl3B,WAAY,SACZo3B,SAAU,SACV/D,aAAcx6B,EAAMkH,QAAQ,GAC5B/K,UAAW,cAEbs6C,KAAM,CAAC,EAEPrlD,KAAM,CACJ2xC,SAAU,GAEZ1D,QAAS,CACP12B,WAAY3I,EAAMkH,QAAQ,IAE5BvI,SAAU,CACRgK,WAAY3I,EAAMkH,QAAQ,QAIxBwpI,GAAapzI,IAAMoI,MAAK,SAASgrI,EAAT,GAAoD,IAAhC,KAAC/sH,EAAD,KAAOvyB,EAAP,KAAa8Q,EAAb,UAAmB5C,GAAY,EAC/E,MAAMV,EAAU6xI,MACTtxI,EAAM48B,GAAWj2B,oBAAU5D,IAC5B,eAAEsgD,GAAmB3O,MACpBz7C,EAAQw8D,GAAapS,EAAe,cAErCtgB,EAAez1B,uBAAawxB,IAChCA,EAAMkE,kBACNyyB,GAAU5nD,IACR,IAAIqwH,EACJ,GAAIrwH,EAAK,EACS,OAAGA,QAAH,IAAGA,OAAH,EAAGA,EAAKjD,IAAI7H,IACf8K,EAAI1I,OAAOpC,GAAQ8K,EAAInZ,IAAIqO,GACxCm7H,EAAY,IAAIvzH,IAAIkD,EACrB,MACCqwH,EAAY,IAAIvzH,IAAI,CAAC5H,IAEvB,OAAOm7H,CAAP,GATF,GAWC,CAACn7H,EAAM0yD,IAEJnvB,EAAeh5B,uBAAYwxB,IAC/BA,EAAMkE,kBACNpG,GAAQ58B,IAASA,GAAjB,GACC,CAAC48B,IAEEp9B,EAAW7G,OAAOK,KAAKwrB,GACvBgtH,EAAchyI,EAAS/Q,OAAS,EAEhC6oD,EAAOvwC,mBAAQ,KACnB,MAAM0qI,EAAY,CAChBtxI,UAAWV,EAAQ63C,KACnBl6C,SAAU,SAEZ,OAAOo0I,EACFxxI,EAAO,eAAC,KAAD,IAAoByxI,IAAgB,eAAC,KAAD,IAAsBA,IAClE,sBAAKtxI,UAAWV,EAAQ63C,MAF5B,GAGC,CAACk6F,EAAaxxI,EAAMP,EAAQ63C,OAEzBo6F,EAAkB3uI,EAAO,IACzBi+B,EAAgBj6B,mBAAQ,MACvB9N,IAGEu4I,QAA6FxhJ,IAA9EgF,MAAMm6D,KAAKl2D,GAAQ4yB,MAAKo9B,GAAYA,EAASnqD,WAAW4yI,OAC7E,CAACz4I,EAAQu4I,EAAaE,IAEzB,OAAO,uBAAKvxI,UAAW+iC,mBAAK/iC,EAAWV,EAAQnC,MAAxC,UACL,uBAAKoD,QAAS8wI,EAAclrG,EAAe,KAAMnmC,UAAWV,EAAQuiB,KAApE,UACGs1B,EACD,eAAC,GAAD,CACExtD,MAAOiZ,EACPpP,MAAO1B,EACP+b,UAAgB,OAAN/U,QAAM,IAANA,OAAA,EAAAA,EAAQ2R,IAAI7H,MAAS,EAC/Bm+B,SAAU6B,EACV15B,QAAQ,WACRktG,eAAe,QACf58D,mBAAiB,EACjB4lF,mBAAiB,EACjBC,eAAgBz8H,EAChBi+B,cAAeA,OAGlBwwG,GACC,eAACluG,GAAA,EAAD,CAAUC,GAAIvjC,EAAMG,UAAWV,EAAQD,SAAvC,SACGQ,GAAQR,EAASpT,KAAI,CAAC6F,EAAM2c,IAC3B,eAAC2iI,EAAD,CAEEt/I,KAAMA,EACNuyB,KAAMA,EAAKvyB,GACX8Q,KAAM2uI,EAAkBz/I,GAHnB2c,SAQhB,IAmIc+iI,OA3HexzI,IAAMoI,MAAK,IAGlC,IAAD,MAHoC,GACxChL,KACG+jB,GACC,EACJ,MAAM,IAAC5c,GAAO0E,MACR,SAAC4G,EAAD,KAAWhO,GAAQ0B,qBAAWq4H,IAC9B/kF,EAAUh1C,GAAQzE,IAAOyS,EACzBlH,EAAa,OAAGpE,QAAH,IAAGA,GAAH,UAAGA,EAAKY,gBAAR,aAAG,EAAewD,cAC/B4oB,EAAYpJ,KACZyK,EAAiBW,OACf54B,EAAS84I,GAAOlgE,GAAc/qE,mBAAS,CAAC,GAAI,CAAC,KAC/C,WAACrI,GAAcmD,KAoCrB,OAnCAoF,qBAAU,KACR,IAAKkqB,IAAmBikB,EACtB,OAEF,MAAM13C,EAAOyzB,EAAeoD,4BACtBkF,EAAW,OAAG/7B,QAAH,IAAGA,OAAH,EAAGA,EAAMy3B,aACpB68G,EAAO,CAAC,EACd,IAAKv4G,EACH,MAAO,GAET,MAAMvgC,EAAU,GACV+4I,EAAU,IAAIlnI,IACpB,SAASmnI,EAAO3mI,EAAKvF,EAAQ4e,GAC3B,MAAMpB,EAAWxd,EAAM,UAAMA,EAAN,YAAgBuF,EAAIlZ,MAASkZ,EAAIlZ,KACxDuyB,EAAKrZ,EAAIlZ,MAAQuyB,EAAKrZ,EAAIlZ,OAAS,CAAC,EACpCuyB,EAAOA,EAAKrZ,EAAIlZ,MACZ4/I,EAAQjnI,IAAIO,KAGhB0mI,EAAQn9I,IAAIyW,GACZrS,EAAQ/K,KAAK,CAACjE,MAAOs5B,IACjBjY,EAAIuW,QAAUqQ,IAAkB5mB,EAAIqW,cACtCrW,EAAMA,EAAIqW,aAERrW,EAAIuW,QAAUmQ,KAChB1mB,EAAIosB,eAAet+B,OAAOm4I,IAAkBh3I,SAAQ+Q,GAAO2mI,EAAO3mI,EAAKiY,EAAUoB,KACjFkL,EAAUR,yBAAyB/jB,GAAK/Q,SAAQ+Q,IAC9CA,EAAIosB,eAAet+B,OAAOm4I,IAAkBh3I,SAAQ+Q,GAAO2mI,EAAO3mI,EAAKiY,EAAUoB,IAAjF,KAGL,CACD6U,EAAYj/B,SAAQ+Q,GAAO2mI,EAAO3mI,EAAK,KAAMymI,KAC7ClgE,EAAW,CAAC54E,EAAS84I,GAArB,GACC,CAACtzI,EAAYoxB,EAAWqB,EAAgB2gD,EAAY18B,IAEhD,eAAC2nF,GAAD,CAAephI,GAAIA,KAAQ+jB,EAA3B,SACL,gBAACw9G,GAAD,WACE,eAACE,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,aACTvS,MAAM,aACNg9C,aAAc7pC,EAAgB,UAAY,SAC1ChO,QAAS,CACPi5I,IAAK,CAACp+I,MAAO,MAAOs/C,UAAWnsC,EAAe5J,QAAS,yBACvD80I,OAAQ,CAACr+I,MAAO,SAAUs/C,UAAU,EAAO/1C,QAAS,wGACpD83C,QAAS,CAACrhD,MAAO,UAAWs/C,UAAWnsC,EAAe5J,QAAS,sJAC/DiqC,OAAQ,CAACxzC,MAAO,SAAUs/C,UAAWnsC,EAAe5J,QAAS,oEAC7DyI,KAAM,CAAChS,MAAO,OAAQs/C,UAAWnsC,EAAe5J,QAAS,6CACzD+0I,QAAS,CAACt+I,MAAO,cAAes/C,UAAWnsC,EAAe5J,QAAS,iDAIzE,eAAC8/H,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,WACT8uC,QAASA,EACT2E,mBAAiB,EACjBumF,gBAAc,MAGlB,eAAClD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,YACT8uC,QAASA,EACT2E,mBAAiB,EACjBumF,gBAAc,MAGlB,eAAClD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,cACT8uC,QAASA,EACT2E,mBAAiB,EACjBumF,gBAAc,MAGlB,eAAClD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,+BACT8uC,QAASA,EACT2E,mBAAiB,EACjBumF,gBAAc,MAGlB,eAAClD,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC,GAAD,CACE/4D,SAAS,sBACT8uC,QAASA,EACT2E,mBAAiB,EACjBumF,gBAAc,MAGlB,gBAAClD,GAAD,CAAe/9D,GAAI,GAAnB,UACE,eAAC,GAAD,CAAa/4D,SAAS,aAAayzC,mBAAiB,IACpD,eAAClyC,GAAA,EAAD,CAAK0yB,aAAc,EAAnB,SACE,eAACy6B,GAAD,CACE1uD,SAAS,aACTgc,YAAappB,MAGhBH,OAAOK,KAAK44I,GAAMxlJ,KAAI,CAAC6F,EAAM2c,IAC5B,eAAC,GAAD,CAAY4V,KAAMotH,EAAK3/I,GAAOA,KAAMA,EAAM8Q,KAAM9Q,GAAW2c,YAlEnE,ICxKF,MAAMhJ,GAAS,YACTssI,GAAcv5I,OAAOK,KAAKiC,GAC7BhC,QAAOP,GAAOA,EAAIoG,WAAW8G,MAC7BxZ,KAAIsM,GAAOA,EAAIhI,MAAMkV,GAAOnX,UAC5B0zB,OAEGgwH,GAAwBh0I,IAAMoI,MAAK,IAGlC,IAHmC,GACxChL,KACG+jB,GACC,EACJ,MAAO4C,EAAagvB,GAAkBvqC,mBAAS,CAAC,CAAC,OAC1C1M,EAAQm4I,GAAazrI,mBAAS,CAAC,CAAC7c,MAAO,GAAIupE,OAAO,EAAMr1D,IAAK,OAC9D,SAACgQ,EAAD,KAAWhO,GAAQ0B,qBAAWq4H,KAC9B,eAAC12E,GAAkB3O,MACnB,IAAChyC,GAAO0E,KACR4tC,EAAUh1C,GAAQzE,IAAOyS,GACxBqkI,EAAiBC,GAAsBjvF,EAAe,mBAEvDkvF,EAAmBjlI,uBAAY,CAACklI,EAAS15I,EAASopB,KACtDppB,EAAQG,QAAO,CAAC+oB,EAAMpvB,IAAQkG,EAAQsG,QAAQ4iB,KAAUpvB,IAAKwH,SAAQhB,IACpD,eAAXA,EACF84I,GAAY93I,SAAQq4I,IAClBvwH,EAAYn0B,KAAK,CAACykJ,EAASC,GAAYv2I,KAAK,KAA5C,IAEO,CAAC,WAAY,iBAAkB,eAAgB,cAAc1M,SAAS4J,GAC/E8oB,EAAYn0B,KAAKykJ,EAAQz9I,OAAO,KAAMqE,EAAQ,MAE9C8oB,EAAYn0B,KAAK,CAACykJ,EAASp5I,GAAQ8C,KAAK,KACzC,GATH,GAWC,IAEG2lB,EAAiBvU,uBAAYsc,MAAO3wB,EAAQ2V,KAChD,MAAM+hH,EAAc,CAClBz3H,QAAS,CAAC,QAAS,aAAc,QAAS,aAAc,iBAAkB,WAAY,aAAc,kBACpGw5I,aAAa,EACbrhH,MAAO,SACPruB,MAAO,CACL2vI,gBAAiB15I,IAGrB,IAOE,aANMyJ,EAAIgC,KAAJ,gBAA0BisH,GAChCyhB,GAAUQ,IACR,MAAM1U,EAAY,IAAI0U,GAEtB,OADA1U,EAAUtvH,GAAS,CAAC9kB,MAAO8oJ,EAAUhkI,GAAO9kB,MAAOupE,OAAO,EAAMr1D,IAAK,IAC9DkgI,CAAP,IAEK,CAAC7qE,OAAO,EAAMnxC,YAAa,GAiCnC,CAhCC,MAAOxjB,GACP,GAAI0H,kBAAO,OAAC1H,QAAD,IAACA,OAAD,EAACA,EAAOM,YAAa,CAC9B,MAAMkjB,EAAc,GA2BpB,OA1BK,OAALxjB,QAAK,IAALA,KAAOM,WAAW5E,SAASitH,KACL,OAAGA,QAAH,IAAGA,OAAH,EAAGA,EAAKwrB,KACbz4I,SAAQrC,IACrB,GAAsB,qBAAV,OAARA,QAAQ,IAARA,OAAA,EAAAA,EAAW,IAA0B,CAAC,IAAD,IACvC,IAAI+6I,EAAaz4H,OAAM,UAACgtG,EAAIrpH,IAAI0hB,MAAM,mBAAf,iBAAC,EAA4B,GAAGA,MAAM,cAAtC,aAAC,EAA8C,IAAM,EACxE2nG,EAAIrpH,IAAI0hB,MAAM,8BAChBozH,EAAa75I,EAAOxK,QAEtB,MAAMskJ,EAAWb,GAAYj5I,QAAOw5I,GAAcA,EAAW3zI,WAAW7F,KACpE85I,EAAStkJ,OAAS,GACpBskJ,EAAS34I,SAAQo4I,GAAWtwH,EAAYn0B,KAAKykJ,KAE/C,MAAM15I,EAAU9D,MAAMm6D,KAAKk4D,EAAIrpH,IAAIg1I,SAAS,gBAAgBvW,GAAKA,EAAE,GAAG/rI,MAAM,GAAI,KAC1E8hJ,EAAUv5I,EAAOvI,MAAM,EAAGoiJ,GAAYz7I,OAC5Ck7I,EAAiBC,EAAS15I,EAASopB,GACnC,MAAM+wH,EAAgB5rB,EAAIrpH,IAAI0hB,MAAM,6BAChCuzH,GACFb,GAAUQ,IACR,MAAM1U,EAAY,IAAI0U,GAEtB,OADA1U,EAAUtvH,GAAS,CAAC9kB,MAAO8oJ,EAAUhkI,GAAO9kB,MAAOupE,MAAOu/E,EAAUhkI,GAAOykD,MAAOr1D,IAAG,OAAEi1I,QAAF,IAAEA,OAAF,EAAEA,EAAgB,IAChG/U,CAAP,GAGL,IArBH,IAwBK,CAAC7qE,OAAO,EAAOnxC,YAAaA,EACpC,CACD,MAAO,CAACmxC,OAAO,EAAOnxC,YAAa,GACpC,IACA,CAACxf,EAAK6vI,IAET1rI,qBAAU,KACR,IAAKmuC,GAAWpxB,kBAAQyuH,GAAkB,OAC1C,MAAMa,EAAqBb,EAAkB,IAAIA,EAAiB,IAAM,CAAC,IACnEnU,EAAYgV,EAAmB9mJ,KAAItC,IAAK,CAAMA,MAAOA,EAAOupE,QAASvpE,EAAOkU,IAAK,OACvFo0I,EAAUlU,GACat0G,WACrB,MAAMupH,QAAuBrvI,QAAQiuI,IAAImB,EAAmB9mJ,KAAIw9B,MAAOwpH,EAAgBxkI,KACrF,MAAM4jI,EAAUY,GAAkBA,EAAe/7I,OAC3Cg8I,QAAmBxxH,EAAe2wH,GAAW,IAAK5jI,GACxD,MAAO,CAACwkI,GAAgBr+I,OAAOs+I,EAAWnxH,YAA1C,KAEFgvB,EAAeiiG,EAAf,EAEFG,EAAgB,GACf,CAACjB,EAAiBxwH,EAAgBmzB,IAErC,MAAM8d,EAAWxlD,uBAAYsc,MAAO9/B,EAAO8kB,KACzC,MAAMykI,QAAmBxxH,EAAgB/3B,GAASA,EAAMuN,QAAW,IAAKuX,GAMxE,OALAsiC,GAAehvB,IACb,MAAMirC,EAAiB,IAAIjrC,GAE3B,OADAirC,EAAev+C,GAAS,CAAC9kB,GAAOiL,OAAOs+I,EAAWnxH,aAC3CirC,CAAP,IAEKkmF,CAAP,GACC,CAACxxH,IAEE0xH,EAA8BxsI,mBAAQ,IAC1CkrC,mBAAS6gB,EAAU,MAClB,CAACA,IAEE2C,EAAYnoD,uBAAY,CAACxjB,EAAO8kB,KACpCwjI,GAAUn6E,IACR,MAAMimE,EAAY,IAAIjmE,GAMtB,OALKnuE,EAGHo0I,EAAUtvH,GAAS,CAAC9kB,MAAOA,EAAOupE,OAAO,EAAOr1D,IAAK,IAFrD4Q,IAAUsvH,EAAUzvI,OAAS,GAAKyvI,EAAUl0H,OAAO4E,EAAO,GAIrDsvH,CAAP,IAEF,MAAM/wE,EAAiB,IAAIjrC,GACtBp4B,EAGHqjE,EAAev+C,GAAS,CAAC9kB,GAFzB8kB,IAAUu+C,EAAe1+D,OAAS,GAAK0+D,EAAenjD,OAAO4E,EAAO,GAItEsiC,EAAeic,EAAf,GACC,CAACjrC,IAEEyxC,EAAoBrmD,uBAAY,CAACxjB,EAAO8kB,KAC5C6mD,EAAU3rE,EAAO8kB,GACjB2kI,EAA4BzpJ,EAAO8kB,EAAnC,GACC,CAAC2kI,EAA6B99E,IAE3B+9E,EAAoBlmI,uBAAY,SAACsB,EAAO9kB,GAA0B,IAAnBupE,EAAkB,wDACrE,MAAMogF,EAAa,IAAIx5I,GAAQhB,QAAOnP,KAAWA,EAAMA,QACvD,GAA0B,IAAtB2pJ,EAAWhlJ,SAAkBglJ,EAAWrpH,OAAMtgC,KAAWA,EAAMupE,UAAWA,EAAQ,OACtF,MAAM6/E,EAAqB,IAAIO,GAAYrnJ,KAAItC,GAASA,EAAMA,QACzDA,EAGHopJ,EAAmBtkI,GAAS9kB,EAF5BopJ,EAAmBlpI,OAAO4E,EAAO,GAInC0jI,EAAmB,IAAI3nI,IAAIuoI,GAC5B,GAAE,CAACZ,EAAoBr4I,IAElBy7D,EAAepoD,uBAAYsc,MAAOkV,EAAOh1C,EAAO8kB,KACpD,GAAI3U,EAAO2U,GAAO9kB,QAAUA,IAC1B2rE,EAAU3rE,EAAO8kB,GACZ3U,EAAO2U,GAAO9kB,OAErB,GAAKmQ,EAAO2U,GAAOykD,MAKjBmgF,EAAkB5kI,EAAO9kB,OALD,CAExB,WADyBgpE,EAAShpE,EAAO8kB,IACzBykD,MAAO,OACvBmgF,EAAkB5kI,EAAO9kB,GAAO,EACjC,CAEA,GACA,CAAC2rE,EAAW+9E,EAAmB1gF,EAAU74D,IAE5C,OAAO,eAAC0iI,GAAD,CAAephI,GAAIA,KAAQ+jB,EAA3B,SACJ01B,GAAW/6C,GAAUA,EAAOxL,SAAWyzB,EAAYzzB,QAAUwL,EAAO7N,KAAI,CAACtC,EAAO8kB,IACxE,eAACnH,GAAA,EAAD,CAAiBgzB,YAAa,EAAGY,aAAc,EAA/C,SACL,eAAC,KAAD,CACEviC,QAASopB,EAAYtT,GACrBvO,MAAO,CAACy6B,MAAO,QACfoG,SAAU,CAACpC,EAAOh1C,IAAU4rE,EAAa52B,EAAOh1C,EAAO8kB,GACvD2lD,UAAYz1B,GAAyB,UAAdA,EAAMpmC,KAAmBg9D,EAAa52B,EAAOh1C,EAAMA,MAAO8kB,GACjF9kB,MAAOA,EAAMA,MACbqqE,kBAAmB,CAAC/6D,EAAQtP,IAAUsP,IAAWtP,EACjDkoE,eAAgB54D,GAAWA,GAAU+F,OAAO/F,IAAY,GACxDi7D,YAAalxD,GACX,eAAC+tD,GAAA,EAAD,IACM/tD,EACJkG,QAAQ,SAAS1V,MAAM,SACvBq0C,YAAY,uBAAuBtgC,OAAO,SAASssD,WAAS,EAACvzD,KAAK,QAClEygC,SAAUpC,GAAS60B,EAAkB70B,EAAMlnB,OAAO9tB,MAAO8kB,GACzDlQ,QAAS5U,EAAMkU,IACfs2D,aAAcxqE,EAAMkU,KAAOlU,EAAMkU,SAhBxB4Q,MAFrB,IA8BaujI,UC1JAuB,OA3C2Bv1I,IAAMoI,MAAK,IAG9C,IAH+C,GACpDhL,KACG+jB,GACC,EACJ,MAAM,SAACtR,EAAD,KAAWhO,GAAQ0B,qBAAWq4H,IAC9B/kF,EAAUh1C,GAAQzE,IAAOyS,EAE/B,OAAO,eAAC2uH,GAAD,CACLphI,GAAIA,EACJ2kC,QAAS,eAACi9F,GAAD,CACPj3H,SAAS,0CACTpc,MAAM,wBACNsY,YAAY,yDAEVkd,EAPC,SAQL,eAACw9G,GAAD,UACE,eAACE,GAAD,CAAe/9D,GAAI,GAAnB,SACE,gBAAC,GAAD,CACE/lC,QAAQ,2CACR8b,QAASA,EACTqG,eAAa,EAHf,UAKE,eAAC,GAAD,CACEn1C,SAAS,mEACT8uC,QAASA,IAEX,eAAC,GAAD,CACE9uC,SAAS,+DACT8uC,QAASA,IAEX,eAAC,GAAD,CACE9uC,SAAS,sEACT8uC,QAASA,YAzBnB,ICcF,MAAM2+F,GAAQ,CACZ,CAAC55H,GAAMY,KAAM,UACb,CAACZ,GAAMC,OAAQ,QACf,CAACD,GAAMiB,WAAY,WACnB,CAACjB,GAAM5a,QAAS,SAChB,CAAC4a,GAAMkB,MAAO,QAGVuI,GAAY,CAChB,OAAU,IACV,GAAM,IACN,IAAO,KACP,IAAO,KACP,GAAM,KAGFowH,GAAgB,CACpB,CAAC75H,GAAMY,KAAMhiB,OAAOK,KAAKwqB,IACzB,CAACzJ,GAAMC,OAAQrhB,OAAOK,KAAKwqB,IAC3B,CAACzJ,GAAMiB,WAAYriB,OAAOK,KAAKwqB,IAC/B,CAACzJ,GAAM5a,QAAS,CAAC,UACjB,CAAC4a,GAAMkB,MAAO,CAAC,UACf,CAAClB,GAAMmB,SAAU,CAAC,WAGd24H,GAAY,CAChB,CAAC95H,GAAMY,KAAM,YACb,CAACZ,GAAMC,OAAQ,cACf,CAACD,GAAMiB,WAAY,iBACnB,CAACjB,GAAM5a,QAAS,YAChB,CAAC4a,GAAMkB,MAAO,YACd,CAAClB,GAAMmB,SAAU,cAGb44H,GAAe,CACnB,CAAC/5H,GAAMY,KAAMuiG,GACb,CAACnjG,GAAMC,OAAQkjG,GACf,CAACnjG,GAAMiB,WAAYs/F,GACnB,CAACvgG,GAAM5a,QAASg8G,GAChB,CAACphG,GAAMkB,MAAO+iG,GACd,CAACjkG,GAAMmB,SAAUigG,IAsBb44B,GAAe51I,IAAMoI,MAAK,IAAqC,IAApC,YAAC6yG,EAAD,MAActvH,EAAd,SAAqBo3C,GAAc,EAClE,MAAOhgB,EAAW8yH,GAAkBjtI,mBAAQ,KAAO,IAAD,EAChD,MAAMktI,GAAgB,UAAA76B,EAAY/zF,qBAAZ,eAA2BC,IAAI,KAAM,CAAC,EAC5D,IAAI,UAACpE,EAAD,MAAYxhB,KAAUilG,GAAcsvC,EACxC/yH,EAAYA,GAAagzH,GAAuBhzH,GAChD,MAAMizH,GAAmI,IAAzG,CAACh5B,GAAoB6C,GAAkBd,GAAoBrD,IAAsBz6G,QAAQ8hB,GAEzH,IAAMA,IAAaizH,EAA0B,CAC3C,MAAMjkJ,EAAOorB,GAAY89F,GAEzBl4F,EAAYhxB,IAAS6pB,GAAMoB,QAAUggG,GAAqB24B,GAAa5jJ,GACvEwP,EAAQ,CAAC,EACTilG,EAAa,CAAC,CACf,CAED,MAAO,CAACzjF,EAAW,IACdxhB,KACAilG,EACHhxG,MAAO,QACPylH,YAAaA,GAJf,GAMC,CAACA,IAEJ,OAAOj7G,IAAMwb,cACXuH,EAAW,IACN8yH,EACHlqJ,MAAOA,EACPo3C,SAAUA,GAJd,IAaIkzG,GAAiBj2I,IAAMoI,MAAK,IAAqC,IAApC,WAAC/B,EAAD,OAAavL,EAAb,SAAqBioC,GAAc,EACpE,MAAM,GAAC3lC,EAAD,MAAKzR,GAASmP,EACdo7I,EAAWp7I,EAAOo7I,UAAY,SAC9Bj7B,EAAcryG,mBAAQ,KAAO,IAAD,EAChC,iBAAOvC,EAAWqnB,MAAK2lB,GAAKA,EAAEj2C,KAAOA,WAArC,aAAO,EAAmC+4I,YAA1C,GACC,CAAC/4I,EAAIiJ,IAEF1L,EAAUiO,mBAAQ,IACfpO,OAAOQ,YAAYqL,EAAWpY,KAAI8Z,IAAa,IAAD,EACnD,MAAM,KAACnD,EAAD,OAAOmgB,GAAUC,GAAkBjd,EAAS3K,IAClD,MAAO,CACL2K,EAAS3K,GAAI,CACX7C,IAAKwN,EAAS3K,GACdoB,QAASoG,EACTmgB,OAAQA,EACR9gB,YAAW,OAAE8D,QAAF,IAAEA,GAAF,UAAEA,EAAUouI,oBAAZ,aAAE,EAAwBlyI,YACrCsZ,MAAOJ,GAAW,OAACpV,QAAD,IAACA,OAAD,EAACA,EAAUouI,eANjC,MAWD,CAAC9vI,IAEE6uH,EAAoB/lH,uBAAaxjB,IACrCo3C,EAAS,CACPmzG,SAAU,YACPp7I,EACHnP,MAAOA,GAHT,GAKC,CAACmP,EAAQioC,IAENqzG,EAAiBjnI,uBAAaxjB,IAClCo3C,EAAS,CACPmzG,SAAU,SACV94I,GAAIzR,GAFN,GAIC,CAACo3C,IAEEszG,EAAuBlnI,uBAAarL,IACxCi/B,EAAS,IACJjoC,EACHo7I,SAAUpyI,EAAE2V,OAAO9tB,OAFrB,GAIC,CAACmP,EAAQioC,IAENuzG,EAAqBr7B,EA1FPA,KACpB,MAAM19F,EAAQJ,GAAY89F,GACpBp0G,EAAS4uI,GAAcl4H,GAC7B,IAAK1W,EACH,MAAMjW,MAAM,6BAEd,OAAOiW,CAAP,EAoFyC0vI,CAAat7B,GAAe,CAAC,UAEtE,OAAQ,eAAC,IAAM5xG,SAAP,UACN,gBAACC,GAAA,EAAD,CAAKjG,QAAQ,OAAO49B,SAAS,OAAOF,cAAc,MAAMl3B,WAAW,aAAa6xB,UAAW,EAA3F,UACE,eAACpyB,GAAA,EAAD,CAAK0yB,aAAc,EAAGW,MAAM,OAA5B,SACE,eAACkpF,GAAD,CACElrH,QAASA,EACThP,MAAOyR,EACP2lC,SAAUqzG,EACV3iF,SAAU2iF,EAGV51I,QAAUD,GAAUA,GAAS61I,EAAe,IAC5Ct+E,UAAQ,MAGZ,eAACxuD,GAAA,EAAD,CAAKQ,YAAa,EAAG6yB,MAAO,GAA5B,SACE,gBAACid,GAAA,EAAD,CAAaic,WAAS,EAACvzD,KAAK,QAAQ4I,QAAQ,SAA5C,UACE,eAAC2uC,GAAA,EAAD,iBACA,eAAClE,GAAA,EAAD,CACEhqD,MAAOuqJ,EACPnzG,SAAUszG,EACV1sE,YAAah+E,GAAS,6BAAI05B,GAAU15B,KAHtC,SAKG2qJ,EAAmBroJ,KAAI,CAACioJ,EAAUzlI,IACjC,eAACslC,GAAA,EAAD,CAAsBpqD,MAAOuqJ,EAA7B,SAAwC7wH,GAAU6wH,IAAnCzlI,YAKvB,eAACnH,GAAA,EAAD,CAAKm8B,SAAU,EAAf,SAEIw1E,EACE,eAAC26B,GAAD,CACE//E,WAAS,EACTlqE,MAAOA,EACPo3C,SAAUmyF,EACVja,YAAaA,IAGf,eAACpoD,GAAD,CACEr9D,MAAM,QACNqgE,WAAS,EACTlqE,MAAOmP,EAAOnP,OAAS,GACvBo3C,SAAUj/B,GAAKoxH,EAAkBpxH,EAAE2V,OAAO9tB,eA1CtD,ICzIK,MAAM6qJ,GAAU,CACrB5nG,SAAUmjG,GACVp0D,UAAWq0D,GACXprI,OAAQqrI,GACRwE,UAAWvE,GACXwE,IAAKvE,GACLwE,GAAIvE,GACJwE,GAAIvE,GACJwE,IAAKvE,GACLwE,KAAMvE,GACNtjG,KAAMujG,GACNuE,WAAYtE,GACZuE,UAAWtE,GACXuE,sBAAuBtE,GACvBuE,YAAaC,GACbC,WAAYxE,GACZyE,mBAAoBxE,GACpByE,sBAAuB/B,GACvBpuH,IAAK2rH,GACL9kF,kBD8KoChuD,IAAMoI,MAAK,IAG1C,IAH2C,GAChDhL,KACG+jB,GACC,EACJ,MAAMpkB,EAAWw2B,MACX,SAAC1jB,EAAD,KAAWhO,GAAQ0B,qBAAWq4H,KAC9B,eAAC12E,GAAkB3O,MAClB0rE,EAAQs1B,GAAa/uI,oBAAS,GAC/BquC,EAAUh1C,GAAQzE,IAAOyS,GACzB,IAACtL,GAAO0E,MACR,WAAC9I,GAAcmD,MACduB,EAAOkzH,GAAY7yE,EAAe,sBAClC7+C,EAAYmxI,GAAiBhvI,mBAAS,OAEtCivI,EAAYC,GAAiBlvI,mBAAS,CAAC,CAAC,IAE/CE,qBAAU,KACR,IAAK3L,GAAYklH,IAAWprE,EAC1B,OAEeprB,WACf,MAAM1nB,QAAiBQ,EAAIgC,KAAK,gBAAiB,CAC/C,MAAS,UACT,MAAS,CACP,iBAAkB,CAAC,OAAQ,UAE7B,WAAc,CACZ,UAAa,GAEf,aAAgB,CACd,MAAS,CACP,MAAS,CACP,SAAY,uBACZ,KAAQ,IACR,QAAW,CACT,KAAQ,EACR,SAAY,CACV,QAAW,CACT,uBACA,sCAOX,CACDU,WAAW,IAEPZ,EAAa,GACnB,IAAK,MAAMzB,KAAQb,EAAS4oD,aAAagrF,MAAM/pG,MAAM1pC,KAAM,CACzD,MAAM0zI,EAAqBhzI,EAAKnK,QAAQ,GAAGo9I,mBACpCC,EAAcC,GAAiBlzH,GAAO+yH,EAAmBthI,WAAY,IAAK,GAKjF,IAAI2kG,EACJ,IAAK,IAAD,EACF,MAAMjqF,QAAmBj0B,EAASk6B,kBAAkB6gH,GAAc,GAClE78B,EAAW,OAAGjqF,QAAH,IAAGA,GAAH,UAAGA,EAAY5N,mBAAf,aAAG,EAA0B20H,EAEzC,CADC,MAAOx3I,GACR,CACD,IAAK06G,EAAa,SAElB,MAAMlpH,EAAOorB,GAAY89F,GACzB,IAAIh3G,EAAcuxI,GAAMzjJ,IAAS,eAC7BkpH,EAAYztH,OACdyW,GAAW,cAAWg3G,EAAYztH,OAEpC6Y,EAAWzW,KAAK,IACXgoJ,EACHzB,aAAcl7B,EACd+8B,aAAc/zI,GAEjB,CACDuzI,EAAcnxI,GACdkxI,GAAU,EAAV,EAEFU,GAAWhyI,MAAM9F,EAAjB,GACC,CAAC8hH,EAAQprE,EAAStyC,EAAKpE,EAAYq3I,EAAez6I,IAErD,MAAMm7I,EAAqB/oI,uBAAY,CAACrU,EAAQ2V,KAC9CinI,GAAc9nG,IACZ,MAAM0lG,EAAa,IAAI1lG,GAEvB,OADA0lG,EAAW7kI,GAAS3V,EACbw6I,CAAP,GAHF,GAKC,CAACoC,IAEES,EAAmBhpI,uBAAY,KACnCuoI,GAAc9nG,GAAW,IAAIA,EAAS,CAAC,IAAvC,GACC,CAAC8nG,IAEEU,EAAqBjpI,uBAAY,KACrCuoI,EAAc,CAAC,CAAC,IAChB3f,EAAS,GAAT,GACC,CAAC2f,EAAe3f,IAEbsgB,EAAgBzvI,mBAAQ,IACrB6uI,EAAWxrH,OAAMwG,GAAKA,EAAEr1B,KAAO/C,gBAAMo4B,EAAE9mC,UAC7C,CAAC8rJ,IAEEa,EAAsBnpI,uBAAY,KACtC,MAAMtK,EAAQ,CACZ6pC,IAAK+oG,EAAWxpJ,KAAI6M,IAClB,MAAM,GAACsC,EAAD,MAAKzR,EAAL,SAAYuqJ,GAAYp7I,EAExBy9I,EA1QOt9B,KACnB,MAAM19F,EAAQJ,GAAY89F,GACpBp0G,EAAS6uI,GAAUn4H,GAEzB,IAAK1W,EACH,MAAMjW,MAAM,6BAEd,OAAOiW,CAAP,EAmQuB2xI,CADGp7I,GAAMiJ,EAAWqnB,MAAK2lB,GAAKA,EAAEj2C,KAAOA,IAAI+4I,cAEtDsC,EAAoC,WAAbvC,EAAwBqC,EAAxB,UAAsCA,EAAtC,YAAkDrC,GAC/E,MAAO,CACL2B,kBAAmB,CACjBz6I,GAAIA,EACJ,CAACq7I,GAAuB9sJ,GAH5B,KAQJosI,EAASlzH,EAAT,GACC,CAAC4yI,EAAY1f,EAAU1xH,IAiB1B,OAfAqC,qBAAU,KAAO,IAAD,EACd,MAAM+uI,EAAU,OAAG5yI,QAAH,IAAGA,GAAH,UAAGA,EAAO6pC,WAAV,aAAG,EAAYzgD,KAAI6M,IACjC,MAAM49I,EAAiB59I,EAAO+8I,kBAExBY,EADWj+I,OAAOK,KAAK69I,GAAgB,GACPngJ,MAAM,KACtC29I,EAA2C,IAAhCuC,EAAqBnoJ,OAAemoJ,EAAqB,GAAK,SAC/E,MAAO,CACLr7I,GAAIs7I,EAAet7I,GACnBzR,MAAO+sJ,EAAel+I,OAAOK,KAAK69I,GAAgB,IAClDxC,SAAUA,EAHZ,IAMFwB,EAAcD,GAAc,CAAC,CAAC,GAA9B,GACC,CAAC5yI,EAAO6yI,IAENrxI,EAYqB,IAAtBA,EAAW/V,OAEX,eAACkuI,GAAD,CAAephI,GAAIA,KAAQ+jB,EAA3B,SACE,eAACw9G,GAAD,UACE,eAACE,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAACt3D,GAAA,EAAD,4LASH,eAACg1H,GAAD,CAAephI,GAAIA,KAAQ+jB,EAA3B,SACL,gBAACw9G,GAAD,WACE,eAACE,GAAD,CAAe/9D,GAAI,GAAnB,SACE,gBAACx3D,GAAA,EAAD,CAAKoyB,UAAW,EAAhB,UACG+7G,EAAWxpJ,KAAI,CAAC6M,EAAQ2V,IACvB,eAACnH,GAAA,EAAD,CAAiBm6F,QAAS,EAA1B,SACE,eAACwyC,GAAD,CACE5vI,WAAYA,EACZvL,OAAQA,EACRioC,SAAUjoC,GAAUo9I,EAAmBp9I,EAAQ2V,MAJzCA,KAQZ,gBAACnH,GAAA,EAAD,CAAKy3B,cAAc,MAAM19B,QAAQ,OAAjC,UACE,eAAC+H,GAAA,EAAD,CACEF,QAAQ,YAAY/I,MAAM,UAAUI,QAAS41I,EAD/C,iBAGA,eAAC7uI,GAAA,EAAD,CAAK+B,WAAY,EAAjB,SACE,eAACD,GAAA,EAAD,CACEF,QAAQ,YAAY/I,MAAM,UAAUI,QAAS61I,EAC7CtjG,SAAgC,IAAtB2iG,EAAWnnJ,QAAsD,IAAtCkK,OAAOK,KAAK48I,EAAW,IAAInnJ,OAFlE,6BAQR,eAACuuI,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAACx3D,GAAA,EAAD,CAAKoyB,UAAW,EAAGr4B,QAAQ,OAAO09B,cAAc,MAAMC,eAAe,QAArE,SACE,eAAC51B,GAAA,EAAD,CACEF,QAAQ,YAAY/I,MAAM,UAAUI,QAAS+1I,EAC7CxjG,UAAWujG,EAFb,oCApDJ,eAAC7Z,GAAD,CAAephI,GAAIA,KAAQ+jB,EAA3B,SACE,eAACw9G,GAAD,UACE,eAACE,GAAD,CAAe/9D,GAAI,GAAnB,SACE,eAAC6/C,GAAA,EAAD,SAqBV,IC/UAwY,OAAQ4Z,GACR9qH,SAAUurH,GACVmF,SAAU3E,IAGN4E,GAA0B/tI,cAAWnI,IAAK,CAC9CmuD,QAAS,CAAC,MA+FGgoF,OAvFQ74I,IAAMoI,MAAK,IAK3B,IAL4B,KACjCvG,EADiC,aAEjC06H,EAFiC,UAGjC70D,EAHiC,kBAIjC80D,GACI,EACJ,MAAO7wI,EAAO8mD,GAAYzyC,IAAMwI,YAC1B,YAAC+7C,GAAehO,MACf0rE,EAAQs1B,GAAa/uI,oBAAS,GAC/B/F,EAASm2I,KAIflwI,qBAAU,KACR4V,IAAM,KAAQi5H,GAAU,EAAV,GAAd,GACC,IAGH,MAAMuB,EAAYlwI,mBAAQ,IACN,OAAX27C,QAAW,IAAXA,KAAa5pD,QACjBH,OAAOsB,OAAOyoD,EAAY5pD,SAAS1M,KAAIgN,IAAW,IAAD,EAChD,OAAO,eAACqiI,GAAD,CAELlgI,GAAInC,EAAOV,IACX/E,MAAOyF,EAAOzF,MACd28B,MAAOl3B,EAAOk3B,MACdorG,eAAgB9wH,cAAI+pI,GAASv7I,EAAOV,KACpCwnC,SAAe,OAAN9mC,QAAM,IAANA,GAAA,UAAAA,EAAQ8mC,eAAR,eAAiBpnC,UAAWH,OAAOsB,OAAOb,EAAO8mC,QAAQpnC,SAC/D1M,KAAKmU,GAC4B,aAAhBA,EAAOrQ,KACnB,eAAC,GAAD,CAEAgW,SAAU3F,EAAO2F,SACjB9D,YAAa7B,EAAOrD,QACpBvJ,MAAO4M,EAAO5M,MACdwM,UAAWS,EAAOouD,SAJbzuD,EAAO7H,KAMZ,QAfHU,EAAOV,IADd,IAqBF,eAAC6mE,GAAA,EAAD,CAAOC,SAAS,UAAhB,6GAGD,CAAC9c,EAAa9hD,IAGXs2I,EAAWnwI,mBAAQ,IACL,OAAX27C,QAAW,IAAXA,KAAa5pD,QAChBH,OAAOsB,OAAOyoD,EAAY5pD,SACzBG,QAAOG,GAAUu7I,GAAQv7I,EAAOV,OAChCtM,KAAIgN,IACH,MAAM+9I,EAAOxC,GAAQv7I,EAAOV,KAC5B,OAAO,eAACy+I,EAAD,CAEL57I,GAAInC,EAAOV,IACX/E,MAAOyF,EAAOzF,MACd8M,KAAMrH,EAAOqH,MAHRrH,EAAOV,IADd,IAOF,MACH,CAACgqD,IAEJ,OAAO,gBAAC83E,GAAD,CACLxsH,SAAUlkB,EACV2wI,iBAAkB7pF,EAClB5wC,KAAMA,EACN06H,aAAcA,EACd70D,UAAWA,EACX80D,kBAAmBA,EANd,UAQL,eAACO,GAAD,UACG+b,IAEH,eAAC5a,GAAD,UACGjc,GAAU82B,MAZf,I,0CClHF,MAAME,GAAqBpuI,cAAWnI,IAAK,CACzCvD,KAAM,CACJo+B,SAAU,QAEZ27G,SAAU,CACRv8G,MAAO,OACPY,SAAU,QAEZ47G,UAAW,CACT3kG,SAAU,OACVjX,SAAU,aAGD67G,GAAYp5I,IAAMoI,MAAK,IAM7B,IAN8B,MACnC5S,EADmC,SAEnCwxH,EAFmC,MAGnC7kH,EAHmC,UAInCH,EAJmC,OAKnC63D,GACI,EACJ,MAAMp3D,EAASw2I,KAEf,OAAO,sBAAKj3I,UAAW+iC,mBAAK/iC,EAAWS,EAAOtD,MAAvC,SACL,eAACkoE,GAAA,EAAD,CACE7xE,MAAO,eAAC,GAAD,CAAUuJ,QAASvJ,EAAnB,SAA2BA,IAClCwxH,SAAUntD,OAAShoE,EAAYm1H,EAC/B7kH,MAAO03D,OAAShoE,EAAYsQ,EAC5Bg3C,KAAM0gB,EAAS,eAAC,KAAD,SAAchoE,EAC7ByP,QAAS,CAACnC,KAAMsD,EAAOy2I,SAAU1jJ,MAAOiN,EAAO02I,cANnD,IAkBFC,GAAUxwG,aAAe,CACvBzmC,MAAO,WAMF,MAEMk3I,GAAoB,GAC3BC,GAA0BzuI,cAAWnI,IAAK,CAC9CvD,KAAM,CACJw8B,SAAU,WACV09D,UAAW32F,EAAMkH,QALW,KAM5ByB,WAAY3I,EAAMkH,QAAQyvI,IAC1BvvI,YAAapH,EAAMkH,QAAQyvI,KAE7BE,MAAO,CACL79G,UAAWh5B,EAAMkH,QAXW,KAY5BvG,QAAS,OACT09B,cAAe,MACfE,SAAU,OACVp3B,WAAY,SACZm3B,eAAgB,SAChBpiC,gBAAiB8D,EAAMnE,QAAQC,QAAQf,KACvCm+B,aAAcl5B,EAAMkH,QAAQ,IAE9B4vI,UAAW,CACT79G,SAAU,WACV+2B,KAAMhwD,EAAMkH,QAAQ,IACpBs6B,MAAO,EACPtC,IAAK,EACLhF,OAAQl6B,EAAMkH,QAzBc,MA2B9Bq1B,MAAO,CACL98B,MAAOO,EAAMnE,QAAQ2/C,KAAK,UAGjBu7F,GAAiBz5I,IAAMoI,MAAK,IAIlC,IAJmC,SACxCL,EADwC,UAExC/F,EAFwC,SAGxCX,GACI,EACJ,MAAMoB,EAAS62I,KACf,OAAO,uBAAKt3I,UAAW+iC,mBAAK/iC,EAAWS,EAAOtD,MAAvC,UACL,eAAC,GAAD,CACE4I,SAAUA,EACVmD,QAAQ,UACR5J,QAAS,CAACnC,KAAMsD,EAAO+2I,UAAWlnJ,KAAMmQ,EAAOw8B,OAC/Cyf,aAAW,IAEb,sBAAK18C,UAAWS,EAAO82I,MAAvB,SACGl4I,MARL,IAmBFo4I,GAAe7wG,aAAe,CAC5BzmC,MAAO,WAMT,MAAMu3I,GAAmB7uI,cAAWnI,IAAK,CACvCvD,KAAM,CACJF,SAAU,SACVoM,WAAY3I,EAAMkH,QAAQ,IAC1BE,YAAapH,EAAMkH,QAAQ,GAC3BzH,MAAO,aAGEw3I,GAAU35I,IAAMoI,MAAK,IAA4B,IAA3B,UAACpG,EAAD,SAAYX,GAAc,EAC3D,MAAMoB,EAASi3I,KACf,OAAO,eAAClwI,GAAA,EAAD,CAAY0B,QAAQ,UAAUlJ,UAAW+iC,mBAAK/iC,EAAWS,EAAOtD,MAAhE,SAAwEkC,GAA/E,IAQWu4I,GAAW55I,IAAMoI,MAAK,IAC1B,eAACuxI,GAAD,oBAGIE,GAAU75I,IAAMoI,MAAK,IACzB,eAACuxI,GAAD,mBAIHG,GAAc,CAAChmJ,EAAMimJ,EAAa/yB,EAAUpnF,EAAY9xB,KAC5D,GAAIzT,gBAAM0/I,GAAc,MAAO,GAE/B,MAAQrvG,iBAAkB7sB,EAApB,oBAAgC2sB,EAAhC,UAAqDT,GAAcnK,EAAW9rC,GAC9EmU,EAAUpR,MAAMoR,QAAQ8xI,GACxBlrG,EAAQkrG,aAAuBvtI,IAC/BwtI,EAAQt/I,wBAAcq/I,GACtBz0H,EAAmB,QAAdykB,EAAsB,eAAC8vG,GAAD,IAAa,eAACD,GAAD,IACxCL,EAAQ,GAERU,EAAa,SAACzkJ,EAAOwxH,GAAR,IAAkBkzB,EAAlB,+DACjB,eAACd,GAAD,CAAuB5jJ,MAAOA,EAAOwxH,SAAUA,EAAUkzB,OAAQA,GAAjD1kJ,EADC,EAInB,GAAIg1C,EACF+uG,EAAM3pJ,KAAK,CAAEuqJ,KAAMF,EAAWp8H,EAAWk8H,IAAc,IAAM/yB,OAASn1H,KAAayzB,YAC9E,GAAIrd,GAAW4mC,EACpBh4C,MAAMm6D,KAAK+oF,GAAa99I,SAAQ,CAACtQ,EAAO8kB,KACtC8oI,EAAM3pJ,KAAK,CACTuqJ,KAAMF,EAAWp8H,EAAWlyB,EAAOmiB,IAAQ,KACzC,MAAM6K,EAAWk2B,EAAQ,IAAIriC,IAAIutI,GAAe,IAAIA,GACpDlrG,EAAQl2B,EAAS3R,OAAOrb,GAASgtB,EAAS9M,OAAO4E,EAAO,GACxDu2G,EAASruG,EAAT,IAEF2M,MANF,SASG,GAAI00H,EAAO,CAChB,MAAMI,EAAkB,CAAC5kJ,EAAO6kJ,KAC9B,MAAMj2H,EAAO,UAAMi2H,EAAN,YAAoBx8H,EAAWk8H,EAAYvkJ,GAAQsY,IAChE,IAAKzT,gBAAM0/I,EAAYvkJ,IAAS,CAC9B,IAAImjB,EAAW,IAAIohI,UACZphI,EAASnjB,GAChBmjB,EAAW8M,kBAAQ9M,QAAY9mB,EAAY8mB,EAC3C4gI,EAAM3pJ,KAAK,CAAEuqJ,KAAMF,EAAW71H,GAAS,IAAM4iG,EAASruG,KAAY2M,MACnE,GAGH80H,EAAgB,MAAO,MACvBA,EAAgB,KAAM,KACtBA,EAAgB,MAAO,MACvBA,EAAgB,KAAM,IACvB,MACCb,EAAM3pJ,KAAK,CAAEuqJ,KAAMF,EAAWp8H,EAAWk8H,IAAc,IAAM/yB,OAASn1H,KAAayzB,OAGrF,OAAOi0H,EAAMjpJ,OACX,eAACmpJ,GAAD,CAA2B1xI,SAAUjU,EAArC,SACGylJ,EAAMtrJ,KAAI,CAACg5E,EAAMx2D,IAChB,gBAAC,IAAMpH,SAAP,WACG49D,EAAKkzE,KACL1pI,EAAQ8oI,EAAMjpJ,OAAS,GAAK22E,EAAK3hD,KAFf7U,MAFJ3c,GAQnB,IATJ,EAeI8W,GAAYC,cAAWnI,IAAK,CAChCvD,KAAM,CACJw9B,MAAO,OACP99B,UAAW,aACXwE,QAAS,OACT09B,cAAe,MACfE,SAAU,OACVp3B,WAAY,WACZwB,WAAY3I,EAAMkH,SAAQ,IAC1BE,YAAapH,EAAMkH,SAAQ,KAE7Bs8G,MAAO,CACLxqF,UAAWh5B,EAAMkH,QAAQ,MAE3Bq9D,KAAM,CACJt9D,QAASjH,EAAMkH,QAAQ,SAGrB0wI,GAAat6I,IAAMoI,MAAK,IAA6B,IAA5B,UAAEpG,EAAF,QAAaV,GAAc,EACxD,MAAM,WAAEs+B,EAAF,SAAcmmB,EAAd,gBAAwBS,GAAoBjQ,KAC5C1xC,EAAQkhD,IACRyhE,EAAehhE,IACf9jD,EAAQy6C,gBACR,MAAErvC,GAAUgC,KACZrN,EAASmI,GAAU,CAAEtJ,UAASoB,UAE9B62I,EAAQ3wI,mBAAQ,KACpB,MAAM2wI,EAAQ,GAER1+I,EAAOL,OAAOK,KAAKgK,GACzBhK,EAAKmpB,OACL,IAAK,MAAMjc,KAAYlN,EAAM,CAC3B,MAAMk/I,EAAcl1I,EAAMkD,GAG1B,GADkB63B,EAAW73B,GAAUgzB,QACxB,CACb,MAAMw/G,EAAsBr2I,IAC1B,MAAMs2I,EAAW,GAgBjB,OAfAhgJ,OAAOC,QAAQyJ,GAAMjI,SAAQ,CAAC,EAAcwU,KAAW,IAAxBlW,EAAK5O,GAAkB,EAEpD,GAAI85B,kBAAQ95B,GAAQ,OAMpB6uJ,EAAS5qJ,KACP,gBAAC,IAAMyZ,SAAP,WACGywI,GAAY,GAAD,OAAI/xI,EAAJ,YAAgBxN,GAAO5O,GAPrBgtB,IAChB,MAAM8hI,EAAa,IAAKv2I,EAAM,CAAC3J,GAAMoe,QACpB9mB,IAAb8mB,UAA+B8hI,EAAWlgJ,GAC9CitH,EAAa,CAACz/G,EAAU0yI,GAAxB,GAIsD76G,EAAY9xB,GAC/D2C,EAAQjW,OAAOC,QAAQyJ,GAAM5T,OAAS,GAAK,eAACspJ,GAAD,MAF9C,UAAwB7xI,EAAxB,YAAoCxN,IADtC,IAOKigJ,CAAP,EAEIA,EAAWD,EAAmBR,GACpCS,EAASlqJ,QAAUipJ,EAAM3pJ,KAAK4qJ,EAE/B,KAAM,CACL,MAAMxzB,EAAYruG,GAAa6uG,EAAa,CAACz/G,EAAU4Q,IACvD4gI,EAAM3pJ,KAAKkqJ,GAAY/xI,EAAUgyI,EAAa/yB,EAAUpnF,EAAY9xB,GACrE,CACF,CAED,OAAOyrI,CAAP,GACC,CAAC10I,EAAO+6B,EAAY9xB,EAAO05G,IAE9B,OACE,sBAAKxlH,UAAW+iC,mBAAK/iC,EAAWS,EAAOtD,MAAvC,SACGo6I,EAAMjpJ,OACHipJ,EACA,eAAC/vI,GAAA,EAAD,CAAYxH,UAAWS,EAAOyjH,MAA9B,SAAqC,kEAJ7C,IAeIw0B,GAAiB7vI,cAAWnI,IAAK,CACrCvD,KAAM,CACJk6F,UAAW32F,EAAMkH,QA1OW,KA2O5BL,OAAQ7G,EAAMkH,QAAQ,EAAG,KACzB+yB,MAAO,OACPt5B,QAAS,OACT09B,cAAe,MACfl3B,WAAY,cAEd2N,OAAQ,CACNolB,OAAQl6B,EAAMkH,QAlPc,KAmP5BvG,QAAS,OACT09B,cAAe,MACfl3B,WAAY,SACZ8yB,MAAO,aA8DIg+G,OAvDD36I,IAAMoI,MAAK,KAAO,IAAD,IAC7B,MAAM,gBAACm9C,EAAD,WAAkB4J,EAAlB,WAA8BlI,GAAc1Q,KAC5C9zC,EAASi4I,KACTE,EAAer1F,IACftyB,EAAUk8B,IACVzlC,EAAUu9B,IAEhB,OAAO,gBAAC39C,GAAA,EAAD,CAAKtH,UAAWS,EAAOtD,KAAvB,UACL,eAACm7I,GAAD,IACA,gBAAClmG,GAAD,CAASpyC,UAAWS,EAAO+U,OAA3B,UACE,eAACq9B,GAAD,CACE91C,QAAQ,cACRwD,QAAS,IAAMq4I,IAFjB,SAIE,eAAC,KAAD,CAAW37I,SAAS,YAEtB,eAAC41C,GAAD,CACE91C,QAAQ,kBACRwD,QAAS,IAAM0wB,IAFjB,SAIE,eAAC,KAAD,CAAYh0B,SAAS,YAEvB,gBAAC41C,GAAD,CACE91C,QAAQ,GACRm2C,gBAAiBokE,GACjBnkE,YAAa,CACXp2C,QAAS,8BACTw+B,SAAU,KACVs4B,WAAW,EACX1c,KAAM,eAAC,KAAD,CAAUl6C,SAAS,UACzBi4F,YAAa,CACX50F,KAAM,UATZ,UAaE,eAACkH,GAAA,EAAD,mHAIA,eAAC,GAAD,CAAgBtF,KAAM,CAACgvB,MAAK,OAAExJ,QAAF,IAAEA,GAAF,UAAEA,EAAS1lB,YAAX,aAAE,EAAekvB,MAAOruB,MAAK,OAAE6kB,QAAF,IAAEA,GAAF,UAAEA,EAAS1lB,YAAX,aAAE,EAAea,SAC1E,eAAC20G,GAAD,IACA,eAAChwG,GAAA,EAAD,iLAKA,eAACmwG,GAAD,IACMjwF,YAxCZ,I,yCC5TF,MAAMtO,GAAWC,KACXzQ,GAAYC,cAAWnI,IAAK,CAChCvD,KAAM,CACJw9B,MAAO,OACPC,OAAQ,OACR/9B,UAAW,aACXwE,QAAS,OACT04F,oBAAqB,WACrBynC,iBAAkB,WAClBxnG,aAAct5B,EAAMkH,QAAQ,KAE9B4/H,KAAM,CACJC,WAAY,EACZC,QAAS,EACT/tG,SAAU,YAEZmzE,MAAO,CACL26B,WAAY,EACZC,QAAS,EACTrmI,QAAS,OACT09B,cAAe,MACfl3B,WAAY,SACZm3B,eAAgB,SAChBpE,OAAQ,OACRlB,UAAWh5B,EAAMkH,QAAQ,KAE3BmlG,MAAO,CACL06B,WAAY,EACZC,QAAS,EACT9sG,OAAQ,OACR9yB,YAAapH,EAAMkH,QAAQ,IAC3B+yB,MAAO,OACPt5B,QAAS,OACT09B,cAAe,MACfl3B,WAAY,SACZm3B,eAAgB,UAElB4oG,OAAQ,CACNH,WAAY,EACZC,QAAS,GAEXvnI,MAAO,CACLsnI,WAAY,EACZC,QAAS,EACT9sG,OAAQ,OACRvxB,WAAY3I,EAAMkH,QAAQ,IAC1B+yB,MAAO,OACPt5B,QAAS,OACT09B,cAAe,MACfl3B,WAAY,SACZm3B,eAAgB,UAElB65G,WAAY,CACVt8F,UAAW,qBAGTu8F,GAAc96I,IAAMoI,KAAKi2B,sBAAW,CAAC,EAcxC9iB,KAAY,IAbf,KACErX,EADF,MAEE+6B,EAFF,MAGEynD,EAHF,MAIEwjD,EAJF,UAKE6Q,EALF,SAMEC,EANF,UAOE3vG,EAPF,SAQEmjE,EARF,WASE1B,EATF,WAUEE,EAVF,kBAWEiuC,EACA,cAAe7lG,GACH,EACZ,MAAM3yC,EAASmI,KACTlI,EAAQy6C,gBACPsuB,EAAW+lC,GAAgBhpG,mBAAUtE,OAAcrS,EAAPqS,GAC7C+8C,EAAUW,cAMhBl5C,qBAAU,KACR,IAAKxE,EAEH,YADAstG,EAAattG,GAIf,MAAMg3I,EAAgB,CAACC,EAAQC,EAAQC,EAAYpN,EAAOqN,EAAOC,KAC/D,IAAIltC,EAAW,iDAEV8sC,GAAU,GAFA,kBAEsB,kBAAVlN,EAA4B,GAAKA,EAF7C,kBAGVmN,GAAU,GAHA,kBAGsB,kBAAVE,EAA4B,GAAKA,EAH7C,QASf,OALID,IACFhtC,GAAmB,UACdgtC,GAAc,GADA,eACSL,EAAW,OAAS,UAD7B,aACyD,kBAAdO,EAAgC,GAAKA,EADhF,SAGrBltC,GAAmB,kBACZA,CAAP,EAEImtC,EAAcpgI,GAAW,YAAc,UAIvC47F,EAAS,GACf,GAAa,OAAT+jC,QAAS,IAATA,KAAWhzI,UAAYizI,EAAU,CACnC,MAAMrgJ,EAAU,IAAI,IAAI6R,IAAItI,EAAK/B,QAC3Bs5I,EAAW9gJ,EAAQrK,OACnB0oB,EAAQ0iI,KAAmB,CAAC,EAAG,GAAIA,MACnClkI,EAAS,GACf,IAAK,MAAMvc,KAAUN,EAAS,CAC5B,MAAMghJ,EAAS,GACTC,EAAS,GACTC,EAAa,GACbC,EAAe,GACrB,IAAK,IAAIttJ,EAAI,EAAGA,EAAI0V,EAAK/B,MAAM7R,SAAU9B,EACnC0V,EAAK/B,MAAM3T,KAAOyM,IACpB0gJ,EAAO/rJ,KAAKsU,EAAK1U,EAAEhB,IACnBotJ,EAAOhsJ,KAAKsU,EAAKi8C,EAAE3xD,IACnBqtJ,EAAWjsJ,KAAKsU,EAAK/B,MAAM3T,IAC3BstJ,EAAalsJ,KAAKsU,EAAK9G,GAAG5O,KAG9BwoH,EAAOpnH,KAAK,CACVJ,EAAGmsJ,EACHx7F,EAAGy7F,EACHxoH,SAAU0oH,EACVhoJ,KAAMmH,EACN3I,KAAMupJ,EACN//H,KAAM,UACN/pB,KAAMypJ,EACNO,aAAc,aACdrtC,YAAY,EACZstC,cAAed,EACbx0D,EAAMznD,MACNirG,EAAMjrG,MACN87G,EAAU97G,MACVynD,EAAMl5F,KACN08I,EAAM18I,KACN,IAEFyuJ,OAAQ,CACN35I,KAAM,EACNH,MAAO6W,EAAMxB,GAAU,EAAI,EAAIA,GAAU7c,EAAQsG,QAAQhG,IAAWwgJ,EAAW,IAC/El8H,KAAM,CACJpd,MAAOO,EAAMnE,QAAQ2/C,KAAK,KAC1BvhB,MAAO,KAId,CAEF,MAAmB,OAATo+G,QAAS,IAATA,KAAWhzI,WAAaizI,EACjChkC,EAAOpnH,KAAK,CACVJ,EAAG0U,EAAK1U,EACR2wD,EAAGj8C,EAAKi8C,EACRh+C,MAAO+B,EAAK/B,MACZ7P,KAAM4R,EAAK/B,MACXixB,SAAUlvB,EAAK9G,GACf0e,KAAM,UACN/pB,KAAMypJ,EACNO,aAAc,aACdrtC,YAAY,EACZwtC,UAAW,OACXF,cAAed,EACbx0D,EAAMznD,MACNirG,EAAMjrG,MACN87G,EAAU97G,MACVynD,EAAMl5F,KACN08I,EAAM18I,KACNutJ,EAAUvtJ,MAEZyuJ,OAAQ,CACN35I,KAAM,EACNH,MAAO+B,EAAK/B,MACZg6I,WAAY,SACZ58H,KAAM,CACJpd,MAAOO,EAAMnE,QAAQ2/C,KAAK,KAC1BvhB,MAAO,GAETy/G,SAAU,CACRvY,UAAW,GACXwY,KAAM,EACNC,KAAM,EACNhkG,SAAU,CACRD,OAAQ31C,EAAMxE,WAAWE,gBAQjC44G,EAAOpnH,KAAK,CACVJ,EAAG0U,EAAK1U,EACR2wD,EAAGj8C,EAAKi8C,EACR/sB,SAAUlvB,EAAK9G,GACf0e,KAAM,UACN/pB,KAAMypJ,EACNO,aAAc,aACdrtC,YAAY,EACZwtC,UAAW,OACXF,cAAed,EACbx0D,EAAMznD,MACNirG,EAAMjrG,MACN,GACAynD,EAAMl5F,KACN08I,EAAM18I,KACN,IAEFyuJ,OAAQ,CACN35I,KAAM,EACNH,MAAOO,EAAMnE,QAAQE,UAAUhB,KAC/B8hB,KAAM,CACJpd,MAAOO,EAAMnE,QAAQ2/C,KAAK,KAC1BvhB,MAAO,MAKf60E,EAAawF,EAAb,GACC,QAAC+jC,QAAD,IAACA,OAAD,EAACA,EAAWhzI,SAAZ,OAAsBgzI,QAAtB,IAAsBA,OAAtB,EAAsBA,EAAW97G,MAAjC,OAAwC87G,QAAxC,IAAwCA,OAAxC,EAAwCA,EAAWvtJ,KAAM0W,EAAM82I,EAAUt4I,EAAOgkF,EAAMznD,MAAOynD,EAAMl5F,KAAM08I,EAAMjrG,MAAOirG,EAAM18I,OAE/H,MAAM+9C,EAAS3iC,mBAAQ,KACd,CACL4lG,SAAUA,EACVC,UAAW,UACX8tC,WAAY,CACV1tC,QAASnsG,EAAMnE,QAAQ2/C,KAAK,KAC5Bs+F,YAAa95I,EAAMnE,QAAQ2/C,KAAK,KAChC9F,KAAM,CACJj2C,MAAOO,EAAMnE,QAAQ2/C,KAAK,KAC1B7F,OAAQ31C,EAAMxE,WAAWE,aAG7BswG,YAAY,EACZtV,OAAQ,CACN5pG,EAAG,EACH0jH,QAAS,QACT/yD,EAAG,GAEL2uD,MAAO,CACL/8G,KAAM20F,EAAM1tE,MACZk/B,YAAY,EACZ7M,UAAWA,GAEb0jE,MAAO,CACLh9G,KAAMm4I,EAAMlxH,MACZk/B,YAAY,EACZ7M,UAAWA,GAEb9hC,OAAQ,CACNxb,EAAG,EACH2I,EAAG,EACHkC,EAAG,EACHwgB,EAAG,OAUN,CAACiyB,EAAWq7C,EAAM1tE,MAAOkxH,EAAMlxH,QAGlCtQ,qBAAU,KAAO,IAAD,GACd,UAAA6S,EAAO/C,eAAP,eAAgB43F,WAAY70F,EAAO/C,QAAQ43F,UAAU7kE,IAC5C,IACFA,EACHijE,cAHJ,GAMC,CAACA,EAAUjzF,IAEd,MAAM4lB,EAAchyB,uBAAY2G,IAC9B,MAAM2mI,EAAa3mI,EAAEwgE,OAAO,GAAGmmE,WACzBj2I,EAAUsP,EAAEwgE,OAAO,GAAGpyE,KAAKkvB,SAASqpH,GACpC73I,EAAI,mBAAe4B,GACzBy0I,IACAh6F,EAAQrxD,KAAKg6H,GAAOhlH,GAApB,GACC,CAACq8C,EAASg6F,IAEb,OAAO,uBAAKj5I,UAAWS,EAAOtD,KAAvB,UACL,sBAAK6C,UAAWS,EAAOssG,MAAvB,SACE,eAAC,GAAD,CACEhnG,SAAUmiI,EAAMniI,SAChBvS,MAAO00I,EAAMjrG,MACbzxC,KAAM08I,EAAM18I,KACZ0d,QAAQ,UACRuzC,SAAS,SAGb,sBAAKz8C,UAAWS,EAAO+mI,KAAvB,SACE,eAAC,GAAD,CACEtlI,KAAMunE,EACNlgC,OAAQA,EACR6gE,WAAYntE,EACZstE,cAAc,EACdlhE,UAAWA,EACXyhE,WAAYA,EACZE,WAAYA,EACZG,uBAAqB,EACrBC,gBAAc,EACd,cAAah4D,EACblyB,IAAK3H,EACLhZ,QAAS4+B,MAGb,sBAAKn/B,UAAWS,EAAOmnI,SACvB,sBAAK5nI,UAAWS,EAAOqsG,MAAvB,SACE,eAAC,GAAD,CACE/mG,SAAU2+E,EAAM3+E,SAChBvS,MAAOkxF,EAAMznD,MACbzxC,KAAMk5F,EAAMl5F,KACZ0d,QAAQ,eAGV8vI,GAAYD,GACZ,sBAAK/4I,UAAWS,EAAON,MAAvB,SACE,eAAC,GAAD,CACEs8C,SAAS,OACT12C,SAAUgzI,EAAUhzI,SACpBva,KAAMutJ,EAAUvtJ,KAChBgI,MAAOulJ,EAAU97G,MACjBh7B,YAAY,GACZiH,QAAQ,gBA3ChB,KAiEF4vI,GAAYlyG,aAAe,CACzB8zG,MAAO,gBACPC,MAAO,gBACPC,UAAW,iBAGE9B,U,iCCvVf,MAAM+B,GAA0BC,aAAOC,KAAPD,EAA0B,QAAC,MAAEp6I,GAAH,QAAgB,CACxE,kCAAmC,CACjC6G,OAAQ7G,EAAMkH,QAAQ,EAAG,KACzB83B,OAAQ,EACR,iBAAkB,CAChBA,OAAQ,GAEV,wBAAyB,CACvB9F,aAAcl5B,EAAM82B,MAAMoC,cAE5B,kBAAmB,CACjBA,aAAcl5B,EAAM82B,MAAMoC,eAX0B,IAmBpDhxB,GAAYC,cAAYnI,IAAD,CAC3BsoC,OAAQ,CACNrO,MAAO,OACPC,OAAQ,QAEVI,QAAS,CACPzzB,OAAQ7G,EAAMkH,QAAQ,GAAK,KAE7BozI,MAAO,CACLnhH,SAAU,YAIDohH,GAAoBj9I,IAAMoI,MAAK,IAarC,IAAD,QAZN,GACEhL,EADF,MAEE6hC,EAFF,YAGEh7B,EAHF,EAIEzU,EAJF,EAKE2wD,EALF,QAME+8F,EANF,KAOE56I,EAPF,UAQE+oC,EARF,SASEmjE,EATF,UAUExsG,EAVF,WAWE8qG,GACI,EACJ,MAAMrqG,EAASmI,MACT,MAACkD,GAASgC,KACVyL,EAAS+M,oBACR/8B,EAAO8hH,GAAY7kG,oBAAS,IAC5BsqC,EAAS1tC,GAAcoD,oBAAS,IACjC,aAAEk9C,EAAF,QAAgB0J,EAAhB,WAAyBxvB,EAAzB,aAAqCqlB,GAAiB1O,MAGrD4mG,EAASC,EAASC,EAAa98I,GAASqI,mBAAQ,KAAO,IAAD,EAC3D,MAAMu0I,EAAUv3H,GAAa,OAACp2B,QAAD,IAACA,OAAD,EAACA,EAAGuY,UAC3Bq1I,EAAUx3H,GAAa,OAACu6B,QAAD,IAACA,OAAD,EAACA,EAAGp4C,UAC3Bs1I,EAAqB,OAAPH,QAAO,IAAPA,GAAA,UAAAA,EAAS/6I,aAAT,SAAgB4F,SAAW6d,GAAcs3H,EAAQ/6I,MAAM4F,UAAY,CAAC,EACxF,OAAIo1I,EAAQ58I,OAAS68I,EAAQ78I,OAAS88I,EAAY98I,MACzC,CAAC,CAAC,EAAG,CAAC,EAAG,CAAC,EAAG,qDAEf,CAAC48I,EAASC,EAASC,OAAaxrJ,EAAvC,GACC,QAACqrJ,QAAD,IAACA,GAAD,UAACA,EAAS/6I,aAAV,aAAC,EAAgB4F,SAAjB,OAA2BvY,QAA3B,IAA2BA,OAA3B,EAA2BA,EAAGuY,SAA9B,OAAwCo4C,QAAxC,IAAwCA,OAAxC,EAAwCA,EAAGp4C,YAGxC,SAACu1I,EAAD,SAAWC,EAAX,aAAqBC,EAArB,aAAmCC,EAAnC,aAAiDC,EAAjD,iBAA+DC,EAA/D,SAAiF3C,GAAYpyI,mBAAQ,KAAO,IAAD,QAC/G,GAAIrI,EAAO,MAAO,CAAC,EACnB,MAAM+8I,EAAW,IAAI/sI,GAAKqvB,EAAWu9G,EAAQp1I,UAAUva,MAAQ,iBACzD+vJ,EAAW,IAAIhtI,GAAKqvB,EAAWw9G,EAAQr1I,UAAUva,MAAQ,iBACzDgwJ,EAAe,IAAIjtI,IAAK,UAAAqvB,EAAU,OAACy9G,QAAD,IAACA,OAAD,EAACA,EAAat1I,iBAAxB,eAAmCva,OAAQ,iBACnEiwJ,EAAejuJ,EAAEhC,KAAO,IAAI+iB,GAAK/gB,EAAEhC,MAAQ8vJ,EAASnnI,SAASrI,GAC7D4vI,EAAev9F,EAAE3yD,KAAO,IAAI+iB,GAAK4vC,EAAE3yD,MAAQ+vJ,EAASpnI,SAASrI,GAC7D6vI,EAA0B,OAAPT,QAAO,IAAPA,GAAA,UAAAA,EAAS/6I,aAAT,SAAgB3U,KAAO,IAAI+iB,GAAJ,OAAS2sI,QAAT,IAASA,GAAT,UAASA,EAAS/6I,aAAlB,aAAS,EAAgB3U,MAAQgwJ,EAAarnI,SAASrI,GAEvG,MAAO,CAACwvI,WAAUC,WAAUC,eAAcC,eAAcC,eAAcC,mBAAkB3C,UAD5D,OAAXqC,QAAW,IAAXA,OAAA,EAAAA,EAAat1I,WAAY,IAAIyE,IAAI,CAACoP,GAAM5a,OAAQ4a,GAAMkB,OAAOrQ,IAApC,UAAwCmzB,EAAWy9G,EAAYt1I,iBAA/D,aAAwC,EAAkCwV,OACpH,GACC,CAACqiB,EAAYpwC,EAAEhC,KAAM2vJ,EAAQp1I,SAAUo4C,EAAE3yD,KAAM4vJ,EAAQr1I,SAAvD,OAAiEm1I,QAAjE,IAAiEA,GAAjE,UAAiEA,EAAS/6I,aAA1E,aAAiE,EAAgB3U,KAAjF,OAAuF6vJ,QAAvF,IAAuFA,OAAvF,EAAuFA,EAAat1I,SAAU+F,EAAOvN,KAGlH,MAACmmF,EAAD,MAAQwjD,EAAR,UAAe6Q,GAAanyI,mBAAQ,KAAO,IAAD,EAC9C,GAAIrI,EAAO,MAAO,CAAC,EACnB,MAAMutI,EAAUluG,EAAWu9G,EAAQp1I,UAC7B61I,EAAUh+G,EAAWw9G,EAAQr1I,UAC7B81I,EAAcj+G,EAAWy9G,EAAYt1I,UACrCgmI,EAASv+I,EAAEyvC,QAAF,OAAW6uG,QAAX,IAAWA,OAAX,EAAWA,EAASt4I,QAASsxB,GAAgBgnH,GACtDgQ,EAAS39F,EAAElhB,QAAF,OAAW2+G,QAAX,IAAWA,OAAX,EAAWA,EAASpoJ,QAASsxB,GAAgB82H,GACtD5P,EAAK,OAAGF,QAAH,IAAGA,OAAH,EAAGA,EAASvwH,MACjBwgI,EAAK,OAAGH,QAAH,IAAGA,OAAH,EAAGA,EAASrgI,MACjBygI,GAAoB,OAAPd,QAAO,IAAPA,GAAA,UAAAA,EAAS/6I,aAAT,eAAgB88B,SAAhB,OAAyB4+G,QAAzB,IAAyBA,OAAzB,EAAyBA,EAAaroJ,QAASsxB,GAAgB+2H,GAC5EI,EAAaR,EAAajoJ,QAC1B0oJ,EAAaR,EAAaloJ,QAC1B2oJ,EAAiBR,EAAiBnoJ,QACxC,MAAO,CACLkxF,MAAO,IAAIl3F,KAAM2tJ,EAASl+G,MAAO8uG,EAAQvgJ,KAAMywJ,EAAYlsJ,KAAMi8I,GACjE9D,MAAO,IAAI/pF,KAAMi9F,EAASn+G,MAAO6+G,EAAQtwJ,KAAM0wJ,EAAYnsJ,KAAMgsJ,GACjEhD,UAAkB,OAAPmC,QAAO,IAAPA,KAAS/6I,MAAQ,IAAI+6I,EAAQ/6I,SAAUk7I,EAAap+G,MAAO++G,EAAYxwJ,KAAM2wJ,GAAkB,CAAC,EAH7G,GAKC,CAACd,EAAaM,EAAkBF,EAAcC,EAAc99G,EAA5D,OAAwEs9G,QAAxE,IAAwEA,OAAxE,EAAwEA,EAAS/6I,MAAO3S,EAAG2tJ,EAASh9F,EAAGi9F,EAAS78I,IAE7G69I,EAAan5F,EAAak4F,EAAQp1I,UAClCs2I,EAAap5F,EAAam4F,EAAQr1I,UAElC8lI,EAAYnoF,EAAatoD,GACzBusB,EAAa/gB,mBAAQ,MACzBf,UAAWvF,EACXunB,MAAO,SACL,CAACvnB,IACCwrB,EAAWllB,mBAAQ,KACvB,MAAMhO,EAAU,IAAI4R,IAAI,CAAC,aACzB,IAAK,MAAMpS,IAAU,CAAC+iJ,EAASC,EAASC,GACtC,IAAK53H,kBAAQrrB,GAAS,CACpBQ,EAAQrE,IAAI6D,EAAO2N,UACnB,IAAK,MAAM6+G,KAASxsH,EAAO6rB,OACzBrrB,EAAQrE,IAAIqwH,EAEf,CAEH,MAAO,CAAChsH,QAAS,IAAIA,GAArB,GACC,CAACuiJ,EAASC,EAASC,IAEtB30I,qBAAU,KACRtD,GAAW,EAAX,GACC,CAAC0oB,EAAUnE,IAEd,MAUM20H,EAAOlvF,EAAQhyD,EAAI0wB,EAAUnE,EAVdxa,uBAAY,KAC/B/J,GAAW,EAAX,GACC,KASGm5I,EAAU31I,mBAAQ,KACtB,IAAK01I,GAAQ/9I,EAAO,OACpB,SAASooG,EAAQ61C,GACf,MAAMC,EAAU,CAAC,EAIjB,IAAK,MAAO3qJ,EAAM8Q,IAAS,CAAC,CAAC,IAAKu4I,EAAQv4I,MAAO,CAAC,IAAKw4I,EAAQx4I,MAAO,CAAC,QAASy4I,EAAYz4I,OAAQ,CAClG,GAAI6gB,kBAAQ7gB,GAAO,SACnB,IAAIjZ,EACJ,IACEA,EAAQm6B,KAAS9sB,OAAOwlJ,EAAK55I,EAG9B,CAFC,MAAOd,GACP,MAAO,CAACvD,MAAO,mBAChB,CAGD,GAAIlG,gBAAM1O,GAAQ,CAChB,GAAa,UAATmI,IAAoBknJ,EAGtB,MAAO,CAACz6I,MAAO,eAFf5U,EAAQ,WAIX,CACD8yJ,EAAQ3qJ,GAAQnI,CACjB,CAGD,MAAM+yJ,EAASC,GAASF,EAAQjvJ,GAC1BovJ,EAASD,GAASF,EAAQt+F,GAGhC,GAAIu+F,EAAOA,EAAOpuJ,OAAS,KAAOsuJ,EAAOA,EAAOtuJ,OAAS,GACvD,MAAO,CAACiQ,MAAO,6BAIjB,MAAMs+I,EAAe,CAACH,EAAQE,GAAQ5nJ,QAAO,CAACgzD,EAAMxxC,IAC1CwxC,EAAK15D,OAASkoB,EAAQloB,OAC1B05D,EACAxxC,IAENimI,EAAQjvJ,EAAIsvJ,GAAYL,EAAQjvJ,EAAGkvJ,EAAQG,GAC3CJ,EAAQt+F,EAAI2+F,GAAYL,EAAQt+F,EAAGy+F,EAAQC,GAG3C,IAAIE,EAAa1B,EAAYz4I,MAAQ+5I,GAASF,EAAQt8I,OACtD,GAAI48I,IAAejtF,kBAAQitF,EAAYF,GAQrC,GALI7D,GAAY+D,EAAWzuJ,SAAWuuJ,EAAavuJ,OAAS,IAC1DmuJ,EAAQt8I,MA0OlB,SAAqBmE,GACnB,SAAS04I,EAAUC,GACjB,GAAIh3I,kBAAQg3I,GAAM,CAChB,IAAIh3I,kBAAQg3I,EAAI,IAKd,OAAOA,EAAIj7H,OAAOjmB,KAAK,MAJvB,IAAK,IAAIvP,EAAI,EAAGA,EAAIywJ,EAAI3uJ,SAAU9B,EAChCywJ,EAAIzwJ,GAAKwwJ,EAAUC,EAAIzwJ,GAK5B,CACD,OAAOywJ,CACR,CACD,OAAOD,EAAU14I,EAClB,CAxPyB44I,CAAYT,EAAQt8I,OACpC48I,EAAaA,EAAWxsJ,MAAM,GAAI,IAGV,IAAtBwsJ,EAAWzuJ,QAAuC,IAAtByuJ,EAAWzuJ,QAAkC,IAAlByuJ,EAAW,GACpEN,EAAQt8I,MAAQrL,GACd+nJ,EACsB,IAAtBE,EAAWzuJ,OACNmuJ,EAAQt8I,MACRs8I,EAAQt8I,MAAM,QAGhB,MAAK48I,EAAWzuJ,OAASuuJ,EAAavuJ,QAAWyuJ,EAAW,KAAOF,EAAa,IAGrF,MAAO,CAACt+I,MAAO,+BAFfk+I,EAAQt8I,MA4QlB,SAAoBowE,EAAO4sE,EAAUC,GAGnC,GADaA,EAAS9uJ,OAAS6uJ,EAAS7uJ,SAC3B,EAAG,OAAOiiF,EAGvB,MAAM8sE,EAAgB,GAChBC,EAAUF,EAAS,GACzB,IAAK,IAAI5wJ,EAAI,EAAGA,EAAI8wJ,IAAW9wJ,EAAG,CAChC,MAAM+wJ,EAAa,GACnB,IAAK,IAAIlwJ,EAAI,EAAGA,EAAI+vJ,EAAS,KAAM/vJ,EACjCkwJ,EAAW3vJ,KAAK,CAAC2iF,EAAM/jF,KAEzB6wJ,EAAczvJ,KAAK2vJ,EACpB,CACD,OAAOF,CACR,CA5RyBG,CAAWf,EAAQt8I,MAAO48I,EAAYF,EAGvD,CAWH,OAPAJ,EAAQjvJ,EAAI2jD,GAAQsrG,EAAQjvJ,GAC5BivJ,EAAQt+F,EAAIhN,GAAQsrG,EAAQt+F,GAC5Bs+F,EAAQt8I,MAAQk7I,EAAYz4I,MAAQuuC,GAAQsrG,EAAQt8I,OAKhDs8I,EAAQjvJ,EAAEc,SAAWmuJ,EAAQt+F,EAAE7vD,QAAW+sJ,EAAYz4I,MAAQ65I,EAAQjvJ,EAAEc,SAAWmuJ,EAAQt8I,MAAM7R,OAC5F,CAACiQ,MAAO,mCAGV,CAACk+I,UAAS5nD,QAAS4nD,EAAQjvJ,EAAEc,OACrC,CACD,MAAMd,EAAI,GACJ2wD,EAAI,GACJh+C,EAAQk7I,EAAYz4I,KAAO,QAAK/S,EAChCuL,EAAK,GACX,IAAK,MAAMohJ,KAAOF,EAAM,CACtB,MAAM,QAACG,EAAD,MAAUl+I,EAAV,QAAiBs2F,GAAW8R,EAAQ61C,GAC1C,IAAIj+I,GAAUs2F,EACd,IAAK,MAAMroG,KAAK2oD,gBAAM0/C,GAAU,CAAC,IAAD,EAC9BrnG,EAAEI,KAAK6uJ,EAAQjvJ,EAAEhB,IACjB2xD,EAAEvwD,KAAK6uJ,EAAQt+F,EAAE3xD,IACjB6uJ,EAAYz4I,MAAQzC,EAAMvS,KAAN,UAAW6uJ,EAAQt8I,aAAnB,aAAW,EAAgB3T,IAC/C4O,EAAGxN,KAAK4uJ,EAAIprH,SACb,CACF,CACD,MAAO,CAAC5jC,IAAG2wD,IAAGh+C,QAAO/E,KAArB,GACC,CAAC49I,EAAUsD,EAAMnB,EAAQv4I,KAAMw4I,EAAQx4I,KAAMy4I,EAAYz4I,KAAMrE,IAG5D2D,EAAO0E,mBAAQ,KACnB,IAAK21I,EAAS,OAWd,MAAO,CAAC/uJ,EAVEk3F,EAAM30F,OAAS6pB,GAAMiB,UAC3B0hI,EAAQ/uJ,EACR,IAAIqnB,GAAS0nI,EAAQ/uJ,EAAG8tJ,GAAUvnI,GAAG0nI,GAAc9xJ,QAQ5Cw0D,EAPD+pF,EAAMn4I,OAAS6pB,GAAMiB,UAC3B0hI,EAAQp+F,EACR,IAAItpC,GAAS0nI,EAAQp+F,EAAGo9F,GAAUxnI,GAAG2nI,GAAc/xJ,QAKzCwW,MAJAo8I,EAAQp8I,QAAU64I,EAC5BuD,EAAQp8I,MACR,IAAI0U,GAAS0nI,EAAQp8I,MAAOq7I,GAAcznI,GAAG4nI,GAAkBhyJ,SAE9CyR,GAAImhJ,EAAQnhJ,GAAjC,GACC,CAACmhJ,EAASZ,EAAkBF,EAAcC,EAAcF,EAAcF,EAAUC,EAAUvC,EAAUt0D,EAAOwjD,IAExGxqF,EAAavwC,uBAAY,KAC7B0+H,GAAUn+H,IAAgB,IAAIA,EAAKknC,SAAS,KAA5C,GACC,CAACi3F,IAEE4R,EAAwBtwI,uBAAY,CAACwxB,EAAOh1C,KAClC,OAAVA,GACFkiJ,GAAUn+H,IAAG,IAASA,EAAK8+F,SAAU7iH,KACtC,GACA,CAACkiJ,IAEE6R,EAAmBvwI,uBAAY,KACnCoM,EAAO/C,QAAQtJ,OAAf,GACC,IAEG6pF,EAAc5pF,uBAAY,KAAO,IAAD,EAGpC,UAAAoM,EAAO/C,eAAP,SAAgBq4F,aAChBxD,GAAS39F,IAAQA,GAAjB,GACC,IAEGiwI,EAAiBxwI,uBAAajL,IAClC,MAAMizC,EAAK,OAAGjzC,QAAH,IAAGA,OAAH,EAAGA,EAAMizC,MACfA,IACLinG,EAAW,CACThS,IAAK,IAAIv1H,GAASsgC,EAAM3nD,EAAE,GAAIiuJ,GAC9BpR,IAAK,IAAIx1H,GAASsgC,EAAM3nD,EAAE,GAAIiuJ,KAEhCY,EAAW,CACTjS,IAAK,IAAIv1H,GAASsgC,EAAMgJ,EAAE,GAAIu9F,GAC9BrR,IAAK,IAAIx1H,GAASsgC,EAAMgJ,EAAE,GAAIu9F,KAEtB,OAAV5wC,QAAU,IAAVA,KAAa5oG,GAAb,GACC,CAAC4oG,EAAYsxC,EAAYC,EAAYZ,EAAcC,IAEhD1sC,GAAiB7hG,uBAAY,KACvB,OAAV29F,QAAU,IAAVA,UAAaj7G,EAAb,GACC,CAACi7G,IAEE/qE,GAAUn5B,mBAAQ,IACb,uCACL,eAACotC,GAAD,CACEj3C,QAAS4uI,GACTn4I,MAAM,YACN7J,MAAO0/C,EACPtI,SAAWp3C,GAAUkiJ,GAAUn+H,IAAG,IAASA,EAAK27B,UAAW1/C,QAE7D,eAACy5G,GAAA,EAAD,CAASw6C,UAAQ,EAAC9b,YAAY,WAAW9hI,UAAWS,EAAOu6B,UAC3D,gBAAC6/G,GAAD,CACEv6I,KAAK,QACL3W,MAAO6iH,EACP1kE,WAAS,EACT/G,SAAU08G,EAJZ,UAME,eAACI,GAAA,EAAD,CAAcl0J,MAAM,MAApB,SACE,eAACuzC,GAAA,EAAD,CAASD,MAAM,MAAf,SACE,eAAC6gH,GAAA,EAAD,CAAS7gJ,SAAS,cAGtB,eAAC4gJ,GAAA,EAAD,CAAcl0J,MAAM,SAApB,SACE,eAACuzC,GAAA,EAAD,CAASD,MAAM,kBAAf,SACE,eAAC8gH,GAAA,EAAD,CAAU9gJ,SAAS,iBAIzB,eAACmmG,GAAA,EAAD,CAASw6C,UAAQ,EAAC9b,YAAY,WAAW9hI,UAAWS,EAAOu6B,UAC3D,eAAC6X,GAAD,CAAQ91C,QAAQ,aAAawD,QAASm9I,EAAtC,SACE,eAAC,KAAD,CAAQzgJ,SAAS,YAEnB,eAAC41C,GAAD,CAAQ91C,QAAQ,oBAAoBwD,QAASw2F,EAA7C,SACE,eAAC0C,GAAA,EAAD,CAAYx8F,SAAS,gBAG1B,CAACuvG,EAAUixC,EAAuBC,EAAkB3mD,EAAa1tD,EAAWwiG,EAAWprI,IAEpFu9I,GAAkB7wI,uBAAY,KAClCk+F,GAAS,EAAT,GACC,IAEH,OAAO,eAACjV,GAAD,CACHp2F,UAAWA,EACXzW,MAAOA,EACP8sG,QAASU,EAHN,SAKL,eAACv5C,GAAD,CACEpiD,GAAIA,EACJ6hC,MAAOA,GAAS,eAChBh7B,YAAaA,EACbw7C,OAAQC,EACR3d,QAASA,GACT//B,UAAWS,EAAOuoC,OANpB,SAQGzqC,EACG,eAAC6gE,GAAA,EAAD,CAAOC,SAAS,QAAQr/D,UAAWS,EAAOu6I,MAA1C,SACGz8I,IAEH,eAAC,GAAD,CACA2D,KAAM4uC,OAAUjhD,EAAYqS,EAC5BwiF,MAAOA,EACPwjD,MAAOA,EACP6Q,UAAWA,EACXC,SAAUA,EACV3vG,UAAWA,EACXyhE,WAAY6yC,EACZ3yC,WAAYgE,GACZxC,SAAUA,EACVysC,kBAAmB+E,GACnB,cAAa5iJ,EACb8lB,IAAK3H,OA7Bb,IAkDqC6kC,GAAa5mB,MAAM,CACxDhqC,EAAGixD,GAAW3yB,SAAS,wCACvBqyB,EAAGM,GAAW3yB,SAAS,wCACvBovH,QAASv8F,GACTr+C,KAAM9W,eAASH,UAAUyiC,SAAS,qBAClCud,UAAWyrF,iBAMb,SAAS3jF,GAAQ7sC,GACf,OAAO2B,kBAAQ3B,GACX23F,sBAAY33F,GACZ,CAACA,EACN,CAKD,SAASq4I,GAASr4I,GAChB,IAAK2B,kBAAQ3B,GACX,MAAO,GAGT,MAAMkzB,EAAQ,GACd,IAAIymH,EAAQ35I,EAEZ,KAAO2B,kBAAQg4I,IACbzmH,EAAM5pC,KAAKqwJ,EAAM3vJ,QACjB2vJ,EAAQA,EAAM,GAGhB,OAAOzmH,CACR,CAyBD,SAASslH,GAAYvsE,EAAO4sE,EAAUC,GAEpC,MAAMjX,EAAOiX,EAAS9uJ,OAAS6uJ,EAAS7uJ,OACxC,GAAa,IAAT63I,EAAY,OAAO51D,EAGvB,MAAM8sE,EAAgB,GActB,OAbA,SAASa,EAAUC,GACjB,MAAMzlF,EAAM0kF,EAASe,GAErB,GADgBA,IAAUhY,EAExB,OAAO51D,EAEP,IAAK,IAAIljF,EAAI,EAAGA,EAAIqrE,IAAOrrE,EACzBgwJ,EAAczvJ,KAAKswJ,EAAUC,EAAQ,IAGzC,OAAOd,CACR,CACDa,CAAU,GACHb,CACR,CA2BD,SAASvoJ,GAAK0iC,EAAO4mH,GACnB,GAAqB,IAAjB5mH,EAAMlpC,OACR,OAAO8vJ,EACF,CACL,MAAMC,EAAa7mH,EAAMjnC,MAAM,GACzB+tJ,EAAa,GACnB,IAAK,IAAI9xJ,EAAI,EAAGA,EAAIgrC,EAAM,GAAIhrC,IAC1B8xJ,EAAW1wJ,KAAKkH,GAAKupJ,EAAYD,IAErC,OAAOE,CACR,CACF,CCtfM,MAAM11I,GAAYC,cAAWnI,IAAK,CACvCi6B,MAAO,CACLY,SAAU,aAGDgjH,GAAmBvgJ,IAAMoI,MAAK,IAAqE,IAApE,GAAChL,EAAD,MAAK6hC,EAAL,KAAYp9B,EAAZ,QAAkBg1C,EAAlB,SAA2B2c,EAA3B,QAAqCryD,EAArC,MAA8CZ,EAA9C,SAAqDc,GAAc,EAC7G,MAAMoB,EAASmI,MACT,gBAAE0rC,GAAoBC,KACtBE,EAAeH,IAEfx0C,EAAcqN,uBAAY,CAACwxB,EAAOy0B,KAGvB,kBAAXA,IAMJj0D,GAAWA,IACN01C,GACHJ,EAAar5C,GACd,GACA,CAACA,EAAI+D,EAASs1C,EAAcI,IAEzBoe,EAAe9lD,uBAAY,KAC/BqkD,GAAYA,GAAZ,GACC,CAACA,IAEJ,OAAO,gBAAC50B,GAAA,EAAD,CACLi3B,WAAW,EACXt4B,SAAS,KACT17B,KAAMA,EACNP,QAAS,CAACk/I,aAAc/9I,EAAOk6B,OAC/Bx7B,QAASW,EALJ,UAOL,eAAC+8B,GAAA,EAAD,UAAcI,GAAS,KACvB,eAACH,GAAA,EAAD,UACGz9B,IAEH,gBAAC09B,GAAA,EAAD,WACE,eAAC3zB,GAAA,EAAD,CAAQ7I,QAAST,EAAaK,MAAM,UAApC,oBAGA,eAACiJ,GAAA,EAAD,CAAQ0pC,WAAYv0C,EAAOgC,QAAS0yD,EAAc9yD,MAAM,UAAxD,uBAfJ,IAqCIs+I,GAAqB51I,cAAYnI,IAAD,CACpC47B,QAAS,CACPn8B,MAAOO,EAAMnE,QAAQC,QAAQf,MAE/Bob,KAAM,CACJ8jB,MAAO,YAGE+jH,GAAkB1gJ,IAAMoI,MAAK,IAAwB,IAAvB,MAAC62B,EAAD,SAAQ59B,GAAc,EAC/D,MAAMoB,EAASg+I,KAEf,OAAO,uCACL,eAACj3I,GAAA,EAAD,CAAY0B,QAAQ,SAASlJ,UAAWS,EAAO67B,QAA/C,SAAyDW,IACzD,eAAC+I,GAAA,EAAD,CAAME,OAAK,EAAClmC,UAAWS,EAAOoW,KAA9B,SACGxX,MAHL,IAgBWs/I,GAAmB3gJ,IAAMoI,MAAK,IAAiB,IAAhB,SAAC/G,GAAc,EACzD,OAAO,eAAC4mC,GAAA,EAAD,UACJ5mC,GADH,IAYWu/I,GAAmB5gJ,IAAMoI,MAAK,IAAkD,IAAjD,MAAC5S,EAAD,SAAQs/C,EAAR,QAAkBn6C,EAAlB,MAA2BhP,EAA3B,SAAkCo3C,GAAc,EAC1F,OAAO,eAACgwB,GAAA,EAAD,CACHklC,QAAM,EACNpiC,WAAS,EACTrgE,MAAOA,EACP0V,QAAQ,SACRvf,MAAOA,GAAS,GAChBo3C,SAAUA,EACV+R,SAAUA,EAPP,SASFt6C,OAAOC,QAAQE,GAAS1M,KAAI,QAAEsM,EAAK5O,GAAP,SAC3B,eAACoqD,GAAA,EAAD,CAAUpqD,MAAOA,EAAjB,SAAmC4O,GAANA,EADF,KATjC,IChHWsmJ,GAAsB7gJ,IAAMoI,MAAK,IAQvC,IAPP,GACEhL,EADF,MAEE6hC,EAFF,YAGEh7B,EAHF,SAIE8D,EAJF,MAKEiR,EALF,UAMEhX,GACI,EACJ,MAAM,aAAE0jD,GAAiBnP,KACnBs3F,EAAYnoF,EAAatoD,GAEzBsiD,EAAavwC,uBAAY,KAC7B0+H,GAAUn+H,IAAgB,IAAIA,EAAKknC,SAAS,KAA5C,GACC,CAACi3F,IAEEK,EAAoB/+H,uBAAaxjB,IACrCkiJ,GAAUn+H,IAAgB,IAAIA,EAAKsJ,MAAOrtB,KAA1C,GACC,CAACkiJ,IAEJ,OAAO,eAACruF,GAAD,CACLpiD,GAAIA,EACJ2K,SAAUA,EACVk3B,MAAOA,EACPh7B,YAAaA,EACbw7C,OAAQC,EACR19C,UAAWA,EACX+/B,QACE,eAACsT,GAAD,CACE1pD,MAAOqtB,EACPre,QAASm8C,GACT/3C,QAAQ,qBACRgkC,SAAUmrG,IAZT,SAgBL,eAACthJ,GAAD,CACEmb,SAAUA,EACViR,MAAOA,EACP6mC,UAAU,EACVrE,mBAAmB,EACnB3E,SAAS,EAIT8oF,MAAO,YAzBX,IA0CWmhB,GAA0B9gJ,IAAMoI,MAAM7G,IAC/C,MAAM,GAACnE,EAAD,QAAKw5C,EAAL,QAAcC,GAAWt1C,GACzB,aAAEmkD,GAAiBnP,MAClBwqG,EAAUC,GAAex4I,mBAASjH,IAClCrB,EAAQ+gJ,GAAaz4I,mBAAS,CAAC,GAChCqlI,EAAYnoF,EAAatoD,GACzB0F,EAAW8F,mBAAQ,IAChBpO,OAAOsB,OAAOoE,GAAQhN,MAAM4iB,KAAQA,MAAOorI,GAA0BC,YAAYJ,IACvF,CAAC7gJ,EAAQ6gJ,IAENvpF,EAAeroD,uBAAa4xI,IAChClT,GAAUn+H,IAAG,IAASA,KAAQqxI,KAA9B,GACC,CAAClT,IAEEt2E,EAAepoD,uBAAY,CAAC5U,EAAK5O,KACrCq1J,GAAYtxI,IAAG,IAASA,EAAK,CAACnV,GAAM5O,KAApC,GACC,CAACq1J,IAEEl/I,EAAcqN,uBAAY,KAC9B0+H,GAAUn+H,IAAG,IAASA,EAAKknC,SAAS,KAApC,GACC,CAACi3F,IAEEnvE,EAAcvvD,uBAAY,CAAC5U,EAAK5O,KACpCs1J,GAAUvxI,IAAG,IAASA,EAAK,CAACnV,GAAM5O,KAAlC,GACC,CAACs1J,IAEEhsF,EAAe9lD,uBAAY,CAAC5U,EAAK5O,KACrC,IACEu1J,GAA0BE,eAAe7mJ,EAAK,CAAC,CAACA,GAAM5O,GAIvD,CAHC,MAAOmY,GAEP,YADA46D,EAAYnkE,EAAKuJ,EAAEpD,QAEpB,CACDugJ,GAAUvxI,IAAG,IAASA,EAAK,CAACnV,QAAM1I,MAClCmvJ,GAAYtxI,IAAG,IAASA,EAAK,CAACnV,GAAM5O,KAApC,GACC,CAAC+yE,EAAasiF,IAEXK,EAAmBlyI,uBAAY,KACnCqoD,EAAa,IAAIupF,EAAUnqG,SAAS,EAAOC,SAAS,GAApD,GACC,CAAC2gB,EAAcupF,IAElB,OAAO,gBAACR,GAAD,CACHnjJ,GAAIA,EACJyE,KAAM+0C,EACNC,QAASA,EACT5X,MAAM,6BACN99B,QAASW,EACT0xD,SAAU6tF,EACV9gJ,MAAOuC,EAPJ,UASL,eAAC49I,GAAD,CAAiBzhH,MAAM,WAAvB,SACE,eAAC0hH,GAAD,UACE,eAAC5tF,GAAA,EAAD,CACEklC,QAAM,EACNpiC,WAAS,EACTrgE,MAAM,qBACN0V,QAAQ,SACRvf,MAAOo1J,EAAS/nI,MAChB+pB,SAAWpC,IACT42B,EAAa,QAAS52B,EAAMlnB,OAAO9tB,OACnCspE,EAAa,QAASt0B,EAAMlnB,OAAO9tB,MAAnC,EARJ,SAWG6O,OAAOK,KAAKi8C,IAAQ7oD,KAAKsM,GACxB,eAACw7C,GAAA,EAAD,CAAUpqD,MAAO4O,EAAjB,SAAiCA,GAANA,WAKnC,eAACmmJ,GAAD,CAAiBzhH,MAAM,UAAvB,SACE,eAAC0hH,GAAD,UACE,eAAC9tF,GAAD,CACEr9D,MAAM,QACNqgE,WAAS,EACTlqE,MAAK,OAAEo1J,QAAF,IAAEA,OAAF,EAAEA,EAAU9hH,MACjB8D,SAAWpC,GAAU42B,EAAa,QAAS52B,EAAMlnB,OAAO9tB,eAlChE,IAkDSu1J,GAA4B9gG,GAAa5mB,MAAM,CAC1DzxB,SAAUs4C,eAASvyB,SAAS,yBAC5B9U,MAAOqnC,eAASvyB,SAAS,wBC9IrBw4F,GAAS,IAAI95G,IAAI,CAACoP,GAAM5a,OAAQ4a,GAAMkB,OAKtClS,GAAYC,cAAWnI,IAAK,CAChCvD,KAAM,CAAC,EAEPmiJ,eAAgB,CACd3lH,SAAU,WACVgB,MAAO,OACPC,OAAQ,QAEV2kH,eAAgB,CACd5lH,SAAU,WACViG,IAAK,EACLkY,OAAQ,EACR5V,MAAO,EACPwuB,KAAM,EACNrvD,QAAS,OACT09B,cAAe,UAEjBsa,SAAU,CACRze,OvCnC2B,IuCqC7B4kH,iBAAkB,CAChB,iBAAkB,CAChB5iJ,gBAAiB,gBAGrB26I,MAAO,CACLl2I,QAAS,OACT49B,SAAU,QAEZkY,KAAM,CACJjV,MAAOxhC,EAAMkH,QAAQ,IAEvB6qC,OAAQ,CACNpN,KAAM,EACNgyD,UAAW,GAEbqoC,UAAW,CACT1lG,aAAct5B,EAAMkH,QAAQ,IAE9B6U,MAAO,CACLme,OAAQ,SACRlB,UAAWh5B,EAAMkH,QAAQ,KACzBE,YAAapH,EAAMkH,QAAQ,GAC3BvG,QAAS,OACT29B,eAAgB,WAChBn3B,WAAY,SACZ1H,MAAOO,EAAMnE,QAAQjM,KAAKwiD,cAGjB2sG,GAAczhJ,IAAMoI,MAAK,IAU/B,IATP,GACEhL,EADF,MAEE6hC,EAFF,YAGEh7B,EAHF,SAIE8D,EAJF,MAKEiR,EALF,UAMEoyB,EANF,UAOEppC,EACA,cAAeozC,GACX,EACJ,MAAM,OAACiR,EAAD,eAASnB,EAAT,WAAyBtlB,GAAc2W,KACvC9zC,EAASmI,MACR9P,EAAQw8D,GAAapS,EAAen9C,IACrC,OAAE60B,EAAF,IAAU1Z,GAAQw6B,gBAClB,aAAEgI,GAAiBnP,KACnBs3F,EAAYnoF,EAAatoD,GAGzBskJ,EAAU94I,mBAAQ,IAAMxa,KAAK03C,IAAI13C,KAAK6E,MAAM2pC,EvCrFrB,IuCqFgD,IAAI,CAACA,IAC5EmwB,EAAYnkD,mBAAQ,KAAO,IAAD,EAC9B,MAAMxO,EAAS,CAACrI,KAAM,QAASuQ,KAAMo/I,GAI/B/mJ,EAAO,UAAGilC,EAAW73B,UAAd,aAAG,EAAsBpN,QAEtC,OADIA,IAASP,EAAOQ,QAAUJ,OAAOK,KAAKF,IACnCP,CAAP,GACC,CAACsnJ,EAAS9hH,EAAY73B,IACnB8lC,EAAMwY,EAAOt+C,GAAW1N,gBAAMuiC,GAASx/B,EAAI2vD,GAC3CjnB,EAAM+H,EAAMz/C,KAAK03C,OAAO+H,EAAI3pC,KAAKjW,KAAIgN,GAAUA,EAAOwjB,SAAU,EAEhE84C,EAAepoD,uBAAY,CAACwxB,EAAOpmC,EAAKsV,KAC5CynD,GAAU5nD,IACR,IAAKA,EAAK,OAAO,IAAIlD,IAAI,CAACjS,IAC1B,MAAMoe,EAAW,IAAInM,IAAIkD,GAEzB,OADAG,EAAW8I,EAASpiB,IAAIgE,GAAOoe,EAAS3R,OAAOzM,GACxCoe,CAAP,GAJF,GAMC,CAAC2+C,IAEE5X,EAAavwC,uBAAY,KAC7B0+H,GAAUn+H,IAAgB,IAAIA,EAAKknC,SAAS,KAA5C,GACC,CAACi3F,IAEEK,EAAoB/+H,uBAAaxjB,IACrCkiJ,GAAUn+H,IAAgB,IAAIA,EAAKsJ,MAAOrtB,KAA1C,GACC,CAACkiJ,KAEGnK,EAASie,GAAU/4I,mBAAQ,KAChC,IAAI86H,EACAie,EAAS,EACb,GAAK9zG,EAQH,GAAO,OAAHA,QAAG,IAAHA,KAAK3pC,MAAQ2pC,EAAI3pC,KAAK5T,OAAS,EAAG,CACpCozI,EAAU,GACV,MAAM11B,EAAU5/G,KAAK+J,IAAI40D,EAAUzqD,KAAMurC,EAAI3pC,KAAK5T,QAClD,IAAK,IAAI9B,EAAI,EAAGA,EAAIw/G,IAAWx/G,EAAG,CAChC,MAAMyM,EAAS4yC,EAAI3pC,KAAK1V,GACpByM,EAAOwjB,MAAQ,GAAKkjI,EAAS3zC,IAC/B01B,EAAQ9zI,KAAK,eAAC,GAAD,CAEXjE,MAAOsP,EAAOtP,MACdkkB,WAAU/U,GAASA,EAAO2R,IAAIxR,EAAOtP,OACrCm6C,IAAKA,EACL/C,SAAUw0B,EACVrsD,QAAQ,WACRuT,MAAOxjB,EAAOwjB,MACdzF,MAAOA,GAPF/d,EAAOtP,UASZg2J,EAEL,CACF,MACCje,EAAU,eAAClC,GAAD,IACVmgB,EAAS,OA5BXje,EAAU,eAAC,GAAD,CACRx4H,QAAQ,OACR,wBAAgBkqC,EAAhB,gBACA7rC,OAAQ,IAEVo4I,EAAS,EA0BX,MAAO,CAACje,EAASie,EAAjB,GACC,CAAC9zG,EAAKkf,EAAWjyD,EAAQy8D,EAAczxB,EAAK9sB,EAAOo8B,IAEhD32B,EAAQF,GAAU,OAAQojI,GAAQ,GAExC,OAAO,eAACniG,GAAD,CACLpiD,GAAIA,EACJ2K,SAAUA,EACVk3B,MAAOA,EACPh7B,YAAaA,EACbw7C,OAAQC,EACR19C,UAAW+iC,mBAAK/iC,GAChB+/B,QACE,eAACsT,GAAD,CACE1pD,MAAOqtB,EACPre,QAASm8C,GACT/3C,QAAQ,qBACRgkC,SAAUmrG,IAZT,SAgBL,eAAC,GAAD,UACE,sBAAKlsI,UAAW+iC,mBAAKtiC,EAAO6+I,gBAA5B,SACE,uBAAKt/I,UAAW+iC,mBAAKtiC,EAAO8+I,gBAA5B,UACGn2G,EACG,eAACqrB,GAAD,CACEz0D,UAAWS,EAAOi/H,UAClB35H,SAAUA,EACV+sC,UAAU,EACV4hB,oBAAoB,EACpBb,WAAS,IAEX,KAEJ,sBAAK3yC,IAAKA,EAAKlhB,UAAWS,EAAOgyC,OAAjC,SACGivF,IAES,IAAXie,GAAgB,sBAAK3/I,UAAWS,EAAOgc,MAAvB,SACf,eAACjV,GAAA,EAAD,CAAY0B,QAAQ,WAApB,SACGy2I,EAAS50F,EAAUzqD,KACL,IAAXq/I,EACE,wBADF,sBAEiBljI,GAHpB,sBAIkBA,eAtC/B,IA6DFgjI,GAAY74G,aAAe,CACzB,cAAe,eAMV,MAAMg5G,GAAkB5hJ,IAAMoI,MAAM7G,IACvC,MAAM,GAACnE,EAAD,QAAKw5C,EAAL,QAAcC,GAAWt1C,GACzB,aAAEmkD,GAAiBnP,MAClBwqG,EAAUC,GAAex4I,mBAASjH,IAClCrB,EAAQ+gJ,GAAaz4I,mBAAS,CAAC,GAChCqlI,EAAYnoF,EAAatoD,GACzB0F,EAAW8F,mBAAQ,IAChBpO,OAAOsB,OAAOoE,GAAQhN,MAAM4iB,KAAQA,MAAO+rI,GAAkBV,YAAYJ,IAC/E,CAAC7gJ,EAAQ6gJ,IAENvpF,EAAeroD,uBAAa4xI,IAChClT,GAAUn+H,IAAG,IAASA,KAAQqxI,KAA9B,GACC,CAAClT,IAEEt2E,EAAepoD,uBAAY,CAAC5U,EAAK5O,KACrCq1J,GAAYtxI,IAAG,IAASA,EAAK,CAACnV,GAAM5O,KAApC,GACC,CAACq1J,IAEEtiF,EAAcvvD,uBAAY,CAAC5U,EAAK5O,KACpCs1J,GAAUvxI,IAAG,IAASA,EAAK,CAACnV,GAAM5O,KAAlC,GACC,CAACs1J,IAEEn/I,EAAcqN,uBAAY,KAC9B0+H,GAAUn+H,IAAG,IAASA,EAAKknC,SAAS,KAApC,GACC,CAACi3F,IAEE54E,EAAe9lD,uBAAY,CAAC5U,EAAK5O,KACrC,IACEk2J,GAAkBT,eAAe7mJ,EAAK,CAAC,CAACA,GAAM5O,GAI/C,CAHC,MAAOmY,GAEP,YADA46D,EAAYnkE,EAAKuJ,EAAEpD,QAEpB,CACDugJ,GAAUvxI,IAAG,IAASA,EAAK,CAACnV,QAAM1I,MAClCmvJ,GAAYtxI,IAAG,IAASA,EAAK,CAACnV,GAAM5O,KAApC,GACC,CAAC+yE,EAAasiF,IAEXK,EAAmBlyI,uBAAY,KACnCqoD,EAAa,IAAIupF,EAAUnqG,SAAS,EAAOC,SAAS,GAApD,GACC,CAAC2gB,EAAcupF,IAElB,OAAO,gBAACR,GAAD,CACHnjJ,GAAIA,EACJyE,KAAM+0C,EACNC,QAASA,EACT5X,MAAM,oBACN99B,QAASW,EACT0xD,SAAU6tF,EACV9gJ,MAAOuC,EAPJ,UASL,gBAAC49I,GAAD,CAAiBzhH,MAAM,SAAvB,UACE,eAAC0hH,GAAD,UACE,eAACt6B,GAAD,CACE7wH,MAAM,WACN7J,MAAOo1J,EAASh5I,SAChBxH,MAAOL,EAAO6H,SACdg7B,SAAWp3C,GAAU4rE,EAAa,WAAY5rE,GAC9C8nE,SAAW9nE,GAAUspE,EAAa,WAAYtpE,GAC9C6U,QAAU7U,GAAU+yE,EAAY,WAAY/yE,GAC5C26H,OAAQA,GACRC,iBAAkBD,GAClBE,wBAAsB,MAG1B,eAACm6B,GAAD,UACE,eAAC5tF,GAAA,EAAD,CACEklC,QAAM,EACNpiC,WAAS,EACTrgE,MAAM,qBACN0V,QAAQ,SACRvf,MAAOo1J,EAAS/nI,MAChB+pB,SAAWpC,IAAY42B,EAAa,QAAS52B,EAAMlnB,OAAO9tB,MAAnC,EANzB,SAQG6O,OAAOK,KAAKi8C,IAAQ7oD,KAAKsM,GACxB,eAACw7C,GAAA,EAAD,CAAUpqD,MAAO4O,EAAjB,SAAiCA,GAANA,YAKnC,gBAACmmJ,GAAD,CAAiBzhH,MAAM,UAAvB,UACE,eAAC0hH,GAAD,UACE,eAAC9tF,GAAD,CACEr9D,MAAM,QACNqgE,WAAS,EACTlqE,MAAK,OAAEo1J,QAAF,IAAEA,OAAF,EAAEA,EAAU9hH,MACjB8D,SAAWpC,GAAU42B,EAAa,QAAS52B,EAAMlnB,OAAO9tB,WAG5D,eAACg1J,GAAD,UACE,eAAC1qG,GAAA,EAAD,CACEC,QAAS,eAACtT,GAAA,EAAD,CAAUE,QAASi+G,EAAS31G,UAAWrI,SAAU,CAACpC,EAAOh1C,IAAU4rE,EAAa,YAAa5rE,KACtG6J,MAAM,4BAlDd,IAqESqsJ,GAAoBzhG,GAAa5mB,MAAM,CAClDzxB,SAAUs4C,eAASvyB,SAAS,yBAC5B9U,MAAOqnC,eAASvyB,SAAS,sBACzBsd,UAAW0rF,iBC9UPgrB,GAAO,CAACh2G,IAAK,GAAID,GAAI,GAAID,GAAI,GAAIzN,GAAI,GAAIqN,GAAI,IAC7Cu2G,GAAcvnJ,OAAOQ,YAAYR,OAAOC,QAAQqnJ,IAAM7zJ,KAAI,IAAoB,IAAlBqU,EAAM0/I,GAAW,EACjF,MAAO,CAAC1/I,EAJoB,IACJ,GAGkC0/I,EAA1D,KAEIC,GAAQznJ,OAAOC,QAAQsnJ,IACvBx4I,GAAS,CAAC,EAAG,GAqBnB,MAAM24I,GACJtiJ,YAAY61C,EAAOusG,GACjBlxJ,KAAK2kD,MAAQ,GACb3kD,KAAKkxJ,MAAQA,EACb,IAAK,MAAMn+H,KAAQ4xB,EACjB3kD,KAAKyF,IAAIstB,EAEZ,CAODttB,IAAIstB,GAEF,GAAKxpB,gBAAMwpB,EAAKr0B,IAAO6K,gBAAMwpB,EAAKs8B,GAG3B,CAGL,MACMgiG,EADYrxJ,KAAKsxJ,wBAEpBtnJ,QAAQ45I,GAAQ7wH,EAAKvI,GAAKo5H,EAAIp5H,GAAKuI,EAAK4nB,GAAKipG,EAAIjpG,IAGpD02G,EAAan+H,MAAK,CAACvzB,EAAG2oB,IAAM3oB,EAAE0vD,EAAI/mC,EAAE+mC,IACpC,MAAMkiG,EAAeF,EAAa,GAGlCrxJ,KAAK2kD,MAAM7lD,KAAK,IAAIi0B,EAAMr0B,EAAG6yJ,EAAa7yJ,EAAG2wD,EAAGkiG,EAAaliG,GAC9D,MAfCrvD,KAAK2kD,MAAM7lD,KAAKi0B,EAgBnB,CAQDu+H,wBACE,MAAME,EAAY,GAClB,GAAIxxJ,KAAK2kD,MAAMnlD,OAAS,EAAG,CACzB,MAAMwpD,EAAS1rD,KAAK03C,OAAOh1C,KAAK2kD,MAAMxnD,KAAK41B,GAASA,EAAKs8B,EAAIt8B,EAAK4nB,KAC5D82G,EAAU,KAChB,IAAK,MAAM/zJ,KAAK2oD,gBAAMrmD,KAAKkxJ,MAAQ,GACjC,IAAK,MAAM3yJ,KAAK8nD,gBAAM2C,EAAS,GAAI,CACjC,MAAMizC,EAAQ,CAACv9F,EAAGhB,EAAG2xD,EAAG9wD,GAExB,IAAI0gH,EAAOhjB,EAAMv9F,EACjB,MAAQsB,KAAK0xJ,WAAW,CAAChzJ,EAAGugH,EAAOwyC,EAASpiG,EAAG4sC,EAAM5sC,EAAIoiG,KAAaxyC,EAAOj/G,KAAKkxJ,OAChFjyC,GAAQ,EAGV,IAAI0yC,EAAO11D,EAAM5sC,EACjB,MAAQrvD,KAAK0xJ,WAAW,CAAChzJ,EAAGu9F,EAAMv9F,EAAI+yJ,EAASpiG,EAAGsiG,EAAOF,KAAaE,EAAO3oG,GAC3E2oG,GAAQ,EAENA,IAAS3oG,IAAQ2oG,EAAOviG,KAC5B,MAAMvjB,EAAQozE,EAAOhjB,EAAMv9F,EACrBotC,EAAS6lH,EAAO11D,EAAM5sC,EACxBxjB,GAASC,GACX0lH,EAAU1yJ,KAAK,IAAIm9F,EAAOzxE,EAAGqhB,EAAO8O,EAAG7O,GAE1C,CAIH0lH,EAAU1yJ,KAAK,CAACJ,EAAG,EAAG2wD,EAAGrG,EAAQx+B,EAAGxqB,KAAKkxJ,MAAOv2G,EAAGyU,KACpD,MACCoiG,EAAU1yJ,KAAK,CAACJ,EAAG,EAAG2wD,EAAG,EAAG7kC,EAAGxqB,KAAKkxJ,MAAOv2G,EAAGyU,MAEhD,OAAOoiG,CACR,CASDE,WAAWz1D,GACT,SAASl/F,EAAI4C,EAAG2oB,GACd,OAAO3oB,EAAEjB,EAAI4pB,EAAE5pB,EAAIiB,EAAE0vD,EAAI/mC,EAAE+mC,CAC5B,CACD,IAAK,MAAMt8B,KAAQ/yB,KAAK2kD,MAAO,CAC7B,MAAMitG,EAAK,CAAClzJ,EAAGq0B,EAAKvI,EAAG6kC,EAAG,GACpBwiG,EAAK,CAACnzJ,EAAGu9F,EAAMv9F,EAAIq0B,EAAKr0B,EAAG2wD,EAAG4sC,EAAM5sC,EAAIt8B,EAAKs8B,GAC7CyiG,EAAK,CAACpzJ,EAAG,EAAG2wD,EAAGt8B,EAAK4nB,GACpBo3G,EAAK,CAACrzJ,EAAGu9F,EAAMv9F,GAAKq0B,EAAKr0B,EAAIq0B,EAAKvI,GAAI6kC,EAAG4sC,EAAM5sC,EAAIt8B,EAAKs8B,GACxD2iG,EAAOj1J,EAAI60J,EAAIA,GACfK,EAAOl1J,EAAI60J,EAAIC,GACfK,EAAOn1J,EAAI+0J,EAAIA,GACfK,EAAOp1J,EAAI+0J,EAAIC,GAErB,GADgBC,GAAQC,GAAUA,GAAQ,GAAOC,GAAQC,GAAUA,GAAQ,EAC/D,OAAO,CACpB,CACD,OAAO,CACR,CAMDzzC,YACE,OAAO1+G,KAAK2kD,KACb,EAOH,MAAM7qC,GAAYC,cAAWnI,IACpB,CACLvD,KAAM,CACJw8B,SAAU,WACVtwB,WAAY3I,EAAMkH,SAAS,KAC3BE,YAAapH,EAAMkH,SAAS,MAE9BmZ,UAAW,CACT4Y,SAAU,WACViG,IAAKl/B,EAAMkH,QAAQ,IACnBkwC,OAAQp3C,EAAMkH,QAAQ,MACtB8oD,KAAMhwD,EAAMkH,QAAQ,KACpBs6B,MAAOxhC,EAAMkH,QAAQ,KACrBgzB,OAAQ,QACRD,MAAO,SAETu9F,eAAgB,CACdv+F,SAAU,YAEZw+F,eAAgB,CACdx+F,SAAU,WACViG,IAAKl/B,EAAMkH,QAAQ,KACnBkwC,OAAQp3C,EAAMkH,QAAQ,KACtB8oD,KAAMhwD,EAAMkH,QAAQ,KACpBs6B,MAAOxhC,EAAMkH,QAAQ,KACrBgzB,OAAQ,QACRD,MAAO,aAuKEumH,OAnKIljJ,IAAMoI,MAAK,IAGvB,IAHwB,UAC7BpG,EAD6B,QAE7BV,GACI,EACJ,MAAMmB,EAASmI,GAAUtJ,IACnB,gBAAEukD,GAAoBtP,MACtB,IAAErzB,EAAF,MAAOyZ,GAAU+gB,gBAChBoD,EAASqiG,GAAct9F,KACvBu9F,EAAYC,GAAiB76I,qBAC9Bw5I,EAxKR,SAAkBrlH,GAChB,IAAI2mH,EACJ,IAAK,MAAO/oJ,EAAK+H,KAAS2/I,GAExB,GADAqB,EAAa/oJ,EACToiC,GAASr6B,EAAM,MAErB,OAAOw/I,GAAKwB,EACb,CAiKeC,CAASH,GACjBI,EAAcl7H,kBAAO,GAGrBijB,EAAS3iC,mBAAQ,KACrB,IAAKo5I,EAAO,MAAO,CAAC,EAKpB,MAAMyB,EAAe,CAAC,EACtB,IAAK,MAAOrmJ,EAAI4tC,KAAWxwC,OAAOC,QAAQqmD,GAAU,CAClD,IAAK9V,EAAO6L,QAAS,SACrB,IAAK7L,EAAOO,OAAQ,CAClBk4G,EAAarmJ,GAAM4tC,EACnB,QACD,CACD,MAAM04G,EAAar1I,oBAAU28B,GACvB24G,EAAkBnpJ,OAAOK,KAAKknJ,IACpC,IAAK,MAAMvzJ,KAAK2oD,gBAAM,EAAGwsG,EAAgBrzJ,QAAS,CAChD,MAAMgzJ,EAAaK,EAAgBn1J,GACnC,IAAKk1J,EAAWn4G,OAAO+3G,GACrB,IAAK,MAAMj0J,KAAK8nD,gBAAM,EAAGwsG,EAAgBrzJ,OAAS,GAAI,CACpD,MAAMszJ,EAAoBF,EAAWn4G,OAAOo4G,EAAgBn1J,EAAIa,IAC1Dw0J,EAAmBH,EAAWn4G,OAAOo4G,EAAgBn1J,EAAIa,IAC/D,GAAIu0J,EAAmB,CACrBF,EAAWn4G,OAAO+3G,GAAcM,EAChC,KACD,CAAM,GAAIC,EAAkB,CAC3BH,EAAWn4G,OAAO+3G,GAAcO,EAChC,KACD,CACF,CAEJ,CACDJ,EAAarmJ,GAAMsmJ,CACpB,CAED,MAAMI,EAAU,CAAC,EACjB,IAAK,MAAMR,KAAc9oJ,OAAOK,KAAKknJ,IAAc,CAIjD,IAAIvzJ,EAAI,EACJ+8C,EAAS/wC,OAAOC,QAAQgpJ,GACzBx1J,KAAI,IAAkB,IAAD,MAAfmP,EAAIzR,GAAW,EACpB,MAAM4/C,EAAM,UAAG5/C,EAAM4/C,cAAT,aAAG,EAAe+3G,GACxBlpJ,EAAS,CACb5L,EAAG4O,EACH5N,EAAG6K,gBAAK,OAACkxC,QAAD,IAACA,OAAD,EAACA,EAAQ/7C,GAAK0wD,IAAnB,OAA8B3U,QAA9B,IAA8BA,OAA9B,EAA8BA,EAAQ/7C,EACzC2wD,EAAG9lD,gBAAK,OAACkxC,QAAD,IAACA,OAAD,EAACA,EAAQ4U,GAAK,EAAnB,OAAuB5U,QAAvB,IAAuBA,OAAvB,EAAuBA,EAAQ4U,EAClC7kC,EAAGjhB,gBAAK,OAACkxC,QAAD,IAACA,OAAD,EAACA,EAAQjwB,GAAK,EAAnB,OAAuBiwB,QAAvB,IAAuBA,OAAvB,EAAuBA,EAAQjwB,EAClCmwB,EAAGpxC,gBAAK,OAACkxC,QAAD,IAACA,OAAD,EAACA,EAAQE,GAAK,EAAnB,OAAuBF,QAAvB,IAAuBA,OAAvB,EAAuBA,EAAQE,EAClCC,KAAMrxC,gBAAK,OAACkxC,QAAD,IAACA,OAAD,EAACA,EAAQG,MAAQ,EAAtB,OAA0BH,QAA1B,IAA0BA,OAA1B,EAA0BA,EAAQG,KACxCC,KAAMtxC,gBAAK,OAACkxC,QAAD,IAACA,OAAD,EAACA,EAAQI,MAAQ,EAAtB,OAA0BJ,QAA1B,IAA0BA,OAA1B,EAA0BA,EAAQI,KACxCl7B,MAAOjiB,GAGT,QADEA,EACK4L,CAAP,IAMAopJ,EAAYhrI,UACd+yB,EAAS,IAAI22G,GAAO32G,EAAOvnB,MAAK,CAACvzB,EAAG2oB,IAAM3oB,EAAEggB,MAAQ2I,EAAE3I,QAAQuxI,GAAOxyC,YACrEg0C,EAAYhrI,SAAU,GAExBsrI,EAAQR,GAAc/3G,CACvB,CACD,OAAOu4G,CAAP,GACC,CAAChjG,EAASkhG,IAIP3gJ,EAAWuH,mBAAQ,IAChBpO,OAAOC,QAAQqmD,GACjBhmD,QAAO,QAAEsC,EAAIzR,GAAN,gBAAiBA,QAAjB,IAAiBA,OAAjB,EAAiBA,EAAOkrD,OAAxB,IACP7yB,MAAK,CAACvzB,EAAG2oB,IAAMA,EAAE,GAAG3I,MAAQhgB,EAAE,GAAGggB,QACjCxiB,KAAI,IAAkB,IAAhBmP,EAAIzR,GAAW,EACpB,MAAMqtJ,EAAO,CACX+K,YAAa9G,GACb+G,cAAenD,GACftX,UAAWqE,GACXhgG,MAAO6zG,IACP91J,EAAMoG,MACR,OAAO,sBAAciQ,UAAWS,EAAOy3H,eAAhC,SACL,eAACjhC,GAAA,EAAD,CAAOj3F,UAAWS,EAAO03H,eAAzB,SACE,eAAC6e,EAAD,CACE57I,GAAIA,KACAzR,EACJqW,UAAWS,EAAOsgB,eALP3lB,EAAjB,KAUL,CAAC0jD,EAASr+C,IAMbuhE,2BAAgB,KACVrnC,GACF0mH,EAAc1mH,EACf,GACA,CAACA,IAMJ,MAAMsnH,EAAqB90I,uBAAY,CAACo8B,EAAQ24G,KAC9Cf,GAAWzzI,IACT,MAAMggG,EAAYrhG,oBAAUqB,GAC5B,IAAK,MAAO4zI,EAAY33J,KAAU6O,OAAOC,QAAQypJ,GAC/C,IAAK,MAAM34G,KAAU5/C,EACnB+jH,EAAUnkE,EAAO/8C,GAAG+8C,OAAO+3G,GAAcj1I,oBAAUk9B,GAGvD,OAAOmkE,CAAP,GAPF,GASC,CAACyzC,IAEJ,OAAO,sBAAKjgI,IAAKA,EAAKlhB,UAAW+iC,mBAAK/iC,EAAWS,EAAOtD,MAAjD,SACHikJ,EACE,eAAC,cAAD,CACAphJ,UAAU,SACV8hJ,QAASv4G,EACT44G,YAAY,aACZC,gBAAgB,cAChBC,UAAU,EACVC,eAAgBL,EAChBM,aAAa,EACbC,aAAa,EACbC,WAAW,EACXl5C,UAAW63C,EAAapB,EACxBz4I,OAAQA,GACRw4I,YAAaA,GACbD,KAAMA,GACN4C,aAAc,eAACC,GAAD,IACdhoH,MAAOymH,EAfP,SAiBC/hJ,IAEH,MArBJ,IAmCF,MAAMujJ,GAAkB/5I,cAAWnI,IAC1B,CACLvD,KAAM,CACJoK,OAAQ7G,EAAMkH,QAAQ,GACtB+yB,MAAO,OACPC,OAAQ,YAIR+nH,GAAe3kJ,IAAMq+B,YAAW,CAAC98B,EAAO2hB,KAC5C,MAAM,WAAC2hI,KAAeC,GAAavjJ,EAC7BkB,EAASmiJ,KACf,OAAO,sBACL1hI,IAAKA,EACLlhB,UAAW+iC,mBACT,yBADa,iCAEa8/G,GAC1BpiJ,EAAOtD,SAEL2lJ,GAPN,IC5VIC,GAAgB,IAAIv4I,IAAI,CAACoP,GAAMY,IAAKZ,GAAMC,MAAOD,GAAMiB,YACvDmoI,GAAc,IAAIx4I,IAAI,CAACoP,GAAM5a,OAAQ4a,GAAMkB,KAAMlB,GAAMC,MAAOD,GAAMY,MACpEyoI,GAAiB,CACrB,IAAK,IACL,IAAM,IACN,IAAO,KAKIC,GAAwBllJ,IAAMoI,MAAK,IAAe,IAAD,gCAAb,OAAC4iC,GAAY,EAC1D,MAAM,WAAEpL,EAAF,aAAc8lB,GAAiBnP,MAC9BwqG,EAAUC,GAAex4I,mBAAS6F,oBAAU28B,KAC5C9qC,EAAQ+gJ,GAAaz4I,mBAAS,CAAC,IAC/B4J,EAAY+yI,GAAiB38I,mBAAS,CAAC,GACxCqlI,EAAYnoF,EAAa1a,EAAO5tC,IAEhCshE,EAAcvvD,uBAAY,CAAC5U,EAAK5O,KACpCs1J,GAAUvxI,IAAG,IAASA,EAAK,CAACnV,GAAM5O,KAAlC,GACC,CAACs1J,IAEEmE,EAAsBj2I,uBAAY,CAAC5U,EAAK5O,KAC5C+yE,EAAYnkE,EAAK5O,GACjBw5J,GAAez1I,IAAD,IAAcA,EAAK,CAACnV,GAAM,QAAxC,GACC,CAACmkE,IAEEnH,EAAepoD,uBAAY,CAAC5U,EAAK5O,KACrCq1J,GAAYtxI,IACV,MAAMiJ,EAAW,IAAIjJ,GAErB,OADA2I,GAAQM,EAAUpe,EAAK5O,GAChBgtB,CAAP,GAHF,GAKC,CAACqoI,IAEEl/I,EAAcqN,uBAAY,KAC9B0+H,GAAUn+H,IAAG,IAASA,EAAKknC,SAAS,KAApC,GACC,CAACi3F,IAEE54E,EAAe9lD,uBAAY,CAAC5U,EAAK5O,KACrC,IACE05J,aAAMC,GAAyB/qJ,GAAKgrJ,aAAa55J,EAIlD,CAHC,MAAOmY,GAEP,YADA46D,EAAYnkE,EAAKuJ,EAAEpD,QAEpB,CACDugJ,GAAUvxI,IAAG,IAASA,EAAK,CAACnV,QAAM1I,MAClC0lE,EAAah9D,EAAK5O,EAAlB,GACC,CAAC+yE,EAAanH,IAEXiuF,EAAuBr2I,uBAAY,CAAC5U,EAAK5O,KAAW,IAAD,EACvDspE,EAAa16D,EAAK5O,GAClB,MAAM,SAAEoc,GAAa6d,GAAcj6B,GAC7BuhB,EAAS,UAAG0yB,EAAW73B,UAAd,aAAG,EAAsBmF,UACxCi4I,GAAez1I,IAAD,IAAcA,EAAK,CAACnV,GAAM2S,KAAxC,GACC,CAAC+nD,EAAcr1B,IAIZyhH,EAAmBlyI,uBAAY,KAAO,IAAD,IAEzC,MAAMs2I,EAAoBjrJ,OAAOsB,OAAOoE,GAAQhN,MAAK1D,KAAOA,IAC5D,GAAIi2J,EAAmB,OAKvB,MAAMC,EAASr+H,GAAa,OAAC05H,QAAD,IAACA,GAAD,UAACA,EAAUvxJ,SAAX,aAAC,EAAauY,UACtC29I,GACFN,EAAoB,aAAc,2BAEpC,MAAMO,EAASt+H,GAAa,OAAC05H,QAAD,IAACA,GAAD,UAACA,EAAU5gG,SAAX,aAAC,EAAap4C,UACtC49I,GACFP,EAAoB,aAAc,2BAG/BK,GAAsBC,GAAWC,GACpC9X,GAAUn+H,IAAG,IAASA,KAAQ,IAAIqxI,EAAUnqG,SAAS,EAAOC,SAAS,MACtE,GACA,CAACkqG,EAAUlT,EAAW3tI,EAAQklJ,IAEjC,OAAO,gBAAC7E,GAAD,CACHnjJ,GAAI4tC,EAAO5tC,GACXyE,KAAMmpC,EAAO4L,QACbC,QAAS7L,EAAO6L,QAChB5X,MAAM,2BACN99B,QAASW,EACT0xD,SAAU6tF,EANP,UAQL,gBAACX,GAAD,CAAiBzhH,MAAM,SAAvB,UACE,eAAC0hH,GAAD,UACE,eAACj6B,GAAD,CACElxH,MAAM,WACN7J,MAAK,UAAEo1J,EAASvxJ,SAAX,aAAE,EAAYuY,SACnBg7B,SAAWp3C,GAAU4rE,EAAa,aAAc5rE,GAChD8nE,SAAW9nE,GAAU65J,EAAqB,aAAc75J,GACxD6nE,SAAW7nE,GAAU65J,EAAqB,aAAc75J,GACxD4U,MAAOL,EAAO,cACdM,QAAU7U,GAAUy5J,EAAoB,aAAcz5J,GACtD26H,OAAQy+B,GACRx+B,iBAAkBw+B,OAGtB,eAACpE,GAAD,UACE,eAAC9tF,GAAD,CACEr9D,MAAM,QACNqgE,WAAS,EACTlqE,MAAK,UAAEo1J,EAASvxJ,SAAX,aAAE,EAAYyvC,MACnB8D,SAAWpC,GAAU42B,EAAa,UAAW52B,EAAMlnB,OAAO9tB,WAG9D,eAACg1J,GAAD,UACE,eAAC,GAAD,CACEnrJ,MAAM,OACN7J,MAAK,UAAEo1J,EAASvxJ,SAAX,aAAE,EAAYhC,KACnBu1C,SAAWp3C,GAAU4rE,EAAa,SAAU5rE,GAC5C8nE,SAAW9nE,GAAUspE,EAAa,SAAUtpE,GAC5C6nE,SAAW7nE,GAAUspE,EAAa,SAAUtpE,GAC5C4U,MAAOL,EAAO,UACdM,QAAU7U,GAAU+yE,EAAY,SAAU/yE,GAC1CuhB,UAAWkF,EAAW,eAAiB,KACvC0lD,UAAQ,EACRD,cAAY,MAGhB,eAAC8oF,GAAD,UACE,eAAC5tF,GAAA,EAAD,CACEklC,QAAM,EACNpiC,WAAS,EACTrgE,MAAM,QACN0V,QAAQ,SACRvf,MAAK,UAAEo1J,EAASvxJ,SAAX,aAAE,EAAYwpB,MACnB+pB,SAAWpC,IAAY42B,EAAa,UAAW52B,EAAMlnB,OAAO9tB,MAArC,EANzB,SAQG6O,OAAOK,KAAKk8C,IAAe9oD,KAAKsM,GAC/B,eAACw7C,GAAA,EAAD,CAAUpqD,MAAO4O,EAAjB,SAAiCA,GAANA,YAKnC,gBAACmmJ,GAAD,CAAiBzhH,MAAM,SAAvB,UACE,eAAC0hH,GAAD,UACE,eAACj6B,GAAD,CACElxH,MAAM,WACN7J,MAAK,UAAEo1J,EAAS5gG,SAAX,aAAE,EAAYp4C,SACnBg7B,SAAWp3C,GAAU4rE,EAAa,aAAc5rE,GAChD8nE,SAAW9nE,GAAU65J,EAAqB,aAAc75J,GACxD6nE,SAAW7nE,GAAU65J,EAAqB,aAAc75J,GACxD4U,MAAOL,EAAO,cACdM,QAAU7U,GAAUy5J,EAAoB,aAAcz5J,GACtD26H,OAAQy+B,GACRx+B,iBAAkBw+B,OAGtB,eAACpE,GAAD,UACE,eAAC9tF,GAAD,CACEr9D,MAAM,QACNqgE,WAAS,EACTlqE,MAAK,UAAEo1J,EAAS5gG,SAAX,aAAE,EAAYlhB,MACnB8D,SAAWpC,GAAU42B,EAAa,UAAW52B,EAAMlnB,OAAO9tB,WAG9D,eAACg1J,GAAD,UACE,eAAC,GAAD,CACEnrJ,MAAM,OACN7J,MAAK,UAAEo1J,EAAS5gG,SAAX,aAAE,EAAY3yD,KACnBu1C,SAAWp3C,GAAU4rE,EAAa,SAAU5rE,GAC5C8nE,SAAW9nE,GAAUspE,EAAa,SAAUtpE,GAC5C6nE,SAAW7nE,GAAUspE,EAAa,SAAUtpE,GAC5C4U,MAAOL,EAAO,UACdM,QAAU7U,GAAU+yE,EAAY,SAAU/yE,GAC1CuhB,UAAWkF,EAAW,eAAiB,KACvC0lD,UAAQ,EACRD,cAAY,MAGhB,eAAC8oF,GAAD,UACE,eAAC5tF,GAAA,EAAD,CACEklC,QAAM,EACNpiC,WAAS,EACTrgE,MAAM,QACN0V,QAAQ,SACRvf,MAAK,UAAEo1J,EAAS5gG,SAAX,aAAE,EAAYnnC,MACnB+pB,SAAWpC,IAAY42B,EAAa,UAAW52B,EAAMlnB,OAAO9tB,MAArC,EANzB,SAQG6O,OAAOK,KAAKk8C,IAAe9oD,KAAKsM,GAC/B,eAACw7C,GAAA,EAAD,CAAUpqD,MAAO4O,EAAjB,SAAiCA,GAANA,YAKnC,gBAACmmJ,GAAD,CAAiBzhH,MAAM,eAAvB,UACE,eAAC0hH,GAAD,UACE,eAACj6B,GAAD,CACElxH,MAAM,WACN7J,MAAK,OAAEo1J,QAAF,IAAEA,GAAF,UAAEA,EAAU7D,eAAZ,iBAAE,EAAmB/6I,aAArB,aAAE,EAA0B4F,SACjCg7B,SAAWp3C,GAAU4rE,EAAa,yBAA0B5rE,GAC5D8nE,SAAW9nE,GAAU65J,EAAqB,yBAA0B75J,GACpE6nE,SAAW7nE,GAAU65J,EAAqB,yBAA0B75J,GACpE4U,MAAOL,EAAO,0BACdM,QAAU7U,GAAUy5J,EAAoB,yBAA0Bz5J,GAClE26H,OAAQ0+B,GACRz+B,iBAAkBy+B,GAClBltF,UAAQ,MAGZ,eAAC6oF,GAAD,UACE,eAAC9tF,GAAD,CACEr9D,MAAM,QACNqgE,WAAS,EACTlqE,MAAK,UAAEo1J,EAAS7D,eAAX,iBAAE,EAAkB/6I,aAApB,aAAE,EAAyB88B,MAChC8D,SAAWpC,GAAU42B,EAAa,sBAAuB52B,EAAMlnB,OAAO9tB,WAG1E,eAACg1J,GAAD,UACE,eAAC,GAAD,CACEnrJ,MAAM,OACN7J,MAAK,UAAEo1J,EAAS7D,eAAX,iBAAE,EAAkB/6I,aAApB,aAAE,EAAyB3U,KAChCu1C,SAAWp3C,GAAU4rE,EAAa,qBAAsB5rE,GACxD8nE,SAAW9nE,GAAUspE,EAAa,qBAAsBtpE,GACxD6nE,SAAW7nE,GAAUspE,EAAa,qBAAsBtpE,GACxD4U,MAAOL,EAAO,sBACdM,QAAU7U,GAAU+yE,EAAY,qBAAsB/yE,GACtDuhB,UAAWkF,EAAW,2BAA6B,KACnD0lD,UAAQ,EACRD,cAAY,SAIlB,gBAAC6oF,GAAD,CAAiBzhH,MAAM,UAAvB,UACE,eAAC0hH,GAAD,UACE,eAAC9tF,GAAD,CACEr9D,MAAM,QACNqgE,WAAS,EACTlqE,MAAK,OAAEo1J,QAAF,IAAEA,OAAF,EAAEA,EAAU9hH,MACjB8D,SAAWpC,GAAU42B,EAAa,QAAS52B,EAAMlnB,OAAO9tB,WAG5D,eAACg1J,GAAD,UACE,eAACC,GAAD,CACEprJ,MAAM,oCACNmF,QAASsqJ,GACTt5J,MAAOo1J,EAASz+I,KAChBygC,SAAWpC,IAAY42B,EAAa,OAAQ52B,EAAMlnB,OAAO9tB,MAAlC,MAG3B,eAACg1J,GAAD,UACE,eAAC1qG,GAAA,EAAD,CACEC,QAAS,eAACtT,GAAA,EAAD,CAAUE,QAASi+G,EAAS11G,UAAWtI,SAAU,CAACpC,EAAOh1C,IAAU4rE,EAAa,YAAa5rE,KACtG6J,MAAOm4I,YAxKf,IAmLS2X,GAA0BllG,GAAa5mB,MAAM,CACxDhqC,EAAGixD,GAAW3yB,SAAS,wCACvBqyB,EAAGM,GAAW3yB,SAAS,wCACvBovH,QAASv8F,GACTr+C,KAAM9W,eAASH,UAAUyiC,SAAS,qBAClCud,UAAWyrF,iBCxQPxQ,GAAS,IAAI95G,IAAI,CAACoP,GAAMC,MAAOD,GAAMY,IAAKZ,GAAMiB,YAKzC+oI,GAAsB5lJ,IAAMoI,MAAK,IAAe,IAAD,YAAb,OAAC4iC,GAAY,EACxD,MAAM,WAAEpL,EAAF,aAAc8lB,GAAiBnP,MAC9BwqG,EAAUC,GAAex4I,mBAAS6F,oBAAU28B,KAC5C9qC,EAAQ+gJ,GAAaz4I,mBAAS,CAAC,IAC/B4J,EAAY+yI,GAAiB38I,mBAAS,CAAC,GACxCqlI,EAAYnoF,EAAa1a,EAAO5tC,IAEhCm6D,EAAepoD,uBAAY,CAAC5U,EAAK5O,KACrCq1J,GAAYtxI,IACV,MAAMiJ,EAAW,IAAIjJ,GAErB,OADA2I,GAAQM,EAAUpe,EAAK5O,GAChBgtB,CAAP,GAHF,GAKC,CAACqoI,IAEEtiF,EAAcvvD,uBAAY,CAAC5U,EAAK5O,KACpCs1J,GAAUvxI,IAAG,IAASA,EAAK,CAACnV,GAAM5O,KAAlC,GACC,CAACs1J,IAEEmE,EAAsBj2I,uBAAY,CAAC5U,EAAK5O,KAC5C+yE,EAAYnkE,EAAK5O,GACjBw5J,GAAez1I,IAAD,IAAcA,EAAK,CAACnV,GAAM,QAAxC,GACC,CAACmkE,IAEEzJ,EAAe9lD,uBAAY,CAAC5U,EAAK5O,KACrC,IACE05J,aAAMQ,GAAuBtrJ,GAAKgrJ,aAAa55J,EAIhD,CAHC,MAAOmY,GAEP,YADA46D,EAAYnkE,EAAKuJ,EAAEpD,QAEpB,CACDugJ,GAAUvxI,IAAG,IAASA,EAAK,CAACnV,QAAM1I,MAClC0lE,EAAah9D,EAAK5O,EAAlB,GACC,CAAC+yE,EAAanH,IAEXiuF,EAAuBr2I,uBAAY,CAAC5U,EAAK5O,KAAW,IAAD,EACvDspE,EAAa16D,EAAK5O,GAClB,MAAM,SAAEoc,GAAa6d,GAAcj6B,GAC7BuhB,EAAS,UAAG0yB,EAAW73B,UAAd,aAAG,EAAsBmF,UACxCi4I,GAAez1I,IAAD,IAAcA,EAAK,CAACnV,GAAM2S,KAAxC,GACC,CAAC+nD,EAAcr1B,IAEZ99B,EAAcqN,uBAAY,KAC9B0+H,GAAUn+H,IAAG,IAASA,EAAKknC,SAAS,KAApC,GACC,CAACi3F,IAGEwT,EAAmBlyI,uBAAY,KAAO,IAAD,EACzC,MAAMs2I,EAAoBjrJ,OAAOsB,OAAOoE,GAAQhN,MAAK1D,KAAOA,IAC5D,GAAIi2J,EAAmB,OAKvB,MAAMC,EAASr+H,GAAa,OAAC05H,QAAD,IAACA,GAAD,UAACA,EAAUvxJ,SAAX,aAAC,EAAauY,UACtC29I,GACFN,EAAoB,aAAc,2BAG/BK,GAAsBC,GACzB7X,GAAUn+H,IAAG,IAASA,KAAQ,IAAIqxI,EAAUnqG,SAAS,EAAOC,SAAS,MACtE,GACA,CAACkqG,EAAUlT,EAAW3tI,EAAQklJ,IAEjC,OAAO,gBAAC7E,GAAD,CACHnjJ,GAAI4tC,EAAO5tC,GACXyE,KAAMmpC,EAAO4L,QACbC,QAAS7L,EAAO6L,QAChB5X,MAAM,wBACN99B,QAASW,EACT0xD,SAAU6tF,EANP,UAQL,gBAACX,GAAD,CAAiBzhH,MAAM,SAAvB,UACE,eAAC0hH,GAAD,UACE,eAACt6B,GAAD,CACE7wH,MAAM,WACN7J,MAAK,UAAEo1J,EAASvxJ,SAAX,aAAE,EAAYuY,SACnBxH,MAAOL,EAAO,cACd6iC,SAAWp3C,GAAU4rE,EAAa,aAAc5rE,GAChD6nE,SAAW7nE,GAAU65J,EAAqB,aAAc75J,GACxD8nE,SAAW9nE,GAAU65J,EAAqB,aAAc75J,GACxD6U,QAAU7U,GAAUy5J,EAAoB,aAAcz5J,GACtD26H,OAAQA,GACRC,iBAAkBD,OAGtB,eAACq6B,GAAD,UACE,eAAC9tF,GAAD,CACEr9D,MAAM,QACNqgE,WAAS,EACTlqE,MAAK,UAAEo1J,EAASvxJ,SAAX,aAAE,EAAYyvC,MACnB8D,SAAWpC,GAAU42B,EAAa,UAAW52B,EAAMlnB,OAAO9tB,WAG9D,eAACg1J,GAAD,UACE,eAAC,GAAD,CACEnrJ,MAAM,OACN7J,MAAK,UAAEo1J,EAASvxJ,SAAX,aAAE,EAAYhC,KACnBu1C,SAAWp3C,GAAU4rE,EAAa,SAAU5rE,GAC5C8nE,SAAW9nE,GAAUspE,EAAa,SAAUtpE,GAC5C6nE,SAAW7nE,GAAUspE,EAAa,SAAUtpE,GAC5C4U,MAAOL,EAAO,UACdM,QAAU7U,GAAU+yE,EAAY,SAAU/yE,GAC1CuhB,UAAWkF,EAAW,eAAiB,KACvC0lD,UAAQ,EACRD,cAAY,SAIlB,eAAC6oF,GAAD,CAAiBzhH,MAAM,SAAvB,SACE,eAAC0hH,GAAD,UACE,eAAC5tF,GAAA,EAAD,CACEklC,QAAM,EACNpiC,WAAS,EACTrgE,MAAM,QACN0V,QAAQ,SACRvf,MAAK,UAAEo1J,EAAS5gG,SAAX,aAAE,EAAYnnC,MACnB+pB,SAAWpC,IAAY42B,EAAa,UAAW52B,EAAMlnB,OAAO9tB,MAArC,EANzB,SAQG6O,OAAOK,KAAKi8C,IAAQ7oD,KAAKsM,GACxB,eAACw7C,GAAA,EAAD,CAAUpqD,MAAO4O,EAAjB,SAAiCA,GAANA,WAKnC,gBAACmmJ,GAAD,CAAiBzhH,MAAM,UAAvB,UACE,eAAC0hH,GAAD,UACE,eAAC9tF,GAAD,CACEr9D,MAAM,QACNqgE,WAAS,EACTlqE,MAAK,OAAEo1J,QAAF,IAAEA,OAAF,EAAEA,EAAU9hH,MACjB8D,SAAWpC,GAAU42B,EAAa,QAAS52B,EAAMlnB,OAAO9tB,WAG5D,eAACg1J,GAAD,UACE,gBAAC5tF,GAAA,EAAD,CACEklC,QAAM,EACNpiC,WAAS,EACTrgE,MAAM,yBACN0V,QAAQ,SACRvf,MAAOo1J,EAASz1G,MAChBvI,SAAWpC,IAAY42B,EAAa,QAAS52B,EAAMlnB,OAAO9tB,MAAnC,EANzB,UAQE,eAACoqD,GAAA,EAAD,CAAUpqD,MAAO,GAAjB,gBACA,eAACoqD,GAAA,EAAD,CAAUpqD,MAAO,GAAjB,gBACA,eAACoqD,GAAA,EAAD,CAAUpqD,MAAO,GAAjB,gBACA,eAACoqD,GAAA,EAAD,CAAUpqD,MAAO,GAAjB,gBACA,eAACoqD,GAAA,EAAD,CAAUpqD,MAAO,GAAjB,qBAIJ,eAACg1J,GAAD,UACE,eAAC1qG,GAAA,EAAD,CACEC,QAAS,eAACtT,GAAA,EAAD,CAAUE,QAASi+G,EAAS11G,UAAWtI,SAAU,CAACpC,EAAOh1C,IAAU4rE,EAAa,YAAa5rE,KACtG6J,MAAOm4I,OAGX,eAACgT,GAAD,UACE,eAAC1qG,GAAA,EAAD,CACEC,QAAS,eAACtT,GAAA,EAAD,CAAUE,QAASi+G,EAAS31G,UAAWrI,SAAU,CAACpC,EAAOh1C,IAAU4rE,EAAa,YAAa5rE,KACtG6J,MAAM,6BAhGd,IA4GSqwJ,GAAwBzlG,GAAa5mB,MAAM,CACtDhqC,EAAGixD,GAAW3yB,SAAS,qCACvBqyB,EAAGI,GAAezyB,SAAS,qCAC3Bwd,MAAO9/C,eAASH,UAAUyiC,WAC1Bud,UAAWyrF,eACX1rF,UAAW0rF,iBC1KPgvB,GAAqBljJ,aAAW,CACpCzD,KAAM,CACJP,gBAAiB,eAEnBqb,SAAU,CAAC,GAJcrX,CAKxB0hG,MAGGyhD,GAA4BnjJ,aAAW,CAC3CzD,KAAM,CACJwK,QAAS,EACTJ,OAAQ,EACR8vF,UALqB,GAMrB,aAAc,CACZA,UAPmB,KAUvBj1E,QAAS,CACP7a,OAAQ,EACR,aAAc,CACZA,OAAQ,MAGZ0Q,SAAU,CAAC,GAfqBrX,CAgB/B2hG,MAEGyhD,GAA4BpjJ,cAAYF,IAAD,CAC3CvD,KAAM,CACJwK,QAAS,EACTtG,QAAS,YAHqBT,CAK9B6hG,MAKEwhD,GAAYjmJ,IAAMoI,MAAK,KAC3B,MAAO6R,EAAU8qF,GAAev8F,oBAAS,IACnC,gBAAEo9C,EAAF,aAAmBvP,EAAnB,gBAAiCyP,GAAoBvP,KACrD2vG,EAAepgG,IACfhF,EAAU8E,IACVpP,EAAYH,IAGZ8vG,EAAoBh3I,uBAAY,KACpC,MACM/R,EADQkN,KAAKgP,MACF/Z,WACXgsC,EAAS,CAAC/7C,EAAG0wD,IAAUC,EAAG,EAAG7kC,EAAG,EAAGmwB,EAAG,GACtC9/C,EAAQ,CACZyR,GAAIA,EACJw5C,SAAS,EACTC,SAAS,EACTtL,OAAQ,CACNC,GAAI,IAAID,GACRpN,GAAI,IAAIoN,GACRK,GAAI,IAAIL,GACRM,GAAI,IAAIN,GACRO,IAAK,IAAIP,IAIXjpC,KAAM,IACN+oC,WAAW,EACXt5C,KAAM,eAERykD,EAAUp5C,EAAIzR,EAAd,GACC,CAAC6qD,IAGE4vG,EAAsBj3I,uBAAY,KACtC,MACM/R,EADQkN,KAAKgP,MACF/Z,WACXgsC,EAAS,CAAC/7C,EAAG0wD,IAAUC,EAAG,EAAG7kC,EAAG,GAAImwB,EAAG,GACvC9/C,EAAQ,CACZyR,GAAIA,EACJw5C,SAAS,EACTC,SAAS,EACTtL,OAAQ,CACNC,GAAI,IAAID,GACRpN,GAAI,IAAIoN,GACRK,GAAI,IAAIL,GACRM,GAAI,IAAIN,GACRO,IAAK,IAAIP,IAEXvyB,MAAO,SACPjR,SAAU,4BACVhW,KAAM,iBAERykD,EAAUp5C,EAAIzR,EAAd,GACC,CAAC6qD,IAGE6vG,EAAkBl3I,uBAAY,KAClC,MACM/R,EADQkN,KAAKgP,MACF/Z,WACXgsC,EAAS,CAAC/7C,EAAG0wD,IAAUC,EAAG,EAAG7kC,EAAG,EAAGmwB,EAAG,GACtC9/C,EAAQ,CACZyR,GAAIA,EACJw5C,SAAS,EACTC,SAAS,EACTtL,OAAQ,CACNC,GAAI,IAAID,GACRpN,GAAI,IAAIoN,GACRK,GAAI,IAAIL,GACRM,GAAI,IAAIN,GACRO,IAAK,IAAIP,IAEXF,WAAW,EACXC,MAAO,GACP6U,EAAG,CAACnnC,MAAO,UACXjnB,KAAM,aAERykD,EAAUp5C,EAAIzR,EAAd,GACC,CAAC6qD,IAGE8vG,EAAcn3I,uBAAY,KAC9B,MACM/R,EADQkN,KAAKgP,MACF/Z,WACXgsC,EAAS,CAAC/7C,EAAG0wD,IAAUC,EAAG,EAAG7kC,EAAG,EAAGmwB,EAAG,GACtC9/C,EAAQ,CACZyR,GAAIA,EACJw5C,SAAS,EACTC,SAAS,EACTtL,OAAQ,CACNC,GAAI,IAAID,GACRpN,GAAI,IAAIoN,GACRK,GAAI,IAAIL,GACRM,GAAI,IAAIN,GACRO,IAAK,IAAIP,IAEXvyB,MAAO,SACPjnB,KAAM,SAERykD,EAAUp5C,EAAIzR,EAAd,GACC,CAAC6qD,IAEE+vG,EAAep3I,uBAAY,KAC/B41F,GAAYr1F,IAAQA,GAApB,GACC,IAEGyrF,EAAchsF,uBAAY,KAC9B+2I,GAAc,GACb,CAACA,IAEJ,OAAO,gBAACJ,GAAD,CAAoB7rI,SAAUA,EAAUgiD,UAAW,EAAnD,UACL,eAAC8pF,GAAD,CACE,gBAAc,kBACd3oJ,GAAG,iBAFL,SAIE,gBAACg3C,GAAD,CAASpT,eAAe,aAAxB,UACE,eAACwlH,GAAD,CACEvnH,MAAM,QACN18B,QAAS+jJ,EACTvnJ,QAAQ,wCAEV,eAACynJ,GAAD,CACEvnH,MAAM,YACN18B,QAAS8jJ,EACTtnJ,QAAQ,4CAEV,eAACynJ,GAAD,CACEvnH,MAAM,eACN18B,QAAS4jJ,EACTpnJ,QAAQ,+CAEV,eAACynJ,GAAD,CACEvnH,MAAM,iBACN18B,QAAS6jJ,EACTrnJ,QAAQ,iDAEV,eAAC81C,GAAD,CACEtyC,QAAS44F,EACTp8F,QAAQ,4CAFV,SAII,eAAC,KAAD,CAAYE,SAAS,YAEzB,eAAC41C,GAAD,CACE91C,QAAQ,GACRm2C,gBAAiBuxG,GACjBtxG,YAAa,CACXp2C,QAAS,0BACTkgC,MAAO,0BACP4/B,YAAa,CACXthC,SAAU,KACVs4B,WAAW,GAEb1gB,YAAa,CACX7yC,KAAM,UAXZ,SAcI,eAAC,KAAD,CAAUrD,SAAS,YAEvB,eAAC41C,GAAD,CACEtyC,QAASgkJ,EACTxnJ,QAASkb,EAAW,iBAAmB,iBAFzC,SAIKA,EAAW,eAAC,KAAD,CAAgBhb,SAAS,UAAY,eAAC,KAAD,CAAgBA,SAAS,iBAIlF,eAAC+mJ,GAAD,UACE,eAAC,GAAD,MAEDllG,GAAWtmD,OAAOC,QAAQqmD,GAAS7yD,KAAI,IAAkB,IAAhBmP,EAAIzR,GAAW,EACvD,IAAKA,EAAMirD,QAAS,OAAO,KAO3B,MANa,CACXmtG,YAAa,eAACmB,GAAD,CAAgCl6G,OAAQr/C,GAAZyR,GACzC4mJ,cAAe,eAAClD,GAAD,IAAsCn1J,GAARyR,GAC7CmsI,UAAW,eAACqc,GAAD,CAA8B56G,OAAQr/C,GAAZyR,GACrCwwC,MAAO,eAACg0G,GAAD,IAA8Bj2J,GAARyR,IAC7BzR,EAAMoG,OACO,IAAf,MAnEJ,IA2EImlG,GAAc,CAClBhsF,QAAS,WACTK,UAAW,eAAC,KAAD,CAAepJ,MAAM,aAE5BqkJ,GAAkBxmJ,IAAMoI,MAAK,IAAuB,IAAtB,MAAC62B,KAAU9d,GAAU,EACvD,OAAO,eAAC0zB,GAAD,IAAY1zB,EAAM+zB,gBAAiB9pC,KAAQ+pC,YAAa+hD,GAAxD,SACL,eAAC1tF,GAAA,EAAD,CAAY0B,QAAQ,UAApB,SAA+B+zB,KADjC,IASIkxF,GAAU,CACd4zB,YAAauB,GACbtB,cAAe9C,GACf3X,UAAWsc,GACXj4G,MAAOi0G,IAOI4E,GAAwBzmJ,IAAMoI,MAAK,IAAiD,IAAhD,QAACrJ,EAAD,MAAUkgC,EAAV,YAAiB4/B,EAAjB,YAA8B1pB,GAAiB,EAC9F,MAAM,gBAAC0Q,GAAmBtP,MACnBuK,EAASqiG,GAAct9F,KACvB6gG,EAAcC,GAAmBn+I,sBACjCo+I,EAAcC,GAAmBr+I,sBACjCs+I,EAAmBC,GAAwBv+I,mBAAS,OACpD3G,EAAM48B,GAAWj2B,oBAAS,GAGjCE,qBAAU,KACR,IAAK7G,EAAM,OAEX,MAAMmlJ,EAAgB34I,oBAAUyyC,GAE1Bt2C,EAAMhQ,OACTsB,OAAOkrJ,GACP/4J,KAAK+8C,IACJ,MAAMjmB,EAASorG,GAAQnlF,EAAOj5C,MACxBk1J,EAAM,OAAGliI,QAAH,IAAGA,OAAH,EAAGA,EAAQmiI,KAAKl8G,EAAQ,CAACm8G,cAAc,IAInDtgI,GAAQogI,GAGR,MAAMG,EAAS,CAAC,EACZH,EAAM,OAAUG,EAAM,KAAWH,EAAM,MAC3C,MAAMjuB,EAAS,IAAIxsH,IAAI,CAAC,OAAQ,WAChC,IAAK,MAAOjS,EAAK5O,KAAU6O,OAAOC,QAAQwsJ,GACnCjuB,EAAOvsH,IAAIlS,KACd6sJ,EAAO7sJ,GAAO5O,GAIlB,OADIs7J,EAAM,SAAYG,EAAM,OAAaH,EAAM,QACxCG,CAAP,IAEFT,EAAgBn8I,EAAhB,GACD,CAAC3I,EAAMi/C,IAGV,MAAMyW,EAAepoD,uBAAajL,IAChC,IAAK+D,kBAAQ/D,GAAO,OACpB,IAAI3D,EACJ,IAAK,MAAMyqC,KAAU9mC,EAAM,CACzB,MAAMnS,EAAOi5C,EAAOj5C,KACdgzB,EAASorG,GAAQp+H,GACvB,IAAKgzB,EAAQ,OACb,IACEA,EAAOwgI,aAAav6G,EAKrB,CAJC,MAAOlnC,GACPijJ,EAAqBjjJ,EAAEpD,SACvBH,EAAQuD,EACR,KACD,CACF,CACIvD,IACHsmJ,EAAgB3iJ,GAChB6iJ,EAAqB,MACtB,GACA,IAGGM,EAAal4I,uBAAY,KAC7B,GAAIy3I,EAAc,CAChB,GAAIE,EAAmB,OACvB,MAAMQ,EAAkB1mG,GAAiBgmG,GACzCzD,EAAWmE,EACZ,CACD7oH,GAAQ,EAAR,GACC,CAACqoH,EAAmBF,EAAczD,IAErC,OAAO,eAAC,GAAD,CACLpkJ,QAASA,EACTo6G,cAAe,eAAC,KAAD,CAAUl6G,SAAS,UAClCk2C,YAAa,IAAIA,EAAa5yC,QAAS,KAAQk8B,GAAQ,EAAR,GAH1C,SAKL,gBAACG,GAAA,EAAD,IAAYigC,EAAah9D,KAAMA,EAA/B,UACGo9B,GAAS,eAACJ,GAAA,EAAD,UAAcI,IACxB,gBAACH,GAAA,EAAD,WACE,eAAC,GAAD,CAAUxsC,KAAK,sHACf,eAAC,GAAD,CACE4R,KAAMwiJ,EACNhqI,OAAO,OACPshD,QAAS,GACTC,QAAS,GACTl7B,SAAUw0B,EACVh3D,MAAOumJ,EACPtmJ,QAASumJ,OAGb,gBAAChoH,GAAA,EAAD,WACE,eAAC3zB,GAAA,EAAD,CAAQ7I,QAAS,IAAMk8B,GAAQ,GAA/B,oBAGA,eAACrzB,GAAA,EAAD,CAAQ0pC,WAAYgyG,EAAmBvkJ,QAAS8kJ,EAAhD,yBAvBN,IAuCapB,UClXf,MAAMr7I,GAAYC,cAAWnI,IACpB,CACLvD,KAAM,CACJkE,QAAS,OACT09B,cAAe,MACfnE,OAAQ,OACRD,MAAO,QAET4qH,WAAY,CACVt/E,WAAY,EACZxiC,SAAU,EACV7I,OAAQ,OACRmd,OAAQ,GAEVytG,oBAAqB,CACnBjqH,SAAS,GAAD,OAAKu+F,GAAL,QAEVpiD,OAAQ,CACNj0C,SAAU,EACV7I,OAAQ,OACRkmC,UAAW,UAEbysD,UAAW,CACTlsH,QAAS,OACToiC,SAAU,EACVsU,OAAQ,EACR/d,aAAct5B,EAAMkH,QAAQ,KAE9Bs+E,OAAQ,CACNxsB,cAAe,OACf//B,SAAU,WACV+2B,KAAM,EACNxuB,MAAO,EACP4V,OAAQ,EACRlY,IAAK,EACLhF,OAAQ,OACRD,MAAO,OACP/9B,gBAAiB,QACjB4jH,WAAY,gBACZ4Z,WAAY,UACZriF,OAAQ,EACRtd,QAAS,GAEXgrH,cAAe,CACbhrH,QAAS,QAmDAirH,I,MAAAA,GA9CI1nJ,IAAMoI,MAAK,IAEvB,IAFwB,OAC7B6yD,GACI,EACJ,MAAMx4D,EAASmI,MACT,cACJ67C,EADI,iBAEJC,EAFI,eAGJC,EAHI,kBAIJC,GACErQ,MACGoxG,EAAYC,GAAiB,CAACnhG,IAAiBC,MAC/CmhG,EAAaC,GAAkB,CAACnhG,IAAkBC,KAEzD,OAAO,uBAAK5kD,UAAWS,EAAOtD,KAAvB,UACL,sBAAK6C,UAAW+iC,mBAAKtiC,EAAO8kJ,WAAYM,GAAeplJ,EAAO+kJ,qBAA9D,SACE,eAAC,GAAD,CACE3lJ,KAAM8lJ,EACNprB,aAAcqrB,EACdlgF,UAAWmgF,EACXrrB,kBAAmBsrB,MAGvB,sBAAK9lJ,UAAWS,EAAOi3E,OAAQn3E,QAAS,IAAMqlJ,GAAc,GAA5D,SACE,gBAACt+I,GAAA,EAAD,CAAKC,OAAQ,IAAK06B,cAAe,EAAjC,UACE,eAAC36B,GAAA,EAAD,CAAK0yB,aAAc,EAAnB,SACGi/B,IAEH,gBAAC3xD,GAAA,EAAD,CAAK0yB,aAAc,EAAnB,UACE,eAAC,GAAD,CAAWh6B,UAAWS,EAAO8sH,YAC7B,eAAC,GAAD,OAEF,eAACjmH,GAAA,EAAD,CAAK0yB,aAAc,EAAG+d,OAAQ,EAA9B,SACE,eAAC,GAAD,MAEF,eAACzwC,GAAA,EAAD,CAAKqyB,SAAS,WAAWoe,OAAQ,EAAjC,SACE,eAACi1E,GAAD,MAEF,sBAAKhtH,UAAW+iC,mBAAKtiC,EAAOylF,OAAQy/D,GAAcllJ,EAAOglJ,wBAxB/D,IC5DF,MAAMvkJ,GAAUmL,oBAAS,OAAC3S,QAAD,IAACA,GAAD,WAACA,EAAIG,YAAL,mBAAC,GAAUlB,eAAX,cAAC,GAAmBwsB,KASvCuY,GAAO,OAAGx8B,SAAH,IAAGA,QAAH,EAAGA,GAASw8B,QACnB4kB,GAAI,OAAGphD,SAAH,IAAGA,QAAH,EAAGA,GAASohD,KAKtB,SAASyjG,GAAT,GAA4E,IAAtD,KAAClmJ,EAAD,QAAO+tC,EAAP,SAAgB6rE,EAAhB,SAA0B8E,EAA1B,eAAoCynC,GAAiB,EACzE,MAAOp4G,QAASq4G,EAAV,WAAwB9iG,EAAxB,cAAoCrD,EAApC,WAAmDqF,EAAnD,WAA+DF,GAAc1Q,KAC7E1F,EAAaiR,IACbomG,EAAe/iG,EAAW8iG,IAC1B,KAAC/jJ,EAAD,cAAO8nD,GAAiB7E,IACxBz9B,EAAUu9B,IAEVkhG,EAAgBh5I,uBAAY,KAChC,MAAMwJ,EAAW,CAAC,EAClB,IAAK,MAAMpe,KAAOq1C,EACZp1C,OAAOqiE,eAAeC,KAAKltB,EAASr1C,KACtCoe,EAASpe,GAAO1D,MAAMoR,QAAQ2nC,EAAQr1C,KAASq1C,EAAQr1C,aAAgBiS,IAAM,IAAIA,IAAIojC,EAAQr1C,IAAQq1C,EAAQr1C,IAG7GyxD,GAAiByvD,GACnBzvD,GAAct8C,IACL,IAAIA,EAAK7H,UAAW4zG,MAG/B5qE,EAAWl4B,EAAX,GACC,CAAC8iG,EAAU5qE,EAAYjB,EAASoc,IAEnCtjD,qBAAU,KACJ7G,GACFsmJ,GACD,GACA,CAACA,EAAetmJ,IAEnB,MAAMyzI,EAAa1sI,mBAAQ,KACzB,MAAMgnC,EAAU,IAAIs4G,GACpB,IAAK,MAAM3tJ,KAAOq1C,EACZr1C,KAAOq1C,QAA4B/9C,IAAjB+9C,EAAQr1C,WACrBq1C,EAAQr1C,GAGnB,OAAOq1C,CAAP,GACC,CAACs4G,IAEE/gJ,EAAUyB,mBAAQ,KACtB,GAAK1E,EAGL,OAAOA,EAAKjW,KAAImsB,IAAK,CAAMgZ,SAAUhZ,EAAMgZ,SAAU3F,UAAWrT,EAAMqT,UAAW5N,SAAUzF,EAAMyF,YAAjG,GACC,CAAC3b,IAEEkkJ,EAAqBj5I,uBAAY,KACjC64I,GACFA,EAAe1S,EAAY5rH,EAASviB,EACrC,GACA,CAAC6gJ,EAAgB1S,EAAY5rH,EAASviB,IAEzC,OAAO,gBAACy3B,GAAA,EAAD,CACL/8B,KAAMA,EACNgtH,WAAY,CACV3sH,MAAO,CACLq7B,SAAU,SACVo7D,UAAW,SACXh8D,MAAO,SACPC,OAAQ,WAGZ,cAAY,gBAVP,UAYL,eAACkC,GAAA,EAAD,UACE,eAAC,GAAD,MAEF,gBAACC,GAAA,EAAD,WACE,uBAAM78B,MAAO,CAACujC,SAAU,KACxB,eAACr6B,GAAA,EAAD,CAAQ7I,QAAS,IAAMg+G,IAAYp+G,MAAM,YAAzC,oBAGA,eAACiJ,GAAA,EAAD,CAAQ7I,QAAS,IAAM6lJ,IAAsBjmJ,MAAM,YAAY,cAAY,mBAA3E,qBAKL,CAhFDu9B,GAAQ7vB,SATa,CACnB,aACA,aACA,UACA,eAMFy0C,GAAK9f,QAAU,CAACkoC,SAAS,GACzBpoB,GAAKviB,QAAU,CAAC2qC,SAAS,GA8PV27E,OAvKf,YAA4F,IAAjE,YAACptC,EAAD,SAAcl4E,EAAd,MAAwBp3C,EAAxB,eAA+B28J,EAA/B,MAA+C73I,EAA/C,QAAsD83I,GAAU,EACzF,MAAMnuJ,EAASwgD,YAAewgE,IACxB5lH,EAAQsxB,GAAgBm0F,GAAa,EAAd,OAAoB7gH,QAApB,IAAoBA,OAApB,EAAoBA,EAAQihH,WAClDx5G,EAAM48B,GAAWj2B,oBAAS,GAC3Bm8D,EAAOa,KAEP51B,EAAUhnC,mBAAQ,KAAW,OAALjd,QAAK,IAALA,OAAA,EAAAA,EAAOikD,UAAW,CAAC,GAAG,CAACjkD,IAE/CslI,EAAe9hH,uBAAY,KAC/BsvB,GAAQ,EAAR,GACC,IAEG2pH,EAAqBj5I,uBAAY,CAACygC,EAAS/qC,EAAOsC,KACtD,GAAI47B,EAAU,CACZ,MAAMuyG,EAAa,CAAC,EACpB,IAAK,MAAM/6I,KAAOq1C,EACZp1C,OAAOqiE,eAAeC,KAAKltB,EAASr1C,KACtC+6I,EAAW/6I,GAAO1D,MAAMoR,QAAQ2nC,EAAQr1C,KAASq1C,EAAQr1C,aAAgBiS,IAAM,IAAIojC,EAAQr1C,IAAQq1C,EAAQr1C,IAG/G,MAAMoe,EAAW,CACfua,MAAOruB,EAAMd,SAASmvB,MACtBruB,MAAOA,EAAMd,SAASc,MACtB8kB,WAAY9kB,EAAMd,SAAS4lB,WAC3BimB,QAAS0lG,GAEPgT,IACF3vI,EAASzU,KAAOiD,GAElB47B,EAASpqB,EACV,CACD8lB,GAAQ,EAAR,GACC,CAACsE,EAAUulH,IAER32J,EAAOiX,mBAAQ,KACnB,IAAIjX,EAAO,GACX,IAAK,MAAM4I,KAAOq1C,EAAS,CACzB,MAAMmqG,EAAcnqG,EAAQr1C,GACxBw/I,IAEApoJ,EADEkF,MAAMoR,QAAQ8xI,EAAYx/I,IACrB5I,EAAKiF,OAAO,IAAImjJ,GAAa9rJ,KAAItC,IAAK,CAAM4O,IAAKA,EAAK5O,MAAOA,EAAOD,IAAI,GAAD,OAAK6O,EAAL,YAAY5O,QAEnFgG,EAAKiF,OAAO,CAAC2D,IAAKA,EAAK5O,MAAOouJ,EAAaruJ,IAAI,GAAD,OAAK6O,EAAL,YAAYw/I,KAGtE,CACD,OAAOpoJ,CAAP,GACC,CAACi+C,IAEEi3B,EAAUj+D,mBAAQ,IACjB2Z,MAAM9R,GAGFwqG,EAAYnnH,KAFb,GAAN,OAAUmnH,EAAYnnH,KAAtB,YAA8B2c,IAI/B,CAACwqG,EAAaxqG,IAEX+3I,EAAqBr5I,uBAAY,KACjC4zB,GACFA,OAASlxC,EACV,GACA,CAACkxC,IAEEhB,EAAUn5B,mBAAQ,KACtB,MAAMm5B,EAAU,GA4BhB,OA3BIp2C,GACFo2C,EAAQnyC,KACN,eAACyS,GAAA,EAAD,CAEEF,MAAM,YACNG,KAAK,QACLC,QAASimJ,EAJX,SAME,eAACtpH,GAAA,EAAD,CAASD,MAAM,gBAAf,SACE,eAAC,KAAD,OANG,UAWX8C,EAAQnyC,KAAK,eAACyS,GAAA,EAAD,CAEXF,MAAM,YACNG,KAAK,QACLC,QAAS,IAAMk8B,GAAQ,GAJZ,SAMX,eAACS,GAAA,EAAD,CAASD,MAAM,gBAAf,SACE,eAAC,KAAD,OANG,WASH0lC,GAAQh5E,GACVo2C,EAAQnyC,KAAK,eAACk3E,GAAD,CAA6BxkE,KAAK,QAAQukE,QAASA,GAAlC,aAEzB9kC,CAAP,GACC,CAACp2C,EAAOg5E,EAAM6jF,EAAoB3hF,IAErC,OAAO,gBAAC,IAAMx9D,SAAP,WACL,eAACosD,GAAA,EAAD,CACEz1B,UAAQ,EACRn+B,MAAM,EACNlH,QAAS,GACTk5D,eAAiB54D,GAAWA,EAAOvP,IACnC+8J,UAAW,EACX98J,MAAOgG,EACPikE,WAAY,GACZ8yF,WAAY,CAAC/8J,EAAOg9J,IACXh9J,EAAMsC,KAAI,CAACgN,EAAQwV,IACjB,eAAC42D,GAAA,EAAD,IAEDshF,EAAY,CAAEl4I,UAClBjb,MAAOyF,EAAOvP,IACd4W,KAAK,QACLH,MAAM,UACN6kH,cAAUn1H,GALL4e,KASXylD,YAAclxD,GACZ,eAAC+tD,GAAA,EAAD,IACM/tD,EACJxP,MAAOA,EACP0V,QAAQ,SACR2+B,YAAkB,OAALl+C,QAAK,IAALA,KAAOwb,SAAWtQ,MAAMoR,QAAQtc,EAAMwb,UAAYxb,EAAMwb,QAAQ7W,OAAS,EAClFiuB,GAAU,SAAU5yB,EAAMwb,QAAQ7W,QAAQ,GAC1C,aACJikE,WAAY,IACPvvD,EAAOuvD,WACV+B,aAAct2D,IAAM05D,aAAa10D,EAAOuvD,WAAW+B,aAAc,CAAC,EAAGv0B,QAK7E,eAACwtB,GAAD,CACEnN,SAAQ,OAAEl/C,SAAF,IAAEA,QAAF,EAAEA,GAASk/C,SACnBK,kBAAiB,OAAEv/C,SAAF,IAAEA,QAAF,EAAEA,GAASymB,WAC5B24B,eAAgB5iB,GAChB6iB,YAAa+B,GACb9B,mBAAkB,OAAEt/C,SAAF,IAAEA,QAAF,EAAEA,GAASksH,aAC7B/sE,0BAAsBxwD,EACtB8wD,oBAAqB/S,EACrBgT,sBAAqB,OAAE1/C,SAAF,IAAEA,QAAF,EAAEA,GAASgsH,gBAChC9xH,GAAE,4BAAuB69G,EAAY/pF,gBATvC,SAWE,eAAC62H,GAAD,CACElmJ,KAAMA,EACN+tC,QAASA,EACT2wE,SAAU0Q,EACV+2B,eAAgBI,EAChB3sC,SAAU8sC,GAAW,UAI5B,ECjQM,MAAMxS,GAAyB,CACpCh3B,mBAAoBA,GACpB/B,mBAAoBA,GACpBG,gBAAiBA,GACjB0C,iBAAkBA,GAClB+oC,uBAAwB/oC,GACxBoa,sBAAuBA,GACvBla,yBAA0BA,GAC1BC,iBAAkBA,GAClBkB,iBAAkBA,GAClBxF,qBAAsBA,GACtBS,iBAAkBA,GAClBC,iBAAkBA,GAClByG,qBAAsBA,GACtB0R,sBAAuBA,GACvB0E,mBAAoBA,GACpBovB,kBAAmBA,ICdfz9I,GAAYC,cAAWnI,IAAK,CAChC43B,WAAY,CACVqC,MAAO,OACPt5B,QAAS,OACT09B,cAAe,SACfC,eAAgB,UAElB6nH,YAAa,CACXl/I,QAAS,GAEXm/I,iBAAkB,CAAC,EAEnB13J,IAAK,CACHiS,QAAS,OACT29B,eAAgB,qBAIP+nH,GAAkB/oJ,IAAMoI,MAAK,IAA6B,IAA5B,YAAC6yG,EAAD,QAAclgF,GAAa,EACpE,MAAMz5B,EAAUsJ,MACV,QAACpE,EAAD,SAAUoZ,GAAYmiF,KAE5B,IAAKkZ,EAAYlpH,KACf,OAAO,KAGT,MAAMynC,EAAQyhF,EAAYzhF,OAAS,GACV,IAAD,MAAxB,GAAqB,IAAjBA,EAAMlpC,OACR,MAAuD,0BAAnD,UAAA2qH,EAAY/zF,qBAAZ,mBAA2BC,WAA3B,mBAAiC,UAAjC,eAAqCpE,WAChC,eAACwoD,GAAD,UACL,eAAC,GAAD,CAAUrnE,KAAM62B,EAAShzB,SAAUkzG,EAAa19E,SAAU,OAA1D,SACE,eAAC,KAAD,CACEqmF,KAAM,CACJhnF,OAAQ,QACRD,MAAO,OACP/gC,QAAS,CACP,iEACA,kCACA,wDAEFmoH,KAAM,eACN9uC,QAAQ,EACR6uC,SAAS,EACTD,SAAS,EACTmlC,UAAU,EACVC,WAAW,GAEbz2G,aAAczX,EAAQkgF,EAAYnnH,MAClCghD,UAAU,QAKX,eAACy2B,GAAD,UACL,eAAC,GAAD,CAAUrnE,KAAM62B,EAAShzB,SAAUkzG,MAEhC,GAAqB,IAAjBzhF,EAAMlpC,OAAc,CAC7B,MAAMwL,EAASi/B,EAAQkgF,EAAYnnH,OAAS,GAC5C,OAAO,eAACy3E,GAAD,UACL,eAAC,GAAD,CAAUrnE,KAAM62B,EAAShzB,SAAUkzG,EAAnC,SACE,gBAAC3xG,GAAA,EAAD,CAAKqzB,MAAM,OAAX,UACG7gC,EAAOvJ,MAAM,EAxCG,GAwCkBtE,KAAI,CAACtC,EAAO8kB,IAC7C,eAAC,GAAD,CAAsBvM,KAAM,CAAC,CAAC+2G,EAAYnnH,MAAOnI,GAAQoc,SAAUkzG,EAAa1xC,SAAO,GAAxE94D,KAEhB3U,EAAOxL,QA3CS,GA4Cf,gBAACgZ,GAAA,EAAD,CAAKtH,UAAWV,EAAQlQ,IAAxB,UACE,eAACoY,GAAA,EAAD,CAAYm1C,QAAM,EAACzzC,QAAS,QAA5B,uBACUpP,EAAOxL,OA9CJ,EA6Cb,iBACmDiuB,GAAU,OAAQziB,EAAOxL,OA9C/D,GA8C0F,MAEvG,eAAC44J,GAAD,CACElnJ,UAAWV,EAAQunJ,YACnB9lI,UAAW1gB,KACXmE,QAASA,EAASoZ,SAAUA,EAC5Bhb,KAAI,eAAUq2G,EAAYnnH,MAJ5B,SAME,eAAC,KAAD,eAOb,CACC,OAAO,eAACy3E,GAAD,UACL,eAAC,GAAD,CAAUrnE,KAAM62B,EAAShzB,SAAUkzG,EAAnC,SACE,gBAAC3xG,GAAA,EAAD,CAAKqzB,MAAO,OAAQM,UAAU,SAA9B,UACE,eAAC2tE,GAAD,CACE9uG,OAAQi/B,EAAQkgF,EAAYnnH,MAC5B0lC,MAAOA,EACPivD,QAAQ,EACR12F,KAAMkpH,EAAYlpH,KAAKqrB,WAJzB,iBAKiB69F,EAAYnnH,OAE7B,gBAAC0V,GAAA,EAAD,CAAYm1C,QAAM,EAACzzC,QAAQ,UAA3B,cACI+vG,EAAYzhF,MAAMvrC,KAAI,CAACif,EAAWuD,IAAU,kCAC3CA,EAAQ,GAAK,iDAAkCzP,OAAOkM,KADAuD,KAD3D,iBAQP,IAOG04I,GAAiBnpJ,IAAMoI,MAAK,IAA4B,IAA3B,WAAC4oB,EAAD,QAAa+J,GAAa,EAC3D,MAAMqoC,EAAU96C,mBAEV8gI,EAAuBxgJ,mBAAQ,IAAMygJ,GAAwBr4H,IAAa,CAACA,IAEjF,OACE,sBAAK9N,IAAKkgD,EAAV,SACG,eAAC+H,GAAD,CAAejnE,KAAM62B,EAArB,SACEquH,EAAqBn7J,KAAIoqC,GACxB,eAACgzC,GAAD,UACE,eAAC09E,GAAD,CAAiB9tC,YAAa5iF,EAAU0C,QAASA,KADjC1C,EAASvkC,WAJnC,IA0Eaw1J,OAzDKtpJ,IAAMoI,MAAK,IAA6D,IAAD,QAA3D,YAACmhJ,EAAD,WAAcv4H,EAAd,QAA0B+J,EAA1B,SAAmCmjC,KAAa38D,GAAW,EACzF,MAAM,QAACiF,EAAD,SAAUoZ,GAAYmiF,MACrBynD,EAAUC,GAAejhJ,oBAAS,GAEnCu5B,EAAU,gBAAC,IAAM14B,SAAP,WACd,eAAChH,GAAA,EAAD,CAAYE,QAAS,IAAMknJ,GAAY99J,IAAUA,IAAjD,SACE,eAAC,KAAD,MAEF,eAACu9J,GAAD,CACEnmI,UAAW1gB,KACXmE,QAASA,EAASoZ,SAAUA,EAC5Bhb,KAAM2kJ,EAHR,SAKE,eAAC,KAAD,SAIJ,OAAKv4H,EAKE,gBAACi5F,GAAD,CAAchrF,MAAOjO,EAAWx7B,OAASw7B,EAAWl9B,KAAMsO,OAAQ2/B,EAAlE,UAC0B,gCAA9B/Q,EAAWE,gBACV,eAAC5nB,GAAA,EAAD,CAAKC,OAAQ,EAAb,SACE,gBAACC,GAAA,EAAD,sCAAoC,UAAAuxB,EAAQ2uH,gBAAR,eAAkBp5J,SAAU,MAAhE,cAGJ,gBAACgZ,GAAA,EAAD,WACI40D,IAAa9zC,GAAW4G,GAEtB,eAACm4H,GAAD,CACEn4H,WAAYA,EACZ+J,QAASA,EACTwuH,YAAaA,KACThoJ,IAGN,eAAC,GAAD,CACEyvB,WAAYA,EACZ+J,QAASA,EACTyuH,SAAUA,KACNjoJ,MAGR,UAAAyvB,EAAW9J,qBAAX,eAA0BsiH,OAAQx4G,EAAW0F,iBAAiBzoC,KAAI8sC,GAAWA,EAAQjnC,OAAMzC,SAAS,iBAAmB,eAAC,GAAD,CAAc2/B,WAAYA,EAAY+J,QAASA,EAASnb,SAAUA,EAAUpZ,QAASA,WA3BhN1F,QAAQP,MAAM,oDACP,KAGT,IC1JF,MAAMopJ,GAAiB3pJ,IAAMoI,MAAK,YAAyD,IAAD,MAAhC,YAAC6yG,EAAD,MAActvH,EAAd,SAAqBo3C,GAAW,EACxF,MACM6mH,IADkB,UAAA3uC,EAAY/zF,qBAAZ,eAA2BC,MAAO,IACnB,IAAM,CAAC,GACxC,UAACpE,EAAD,MAAYxhB,KAAUi8B,GAAaosH,EACnCC,EAAgB9mI,GAAagzH,GAAuBhzH,GAC1D,IAAK8mI,EACH,OAAO,KAET,MAAMC,EAAqB,CACzB7uC,YAAaA,EACbtvH,WAAiBkG,IAAVlG,EAAsBsvH,EAAYjyG,QAAUrd,EACnDo3C,SAAUA,KACPvF,KACCj8B,GAAS,CAAC,GAGVi4B,EAAQyhF,EAAYzhF,OAAS,GACnC,OAAqB,IAAjBA,EAAMlpC,OACD,eAACgZ,GAAA,EAAD,CAAK,cAAa,2BAAlB,SACJtJ,IAAMwb,cAAcquI,EAAeC,KAEZ,IAAjBtwH,EAAMlpC,OACR,eAACgZ,GAAA,EAAD,CAAK,cAAa,2BAAlB,SACL,eAAC,GAAD,CACEyZ,UAAW8mI,KACPC,OAIRhpJ,QAAQC,IAAI,8BAA+By4B,GACpC,KAEV,IAOKuwH,GAAyBl/I,cAAWnI,IAAK,CAC7CvD,KAAM,CACJq1C,SAAU,KAEZw1G,cAAe,CACbhuH,aAAc,OAuFHiuH,OApFOjqJ,IAAMoI,MAAK,YAAmE,IAAD,MAA3C,WAAC4oB,EAAD,QAAa+J,EAAb,SAAsBgI,EAAtB,SAAgCymH,GAAW,EACjG,MAAMloJ,EAAUyoJ,MACV,qBAACj9H,GAAwBi1E,MAAmB,CAAC,EAC7C3+B,EAAU96C,mBAEVivC,EAAepoD,uBAAY,CAACkpB,EAAU1sC,KACtCovC,EAAQ1C,EAASvkC,QAAUnI,IAG/BovC,EAAQ1C,EAASvkC,MAAQnI,EACrBo3C,GACFA,EAAShI,GAEXjO,IAAsB,GACrB,CAACiO,EAASgI,EAAUjW,IAEjBo9H,EAAmB/6I,uBAAajL,IACpC+3B,iBAAOlB,EAAS72B,GACZ6+B,GACFA,EAAShI,GAEXjO,GAAsB,GACrB,CAACA,EAAsBiW,EAAUhI,IAE9BquH,EAAuBxgJ,mBAAQ,IAAMygJ,GAAwBr4H,IAAa,CAACA,IAC3Em5H,EAAuBvhJ,mBAAQ,IAAMwgJ,EAAqBtuJ,QAAOu9B,IAAQ,aAAIA,EAAS9U,QAAUoQ,KAAnB,UAAmC0E,EAASnR,qBAA5C,aAAmC,EAAwBC,IAA/D,KAAqE,CAACiiI,IAE/IgB,EAAWxhJ,mBAAQ,KACvB,IAAK4gJ,EACH,OAAO,KAET,MAAMY,EAAW,CAAC,EAUlB,OATAD,EACGrvJ,QAAOu9B,IAEN,MAAM1sC,EAAQovC,EAAQ1C,EAASvkC,MAC/B,OAAQnI,GAA0B,kBAAVA,GAAsBA,EAAM2E,QAAU,GAA9D,IAED2L,SAAQo8B,IACP+xH,EAAS/xH,EAASvkC,MAAQinC,EAAQ1C,EAASvkC,KAA3C,IAEGs2J,CAAP,GACC,CAACZ,EAAUW,EAAsBpvH,IAEpC,OACE,sBAAK/4B,UAAWV,EAAQnC,KAAM+jB,IAAKkgD,EAAnC,SACGomF,EAEG,eAAClgJ,GAAA,EAAD,CAAKszB,OAAM,UAAEwmC,EAAQ5qD,eAAV,aAAE,EAAiB0tD,aAAcu9B,QAAS,EAArD,SACE,eAAC,GAAD,CAAav/F,KAAMkmJ,EAAUrnH,SAAUmnH,MAGzCC,EAAqBl8J,KAAI8Z,GACvBA,EAASsiJ,YACL,eAAC/gJ,GAAA,EAAD,CAAK0yB,aAAc,EAAuB,cAAa,mBAAvD,SACA,eAAC,GAAD,CACEi/E,YAAalzG,EACbpc,MAAK,OAAEovC,QAAF,IAAEA,OAAF,EAAEA,EAAUhzB,EAASjU,MAAOivC,SAAUp3C,GAAS4rE,EAAaxvD,EAAUpc,MAHlDoc,EAASjU,MAMpC,eAACwV,GAAA,EAAD,CAAyB,cAAa,mBAAtC,SACA,eAAC6hE,GAAD,CAAenpE,UAAWV,EAAQ0oJ,cAAe9lJ,KAAM62B,EAAvD,SACE,eAACswC,GAAD,UACE,eAAC09E,GAAD,CAAiB9tC,YAAalzG,EAAUgzB,QAASA,SAH3ChzB,EAASjU,SAYlC,IC5ID,MAAMw2J,WAAoB15J,MACxBgP,YAAYc,GACVZ,MAAMY,GACN5P,KAAKgD,KAAO,aACb,EAGH,MAAMgnC,GAAW,SAACnvC,EAAOqvC,GAAyC,IAA/BpL,EAA8B,uDAArB,KAAMr1B,EAAe,uDAAT,KAClD5O,GAA0B,kBAAVA,EAClB6O,OAAOC,QAAQ9O,GAAOsQ,SAAQ,IAAa,IAAX3M,EAAGyH,GAAO,EACxC+jC,GAAS/jC,EAAGikC,EAAUrvC,EAAO2D,EAA7B,IAEO3D,GAASkL,MAAMoR,QAAQtc,GAChCA,EAAMsQ,SAAQ,CAAC4nB,EAAMpT,KACnBqqB,GAASjX,EAAMmX,EAAUrvC,EAAO8kB,EAAhC,IAGFuqB,EAASpL,EAAQr1B,EAAK5O,EAEzB,EAEK4+J,GAAevqJ,IAAMoI,MAAK,YAAyE,IAAD,YAAlD,KAACohI,EAAD,QAAOzuG,EAAP,WAAgB/J,EAAhB,MAA4BiO,EAA5B,aAAmCotE,GAAe,EACtG,MAAM,MAACv+F,GAASgC,KAEV06I,EAAiB5hJ,mBAAQ,KAC7B,GAAI,OAACooB,QAAD,IAACA,MAAY5N,YACf,MAAO,MAACvxB,OAAWA,GAGrB,MAAM44J,EAAS7lJ,IACb,MAAM8lJ,EAAe,IAAM9lJ,EAAKtJ,QAAQ,KAAM,IACxCqvJ,EAAsB1nI,GAAmBynI,EAAc15H,GAC7D,QAA4Bn/B,IAAxB84J,GAA6D,OAAxBA,EACvC,MAAM,IAAIL,GAAJ,qCAA8C1lJ,IAEtD,IAAIjZ,EACJ,IACEA,EAAQs3B,GAAmBynI,EAAc3vH,EAK1C,CAJC,MAAOmuF,GACP,IAAKA,EAAIxoH,QAAQC,WAAW,wBAC1B,MAAM,IAAI2pJ,GAAYphC,EAAIxoH,QAE7B,CACD,QAAc7O,IAAVlG,GAAiC,OAAVA,EAEzB,MAAO,MAACkG,OAAWA,GAErB,MAAMrE,EAAI,OAAGm9J,QAAH,IAAGA,OAAH,EAAGA,EAAqBn9J,KAClC,GAAIA,EAAM,CAAC,IAAD,MACR,MAAMs2D,EAAW,OAAG6mG,QAAH,IAAGA,GAAH,UAAGA,EAAqBzjI,qBAAxB,iBAAG,EAAoCC,WAAvC,iBAAG,EAA0C,UAA7C,aAAG,EAA8Cm2F,mBAC5Dv1G,EAAW+7C,EAAc,IAAIgoB,GAAEngF,EAAO6B,GAAMuoB,GAAG+tC,GAAe,IAAIgoB,GAAEngF,EAAO6B,GAAM2oB,SAASrI,GAChG,MAAO,CAAC/F,EAASpc,QAASoc,EAASvS,QACpC,CACC,MAAO,CAAC7J,EAAO6B,EAChB,EASH,SAASo9J,EAAahmJ,EAAMimJ,GAC1B,MAAMC,EAAUlmJ,EAAKrM,MAAM,KAC3B,IAAK,IAAI/J,EAAI,EAAGA,EAAIs8J,EAAQx6J,OAAQ9B,IAAK,CACvC,MAAMu8J,EAAcD,EAAQt8J,GAC5B,GAAIu8J,EAAY15J,SAAS,KAAM,CAC7B,MAAM25J,EAAaF,EAAQv4J,MAAM,EAAG/D,GAAGuP,KAAK,KACtC4rF,EAAS1mE,GAAmB,IAAM+nI,EAAW1vJ,QAAQ,KAAM,IAAKy/B,GACtE,QAAelpC,IAAX83F,EAAwB,MAAO,CAAC,GAAI,IAExC,IAAKv9F,EAAOw2G,EAAMzhF,GAAQ4pI,EAAYxyJ,MAAM,KAAKtK,KAAKuB,GAAY,KAANA,OAAWqC,EAAY2xB,SAASh0B,KAC5F,GAAI0sB,OAAOqG,MAAMn2B,IAAU8vB,OAAOqG,MAAMqgF,SAAkB/wG,IAATsvB,EAC/C,MAAM,IAAImpI,GAAJ,mCAA4CS,EAA5C,MAKR,GAHA3+J,OAAkByF,IAAVzF,GAAuBA,GAASu9F,EAAOr5F,OAAS,EAAKlE,EAAQ,EAAIA,EAAQu9F,EAAOr5F,OAASlE,EACjGw2G,OAAgB/wG,IAAT+wG,GAAsBA,EAAOjZ,EAAOr5F,OAASq5F,EAAOr5F,OAAUsyG,EAAO,EAAIA,EAAOjZ,EAAOr5F,OAASsyG,EAEnGA,EAAOx2G,EAAO,CAChB,MAAM6+J,EAAaH,EAAQv4J,MAAM/D,EAAI,GAAGuP,KAAK,KACvCmtJ,EAAW,GACXC,EAAW,GACjB,IAAK,IAAI97J,EAAIjD,EAAOiD,EAAIuzG,EAAMvzG,IAAK,CAAC,IAAD,IACjC,MAAM+7J,EAAYnoI,GAAmB,IAAM+nI,EAAW1vJ,QAAQ,KAAM,IAA/B,WAAyCjM,EAAzC,gBAA0D2hC,GACzFx7B,EAAQq1J,OAAWh5J,EAAH,UAAgB83F,EAAOt6F,GAAP,OAAU+7J,QAAV,IAAUA,GAAV,UAAUA,EAAWhkI,YAArB,aAAU,EAAiBikI,uBAA3C,QAA8D1hE,EAAOt6F,GAAGyE,MACvF6jJ,EAAOz9H,GAAS0wI,EAAa,GAAD,OAAII,EAAJ,YAAkB37J,EAAlB,YAAuB47J,GAAcJ,GAClEviF,EAAc,OAAG9yE,QAAH,IAAGA,IAAH,UAAeokB,GAAUkxI,EAAQt8J,EAAI,KAArC,OAA2Cq8J,EAAW,GAAH,WAAYx7J,IACnF6qB,EAAMje,SAASnI,IAAWq3J,EAASv7J,KAAT,UAAiB04E,EAAjB,aAAoCx0E,GAApC,IAC1Bo3J,EAASt7J,QAAQ+nJ,EAClB,CACD,MAAO,CAACuT,EAAUC,EACnB,CACD,MAAO,CAAC,GAAI,GACb,CACF,CACD,MAAO,CAAC,CAACvmJ,GAAO,CAACgV,GAAUkxI,EAAQA,EAAQx6J,OAAS,KACrD,CASD,SAASg7J,EAAe1mJ,EAAM2mJ,GAC5B,MAAMC,EAAc30J,MAAMoR,QAAQrD,GAAQA,EAAO,CAACA,GAC5CsmJ,EAAW,GACXO,EAAQ,GAad,OAZAD,EAAYvvJ,SAASyvJ,IAAgB,IAAD,EAClC,MAAMC,EAAe,IAAMD,EAAWpwJ,QAAQ,KAAM,IAE9CuvJ,EAAgH,KAArG,UAAA5nI,GAAmB0oI,EAAarwJ,QAAQ,kBAAmB,MAAQ,SAAU01B,UAA7E,eAA0F1gC,SACpGqnJ,EAAOz9H,GAAS0wI,EAAae,EAAcd,GAElDK,EAASt7J,QAASi7J,EAAW,CAAClT,GAASA,GACnC4T,GAEFE,EAAM77J,QAASi7J,EAAW,CAAC3wI,EAAM,IAAMA,EACxC,IAEIqxI,EAAY,CAACL,EAAUO,GAASP,CACxC,CAUD,SAASU,EAAUhnJ,GACjB,IAAIinJ,EAAS,GACTt7I,EAAO,GACPu7I,EAAY,GAahB,OAZIj1J,MAAMoR,QAAQrD,GAEhBA,EAAK3I,SAAS8vJ,IACZ,MAAOC,EAAOC,GAAaxB,EAAOsB,GAClCF,EAAOj8J,KAAKo8J,GACZz7I,EAAO07I,EACPH,EAAYC,EAAMxzJ,MAAM,IAAxB,MAGDszJ,EAAQt7I,GAAQk6I,EAAO7lJ,GACxBknJ,EAAYlnJ,EAAKrM,MAAM,MAElB,CAACszJ,EAAQt7I,EAAMu7I,EACvB,CAED,MAAMI,EAAS,GACTC,EAAU,GACVC,EAAS,GACTC,EAAU,GACVC,EAAS,GACTC,EAAU,GAEVC,EAAoB,CAACtoJ,EAAM3J,EAAKuT,EAAOxY,KAC3C,MAAM3J,EAAK,OAAGuY,QAAH,IAAGA,OAAH,EAAGA,EAAO3J,GACrB,GAAI5O,IAA2B,kBAAVA,GAAsBA,aAAiBqV,SACtDrV,EAAMgV,WAAW,KAAM,CACzB,MAAOg3I,EAAOz9H,GAASoxI,EAAe3/J,EAAM4G,MAAM,IAAI,IAC/CuJ,EAAQtO,EAAMoX,GAAQgnJ,EAAUjU,EAAM,IACvCniJ,EAAQ0kB,EAAM,IAAMN,GAAUhV,EAAKA,EAAKtU,OAAS,IACvD4T,EAAK3J,GAAOuB,EACZgS,EAAMle,KAAKpC,GACX8H,EAAO1F,KAAK4F,EACb,CACF,EAGGg1J,EAAiBn8I,oBAAUm7H,KACC,OAAdghB,QAAc,IAAdA,OAAA,EAAAA,EAAgBtmJ,OAAQrN,MAAMoR,QAAQuiJ,EAAetmJ,MACzCsmJ,EAAetmJ,KAAO,CAACsmJ,EAAetmJ,OAC5DjI,SAAQ,CAACiI,EAAMuM,KACvB+7I,EAAkBtoJ,EAAM,IAAKgoJ,EAAQC,GACrCK,EAAkBtoJ,EAAM,IAAKkoJ,EAAQC,GACrCG,EAAkBtoJ,EAAM,IAAKooJ,EAAQC,EAArC,IAGFzxH,GAAS0vH,EAAetmJ,MAAM,CAACA,EAAM3J,EAAK5O,KACxC,GAAY,UAAR4O,IACmB,kBAAV5O,GAAsBA,aAAiBqV,SAC5CrV,EAAMgV,WAAW,KAAM,CACzB,IAAIg3I,EAAO77I,EACX,KACG67I,GAAS2T,EAAe3/J,EAAM4G,MAAM,IAAI,IACxCuJ,GAAU8vJ,EAAUjU,EAAM,GAO5B,CANC,MAAOp3I,GACP,IAAI5U,IAAS,qCAAqCq0D,KAAKr0D,GAGrD,MAAM,IAAI2+J,GAAY/pJ,GAFtBzE,EAASnQ,CAIZ,CACDuY,EAAK3J,GAAOuB,CACb,CAEJ,IAGH,MAAMyvC,EAAS,CAAC,EAkBhB,OAjBI4gH,EAAQ77J,OAAS,IACnBi7C,EAAOujE,MAAQ,CACb7vE,MAAOitH,EAAO,GAAP,UAAeC,EAAQ,GAAvB,aAA8BD,EAAO,GAArC,KAA6CC,EAAQ,KAGhEE,EAAQpwJ,SAAQ,CAACm/I,EAAQ3qI,KACvB86B,EAAiB,IAAV96B,EAAc,QAAd,eAAgCA,EAAQ,IAAO,CACpDwuB,MAAOmtH,EAAO37I,GAAP,UAAmB2qI,EAAnB,aAA8BgR,EAAO37I,GAArC,KAAiD2qI,EAD1D,IAIFmR,EAAQtwJ,SAAQ,CAACwwJ,EAAQh8I,KACvB86B,EAAiB,IAAV96B,EAAc,QAAd,eAAgCA,EAAQ,IAAO,CACpDwuB,MAAOqtH,EAAO77I,GAAP,UAAmBg8I,EAAnB,aAA8BH,EAAO77I,GAArC,KAAiDg8I,EAD1D,IAKFjC,EAAej/G,OAAS5xB,gBAAM,CAAC,EAAG4xB,EAAQi/G,EAAej/G,QAClDi/G,CAAP,GACC,CAAChhB,EAAMzuG,EAAS/J,EAAYljB,IAE/B,OAAO,eAACxE,GAAA,EAAD,CAAKkrC,SAAU,IAAK5X,QAAsB,OAAd4tH,QAAc,IAAdA,GAAA,UAAAA,EAAgBj/G,cAAhB,eAAwB3O,UAAxB,OAAkC4tH,QAAlC,IAAkCA,GAAlC,UAAkCA,EAAgBj/G,cAAlD,iBAAkC,EAAwB8iE,gBAA1D,iBAAkC,EAAkC9iE,cAApE,aAAkC,EAA0C3O,SAAU,IAAlH,SACL,eAAC,GAAD,CACE14B,KAAMsmJ,EAAetmJ,KACrBqnC,OAAQi/G,EAAej/G,OACvB6gE,WAAYntE,EACZstE,cAAc,EACdnyG,OAAQowJ,EAAepwJ,OACvBiyG,aAAcA,KAGnB,IASc/qC,WACZ/gE,GAAyB,gBAAfA,EAAMzM,KACbyM,EAAMG,QACN,mDAHS4gE,CAIbipF,IC7KamC,OAvDU1sJ,IAAMoI,MAAK,IAA4C,IAA3C,QAACzN,EAAD,MAAUivC,EAAV,SAAiB7G,EAAjB,UAA2B/gC,GAAe,EAC7E,MAAOrW,EAAO8mD,GAAYjqC,mBAAS,MAC7B/F,EAASmI,KAETg6B,EAAez1B,uBAAa5U,IAChC,MAAMrD,EAAMyD,EAAQJ,GACpBk4C,EAAQ,OAACv7C,QAAD,IAACA,OAAD,EAACA,EAAKsH,SACdukC,GAAYA,EAAS7rC,EAAIuC,IAAzB,GACC,CAACkB,EAASooC,IAEPkyB,EAAe9lD,uBAAa5U,IAChC,MAAMrD,EAAMyD,EAAQJ,GAChBrD,GAAO6rC,GAAUA,EAAS7rC,EAAIuC,IAAb,GACpB,CAACkB,EAASooC,IAEb,OAAO,eAACk2D,GAAA,EAAD,CAAOj3F,UAAW+iC,mBAAK/iC,EAAWS,EAAOtD,MAAzC,SACL,eAAC0mH,GAAD,CACEl6H,MAAOA,EACPo3C,SAAU0P,EACVghB,SAAU7uB,EACV4uB,SAAUyB,EACVt6D,QAASA,EACTivC,MAAOA,EACP0qB,eAAgB,CACdppD,QAAS,WACT2+B,YAAa,yBACbvnC,KAAM,UAERiyD,WAAY,CACVjzD,QAAS,CACPqrJ,eAAgBlqJ,EAAOkqJ,gBAEzBrjC,eAAgB,eAACpqF,GAAA,EAAD,CAASD,MAAM,aAAf,SACd,eAAC58B,GAAA,EAAD,CAAYL,UAAWS,EAAO8zD,WAAYh0D,QAAS,IAAM0yD,EAAatpE,GAAQ,aAAW,SAAzF,SACE,eAAC,KAAD,YAnBV,ICjCF,MAAM2+J,WAAoB15J,MACxBgP,YAAYc,GACVZ,MAAMY,GACN5P,KAAKgD,KAAO,aACb,EAGH,MAAM84J,GAAS5sJ,IAAMoI,MAAK,YAAqD,IAArC,KAACohI,EAAD,QAAOzuG,EAAP,WAAgB/J,EAAhB,MAA4BiO,GAAQ,EAC5E,MAAMv8B,EAAQy6C,gBACR,MAACrvC,GAASgC,KACV42E,EAAQ8iD,EAAKh6I,GAAKg6I,EAAI,QAAcA,EAAI,MACxCU,EAAQV,EAAKrpF,GAAKqpF,EAAI,QAAcA,EAAI,OAEvCtlI,EAAMqnC,GAAU3iC,mBAAQ,KAC7B,GAAI,OAACooB,QAAD,IAACA,MAAY5N,YACf,MAAO,MAACvxB,OAAWA,GAErB,MAAMg7J,EAASh2J,MAAMoR,QAAQy+E,GAASA,EAAQ,CAACA,GACzComE,EAASj2J,MAAMoR,QAAQiiI,GAASA,EAAQ,CAACA,GACzCugB,EAAS7lJ,IACb,MAAM8lJ,EAAe,IAAM9lJ,EAAKtJ,QAAQ,KAAM,IACxCqvJ,EAAsB1nI,GAAmBynI,EAAc15H,GAC7D,QAA4Bn/B,IAAxB84J,GAA6D,OAAxBA,EACvC,MAAM,IAAIL,GAAJ,qCAA8C1lJ,IAEtD,IAAIjZ,EACJ,IACEA,EAAQs3B,GAAmBynI,EAAc3vH,EAK1C,CAJC,MAAOmuF,GACP,IAAKA,EAAIxoH,QAAQC,WAAW,wBAC1B,MAAM,IAAI2pJ,GAAYphC,EAAIxoH,QAE7B,CACD,QAAc7O,IAAVlG,GAAiC,OAAVA,EAEzB,MAAO,MAACkG,OAAWA,GAErB,MAAMrE,EAAI,OAAGm9J,QAAH,IAAGA,OAAH,EAAGA,EAAqBn9J,KAClC,GAAIA,EAAM,CAAC,IAAD,MACR,MAAMs2D,EAAW,OAAG6mG,QAAH,IAAGA,GAAH,UAAGA,EAAqBzjI,qBAAxB,iBAAG,EAAoCC,WAAvC,iBAAG,EAA0C,UAA7C,aAAG,EAA8Cm2F,mBAC5Dv1G,EAAW+7C,EAAc,IAAIgoB,GAAEngF,EAAO6B,GAAMuoB,GAAG+tC,GAAe,IAAIgoB,GAAEngF,EAAO6B,GAAM2oB,SAASrI,GAChG,MAAO,CAAC/F,EAASpc,QAASoc,EAASvS,QACpC,CACC,MAAO,CAAC7J,EAAO6B,EAChB,EASH,SAASo9J,EAAahmJ,EAAMimJ,GAC1B,MAAMC,EAAUlmJ,EAAKrM,MAAM,KAC3B,IAAK,IAAI/J,EAAI,EAAGA,EAAIs8J,EAAQx6J,OAAQ9B,IAAK,CACvC,MAAMu8J,EAAcD,EAAQt8J,GAC5B,GAAIu8J,EAAY15J,SAAS,KAAM,CAC7B,MAAM25J,EAAaF,EAAQv4J,MAAM,EAAG/D,GAAGuP,KAAK,KACtC4rF,EAAS1mE,GAAmB,IAAM+nI,EAAW1vJ,QAAQ,KAAM,IAAKy/B,GACtE,QAAelpC,IAAX83F,EAAwB,MAAO,CAAC,GAAI,IAExC,IAAKv9F,EAAOw2G,EAAMzhF,GAAQ4pI,EAAYxyJ,MAAM,KAAKtK,KAAKuB,GAAY,KAANA,OAAWqC,EAAY2xB,SAASh0B,KAC5F,GAAI0sB,OAAOqG,MAAMn2B,IAAU8vB,OAAOqG,MAAMqgF,SAAkB/wG,IAATsvB,EAC/C,MAAM,IAAImpI,GAAJ,mCAA4CS,EAA5C,MAKR,GAHA3+J,OAAkByF,IAAVzF,GAAuBA,GAASu9F,EAAOr5F,OAAS,EAAKlE,EAAQ,EAAIA,EAAQu9F,EAAOr5F,OAASlE,EACjGw2G,OAAgB/wG,IAAT+wG,GAAsBA,EAAOjZ,EAAOr5F,OAASq5F,EAAOr5F,OAAUsyG,EAAO,EAAIA,EAAOjZ,EAAOr5F,OAASsyG,EAEnGA,EAAOx2G,EAAO,CAChB,MAAM6+J,EAAaH,EAAQv4J,MAAM/D,EAAI,GAAGuP,KAAK,KACvCmtJ,EAAW,GACXC,EAAW,GACjB,IAAK,IAAI97J,EAAIjD,EAAOiD,EAAIuzG,EAAMvzG,IAAK,CAAC,IAAD,IACjC,MAAM+7J,EAAYnoI,GAAmB,IAAM+nI,EAAW1vJ,QAAQ,KAAM,IAA/B,WAAyCjM,EAAzC,gBAA0D2hC,GACzFx7B,EAAQq1J,OAAWh5J,EAAH,UAAgB83F,EAAOt6F,GAAP,OAAU+7J,QAAV,IAAUA,GAAV,UAAUA,EAAWhkI,YAArB,aAAU,EAAiBikI,uBAA3C,QAA8D1hE,EAAOt6F,GAAGyE,MACvF6jJ,EAAOz9H,GAAS0wI,EAAa,GAAD,OAAII,EAAJ,YAAkB37J,EAAlB,YAAuB47J,GAAcJ,GAClEviF,EAAc,OAAG9yE,QAAH,IAAGA,IAAH,UAAeokB,GAAUkxI,EAAQt8J,EAAI,KAArC,OAA2Cq8J,EAAW,GAAH,WAAYx7J,IACnF6qB,EAAMje,SAASnI,IAAWq3J,EAASv7J,KAAT,UAAiB04E,EAAjB,aAAoCx0E,GAApC,IAC1Bo3J,EAASt7J,QAAQ+nJ,EAClB,CACD,MAAO,CAACuT,EAAUC,EACnB,CACD,MAAO,CAAC,GAAI,GACb,CACF,CACD,MAAO,CAAC,CAACvmJ,GAAO,CAACgV,GAAUkxI,EAAQA,EAAQx6J,OAAS,KACrD,CASD,SAASg7J,EAAeE,EAAaD,GACnC,MAAML,EAAW,GACXO,EAAQ,GAad,OAZAD,EAAYvvJ,SAASyvJ,IAAgB,IAAD,EAClC,MAAMC,EAAe,IAAMD,EAAWpwJ,QAAQ,KAAM,IAE9CuvJ,EAAgH,KAArG,UAAA5nI,GAAmB0oI,EAAarwJ,QAAQ,kBAAmB,MAAQ,SAAU01B,UAA7E,eAA0F1gC,SACpGqnJ,EAAOz9H,GAAS0wI,EAAae,EAAcd,GAElDK,EAASt7J,QAASi7J,EAAW,CAAClT,GAASA,GACnC4T,GAEFE,EAAM77J,QAASi7J,EAAW,CAAC3wI,EAAM,IAAMA,EACxC,IAEIqxI,EAAY,CAACL,EAAUO,GAASP,CACxC,CAED,MAAOp9J,EAAG29J,GAASH,EAAewB,GAAQ,GACpCp/J,EAAI49J,EAAeuB,GAAQ,GAC3Bp0G,EAAS3qD,EAAEwC,OAUjB,SAASs7J,EAAUhnJ,GACjB,IAAIinJ,EAAS,GACTt7I,EAAO,GACPu7I,EAAY,GAahB,OAZIj1J,MAAMoR,QAAQrD,GAEhBA,EAAK3I,SAAS8vJ,IACZ,MAAOC,EAAOC,GAAaxB,EAAOsB,GAClCF,EAAOj8J,KAAKo8J,GACZz7I,EAAO07I,EACPH,EAAYC,EAAMxzJ,MAAM,IAAxB,MAGDszJ,EAAQt7I,GAAQk6I,EAAO7lJ,GACxBknJ,EAAYlnJ,EAAKrM,MAAM,MAElB,CAACszJ,EAAQt7I,EAAMu7I,EACvB,CAED,MAAMI,EAAS,GACTC,EAAU,GACVY,EAAe,GACrBr/J,EAAEuO,SAASzM,IACT,MAAOw9J,EAAS/e,EAAOgf,GAASrB,EAAUp8J,GACpC2rJ,EAASvhI,GAAUqzI,EAAMA,EAAM38J,OAAS,IAC9C47J,EAAOt8J,KAAKq+I,GACZke,EAAQv8J,KAAKurJ,GACb4R,EAAan9J,KAAKo9J,EAAlB,IAGF,MAAME,EAAWx/J,EAAE4C,OAAS,EAEtB+uB,EAAQm5B,GAAcC,EAAQ/1C,GAAOzU,KAAIsxB,IACtC,CAACxtB,KAAM,UACZwtB,KAAMA,MAQV,GANIiqH,EAAKnqH,OACPvxB,EAAEmO,SAAQ,CAACkkD,EAAG1vC,KACZkJ,gBAAM0F,EAAM5O,GAAQ+4H,EAAKnqH,MAAM5O,GAA/B,IAIAy8I,EAAU,CACZ,GAAIx/J,EAAE4C,SAAWxC,EAAEwC,OACjB,MAAM,IAAIg6J,GAAY,0DAExB,GAAI4B,EAAOh5J,MAAK1F,GAAQA,IAAS0+J,EAAO,KACtC,MAAM,IAAI5B,GAAY,8EAEzB,CAED,MAAMpmJ,EAAO,GACPkoJ,EAAS,GACTC,EAAU,GAChBv+J,EAAEmO,SAAQ,CAACkkD,EAAG1vC,KAAW,IAAD,EACtB,MAAO08I,EAAS7R,EAAO8R,GAASxB,EAAUzrG,GAE1C9gC,EAAM5O,GAAOqL,KAAb,UAAoBuD,EAAM5O,GAAOqL,YAAjC,QAA0CjlB,MAAMoR,QAAQk4C,GAAK,UAAY,QACzE,MAAMi7F,EAASxhI,GAAUwzI,EAAMA,EAAM98J,OAAS,IACxCivB,EAAO,CACXzrB,KAAM23J,EAAMh7I,GACZjhB,EAAG09J,EAAWH,EAAat8I,GAASs8I,EAAa,GACjD5sG,EAAGgtG,KACA9tI,EAAM5O,IAEXvM,EAAKtU,KAAK2vB,GACV6sI,EAAOx8J,KAAK0rJ,GACZ+Q,EAAQz8J,KAAKwrJ,EAAb,IAGF,MAAMzyD,EAAWl4E,IACf,MAAM8O,EAAOF,EAAM5O,GACnB,GAAI,SAAU8O,EAAM,CACU,IAAD,EAES,EAFpC,GAAkB,UAAdA,EAAKzD,KACP,MAAO,CAAC3Z,MAAK,UAAEod,EAAKA,YAAP,aAAE,EAAWpd,OACrB,GAAkB,YAAdod,EAAKzD,KACd,MAAO,CAAC3Z,MAAK,UAAEod,EAAK08H,cAAP,aAAE,EAAa95I,MAE/B,CACD,MAAO,CAACA,MAAO,UAAf,EAGIkrJ,GAAYjB,EAAOl5J,MAAK1F,GAAQA,IAAS4+J,EAAO,KAEhD7gH,EAAS,CACbujE,MAAO,CACL7vE,MAAOitH,EAAO,GAAP,UAAeC,EAAQ,GAAvB,aAA8BD,EAAO,GAArC,KAA6CC,EAAQ,GAC5Dj0G,YAAY,GAEd62D,MAAO,CACL9vE,MAAOouH,EAAYjB,EAAO,GAAP,UAAexyI,GAAUqlB,GAAzB,aAAoCmtH,EAAO,GAA3C,KAAmDxyI,GAAUqlB,GAAWmtH,EAAO,GAAP,UAAeC,EAAQ,GAAvB,aAA8BD,EAAO,GAArC,KAA6CC,EAAQ,GAChJiB,WAAYD,GAAY50G,EAAS,EAAIkwC,EAAS,QAAK92F,EACnDymD,UAAW+0G,GAAY50G,EAAS,EAAIkwC,EAAS,QAAK92F,GAEpD68G,WAAY2+C,GAAY50G,EAAS,EACjC2gD,OAAQ,CACN5pG,EAAG,EACH2wD,EAAG,EACH+yD,QAAS,UAyBb,OArBKm6C,GACHv/J,EAAEmO,SAAQ,CAACkkD,EAAG1vC,KACZ,MAAMtO,EAAQwmF,EAASl4E,GACnBA,EAAQ,IACV86B,EAAO,QAAD,OAAS96B,EAAQ,IAAO,CAC5BwuB,MAAOmtH,EAAO37I,GAAP,UAAmB47I,EAAQ57I,GAA3B,aAAsC27I,EAAO37I,GAA7C,KAAyD47I,EAAQ57I,GACxE88I,OAAkB,IAAV98I,EAAc,IAAM,OAC5B+8I,WAAY,IACZniE,KAAM56E,EAAQ,IAAM,EAAI,OAAS,QACjC68I,UAAW70G,EAAS,EAAIt2C,OAAQtQ,EAChCymD,SAAUG,EAAS,EAAIt2C,OAAQtQ,EAC/B8pC,SAAUlrB,EAAQ,IAAM,EAAI,GAAMA,EAAQ,EAAM,IAAOA,EAAQ,IAEjEvM,EAAKuM,GAAL,iBAA2BA,EAAQ,GACpC,IAID+4H,EAAKj+F,QACP5xB,gBAAM4xB,EAAQi+F,EAAKj+F,QAEd,CAACrnC,EAAMqnC,EAAd,GACC,CAACi+F,EAAKj+F,OAAQi+F,EAAKnqH,MAAOqnE,EAAOwjD,EAAOnvG,EAAS/J,EAAYtuB,EAAOu8B,EAAOnxB,IAE9E,OAAO,eAACxE,GAAA,EAAD,CAAKkrC,SAAU,IAAK5X,OAAQ,IAA5B,SACL,eAAC,GAAD,CACE14B,KAAMA,EACNqnC,OAAQA,EACR6gE,WAAYntE,EACZstE,cAAc,EACdnyG,OAAQovI,EAAKpvI,UAGlB,IAQcknE,WACZ/gE,GAAyB,gBAAfA,EAAMzM,KACbyM,EAAMG,QACN,mDAHS4gE,CAIbsrF,IChNK,MAAMxxC,GAAcryG,YAAK,CAC9BxO,IAAK,SACLyO,QAAS,CACP,UAAY,EACZ,kBAAoB,EACpB,gBAAkB,KAgDPykJ,OA5CQztJ,IAAMoI,MAAK,YAAgC,IAAR,IAAC3O,GAAM,EAC/D,MAAMsoB,EAAYnZ,mBAAQ,IAAM+X,GAAclnB,IAAM,CAACA,KAC/C,QAAC+mB,EAAD,SAAUyH,GAAYqJ,GAAiBvP,EAAUlB,cAAekB,EAAUvb,SAAS,EAAO,KAC1FzJ,EAAW81B,GAAY1S,IACvBoR,EAAYpJ,MACXulI,EAAeC,GAAoBnlJ,mBAAS,CAAC,GAC9ColJ,EAAiB7wJ,EAAWA,EAASi5B,4BAA8B,KAEzEttB,qBAAU,KACR,IAAK3L,EAAU,OACf,IAAI8wJ,GAAe,EAInB,OA0OJpiI,eAAoCvnB,EAAMnH,EAAUkrB,EAAUsJ,GAC5D,MAAM52B,EAAU,CAAC,EAEjB8wB,eAAeqP,EAAS52B,EAAM8sB,EAAY88H,EAAYC,GACpD,IAAI/gJ,EAAMgkB,EACV,UAAI9sB,QAAJ,IAAIA,KAAMqf,MAAO,CACf,MAAMA,EAAQrf,EAAKqf,MACnB,GAA2B,mCAAvBvW,EAAIkkB,gBAA8E,oDAAvBlkB,EAAIkkB,eAAsE,CACvI,MACM88H,EAAgB/rI,GAAuBsB,EADjC0E,EAASwF,WAAaxF,EAASmL,SAA/B,UAA6C73B,EAA7C,oBAAgE0sB,EAASwF,UAAzE,oBAA8FxF,EAASmL,eAAavhC,GAEhImb,QAAYukB,EAAUX,oBAAoBo9H,EAC3C,CACF,CAED,IAAK,MAAMzzJ,KAAO2J,EAAM,CAAC,IAAD,IACtB,MAAM+pJ,EAAQ,UAAGjhJ,SAAH,iBAAG,EAAKoW,mBAAR,aAAG,EAAmB7oB,GACpC,IAAK0zJ,EACH,SAGF,GAAY,eAAR1zJ,GAAgC,kBAARA,GAAmC,iBAARA,GAAkC,oBAARA,EAC/E,SAGF,KAAMA,KAAO2J,GACX,SAGF,MAAMsiB,EAAQtiB,EAAK3J,GAEnB,QAAc1I,IAAV20B,EACF,SAGF,MAAM0nI,EAA+B,wBAAR3zJ,EACvBqK,EAAOmpJ,EAAcG,EAAuBH,EAAH,UAAmBA,EAAnB,YAAiCxzJ,GAAzD,WAAsEA,GACvFzG,EAAOg6J,EAAU,UAAMA,EAAN,YAAoBG,EAASn6J,MAASm6J,EAASn6J,KAEhEnI,EAAQ66B,EACd,IAAI/nB,GAAoB,OAARwvJ,QAAQ,IAARA,OAAA,EAAAA,EAAU1qI,QAAS,GACd,kBAAV53B,GAAuBkL,MAAMoR,QAAQtc,IAAoB,OAAVA,IACxD8S,EAAS,UAAM9S,IAEjB,MAAMwiK,EAAevpJ,EAAKrM,MAAM,KAC1BqxC,EAAQukH,EAAa,IAAMA,EAAa,GAW9C,GAVAxzJ,EAAQ7G,GAAQ,CACdyG,IAAKzG,EACL0K,QAAS1K,EACT2K,UAAWA,EACXmrC,MAAOA,EACP1lC,KAAMA,EACN8I,IAAKihJ,EACLx0J,IAAKmL,GAGHqpJ,EAAS1qI,QAAUqQ,GAAgB,CACrC,MAAM5C,EAAai9H,EAAS5qI,YAC5B,GAAIxsB,MAAMoR,QAAQue,IAAUA,EAAMl2B,OAAS,GAAKk2B,EAAM,GACpD,GAAIA,EAAMl2B,OAAS,EACjB,IAAK,MAAOmgB,EAAO9kB,KAAU66B,EAAM/rB,gBAC3BqgC,EAASnvC,EAAOqlC,EAAYk9H,EAAoB,UAAMp6J,EAAN,YAAcnI,EAAMmI,MAASA,EAAMo6J,EAAoB,UAAMtpJ,EAAN,YAAcjZ,EAAMmI,MAApB,UAAgC8Q,EAAhC,YAAwC6L,eAGjJqqB,EAAStU,EAAM,GAAIwK,EAAYl9B,EAAM8Q,cAGvCk2B,EAAStU,EAAOwK,EAAYl9B,EAAM8Q,EAE3C,CACF,CACF,CAGD,aADMk2B,EAAS52B,EAAMnH,EAASi5B,4BAA6B,KAAM,MAC1D,IAAIrwB,SAAQ,CAACC,EAASC,KAC3BD,EAAQjL,EAAR,GAEH,CAzTGyzJ,CAAqB5tI,EAASzjB,EAAUkrB,EAAUsJ,GAAWxrB,MAAMpL,IACjEkzJ,GAAgBF,EAAiBhzJ,EAAjC,IAEK,KACLkzJ,GAAe,CAAf,CADF,GAGC,CAACrtI,EAASzjB,EAAUkrB,EAAUsJ,IAEjC,MAAM4xC,EAAUv6D,mBAAQ,IACjB4X,GAAYotI,EAGV9jD,GAAsBrwG,EAAK+mB,EAASotI,GAFlC,MAGR,CAACn0J,EAAK+mB,EAASotI,IAElB,OAAKzqF,EASH,eAAC,GAAD,CACEA,QAASA,EACTnkD,KAAM,eAAC,GAAD,CAAmB0uI,cAAeA,EAAexpJ,KAAMsc,MAVxD,IAaV,IAMM,MAAM6tI,GAAoBruJ,IAAMoI,MAAK,SAA2B7G,GACrE,MAAM,SAACirB,EAAD,kBAAWG,EAAX,YAA8BI,EAA9B,OAA2CC,GAAU+0E,MACpDusD,EAAiBC,GAAsB/lJ,oBAAS,IAChDssC,EAAU05G,GAAehmJ,oBAAS,GAEnC24B,EAAchyB,uBAAY,KAC9B4d,IAAc9mB,OAAM1F,IACI,OAAb,OAALA,QAAK,IAALA,OAAA,EAAAA,EAAOK,UACT2tJ,GAAmB,GACnBC,GAAY,GACb,GAJH,GAMC,CAACzhI,IAEE0hI,EAAet/I,uBAAY,KAC/B6d,IACAuhI,GAAmB,GACnBC,GAAY,EAAZ,GACC,CAACxhI,IAEJ,OAAO,gBAAC,IAAM3jB,SAAP,WACJmjB,GACC,eAACnqB,GAAA,EAAD,CACEyyC,UAAWnoB,GAAqBmoB,EAAU3yC,MAAM,UAChDI,QAAS4+B,EAFX,SAIE,eAACjC,GAAA,EAAD,CAASD,MAAM,aAAf,SACE,eAAC,KAAD,QAIN,gBAACL,GAAA,EAAD,CACE/8B,KAAMysJ,EACN,mBAAiB,2BAFnB,UAIE,eAACxvH,GAAA,EAAD,UACE,eAACwqE,GAAA,EAAD,4FAIF,gBAACvqE,GAAA,EAAD,WACE,eAAC3zB,GAAA,EAAD,CAAQ7I,QAAS,IAAMgsJ,GAAmB,GAA1C,gBACA,eAACnjJ,GAAA,EAAD,CAAQ7I,QAASksJ,EAAcllD,WAAS,EAAxC,4BAIP,IAEYmlD,GAAsB1uJ,IAAMoI,MAAK,SAA6B7G,GACzE,MAAM,OAACyrB,GAAU+0E,KAEjB,OAAO,eAAC,IAAM14F,SAAP,UACL,eAAChH,GAAA,EAAD,CACEF,MAAM,UACNI,QAASyqB,EAFX,SAIE,eAACkS,GAAA,EAAD,CAASD,MAAM,iBAAf,SACE,eAAC,KAAD,SAIP,IAEKr0B,GAAYC,cAAWnI,IACpB,CACLw+D,UAAW,CACTr3D,WAAY,SACZo3B,SAAU,UAEZsuF,UAAW,CACT5yF,MAAO,IACP7yB,YAAapH,EAAMkH,QAAQ,QAK3B+kJ,GAAoB3uJ,IAAMoI,MAAK,YAAmD,IAAD,MAAvB,cAACslJ,EAAD,KAAgBxpJ,GAAO,EACrF,MAAMzB,EAASmI,MACRxQ,EAAQw0J,GAAaz0G,YAAeihE,IACrCn6D,EAAUW,eACV,IAAEnoD,GAAQ8pE,cAEVsrF,EAAqBluH,IACzB,MAAMmuH,EAAU,CAAC,CAACnuH,EAAMlnB,OAAO3lB,MAAO6sC,EAAMlnB,OAAOqpB,SAC/CgsH,EAAQC,iBACVD,EAAQE,gBAAkBF,EAAQC,iBACzBD,EAAQE,iBACjBF,EAAQC,kBAAoBD,EAAQE,gBAEtCJ,EAAU,IAAIx0J,KAAW00J,GAAzB,EAGItoJ,EAAO,OAAGtC,QAAH,IAAGA,GAAH,UAAGA,EAAM+jB,gBAAT,aAAG,EAAgBmL,SAE1BmkC,EAAepoD,uBAAavK,IAC5BA,GACFq8C,EAAQrxD,KAAK6J,EAAMmL,EACpB,GACA,CAACq8C,EAASxnD,IAEb,OACE,eAAC6P,GAAA,EAAD,CAAK0yB,aAAc,IAAKryB,QAAS,EAAjC,SACE,gBAACslJ,GAAA,EAAD,CAAW79J,KAAG,EAAC4Q,UAAWS,EAAOy+D,UAAjC,UACE,eAAC,GAAD,CACEvmE,QAAS+yJ,EACT3qH,SAAUw0B,EACVv1D,UAAWS,EAAO8sH,UAClB3lF,OAAK,IAEP,eAACtgC,GAAA,EAAD,CAAKm8B,SAAU,IACf,eAACvG,GAAA,EAAD,CAASD,MAAM,6CAAf,SACE,eAACgX,GAAA,EAAD,CACEC,QACE,eAACtT,GAAA,EAAD,CACEE,QAAS1oC,EAAO20J,iBAChBhsH,SAAU8rH,EACV/6J,KAAK,qBAGT0B,MAAM,oBAGV,eAAC0pC,GAAA,EAAD,CAASD,MAAM,yFAAf,SACE,eAACgX,GAAA,EAAD,CACEC,QACE,eAACtT,GAAA,EAAD,CACEE,QAAS1oC,EAAO40J,eAChBjsH,SAAU8rH,EACV/6J,KAAK,mBAGT0B,MAAM,kBAGV,eAAC0pC,GAAA,EAAD,CAASD,MAAM,0DAAf,SACE,eAACgX,GAAA,EAAD,CACEC,QACE,eAACtT,GAAA,EAAD,CACEE,QAAS1oC,EAAOihH,SAChBt4E,SAAU8rH,EACV/6J,KAAK,aAET0B,MAAM,qBAGTgR,GAAW,eAAC,GAAD,CACVzH,QAAQ,uBACRtF,IAAG,kBAAa+M,EAAb,2CACHuc,UAAW1gB,KAHD,SAKV,eAAC,KAAD,MAEF,eAAC,GAAD,CAAuBk7B,SAAS,KAAKs4B,WAAS,EAA9C,SACE,eAAC8jD,GAAD,MAEF,eAAC,GAAD,IACA,eAAC,GAAD,QAIP,IAMYu1C,GAAwBlvJ,IAAMoI,MAAM7G,IAC/C,MAAM,SAACqe,EAAD,SAAWqI,EAAX,OAAqB+E,GAAU+0E,MAC/B,IAACx9F,GAAO0E,MACR,WAAC9I,GAAcmD,KAEf69B,EAAchyB,uBAAai5F,IAC/B,MAAM9hG,EAAQnD,SAASqY,cAAc,SACrClV,EAAMvU,KAAO,OACbuU,EAAM6oJ,SAAYxuH,IAChB,MAAMohC,EAAOphC,EAAMlnB,OAAO2uF,MAAM,GAChC,IAAKrmC,EACH,OAEF,MAAMsmC,EAAW,IAAIC,SACrBD,EAASj+F,IAAI,OAAQ23D,EAAM95C,EAASzN,YACpCjW,EAAIwC,IAAJ,kBAAmB6Y,EAAnB,kCAA6DyoF,GAC1DtiG,MAAK,KACJinB,GAAQ,IAET/mB,MAAM9F,EAJT,EAOFmG,EAAMke,OAAN,GACC,CAACjgB,EAAD,OAAM0jB,QAAN,IAAMA,OAAN,EAAMA,EAAUzN,WAAYra,EAAY6sB,EAAQpN,IAEnD,OAAO,eAACvd,GAAA,EAAD,CAAYE,QAAS4+B,EAArB,SACL,eAACjC,GAAA,EAAD,CAASD,MAAM,gCAAf,SACE,eAAC,KAAD,OAFJ,IAOK,SAAS6qE,GAAsBslD,EAAgBC,EAAgBzB,GACpE,OAAO,IAAI0B,GAAeF,EAAgBC,EAAgBzB,EAC3D,CAgFD,MAAM2B,WAAuBltF,GAM3BziE,YAAY4vJ,EAAQt4J,EAAK8V,EAAKqrB,EAAUo3H,GAItC,GAHA3vJ,QACAhP,KAAK0+J,OAASA,EACd1+J,KAAK4+J,aAAe/uI,GAAc6uI,IAC7B1+J,KAAK4+J,aAAa5uI,WAAY,MAAM,IAAIlwB,MAAJ,wCAA2C4+J,IACpF,GAAI1+J,KAAK4+J,aAAa39J,OAASquB,GAAQI,QAAS,MAAM,IAAI5vB,MAAJ,gDAAmD4+J,IAEzG1+J,KAAKyT,SAAM1S,EACXf,KAAKygC,eAAY1/B,EACjBf,KAAK6+J,qBAAkB99J,EACvBf,KAAK2+J,aAAsB59J,IAAZ49J,GAAyBziJ,EAAIuW,QAAUmQ,GAActJ,GAAWpd,GAAOyiJ,EACtF3+J,KAAKoG,IAAMA,EACXpG,KAAKkc,IAAMA,EACXlc,KAAKunC,SAAWA,EAChBvnC,KAAK8+J,cAAgB,CAAC,CACvB,CAEe,iBAACrrJ,EAAKgtB,GACpBzgC,KAAKyT,IAAMA,EACXzT,KAAKygC,UAAYA,EACjB,MAAM,SAAC/E,SAAkB+E,EAAUrE,cACjCp8B,KAAK4+J,aAAa7uI,cAAe/vB,KAAK4+J,aAAalpJ,SAAS,EAAO,KACrE1V,KAAK6+J,gBAAkBnjI,CACxB,CAEmB,qBAACgjI,EAAQt4J,EAAKmhC,GAChC,IAAIrrB,EAAMqrB,EAKV,GAJIA,EAAS9U,QAAUqQ,KACrB5mB,EAAMqrB,EAAShV,aAGbnsB,EAAIqsB,QAAUkQ,GAAa,CAG7B,OAAOo8H,UADgB/+J,KAAKygC,UAAUpC,iBAAiBqgI,IAChBr7H,MAAMnM,YAC9C,CAED,GAAIhb,EAAIuW,QAAUmQ,GAAa,CAC7B,GAAIx8B,EAAIqsB,MAAO,CAGb,MACMusI,EAAYjuI,GADN3qB,EAAI64J,SAAJ,UAAkB74J,EAAIqsB,MAAtB,YAA+BrsB,EAAI64J,UAAa74J,EAAIqsB,MACzBisI,GACvCxiJ,QAAYlc,KAAKygC,UAAUX,oBAAoBk/H,EAChD,CACD,MAAML,EAAU3+J,KAAK2+J,SAAWrlI,GAAWpd,GAC3C,OAAO,IAAIsiJ,GAAeE,EAAQt4J,EAAK8V,EAAKqrB,EAAUo3H,EACvD,CAED,GAAIziJ,EAAIuW,QAAUoQ,GAChB,MAA2B,cAAvB3mB,EAAIjb,KAAKsrB,UAGJ,IAAI2yI,GAA2BR,EAAQt4J,EAAK8V,GAG9C,IAAIijJ,GAAgBT,EAAQt4J,EAAK8V,GAG1C,GAAIA,EAAIuW,QAAUuQ,GAChB,OAAO,IAAIo8H,GAAiBV,EAAQt4J,EAAK8V,GAG3C,MAAM,IAAIpc,MAAM,kBACjB,CAEgB,kBAAC2J,GAChB,GAAY,cAARA,EACF,OAAOs1J,GAAuB/+J,KAAKkc,KAGrC,GAAY,wBAARzS,EACF,OAAOs1J,GAAuB/+J,KAAKunC,UAGrC,GAAI99B,EAAIoG,WAAW,iBAAkB,CACnC,MAAMuiB,EAAMpyB,KAAK8+J,cAAcr1J,GAC/B,IAAK2oB,EAAK,OAAO,KAEjB,MAAMitI,EAASztI,GAAennB,EAAS2nB,EAAIuK,UAAWvK,EAAIkQ,WACpD,QAAC5S,SAAiB1vB,KAAKygC,UAAUrE,cAAc3xB,EAAS2nB,EAAIkQ,UAAU,EAAO,KAE7Ew6H,SADiB98J,KAAKygC,UAAUpC,iBAAiBhP,KACvB6V,4BAChC,OAAOllC,KAAKs/J,eAAeD,EAAQ3vI,EAASotI,EAC7C,CAED,MAAM,IAAIh9J,MAAM,mBACjB,EAGH,MAAM0+J,WAAuBC,GACV,kBAACh1J,GAChB,IAAKzG,EAAM2c,GAASlW,EAAIhC,MAAM,KAC1BuxH,EAAYr5G,EAAK,UAAM3c,EAAN,YAAc2c,GAAU3c,EAC7C,MAAMukC,EAAWvnC,KAAKkc,IAAIoW,YAAYtvB,IAAmB,iBAATA,GAA2BhD,KAAKkc,IAAIinB,WAAWvG,MAAK2iI,GAAQA,EAAKv8J,OAAS2c,IAC1H,IAAI9kB,OAA2BkG,IAAnBf,KAAKoG,IAAIpD,IAA0C,OAAnBhD,KAAKoG,IAAIpD,GAAzC,OAA0DukC,QAA1D,IAA0DA,OAA1D,EAA0DA,EAAUrvB,QAAUlY,KAAKoG,IAAIpD,GACnG,MAAMw8J,EAAa7/I,EAOnB,GANAA,EAAQ+S,SAAS/S,GACjBA,EAAQ8R,gBAAM9R,GAAS6/I,EAAa7/I,EAChCA,EAAQ,IAAGA,GAAgB9kB,EAAM2E,QACjC+nC,EAAS9U,QAAUoQ,IAAgBI,GAAwBsE,KAC7D1sC,EAAQA,EAAM8kB,IAEX4nB,EAEE,IAAIA,EAAS9U,QAAUqQ,GAAgB,CAC5C,IAAI28H,EACAC,GAAmB,EAcvB,OAbIn4H,EAAS/U,SACXktI,EAAkB//I,GAAS,EAC3B8/I,QAA0Bz/J,KAAKs/J,eAC7BztI,GAAc7xB,KAAK4+J,aAAN,UAAuB57J,EAAvB,YAA+B08J,IAAoB7kK,EAAM6kK,GAAkBn4H,IAE1Fk4H,QAA0Bz/J,KAAKs/J,eAC7BztI,GAAc7xB,KAAK4+J,aAAc57J,GAAOnI,EAAO0sC,GAEnDk4H,EAAkBE,eAAiB,CACjC7gI,OAAQ9+B,KAAKoG,IACb+jC,cAAe5C,EACfm4H,gBAAiBA,GAEZD,CACR,CAAM,GAAIl4H,EAAS9U,QAAUoQ,GAAc,CAAC,IAAD,EAE1C,GAAI8F,GAAYpB,GAAW,CACzB,IAAImC,EAAY,KAChB,GAA8B,IAA1BnC,EAASmB,MAAMlpC,OACjBkqC,EAAY7uC,EACZm+H,EAAYh2H,OACP,GAA8B,IAA1BukC,EAASmB,MAAMlpC,OAAc,CACtC,MAAMogK,EAAWn2J,EAAIhC,MAAM,KAAK,GAC1BkY,EAAQ+S,SAASktI,GACvBl2H,EAAY7uC,EAAM8kB,GAClBq5G,EAAS,UAAMh2H,EAAN,YAAc2c,EACxB,CACD,IAAK+pB,EACH,OAAO1pC,KAAKs/J,eACVztI,GAAc7xB,KAAK4+J,aAAc5lC,GAAYn+H,EAAO0sC,GAExD,IACE,MAAMoC,EAAc5Y,GAAgB2Y,EAAW1pC,KAAK4+J,cACpD,GAAIj1H,EAAY1oC,OAASquB,GAAQI,QAAS,CACxC,MAAM,QAACA,SAAiB1vB,KAAKygC,UAAUrE,cAAcuN,EAAY5Z,cAAe4Z,EAAYj0B,SAAS,EAAO,KACtGmqJ,EAAc1tI,GAAmB,KAAOwX,EAAY71B,MAAQ,IAAK4b,GACvE,IAAIowI,EACJ,GAAID,EAAYptI,MAEdqtI,EAAcv4H,EAAStmC,KAAK4nC,0BACvB,CACL,MAAM58B,QAAiBjM,KAAKygC,UAAUpC,iBAAiBhP,IACvD,IACEywI,EAAc7zJ,EAASi5B,4BACvB,IAAK,MAAMnS,KAAQ4W,EAAY71B,KAAKrM,MAAM,KACpCsrB,EAAKtC,MAAM,YAAuB,KAATsC,IAC7B+sI,EAAcA,EAAYxtI,YAAYS,GAClC+sI,EAAYvtI,cAAautI,EAAcA,EAAYvtI,aAI1D,CAFC,MACAutI,EAAcv4H,EAAStmC,KAAK4nC,qBAC7B,CACF,CACD,OAAO7oC,KAAKs/J,eAAe31H,EAAak2H,EAAaC,EACtD,CACD,MAAM,IAAIhgK,MAAM,2BAMjB,CALC,MAAO2P,GAGP,OAAOzP,KAAKs/J,eACVztI,GAAc7xB,KAAK4+J,aAAc5lC,GAAYtvF,EAAWnC,EAC3D,CACF,CAED,aAAIA,EAASnR,qBAAb,OAAI,EAAwBogF,SACwB,mBAA9CjvE,EAASnR,cAAcogF,QAAQ,GAAGnkC,QAA8B,CAClE,MAGMmiC,EAAYjjF,GAHIvxB,KAAK4+J,aAAa7uI,cACvB/vB,KAAK4+J,aAAa9vI,SACtB9uB,KAAKoG,IAAImhC,EAASvkC,MACkC2c,GACjE,OAAO,IAAIy1F,GAAeZ,EAAW,MAAM,EAC5C,CAEH,OAAOx0G,KAAKs/J,eAAeztI,GAAc7xB,KAAK4+J,aAAc5lC,GAAYn+H,EAAO0sC,EAChF,CAA6C,IAAD,EAAtC,GAAIA,EAAS9U,QAAUuQ,GAC5B,OAAOhjC,KAAKs/J,eACVztI,GAAc7xB,KAAK4+J,aAAN,uBAAoCj/I,IAD5C,UAEL3f,KAAKoG,WAFA,aAEL,EAAU8tE,aAAav0D,GACvB4nB,GAEF,MAAM,IAAIznC,MAAM,mCACjB,CArFC,OAAOkP,MAAM0iE,YAAYjoE,EAsF5B,CAED6G,SACE,OAAO,eAACyvJ,GAAD,CACL91H,QAASjqC,KAAKoG,IACd8V,IAAKlc,KAAKkc,IACVqrB,SAAUvnC,KAAKunC,SACfo4H,eAAgB3/J,KAAK2/J,eACrBK,eAAgBhgK,KAAK2+J,QACrBsB,kBAAmBjgK,KAAK6+J,iBAAmB7+J,KAAK2+J,SAEnD,EAGH,MAAMO,WAAmCT,GACvCnuJ,SACE,OAAO,eAAC4vJ,GAAD,CAAqBrlK,MAAOmF,KAAKoG,IAAK8V,IAAKlc,KAAKkc,KACxD,EAGH,MAAMijJ,WAAwBV,GACX,kBAACh1J,GAAM,IAAD,IACrB,MAAMq9B,EAAS,UAAG9mC,KAAKkc,WAAR,iBAAG,EAAUinB,kBAAb,aAAG,EAAsBvG,MAAK2iI,GAAQA,EAAKv8J,OAASyG,IACnE,GAAIq9B,EAAW,CAAC,IAAD,IACb,MAAMjsC,EAAK,UAAGmF,KAAKoG,WAAR,iBAAG,EAAU8tE,oBAAb,aAAG,EAAyBzqE,GACvC,aAAazJ,KAAKs/J,eAChBztI,GAAc7xB,KAAK4+J,aAAN,uBAAoCn1J,IACjD5O,EACAisC,EACH,CAED,OAAO93B,MAAM0iE,YAAYjoE,EAC1B,CAED6G,SACE,OAAI2yB,GAAwBjjC,KAAKkc,KACxB,eAACikJ,GAAD,CAAqBtlK,MAAOmF,KAAKoG,IAAK8V,IAAKlc,KAAKkc,MAEhD,eAAC,GAAD,CAAUrhB,MAAOmF,KAAKoG,IAAK8V,IAAKlc,KAAKkc,KAE/C,EAGH,MAAMkjJ,WAAyBX,GAC7BnuJ,SACE,OAAO,eAAC8vJ,GAAD,CAAWvlK,MAAOmF,KAAKoG,IAAK8V,IAAKlc,KAAKkc,KAC9C,EAGH,MAAMmkJ,GAAsB,CAACC,EAAMC,IAC1Bx6J,MAAMoR,QAAQmpJ,GACjBA,EAAKnjK,KAAI,CAACyI,EAAGlI,IAAM2iK,GAAoBz6J,EAAG26J,EAAK7iK,MAC/CkuB,cAAO40I,cAAQF,EAAMC,GAAO,CAACE,SAAU,OAAQ9a,UAAW,EAAG+a,UAAW,IAAKC,SAAU,MAGtF,SAASC,GAAT,GAA4C,IAAD,gBAAd,MAAC/lK,EAAD,IAAQqhB,GAAM,EAChD,MAAM82C,EAAcs5D,GAAepwG,GAEnC,GAAIysB,GAAYzsB,GACd,OAAO,eAAC1D,GAAA,EAAD,CAAKyZ,UAAU,OAAO6lD,UAAU,SAAhC,SACL,eAACp/D,GAAA,EAAD,CAAYuZ,UAAU,OAAtB,6BAGJ,GAAsD,eAAlD,UAAA/V,EAAIka,qBAAJ,mBAAmBogF,eAAnB,mBAA6B,UAA7B,eAAiCqqD,eAA2E,0BAA3C,UAAA3kJ,EAAIka,qBAAJ,mBAAmBC,WAAnB,mBAAyB,UAAzB,eAA6BpE,WAChG,OAAO,eAACzZ,GAAA,EAAD,CAAKyZ,UAAU,OAAOoa,WAAW,SAASyrC,UAAU,SAApD,SACL,eAACp/D,GAAA,EAAD,CAAYuZ,UAAU,OAAtB,yBAGJ,GAA2B,kCAAvB/V,EAAIjb,KAAKqrB,WAAwE,kCAAvBpQ,EAAIjb,KAAKqrB,UACrE,OAAO,eAAC9T,GAAA,EAAD,CAAKyZ,UAAU,OAAOoa,WAAW,SAASyrC,UAAU,SAApD,SACL,eAACp/D,GAAA,EAAD,CAAYuZ,UAAU,OAAtB,yBAGJ,GAA2B,qCAAvB/V,EAAIjb,KAAKqrB,WAA2E,uCAAvBpQ,EAAIjb,KAAKqrB,UACxE,OAAO,eAAC9T,GAAA,EAAD,CAAKyZ,UAAU,OAAO6lD,UAAU,SAAhC,SACL,eAACp/D,GAAA,EAAD,CAAYuZ,UAAU,OAAtB,0BAGJ,GAAI/V,EAAIwsB,MAAMlpC,OAAS,EAAG,CACxB,MAAM8hB,EAAa,GACnB,IAAIw/I,EAAY,UAChB,IACE,IAAIp5I,EAAU7sB,EAAMkmK,IAAMlmK,EAAMmmK,IAAMnmK,EACtC,IAAK,IAAI6C,EAAI,EAAGA,EAAIwe,EAAIwsB,MAAMlpC,OAAQ9B,IACpC4jB,EAAWxiB,KAAK4oB,EAAQloB,QACxBkoB,EAAUA,EAAQ,GAEO,WAAvBxL,EAAIjb,KAAKsrB,UACXu0I,EAAY,OACc,kBAAVjmK,GAChBimK,EAAY,aACZx/I,EAAW9hB,OAAS,GAGlBshK,EADwB,IAAtBx/I,EAAW9hB,OACD,SACmB,IAAtB8hB,EAAW9hB,OACR,SAEA,QAKjB,CAFC,MAAOwT,GACPhD,QAAQP,MAAM,6CAA8CuD,EAC7D,CACD,OAAO,eAACwF,GAAA,EAAD,CAAKyZ,UAAU,OAAOoa,WAAW,SAASyrC,UAAU,SAApD,SACL,gBAACp/D,GAAA,EAAD,CAAYuZ,UAAU,OAAtB,UACG3Q,EAAWnkB,KAAI,CAACif,EAAWuD,IAC1B,kCACGA,EAAQ,GAAK,iDAAkCzP,OAAOkM,KAD9CuD,KAFf,OAKYmhJ,MAGf,CAAM,CAAC,IAAD,IACL,IAAI7nF,EAYJ,OAVEA,EADyB,sCAAvB/8D,EAAIjb,KAAKqrB,WAA4E,sCAAvBpQ,EAAIjb,KAAKqrB,UAC5DX,GAAgB9wB,GACxB,WAAI,EAAAqhB,EAAIjb,KAAKqrB,WAAUzc,kBAAvB,OAAI,SAAgC,WAC5BwwJ,GAAoBxlK,EAAMkmK,GAAIlmK,EAAMmmK,IAEpCnmK,EAGXm4D,IACFimB,EAAa,IAAI+B,GAAE/B,EAAY/8D,EAAIxf,MAAMuoB,GAAG+tC,GAAan4D,SAEpD,gBAAC2d,GAAA,EAAD,CAAKyZ,UAAU,OAAOoa,WAAW,SAAjC,UACL,eAAC,GAAD,CAAQpa,UAAU,OAAO7X,QAAQ,QAAQvf,MAAOo+E,EAAYv/D,IAAK,IAChEs5C,GAAe,gBAACt6C,GAAA,EAAD,CAAYuZ,UAAU,OAAtB,iBAAoC+gC,EAAYtuD,aAEnE,CACF,CAOM,MAAMu8J,GAAgB/xJ,IAAMoI,MAAK,YAAsC,IAAD,oBAAd,MAACzc,EAAD,IAAQqhB,GAAM,EAC3E,MAAM,SAAC4S,GAAYmiF,MAAmB,CAAC,EACjCj+C,EAAcs5D,GAAepwG,GAE7BglJ,EAAiB7iJ,uBAAYxjB,IAAU,IAAD,IAC1C,IAAIo+E,EAQAjrB,EACJ,GAPEirB,EADyB,sCAAvB/8D,EAAIjb,KAAKqrB,WAA4E,sCAAvBpQ,EAAIjb,KAAKqrB,UAC5DX,GAAgB9wB,GACxB,WAAI,EAAAqhB,EAAIjb,KAAKqrB,WAAUzc,kBAAvB,OAAI,SAAgC,WAC5BwwJ,GAAoBxlK,EAAMkmK,GAAIlmK,EAAMmmK,IAEpCnmK,EAGXqhB,EAAIxf,MAA8B,kBAAfu8E,EAAyB,CAC9C,MAAMkoF,EAAc,IAAInmF,GAAE/B,EAAY/8D,EAAIxf,MAAMuoB,GAAG+tC,GACnDimB,EAAakoF,EAAYtmK,QACzBmzD,EAAYmzG,EAAYz8J,OACzB,CACD,MAAO,CAACu0E,EAAYjrB,EAApB,GACC,CAAC9xC,EAAK82C,IAGT,IAD4C,UAAvB92C,EAAIjb,KAAKsrB,WAAgD,WAAvBrQ,EAAIjb,KAAKsrB,YAA4C,kBAAV1xB,EACjF,CACf,MAAOo+E,EAAYjrB,GAAakzG,EAAermK,GAC/C,OAAIqhB,EAAIwsB,MAAMlpC,OAAS,EACd,gBAACgZ,GAAA,EAAD,CAAK2zB,UAAU,SAAf,UACL,eAAC2tE,GAAD,CACE9uG,OAAQiuE,EACRvwC,MAAOxsB,EAAIwsB,MACXivD,OAA6B,IAArBz7E,EAAIwsB,MAAMlpC,OAClByB,KAAMib,EAAIjb,KAAKqrB,WAJjB,iBAKiBpQ,EAAIlZ,OAErB,gBAAC0V,GAAA,EAAD,CAAYm1C,QAAM,EAACzzC,QAAQ,UAA3B,cACI8B,EAAIwsB,MAAMvrC,KAAI,CAACif,EAAWuD,IAAU,kCACnCA,EAAQ,GAAK,iDAAkCzP,OAAOkM,KADRuD,KADnD,OAKCquC,GAAa,eAACt1C,GAAA,EAAD,CAAYm1C,QAAM,EAAlB,SAAoBG,OAG7B,eAAC,GAAD,CAAQnzD,MAAOo+E,EAAYv/D,IAAK,GAAIU,QAAQ,QAAQ1d,KAAMsxD,GAEpE,CAAM,GAAsD,eAAlD,UAAA9xC,EAAIka,qBAAJ,mBAAmBogF,eAAnB,mBAA6B,UAA7B,eAAiCqqD,eAA2E,0BAA3C,UAAA3kJ,EAAIka,qBAAJ,mBAAmBC,WAAnB,mBAAyB,UAAzB,eAA6BpE,WAAsC,CAC7I,MAAM49C,EAAOwjD,KAAUC,SAASz4H,GAChC,OAAO,sBAAKumK,wBAAyB,CAACC,OAAQxxF,IAC/C,CAAM,GAA4B,mCAAxB,UAAA3zD,EAAIjb,YAAJ,eAAUqrB,YAAyE,mCAAxB,UAAApQ,EAAIjb,YAAJ,eAAUqrB,WAC9E,OAAO,eAAC,KAAD,CACLtpB,KAAK,QACLurG,IAAK1zG,EACL6zG,iBAAiB,EACjB93B,UAAW,EACX+3B,mBAAmB,IAEf,IAAD,YACL,cAAI,EAAAzyF,EAAIjb,KAAKqrB,WAAUzc,kBAAvB,OAAI,SAAgC,WAGlC,OAFAhV,EAAQwlK,GAAoBxlK,EAAMkmK,GAAIlmK,EAAMmmK,IAErCj7J,MAAMoR,QAAQtc,GACjB,qBAAIuW,MAAO,CAACqH,OAAQ,GAApB,SACC5d,EAAMsC,KAAI,CAACtC,EAAO8kB,IAAU,8BAAgB,eAACjH,GAAA,EAAD,UAAa7d,KAApB8kB,OAEtC,eAACjH,GAAA,EAAD,UAAa7d,IACZ,GAAIkL,MAAMoR,QAAQtc,GACvB,OAAO,qBAAIuW,MAAO,CAACqH,OAAQ,GAApB,SACJ5d,EAAMsC,KAAI,CAACtC,EAAO8kB,KACjB,MAAOs5D,GAAcioF,EAAermK,GACpC,OAAO,8BACL,eAAC6d,GAAA,EAAD,UAAmC,kBAAfugE,EAA0B5yE,KAAKE,UAAU0yE,GAAhD,OAA8DA,QAA9D,IAA8DA,OAA9D,EAA8DA,EAAYxqE,cADzEkR,EAAhB,MAKC,GAA4B,sCAAxB,UAAAzD,EAAIjb,YAAJ,eAAUqrB,YAA4E,wCAAxB,UAAApQ,EAAIjb,YAAJ,eAAUqrB,WAAoD,CACrI,MAAMg1I,EAASzmK,EAAM41B,MAAM,kFACrB8wI,EAAaD,EAAOhlH,OAAOxtB,UAAYA,EACvC0yI,EAAWF,EAAOhlH,OAAO5zB,SAAW44I,EAAOhlH,OAAOjpB,SAASzR,SAAS,OAAS,MAAQ,WAC3F,OAAO,eAAC60D,GAAD,CAAatoC,MAAM,OAAnB,SACL,eAAC,GAAD,CAAOxR,UAAW4kI,EAAYluI,SAAUiuI,EAAOhlH,OAAOjpB,SAAUs9C,YAAa2wF,EAAOhlH,OAAOxoC,KAAM4U,OAAQ84I,EAAU5wF,aAAa,KAEnI,CAAM,GAA6B,YAAtB,OAAH10D,QAAG,IAAHA,GAAA,UAAAA,EAAKjb,YAAL,eAAWsrB,YAAmD,gCAAtB,OAAHrQ,QAAG,IAAHA,GAAA,UAAAA,EAAKjb,YAAL,eAAWqrB,WACzD,OAAO,eAAC,GAAD,CAAOzxB,MAAOA,EAAOqhB,IAAKA,IAC5B,CACL,MAAO+8D,GAAcioF,EAAermK,GACpC,OAAO,eAAC6d,GAAA,EAAD,UAAmC,kBAAfugE,EAA0B5yE,KAAKE,UAAU0yE,GAAhD,OAA8DA,QAA9D,IAA8DA,OAA9D,EAA8DA,EAAYxqE,YAC/F,CAEJ,IAOKgzJ,GAAqBvyJ,IAAMoI,MAAK,YAAmD,IAAvB,IAAC4E,EAAD,QAAM+tB,EAAN,KAAe4pC,GAAO,EACtF,MAAMpzC,EAAYpJ,KACZm/E,EAAU/jG,qBAAWm/D,IACrB8vF,EAAgClqI,iBAAO,CAACtb,KAAQukB,EAAUR,yBAAyB/jB,KAEnFylJ,EAA4B7pJ,mBAAQ,IACjC,CAACoE,KAAQukB,EAAUR,yBAAyB/jB,KAClD,CAACukB,EAAWvkB,IAET0lJ,EAAoBvjJ,uBAAanC,GAC9BqjB,GAAqBrjB,EAAK,CAAC6T,cAAetlB,IAAU,IAC1D,IAEGo3J,EAAgB/pJ,mBAAQ,IACuC,IAA/DpO,OAAOK,KAAKkgC,GAASjgC,QAAOP,GAAe,UAARA,IAAiBjK,OAC/CkiK,EAA8Bh6I,QAE9Bi6I,GAER,CAACD,EAA+BC,EAA2B13H,IAExD63H,EAAgBhqJ,mBAAQ,IACrB+pJ,EAAcriK,OAAS,GAC7B,CAACqiK,IAEEE,EAAiC1jJ,uBAAarL,KACiB,IAA/DtJ,OAAOK,KAAKkgC,GAASjgC,QAAOP,GAAe,UAARA,IAAiBjK,QACjDmiK,EAA0BphK,SAASyS,EAAE2V,OAAO9tB,UAKnDovC,EAAQxX,MAAQzf,EAAE2V,OAAO9tB,MACzB27G,EAAQriC,yBAAyBN,EAAKl0D,OAAtC,GACC,CAACsqB,EAASusE,EAAS3iC,EAAM8tF,IAE5B,OAAKG,EAKH,eAACtpJ,GAAA,EAAD,CAAKwpJ,GAAI,CAACt+G,SAAU,KAApB,SACE,gBAACoF,GAAA,EAAD,CAAaic,WAAS,EAAtB,UACE,eAACk9F,GAAA,EAAD,uDACA,eAAChgG,GAAA,EAAD,CACEpnE,MAAO+mK,EAAkB1lJ,GACzB9B,QAAQ,SACR1V,MAAM,mBACN,mCAA2BwX,EAAIlZ,MAC/BivC,SAAU8vH,EACVvwJ,KAAK,QACL21F,QAAM,EAPR,SASG06D,EAAc1kK,KAAI,CAACuiC,EAAmBhiC,KACrC,MAAMw5E,EAAe0qF,EAAkBliI,GACvC,OACE,eAACulB,GAAA,EAAD,CAAkBpqD,MAAOq8E,EAAzB,SACGx3C,EAAkB18B,MADNtF,EADjB,WAlBD,IA4BV,IAOM,SAAS66J,GAAwBr4H,GAAa,IAAD,cAClD,MAAM86F,EAAU,OAAG96F,QAAH,IAAGA,GAAH,UAAGA,EAAY9J,qBAAf,iBAAG,EAA2BC,WAA9B,iBAAG,EAAiC,UAApC,aAAG,EAAqC2kG,WAClDknC,GAAiB,OAAVhiI,QAAU,IAAVA,GAAA,UAAAA,EAAY9J,qBAAZ,mBAA2BC,WAA3B,mBAAiC,UAAjC,eAAqC6rI,OAAQ,GACpDC,EAAa,UAAGjiI,EAAWoI,sBAAd,aAAG,EAA2BnrC,KAAIoqC,GAAYA,EAASvkC,OACpE+iD,EAAUtxB,GAAU,OAACumG,QAAD,IAACA,OAAD,EAACA,EAAYj1E,QAASo8G,GAC1CzmI,EAAWjH,GAAU,OAACumG,QAAD,IAACA,OAAD,EAACA,EAAYt/F,SAAUymI,GAClD,IAAIC,EAAqBliI,EAAWoI,eACpC85H,EAAqBA,EAAmBp4J,QAAOu9B,GAAYwe,EAAQxlD,SAASgnC,EAASvkC,QACrFo/J,EAAqBA,EAAmBp4J,QAAOu9B,IAAa26H,EAAK3hK,SAASgnC,EAASvkC,QACnF,MAAM+1B,GAAkB,OAAViiG,QAAU,IAAVA,OAAA,EAAAA,EAAYjiG,QAAS,GAC7BspI,EAAoBD,EAAmBjlK,KAAIoqC,IAAQ,IAASA,EAAUgyH,YAAa79H,EAASn7B,SAASgnC,EAASvkC,UAC9Gs/J,EAAgB,IAAIvpI,GAAOmO,UACjCm7H,EAAkBnvI,MAAK,CAACvzB,EAAG2oB,IAAMg6I,EAAcnyJ,QAAQmY,EAAEtlB,MAAQs/J,EAAcnyJ,QAAQxQ,EAAEqD,OAASrD,EAAE4iK,eAAiBj6I,EAAEi6I,iBAGvH,MAAO,IAFYF,EAAkBr4J,QAAOu9B,GAA8C,eAAlCA,EAASi7H,0BAC5CH,EAAkBr4J,QAAOu9B,GAA8C,iBAAlCA,EAASi7H,uBAEpE,CAEM,SAASzC,GAAT,GAA+F,IAAD,MAA7E,QAAC91H,EAAD,IAAU/tB,EAAV,SAAeqrB,EAAf,eAAyBo4H,EAAzB,kBAAyCM,EAAzC,eAA4DD,GAAiB,EACnG,MAAM,qBAAChkI,EAAD,SAAuBlN,EAAvB,QAAiCpZ,GAAWu7F,MAAmB,CAAC,EAChE3nG,EAASwgD,YAAewgE,KACvBouC,EAAUC,GAAejhJ,oBAAS,GACnCm8D,EAAOphE,qBAAWgiE,IAClBtkB,EAAUW,cAEVx3B,EAAaxhB,mBAAQ,KACzB,IAAI2qJ,GAAmB,EACnB3jI,EAAM,OAAG5iB,QAAH,IAAGA,OAAH,EAAGA,EAAKknB,QACdpgC,EAAI,OAAGkZ,QAAH,IAAGA,OAAH,EAAGA,EAAKlZ,KAChB,MAAQy/J,GAAoB3jI,GAAQ,CAAC,IAAD,MAClC,MAAMk8F,EAAU,UAAGl8F,EAAO1I,qBAAV,iBAAG,EAAsBC,WAAzB,iBAAG,EAA4B,UAA/B,aAAG,EAAgC2kG,WACnD,GAAIA,GAAcl8F,EAAOwJ,eAAgB,CACvC,MAAM65H,EAAgBrjI,EAAOwJ,eAAenrC,KAAIoqC,GAAYA,EAASvkC,OAC/D04B,EAAWjH,GAAU,OAACumG,QAAD,IAACA,OAAD,EAACA,EAAYt/F,SAAUymI,GAElDM,EADiBN,EAAcn4J,QAAO04J,IAAiBhnI,EAASn7B,SAASmiK,KAC7CtgK,MAAK2wB,GAAQA,EAAK/J,gBAAkBhmB,EAAKgmB,eACtE,CACDhmB,EAAO87B,EAAO97B,KACd87B,EAASA,EAAOsE,OACjB,CACD,OAAO68H,IAAsBwC,CAA7B,GACC,CAACvmJ,EAAK+jJ,IAEH0C,EAAa7qJ,mBAAQ,KAAO,IAAD,IAC/B,cAAO+7D,QAAP,IAAOA,GAAP,UAAOA,EAAMxB,eAAb,iBAAO,EAAeusF,oBAAtB,aAAO,EAA6BlpJ,OAApC,GACC,CAACm+D,IAEE5iC,EAAUn5B,mBAAQ,KACtB,MAAM8qJ,EAAYD,GAChB,eAAC1yF,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACymF,GAAD,CAAa9jG,QAASitJ,EAAY1wI,UAAW1gB,KAAYC,KAAK,QAA9D,SACE,eAAC,KAAD,QAKAqxJ,EAAcvpI,EAYlB,eAAC22C,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACxhB,GAAA,EAAD,CAAYE,QAAS,IAAMknJ,GAAY99J,IAAUA,IAAQ2W,KAAK,QAA9D,SACE,eAAC,KAAD,QAbJ,eAACy+D,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAAC,GAAD,CACEqzE,YAAa,CAAC50F,KAAM,SACpBvD,QAAO,4BACPkgC,MAAK,kCACL/6B,KAAM62B,EACNwC,SAAS,KACTs4B,WAAW,MAoBX+9F,EAAexpI,GACnB,eAAC22C,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACxhB,GAAA,EAAD,CAAYE,QAXK,M3J7OlB,SAA0Bw4B,EAASE,EAAexqB,GACnDwqB,EAAc3X,QAChByX,EAAQE,EAAcnnC,MAAM+X,OAAO4E,EAAO,IAE1CsqB,EAAQE,EAAcnnC,WAAQjC,SACvBkpC,EAAQE,EAAcnnC,MAEhC,C2JuOK+/J,CACEpD,EAAe7gI,OACf6gI,EAAex1H,cACfw1H,EAAeD,iBACjB1jI,IACAm0B,EAAQrxD,KAAK+0E,EAAK3a,KAAKplD,KAAvB,EAKqCtC,KAAK,QAAxC,SACE,eAAC,KAAD,QAKN,OAAO,gBAACy+D,GAAA,EAAD,CAAMG,WAAS,EAAClgC,eAAe,gBAAgBmmC,KAAK,SAASv9D,QAAS,EAAtE,UACJ8pJ,EAAWC,EAAYC,IAD1B,GAGC,CAACH,EAAYhK,EAAar/H,EAAYqmI,EAAgB9rF,EAAM1jB,EAASn0B,EAAsBiO,IAExF+4H,EAAqB3kJ,uBAAY,CAAC5U,EAAK+gC,EAAc2/E,EAAatvH,EAAOmpD,KAC7E,MAAM+xB,EAAUvrC,EAAY,UAAM/gC,EAAN,YAAa+gC,GAAiB/gC,EACpDw5J,OAAsBliK,IAAVlG,GAAiC,OAAVA,SAAoCkG,IAAjBkpC,EAAQxgC,IAAuC,OAAjBwgC,EAAQxgC,IAC5F/E,EAAQsxB,GAAgBm0F,GAAa,EAAd,OAAoB7gH,QAApB,IAAoBA,OAApB,EAAoBA,EAAQihH,UACzD,OACE,eAAC/xG,GAAA,EAAD,CAAmB,cAAa,mBAAhC,SACE,gBAAC09D,GAAD,CAAMH,QAASA,EAAS/xB,SAAUA,EAAlC,UACE,gBAACxrC,GAAA,EAAD,CAAKyZ,UAAU,OAAOoa,WAAW,SAASj7B,MAAO,CAACq7B,SAAU,IAAK1B,SAAU,YAA3E,UACE,eAACryB,GAAA,EAAD,CAAYuZ,UAAU,OAAtB,SACE,eAACzZ,GAAA,EAAD,CAAKtK,WAAW,OAAO+jB,UAAU,OAAjC,SACGuY,GAAgB9lC,OAENs/C,GACf,8CACE,eAAC48G,GAAD,CACE/lK,MAAOA,EACPqhB,IAAKiuG,UAKV84C,GAAa,eAACnsF,GAAD,CAAUpyE,MAAM,sBAhBxBqxE,EADZ,GAqBC,QAACzsE,QAAD,IAACA,OAAD,EAACA,EAAQihH,SAAUtgF,IAEhBi5H,EAAiB7kJ,uBAAY8rG,IACjC,MAAM1gH,EAAM0gH,EAAYnnH,KAClBnI,OAAyBkG,IAAjBkpC,EAAQxgC,IAAuC,OAAjBwgC,EAAQxgC,GAAgB0gH,EAAYjyG,QAAU+xB,EAAQxgC,GAC5Fu6C,OAAqBjjD,IAAVlG,EACjB,IAAKmpD,GAA2C,cAA/BmmE,EAAYlpH,KAAKsrB,WAA0D,IAA7B49F,EAAYzhF,MAAMlpC,OAC/E,OAAO,eAAC2jK,GAAD,CAA+Bh5C,YAAaA,GAAlB1gH,GAEnC,GAAIw5B,GAAwBknF,GAAc,CACxC,MAAMi5C,EAAUn5H,EAAQkgF,EAAYnnH,OAAS,CAAC,EAC9C,OAAO,eAAC,IAAMuV,SAAP,UACJ7O,OAAOK,KAAKq5J,GAASjmK,KAAIqtC,IAAY,aACpCw4H,EAAmBv5J,EAAK+gC,EAAc2/E,EAApB,UAAiCi5C,EAAQ54H,UAAzC,aAAiC,EAAuB64H,QAASr/G,EAD/C,KADZv6C,EAK7B,CACC,OAAOu5J,EAAmBv5J,EAAK,KAAM0gH,EAAatvH,EAAOmpD,EAC1D,GACA,CAAC/Z,EAAS+4H,IAEP1K,EAAuBxgJ,mBAAQ,IAAMygJ,GAAwBr8I,IAAM,CAACA,IAE1E,IAAK+tB,EAEH,OADAj6B,QAAQP,MAAM,4BACP,KAGT,MAAMzF,EAASV,EAAO20J,iBAAmB/hJ,IAAQA,EAAIkmI,QAAUlmI,IAAQA,EAAIkmI,UAAYlmI,EAAIlZ,KAAK6M,WAAW,MAC3G,IAAIi2B,EAAewyH,EAAqBtuJ,QAAOkR,GAAQA,EAAKuX,QAAUqQ,KACrD,iBAAb5mB,EAAIlZ,OAEN8iC,EAAe,IAAI5pB,EAAI4pB,cACvBA,EAAaoB,WAEf,MAAM3xB,EAAa+iJ,EAAqBtuJ,QAAOkR,GAAQA,EAAKuX,QAAUoQ,KAEhEygI,EAAsBx9H,EACzB97B,QAAOmgC,GAAiBF,EAAQE,EAAcnnC,OAASsG,EAAO40J,gBAAkB5kI,IAChFtvB,OAAOA,GACJu5J,EACJ,eAAC9sF,GAAD,CAAatoC,MAAM,eAAnB,SACGm1H,EACEnmK,KAAIgtC,GACI,eAACq5H,GAAD,CAELr5H,cAAeA,EACfF,QAASA,EACTvO,SAAUpC,GAHL6Q,EAAcnnC,UAU7B,IAAIktG,EACJ,GAAI52E,EAAY,CAAC,IAAD,EACd42E,EAAW,gBAAC,IAAM33F,SAAP,WACRhD,EAAW/V,OAAS,GACnB,gBAACi3E,GAAD,CAAatoC,MAAM,aAAnB,UACE,eAAC,GAAD,CAAejO,WAAYhkB,EAAK+tB,QAASA,EAASyuH,SAAUA,IAC5D,eAAClgJ,GAAA,EAAD,CAAKoyB,UAAW,EAAhB,SACGr1B,EACEvL,OAAOA,GACPA,QAAOmgH,IAAW,kBAAI,UAACA,EAAY/zF,qBAAb,iBAAC,EAA2BC,WAA5B,iBAAC,EAAiC,UAAlC,OAAC,EAAqCpE,UAA1C,IAClB90B,IAAI+lK,QAKZK,IACC,UAAArnJ,EAAIka,qBAAJ,eAAmBsiH,OAAQx8H,EAAI0pB,iBAAiBzoC,KAAI8sC,GAAWA,EAAQjnC,OAAMzC,SAAS,iBAAmB,eAAC,GAAD,CAAc2/B,WAAYhkB,EAAK+tB,QAASA,EAASnb,SAAUA,EAAUpZ,QAASA,MAE5L,KAAM,CAAC,IAAD,EACL,MAAMytB,GAAoB,OAAP8G,QAAO,IAAPA,OAAA,EAAAA,EAASiqC,eAAgB,CAAC,EAC7Cg8B,EAAW,gBAAC,IAAM33F,SAAP,WACT,eAACk+D,GAAD,CAAatoC,MAAM,aAAnB,SACG54B,EACEvL,QAAOmgH,QAA6CppH,IAA9BkpC,EAAQkgF,EAAYnnH,OAAuBsG,EAAO40J,gBAAkB8B,IAC1Fh2J,OAAOA,GACP7M,IAAI+lK,KAGRK,EACA75J,OAAOK,KAAKo5B,GAAY3jC,OAAS,GAAK,eAACi3E,GAAD,CAAatoC,MAAM,aAAnB,SACpCzkC,OAAOK,KAAKo5B,GAAYhmC,KAAIsM,GAC3B,eAACysE,GAAD,CAAgBH,QAAO,uBAAkBtsE,GAAzC,SAAiDA,GAAtCA,SAGb,UAAAyS,EAAIka,qBAAJ,eAAmBsiH,OAAQx8H,EAAI0pB,iBAAiBzoC,KAAI8sC,GAAWA,EAAQjnC,OAAMzC,SAAS,iBAAmB,eAAC,GAAD,CAAc2/B,WAAYhkB,EAAK+tB,QAASA,EAASnb,SAAUA,EAAUpZ,QAASA,MAE5L,CACD,MAAM2gB,EAAG,OAAGna,QAAH,IAAGA,GAAH,UAAGA,EAAKka,qBAAR,aAAG,EAAoBC,IAC1BotI,EAAaptI,GAAOA,EAAI72B,OAAS,EAAI62B,EAAI,GAAGqtI,gBAAa3iK,EACzD20G,EAAc+tD,EAAY,CAAC//G,SAAU+/G,EAAWh3H,SAAUg3H,QAAa1iK,EAC7E,OACE,gBAACy1E,GAAD,IAAak/B,EAAb,UACGp8E,GAAc0mI,GACb,eAAC,GAAD,CAAoB9jJ,IAAKA,EAAK+tB,QAASA,EAAS4pC,KAAMA,IAExD,eAAC8vF,GAAD,CAAcznJ,IAAKA,EAAKqrB,SAAUA,EAAUn0B,KAAM62B,EAAS25H,UAAU,UAAU3yH,QAASA,IACxF,eAAC62E,GAAD,CAAU79E,QAASA,EAAS/tB,IAAKA,IAChCg0F,EACD,eAAC2zD,GAAD,MAGL,CAWM,SAAS9kC,GAAgB7+F,GAAa,IAAD,EAC1C,IAAI4+F,EAAY,UAAG5+F,EAAW5J,YAAd,aAAG,EAAiBikI,eAMpC,OALKz7B,IACHA,EAAe,CAAC,OAAQ,OAAQ,MAAMliG,MAAKnzB,GACzCy2B,EAAW5N,YAAY7oB,IAAQy2B,EAAW5N,YAAY7oB,GAAKgpB,QAAUoQ,MAGlEi8F,CACR,CAED,SAAS0kC,GAAT,GAAyD,IAArC,cAACr5H,EAAD,QAAgBF,EAAhB,SAAyBvO,GAAW,EACtD,MAAM,qBAACM,GAAwBi1E,MAAmB,CAAC,EAC7Cp9B,EAAOa,KACPvkB,EAAUW,eACT//C,EAAM48B,GAAWj2B,oBAAS,GAC3BpO,EAASwgD,YAAewgE,KAExB,QAACv0C,EAAD,MAAUrxE,EAAV,aAAiBo/J,GAAgBhsJ,mBAAQ,KAC7C,MAAMooB,EAAaiK,EAAc5X,YACjC,IAAIusG,EAAeC,GAAgB7+F,GAC/B6jI,EAAgBjlC,GAAgB5+F,EAAW5N,YAAYwsG,GACvDilC,GAAiB9gI,GAAwB8gI,KAE3CA,OAAgBhjK,EAChB+9H,OAAe/9H,GAajB,MAAO,CACLg1E,QAAS5rC,EAAcnnC,KACvB0B,MAAOsxB,GAAgBmU,GAAe,EAAhB,OAAsB7gC,QAAtB,IAAsBA,OAAtB,EAAsBA,EAAQihH,UACpDu5C,aAdmB/wI,IACnB,GAAIgxI,EAAe,CAEjB,GADchxI,EAAK+rG,GAEjB,OAAO,eAAC,GAAD,CAAejkI,MAAOk4B,EAAK+rG,GAAe5iH,IAAK6nJ,GAEzD,MAAM,GAAIjlC,EACT,OAAO/rG,EAAK+rG,GAEd,OAAO,IAAP,EAEF,GAKC,CAAC30F,EAAD,OAAgB7gC,QAAhB,IAAgBA,OAAhB,EAAgBA,EAAQihH,WAErB2c,EAAY7oH,uBAAY,KAC5B,IAAI2lJ,EAAgB75H,EAAcnnC,KAClC,GAAImnC,EAAc3X,QAAS,CACzB,IAAIxnB,EAASi/B,EAAQE,EAAcnnC,MAC9BgI,IACHA,EAAS,GACTi/B,EAAQE,EAAcnnC,MAAQgI,GAEhCA,EAAOlM,KAAK,CAAC,GACTkM,EAAOxL,OAAS,IAClBwkK,GAAa,WAAQh5J,EAAOxL,OAAS,IAEvCmuC,GAAQ,EACT,MACC1D,EAAQE,EAAcnnC,MAAQ,CAAC,EAEjCg5B,IACAm0B,EAAQrxD,KAAR,UAAgB+0E,EAAK//D,KAArB,YAA6BkwJ,GAA7B,GACC,CAAC75H,EAAeF,EAAS4pC,EAAM1jB,EAASn0B,IAErChxB,EAASi/B,EAAQE,EAAcnnC,OAAS,GACxCihK,EAAW95H,EAAc3X,SAAWxnB,EAAOxL,OAAS,EACpDyxC,EAAUvV,IAAayO,EAAc3X,UAAYyX,EAAQE,EAAcnnC,QAC3E,eAACwV,GAAA,EAAD,CAAKQ,aAAcirJ,GAAYh6H,EAAQE,EAAcnnC,OAAS,EAAI,EAAlE,SACE,eAACuO,GAAA,EAAD,CAAY,mCAA2B44B,EAAcnnC,MAAQyO,QAASy1H,EAAW11H,KAAK,QAAtF,SACE,eAAC,KAAD,CAASJ,MAAO,CAACjD,SAAU,UAK3BkiC,EAAchyB,uBAAY,KAC9BsvB,GAAQ58B,IAASA,GAAjB,GACC,IAEH,OAAIkzJ,EACK,eAACC,GAAD,CACLnuF,QAASA,EACTrxE,MAAOA,GAAS,OAChBusC,QAASA,EACTjmC,OAAQA,EAAO7N,IAAI2mK,GACnB/yJ,KAAMA,EACNU,QAAS4+B,IAIT,eAAC73B,GAAA,EAAD,CAAK,cAAa,aAAlB,SACE,eAAC09D,GAAD,CACEH,QAAS5rC,EAAc3X,QAAd,UAA2B2X,EAAcnnC,KAAzC,MAAoDmnC,EAAcnnC,KAC3EghD,UAAW/Z,EAAQE,EAAcnnC,MAAOiuC,QAASA,EAFnD,SAIE,eAACv4B,GAAA,EAAD,CAAYuZ,UAAU,OAAtB,SACE,eAACzZ,GAAA,EAAD,CAAKtK,WAAW,OAAO+jB,UAAU,OAAjC,SACGvtB,SAOd,CAQD,SAASy+J,GAAT,GAA6C,IAAhB,YAACh5C,GAAc,EAC1C,MAAMt2C,EAAOphE,qBAAWgiE,IAClBzpE,EAAS8M,mBAAQ,IAAM+7D,EAAKxB,QAAQjsE,IAAI+jH,EAAYnnH,MAAM7F,KAAI,IAAM,QAAO,CAAC02E,EAAKxB,QAAQjsE,IAAK+jH,EAAYnnH,QACzG+N,EAAM48B,GAAWj2B,oBAAS,GAC3BpO,EAASwgD,YAAewgE,IACxB5lH,EAAQsxB,GAAgBm0F,GAAa,EAAd,OAAoB7gH,QAApB,IAAoBA,OAApB,EAAoBA,EAAQihH,UAEnDl6E,EAAchyB,uBAAY,KAC9BsvB,GAAQ58B,IAASA,GAAjB,GACC,IAEH,OAAO,eAACmzJ,GAAD,CACLnuF,QAASo0C,EAAYnnH,KACrBgI,OAAQA,EACRtG,MAAOA,EACPqM,KAAMA,EACNU,QAAS4+B,GAEZ,CAMD,MAAM8zH,GAA8BpqJ,cAAWnI,IAAK,CAClDvD,KAAM,CACJoK,OAAO,MAAD,OAAQ7G,EAAMkH,QAAQ,GAAtB,MACND,QAAQ,KAAD,OAAOjH,EAAMkH,QAAQ,GAArB,MACP+yB,MAAO,OACPt5B,QAAS,OACT09B,cAAe,MACfomC,KAAM,SACNt9D,WAAY,UAEdo1B,MAAO,CACLwG,SAAU,EACVtjC,MAAOO,EAAMnE,QAAQjM,KAAKkM,QAC1BuM,eAAgB,OAChBxB,OAAO,MAAD,OAAQ7G,EAAMkH,QAAQ,GAAtB,MACNuzB,WAAY,SACZ95B,QAAS,OACTrE,WAAY,QAEd6Q,SAAU,CACRjR,gBAAiB8D,EAAMnE,QAAQC,QAAQf,KACvC0E,MAAOO,EAAMnE,QAAQC,QAAQolC,aAC7BzG,WAAY,UAEd49E,WAAY,CACV,UAAW,CACTn8G,gBAAiBs/C,KAAK,OAG1Bnc,QAAS,CAAC,MAOL,SAASizH,GAAmBzzJ,GACjC,MAAM,MAAC/L,EAAD,QAAQqxE,EAAR,OAAiB/qE,KAAW0qG,GAAcjlG,EAChD,OAAO,eAAC+5G,GAAD,CACL9lH,MAAOA,GAASqxE,GAAW,UACvB2/B,EAFC,SAIJ1qG,EAAO7N,KAAI,CAACtC,EAAO8kB,IACX,eAACu2D,GAAD,CAAkBH,QAAO,UAAKA,EAAL,YAAgBp2D,GAASngB,OAAQwL,EAAOxL,OAAjE,SACL,eAACgZ,GAAA,EAAD,CAAKjG,QAAQ,OAAO09B,cAAc,MAAM0E,SAAU,EAAlD,SACE,eAACn8B,GAAA,EAAD,CAAKyZ,UAAU,OAAO1X,WAAY,EAAlC,SACG1f,GAA0B,kBAAVA,EACbA,EACA,eAAC6d,GAAA,EAAD,CAAYuZ,UAAU,OAAtB,SAA8Bp3B,GAAS8kB,SAL/BA,MAYvB,CA+CM,SAAS6qG,GAAT,GAAsG,IAAD,MAA/E,MAAC9lH,EAAD,SAAQ6L,EAAR,QAAkB0gC,EAAlB,KAA2Bw5E,EAA3B,QAAiCC,EAAjC,SAA0CC,EAA1C,KAAoD55G,EAApD,QAA0DU,EAA1D,UAAmEP,GAAY,EAC1G,MAAMV,EAAU,IAAI2zJ,QAAkCjzJ,IAC/CkzJ,EAAWC,GAAgB3sJ,mBAAS,IACpC4sJ,EAAcC,GAAmB7sJ,mBAAS,GAC3Cm8D,EAAOphE,qBAAWgiE,IAClB11D,EAAQ,OAAG80D,QAAH,IAAGA,GAAH,UAAGA,EAAMh0D,YAAT,aAAG,EAAYpW,IACvB+6J,GAAgBzzJ,IAASgO,IAAara,IAAb,OAAsBqa,QAAtB,IAAsBA,OAAtB,EAAsBA,EAAUlP,WAAWnL,EAAQ,OAG5E+/J,EAASnnK,KAAK+J,IAAIkJ,EAAS/Q,OAAQirH,EAAO25C,GAC1CM,EAAcpnK,KAAK03C,IAAIyvH,EAAQl0J,EAAS/Q,OAASkrH,EAAU45C,GAC3DK,EAAYp0J,EAAS/Q,OAE3B,OAAO,gBAAC,IAAM+Y,SAAP,WACL,uBAAKrH,UAAWolE,KACd9lE,EAAQnC,KAAMm2J,EAAeh0J,EAAQuO,SAAWvO,EAAQy5G,YAD1D,UAGE,gBAACvxG,GAAA,EAAD,CAAYjH,QAASA,EAASP,UAAWV,EAAQ29B,MAAjD,UACGp9B,EAAO,eAAC,KAAD,IAAmB,eAAC,KAAD,IAC3B,uBAAMmjC,KAAK,YAAX,SAAwBxvC,OAEzBusC,GAAW,sBAAK//B,UAAWV,EAAQygC,QAAxB,SACTA,OAGJlgC,GACC,uBAAK,kCAA0BrM,GAA/B,UACG2hD,gBAnBU,EAmBMo+G,GAAQtnK,KAAKwiB,GAAUpP,EAASoP,KAChD8kJ,EAASC,GAAe,gBAAClsJ,GAAA,EAAD,CAAK+B,WAAY,GAAjB,UACtBkwG,EAAO,GAAK,eAAC,GAAD,CACXlB,UAAQ,EACRC,SAAU46C,EAAY,EACtBx6C,OAAQ,IAAMy6C,GAAa3lK,GAAKpB,KAAK+J,IAAIq9J,EAAahmK,EAAIisH,KAC1Dd,OAAQ,IAAMw6C,GAAa3lK,GAAKpB,KAAK03C,IAAI,EAAGt2C,EAAIisH,KAChDvwG,QAAQ,OACR,cAAY,uCAEbswG,EAAU,GAAK,eAAC,GAAD,CACdnB,UAAQ,EACRC,SAAU86C,EAAe,EACzB16C,OAAQ,IAAM26C,GAAgB7lK,GAAKpB,KAAK+J,IAAIkJ,EAAS/Q,OAAS4kK,EAAY15C,EAAShsH,EAAIisH,KACvFd,OAAQ,IAAM06C,GAAgB7lK,GAAKpB,KAAK03C,IAAI,EAAGt2C,EAAIisH,KACnDvwG,QAAQ,KACR,cAAY,wCAGfisC,gBAAMq+G,EAAaC,GAAWxnK,KAAKwiB,GAAUpP,EAASoP,UAI9D,CA5DDukJ,GAAmBpsH,aAAgB,CACjC2yE,KAAM,GACNC,QAAS,EACTC,SAAU,IA4FZH,GAAa1yE,aAAgB,CAC3B2yE,KAAM,GACNC,QAAS,EACTC,SAAU,IAGL,MAAMi6C,GAAe11J,IAAMoI,MAAK,YAAiE,IAAD,UACjGutJ,GADuD,QAAC56H,EAAD,WAAU/J,EAAV,SAAsBpR,EAAtB,QAAgCpZ,GAAU,EAErG,MAAMovJ,GAA2B,OAAV5kI,QAAU,IAAVA,GAAA,UAAAA,EAAY9J,qBAAZ,eAA2BsiH,QAA3B,UAAmCx4G,EAAW9J,qBAA9C,aAAmC,EAA0BsiH,MACpF,UAAIzuG,QAAJ,IAAIA,KAAS86H,QAAS,CACb,OAAP96H,QAAO,IAAPA,KAAS86H,QAAQ55J,SAAQ,CAAC65J,EAAQrlJ,KAChCqlJ,EAAOC,UAAYtlJ,CAAnB,IAEF,MAAOulJ,EAAgBC,GAAgBl7H,EAAQ86H,SAAWK,oBAAUn7H,EAAQ86H,SAASC,QAA4BjkK,KAAZ,OAANikK,QAAM,IAANA,OAAA,EAAAA,EAAQrlJ,SACvGklJ,EAAgBK,EAAehyI,MAAK,CAACvzB,EAAG2oB,IAAM3oB,EAAEggB,MAAQ2I,EAAE3I,QAC1DklJ,EAAgB,IAAIA,KAAkBM,EACvC,CACD,MAAOpmJ,EAAUN,GAAe/G,mBAAS,CAAC,IAEpC2tJ,EAAQvtJ,mBAAQ,KAAO,IAAD,EAC1B,MAAMwtJ,EAAa,GACnB,IAAI77J,EAAM,EACG,QAAb,EAAAo7J,SAAA,SAAe15J,SAAQutI,IACF,IAAD,UAAlB,OAAIA,QAAJ,IAAIA,KAAMssB,SACRtsB,EAAKssB,OAAO5xJ,KAAQrN,MAAMoR,QAAN,OAAcuhI,QAAd,IAAcA,GAAd,UAAcA,EAAMssB,cAApB,aAAc,EAAc5xJ,MAAQ,IAAC,OAAGslI,QAAH,IAAGA,GAAH,UAAGA,EAAMssB,cAAT,aAAG,EAAc5xJ,MAAQ,CAAC,IAAC,OAAGslI,QAAH,IAAGA,GAAH,UAAGA,EAAMssB,cAAT,aAAG,EAAc5xJ,OACrGkyJ,EAAWxmK,KAAK,CAACmmK,UAAWvsB,EAAKusB,UAAWvsB,KAAMA,EAAKssB,OAAQv7J,IAAKA,EAAK/E,MAAOg0I,EAAKh0I,QAAL,OAAcg0I,QAAd,IAAcA,GAAd,UAAcA,EAAMj+F,cAApB,iBAAc,EAActM,aAA5B,aAAc,EAAqB3sC,OAAQ,WAAYP,KAAM,gBAC9I,IAEH,MAAMskK,EAAkBT,EACpB/+J,MAAMoR,QAAQ2tJ,GAAkB,IAAIA,GAAkB,CAAC,IAAIA,SAC3D/jK,EAUJ,OATe,OAAfwkK,QAAe,IAAfA,KAAiBp6J,SAAQutI,IACvB,KAAM,UAAWA,GAAO,CACtB,MAAMU,EAAQV,EAAKrpF,GAAKqpF,EAAI,QAAcA,EAAI,MACxC8sB,EAAYz/J,MAAMoR,QAAQiiI,GAAS,CAAC,WAAaA,EAAM3xI,MAAM,KACnEixI,EAAKh0I,MAAQ8gK,EAAUA,EAAUhmK,OAAS,EAC3C,CACD8lK,EAAWxmK,KAAK,CAAC45I,KAAMA,EAAMjvI,IAAKA,EAAK/E,MAAOg0I,EAAKh0I,OAAS,WAAYzD,KAAM,mBAC9EwI,GAAY,CAAZ,IAEK67J,CAAP,GACC,CAACR,EAAgBD,IAMpB,OAJAjtJ,qBAAU,KACR6G,EAAY,CAAC,GAAb,GACC,CAAC4mJ,EAAM7lK,SAEN6lK,EAAM7lK,OAAS,GAAKuf,EAAS6d,MAAKjd,GAASA,GAAS0lJ,EAAM7lK,SACrD,KAGF,eAACi3E,GAAD,CAAatoC,MAAM,OAAnB,SACL,gBAAC31B,GAAA,EAAD,CAAKkrC,SAAU,IAAf,UACG2hH,EAAM7lK,OAAS,GAAK,eAACyiE,GAAA,EAAD,CACnBklC,QAAM,EAAC/sF,QAAQ,SAAS5I,KAAK,QAAQuzD,WAAS,EAACrgE,MAAO,cAAe0M,MAAO,CAAC85B,aAAc,GAC3Fu6H,YAAa,CACXv2H,UAAU,EACVr0C,MAAOkkB,EACPkzB,SAAUpC,GAASpxB,EAAYoxB,EAAMlnB,OAAO9tB,OAC5Cg+E,YAAa6sF,IAAW,uBAAIA,EAAYvoK,KAAIwiB,IAAU,IAAD,EACnD,OAAOmJ,GAAS,OAACu8I,QAAD,IAACA,GAAD,UAACA,EAAQ1lJ,UAAT,aAAC,EAAgBjb,MAAjC,WADsB,aAAI,EAExBuI,KAAK,KAFe,GANP,SAWlBo4J,EAAMloK,KAAI,CAACu7I,EAAM/4H,KAAP,aACT,gBAACslC,GAAA,EAAD,CAAsBpqD,MAAO8kB,EAA7B,UACE,eAACmyB,GAAA,EAAD,CACEE,QAASjzB,EAASyP,WAAUm3I,GAAiBA,IAAkBhmJ,KAAU,IAE1EmJ,GAAS,OAACu8I,QAAD,IAACA,GAAD,UAACA,EAAQ1lJ,UAAT,aAAC,EAAgBjb,SAJdib,EADN,MAZf,UAqBGZ,EAAS5hB,KAAIwiB,GAAK,OAAI0lJ,QAAJ,IAAIA,OAAJ,EAAIA,EAAQ1lJ,YArBjC,aAqBG,EACGxiB,KAAKu7I,GACgB,gBAAdA,EAAKz3I,KACR,eAAC,GAAD,CAEAi/B,WAAYA,EACZ+J,QAASA,EACTyuG,KAAMA,EAAKA,KACXvqG,MAAOuqG,EAAKh0I,MACZ62G,aAAczsF,GAAYpZ,GAAZ,kCAAkDoZ,EAAlD,qBAAuEpZ,EAAvE,8BAAoGgjI,EAAKusB,UAAzG,YALTvsB,EAAKjvI,KAOV,eAAC,GAAD,CAEAy2B,WAAYA,EACZ+J,QAASA,EACTyuG,KAAMA,EAAKA,KACXvqG,MAAOuqG,EAAKh0I,OAJPg0I,EAAKjvI,WASvB,IAQD,SAAS02J,GAAT,GAA4C,IAAf,MAACtlK,EAAD,IAAQqhB,GAAM,EACzC,MAAMinB,EAAatoC,EAAMq5E,cAAgB,CAAC,EAC1C,OAAO,eAAC,GAAD,CAAUr5E,MAAOA,EAAMwoK,QAASnnJ,IAAKA,EAAKxf,KAAM7B,EAAM+qK,OAAtD,SACJl8J,OAAOK,KAAKo5B,GAAY3jC,OAAS,GAAK,eAACi3E,GAAD,CAAatoC,MAAM,aAAnB,SACpCzkC,OAAOK,KAAKo5B,GAAYhmC,KAAIsM,GAC3B,eAACysE,GAAD,CAAgBH,QAAStsE,EAAzB,SAA+BA,GAApBA,QAIlB,CAOD,SAASsc,GAAT,GAAiD,IAAD,QAA9B,MAAClrB,EAAD,IAAQqhB,EAAR,KAAaxf,EAAb,SAAmB6T,GAAW,EAC9C,MAAM,KAAC2oD,GAAQwb,KACf,OAAO,gBAAC8B,GAAD,WACL,eAACmtF,GAAD,CAAcznJ,IAAKA,EAAK9I,KAAMvY,EAAO+oK,UAAU,WAC9C,UAAA1nJ,EAAIka,qBAAJ,eAAmBsiH,OAClB,eAACjiE,GAAD,CAAatoC,MAAM,OAAnB,SACE,eAAC,GAAD,CACElE,QAASivB,EAAKmZ,QAAQjsE,IACtB85B,WAAYg5B,EAAKmZ,QAAQn2D,IACzBw8H,KAAI,UAAEx8H,EAAIka,qBAAN,aAAE,EAAmBsiH,KAAK,GAC9BvqG,MAAOjyB,EAAIlZ,SAIjB,eAACyzE,GAAD,CAAatoC,MAAM,QAAnB,SACE,eAAC,GAAD,CACEtzC,MAAOA,EACPqhB,IAAKA,EACLxf,KAAMA,MAGT6T,EACD,eAACszJ,GAAD,MAEH,CAYD,SAASha,GAAT,GAA8B,IAAf,MAAChvJ,EAAD,IAAQqhB,GAAM,EAC3B,OAAO,gBAACs6D,GAAD,WACL,eAACC,GAAD,CAAatoC,MAAM,UAAnB,SACE,eAAC,GAAD,CACEtzC,MAAY,OAALA,QAAK,IAALA,KAAOikD,QAAUp1C,OAAOC,QAAQ9O,EAAMikD,SAAS3hD,KAAI,QAAEsM,EAAK5O,GAAP,kBAAqB4O,EAArB,aAA6B5O,EAA7B,IAAwC,GAClGqhB,IAAKA,OAGH,OAALrhB,QAAK,IAALA,OAAA,EAAAA,EAAOuY,OAAQ,eAACqjE,GAAD,CAAatoC,MAAM,UAAnB,SACd,eAAC,GAAD,CACEtzC,MAAY,OAALA,QAAK,IAALA,KAAOuY,KAAOvY,EAAMuY,KAAKjW,KAAImsB,GAASA,EAAMyF,UAAYzF,EAAMgZ,WAAY,GACjFpmB,IAAKA,MAGT,eAACu6D,GAAD,CAAatoC,MAAM,QAAnB,SACE,eAAC06E,GAAD,CAAe31G,KAAMrY,EAAOoY,SAAUpY,QAG3C,CAOD,SAASulK,GAAT,GAAkC,IAAf,MAACvlK,EAAD,IAAQqhB,GAAM,EAC/B,OAAO,gBAACs6D,GAAD,WACL,eAACmtF,GAAD,CAAcznJ,IAAKA,EAAK9I,KAAMvY,EAAO+oK,UAAU,cAC/C,eAACntF,GAAD,CAAatoC,MAAM,QAAnB,SACE,eAAC,GAAD,CACEtzC,MAAOA,EACPqhB,IAAKA,MAGT,eAAC2pJ,GAAD,CAAM3pJ,IAAKA,MAEd,CAOD,SAASgkJ,GAAT,GAA4C,IAAD,YAAd,MAACrlK,EAAD,IAAQqhB,GAAM,EACzC,MAAM4pJ,EAAW,OAAG5pJ,QAAH,IAAGA,GAAH,UAAGA,EAAKjb,YAAR,iBAAG,EAAW4nC,6BAAd,aAAG,EAAkC7lC,KAChD+iK,EAAoB,OAAG7pJ,QAAH,IAAGA,GAAH,UAAGA,EAAKjb,YAAR,iBAAG,EAAW4nC,6BAAd,aAAG,EAAkCzI,eACzD4lI,EAAO,CAAC,gCAAgCzlK,SAASwlK,GACvD,OAAO,gBAACvvF,GAAD,WACL,eAACmtF,GAAD,CAAcznJ,IAAKA,EAAK9I,KAAMvY,EAAO+oK,UAAU,UAC/C,gBAACntF,GAAD,CAAatoC,MAAM,YAAnB,WACI63H,GAAQ,eAACttJ,GAAA,EAAD,CAAYrH,MAAM,QAAlB,uCACV,eAACqH,GAAA,EAAD,UAAY,mDACZ,eAACA,GAAA,EAAD,UAAaotJ,GAAe,YAC5B,eAACptJ,GAAA,EAAD,UAAY,oDACZ,eAACA,GAAA,EAAD,UAAa7d,OAEf,eAACgrK,GAAD,CAAM3pJ,IAAKA,MAEd,CAOD,MAAM+pJ,GAAgBlsJ,cAAWnI,IAAK,CACpCuB,YAAa,CACXy3B,UAAWh5B,EAAMkH,QAAQ,IAE3BotJ,MAAO,CACLt7H,UAAWh5B,EAAMkH,QAAQ,IAE3B7M,SAAU,CACRi/B,aAAct5B,EAAMkH,QAAQ,IAE9BqtJ,aAAc,CACZj4J,WAAY,YAIT,SAAS23J,GAAT,GAAsB,IAAR,IAAC3pJ,GAAM,EAC1B,MAAM1L,EAAUy1J,KAEhB,OADen8G,YAAewgE,IAClBC,SAGL,gBAAC9zC,GAAD,CAAatoC,MAAM,OAAO98B,MAAM,UAAhC,UACL,sBAAKH,UAAWV,EAAQvE,SAAxB,SACE,eAACiqE,GAAD,CAAMH,QAAQ,YAAd,SACE,eAACqwF,GAAD,CAAiB51J,QAAS,CAACnC,KAAMmC,EAAQ21J,cAAejqJ,IAAKA,EAAKmqJ,cAAY,EAACp0I,UAAU,aAG7F,eAAC,GAAD,CAAUzhB,QAAS,CAACnC,KAAMmC,EAAQ2C,aAAlC,SAAiD+I,EAAI/I,iBAR9C,IAUV,CAMD,MAAMmzJ,GAAY,CAChB,QAAW,CACT,QACA,aACA,QACA,aACA,iBACA,WACA,aACA,kBAEF,SAAY,CACV,SAAY,KAEd,MAAS,UACT,WAAc,CACZ,SAAY,qBAAsB,MAAS,OAAQ,UAAa,KAIpE,SAASzC,KACP,MAAMhwF,EAAOa,MACN6xF,EAAeC,GAAoB9uJ,mBAAS,OAE7C,IAACjE,GAAO0E,MACR,WAAC9I,GAAcmD,KAEfkW,EAASmrD,EAAKxB,QAEd38D,EAAUgT,EAAOk2I,aAAalpJ,QAC9B0a,EAAW1H,EAAOk2I,aAAa9qJ,MAAQ,IAmBvC2yJ,EAAc1+I,GACXA,EAAK5qB,KAAI,CAACi1B,EAAKzS,KAAN,aACd,eAACu2D,GAAD,CAAMH,QAAS,iBAAmBp2D,EAAlC,SAAqD,gBAACjH,GAAA,EAAD,CAAYuZ,UAAU,OAAtB,UACnD,eAACzZ,GAAA,EAAD,CAAKtK,WAAW,OAAO+jB,UAAU,OAAjC,SAAyCG,EAAIrD,WADM,YAGnD,eAACvW,GAAA,EAAD,CAAKyZ,UAAU,OAAO6lD,UAAU,SAAhC,uBAHmD,UAIlD1lD,EAAIs0I,wBAJ8C,aAIlD,EAAsBvpK,KACrB,CAACi1B,EAAKzS,IAAU,eAACjH,GAAA,EAAD,CAAwB0B,QAAQ,QAAhC,SAAyCgY,EAAIu0I,aAA5BhnJ,SALSA,EADhC,IAYlB,OAAO,eAAC82D,GAAD,CAAatoC,MAAM,gBAAgBuoC,gBAAgB,EAAMC,SA9B1C,KACpB,GAAI4vF,EAAe,OACnB,MAAMK,EAAoBl9J,OAAOqzB,OAAO,CAAC,EAAGupI,GAAW,CACrD,MAAS,CACP,mCAAoC5wJ,EACpC,+BAAgC0a,KAGpC3c,EAAIM,MAAM,UAAW6yJ,EAAmB,CAACzwJ,WAAW,IAAOlB,MAAM7B,IAC/DsV,EAAOo2I,cAAgBp1J,OAAOQ,YAAYkJ,EAAKA,KAAKjW,KAAI,CAACmsB,EAAO3J,KAC9D2J,EAAMo9I,iBAAmBp9I,EAAMo9I,iBAAiB18J,QAAOooB,GAAOA,EAAIy0I,kBAAoBnxJ,GAAW0c,EAAI00I,cAAgB12I,IAC9G,CAAC,iBAAmBzQ,EAAO2J,OAEpCk9I,EAAiB98J,OAAOsB,OAAO0d,EAAOo2I,eAAtC,IACC3pJ,MAAM9F,EANT,EAsBK,SACJk3J,EACGA,EAAc/mK,OAAS,EACI,KAAzB+mK,EAAc/mK,OACZ,eAAC4uC,GAAA,EAAD,CAASD,MAAM,8CAAf,SACCs4H,EAAWF,KAEZE,EAAWF,GACb,eAACj2F,GAAA,EAAD,CAAOC,SAAU,OAAjB,6CACF,eAACD,GAAA,EAAD,CAAOC,SAAU,OAAQ,cAAaniD,GAAtC,yBAEP,C,uGC/uDD,SAAS3mB,GAAMg6E,EAAOuvE,GACpB,GAAa,IAATA,EACF,MAAO,CAACvvE,GAEV,MAAMjwE,EAAOlU,KAAK88F,KAAK3Y,EAAMjiF,OAASwxJ,GACtC,MAAO,CAACvvE,EAAMhgF,MAAM,EAAG+P,MAAU/J,GAAMg6E,EAAMhgF,MAAM+P,GAAOw/I,EAAO,GAClE,CAED,SAAS56E,GAAWpxD,EAAGjG,EAAUmwB,GAE/B,IAAIknC,EACJ,GAAIlnC,EACF,QAAiBnuC,IAAbge,EACFq3D,GAAa,OAEb,GAAIrwE,MAAMoR,QAAQ4H,GAAW,CAE3Bq3D,EADmB,IAAI16D,IAAIqD,GACHpD,IAAIqJ,EAAEvb,IAC/B,MACC2sE,EAAar3D,IAAaiG,EAAEvb,SAIhC2sE,EAAar3D,IAAaiG,EAAEvb,IAE9B,OAAO2sE,CACR,CAED,MAAMt8D,GAAYC,cAAWnI,IAAK,CAChCvD,KAAM,CACJu8B,UAAWh5B,EAAMkH,QAAQ,IAE3Bwa,QAAS,CACP4f,WAAY,EACZrI,SAAU,YAEZ58B,QAAS,CACP49B,MAAO,OACPC,OAAQ,QAEVi7H,eAAgB,CACdl8H,SAAU,WACV18B,SAAUjB,EAAWU,UAAUI,WAAWC,QAAQE,SAClDD,WAAYhB,EAAWU,UAAUI,WAAWC,QAAQC,WAEpDqE,QAAS,OACT02C,OAAQ,EACRjW,OAAQ,WAEVvoB,OAAQ,CACNw+B,OAAQ,OAGG,SAAS+9G,GAAT,GAGX,IAH8B,aAChCt3B,EAAe,EADiB,cACdu3B,EADc,eACCC,EADD,MACiB/4H,EADjB,KACwB/6B,EADxB,QAC8Bw7B,EAAU,EADxC,SAC2Cu4H,EAD3C,QAEhC11J,EAFgC,SAEvBsN,EAFuB,KAEbqoJ,EAFa,SAEPl4H,GACxB,EACDz9B,EAAUA,GAAO,KAAW,MAC5B2B,EAAOA,GAAQ,GACf8zJ,EAAiBA,GAAkB9zJ,EAAK5T,OACxCynK,EAAgBA,GAAa,CAAKpsK,GAASA,EAAMmI,MACjDmrC,EAAQA,GAAS,YAEjB,MAAOk5H,EAAaC,GAAkB5vJ,mBAAS,KACxCqb,EAAMykC,GAAW9/C,sBACjBwQ,EAAOynH,GAAYj4H,mBAASg4H,GAC7Bl/H,EAAUsJ,KACV+6D,EAAer9C,mBAEf+vI,EAAoBx0I,IACL,IAAfA,EAAKl4B,OACP4W,EAAQshB,EACT,EAGHnb,qBAAU,KAER,MAAM4vJ,EAAyBN,EAS/B,IAAK,IAAIxpK,EAAI0V,EAAK5T,OAAQ9B,EAAI8pK,EAAwB9pK,IACpD0V,EAAKtU,KAAK,CAAC2K,IAAI,QAAD,OAAU/L,GAAKsF,KAAM,GAAInI,MAAO,IAGhD,MAAM4sK,EAAanqK,KAAK88F,KAAKhnF,EAAK5T,OAASovC,GAC3C,IAAK,IAAIlxC,EAAI0V,EAAK5T,OAAQ9B,EAAI+pK,EAAa74H,EAASlxC,IAClD0V,EAAKtU,KAAK,CAAC2K,IAAI,QAAD,OAAU/L,GAAKsF,KAAM,GAAInI,MAAO,IAEhD,MAAM6sK,EAAcjgK,GAAM2L,EAAMw7B,GAE1B+4H,EAAiB9yF,EAAantD,QAAQkgJ,YACtC/7H,EAAQ87H,EAAiB/4H,EAAW,IAAMA,EAAU,GACpD9C,EAAsB,GAAb27H,EAGT/oK,EAAI8nD,eAAWH,MAAM,CAAC,EAAGxa,IAAQrxC,SAAS0tB,GAG1C8sB,EAAM41G,KAAOx3I,GAAM4R,GAAKA,EAAEnqB,SAAU,EAC1C6D,EAAE0nD,OAAO,CAAC,EAAGpR,IAEb,MAAM6yH,EAAY7iJ,GAAKoxD,GAAWpxD,EAAGjG,EAAUmwB,GAAYniC,EAAoBJ,KAAOD,EAAkBE,MAClG6hI,EAAYzpH,GACA,IAAZA,EAAEnqB,MACG,OAEFu7E,GAAWpxD,EAAGjG,EAAUmwB,GAAY,OAAS,OAGhDkhC,EAAYw6E,KAAU/1E,EAAantD,SACnCq/I,EAAiB32F,EAAU+2B,OAAO,IAAM32F,EAAQu2J,gBAChDe,EAAM13F,EAAU+2B,OAAO,OAC1Bo4D,KAAK,QAASoI,GACdpI,KAAK,SAAUzzH,GAClBi7H,EACG31J,MAAM,QAASy6B,EAAQ,MACvBz6B,MAAM,SAAU,QAEnB,MAAM22J,EAAWD,EACdE,UAAU,WACV50J,KAAKs0J,EAAYvqK,KAAI,CAACm6D,EAAG55D,IAAJ,gBAAmBA,MAE3CqqK,EAAS9qC,OAAOpjH,SAChBkuJ,EACGE,QACAnpE,OAAO,KACPygE,KAAK,MAAMv6I,GAAKA,IAChBu6I,KAAK,QAAS,UACdA,KAAK,aAAa,CAACv6I,EAAGtnB,IAAJ,oBAAuBA,GAAKmuC,EAAQ,IAApC,UAErB67H,EAAYv8J,SAAQ,CAACiI,EAAM1V,KACzB,MAAM2xD,EAAI64G,eAAYC,WAAW,CAAC,EAAGr8H,IAASjzB,QAAQ,IACtDw2C,EAAEjJ,OAAOhzC,EAAKjW,KAAI6nB,GAAKA,EAAEvb,OAEzB,MAAMk7C,EAAQmjH,EAAI3gE,OAAO,UAAYzpG,GAClCsqK,UAAU,SACV50J,KAAKA,GAAM4R,GAAKA,EAAEvb,MAErBk7C,EAAMs4E,OAAOpjH,SAEb8qC,EACGg7D,GAAG,QAAS4nD,GAEf,IAAIx0I,EAAO4xB,EAAMsjH,QACdnpE,OAAO,KACPygE,KAAK,QAAS,QACdA,KAAK,WAAWv6I,GAA0B,KAArBiiJ,EAAcjiJ,GAAY,OAAS,SACxD5T,MAAM,SAAU,WAChBuuG,GAAG,QAAS4nD,GAEfx0I,EACG+rE,OAAO,QACPygE,KAAK,IAAK7gK,EAAE,IACZ6gK,KAAK,KAAKv6I,GAAKqqC,EAAErqC,EAAEvb,OACnB81J,KAAK,QAAS1zH,GACd0zH,KAAK,QAAS,cACdnuJ,MAAM,UAAW,GACjBmuJ,KAAK,SAAUlwG,EAAE+4G,aAEpBr1I,EACG+rE,OAAO,QACPygE,KAAK,QAAS,OACdA,KAAK,IAAK7gK,EAAE,IACZ6gK,KAAK,KAAKv6I,GAAKqqC,EAAErqC,EAAEvb,OACnB81J,KAAK,SAASv6I,GAAKtmB,EAAEsmB,EAAEnqB,OAAS6D,EAAE,KAClC6gK,KAAK,SAAUlwG,EAAE+4G,aACjBh3J,MAAM,OAAQy2J,GAGdz2J,MAAM,kBAAmB,sBAE5B2hB,EACG+rE,OAAO,QACPygE,KAAK,QAAS,QACdA,KAAK,KAAM,SACXA,KAAK,IAAK7gK,EAAE,GAAK,GACjB6gK,KAAK,KAAKv6I,GAAKqqC,EAAErqC,EAAEvb,KAAO,IAC1B81J,KAAK,cAAe,SACpBnuJ,MAAM,OAAQq9H,GACdr9H,MAAM,cAAepE,GACrBxL,MAAKwjB,GAAKiiJ,EAAcjiJ,KAE3B+N,EACG+rE,OAAO,QACPygE,KAAK,QAAS,SACdA,KAAK,KAAMlwG,EAAE+4G,aACb7I,KAAK,KAAKv6I,GAAKqqC,EAAErqC,EAAEvb,KAAO,IAC1B81J,KAAK,KAAKv6I,GAAK6mB,EAAQ,IACvB0zH,KAAK,cAAe,OACpBnuJ,MAAM,OAAQq9H,GACdr9H,MAAM,cAAepE,GACrBxL,MAAKwjB,GAAKzW,EAAeyW,EAAEnqB,SAE9Bk4B,EACG4sF,GAAG,cAAc,SAAS36F,GACzBwyC,EAAQxyC,GACJmiJ,GACEniJ,EAAE/W,UACJ84J,EACG31J,MAAM,OAAQ1T,EAAKmuC,EA1GhB,GA0GmC,MACtCz6B,MAAM,MAAQi+C,EAAErqC,EAAEvb,KAAQ,MAC1B2H,MAAM,UAAW,SACpBk2J,EAAetiJ,EAAE/W,SAGtB,IACA0xG,GAAG,cAAc,SAAS36F,GAC1B,IAEH+N,EAAO4xB,EAAM+sE,WAAWk5B,OAAgByd,SAAS,MAEjDt1I,EACGo0E,OAAO,QACPo4D,KAAK,KAAKv6I,GAAKqqC,EAAErqC,EAAEvb,OACnB81J,KAAK,SAASv6I,GAAKtmB,EAAEsmB,EAAEnqB,OAAS6D,EAAE,KAClC6gK,KAAK,SAAUlwG,EAAE+4G,aACjBh3J,MAAM,OAAQy2J,GAEjB90I,EACGo0E,OAAO,SACP3lG,MAAKwjB,GAAKiiJ,EAAcjiJ,KACxBu6I,KAAK,KAAKv6I,GAAKqqC,EAAErqC,EAAEvb,KAAO,IAC1B2H,MAAM,OAAQq9H,GAEjB17G,EACGo0E,OAAO,UACP3lG,MAAKwjB,GAAKzW,EAAeyW,EAAEnqB,SAC3B0kK,KAAK,KAAKv6I,GAAKqqC,EAAErqC,EAAEvb,KAAO,IAC1B81J,KAAK,IAAK1zH,EAAQ,GAClBz6B,MAAM,OAAQq9H,EALjB,GA9FF,IAuGF,MAAM65B,EAAQ,sBAAKl2I,IAAKyiD,EAAV,SACZ,uBAAK3jE,UAAWV,EAAQvC,QAAxB,UACE,eAACmgC,GAAA,EAAD,CACE8f,aAAW,EACX/b,UAAU,QACVhE,MAAOk5H,EAHT,SAKE,sBAAKn2J,UAAWV,EAAQu2J,eAAgBt1J,QAAS,KAAQ81J,EAAkBx0I,EAAlB,MAG3D,sBAAK7hB,UAAWV,EAAQia,cAI5B,OAAI28I,EACK,gBAACl3F,GAAA,EAAD,CAAM1/D,QAAS,CAACnC,KAAMmC,EAAQnC,MAA9B,UACL,eAACgrH,GAAA,EAAD,CACElrF,MAAOA,EACPo6H,qBAAsB,CAACnuJ,QAAS,SAChC9I,OACE,eAAC88B,GAAA,EAAD,CAASD,MAAM,gCAAf,SACE,gBAAC0W,GAAA,EAAD,CACEhqD,MAAOqtB,EACP+pB,SAAWpC,GAAU8/F,EAAS9/F,EAAMlnB,OAAO9tB,OAC3C2tK,cAAY,EACZxlK,KAAK,cAJP,UAME,eAACiiD,GAAA,EAAD,CAAUpqD,MAAO,EAAjB,oBACA,eAACoqD,GAAA,EAAD,CAAUpqD,MAAO,GAAjB,iBACA,eAACoqD,GAAA,EAAD,CAAUpqD,MAAO,IAAjB,iBACA,eAACoqD,GAAA,EAAD,CAAUpqD,MAAO,KAAjB,wBAKR,eAACs1E,GAAA,EAAD,CAAa3/D,QAAS,CAACnC,KAAMmC,EAAQ8iB,SAArC,SACGg1I,OAIEA,CAEV,CAmDDtB,GAAUlvH,aAAe,CACvB5I,UAAU,GC3TL,MAAMu5E,GAAI,86CA4BsDl+G,EA5BtD,2BAiCjB,SAASk+J,GAAW9oK,EAAG2oB,GACrB,OAAO3oB,EAAEqD,KAAKiiC,cAAc3c,EAAEtlB,KAC/B,CAEM,MAAM0lK,GAAsBzwJ,YAAK,CACtCxO,IAAK,iBACLyO,QAAS,CACP,cAAiB,SAUN,SAASywJ,KACtB,MAAM7mI,EAAiBW,KACjB4vC,EAAUv6D,mBAAQ,IACfgqB,EAAiB,IAAI8mI,GAAoB9mI,EAAeoD,6BAA+B,MAC7F,CAACpD,IACJ,OAAKuwC,EAGE,eAAC,GAAD,CACLA,QAASA,EACTnkD,KAAM,eAAC,GAAD,MAJC,IAMV,CAED,MAAMpU,GAAYC,cAAWnI,IACpB,CACLw+D,UAAW,CACTr3D,WAAY,SACZo3B,SAAU,UAEZsuF,UAAW,CACT5yF,MAAO,IACP7yB,YAAapH,EAAMkH,QAAQ,MAE7B+vJ,UAAW,CACTh9H,MAAO,KAETi9H,UAAW,CACTrwJ,OAAQ,OAKRswJ,GAAqB75J,IAAMoI,MAAK,SAA4B7G,GAChE,MAAMkB,EAASmI,MACRxQ,EAAQw0J,GAAaz0G,YAAeq/G,IACrC5mI,EAAiBW,KACjB0tB,EAAUW,eACV,IAAEnoD,GAAQ8pE,cAEVmqF,EAAgB9kJ,mBAAQ,KAC5B,MAAMuxB,EAAavH,EAAemC,gBAC5B24H,EAAgB,CAAC,EA4BvB,OA3BA96H,GAAkBp4B,OAAOK,KAAKs/B,GAAYl+B,SAASnI,IAC7BqmC,EAAWrmC,GAAMgH,QAAOkS,IACzCA,EAAI6oB,sBAAwB7oB,EAAIuW,QAAUqQ,KACzC5mB,EAAI4rB,SAAS9kC,KAAK6M,WAAWvG,EAAO0/J,gBAAkB9sJ,EAAI4rB,SAAS9kC,KAAK6M,WAAW,YAE3E1E,SAAQ+Q,IAClB,MAAMpI,EAAOguB,EAAehuB,KAAKoI,GAC3BvF,EAAS,0CAEf,IAAIxX,EAAMuF,EACK,IAAD,EAGP,IALUoP,EAAKjE,WAAW8G,IAG/BxX,EAAI,UAAG2U,EAAKrS,MAAMkV,EAAOnX,OAAQsU,EAAKtU,eAAlC,aAAG,EAAwCgL,QAAQ,MAAO,KAC9D9F,EAAQvF,EAAKsI,MAAM,KAAKhG,OAAO,GAAG,IAAMtC,IAExCA,EAAI,OAAG+c,QAAH,IAAGA,GAAH,UAAGA,EAAKkkB,sBAAR,aAAG,EAAqB34B,MAAM,KAAK,GACvC/C,GAAQ,UAAAwX,EAAIoa,YAAJ,eAAU5xB,QAASwX,EAAIlZ,MAEjC,MAAMyG,EAAMtK,GAAQuF,EACdyF,EAAS,CACbxB,IAAKA,EAAM,IAAMmL,EACjBpG,QAAShJ,EACTiJ,UAAWxO,EACXsK,IAAKA,GAEPmzJ,EAAcnzJ,GAAOU,CAArB,GAnBF,IAsBKyyJ,CAAP,GACC,CAACtzJ,EAAO0/J,cAAergK,EAAKm5B,IAEzB2kC,EAAepoD,uBAAavK,IAC5BA,GACFq8C,EAAQrxD,KAAKgV,EACd,GACA,CAACq8C,IAEJ,OACE,eAAC33C,GAAA,EAAD,CAAK0yB,aAAc,IAAKryB,QAAS,EAAjC,SACE,gBAACslJ,GAAA,EAAD,CAAW79J,KAAG,EAAC4Q,UAAWS,EAAOy+D,UAAjC,UACE,eAAC,GAAD,CACEvmE,QAAS+yJ,EACT3qH,SAAUw0B,EACVv1D,UAAWS,EAAO8sH,YAEpB,eAAC95D,GAAA,EAAD,CACEzzD,UAAWS,EAAOk3J,UAClBhuK,MAAOyO,EAAO0/J,cACdn/J,QAASi4B,EAAiB,CAAC,SAAUp4B,OAAOK,KAAK+3B,EAAe+C,uBAAyB,GACzFk+B,eAAgB54D,GAAUA,EAAOK,QAAQ,UAAW,IACpDynC,SAAU,CAACqlB,EAAGz8D,IAAUijK,EAAU,IAAIx0J,EAAQ0/J,cAAenuK,IAC7DuqE,YAAclxD,GAAW,eAAC+tD,GAAA,EAAD,IACnB/tD,EACJkG,QAAQ,SACR1V,MAAM,SACN+T,OAAO,SACPvH,UAAWS,EAAOm3J,kBAM7B,IAEMnuI,eAAeokI,GAAuB7iJ,GAC3C,GAAIA,EAAIuW,QAAUmQ,GAChB,OAAO,IAAIqmI,GAAkB/sJ,GACxB,GAAIA,EAAIuW,QAAUqQ,GACvB,OAAO,IAAIomI,GAAqBhtJ,GAC3B,GAAIA,EAAIuW,QAAUoQ,GACvB,OAAO,IAAIsmI,GAAmBjtJ,GACzB,GAAIA,EAAIuW,QAAUsQ,GACvB,OAAO,IAAIqmI,GAAmBltJ,GACzB,GAAIA,EAAIuW,QAAUkQ,GACvB,OAAO,IAAI0mI,GAAkBntJ,GACxB,GAAIA,EAAIuW,QAAUuQ,GACvB,OAAO,IAAIsmI,GAAoBptJ,GAE/B,MAAM,IAAIpc,MAAM,mCAEnB,CAED,MAAMypK,WAAwBh4F,GAC5BziE,YAAYoN,GACVlN,QACAhP,KAAKkc,IAAMA,CACZ,CAEgB,kBAACzS,GAChB,GAAY,eAARA,EACF,OAAOs1J,GAAuB/+J,KAAKkc,IAAIjb,KAAK4nC,uBACvC,GAAIp/B,EAAIoG,WAAW,cAAe,CACvC,MAAM25J,EAAe//J,EAAIhC,MAAM,KAAK,GACpC,OAAOs3J,GAAuB/+J,KAAKkc,IAAIwpB,WAAW9I,MAAKuM,GAAeA,EAAYnmC,OAASwmK,IAC5F,CAAM,GAAY,cAAR//J,EACT,OAAOs1J,SAA6BrgI,GAA0B1+B,KAAKkc,KAAKiqB,kBAAkBnmC,KAAKkc,IAAIuW,QAEnG,MAAM,IAAI3yB,MAAM,mBAEnB,CAEe,iBAAC2T,EAAKgtB,GAChBzgC,KAAKkc,IAAIuW,QAAUmQ,IAAe5iC,KAAKkc,IAAIuW,QAAUqQ,KACvD9iC,KAAK0kI,mBAAqBjkG,EAAUR,yBAAyBjgC,KAAKkc,IAAIqW,aAAevyB,KAAKkc,KAE7F,EAGI,MAAM0sJ,WAA4BW,GACtB,kBAAC9/J,GAChB,MAAMggK,EAAc/qI,GAA0B1+B,KAAKkc,KAAK4oB,4BAA4BlI,MAAK1gB,GAAOA,EAAIkkB,iBAAmB32B,IACvH,GAAIggK,EACF,OAAO1K,GAAuB0K,GACzB,CACL,MAAMC,EAAkBhrI,GAA0B1+B,KAAKkc,KAAK2oB,qBAC5D,GAAI6kI,EAAgBjgK,GAClB,OAAO,IAAIkgK,GAAqBD,EAAgBjgK,GAEnD,CAED,OAAOuF,MAAM0iE,YAAYjoE,EAC1B,CACD6G,SACE,OAAO,eAAC,GAAD,GACR,EAGI,MAAM+4J,WAA0BE,GACpB,kBAAC9/J,GAChB,MAAMy2B,EAAalgC,KAAKkc,IAAIqoB,oBAAoB3H,MAAKsD,GAAcA,EAAWl9B,OAASyG,IACvF,OAAIy2B,EACK6+H,GAAuB7+H,GAEzBlxB,MAAM0iE,YAAYjoE,EAC1B,CACD6G,SACE,OAAO,gBAACkmE,GAAD,WACL,eAACmtF,GAAD,CAAcznJ,IAAKlc,KAAKkc,MACxB,eAAC0tJ,GAAD,CAAgB1tJ,IAAKlc,KAAKkc,MAC1B,eAACu6D,GAAD,UACGz2E,KAAKkc,IAAIqoB,oBAAoBpnC,KAAI+iC,GAChC,eAACg2C,GAAD,CAA4BH,QAAS71C,EAAWl9B,KAAhD,SACE,eAAC0V,GAAA,EAAD,UAAawnB,EAAWl9B,QADfk9B,EAAWl9B,YAM7B,EAGI,MAAM2mK,WAA6BJ,GACvB,kBAAC9/J,GAChB,MAAOxI,EAAM+B,GAAQyG,EAAIhC,MAAM,KACzByU,EAAMxS,OAAOK,KAAK/J,KAAKkc,KAC1B/e,KAAIsM,GAAOzJ,KAAKkc,IAAIzS,KACpBvD,QAAO,CAACrL,EAAOspC,IAAQtpC,GAASspC,EAAIljC,GAAM27B,MAAK1gB,GAAOA,EAAIkkB,iBAAmBp9B,KAAO,MACvF,OAAO+7J,GAAuB7iJ,EAC/B,CACD5L,SACE,MAAM6vB,EAAcz2B,OAAOK,KAAK/J,KAAKkc,KAClC/e,KAAIsM,GAAOzJ,KAAKkc,IAAIzS,KACpBvD,QAAO,CAAC2jK,EAAM1lI,KACbA,EAAII,oBAAoBp5B,SAAQ+Q,GAAO2tJ,EAAK/qK,KAAKod,KAC1C2tJ,IACN,IACCC,EAAepgK,OAAOK,KAAK/J,KAAKkc,KACnC/e,KAAIsM,GAAOzJ,KAAKkc,IAAIzS,KACpBvD,QAAO,CAAC2jK,EAAM1lI,KACbA,EAAIqB,qBAAqBr6B,SAAQ+Q,GAAO2tJ,EAAK/qK,KAAKod,KAC3C2tJ,IACN,IAEL,OAAO,gBAACrzF,GAAD,WACL,eAACC,GAAD,CAAatoC,MAAM,WAAnB,SACGhO,EAAYn2B,QAAOkS,IAAQA,EAAI6oB,uBAAsB7R,KAAKu1I,IAAYtrK,KAAI+e,IAAQ,IAAD,EAChF,MAAMzS,EAAG,8BAA0ByS,EAAIkkB,gBACvC,OAAO,eAAC81C,GAAD,CAAgBH,QAAStsE,EAAzB,SACL,eAACiP,GAAA,EAAD,WAAa,UAAAwD,EAAIoa,YAAJ,eAAU5xB,QAASwX,EAAIlZ,QADpByG,EAAlB,MAKJ,eAACgtE,GAAD,CAAatoC,MAAM,qBAAnB,SACGhO,EAAYn2B,QAAOkS,GAAOA,EAAI6oB,uBAAsB7R,KAAKu1I,IAAYtrK,KAAI+e,IAAQ,IAAD,EAC/E,MAAMzS,EAAG,8BAA0ByS,EAAIkkB,gBACvC,OAAO,eAAC81C,GAAD,CAAgBH,QAAStsE,EAAzB,SACL,eAACiP,GAAA,EAAD,WAAa,UAAAwD,EAAIoa,YAAJ,eAAU5xB,QAASwX,EAAIlZ,QADpByG,EAAlB,MAKJ,eAACgtE,GAAD,CAAatoC,MAAM,aAAnB,SACG27H,EAAa52I,KAAKu1I,IAAYtrK,KAAI+e,IAAQ,IAAD,EACxC,MAAMzS,EAAG,+BAA2ByS,EAAIkkB,gBACxC,OAAO,eAAC81C,GAAD,CAAgBH,QAAStsE,EAAzB,SACL,eAACiP,GAAA,EAAD,WAAa,UAAAwD,EAAIoa,YAAJ,eAAU5xB,QAASwX,EAAIlZ,QADpByG,EAAlB,QAMP,EAGH,MAAMs1B,GAAW,SAAkBtuB,GACjC,MAAMqxB,EAAiBW,KACvB,OAAO,gBAAC+zC,GAAD,WACL,eAACC,GAAD,CAAatoC,MAAM,uBAAnB,SACE,eAAC+nC,GAAD,CAAMH,QAAQ,yCAAd,SACE,eAACr9D,GAAA,EAAD,wBAGJ,eAAC+9D,GAAD,CAAatoC,MAAM,UAAnB,SACGzkC,OAAOK,KAAK+3B,EAAe+C,sBAAsB1nC,KAAIsM,GAAO,eAACysE,GAAD,CAAgBH,QAAStsE,EAAzB,SAC3D,eAACiP,GAAA,EAAD,UAAajP,EAAIe,QAAQ,UAAW,OADkCf,OAI1E,eAACgtE,GAAD,CAAatoC,MAAM,sBAAsBuoC,gBAAc,EAAvD,SACG50C,EAAegD,4BAA4B96B,QAAOkS,GAAoB,iBAAbA,EAAIlZ,OAAyB7F,KAAI,CAAC+e,EAAKxe,KAAN,aACzF,eAACw4E,GAAD,CAAcH,QAAS75D,EAAIkkB,eAA3B,SACE,eAAC1nB,GAAA,EAAD,WACG,UAAAwD,EAAIoa,YAAJ,eAAU5xB,QAASwX,EAAIlZ,QAFjBtF,EAD8E,QAShG,EAEM,MAAMurK,WAA0BM,GACrC73F,YAAYjoE,GAAM,IAAD,EACf,GAAIA,EAAIlJ,SAAS,KAAM,CACrB,MAAOU,EAAM+B,GAAQyG,EAAIhC,MAAM,KAC/B,GAAa,qBAATxG,EAA6B,CAC/B,MAAM8mC,EAAkB/nC,KAAKkc,IAAIwoB,0BAA0B9H,MAAK1gB,GAAOA,EAAIlZ,OAASA,IACpF,GAAI+kC,EACF,OAAOg3H,GAAuBh3H,EAEjC,MAAM,GAAa,0BAAT9mC,EAAkC,CAC3C,MAAM8oK,EAAuB/pK,KAAK0kI,mBAAmB9nG,MAAK8C,GAAqBA,EAAkBU,iBAAmBp9B,IACpH,GAAI+mK,EACF,OAAOhL,GAAuBgL,EAEjC,MAAM,GAAa,oBAAT9oK,EAA4B,CACrC,MAAM+oK,EAAiBhqK,KAAKkc,IAAI2pB,cAAcnT,SAAS1vB,IACvD,GAAIgnK,EACF,OAAOjL,GAAuBiL,EAEjC,CACF,CAED,MAAMziI,EAAWvnC,KAAKkc,IAAIoW,YAAY7oB,GACtC,GAAI89B,EACF,OAAOw3H,GAAuBx3H,GAGhC,MAAMT,EAAS,UAAG9mC,KAAKkc,IAAIirB,sBAAZ,aAAG,EAAyBvK,MAAK2iI,GAAQA,EAAKv8J,OAASyG,IACtE,OAAIq9B,EACKi4H,GAAuBj4H,GAGzB93B,MAAM0iE,YAAYjoE,EAC1B,CACD6G,SACE,OAAO,eAAC25J,GAAD,CAAY/tJ,IAAKlc,KAAKkc,IAAKwoH,mBAAoB1kI,KAAK0kI,oBAC5D,EAGH,MAAMwkC,WAA6BK,GACjCz6J,YAAYoN,GACVlN,MAAMkN,GACNlc,KAAKkqK,kBAAoB,IAAIjB,GAAkBjpK,KAAKkc,IAAIqW,YACzD,CACe,iBAAC9e,EAAKgtB,SACdzgC,KAAKkqK,kBAAkB14F,WAAW/9D,EAAKgtB,EAC9C,CACDgxC,UACEzxE,KAAKkqK,kBAAkBz4F,SACxB,CACgB,kBAAChoE,GAAM,IAAD,EACrB,MAAM0gK,EAAY,UAAGnqK,KAAKkc,IAAIirB,sBAAZ,aAAG,EAAyBvK,MAAK1gB,GAAOA,EAAIlZ,OAASyG,IACvE,OAAI0gK,EACKpL,GAAuBoL,GAEzBnqK,KAAKkqK,kBAAkBx4F,YAAYjoE,EAC3C,CACD6G,SACE,OAAO,eAAC85J,GAAD,CAAeluJ,IAAKlc,KAAKkc,IAAKwoH,mBAAoB1kI,KAAKkqK,kBAAkBxlC,oBACjF,EAGH,MAAMykC,WAA2BI,GAC/B73F,YAAYjoE,GAAM,IAAD,EACf,MAAM0gK,EAAY,UAAGnqK,KAAKkc,IAAIirB,sBAAZ,aAAG,EAAyBvK,MAAK1gB,GAAOA,EAAIlZ,OAASyG,IACvE,OAAI0gK,EACKpL,GAAuBoL,GAGzBn7J,MAAM0iE,YAAYjoE,EAC1B,CAED6G,SACE,OAAO,eAAC+5J,GAAD,CAAanuJ,IAAKlc,KAAKkc,KAC/B,EAGH,MAAMktJ,WAA2BG,GAC/Bj5J,SACE,OAAO,gBAACkmE,GAAD,WACL,eAAC,GAAD,CAAYt6D,IAAKlc,KAAKkc,MACtB,eAACouJ,GAAD,CAAmBpuJ,IAAKlc,KAAKkc,QAEhC,EAGH,MAAMotJ,WAA4BC,GAChCj5J,SACE,OAAO,eAACi6J,GAAD,CAAcruJ,IAAKlc,KAAKkc,KAChC,EAGH,SAASsuJ,GAAT,GAAuD,IAA5B,IAACtuJ,EAAD,mBAAMwoH,GAAqB,EACpD,MAAMp7H,EAASwgD,YAAewgE,IACxBmgD,EAAiB3gH,YAAe4+G,IAChC1+J,EAASkS,EAAI6oB,qBAAuB,KAAM,EAAO7oB,IAAQ,IAAD,IAC5D,eAAIA,QAAJ,IAAIA,GAAJ,UAAIA,EAAK4rB,gBAAT,iBAAI,EAAeD,kBAAnB,QAAI,EAA2Bh4B,WAAW,kBAItCqM,EAAI4rB,SAAS9kC,KAAK6M,WAAW,aAG7BqM,EAAI4rB,SAAS9kC,KAAK6M,WAAW,WAGI,QAAjC46J,EAAezB,cACV9sJ,EAAI4rB,SAAS9kC,KAAK6M,WAAW46J,EAAezB,gBAEjD9sJ,EAAIlZ,KAAK6M,WAAW,OACfvG,EAAO20J,mBAEhB,EAGF,OAAO,gBAAC,IAAM1lJ,SAAP,WACL,eAACmyJ,GAAD,CAAsBxuJ,IAAKA,IAC1BA,EAAI2pB,cAAcrmC,OAAS,GAC1B,eAACi3E,GAAD,CAAatoC,MAAM,eAAnB,SACGjyB,EAAI2pB,cAAc1oC,KAAI,CAAC+oC,EAAavmB,KACnC,MAAMlW,EAAG,0BAAsBkW,GACzB+lB,EAAaQ,EAAYR,WACzBilI,EAAM,OAAGjlI,QAAH,IAAGA,OAAH,EAAGA,EAAY9I,MAAKv+B,GAAgB,WAAXA,EAAE2E,OACvC,OAAO,eAACkzE,GAAD,CAAgBH,QAAStsE,EAAzB,SACL,eAAC+O,GAAA,EAAD,CAAKyZ,UAAU,OAAOoa,WAAW,SAAjC,SACE,eAAC3zB,GAAA,EAAD,CAAYuZ,UAAU,OAAO5gB,MAAOs5J,GAAU,QAA9C,SACE,eAACnyJ,GAAA,EAAD,CAAKtK,WAAW,OAAO+jB,UAAU,OAAjC,SACGiU,EAAYljC,YAJHyG,EAAlB,MAYLi7H,EAAmBllI,OAAS,GAC3B,eAACi3E,GAAD,CAAatoC,MAAM,0BAA0BuoC,gBAAc,EAA3D,SACGguD,EAAmBvnI,KAAI,CAACuiC,EAAmB/f,KAC1C,MAAMlW,EAAG,gCAA4Bi2B,EAAkBU,gBACjDsF,EAAahG,EAAkBgG,WAC/BilI,EAAM,OAAGjlI,QAAH,IAAGA,OAAH,EAAGA,EAAY9I,MAAKv+B,GAAgB,WAAXA,EAAE2E,OACvC,OAAO,eAACkzE,GAAD,CAAkBH,QAAStsE,EAA3B,SACL,eAAC+O,GAAA,EAAD,CAAKyZ,UAAU,OAAOoa,WAAW,SAAjC,SACE,eAAC3zB,GAAA,EAAD,CAAYuZ,UAAU,OAAO5gB,MAAOs5J,GAAU,QAA9C,SACE,eAACnyJ,GAAA,EAAD,CAAKtK,WAAW,OAAO+jB,UAAU,OAAjC,SACGyN,EAAkB18B,YAJT2c,EAAlB,MAYN,eAAC82D,GAAD,CAAatoC,MAAM,0BAAnB,SACGjyB,EAAIosB,eAAet+B,QAAOkR,GAAQA,EAAKuX,QAAUqQ,KAAgB94B,OAAOA,GACtE7M,KAAIgtC,IACH,MAAM1gC,EAAM0gC,EAAcnnC,KACpB0iC,EAAayE,EAAczE,WAC3BilI,EAAM,OAAGjlI,QAAH,IAAGA,OAAH,EAAGA,EAAY9I,MAAKv+B,GAAgB,WAAXA,EAAE2E,OACjC2jC,EAAYwD,EAAc/G,UAAYlnB,EAC5C,OAAO,eAACg6D,GAAD,CAAgBH,QAAStsE,EAAzB,SACL,gBAACiP,GAAA,EAAD,CAAYuZ,UAAU,OAAO5gB,MAAOs5J,GAAU,QAA9C,UACE,eAACnyJ,GAAA,EAAD,CAAKtK,WAAW,OAAO+jB,UAAU,OAAjC,SACGkY,EAAcnnC,OAEhBmnC,EAAc3X,SAAW,eAACskD,GAAD,CAAUpyE,MAAM,YACzCylC,EAAcpD,cAAgB,eAAC+vC,GAAD,CAAUpyE,MAAM,gBAC9CiiC,GAAa,eAACmwC,GAAD,CAAUpyE,MAAM,kBAPhB+E,EAAlB,MAaN,eAACgtE,GAAD,CAAatoC,MAAM,uBAAnB,SACGjyB,EAAIosB,eAAet+B,QAAOkR,GAAQA,EAAKuX,QAAUoQ,KAAc74B,OAAOA,GACpE7M,KAAIgtH,IACH,MAAM1gH,EAAM0gH,EAAYnnH,KAClB0iC,EAAaykF,EAAYzkF,WACzBilI,EAAM,OAAGjlI,QAAH,IAAGA,OAAH,EAAGA,EAAY9I,MAAKv+B,GAAgB,WAAXA,EAAE2E,OACjC2jC,EAAYwjF,EAAY/mF,UAAYlnB,EAC1C,OAAO,eAACg6D,GAAD,CAAgBH,QAAStsE,EAAzB,SACL,gBAAC+O,GAAA,EAAD,CAAKyZ,UAAU,OAAOoa,WAAW,SAAjC,UACE,eAAC3zB,GAAA,EAAD,CAAYuZ,UAAU,OAAO5gB,MAAOs5J,GAAU,QAA9C,SACE,eAACnyJ,GAAA,EAAD,CAAKtK,WAAW,OAAO+jB,UAAU,OAAjC,SACGk4F,EAAYnnH,SAGhBmnH,EAAYpjF,cAAgB,eAAC+vC,GAAD,CAAUpyE,MAAM,gBAC5CiiC,GAAa,eAACmwC,GAAD,CAAUpyE,MAAM,kBARhB+E,EAAlB,MAnd0B,MAmfhC,eAAC6gK,GAAD,CAAmBpuJ,IAAKA,IACxB,eAAC0uJ,GAAD,CAAY1uJ,IAAKA,IACjB,eAAC,GAAD,CAAaA,IAAKA,MAErB,CAMD,SAAS+tJ,GAAT,GAAgD,IAA5B,IAAC/tJ,EAAD,mBAAMwoH,GAAqB,EAC7C,MAAMhgI,EAAQsxB,GAAgB9Z,GAAK,GACnC,OAAO,gBAACs6D,GAAD,WACL,eAAC,GAAD,CAAYt6D,IAAKA,EAAK0nJ,UAAU,uBAChC,eAAC8G,GAAD,CAAsBxuJ,IAAKA,EAA3B,SACE,gBAACxD,GAAA,EAAD,WACE,uCADF,QAEGhU,OAGL,eAAC8lK,GAAD,CAAmBtuJ,IAAKA,EAAKwoH,mBAAoBA,MAEpD,CAMD,SAAS0lC,GAAT,GAAmD,IAA5B,IAACluJ,EAAD,mBAAMwoH,GAAqB,EAChD,MAAMxkG,EAAahkB,EAAIqW,YACjB7tB,EAAQsxB,GAAgB9Z,GAAK,GACnC,OAAO,eAAC,IAAM3D,SAAP,UACL,gBAACi+D,GAAD,WACE,eAACmtF,GAAD,CAAcznJ,IAAKA,EAAK2uJ,SAAO,EAACxE,cAAY,EAACzC,UAAU,2BACvD,gBAAC8G,GAAD,CAAsBxuJ,IAAKA,EAA3B,UACE,gBAACxD,GAAA,EAAD,WACE,uCADF,QAEGhU,KAEH,gBAACgU,GAAA,EAAD,WACE,yCADF,QAEGwD,EAAIsW,QAAU,OAAS,cAG5B,eAACo3I,GAAD,CAAgB1tJ,IAAKgkB,IACrB,eAAC0qI,GAAD,CAAY1uJ,IAAKA,IACjB,eAAC,GAAD,CAAaA,IAAKA,IAClB,eAACsuJ,GAAD,CAAmBtuJ,IAAKgkB,EAAYwkG,mBAAoBA,QAG7D,CAMD,SAASgmC,GAAT,GAAgD,IAAD,QAAjB,IAACxuJ,EAAD,SAAM3L,GAAW,EAC7C,MAAMu6J,EAAoB5uJ,EAAIka,eAAiB1sB,OAAOK,KAAKmS,EAAIka,eAC5DpsB,QAAOP,GAAe,kBAARA,IACdtM,KAAIsM,GAAOyS,EAAIka,cAAc3sB,GAAKO,QACjCnP,KAAWA,EAAM+mB,SAAS,gBAAkB/mB,EAAM+mB,SAAS,qBAEzDmpJ,EAAuBD,GAAqBA,EAAkBtrK,OAAS,EAE7E,OAAM+Q,GAAQ,UAAI2L,EAAII,eAAR,OAAI,EAAa9c,QAAU0c,EAAI8uJ,YAAe9uJ,EAAIoa,MAAQ5sB,OAAOK,KAAKmS,EAAIoa,MAAM92B,QAAWurK,EAIlG,gBAACt0F,GAAD,CAAatoC,MAAM,aAAnB,UACJ59B,GACA,UAAA2L,EAAII,eAAJ,eAAa9c,SAAU,gBAACkZ,GAAA,EAAD,WAAY,yCAAZ,QAAkCwD,EAAII,QAAQnf,KAAIwC,GAAC,WAAQA,EAAR,OAAcsN,KAAK,SAC7FiP,EAAI8uJ,YAAc,gBAACtyJ,GAAA,EAAD,WAAY,4CAAZ,KAAgCwD,EAAI8uJ,cACtDthK,OAAOK,KAAKmS,EAAIoa,MAAQ,CAAC,GAAGn5B,KAAI,CAAC8tK,EAASvtK,IACzC,gBAACgb,GAAA,EAAD,WAAoB,6BAAIuyJ,IAAxB,QAA4C/6J,OAAOgM,EAAIoa,KAAK20I,MAA3CvtK,KAElBqtK,EAAuB,GAAK,gBAACryJ,GAAA,EAAD,WAAY,gDAAZ,QAC3BoyJ,EAAkB79J,KAAK,YAXlB,IAaV,CAMD,SAASo9J,GAAT,GAA6B,IAAR,IAACnuJ,GAAM,EAC1B,MAAMxX,EAAQsxB,GAAgB9Z,GAAK,GACnC,OAAO,gBAACs6D,GAAD,WACL,eAAC,GAAD,CAAYt6D,IAAKA,EAAK0nJ,UAAU,wBAChC,gBAAC8G,GAAD,CAAsBxuJ,IAAKA,EAA3B,UACE,gBAACxD,GAAA,EAAD,WACE,uCADF,QAEGhU,KAEqB,cAAvBwX,EAAIjb,KAAKsrB,UACN,gBAAC7T,GAAA,EAAD,WACA,sCADA,QAEC3S,MAAMoR,QAAQ+E,EAAIjb,KAAKqrB,WAAapQ,EAAIjb,KAAKqrB,UAAUrf,KAAK,MAAQiP,EAAIjb,KAAKqrB,UAF9E,OAGwB,SAAvBpQ,EAAIjb,KAAKsrB,WAAT,WAAqCrQ,EAAIjb,KAAKsrB,UAA9C,QAED,eAAC2pD,GAAD,CAAMH,QAAQ,aAAd,SACA,eAACr9D,GAAA,EAAD,UACE,wDAGN,gBAACA,GAAA,EAAD,WACE,uCADF,UAEIwD,EAAIwsB,MAAMz7B,KAAK,MAFnB,OAICiP,EAAIgvJ,SAAW,gBAACxyJ,GAAA,EAAD,WAAY,yCAAZ,eACfwD,EAAIxf,MACH,gBAACgc,GAAA,EAAD,WAAY,sCAAZ,QAA+BwD,EAAIxf,QACpCwf,EAAIivJ,gBACH,gBAACzyJ,GAAA,EAAD,WAAY,gDAAZ,QAAyCwD,EAAIivJ,kBAC9CjvJ,EAAIhE,SACH,gBAACQ,GAAA,EAAD,WAAY,yCAAZ,QAAkCxI,OAAOgM,EAAIhE,YAC9CgE,EAAIgvJ,SAAW,gBAACxyJ,GAAA,EAAD,WAAY,yCAAZ,eACfwD,EAAIgnB,UAAY,gBAACxqB,GAAA,EAAD,WAAY,0CAAZ,kBAEnB,eAACkyJ,GAAD,CAAY1uJ,IAAKA,IACjB,eAAC,GAAD,CAAaA,IAAKA,MAErB,CAKD,SAASquJ,GAAT,GAA8B,IAAR,IAACruJ,GAAM,EAC3B,OAAO,gBAACs6D,GAAD,WACL,eAAC,GAAD,CAAYt6D,IAAKA,EAAK0nJ,UAAU,yBAChC,gBAAC8G,GAAD,CAAsBxuJ,IAAKA,EAA3B,UACE,gBAACxD,GAAA,EAAD,WACE,sCADF,QAEG3S,MAAMoR,QAAQ+E,EAAIjb,KAAKqrB,WAAapQ,EAAIjb,KAAKqrB,UAAUrf,KAAK,MAAQiP,EAAIjb,KAAKqrB,UAFhF,OAG0B,SAAvBpQ,EAAIjb,KAAKsrB,WAAT,WAAqCrQ,EAAIjb,KAAKsrB,UAA9C,QAEFrQ,EAAIwsB,OAAS,gBAAChwB,GAAA,EAAD,WACZ,uCADY,UAEVwD,EAAIwsB,MAAMz7B,KAAK,MAFL,OAIbiP,EAAIhE,SACH,gBAACQ,GAAA,EAAD,WAAY,yCAAZ,QAAkCxI,OAAOgM,EAAIhE,eAEjD,eAAC0yJ,GAAD,CAAY1uJ,IAAKA,IACjB,eAAC,GAAD,CAAaA,IAAKA,MAErB,CAKD,SAAS0uJ,GAAT,GAA4B,IAAD,MAAP,IAAC1uJ,GAAM,EACzB,OAAI,UAACA,EAAIirB,sBAAL,OAAC,EAAoB3nC,OAIlB,eAACi3E,GAAD,CAAatoC,MAAM,aAAnB,SACHjyB,EAAIirB,eAAehqC,KAAKgtK,IAAkB,IAAD,EACvC,MAAM1gK,EAAM0gK,EAAannK,KACnB2jC,EAAYwjI,EAAa/mI,UAAYlnB,EAC3C,OAAO,eAACg6D,GAAD,CAAgBH,QAASo0F,EAAannK,KAAtC,SACL,gBAAC0V,GAAA,EAAD,CAAYuZ,UAAU,OAAtB,UACE,eAACzZ,GAAA,EAAD,CAAKtK,WAAW,OAAO+jB,UAAU,OAAjC,UACG,UAAAk4I,EAAa7zI,YAAb,eAAmB5xB,QAASylK,EAAannK,OAE3CmnK,EAAapjI,cAAgB,eAAC+vC,GAAD,CAAUpyE,MAAM,gBAC7CiiC,GAAa,eAACmwC,GAAD,CAAUpyE,MAAM,kBANhB+E,EAAlB,MAPG,IAkBV,CAKD,SAASmgK,GAAT,GAAgC,IAAD,QAAP,IAAC1tJ,GAAM,EAC7B,OAAO,gBAAC,IAAM3D,SAAP,WACJ2D,EAAI/I,cAAgB+I,EAAI6oB,sBACvB,eAAC0xC,GAAD,CAAatoC,MAAM,cAAnB,SACE,eAAC31B,GAAA,EAAD,CAAKoyB,UAAW,EAAGM,aAAc,EAAjC,SACM,OAAHhvB,QAAG,IAAHA,GAAA,UAAAA,EAAKkkB,sBAAL,SAAqBvwB,WAAW,SAC7B,eAAC6I,GAAA,EAAD,UAAawD,EAAI/I,cACjB,eAAC,GAAD,UAAW+I,EAAI/I,mBAIxB,UAAA+I,EAAIkvJ,aAAJ,eAAW5rK,SACV,eAACi3E,GAAD,CAAatoC,MAAM,QAAnB,SACGjyB,EAAIkvJ,MAAMjuK,KAAI,CAAC6c,EAAMtc,IAAM,+BAC1B,eAAC2c,GAAA,EAAD,CAAMlR,KAAM6Q,EAAZ,SAA2BA,EAAKzZ,SAAS,0BAA4B,eAAiByZ,GAA/Dtc,IADaA,SAM7C,CAKD,SAAS4kJ,GAAT,GAAsC,IAAlB,IAACpmI,KAAQzL,GAAQ,EACnC,OAAO,gBAAC,IAAM8H,SAAP,WACL,eAACorJ,GAAD,CAAcznJ,IAAKA,EAAK2uJ,SAAO,EAACxE,cAAY,KAAK51J,IACjD,eAACm5J,GAAD,CAAgB1tJ,IAAKA,MAExB,CAKD,SAASouJ,GAAT,GAA6C,IAAlB,IAACpuJ,KAAQzL,GAAQ,EAC1C,MAAM,IAACgD,GAAO0E,MACR,WAAC9I,GAAcmD,KACfqhE,EAAOphE,qBAAWgiE,KACjB42F,EAAOC,GAAY5zJ,mBAAS,OAC5B6zJ,EAAWC,GAAgB9zJ,oBAAS,GAErC+zJ,EAAe3zJ,mBAAQ,KAC3B,MAAMhE,EAAO+/D,EAAK//D,KAAKrM,MAAM,KACvBkY,EAAQ7L,EAAK3D,QAAQ,gBAC3B,OAAIwP,GAAS,EACJ7L,EAAKrS,MAAMke,EAAQ,GAAG1S,KAAK,KAE7B,IAAP,GACC,CAAC4mE,IA0BJ,OAxBAj8D,qBAAU,KACJ2zJ,GACF93J,EAAIgC,KAAK,iBAAkB,CACzB2sB,MAAO,UACPruB,MAAO,CACL,iBAAkB,CAAC03J,IAErB5vG,aAAc,CACZ6vG,cAAe,CACb5uH,MAAO,CACL7lC,SAAU,yCACV4hB,WAAY,CACV9hB,UAAW,UAKlB9B,MAAKhC,IACN,MAAM04J,EAAU14J,EAAS4oD,aAAa6vG,cAAc5uH,MAAM1pC,KAC1Dk4J,EAASK,EAAT,IACCx2J,MAAM9F,EACV,GACA,CAACoE,EAAKpE,EAAYk8J,EAAWE,EAAcH,IAEvC,gBAAC,IAAM/yJ,SAAP,WACJ2D,EAAIwpB,YAAcxpB,EAAIwpB,WAAWlmC,OAAS,GAAK,eAACi3E,GAAD,CAAatoC,MAAM,aAAnB,SAC7CjyB,EAAIwpB,WAAWvoC,KAAI,CAACgsC,EAAaxpB,KAAd,aAClB,eAACu2D,GAAD,CAAkBH,QAAS,aAAe5sC,EAAYnmC,KAAtD,SACE,eAAC0V,GAAA,EAAD,WAAa,UAAAywB,EAAY7S,YAAZ,eAAkB5xB,QAASykC,EAAYnmC,QAD3C2c,EADO,MAWrB8rJ,GACC,gBAACh1F,GAAD,CAAatoC,MAAM,QAAnB,WACIo9H,GAAa,eAACjxJ,GAAA,EAAD,CAAQyqD,WAAS,EAAC3qD,QAAQ,WAAW3I,QAAS,IAAM+5J,GAAa,GAAjE,wBACdD,IAAcF,GAAS,eAAC3yJ,GAAA,EAAD,UAAY,+CACnC2yJ,GAASA,EAAM7rK,OAAS,GACvB,eAACwnK,GAAD,CACE5zJ,KAAMi4J,EAAMluK,KAAIyuK,IAAG,CACjBniK,IAAKmiK,EAAI/wK,MACTmI,KAAM4oK,EAAI/wK,MACVA,MAAO+wK,EAAIj+I,UAEb+hH,aAAc,GACdvhG,MAAM,0BAGTk9H,GAA0B,IAAjBA,EAAM7rK,QACd,eAACkZ,GAAA,EAAD,CAAYrH,MAAM,QAAlB,SAA0B,0EAKnC,CAKD,MAAMw6J,GAAmB,CACvB,CAAClpI,IAAc,UACf,CAACC,IAAc,UACf,CAACC,IAAe,WAChB,CAACC,IAAiB,cAClB,CAACC,IAAe,WAChB,CAACC,IAAgB,aAGZ,SAAS2gI,GAAT,GAAyF,IAAnE,IAACznJ,EAAD,SAAMqrB,EAAN,aAAgB8+H,EAAhB,KAA8BjzJ,EAA9B,UAAoCwwJ,EAApC,QAA+CiH,EAA/C,QAAwD55H,GAAU,EAC7F,MAAM5/B,EAAQg1J,EAAe,UAAY,UACzC,IAAI3hK,EAAQmnK,GAAiB3vJ,EAAIuW,OAC7BvW,EAAI6oB,uBACNrgC,GAAS,cAEX,MAAMypC,EAAQk4H,GAAgBwE,EAAU3uJ,EAAIlZ,KAAOgzB,GAAgB9Z,GACnE,OAAO,eAACo7D,GAAD,CACLnpC,MAAOA,EACPlgC,QAASiO,EAAIkkB,gBAAkBlkB,EAAIlZ,KACnC0B,MAAK,UAAKA,GAAL,OAAa2hK,EAAe,cAAgB,IACjDh1J,MAAOA,EACPkmE,gBAAiB8uF,GAAgBnqJ,EAAIlZ,KACrCw0E,gBAAiB6uF,GAAgB9+H,GAA+B,uCAAnBA,EAAS9U,OAAkD8U,EAASvkC,KACjHiuC,QAASA,GACP,eAAC,GAAD,CACEm1D,YAAa,CAAC50F,KAAM,SACpBvD,QAAO,eAAW21J,EAAY,MAAQ,EAA/B,gBACPz1H,MAAK,qBAAiBy1H,EAAY,MAAQ,EAArC,gBACLxwJ,KAAMA,GAAQ8I,KAIrB,CAcM,SAASkqJ,GAAT,GAAyD,IAAhC,IAAClqJ,EAAD,aAAMmqJ,KAAiB51J,GAAQ,EACzD/L,EAAQmnK,GAAiB3vJ,EAAIuW,OAIjC,OAHIvW,EAAI6oB,uBACNrgC,GAAS,cAEJ,gBAACgU,GAAA,EAAD,IAAgBjI,EAAhB,UACJ/L,EAAO2hK,EAAe,cAAgB,KAE1C,CAMD,MAAMyF,GAAc58J,IAAMoI,MAAK,YAA6B,IAAR,IAAC4E,GAAM,EACzD,OAAKA,EAAIka,cAKP,eAACqgD,GAAD,CAAatoC,MAAM,cAAnB,SACE,eAAC,KAAD,CACEnrC,KAAK,gBACLurG,IAAKryF,EAAIka,cACTs4E,iBAAiB,EACjB93B,UAAW,EACX+3B,mBAAmB,MAVhB,IAcV,IAK8B50F,cAAWnI,IAAK,CAC7CvD,KAAM,CACJ09J,KAAM,OACNroH,SAAU,IACV,gBAAiB,CAEfopB,YAAa,GAEf,SAAU,CACRx/D,WAAY,sBACZa,SAAU,GACVD,WAAY,aAMA89J,KAAO,KACd5+G,KAAK,KAGE6+G,KAAK,KACNC,KAAK,KACJC,KAAK,K,qCC36BhB,MAGDv9H,GAAU,CACdjvB,MAAO,CAACjb,MAAO,MAAOyqC,MAAO,QAC7Bt0C,MAAO,CAAC6J,MAAO,SACfzD,KAAM,CAACyD,MAAO,OAAQq0C,YAAa,MAO/BqzH,GAAUl9J,IAAMoI,MAAK,IAA6C,IAA5C,KAAClE,EAAD,QAAO62B,EAAS,cAAeqa,GAAY,EACrE,MAAM,MAACtnC,GAASgC,KACVqtJ,EAAkB,CAAC,EAKzB,OAJIj5J,GAAQA,EAAK,GAAG1O,QAClB2nK,EAAgB3nK,MAAQ,CAACA,MAAO,GAAIyqC,MAAO,UAG7B,IAAT/7B,EACHA,EACE,eAACwnE,GAAD,CACA9pE,YAAU,EACVm5B,QAASA,GAAW,mEACpB10B,WAAY,IAAI82J,KAAoBz9H,IACpCx7B,KAAM,CAACA,KAAMA,GACb4J,MAAOA,IAEP,eAAC,GAAD,CAAa,wBAAgBsnC,EAAhB,kBACf,eAAC0zB,GAAD,GAVJ,IA0BFo0F,GAAQt0H,aAAe,CACrB,cAAe,YAGF04B,UAlDa,2BAkDbA,CAA+B47F,IC9CvC,MACD1nB,GAAQ,CACZ4nB,sBAAuB,CACrBjiB,OAAQ,sBACRC,OAAQ,4BACRjrE,KAAM,kBAERktF,kBAAmB,CACjBliB,OAAQ,sBACRC,OAAQ,iCACRjrE,KAAM,kBAERmtF,uBAAwB,CACtBniB,OAAQ,qBACRC,OAAQ,2BACRjrE,KAAM,OAERotF,wBAAyB,CACvBpiB,OAAQ,SACRC,OAAQ,eACRjrE,KAAM,eAERqtF,oBAAqB,CACnBriB,OAAQ,SACRC,OAAQ,oBACRjrE,KAAM,gBAIJvlE,GAAYC,cAAWnI,IAAK,CAChC8mI,KAAM,CAAC5sG,OAAQ,aAMX6gI,GAAkBz9J,IAAMoI,MAAK,IAM5B,IAN6B,KAClClE,EADkC,WAElCw5J,EAFkC,UAGlC17J,EACA,cAAeozC,KACZijB,GACC,EACJ,MAAM31D,EAAQy6C,eACR16C,EAASmI,MACR6gE,EAAW+lC,GAAgBhpG,mBAChCtE,GAAQ1J,OAAOQ,YAAYR,OAAOK,KAAK26I,IAAOvnJ,KAAI8D,GAAQ,CAACA,EAAM,CAACmS,QA+DpE,OAzDAwE,qBAAU,KACR,IAAKxE,EAEH,YADAstG,EAAah3G,OAAOQ,YAAYR,OAAOK,KAAK26I,IAAOvnJ,KAAI8D,GAAQ,CAACA,EAAM,CAACmS,QAIzE,MAAMunE,EAAY,CAAC,EACnB,IAAK,MAAOlxE,EAAKojK,KAAcnjK,OAAOC,QAAQyJ,GAAO,CACnD,IAAKy5J,EAAW,CACdlyF,EAAUlxE,GAAO,CAACojK,GAClB,QACD,CACD,MAAMxH,EAAQwH,EAAU1vK,KAAIu7I,IAC1B,MAAM,SAACz3B,EAAD,YAAW6rD,EAAX,YAAwBC,GAAeC,GAAet0B,EAAKh6I,EAAGg6I,EAAKrpF,EAAGu9G,GAGtEnyH,EAAS,CACbujE,MAAO,CACL52D,YAAY,EACZ+6D,UAAU,EACVh0E,MAAO,CACL3sC,KAAMkjJ,GAAMj7I,GAAK4gJ,SAGrBpsC,MAAO,CACL72D,YAAY,EACZ+6D,UAAU,EACVh0E,MAAO,CACL3sC,KAAMkjJ,GAAMj7I,GAAK6gJ,SAGrB1sC,YAAY,EACZtV,OAAQ,CACN5pG,EAAG,EACH2wD,EAAG,EACHlhB,MAAO,CACL3sC,KAAMsrK,EACNxlH,KAAM,CACJ91C,KAAM,KAGV4wG,QAAS,QACT6qD,UAAWF,IAGf,MAAO,CACL9rK,KAAMwI,EACNw3G,WACAxmE,SACAtM,OAAW,OAAJuqG,QAAI,IAAJA,OAAA,EAAAA,EAAMh0I,QAAS,GAJxB,IAOFi2E,EAAUlxE,GAAO47J,CAClB,CACD3kD,EAAa/lC,EAAb,GACC,CAACvnE,EAAMw5J,EAAYh7J,IAEf,gBAAC4G,GAAA,EAAD,CAAKjG,QAAQ,OAAO09B,cAAc,SAASnE,OAAO,OAAOD,MAAM,OAA/D,UACJniC,OAAOC,QAAQgxE,GAAWx9E,KAAI,IAAuB,IAArBsM,EAAKojK,GAAe,EAEnD,OADKA,IAAWA,EAAY,CAACA,IACtBA,EAAU1vK,KAAI,CAACtC,EAAO8kB,IAC3B,eAAC,GAAD,CAEEvM,MAAgB,IAAVvY,IAAA,OAA0BA,QAA1B,IAA0BA,OAA1B,EAA0BA,EAAOomH,UACvCxmE,OAAM,OAAE5/C,QAAF,IAAEA,OAAF,EAAEA,EAAO4/C,OACf6gE,WAAU,OAAEzgH,QAAF,IAAEA,OAAF,EAAEA,EAAOszC,MACnB,wBAAgBmW,EAAhB,YAA0B76C,GAC1ByH,UAAWS,EAAO+mI,QACdnxE,GAPN,UACU99D,EADV,YACiBkW,KAFnB,IAYAitJ,IAAe7mK,MAAMoR,QAAQy1J,IAAgB,eAACp0J,GAAA,EAAD,CAAK+9B,KAAK,WAAV,SAC7C,eAAC4jF,GAAD,CAAwBnqD,GAAI,GAA5B,SACE,eAACuqD,GAAD,CACEpsF,MAAM,OACN/6B,KAAMw5J,EACN94J,KAAM,yCApBd,IAkJF,SAASk5J,GAAeE,EAAU95J,EAAMw5J,GACtC,MAAMO,EAA6B,IAAhB/5J,EAAK5T,OAClB4tK,EAAwC,iBAA9BR,EAAWS,eACrBC,EAAa36I,GACnB,IAAIm6I,EAAc,GACdC,EAAc,GAClB,MAAM9rD,EAAW,GACjB,IAAK,IAAIssD,EAAQ,EAAGA,EAAQn6J,EAAK5T,SAAU+tK,EAAO,CAChD,MAAMC,EAAWp6J,EAAKm6J,GACtB,GAAIH,EAAS,CACX,MAAMK,EAAWD,EAAS,GAC1B,IAAK,IAAIE,EAAO,EAAGA,EAAOD,EAASjuK,SAAUkuK,EAC3CzsD,EAASniH,KAAK,CACZJ,EAAGwuK,EACH79G,EAAGo+G,EAASC,GACZ1qK,KAAK,GAAD,OAAKmqK,EAAa,GAAH,UAAWG,EAAWC,IAArC,iBAAsDG,EAAtD,UACJzsK,KAAM,YAGV6rK,EAAW,UAAMK,EAAa,mBAAqB,0BACnDJ,EAAcI,EAAa,GAAK,EACjC,KAAM,CACL,IAAK,IAAInoD,EAAQ,EAAGA,EAAQwoD,EAAShuK,SAAUwlH,EAAO,CACpD,MAAMyoD,EAAWD,EAASxoD,GAC1B,IAAK,IAAI0oD,EAAO,EAAGA,EAAOD,EAASjuK,SAAUkuK,EAC3CzsD,EAASniH,KAAK,CACZJ,EAAGwuK,EACH79G,EAAGo+G,EAASC,GACZ1qK,KAAK,GAAD,OAAKmqK,EAAa,GAAH,UAAWG,EAAWC,IAArC,iBAAsDG,EAAtD,iBAAmEN,EAAU,GAAKpoD,EAAQ,IAAM,KACpG/jH,KAAM,WAGX,CACD6rK,EAAW,UAAMK,EAAa,yBAA2B,gCACzDJ,EAAcI,EAAa,GAAK,EACjC,CACF,CACD,MAAO,CAAClsD,WAAU6rD,cAAaC,cAChC,CAhJDJ,GAAgB70H,aAAe,CAC7B,cAAe,OAiJF04B,UAvSQ,mCAuSRA,CAA0Bm8F,ICpSzC,MAAM7yJ,GAAYC,cAAYnI,IACrB,CACLurG,OAAQ,CACNrsE,IAAKl/B,EAAMkH,QAAQ,IACnBkwC,OAAQ,WAEVjQ,YAAa,CACXjI,IAAKl/B,EAAMkH,QAAQ,IACnBkwC,OAAQp3C,EAAMkH,QAAQ,QA8Ib60J,OAzIcz+J,IAAMoI,MAAK,IAQjC,IAAD,UARmC,GACvC+vG,EADuC,IAEvCV,EAFuC,eAGvCinD,EAHuC,SAIvChnD,EAJuC,GAKvCinD,EALuC,MAMvCluJ,EANuC,QAOvCnP,GACI,EAEJ,MAAMs9J,GAAsB,OAALnuJ,QAAK,IAALA,GAAA,UAAAA,EAAOtJ,eAAP,mBAAgBP,cAAhB,mBAAwBkU,kBAAxB,eAAoCg8H,OAAQ,IAE7D,MAAChpI,GAASgC,KACVqnC,EAAQvuC,mBAAQ,IAAM,IAAIiO,GAASrX,GAAiB,iBAAiB2W,SAASrI,GAAOniB,SAAS,CAACmiB,IAC/F+wJ,EAAWj2J,mBAAQ,MAAQmmG,MAAO,CAAC1jE,WAAW,EAAO8L,MAAOA,MAAU,CAACA,IACvE2nH,EAAYl2J,mBAAQ,MAAQmmG,MAAO,CAAC1jE,WAAW,EAAO8L,MAAOA,MAAU,CAACA,IAGxE4nH,EAAan2J,mBAAQ,IAAM,IAAIo2J,MAAW,IAC1CC,EAAcr2J,mBAAQ,IAAM,IAAIo2J,MAAW,IAG3Cv8J,EAASmI,GAAU,CAACtJ,QAASA,IAG7B49J,EAAsB/vJ,uBAAawxB,IACvC,MAAM1gB,EAAS,CAAC8uF,MAAO,CAAC53D,MAAO,CAACxW,EAAM,kBAAmBA,EAAM,qBAC/Do+H,EAAWpuJ,KAAKsP,EAAhB,GACC,CAAC8+I,IACEI,EAAuBhwJ,uBAAawxB,IACxC,MAAM1gB,EAAS,CAAC8uF,MAAO,CAAC53D,MAAO,CAACxW,EAAM,kBAAmBA,EAAM,qBAC/Ds+H,EAAYtuJ,KAAKsP,EAAjB,GACC,CAACg/I,IAGJ,OAAW,IAAP9mD,IAAwB,IAARV,IAAoC,IAAnBinD,IAAmC,IAAPC,EACxD,eAACh0C,GAAD,UACL,eAACI,GAAD,CAAc9rF,MAAM,YAAY6hC,GAAI,GAAIlkC,OAAO,OAA/C,SACE,eAAC,GAAD,CAAS14B,KAAMwzG,SAIH,IAAPS,IAA6B,IAAbT,IAAyC,IAAnBgnD,IAAmC,IAAPC,EACpE,gBAACh0C,GAAD,WACL,eAACI,GAAD,CAAc9rF,MAAM,iBAAiB6hC,GAAI,EAAzC,SACE,eAAC,GAAD,CACE58D,MAAM,EACNqnC,OAAQszH,EACR/wJ,MAAOA,EACP8+F,cAAesyD,EACfhlE,QAAS,KAAQ6kE,EAAWpuJ,KAAK,CAACo+F,MAAO,CAAC53D,MAAOA,IAAhC,EACjB+1D,cAAe+xD,EACf,cAAY,oBAGhB,eAACl0C,GAAD,CAAc9rF,MAAM,oBAAoB6hC,GAAI,EAA5C,SACE,eAAC,GAAD,CACE58D,KAAMuzG,EACNlsE,OAAQuzH,EACRtyD,iBAAkB/pG,EAAOonC,YACzB4iE,YAAahqG,EAAOwrG,OACpBrB,cAAeuyD,EACfjlE,QAAS,KAAQ+kE,EAAYtuJ,KAAK,CAACo+F,MAAO,CAAC53D,MAAOA,IAAjC,EACjBrpC,MAAOA,EACPo/F,cAAe6xD,EACf,cAAY,yBAKF,IAAP5mD,IAAwB,IAARV,IAA8B,IAAbC,IAAyC,IAAnBgnD,EACzD,eAAC/zC,GAAD,UACL,eAACI,GAAD,CAAc9rF,MAAM,oBAAoB6hC,GAAI,GAAIlkC,OAAO,OAAvD,SACE,eAAC,GAAD,CACE14B,KAAMy6J,EACNjB,WAAYkB,QAMX,gBAACj0C,GAAD,WACL,eAACI,GAAD,CAAc9rF,MAAM,iBAAiB6hC,GAAI,EAAzC,SACE,eAAC,GAAD,CACE58D,KAAMi0G,EACN5sE,OAAQszH,EACR/wJ,MAAOA,EACP8+F,cAAesyD,EACfhlE,QAAS,KAAQ6kE,EAAWpuJ,KAAK,CAACo+F,MAAO,CAAC53D,MAAOA,IAAhC,EACjB+1D,cAAe+xD,EACf,cAAY,oBAGhB,eAACl0C,GAAD,CAAc9rF,MAAM,oBAAoB6hC,GAAI,EAA5C,SACE,eAAC,GAAD,CACE58D,KAAMuzG,EACNlsE,OAAQuzH,EACRtyD,iBAAkB/pG,EAAOonC,YACzB4iE,YAAahqG,EAAOwrG,OACpBrB,cAAeuyD,EACfjlE,QAAS,KAAQ+kE,EAAYtuJ,KAAK,CAACo+F,MAAO,CAAC53D,MAAOA,IAAjC,EACjBrpC,MAAOA,EACPo/F,cAAe6xD,EACf,cAAY,qBAGhB,eAACh0C,GAAD,CAAc9rF,MAAM,iBAAiB6hC,GAAI,EAAzC,SACE,eAAC,GAAD,CACE58D,KAAMw6J,EACN,cAAY,oBAGhB,eAAC3zC,GAAD,CAAc9rF,MAAM,YAAY6hC,GAAI,EAApC,SACE,eAAC,GAAD,CAAS58D,KAAMwzG,OAET,IAAPinD,GACC,eAAC5zC,GAAD,CAAc9rF,MAAM,oBAAoB6hC,GAAI,GAAIlkC,OAAO,OAAvD,SACE,eAAC,GAAD,CACE14B,KAAMy6J,EACNjB,WAAYkB,QAKrB,IC3CYQ,OArGkBp/J,IAAMoI,MAAK,IAAmC,IAAD,UAAjC,MAACqI,EAAD,WAAQq7G,EAAR,QAAoBtrG,GAAa,EAE5E,MAAM6+I,EAAYvzC,EAAWr/G,IAAI,sBAC3B6yJ,EAAYxzC,EAAWr/G,IAAI,kBAC3B8yJ,EAAQzzC,EAAWr/G,IAAI,6BACvB+yJ,EAAa1zC,EAAWr/G,IAAI,iDAC5BgzJ,EAAQ3zC,EAAWr/G,IAAI,+BAG7B,IAAK4yJ,IAAcC,IAAcC,IAAUC,IAAeC,EAAO,OAAO,KAExE,IAAIC,GAAsB,OAAPl/I,QAAO,IAAPA,GAAA,UAAAA,EAASrZ,eAAT,mBAAkB2kH,kBAAlB,mBAA8BirB,kBAA9B,eAA0CjoG,4BAA6B,GAC1F,MAAMppB,EAAU,+EACX7uB,MAAMoR,QAAQy3J,KAAeA,EAAe,CAACA,IAGlD,IAAIjoD,KAAO6nD,IAAaD,SAAaxtK,EACjC2uB,IACE6+I,IAAW5nD,EnGkIZ,SAAuBqU,EAAYtrG,EAASkF,GAAU,IAAD,MAE1D,IAAKomG,EAAWr/G,IAAI,sBAAuB,OAAO,EAGlD,IAAIkzJ,GAAuB,OAAPn/I,QAAO,IAAPA,GAAA,UAAAA,EAASrZ,eAAT,mBAAkB2kH,kBAAlB,mBAA8BirB,kBAA9B,eAA0C6oB,qBAAsB,GAC/E/oK,MAAMoR,QAAQ03J,KAAgBA,EAAgB,CAACA,IACpD,MAAMloD,EAAM,GACZ,IAAK,MAAMj9E,KAAamlI,EAAe,CACrC,GAAInlI,EAAUo7E,gBAA4C,IAA1Bp7E,EAAUt2B,KAAK5T,OAAc,MAC7D,MAAMwlB,EAAI,CACR4+F,SAAU,GACVqB,UAAW,GACXE,sBAAuB,GACvBnE,wBAAyB,GACzB12G,QAAS,OAEX0a,EAAEhiB,KAAO0mC,EAAUhlC,MACnBsgB,EAAE8/F,eAAiBp7E,EAAUo7E,eAC7B,IAAK,MAAM1xG,KAAQs2B,EAAUt2B,KAAM,CAAC,IAAD,EACjC,MAAMqd,EAAQrd,EAAKwwG,SAASnzF,MAAMmE,GAC5B9gB,EAAO2c,EAAQA,EAAM,GAAKrd,EAAKwwG,SAC/BmrD,EAAa37J,EAAKo7B,MAAM/d,MAAMmE,GAC9Bo6I,EAAYv+I,EAAQs+I,EAAW,GAAK37J,EAAKo7B,MACzCygI,EAAgBx+I,EAASf,EAAQwO,eAAezN,EAAM,KAAOf,EAAQwO,eAAe9qB,EAAKwwG,SAASn8G,MAAM,KAAK,IAAOioB,EAC1H,GAAIu/I,EAAe,CACjBjqJ,EAAE4+F,SAAS9kH,KAAKqzB,GAAmBre,EAAMm7J,IACzC,MAAMC,EAAc/8I,GAAmB68I,EAAWC,GAClDjqJ,EAAEigG,UAAUnmH,KAAKowK,EAAYr0K,OAC7BmqB,EAAEmgG,sBAAsBrmH,KAAKowK,EAAYhqD,qBAC1C,CACG9xG,EAAK+7J,YACPnqJ,EAAEg8F,wBAAwBliH,KAAKsU,EAAK+7J,YAEtCnqJ,EAAE4kF,OAAF,iBAAcl6E,QAAd,IAAcA,GAAd,UAAcA,EAASyH,gBAAvB,aAAc,EAAmBmL,SAAjC,yDACD,CACGtd,EAAE4+F,UAAY5+F,EAAEigG,WAAW0B,EAAI7nH,KAAKkmB,EACzC,CACD,OAAsB,IAAf2hG,EAAInnH,QAAuBmnH,CACnC,CmGzKwByoD,CAAcp0C,EAAYtrG,EAASkF,KACnD25I,GAAaC,IAAW7nD,EnG8K1B,SAAuBqU,EAAYtrG,EAASkF,GAAU,IAAD,MAE1D,IAAKomG,EAAWr/G,IAAI,kBAAmB,OAAO,EAG9C,IAAIkzJ,GAAuB,OAAPn/I,QAAO,IAAPA,GAAA,UAAAA,EAASrZ,eAAT,mBAAkB2kH,kBAAlB,mBAA8BirB,kBAA9B,eAA0ChoG,iBAAkB,GAC3El4C,MAAMoR,QAAQ03J,KAAgBA,EAAgB,CAACA,IACpD,MAAMloD,EAAM,GACZ,IAAK,MAAMj9E,KAAamlI,EAAe,CAAC,IAAD,EACrC,MAAM7pJ,EAAI,CAAC1a,QAAS,OACdmmB,EAAQiZ,EAAUk6E,SAASnzF,MAAMmE,GACjC9gB,EAAO2c,EAAQA,EAAM,GAAKiZ,EAAUk6E,SACpCorD,EAAYv+I,EAAQiZ,EAAU8E,MAAMrxC,KAAIi1B,GAAOA,EAAI3B,MAAMmE,GAAS,KAAM8U,EAAU8E,MAClFygI,EAAgBx+I,EAASf,EAAQwO,eAAezN,EAAM,KAAOf,EAAQwO,eAAewL,EAAUk6E,SAASn8G,MAAM,KAAK,IAAOioB,EAC/H,GAAIu/I,EAAe,CACjBjqJ,EAAE4+F,SAAWzxF,GAAmBre,EAAMm7J,GACtC,MAAMC,EAAc/8I,GAAmB68I,EAAWC,GAClDjqJ,EAAEigG,UAAYiqD,EAAY/xK,KAAIwpH,GAAOA,EAAI9rH,QACzCmqB,EAAEmgG,sBAAwB+pD,EAAY/xK,KAAIwpH,GAAOA,EAAIzB,sBACtD,CACDlgG,EAAEhiB,KAAO0mC,EAAUhlC,MACfglC,EAAUk9E,WACZ5hG,EAAEg8F,wBAA0B1jH,KAAK03C,OAAOtL,EAAUk9E,SAASzpH,KAAIuB,GAAKA,EAAEsiH,4BAExEh8F,EAAE4kF,OAAF,iBAAcl6E,QAAd,IAAcA,GAAd,UAAcA,EAASyH,gBAAvB,aAAc,EAAmBmL,SAAjC,sDACItd,EAAE4+F,UAAY5+F,EAAEigG,WAAW0B,EAAI7nH,KAAKkmB,EACzC,CACD,OAAsB,IAAf2hG,EAAInnH,QAAuBmnH,CACnC,CmG1MsC0oD,CAAcr0C,EAAYtrG,EAASkF,KAIxE,IAqCI06I,EArCAjoD,IAAKonD,QAAQ1tK,EACbwuK,IAAKd,QAAQ1tK,EACjB,GAAI2uB,EAAS,CACX23F,EAAK,GACL,IACE,IAAK,MAAM39E,KAAaklI,EAAc,CAAC,IAAD,IACpC,MAAM5pJ,EAAI,CAAC,EACLyL,EAAK,UAAGiZ,EAAUkxE,uBAAb,aAAG,EAA2BnqF,MAAMmE,GACzC9gB,EAAO2c,EAAQA,EAAM,GAAKiZ,EAAUkxE,gBACpC40D,EAAc/+I,EAAQiZ,EAAU/hB,QAAQxqB,KAAIi1B,GAAOA,EAAI3B,MAAMmE,GAAS,KAAM8U,EAAU/hB,QACtFsnJ,EAAgBx+I,EAASf,EAAQwO,eAAezN,EAAM,KAAOf,EAAQwO,eAAewL,EAAUkxE,gBAAgBnzG,MAAM,KAAK,IAAOioB,EACtI1K,EAAE2C,QAAUsnJ,EAAgB98I,GAAmBq9I,EAAaP,GAAiB,KAC7EjqJ,EAAEhiB,KAAO0mC,EAAUhlC,MACnBsgB,EAAE4kF,OAAF,iBAAcl6E,QAAd,IAAcA,GAAd,UAAcA,EAASyH,gBAAvB,aAAc,EAAmBmL,SAAjC,iEACIoH,EAAUk9E,WACZ5hG,EAAEg8F,wBAA0B1jH,KAAK03C,OAAOtL,EAAUk9E,SAASzpH,KAAIuB,GAAKA,EAAEsiH,2BACtEh8F,EAAE4hG,SAAWl9E,EAAUk9E,UAErB5hG,EAAE2C,SAAS0/F,EAAGvoH,KAAKkmB,GACvB,MAAM41F,EAAkBq0D,EAAgB98I,GAAmBre,EAAMm7J,GAAiB,KAC9Er0D,IACF20D,EAAK,CACH30D,gBAAiBA,EACjBjzF,QAAS3C,EAAE2C,SAGhB,CAEF,CADC,MAAO3U,GACR,CACDq0G,EAAmB,IAAdA,EAAG7nH,QAAuB6nH,EAC/BkoD,EAAKA,IAAM,CACZ,CAOD,GAAIb,EAAY,CAEd,SAASe,EAAYvnI,GACnB,IAAK,MAAM+B,KAAW/B,GAAY,GAC3B+B,EAAQ28E,UACb0oD,EAAGxwK,QAAQmrC,EAAQ28E,SAEtB,CAED,GARA0oD,EAAK,GAOLG,EAAYb,GACM,IAAdU,EAAG9vK,OAAc,CAAC,IAAD,MACnB,IAAIkwK,GAAyB,OAAL/vJ,QAAK,IAALA,GAAA,UAAAA,EAAOtJ,eAAP,mBAAgB2kH,kBAAhB,mBAA4BirB,kBAA5B,eAAwCjoG,4BAA6B,GACxFj4C,MAAMoR,QAAQu4J,KAAoBA,EAAoB,CAACA,IAC5DD,EAAYC,EACb,CACDJ,EAAmB,IAAdA,EAAG9vK,QAAuB8vK,CAChC,MACCA,GAAK,EAIP,MAAMzB,EF+ED,SAAgC7yC,EAAYtrG,EAASkF,GAAU,IAAD,MAEnE,IAAKomG,EAAWr/G,IAAI,+BAAgC,OAAO,EAO3D,IAAK+T,EAAS,OAAO,EAGrB,IAAIigJ,GAAsB,OAAPjgJ,QAAO,IAAPA,GAAA,UAAAA,EAASrZ,eAAT,mBAAkB2kH,kBAAlB,mBAA8BirB,kBAA9B,eAA0C/nG,8BAA+B,GACvFn4C,MAAMoR,QAAQw4J,KAAeA,EAAe,CAACA,IAClD,MAAMC,EAAkB,GACxB,IAAK,MAAMlmI,KAAaimI,EAAc,CAAC,IAAD,EAEpC,MAAME,EAAQ,CAAC,EACTC,EAAWpmI,EAAUqmI,IAAMrmI,EAAUqmI,IAAIt/I,MAAMmE,QAAW7zB,EAC1DivK,EAAUF,EAAWA,EAAS,GAAKpmI,EAAUqmI,IAC7CE,EAAyBvmI,EAAUwmI,oBAAsBxmI,EAAUwmI,oBAAoBz/I,MAAMmE,QAAW7zB,EACxGovK,EAAwBF,EAAyBA,EAAuB,GAAKvmI,EAAUwmI,oBACvFE,EAAmBN,EACpBpgJ,EAAQwO,eAAe4xI,EAAS,KAAOpgJ,EAAQwO,eAAewL,EAAUqmI,IAAItoK,MAAM,KAAK,IACxFioB,EACJ,GAAI0gJ,GAAoBJ,EAAS,CAE/BH,EAAME,IAAM59I,GAAmB69I,EAASI,GAAkB7xC,OAC1D,MAAM8xC,EAAoBl+I,GAAmBg+I,EAAuBC,GACpEP,EAAMrD,uBAAyB6D,EAAoBA,EAAkBtP,QAAKhgK,CAC3E,CAGD,MAAMuvK,EAAa,CAAC,EACdC,EAAgB7mI,EAAU8mI,eAAiB9mI,EAAU8mI,eAAe//I,MAAMmE,QAAW7zB,EACrF0vK,EAAeF,EAAgBA,EAAc,GAAK7mI,EAAU8mI,eAC5DE,EAA8BhnI,EAAUinI,mBAAqBjnI,EAAUinI,mBAAmBlgJ,MAAMmE,QAAW7zB,EAC3G6vK,EAA6BF,EAA8BA,EAA4B,GAAKhnI,EAAUinI,mBACtGE,EAA0BnnI,EAAUonI,eAAiBpnI,EAAUonI,eAAergJ,MAAMmE,QAAW7zB,EAC/FgwK,EAAyBF,EAA0BA,EAAwB,GAAKnnI,EAAUonI,eAC1FE,EAAwBT,EACzB7gJ,EAAQwO,eAAeqyI,EAAc,KAAO7gJ,EAAQwO,eAAewL,EAAU8mI,eAAe/oK,MAAM,KAAK,IACxGioB,EACJ,GAAIshJ,GAAyBP,EAAc,CACzCH,EAAWE,eAAiBr+I,GAAmBs+I,EAAcO,GAAuBzyC,OACpF,MAAM0yC,EAAyB9+I,GAAmBy+I,EAA4BI,GAC9EV,EAAWhE,sBAAwB2E,EAAyBA,EAAuBjQ,QAAKjgK,EACxF,MAAMmwK,EAAqB/+I,GAAmB4+I,EAAwBC,GACtEV,EAAW/D,kBAAoB2E,EAAqBA,EAAmBlQ,QAAKjgK,CAC7E,CACD,MAAMowK,EAAW1oJ,GAAaonJ,EAAOS,GAG/Bc,EAAS,CAAC,EACVC,EAAY3nI,EAAU4nI,YAAc5nI,EAAU4nI,YAAY7gJ,MAAMmE,QAAW7zB,EAC3EwwK,EAAWF,EAAYA,EAAU,GAAK3nI,EAAU4nI,YAChDE,EAA0B9nI,EAAU+nI,qBAAuB/nI,EAAU+nI,qBAAqBhhJ,MAAMmE,QAAW7zB,EAC3G2wK,EAAyBF,EAA0BA,EAAwB,GAAK9nI,EAAU+nI,qBAC1FE,EAAsBjoI,EAAUkoI,iBAAmBloI,EAAUkoI,iBAAiBnhJ,MAAMmE,QAAW7zB,EAC/F8wK,EAAqBF,EAAsBA,EAAoB,GAAKjoI,EAAUkoI,iBAC9EE,EAAoBT,EACrB3hJ,EAAQwO,eAAemzI,EAAU,KAAO3hJ,EAAQwO,eAAewL,EAAU4nI,YAAY7pK,MAAM,KAAK,IACjGioB,EACJ,GAAIoiJ,GAAqBP,EAAU,CACjCH,EAAOE,YAAcn/I,GAAmBo/I,EAAUO,GAAmBvzC,OACrE,MAAMwzC,EAAqB5/I,GAAmBu/I,EAAwBI,GACtEV,EAAO3E,wBAA0BsF,EAAqBA,EAAmB/Q,QAAKjgK,EAC9E,MAAMixK,EAAiB7/I,GAAmB0/I,EAAoBC,GAC9DV,EAAO1E,oBAAsBsF,EAAiBA,EAAehR,QAAKjgK,CACnE,CAGD,MAAM8sK,EAAKplJ,GAAa0oJ,EAAUC,GAClCvD,EAAG5sK,KAAOyoC,EAAUzoC,WAAQF,EAC5B8sK,EAAGnpK,MAAQglC,EAAUhlC,YAAS3D,EAC9B8sK,EAAGjkE,OAAH,iBAAel6E,QAAf,IAAeA,GAAf,UAAeA,EAASyH,gBAAxB,aAAe,EAAmBmL,SAAlC,mEAC+B,IAA3B54B,OAAOK,KAAK8jK,GAAIruK,QAA4B,aAAZquK,EAAG5sK,MAAqB2uK,EAAgB9wK,KAAK+uK,EAClF,CAGD,MAAMz6J,EAAO,CAAC,EACd,IAAK,MAAMy6J,KAAM+B,EACf,IAAK,MAAO3uK,EAAMpG,KAAU6O,OAAOC,QAAQ+6I,IACrCmpB,EAAG5sK,IAAS4sK,EAAGhzK,EAAMwkF,QACPjsE,EAAKnS,KAEnBmS,EAAKnS,GAAQ,IAEfmS,EAAKnS,GAAMnC,KAAK,CAACJ,EAAGmvK,EAAGhzK,EAAMwkF,MAAOhwB,EAAGw+G,EAAG5sK,MAIhD,OAAOmS,CACR,CE5KY6+J,CAAuBj3C,EAAYtrG,EAASkF,GAEvD,OAAO,eAACukG,GAAD,CAAchrF,MAAM,wBAApB,SACL,eAAC,GAAD,CACEk5E,GAAIA,EACJV,IAAKA,EACLinD,eAAgB2B,EAChB3oD,SAAU0oD,EACVzB,GAAIA,EACJluJ,MAAOA,KAPX,IClDauyJ,OAhCGhjK,IAAMoI,MAAK,IAAa,IAAZ,KAAClE,GAAU,EACvC,MAAMuD,EAAS,+CACf,OAAgB,IAATvD,EACHA,EACE,gBAACinE,GAAD,WACA,gBAACE,GAAD,WACE,eAACE,GAAD,CAAc5/E,MAAK,OAAEuY,QAAF,IAAEA,OAAF,EAAEA,EAAM++J,WAAYl7J,SAAQ,UAAKN,EAAL,iBAC/C,eAAC8jE,GAAD,CAAc5/E,MAAK,OAAEuY,QAAF,IAAEA,OAAF,EAAEA,EAAMg/J,YAAan7J,SAAQ,UAAKN,EAAL,kBAChD,eAAC8jE,GAAD,CAAc5/E,MAAK,OAAEuY,QAAF,IAAEA,OAAF,EAAEA,EAAMi/J,qBAAsBp7J,SAAQ,UAAKN,EAAL,2BACzD,eAAC8jE,GAAD,CAAc5/E,MAAK,OAAEuY,QAAF,IAAEA,OAAF,EAAEA,EAAMk/J,8BAA+Br7J,SAAQ,UAAKN,EAAL,uCAEpE,gBAAC4jE,GAAD,WACE,eAACE,GAAD,CAAc5/E,MAAK,OAAEuY,QAAF,IAAEA,OAAF,EAAEA,EAAMm/J,uBAAwBt7J,SAAQ,UAAKN,EAAL,6BAC3D,eAAC8jE,GAAD,CAAc5/E,MAAK,OAAEuY,QAAF,IAAEA,OAAF,EAAEA,EAAMo/J,YAAav7J,SAAQ,UAAKN,EAAL,kBAChD,eAAC8jE,GAAD,CAAc5/E,MAAK,OAAEuY,QAAF,IAAEA,OAAF,EAAEA,EAAMq/J,oBAAqBr+H,QAAS,EAAGn9B,SAAQ,UAAKN,EAAL,6BAEtE,gBAAC4jE,GAAD,WACE,eAACE,GAAD,CAAc5/E,MAAK,OAAEuY,QAAF,IAAEA,OAAF,EAAEA,EAAMs/J,SAAUt+H,QAAS,EAAGn9B,SAAQ,UAAKN,EAAL,eACzD,eAAC8jE,GAAD,CAAc5/E,MAAK,OAAEuY,QAAF,IAAEA,OAAF,EAAEA,EAAMu/J,qBAAsBv+H,QAAS,EAAGn9B,SAAQ,UAAKN,EAAL,8BAEvE,eAAC4jE,GAAD,UACE,eAACE,GAAD,CAAc5/E,MAAK,OAAEuY,QAAF,IAAEA,OAAF,EAAEA,EAAMw/J,aAAcx+H,QAAS,EAAG3H,SAAS,OAAOx1B,SAAQ,UAAKN,EAAL,wBAG/E,eAAC,GAAD,IACF,eAACqhE,GAAD,GAvBJ,ICWa66F,OAhBkB3jK,IAAMoI,MAAK,IAGrC,IAHsC,QAC3Cw7J,EAD2C,UAE3CC,GACI,EACJ,OAAO,eAACl5C,GAAD,UACL,eAACI,GAAD,CAAc9rF,MAAM,aAAa6hC,GAAI,GAAIlkC,OAAO,OAAOy8D,UAAU,QAAjE,SACE,eAAC,GAAD,CAAWn1F,KAAM2/J,OAFrB,ICkBaC,OAvBiB9jK,IAAMoI,MAAK,IAAmC,IAAD,UAAjC,MAACqI,EAAD,WAAQq7G,EAAR,QAAoBtrG,GAAa,EAK3E,IAHcsrG,EAAWr/G,IAAI,cAI3B,OAAO,KAIT,MAAMo3J,GAAiB,OAALpzJ,QAAK,IAALA,GAAA,UAAAA,EAAOtJ,eAAP,mBAAgB2kH,kBAAhB,mBAA4Bi4C,sBAA5B,eAA4CC,cAAc,EAE5E,OAAO,eAAC/5C,GAAD,CAAchrF,MAAM,wBAApB,SACL,eAAC,GAAD,CAA0B4kI,UAAWA,KADvC,I,UCIF,MAAMj5J,GAAYC,cAAYnI,IAAD,CAC3B6Y,OAAQ,CACNohB,MAAO,OACPC,OAAQ,QAEVqnI,aAAc,CACZrnI,OAAQ,OACRD,MAAO,OACP99B,UAAW,kBAGTqlK,GAAelkK,IAAMoI,MAAK,IAOzB,IAP0B,YAC/B+7J,EAD+B,QAE/B39J,EAF+B,SAG/BqJ,EAH+B,UAI/B4sF,EAJ+B,aAK/BrC,KACGj5E,GACC,EACJ,MAAM1e,EAASmI,MACT,OAACgyB,EAAD,MAASD,EAAOzZ,IAAKkhJ,GAAmB1mH,gBACvCmgC,EAAS0f,GAAc/0F,sBACvBsqC,EAAS1tC,GAAcoD,oBAAS,IAChC6xF,EAAQgqE,GAAa77J,sBACrB40F,EAAUC,GAAe70F,oBAAS,IAClC8xF,EAAQgqE,GAAa97J,oBAAS,IAC9Bg1F,EAAOC,GAAYj1F,oBAAS,IAC5BoxF,EAAWkB,GAAgBtyF,oBAAS,IACpCuxF,EAAUkB,GAAezyF,oBAAS,IAClCixF,EAAsBoE,GAA2Br1F,oBAAS,IAC1DmxF,EAA6B4qE,GAAiC/7J,oBAAS,IACvEkvF,EAAUC,GAAenvF,mBAAS6uF,GAAUlwB,KAAK5sE,MACjDi/F,EAAiBgrE,GAAsBh8J,oBAAS,IAChDyxF,EAAiBwqE,GAAsBj8J,oBAAS,IAChDsxF,EAAkB4qE,GAAuBl8J,oBAAS,GACnDm8J,EAAWr8I,mBACXs8I,EAAYt8I,mBACZu8I,EAAgBv8I,iBAAO,CAAC,GACxBw8I,EAAex8I,mBACf4lF,EAAY5lF,mBACZw1E,EAAWx1E,kBAAO,GAClBy8I,EAAez8I,mBACf08I,EAAe18I,mBACf28I,EAAoB38I,iBAAO,CAAC,GAC5B48I,EAAoB58I,mBACpB68I,EAAe78I,oBACf,IAAE/jB,GAAQ0E,KACVm8J,EAAanxH,MACZztC,QAAS6+J,GAAV,KAAsBzgK,IAyhBvB,SAA2BiL,EAAUrJ,EAAS29J,GACnD,GAAI9pK,gBAAMwV,IAAaxV,gBAAMmM,IAAYnM,gBAAM8pK,GAC7C,MAAO,CAAC39J,aAAS3U,EAAW+S,UAAM/S,GAMpC,SAASyzK,EAAQ1jI,GACf,IAAIh9B,EAMJ,OALKg9B,EAAI2jI,WAAa3jI,EAAIw6C,QAAU/hF,gBAAMunC,EAAIupB,SAC5CvmD,EAAOg9B,EAAI4jI,UACDnrK,gBAAMunC,EAAIupB,WACpBvmD,EAAO0gK,EAAQnB,EAAYviI,EAAI6jI,iBAE1B7gK,CACR,CACD,IAAIA,EAAO0gK,EAAQnB,EAAYt0J,IAI/B,GAAIjL,IAASA,EAAKjE,WAAW,WAAY,CACvC,MAAM+kK,EAAW/kJ,GAAc/b,GAC/B4B,EAAUk/J,EAASl/J,SAAWA,EAC9B5B,EAAO8gK,EAAS9gK,IACjB,CACD,MAAO,CAAC4B,UAAS5B,OAClB,CApjBqC+gK,CAAkB91J,EAAUrJ,EAAS29J,GACnE/0J,GAAM,OAAG+0J,QAAH,IAAGA,OAAH,EAAGA,EAAct0J,GACvB+1J,GAAiBt9I,iBAAO,GAGxBi3D,GAAS32E,mBAAQ,KAAO,IAAD,EAC3B,MAAM22E,EAAM,OAAG4kF,QAAH,IAAGA,GAAH,UAAGA,EAAct0J,UAAjB,aAAG,EAAyBg2J,QAexC,OAdItmF,EAAS,MACXub,GAAa,GACb4pE,GAAoB,IAElBnlF,EAASkd,GAAald,EAASqmF,GAAeptJ,SAChD6rJ,EACE,0EAAmE5nE,EAAnE,+EACmEld,EADnE,YAGF8d,GAAY,KAEZgnE,IACAhnE,GAAY,IAEP9d,CAAP,GACC,CAACkd,EAAW0nE,EAAat0J,IAG5BnH,qBAAU,KACR,MAAMkmC,EAAQ,OAAGx/B,SAAH,IAAGA,QAAH,EAAGA,GAAQw/B,SACzB,IAAIivC,EACJ,GAAIjvC,EACF,IACEivC,EAAUjvC,EAAS3gD,KAAI4C,IACrB,MAAMi1K,EAAkBj1K,EAAOunB,cACzBswE,EAAe3K,GAAc+nF,GAC7B3jK,EAAQ44E,GAAc+qF,GAC5B,MAAO,CACLtwK,MAAO3E,EACPsR,MAAOA,EAAK,WAAOA,EAAM5C,SAAS,IAAIwmK,SAAS,EAAG,IAAO,UACzD3tF,OAAQ4tF,GAASt9E,IAAiB,GAClCA,aAAcA,GAAgB,EAJhC,GAQH,CADC,MACD,CAEH6U,EAAW1f,EAAX,GACC,CAACzuE,KAGJ,MAAMhO,GAAS+N,uBAAY,KACzBy1J,EAAUpsJ,QAAQpX,QAAlB,GACC,IAGG6zD,GAAe9lD,uBAAY,KAC/By2J,GAAeptJ,QAAU+mE,GACzB8d,GAAY,GACZgnE,GAAW,GACV,CAAC9kF,KAGE0mF,GAAkB92J,uBAAaxjB,IACnCmvG,EAAanvG,GACb,IAAK,MAAMu6K,KAAQ1rK,OAAOsB,OAAOmpK,EAAkBzsJ,SACjD0tJ,EAAK5pF,MAAM6pF,cAAcx6K,EAC1B,GACA,IAGGy6K,GAAiBj3J,uBAAY,CAACxjB,EAAO06K,KACrCA,GAAaprE,EAAYtvG,GAC7B,IAAK,MAAMo3B,KAAavoB,OAAOsB,OAAO+oK,EAAcrsJ,SAAU,CAC5D,MAAM8tJ,EAAWvjJ,EAAUujJ,SACvBA,IAAUA,EAASzvH,QAAUlrD,EAClC,CACDyV,IAAQ,GACP,CAACA,KAGE45F,GAA6B7rF,uBAAY,CAACxjB,EAAO06K,KACjDA,GAAaxoE,EAAwBlyG,GACzC,IAAK,MAAMo3B,KAAavoB,OAAOsB,OAAO+oK,EAAcrsJ,SAAU,CAC5D,MAAMskE,EAAmB/5D,EAAU+5D,iBAC/BA,IAAkBA,EAAiBjmC,QAAUlrD,EAClD,CACDyV,IAAQ,GACP,CAACA,KAGE25F,GAAuB5rF,uBAAawxB,IACxCg3D,EAAYh3D,EAAMlnB,OAAO9tB,OACzBu5K,EAAkB1sJ,QAAQk/E,SAAW/2D,EAAMlnB,OAAO9tB,MAClD46K,GAAmBzB,EAAatsJ,QAAS0sJ,EAAkB1sJ,SAC3DssJ,EAAatsJ,QAAQguJ,SAASrB,EAAa3sJ,QAA3C,GACC,IAUGiuJ,GAAOt3J,uBAAY,KACrB,MAAMkmE,EAAY2vF,EAAaxsJ,QACzBgiE,EAAYuqF,EAAavsJ,QACzBuK,EAAY+hJ,EAAatsJ,QACzB88D,EAAQvyD,EAAUuyD,MAGxBvyD,EAAU2jJ,MAAMC,eAAeC,OAAO,IAAIr5F,YAG1C,MAAM6C,EAAakF,EAgdzB,SAAsB+E,EAAYC,GAE9B,QAAmBzoF,IAAfwoF,EAA0B,OAC9B,GAAIA,EAAW/pF,OAAS,EAAG,MAAMM,MAAM,4CAEvC,MAAMi2K,EAAkB,IAAIt5F,cAC5Bs5F,EAAgB7zE,WAChB,MAAMzY,EAAoB,GACpBnF,EAAUoF,IACd,MAAMn3C,EAAYm3C,EAAU,GACtB/gE,EAAS+gE,EAAU,GASnBC,EARY,CAChBn8B,GAAI,IAAIivB,WAAc,EAAG,EAAG,GAC5BpvB,KAAM,IAAIovB,WAAc,GAAI,EAAG,GAC/BrpC,MAAO,IAAIqpC,YAAe,EAAG,EAAG,GAChC7a,KAAM,IAAI6a,WAAc,EAAG,EAAG,GAC9B9vB,MAAO,IAAI8vB,WAAc,EAAG,GAAI,GAChCu5F,KAAM,IAAIv5F,WAAc,EAAG,EAAG,IAEDlqC,GAGzBq3C,EAAcJ,EAAW7gE,GAC/B,IAAK,MAAMkhE,KAAoBJ,EAC7BG,EAAYC,GAAoB,EAIlC,GAAID,EAAYpqF,SAAW,KAAM,CAC/B,MAAM8/E,GAAa,IAAI7C,eAAmBqN,mBACtCF,EAAYxnE,QAAQ5Y,YACpBmgF,EAAavnE,QAAQ5Y,aAEzBusK,EAAgBE,YAAY32F,GAI5B,IAAK,MAAM4U,KAAO1K,EACdA,EAAW0K,GAAK9xE,QAAQ49D,gBAAgBV,GAG1B,UAAd/sC,GAAuC,SAAdA,EACzBk3C,EAAkB3qF,KAAK,KACF,OAAdyzC,GAAoC,SAAdA,EAC7Bk3C,EAAkB3qF,KAAK,KACF,UAAdyzC,GAAuC,SAAdA,GAChCk3C,EAAkB3qF,KAAK,IAE5B,GAIH,IAAK,MAAM4qF,KAAaH,EACpBjF,EAAOoF,GAEX,OAAOqsF,CACV,CAvgBSG,CAAaxsF,EAAW,CAAC/pF,EAAG6kF,EAAM,GAAIl8D,EAAGk8D,EAAM,GAAInmF,EAAGmmF,EAAM,KAC5D,IAAI/H,cAGR,IAAK,MAAM9uB,KAAY42B,EAAW,CAChC,MAAM4xF,EAAmB,IAAI15F,cAC7B05F,EAAiBC,aAAa,IAAI35F,YAAe9uB,EAASxwD,KAAIyI,IAAMA,EAAI,IAAMtI,KAAKuB,OACnFygF,EAAW22F,YAAYE,EACxB,CAEDlkJ,EAAUyyD,YAAYpF,EAAtB,GACD,IAGG+qB,GAAchsF,uBAAY,KAAO,IAAD,IACpCs3J,KACA3B,EAAatsJ,QAAQguJ,SAASrB,EAAa3sJ,SAES,KAA/B,OAAjB0sJ,QAAiB,IAAjBA,GAAA,UAAAA,EAAmB1sJ,eAAnB,mBAA4B2yC,eAA5B,eAAqC76D,SACvCw0K,EAAatsJ,QAAQkuJ,MAAMC,eAAeh4F,MAAM,GACjD,GACA,CAAC83F,KAGEr0H,GAAejjC,uBAAY,CAACwtB,EAAOC,KAChCkoI,EAAatsJ,UAClB01F,EAAU11F,QAAQtW,MAAMy6B,MAAxB,UAAmCA,EAAnC,MACAuxE,EAAU11F,QAAQtW,MAAM06B,OAAxB,UAAoCA,EAApC,MACA+nI,EAASnsJ,QAAQ45B,eACjB0yH,EAAatsJ,QAAQguJ,SAASrB,EAAa3sJ,SAA3C,GACD,IAGHwrD,2BAAgB,KACd5xB,GAAazV,EAAOC,EAApB,GACC,CAACD,EAAOC,EAAQwV,KAEnB,MAAM8oD,GAAmB/rF,uBAAY,KACnCirF,GAAgBA,GAAhB,GACC,CAACA,IAEE+sE,GAAuBh4J,uBAAYsc,UACvC,IAAKk5I,EAASnsJ,QAAS,OACvB,MAAMu7D,QAAgB4wF,EAASnsJ,QAAQ4uJ,YACvC,IACEljJ,GAASpwB,EAAO,OAAQigF,EAEzB,CADC,MAAOjwE,GACR,IACA,IAGH4E,qBAAU,KACR,MACMg+J,EAAQ,IAAIW,KAChBn5D,EAAU11F,QACV,CACE5Z,gBAAiB,QACjB0oK,WAAY,eACZC,SAAU,EACVC,QAPiB,IAQjBC,SAAU,EACV56F,UAAW,EACX66F,QAAS,EACTC,OAXiB,MAcrBhD,EAASnsJ,QAAUkuJ,EACnB9B,EAAUpsJ,QAAUkuJ,EAAMtmE,MAA1B,GACC,IAQH,MAAMwnE,GAAgBz4J,uBAAYsc,MAAOrc,EAAQ5I,EAAS5B,EAAMijK,EAAc1D,KAG5E,IACIhlK,EADA4jB,EAAY8hJ,EAAcrsJ,QAAQqvJ,GAEtC,IAAK9kJ,EAAW,CACd,MAAM+kJ,QAAuBvjK,EAAIQ,IAAJ,kBAChByB,GACX,CAAC5B,KAAMA,EAAM8X,OANF,OAOX,CAACq7E,aAAc,SAOX98B,QAAe6sG,EAAev1K,MAAM,CAAC,GAAI,CAAC,MAAMD,OACtD,IACI7B,EAAG2oB,EAAGjqB,EADNkG,EAAM,EAAC,GAAM,GAAM,GAEvB,MAAM0yK,EAAa,oBACnB,IAAK,MAAMp8K,KAASsvE,EAAO1iE,MAAM,MAAO,CACtC,MAAMyvK,EAAU,iBACVC,EAAU,iBACVC,EAAU,iBACVC,EAAY,iBAClB,GAAIx8K,EAAMgV,WAAWqnK,GACnBv3K,EAAI9E,EAAM4G,MAAMy1K,EAAQ13K,QAAQixB,MAAMwmJ,GAAY95K,KAAK8I,GAAMgC,WAAWhC,UACnE,GAAIpL,EAAMgV,WAAWsnK,GAC1B7uJ,EAAIztB,EAAM4G,MAAM01K,EAAQ33K,QAAQixB,MAAMwmJ,GAAY95K,KAAK8I,GAAMgC,WAAWhC,UACnE,GAAIpL,EAAMgV,WAAWunK,GAC1B/4K,EAAIxD,EAAM4G,MAAM21K,EAAQ53K,QAAQixB,MAAMwmJ,GAAY95K,KAAK8I,GAAMgC,WAAWhC,UACnE,GAAIpL,EAAMgV,WAAWwnK,GAAY,CAAC,IAAD,EACtC,MAAMpjD,EAAQ,cACd1vH,EAAG,UAAG1J,EAAM41B,MAAMwjG,UAAf,aAAG,EAAoB92H,KAAK8I,GAAY,SAANA,GACtC,CACF,CAUD,SAASqxK,EAAQxmI,GACf,OAASA,EAAI2jI,WAAa3jI,EAAIw6C,QAAU/hF,gBAAMunC,EAAIupB,SAC9CvpB,EACAwmI,EAAQjE,EAAYviI,EAAI6jI,eAC7B,CAKD,SAAS4C,EAAkBzmI,GACzB,MAAM26D,EAAiB36D,EAAI0rF,gBACrBg7C,EAA+B,YAAnB/rE,EACZgsE,EAAgC,aAAnBhsE,EACbpxC,EAAUvpB,EAAIupB,SACdo9G,GAAcD,EACd1mI,EAAIupB,QAAQ,GACZvpB,EAAIupB,SAASkkE,OACfl4E,gBAAMvV,EAAIikI,SACR2C,EAAO5mI,EAAIupB,QAAJ,WACLA,EAAQptD,KAAK,MACjB,MAGE0qK,EAAW1lJ,EAAUslJ,kBACzB,WACA,CACEK,YAAa,UACbC,WAAY,QACZC,UAAW,GACXJ,SAIEK,EAAW9lJ,EAAUslJ,kBAAkB,YAAa,CAACS,YAAa,GAAKN,SAC7EvD,EAAkBzsJ,QAAQopB,EAAI4jI,WAAa,CACzClpF,MAAOmsF,EACPrsF,MAAOysF,EACPL,KAAMA,EACNr9G,QAASA,EACTusC,SAAW4wE,GAAaC,EAAclxE,GAAUC,OAAO/8F,IAAM88F,GAAUlwB,KAAK5sE,KAE9E,IAAK,MAAMisB,KAASob,EAAImnI,eAAiB,GAClCviJ,EAAM41D,OAAOisF,EAAkB7hJ,EAEvC,CAaD,GAhEAzD,QAAkB4hJ,EAASnsJ,QAAQwwJ,SACjClB,EACA,CAACmB,IAtCU,MAsCGC,uBAAuB,IAUvC/pK,EAAOipK,EAAQh5J,GAwCfi5J,EAAkBlpK,GAYd1O,GAAK2oB,GAAKjqB,EAAG,CAAC,IAAD,EACfsB,GAAI,IAAI88E,YAAgBuZ,UAAUr2F,GAClC2oB,GAAI,IAAIm0D,YAAgBuZ,UAAU1tE,GAClCjqB,GAAI,IAAIo+E,YAAgBuZ,UAAU33F,GAClC,MAAMg6K,EAAQ,UAAGhqK,SAAH,aAAG,EAAMlQ,KACvB8zB,EAAUslJ,kBAAkB,WAAY,CAAC5rI,QAAS,IAIlD,MAAMirC,EAAY,CAAgB,IAAfj3E,EAAEH,SAA+B,IAAf8oB,EAAE9oB,SAA+B,IAAfnB,EAAEmB,UACnD4kE,EAAQ,MAAgBrjE,IAAfs3K,EAAS14K,OAAgCoB,IAAfs3K,EAAS/vJ,OAAgCvnB,IAAfs3K,EAASh6K,GACtEmmF,EAAQ,CAAC7kF,EAAG2oB,EAAGjqB,GACfi6K,EAAa,GACbC,EAAe,GACrB,IAAK,IAAI76K,EAAI,EAAGA,EAAIk5E,EAAUp3E,SAAU9B,EAAG,CACrBk5E,EAAUl5E,GAEzB66K,EAAaz5K,KAAKpB,GADL46K,EAAWx5K,KAAK0lF,EAAM9mF,GAEzC,CACD,GAA0B,IAAtB46K,EAAW94K,OAAc,CAC3B,MAAM60F,GAAW,IAAI5X,YAAgBmD,aACnC04F,EAAW,GACXA,EAAW,IACX9uK,YACFg7E,EAAM+zF,EAAa,IAAMlkF,CAC1B,CACD,MAAMmkF,GAAa,IAAI/7F,YAAgBg8F,UAAUj0F,EAAM,GAAIA,EAAM,GAAIA,EAAM,IACrEk0F,EAAaF,EAAWp2J,QAAQu1E,SAEhCx5F,EAuUd,SAAoB4K,EAAQy7E,EAAO5N,EAAWvlE,EAAO21C,EAAW0kC,EAAUC,GACtE,MAAMxtF,EAAO,IAAIs+E,YACjB,IAAIqb,EAEAA,EADe,IAAbpM,GAA8B,IAAZC,EACL,IAAIlP,sBAAyB,CACxCprE,MAAOA,EACP21C,UAAWA,EACX0kC,SAAUA,EACVC,QAASA,IAGE,IAAIlP,qBAAwB,CACvCprE,MAAOA,EACP21C,UAAWA,IAInB,SAAS2xH,EAAQnzF,GACf,MAAMyS,GAAe,IAAIxb,mBAAuB6I,cAAcE,GACxD/2D,EAAO,IAAIguD,QAAWwb,EAAcH,GAC1C35F,EAAKsH,IAAIgpB,GACTA,EAAKknE,sBACN,CAED,IAAK,IAAItQ,EAAMb,EAAMhlF,OAAQ9B,EAAI,EAAGA,EAAI2nF,IAAO3nF,EAAG,CAE9C,GADyBk5E,EAAUl5E,GACb,SACtB,MAAMq6F,EAAcvT,EAAM9mF,GAI1Bi7K,EADgB,CAAC5vK,EAAQgvF,EAAY31E,QAAQ3c,IAAIsD,KAIjD,MAAM6vK,GAAel7K,EAAI,GAAK2nF,EACxBwzF,EAAoBjiG,EAAUgiG,GAC9B1gF,EAAiB1T,EAAMo0F,GAAax2J,QAC1C,IAAKy2J,EAAmB,CAEtBF,EADgB,CAACzgF,EAAe91E,QAAQ3c,IAAIsD,GAASgvF,EAAY31E,QAAQ3c,IAAIyyF,GAAgBzyF,IAAIsD,IAElG,CAGD,MAAM+vK,GAAcp7K,EAAI,GAAK2nF,EACvB0zF,EAAmBniG,EAAUkiG,GAC7BxgF,EAAgB9T,EAAMs0F,GAAY12J,QACxC,IAAK22J,EAAkB,CAErBJ,EADgB,CAACrgF,EAAcl2E,QAAQ3c,IAAIsD,GAASgvF,EAAY31E,QAAQ3c,IAAI6yF,GAAe7yF,IAAIsD,IAEhG,CAGD,IAAK8vK,IAAsBE,EAAkB,CAE3CJ,EADgB,CAACzgF,EAAe91E,QAAQ3c,IAAI6yF,GAAe7yF,IAAIsD,GAASgvF,EAAY31E,QAAQ3c,IAAIyyF,GAAgBzyF,IAAI6yF,GAAe7yF,IAAIsD,IAExI,CACJ,CACD,OAAO5K,CACV,CAjYoBgyF,CACX,IAAI1T,WACJ+H,EACA5N,EACA,OACA,EACA,EACA,GAEFoiG,GAAmB76K,EAAM01K,EAASnsJ,SAClC,MAAMskE,EAybd,SAAgCxH,EAAOoH,EAAahV,EAAWxS,EAAOv6D,GAAU,IAAD,gDAE7E,MAAMmiF,EAAmB,IAAIvP,SACvBpiC,EAAMxwC,EAGNgoF,EAAkB,GACxB,IAAK,IAAIjoB,EAAM,EAAGA,EAAM,IAAKA,EAAK,CAC9B,MAAMkoB,EAAKlG,EAAYhiB,GACjBmoB,EAAKnG,GAAahiB,EAAM,GAAK,GAC7BooB,EAAKpG,GAAahiB,EAAM,GAAK,GACnC,GAAIkoB,IAAOC,IAAOC,EAAI,CAClBH,EAAgB/yF,KAAK8qE,GACrB,KACH,CAAM,GAAIkoB,GAAMC,IAAOC,EAAI,CACxBH,EAAgB/yF,KAAK8qE,GACrBioB,EAAgB/yF,MAAM8qE,EAAM,GAAK,GACjC,KACH,CACJ,CAGD,MAAMqvG,EAAY,EACZC,EAAa,IAEnB,IAAIjnF,GAAU,EACd,MAAMC,EAAkB,GACxBA,EAAgBpzF,KAAKu7C,EAAI16C,EAAE0R,OAC3B6gF,EAAgBpzF,KAAKu7C,EAAI/xB,EAAEjX,OAC3B6gF,EAAgBpzF,KAAKu7C,EAAIh8C,EAAEgT,OAC3B,MAAM8gF,EAAc,GACpBA,EAAYrzF,KAAKu7C,EAAIipC,MAAMjyE,OAC3B8gF,EAAYrzF,KAAKu7C,EAAIyxC,KAAKz6E,OAC1B8gF,EAAYrzF,KAAKu7C,EAAI0xC,MAAM16E,OAC3B,MAAM+gF,EAAoB,GAC1BA,EAAkBtzF,UAAkCiC,KAA7B,UAAAs5C,EAAIipC,aAAJ,mBAAWzW,cAAX,eAAmBx7D,OAAsBgpC,EAAIwyB,OAAOx7D,MAAQgpC,EAAIipC,MAAMzW,OAAOx7D,OACpG+gF,EAAkBtzF,UAAiCiC,KAA5B,UAAAs5C,EAAIyxC,YAAJ,mBAAUjf,cAAV,eAAkBx7D,OAAsBgpC,EAAIwyB,OAAOx7D,MAAQgpC,EAAIyxC,KAAKjf,OAAOx7D,OAClG+gF,EAAkBtzF,UAAkCiC,KAA7B,UAAAs5C,EAAI0xC,aAAJ,mBAAWlf,cAAX,eAAmBx7D,OAAsBgpC,EAAIwyB,OAAOx7D,MAAQgpC,EAAI0xC,MAAMlf,OAAOx7D,OACpG,MAAMghF,EAAoB,GAC1BA,EAAkBvzF,UAAkCiC,KAA7B,UAAAs5C,EAAIipC,aAAJ,mBAAWzW,cAAX,eAAmBhhC,OAAsBwO,EAAIwyB,OAAOhhC,MAAQwO,EAAIipC,MAAMzW,OAAOhhC,OACpGwmD,EAAkBvzF,UAAiCiC,KAA5B,UAAAs5C,EAAIyxC,YAAJ,mBAAUjf,cAAV,eAAkBhhC,OAAsBwO,EAAIwyB,OAAOhhC,MAAQwO,EAAIyxC,KAAKjf,OAAOhhC,OAClGwmD,EAAkBvzF,UAAkCiC,KAA7B,UAAAs5C,EAAI0xC,aAAJ,mBAAWlf,cAAX,eAAmBhhC,OAAsBwO,EAAIwyB,OAAOhhC,MAAQwO,EAAI0xC,MAAMlf,OAAOhhC,OACpG,MAAMymD,EAAc,CAACj4C,EAAI0xC,MAAMrnF,MAAO21C,EAAIipC,MAAM5+E,MAAO21C,EAAIyxC,KAAKpnF,OAC1D+lF,EAAa,CAACpwC,EAAI16C,EAAE+E,MAAO21C,EAAI/xB,EAAE5jB,MAAO21C,EAAIh8C,EAAEqG,OAC9C6tF,EAAgB,CAACl4C,EAAI0xC,MAAMnQ,QAASvhC,EAAIipC,MAAM1H,QAASvhC,EAAIyxC,KAAKlQ,SAChE4W,EAAe,CAACn4C,EAAI16C,EAAEi8E,QAASvhC,EAAI/xB,EAAEszD,QAASvhC,EAAIh8C,EAAEu9E,SACpD6W,EAAY,GAClBA,EAAU3zF,UAAoBiC,IAAfs5C,EAAI16C,EAAE2nD,KAAqBjN,EAAIiN,KAAOjN,EAAI16C,EAAE2nD,MAC3DmrC,EAAU3zF,UAAoBiC,IAAfs5C,EAAI/xB,EAAEg/B,KAAqBjN,EAAIiN,KAAOjN,EAAI/xB,EAAEg/B,MAC3DmrC,EAAU3zF,UAAoBiC,IAAfs5C,EAAIh8C,EAAEipD,KAAqBjN,EAAIiN,KAAOjN,EAAIh8C,EAAEipD,MAC3D,MAAMorC,EAAgB,GACtBA,EAAc5zF,UAAoBiC,IAAfs5C,EAAI16C,EAAE6R,KAAqB6oC,EAAI7oC,KAAO6oC,EAAI16C,EAAE6R,MAC/DkhF,EAAc5zF,UAAoBiC,IAAfs5C,EAAI/xB,EAAE9W,KAAqB6oC,EAAI7oC,KAAO6oC,EAAI/xB,EAAE9W,MAC/DkhF,EAAc5zF,UAAoBiC,IAAfs5C,EAAIh8C,EAAEmT,KAAqB6oC,EAAI7oC,KAAO6oC,EAAIh8C,EAAEmT,MAC/D,MAAMmhF,EAAe,GACrBA,EAAa7zF,UAA8BiC,KAAzB,UAAAs5C,EAAI16C,SAAJ,mBAAOktE,cAAP,eAAex7D,OAAsBgpC,EAAIwyB,OAAOx7D,MAAQgpC,EAAI16C,EAAEktE,OAAOx7D,OACvFshF,EAAa7zF,UAA8BiC,KAAzB,UAAAs5C,EAAI/xB,SAAJ,mBAAOukD,cAAP,eAAex7D,OAAsBgpC,EAAIwyB,OAAOx7D,MAAQgpC,EAAI/xB,EAAEukD,OAAOx7D,OACvFshF,EAAa7zF,UAA8BiC,KAAzB,UAAAs5C,EAAIh8C,SAAJ,mBAAOwuE,cAAP,eAAex7D,OAAsBgpC,EAAIwyB,OAAOx7D,MAAQgpC,EAAIh8C,EAAEwuE,OAAOx7D,OACvF,MAAMuhF,EAAe,GACrBA,EAAa9zF,UAA8BiC,KAAzB,UAAAs5C,EAAI16C,SAAJ,mBAAOktE,cAAP,eAAehhC,OAAsBwO,EAAIwyB,OAAOhhC,MAAQwO,EAAI16C,EAAEktE,OAAOhhC,OACvF+mD,EAAa9zF,UAA8BiC,KAAzB,UAAAs5C,EAAI/xB,SAAJ,mBAAOukD,cAAP,eAAehhC,OAAsBwO,EAAIwyB,OAAOhhC,MAAQwO,EAAI/xB,EAAEukD,OAAOhhC,OACvF+mD,EAAa9zF,UAA8BiC,KAAzB,UAAAs5C,EAAIh8C,SAAJ,mBAAOwuE,cAAP,eAAehhC,OAAsBwO,EAAIwyB,OAAOhhC,MAAQwO,EAAIh8C,EAAEwuE,OAAOhhC,OACvF,MAAMgnD,EAAa,GACnBA,EAAW/zF,UAAwBiC,IAAnBs5C,EAAIipC,MAAMh8B,KAAqBjN,EAAIiN,KAAOjN,EAAIipC,MAAMh8B,MACpEurC,EAAW/zF,UAAuBiC,IAAlBs5C,EAAIyxC,KAAKxkC,KAAqBjN,EAAIiN,KAAOjN,EAAIyxC,KAAKxkC,MAClEurC,EAAW/zF,UAAwBiC,IAAnBs5C,EAAI0xC,MAAMzkC,KAAqBjN,EAAIiN,KAAOjN,EAAI0xC,MAAMzkC,MACpE,MAAMwrC,EAAiB,GACvBA,EAAeh0F,UAAwBiC,IAAnBs5C,EAAIipC,MAAM9xE,KAAqB6oC,EAAI7oC,KAAO6oC,EAAIipC,MAAM9xE,MACxEshF,EAAeh0F,UAAuBiC,IAAlBs5C,EAAIyxC,KAAKt6E,KAAqB6oC,EAAI7oC,KAAO6oC,EAAIyxC,KAAKt6E,MACtEshF,EAAeh0F,UAAwBiC,IAAnBs5C,EAAI0xC,MAAMv6E,KAAqB6oC,EAAI7oC,KAAO6oC,EAAI0xC,MAAMv6E,MAIxE,IAAK,IAAIuhF,EAAa,EAAGA,EAAa,IAAKA,EAAY,CACrDd,GAAU,EACV,MAAMe,EAAYvI,EAAWwH,GACvBgB,EAAYf,EAAgBD,GAC5BiB,EAAWT,EAAUR,GACrBkB,EAAeT,EAAcT,GAC7BmB,EAAgBN,EAAeb,GAC/BnlB,EAAc8lB,EAAaX,GAC3BlK,EAAc4K,EAAaV,GAC3BoB,EAAYR,EAAWZ,GACvBqB,EAAanB,EAAYF,GACzBsB,EAAajB,EAAYL,GACzBuB,EAAmBpB,EAAkBH,GACrCwB,EAAmBpB,EAAkBJ,GACrCyB,EAAclB,EAAaP,GAC3B0B,EAAepB,EAAcN,GAE7B2B,EAAahd,EAAUmc,GACvBc,EAAajd,GAAWmc,EAAa,GAAK,GAC1Ce,EAAald,GAAWmc,EAAa,GAAK,GAC1ComF,EAAS/0G,EAAM2uB,GACfqmF,EAASh1G,GAAO2uB,EAAa,GAAK,GAClCgB,EAAYvP,EAAMuO,GAClBiB,EAAYxP,GAAOuO,EAAa,GAAK,GAAG3wE,QACxC6xE,EAAYzP,GAAOuO,EAAa,GAAK,GAAG3wE,QAG9C,GAAIsxE,IAAgBE,GAAculF,EAAQ,CACxC,MAAMpwK,EAAS,IAAI0zE,WAAc,EAAG,EAAG,GACjCyX,EAAMH,EAAU3xE,QAGhB+xE,EAAUD,EAAI9xE,QACfo+D,eAAe,IACpB,IAAI4T,EACAC,EACJ,GAAIR,GAAcC,EACdO,EAAW,IAAI5X,WAAc,EAAG,EAAG,GACnC2X,GAAc,IAAI3X,YAAgBmD,aAAamU,EAAWM,QACvD,GAAIR,EACPQ,GAAW,IAAI5X,YAAgBmD,aAAamU,EAAWE,GACvDG,GAAc,IAAI3X,YAAgBmD,aAAamU,EAAWM,QACvD,GAAIP,EACPO,GAAW,IAAI5X,YAAgBmD,aAAamU,EAAWC,GACvDI,GAAc,IAAI3X,YAAgBmD,aAAamU,EAAWM,OACvD,CACH,MAAMC,GAAe,IAAI7X,YAAgBmD,aAAamU,EAAWC,GAC3DO,GAAe,IAAI9X,YAAgBmD,aAAamU,EAAWE,GACjEG,GAAc,IAAI3X,YAAgBjiD,IAAI85D,GAAc7uF,IAAI8uF,EAC3D,CACDH,EAAY5qF,YACZ4qF,EAAY5T,eAAe,IAC3B2T,EAAQ1uF,IAAI2uF,GAEZ,MAAMI,EAAkB1M,GACpBqM,EACAnB,EACAC,EACAC,EACAC,EACA,IAAI1W,WAAc,EAAK,GACvB3P,EACAib,GAEJiE,EAAiBvmF,IAAI+uF,GACrB/J,EAAW3rF,KAAK01F,GAGhB,MAAMC,EAAqB,IAAIhY,qBAAwB,CACnDprE,MAAO4hF,EACPyB,aAAa,EACb/oD,QAAS,MAEPgpD,EAAaZ,EAAU3xE,QACvBwyE,EAAiBzN,GAAep+E,EAAOqZ,QAASuyE,EAAWvyE,QAAQ3c,IAAIsD,GAAS,IAAM,GAAI0rF,GAChGzI,EAAiBvmF,IAAImvF,GAGrB,MAAMC,EAAmB,IAAIpY,qBAAwB,CACjDprE,MAAO,YAELyjF,EAAYtQ,EAAMuO,GAAY3wE,QAC9B2yE,EAAUD,EAAU1yE,QAAQo+D,eAAe,EAAI04F,EAAapkF,EAAUt1F,UACtEw1F,EAAqB7N,GAAep+E,EAAOqZ,QAAS2yE,EAAS,IAAM,GAAIF,GAC7E7I,EAAiBvmF,IAAIuvF,GAGrB,MAAMC,EAAgB,IAAIxY,oBAAuB,EAAG,GAAM,GAAK,IACzDyY,EAAgB,IAAIzY,qBAAwB,CAC9CprE,MAAO4nK,IAELtxF,EAAQ,IAAIlL,QAAWwY,EAAeC,GAC5CvN,EAAM98C,SAAS80C,KAAKuU,GACf1T,eAAe,EAAI04F,EAAahlF,EAAI10F,UACzCmoF,EAAM/G,OAAO,IAAInE,YACjBkL,EAAMwN,SAAS73F,KAAKuB,GAAK,GACzBmtF,EAAiBvmF,IAAIkiF,EACtB,CAGD,GAAIgM,IAAiBC,IAAeC,GAAcslF,GAAUC,EAAQ,CAClE,MAAMhkF,EAAc,IAAI3Y,sBAAyB,CAC7CprE,MAAO4nK,EACPjyH,UAAW,EACX0kC,SAAU,GACVC,QAAS,KAGP0J,GAAS,IAAI5Y,YAAgBmD,aAAamU,EAAWC,GACrDr1F,EAAQo1F,EAAUuB,QAAQtB,GAC1BqlF,EAAY,EACZC,EAAY,EACZhyF,EAAShqF,KAAK03C,IAClB13C,KAAK+J,IAAI,EAAI,EAAI0sF,EAAUv0F,SAAU,EAAI,EAAIw0F,EAAUx0F,SAAU65K,GACjEC,GASI/jF,EAAa,GACb/P,EARQ,IAAI/I,gBACd,EAAG,EACH6K,EAAQA,EACR,EAAG3oF,GACH,EACA,GAGiB62F,gBAAgBD,GAC/BE,GAAc,IAAIhZ,mBAAuB6I,cAAcE,GACvDkQ,EAAM,IAAIjZ,QAAWgZ,EAAaL,GACxCM,EAAIC,uBAIJ,MAAMC,EAAQ,IAAInZ,WAAc,EAAG,EAAG,GAChC6C,GAAa,IAAI7C,eAAmBqN,mBACtC8L,EACA7B,EAAU3xE,QAAQ5Y,aAEtBksF,EAAIpW,WAAWK,KAAKL,GAKpB,MAAMuW,EAAgBJ,EAAYtyD,WAAW0H,SAAS42C,MAChDqU,EAAYD,EAAcr2F,OAAS,EACnCu2F,GAAoB,IAAItZ,YAAgBuZ,UAAUH,EAAiC,GAAjBC,EAAY,IACpFJ,EAAIhQ,oBACJ,MAAMuQ,EAAoBP,EAAIQ,aAAaH,EAAkB3zE,SAGvDi9D,EAAO0U,EACPoC,GAAY,IAAI1Z,YACjBmD,aAAaP,EAAM4W,GACxB,IAAIG,EAAaf,EAAOC,QAAQa,IACb,IAAI1Z,YAClBmD,aAAaoU,EAAWiC,GACKl5F,IAAIsiF,GACjB,IACjB+W,GAAcA,GAElBV,EAAIP,QAAQiB,GAGZV,EAAIhQ,oBACJgQ,EAAIW,eACJ,MAAMC,EAAgBZ,EAAIQ,cAAa,IAAIzZ,YAAgBuZ,UAAUH,EAAsC,GAAtBN,EAAa,EAAI,KAChGgB,EAAgBD,EAAc92F,SACpC82F,EAAc9V,eAAe,EAAI,GAAM+V,GACvC,MAAMC,EAAgB1O,GAClBwO,EACA/C,EAAW9kF,WACX6kF,EACAD,EACAD,EACA,IAAI3W,WAAc,EAAK,GACvBgX,EACAD,GAEJxH,EAAiBvmF,IAAI+wF,GACrBxK,EAAiBvmF,IAAIiwF,EACtB,CACF,CACD,OAAO1J,CACR,CAvrBgCutF,CACvB/0F,EACAjgF,EACAqyE,EACAxS,EACA,CACI9c,KAAM,2BACN91C,KAAM,GACNq7D,OAAQ,CAAChhC,MAAO,IAAMx6B,MAAO,QAC7B1R,EAAG,CAACi8E,SAAS,EAAMvqE,MAAO,UAAW3M,MAAO,KAC5C4jB,EAAG,CAACszD,SAAS,EAAMvqE,MAAO,UAAW3M,MAAO,KAC5CrG,EAAG,CAACu9E,SAAS,EAAMvqE,MAAO,UAAW3M,MAAO,KAC5C4+E,MAAO,CAAC1H,SAAS,EAAMvqE,MAAO,UAAW3M,MAAO,UAChDonF,KAAM,CAAClQ,SAAS,EAAMvqE,MAAO,UAAW3M,MAAO,UAC/CqnF,MAAO,CAACnQ,SAAS,EAAMvqE,MAAO,UAAW3M,MAAO,YAGtDs0K,GAAmBhtF,EAAkB6nF,EAASnsJ,SAC9CuK,EAAUujJ,SAAWr3K,EACrB8zB,EAAUymJ,WAAaA,EACvBzmJ,EAAUumJ,WAAaA,EACvBvmJ,EAAUuyD,MAAQA,EAClBvyD,EAAU1tB,IAAMA,EAChB0tB,EAAU+5D,iBAAmBA,CAC9B,CACF,CACDgoF,EAAatsJ,QAAUuK,EACvB8hJ,EAAcrsJ,QAAQqvJ,GAAgB9kJ,CAAtC,GAGC,CAACxe,IA+GJ,OA5GAmE,qBAAU,KAER,GAAIrO,gBAAMuK,IAIR,OAHA0/J,GAAU,GACV7mE,GAAS,QACTK,EAAStlF,SAAU,GAKrB,MAAMqvJ,EAAY,UAAMxC,GAAN,YAAoBzgK,IAClCvK,gBAAMwqK,EAAcrsJ,QAAQqvJ,KAC9BziK,GAAW,GAEbq4F,GAAS,GACTK,EAAStlF,SAAU,EACnB8rJ,GAAU,GAGLlnE,GAILwqE,GAAcx4J,GAAQi2J,GAAYzgK,GAAMijK,EAAc1D,GACnDl+J,MAAMm/J,GACNxxH,SAAQ,KAEP,IAAK,MAAOr5C,EAAKwoB,KAAcvoB,OAAOC,QAAQoqK,EAAcrsJ,SAC1DuK,EAAUojJ,cAAc5rK,IAAQstK,GAElCpqE,GAAS,GACTK,EAAStlF,SAAU,CAAnB,GARJ,GAUC,CAACpJ,GAAQi2J,GAAYzgK,GAAMu/J,EAAa5/J,EAAK6gK,EAAYwC,GAAexqE,IAG3E10F,qBAAU,KACR,IAAK80F,IAAUM,EAAStlF,UAAYpJ,GAAQ,OAG5C,MAAMk7J,EAAel7J,GACfm7J,EAAYn7J,GAAOq2J,cACnBlpE,EAAiB+tE,EAAah9C,gBAC9Bg7C,EAA+B,YAAnB/rE,EACZgsE,EAAgC,aAAnBhsE,EACbiuE,EAA6B,UAAnBjuE,GAAqD,cAAvB+tE,EAAa90K,MACrDi1K,EAAcH,EAAaluF,OAAUkuF,EAAa/E,WAAalrK,gBAAMiwK,EAAan/G,UAAao9G,GAAcD,EAC7GoC,EAAcJ,EAAavB,cAC7B,IAAIv8J,IAAI89J,EAAavB,cAAc96K,KAAIuB,GAAKA,EAAE89H,mBAC9C,IAAI9gH,IACFm+J,EAAiBH,GAAW14G,kBAAQ44G,EAAa,IAAIl+J,IAAI,CAAC,aAG1Do+J,EAAiB3F,EAAkBzsJ,QAAQiyJ,EAAc56J,EAAW06J,GAC1E,GAAIK,EAAgB,CAClB1F,EAAkB1sJ,QAAUoyJ,EAC5BzF,EAAa3sJ,QAAb,OAAuBoyJ,QAAvB,IAAuBA,OAAvB,EAAuBA,EAAgBpC,KAGvC,MAAMqC,EAAS,IAAIr+J,IAAI,CAACqD,IAGlB21E,EAAc,IAAIh5E,IAAKg+J,GAA8B,oBAAnBjuE,EAAwC,CAACguE,GAAa,IAGxFO,IAAgBvC,GAAcD,GAAaqC,GAC7CG,GACF1E,GAAersE,GACfiB,GAA2BjB,KAE3BqsE,IAAe,GAAO,GACtBprE,IAA2B,GAAO,IAEpCypE,GAAoBqG,GACpBtG,GAAoBiG,GACpB9yE,EAAYizE,EAAelzE,UAC3B6sE,GAA+BuG,GAG/B,IAAK,MAAOvwK,EAAK5O,KAAU6O,OAAOC,QAAQwqK,EAAkBzsJ,SAAU,CACpE,MAAMuyJ,EAAeF,EAAOp+J,IAAIlS,GAAO,EAAIirF,EAAY/4E,IAAIlS,GAAO,GAAM,EACpEwwK,GACFp/K,EAAMywF,MAAM4uF,cAAc,CAACvuI,QAASsuI,IACpCp/K,EAAM2wF,MAAM0uF,cAAc,CAACvuI,QAASsuI,IACpCp/K,EAAMywF,MAAM+pF,eAAc,GAC1Bx6K,EAAM2wF,MAAM6pF,cAAcvsE,KAE1BjuG,EAAMywF,MAAM4uF,cAAc,CAACvuI,QAAS,IACpC9wC,EAAMywF,MAAM+pF,eAAc,GAC1Bx6K,EAAM2wF,MAAM6pF,eAAc,GAE7B,CACDI,GAAmBzB,EAAatsJ,QAASoyJ,GAI1B,IADA,IAEb7F,EAAavsJ,QAAU,CAAC,CAAC,KAAM,KAAM,CAAC,QAAS,MAC/CwsJ,EAAaxsJ,QAAU,CAAC,CAAC,EAAG,GAAI,GAAI,CAAC,GAAI,EAAG,KAE9C2iF,IACD,CACD/1F,GAAW,EAAX,GAIC,CAACyK,EAAUT,GAAQouF,EAAO4oE,GAAgBprE,GAA4BG,KAElE,eAAC,GAAD,CACLhB,iBAAkBgtE,GAClB/sE,aAAcc,GACdhB,QAASiB,GACTzD,SAAUA,EACV6B,iBAAkBwB,GAClBvB,gBAAiBA,EACjBC,qBAAsBA,EACtBC,uBAAwBsB,GACxBrB,4BAA6BA,EAC7ByD,SAAUA,EACV5pC,SAAUyB,GACV2kC,UAAWA,EACXC,YAAaosE,GACbnsE,iBAAkBA,EAClBC,SAAUA,EACVC,WAAYosE,GACZnsE,gBAAiBA,EACjB1uG,OAAO,EACPsyF,QAASA,EACT/qC,QAASA,EACTwnD,OAAQA,EACR/a,OAAQA,GACR8a,OAAQA,EAGRI,qBAAsBpgG,gBAAK,OAAC+U,SAAD,IAACA,QAAD,EAACA,GAAQ+7C,UAAY9wD,gBAAM+U,GAAOm2J,WAC7D9oE,UAAWA,EACXj2F,QAAS6+J,GACTzgK,KAAMiL,KACFsR,EA9BC,SAgCL,sBAAK+B,IAAKkhJ,EAAiBpiK,UAAWS,EAAOwhK,aAA7C,SACE,sBAAK/gJ,IAAKgrF,EAAWlsG,UAAWS,EAAO8Y,YAjC3C,IAkDF2oJ,GAAat7H,aAAe,CAC1B6zD,UAAW,KAGEn7B,UAAiB,4BAAjBA,CAA8C4iG,IA8f7D,SAAStrF,GACPj9C,EACAnmC,EACA2M,EACA/D,EACAa,GAIC,IAHDuY,EAGA,4DAHS3lB,EACT+rE,EAEA,uDAFc,EACdib,EACA,uDADc,OAEd,MAAMt9D,EAASpY,SAASqY,cAAc,UAChClZ,EAAO,IACbiZ,EAAOohB,MAAQr6B,EACfiZ,EAAOqhB,OAASt6B,EAChB,MAAMw2E,EAAMv9D,EAAOG,WAAW,MAGxBs9D,EAAa,GACnBF,EAAIC,UAAY52E,EAChB22E,EAAI1gC,KAAJ,UAAc4gC,EAAa12E,EAA3B,cAAqClE,GACrC06E,EAAI77C,UAAY,SAChB67C,EAAIG,aAAe,SACfrb,EAAc,IACdkb,EAAII,UAAYtb,EAAct7D,EAC9Bw2E,EAAIK,YAAcN,EAClBC,EAAIM,WAAW5jF,EAAO8M,EAAO,EAAGA,EAAO,IAE3Cw2E,EAAIO,SAAS7jF,EAAO8M,EAAO,EAAGA,EAAO,GAErC,MAAMg3E,EAAU,IAAI/L,WAAchyD,GAClC+9D,EAAQC,aAAc,EACtB,MAAM5+D,EAAW,IAAI4yD,kBAAqB,CAAEt/E,IAAKqrF,IAC3CE,EAAS,IAAIjM,UAAa5yD,GAChC6+D,EAAOxgE,MAAM5O,IAAInL,EAAUA,EAAU,QAGtBpN,IAAX2lB,IACAA,EAAS,IAAI+1D,WAAc,EAAG,IAElC,MAAMkM,EAAa,IAAIlM,WACvBkM,EAAWhI,WAAWj6D,EAAQ,IAAI+1D,WAAc,GAAK,KACrDiM,EAAOE,OAAOjJ,KAAKgJ,GAEnB,MAAME,EAAY,IAAIpM,YAItB,OAHAoM,EAAUh+C,SAAS80C,KAAK90C,GACxBg+C,EAAUpjF,IAAIijF,GAEPG,CACR,CAUD,SAAS1B,GAAeC,EAAMC,EAAMC,EAAQC,EAAW19D,GACrD,MAAM0oB,GAAY,IAAIkqC,YAAgBgE,WAAW4G,EAAMD,GACjDI,EAASj1C,EAAU/yC,SACnBioF,EAAUl1C,EAAUnwB,QAAQslE,aAAaF,GACzCG,EAAQ,IAAIlL,eAAkBgL,EAASL,GACvCQ,EAAe,IAAInL,oBAAuB6K,EAAQA,EAAQE,EAAQD,GAClEM,EAAO,IAAIpL,QAAWmL,EAAc/9D,GAI1C,OAHAg+D,EAAKl6B,SAASgyB,KAAKgI,EAAMh6B,SAASvrC,SAClCylE,EAAKh9C,SAAS80C,MAAK,IAAIlD,YAAgBkE,WAAWyG,EAAM70C,EAAUiuC,eAAe,MAE1EqH,CACR,CAYD,SAASmxF,GAAmB/pH,EAAQ2mH,GAClC,MAGMuE,EAHQvE,EAAMtmE,OAAO7pB,MACCiR,gBAAgB,iBACLA,gBAAgB,oBACjBA,gBAAgB,cAIxCyjF,EAAa5pK,SAAS4pK,EAAa5pK,SAAS/Q,OAAS,GAC7DiG,IAAIwpD,EACX,CAQD,SAASwmH,GAAmBxjJ,EAAW6nJ,GACrC,IAAIM,EACJ,MAAM//G,EAAUy/G,EAAez/G,QACzBusC,EAAWkzE,EAAelzE,SAC1BpiB,EAAQvyD,EAAUuyD,MAClBk0F,EAAazmJ,EAAUymJ,WACvBF,EAAavmJ,EAAUumJ,WACvBj0K,EAAM0tB,EAAU1tB,IAEtB,IAAKigF,EAAO,OACZ,IAAKjgF,EAAInC,MAAKzC,GAAKA,IAAI,OAIvB,GAAI4J,gBAAMuwK,EAAeO,SAAU,CACjCP,EAAeO,QAAU,GACzB,IAAK,MAAM16J,KAAS06C,EAAS,CAC3B,MAAMigH,EAAKroJ,EAAU46D,UAAU0tF,aAAa56J,GAC5Cm6J,EAAeO,QAAQv7K,KAAKw7K,EAAGE,kBAAkB,IAAI/9F,YACtD,CACF,CAGD,GAAImqB,IAAaL,GAAUlwB,KAAK5sE,IACzBF,gBAAMuwK,EAAeW,UAGxBL,EAASN,EAAeO,QAAQl9K,KAAIwG,GAC3BA,EAAIye,QAAQ47E,aAAa06E,KAElCgC,GAAcN,EAAQ1B,EAAYn0K,GAClC61K,EAASA,EAAOj9K,KAAIwG,GAAOA,EAAIq6F,aAAaw6E,KAC5CsB,EAAeW,QAAUL,GAPzBA,EAASN,EAAeW,aAUrB,GAAI7zE,IAAaL,GAAUC,OAAO/8F,IACvC,GAAKF,gBAAMuwK,EAAea,WAEnB,CACL,MAAMC,EAAUd,EAAeO,QAAQl9K,KAAIwG,GAClCA,EAAIye,QAAQ47E,aAAa06E,KAE5BmC,EAiFZ,SAA8BD,EAASr2K,GACrC,MAAMqkF,EAAS,IAAIkyF,KACbtsI,EAAQosI,EAAQp7K,OACtB,IAAK,MAAMu7K,IAAS,CAAC,EAAG,EAAG,GAAI,CAE3B,IAAIC,EACJ,GAFaz2K,EAAIw2K,GAEP,CACR,IAAIE,EAAQ,EACRC,EAAU,EACd,IAAK,MAAMv3K,KAAOi3K,EAAS,CACzB,MACMO,EAAoB,EADRx3K,EAAIm8F,aAAai7E,GACLz9K,KAAKuB,GACnCo8K,GAAS39K,KAAKC,IAAI49K,GAClBD,GAAW59K,KAAKG,IAAI09K,EACrB,CACD,MAAMC,EAASH,EAAQzsI,EACjB6sI,EAAWH,EAAU1sI,EAE3BwsI,GADkB19K,KAAKg+K,OAAOD,GAAWD,GAAU99K,KAAKuB,KAC9B,EAAIvB,KAAKuB,GACpC,KAAM,CACL,IAAI0pB,EAAM,EACV,IAAK,MAAM5kB,KAAOi3K,EAChBryJ,GAAO5kB,EAAIm8F,aAAai7E,GAE1BC,EAAazyJ,EAAMqyJ,EAAQp7K,MAC5B,CACDopF,EAAOmX,aAAag7E,EAAOC,EAC9B,CACD,OAAOpyF,CACR,CA9GyB2yF,CAAqBX,EAAS3oJ,EAAU1tB,KAC5D61K,EAASQ,EAAQz9K,KAAIwG,GAAOA,EAAI8B,IAAI,IAAIq1K,KAAQ,GAAK,GAAK,IAAKtgJ,IAAIqgJ,MACnEH,GAAcN,EAAQ1B,EAAYn0K,GAClC61K,EAASA,EAAOj9K,KAAIwG,GAAOA,EAAIq6F,aAAaw6E,KAC5CsB,EAAea,UAAYP,CAC5B,MAVCA,EAASN,EAAea,cAYrB,IAAI/zE,IAAaL,GAAUxjF,SAAStZ,IAGzC,MAAM3J,MAAM,8BAFZs6K,EAASN,EAAeO,OAGzB,CAID,IAAI38K,EAAI,EACR,IAAK,MAAMiiB,KAAS06C,EAAS,CAChBpoC,EAAU46D,UAAU0tF,aAAa56J,GACzC67J,oBAAoBpB,EAAO18K,MAC5BA,CACH,CAIDu0B,EAAU46D,UAAU4uF,gBAAa16K,EACjCkxB,EAAU46D,UAAU6uF,kBACpB,IACEzpJ,EAAU0pJ,uBAEX,CADC,MACD,CACF,CAUD,SAASjB,GAAcE,EAASlC,EAAYn0K,GAC1C,MAAMq3K,EAAM,IACNC,EAAW,IAAIp/F,WAAcm/F,EAAKA,EAAKA,GAAK59E,aAAa06E,GAAYhxG,UAErEtjC,EADS,CAAC,GAAK,GAAK,IACLjnC,KAAI,CAACyrF,EAAQlrF,IAAM6G,EAAI7G,GAAKkrF,EAAS,GAAMizF,EAASn+K,GAAK,IAC9E,IAAK,IAAI2nF,EAAMu1F,EAAQp7K,OAAQ9B,EAAI,EAAGA,EAAI2nF,IAAO3nF,EAAG,CAClD,MAAM27F,EAAWuhF,EAAQl9K,GACzB,IAAK,IAAIA,EAAI,EAAGA,EAAI,IAAKA,EAAG,CAC1B,IAAK6G,EAAI7G,GAAI,SAEb,IAAIo+K,GADSziF,EAASyG,aAAapiG,GACV0mC,EAAM1mC,IAAM,EAAK0mC,EAAM1mC,GAE5Co+K,GAAaD,EAASn+K,KAAIo+K,GAAa,GAC3CziF,EAAS0G,aAAariG,EAAGo+K,EAC1B,CACF,CACF,CAGD,MAAM7uF,GAAgB,CACpB8uF,EAAG,EAAGC,EAAG,EAAGC,EAAG,EAAGC,GAAI,EAAGC,GAAI,EAAGC,GAAI,EAAG1uF,EAAG,EAAG2uF,EAAG,EAAGC,EAAG,EAAGC,EAAG,EAAGC,EAAG,EAAGC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,EAAG,GAAIC,EAAG,GAAIC,GAAI,GAAIC,GAAI,GAAIC,EAAG,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,EAAG,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIrhL,EAAG,GAAIshL,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIj9E,EAAG,GAAIk9E,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,EAAG,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,EAAG,GAAIC,GAAI,GAAIC,GAAI,GAAI9vB,GAAI,GAAI+vB,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,GAAIC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,KAE/6BhO,GAAW,CACf,EAAG,IAAK,EAAG,IAAK,EAAG,KAAM,EAAG,KAAM,EAAG,KAAM,EAAG,IAAK,EAAG,KAAM,EAAG,KAAM,EAAG,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,IAAK,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,EAAK,GAAI,EAAK,GAAI,EAAK,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,IAAK,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,EAAK,GAAI,KAAM,GAAI,IAAK,GAAI,IAAK,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,IAAK,GAAI,KAAM,GAAI,EAAK,GAAI,EAAK,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,KAAM,GAAI,IAAK,GAAI,KAAM,GAAI,KAAM,GAAI,EAAK,GAAI,IAAK,GAAI,EAAK,GAAI,IAAK,GAAI,EAAK,GAAI,EAAK,GAAI,EAAK,GAAI,EAAK,GAAI,EAAK,GAAI,EAAK,GAAI,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,EAAK,IAAK,GAEnmCjrF,GAAgB,CACpB,EAAK,SAAU,GAAM,SAAU,GAAM,SAAU,GAAM,SAAU,EAAK,SAAU,EAAK,QAAU,EAAK,QAAU,EAAK,SAAU,EAAK,QAAU,GAAM,SAAU,GAAM,SAAU,GAAM,QAAU,GAAM,SAAU,GAAM,OAAU,EAAK,SAAU,EAAK,SAAU,GAAM,QAAU,GAAM,QAAU,EAAK,QAAU,GAAM,QAAU,GAAM,SAAU,GAAM,SAAU,EAAK,SAAU,GAAM,QAAU,GAAM,SAAU,GAAM,SAAU,GAAM,SAAU,GAAM,QAAU,GAAM,SAAU,GAAM,QAAU,GAAM,SAAU,GAAM,QAAU,GAAM,SAAU,GAAM,SAAU,GAAM,SAAU,GAAM,QAAU,GAAM,QAAU,GAAM,MAAU,EAAK,QAAU,GAAM,QAAU,GAAM,QAAU,GAAM,QAAU,GAAM,QAAU,GAAM,QAAU,GAAM,OAAU,GAAM,MAAU,GAAM,SAAU,GAAM,SAAU,GAAM,SAAU,GAAM,QAAU,GAAM,SAAU,GAAM,SAAU,EAAK,QAAU,GAAM,QAAU,GAAM,QAAU,GAAM,MAAU,GAAM,QAAU,GAAM,SAAU,GAAM,SAAU,GAAM,SAAU,GAAM,SAAU,GAAM,QAAU,GAAM,QAAU,GAAM,QAAU,GAAM,QAAU,GAAM,QAAU,GAAM,MAAU,GAAM,MAAU,GAAM,MAAU,GAAM,MAAU,GAAM,MAAU,GAAM,QAAU,GAAM,QAAU,EAAK,QAAU,GAAM,QAAU,GAAM,QAAU,GAAM,QAAU,GAAM,SAAU,GAAM,SAAU,GAAM,SAAU,GAAM,SAAU,GAAM,QAAU,GAAM,SAAU,GAAM,SAAU,GAAM,QAAU,GAAM,QAAU,GAAM,QAAU,GAAM,KAAU,GAAM,QAAU,GAAM,MAAU,GAAM,MAAU,EAAK,MAAU,GAAM,MAAU,GAAM,MAAU,GAAM,QAAU,GAAM,QAAU,GAAM,QAAU,GAAM,SAAU,GAAM,SAAU,GAAM,SAAU,GAAM,SAAU,GAAM,SAAU,GAAM,SAAU,GAAM,SAAU,GAAM,SAAU,GAAM,SAAU,GAAM,SAAU,GAAM,SAAU,GAAM,SAAU,GAAM,SAAU,GAAM,SAAU,GAAM,SAAU,IAAO,SAAU,GAAM,SAAU,IAAO,SAAU,GAAM,SAAU,IAAO,SAAU,EAAK,SAAU,EAAK,U,0BC9wC31D,MAAM7Q,GAAc,CAClB,EAAG,QACH,EAAG,SACH,EAAG,UACH,EAAG,aACH,EAAG,UACH,EAAG,WACH,EAAG,YACH,EAAG,WACH,EAAG,SACH,GAAI,YAMA+pG,GAAwBppK,cAAYnI,IAAD,CACvCvD,KAAM,CACJy9B,OAAQ,SAEVs7H,KAAM,CACJt7H,OAAQ,OACRD,MAAO,YAILu3I,GAAuBl0K,IAAMoI,MAAK,IAAuB,IAAtB,MAACqI,EAAD,QAAQ+P,GAAa,EAC5D,MAAM/d,EAASwxK,MACRE,EAAehQ,GAAev7J,mBAAQ,IAudxC,SAAqB6H,EAAO+P,GAAU,IAAD,IAE1C,IAAI4zJ,EACqC,IAAD,QAAxC,OAAI3jK,QAAJ,IAAIA,GAAJ,UAAIA,EAAOtJ,eAAX,iBAAI,EAAgBwT,gBAApB,OAAI,EAA0By5J,WAC5BA,EAAWz6J,gBACTtL,oBAAS,OAACoC,QAAD,IAACA,GAAD,UAACA,EAAOtJ,eAAR,iBAAC,EAAgBwT,gBAAjB,aAAC,EAA0By5J,UADtB,OAEd5zJ,QAFc,IAEdA,GAFc,UAEdA,EAASrZ,eAFK,iBAEd,EAAkBwT,gBAFJ,aAEd,EAA4By5J,WAKhC,MAAMjQ,EAAc3pK,OAAOQ,YAAYo5K,EAASnmL,KAAI2zC,GAAQ,CAACA,EAAI4jI,UAAW5jI,MAItEyyI,EAAQD,EAASt5K,QAAO8mC,GAAOvnC,gBAAMunC,EAAI6jI,iBACzC3qI,EAAYzU,IACXZ,kBAAO,OAACY,QAAD,IAACA,OAAD,EAACA,EAAM0iJ,iBACjB1iJ,EAAK0iJ,cAAgB1iJ,EAAK0iJ,cAAc96K,KAAImP,GAAM+mK,EAAY/mK,KAC9DipB,EAAK0iJ,cAAc9sK,SAAQuqB,GAASsU,EAAStU,KAC9C,EAEH,IAAK,MAAMrnB,KAAQk1K,EACjBv5I,EAAS37B,GAIX,IAAK,MAAMA,KAAQk1K,EAAO,CAAC,IAAD,EACxB,GAAoC,KAA5B,OAAJl1K,QAAI,IAAJA,GAAA,UAAAA,EAAM4pK,qBAAN,eAAqBz4K,QAAc,CAAC,IAAD,EACrC,MAAMk2B,EAAQrnB,EAAK4pK,cAAc,GACH,IAA1BviJ,EAAM8tJ,iBAA0D,eAA5B,OAAL9tJ,QAAK,IAALA,GAAA,UAAAA,EAAO+tJ,uBAAP,eAAwBxiL,QACzDy0B,EAAMi/I,cAAgBtmK,EACtBA,EAAK4pK,cAAgBviJ,EAAMuiJ,cAE9B,CACF,CAED,MAAO,CAACsL,EAAOlQ,EAChB,CA7foDqQ,CAAY/jK,EAAO+P,IAAU,CAAC/P,EAAO+P,KACjF3Q,EAAUN,GAAe/G,mBAAS2rK,EAAc,GAAG3O,YACnDiP,EAAKC,GAAUlsK,mBAAS,gBACxBjd,EAAO8hH,GAAY7kG,oBAAS,GAG7BmsK,EAAkBxlK,uBAAY,CAACwxB,EAAOh1C,KAC1C+oL,EAAO/oL,EAAP,GACC,IAGGotG,EAAc5pF,uBAAY,KAC9Bk+F,GAAS39F,IAAQA,GAAjB,GACC,IAEH,OAAO,sBAAK1N,UAAWS,EAAOtD,KAAvB,SACL,eAAC8qH,GAAD,CAAchrF,MAAM,WAAWj9B,UAAWS,EAAOy1J,KAAjD,SACE,eAACr/D,GAAD,CAAqBttG,MAAOA,EAAO8sG,QAASU,EAA5C,SACE,gBAACzvF,GAAA,EAAD,CAAKjG,QAAQ,OAAO09B,cAAc,SAASnE,OAAO,OAAOD,MAAM,OAA/D,UACE,eAACrzB,GAAA,EAAD,CAAKjG,QAAQ,OAAOgkC,KAAK,WAAWgyD,UAAW,EAA/C,SACE,gBAAC/vF,GAAA,EAAD,CAAKjG,QAAQ,OAAO09B,cAAc,MAAMpE,MAAM,OAA9C,UACE,eAACrzB,GAAA,EAAD,CAAK+9B,KAAK,UAAV,SACE,eAACutI,GAAD,CACET,cAAeA,EACfhQ,YAAaA,EACbt0J,SAAUA,EACV4jD,SAAUlkD,MAGd,eAACjG,GAAA,EAAD,CAAK+9B,KAAK,YACV,eAAC/9B,GAAA,EAAD,CAAK+9B,KAAK,UAAV,SACE,eAAC,GAAD,CACE88H,YAAaA,EACb39J,QAASiK,EAAM2iB,SAMfvjB,SAAU2Q,EAAU3Q,OAAWhe,EAC/BuoG,aAAcrB,WAKtB,eAACzvF,GAAA,EAAD,CAAK+9B,KAAK,eAAegyD,UAAW,EAApC,SACE,eAACw7E,GAAD,CAAclpL,MAAO8oL,EAAK1xI,SAAU4xI,EAAiBtuJ,KAAM89I,EAAYt0J,eA/BjF,IA2CIilK,GAAoBjqK,cAAYnI,IAAD,CACnCvD,KAAM,CACJy9B,OAAQ,OACRv5B,QAAS,OACT09B,cAAe,UAEjB0yG,KAAM,CACJlZ,UAAU,aAAD,OAAe73H,EAAMnE,QAAQy+B,SACtCnB,SAAU,QAEZ4Y,OAAQ,CACNhP,SAAU,OAORmvI,GAAW50K,IAAMoI,MAAK,IAAuD,IAAtD,cAAC+rK,EAAD,YAAgBhQ,EAAhB,SAA6Bt0J,EAA7B,SAAuC4jD,GAAc,EAChF,MAAMhxD,EAASqyK,KAGTC,EAAQnsK,mBAAQ,KACpB,MAAMmsK,EAAQ,GAKd,OAJAv6K,OAAOsB,OAAOqoK,GAAaloK,SAAQoqB,IACjCA,EAAK9jB,QAAU,IAAMkxD,EAASptC,EAAKm/I,WACnCuP,EAAMnlL,KAAKy2B,EAAKm/I,UAAhB,IAEKuP,CAAP,GACC,CAACthH,EAAU0wG,KAEPlqJ,EAAU8qF,GAAev8F,mBAASusK,GACnC9wK,EAAW,OAAGkgK,QAAH,IAAGA,OAAH,EAAGA,EAAct0J,GAAU5L,YAGtCkkC,EAAeh5B,uBAAY,CAACwxB,EAAOq0I,KACvCjwE,EAAYiwE,EAAZ,GACC,IAEH,OAAO,uBAAKhzK,UAAWS,EAAOtD,KAAvB,UACL,eAAC81K,GAAA,EAAD,CACEplK,SAAUA,EACVoK,SAAUA,EACVjY,UAAWS,EAAOgxI,KAClByhC,aAAc/sI,EACdgtI,oBAAqB,eAAC,KAAD,IACrBC,kBAAmB,eAAC,KAAD,IANrB,SAQGjB,EAAclmL,KAAIonL,GACjB,eAACC,GAAD,CAAoCjvJ,KAAMgvJ,EAAcljJ,MAAO,EAAGtiB,SAAUA,GAAzDwlK,EAAaj4K,QAGpC,sBAAK4E,UAAWS,EAAOgyC,SACtBxwC,GAAe,gBAACqF,GAAA,EAAD,CAAKK,QAAS,EAAGs6B,cAAe,EAAhC,UACd,eAACz6B,GAAA,EAAD,CAAY0B,QAAQ,QAApB,0BACA,eAAC1B,GAAA,EAAD,CAAY0B,QAAQ,UAApB,SAAgCjH,SAhBpC,IA2BIsxK,GAAwB1qK,aAAW,CACvC1L,KAAOoC,IAAD,CACJ,qBAAsB,CACpB3C,gBAAiB2C,EAAMmB,MAAMnE,QAAQ6D,OAAO0iC,OAE9C,wBAAyB,CACvBlmC,gBAAiB2C,EAAMmB,MAAMnE,QAAQC,QAAQf,KAC7C0E,MAAO,SAET,qFAAsF,CACpFvD,gBAAiB,iBAGrBwlB,QAAU7iB,IAAD,CACPnC,aAAa,aAAD,OAAemC,EAAMmB,MAAMnE,QAAQy+B,SAC/Ch+B,WAAYuC,EAAMmB,MAAMxE,WAAWI,iBACnC,gBAAiB,CACfU,WAAYuC,EAAMmB,MAAMxE,WAAWG,mBAErCi+B,YAAa/6B,EAAMmB,MAAMkH,QAAQ,IAAOrI,EAAM4wB,OAC9CtzB,UAAW,eAEb+qC,MAAQroC,IAAD,CAAa8J,WAAY,IAEhC4O,SAAW1Y,IAAD,IACVsO,SAAWtO,IAAD,IACV/L,MAAQ+L,IAAD,CACLvC,WAAY,UACZmD,MAAO,UACPm6B,YAAa,IAEflrC,IAAMmQ,IAAD,CACH8B,QAAS,OACTwG,WAAY,SACZk3B,cAAe,MACf7D,aAAc37B,EAAMmB,MAAMkH,QAAQ,MAEpCi2B,OAASt+B,IAAD,CACN8B,QAAS,OACTwG,WAAY,aACZm3B,eAAgB,SAChBD,cAAe,SACfp3B,QAASpI,EAAMmB,MAAMkH,QAAQ,IAAM,GACnC67B,SAAU,EACV7I,OAAQr7B,EAAMmB,MAAMkH,QAAQ,KAE9B4rK,iBAAmBj0K,IAAD,CAChBkpH,cAAe,YACfxrH,SAAU,KAEZw2K,mBAAqBl0K,IAAD,CAClBtC,SAAU,KAEZy2K,cAAgBn0K,IAAD,CACb+6B,YAAa/6B,EAAMmB,MAAMkH,QAAQ,QAI/B0rK,GAAet1K,IAAMoI,MAAK,IAA8B,IAA7B,KAACie,EAAD,MAAO8L,EAAP,SAActiB,GAAc,EAI3D,MAAMnN,EAAQy6C,eACRw4H,EAAa/sK,mBAAQ,MAAQlG,QAAOyvB,MAAOA,KAAS,CAACzvB,EAAOyvB,IAC5D7wB,EAAUi0K,GAAsBI,GAChCzuG,EAAar3D,IAAawW,EAAKm/I,UAErC,OAAO,eAACoQ,GAAA,EAAD,CACLC,aAAel1I,IAAYta,EAAK9jB,SAAW8jB,EAAK9jB,UAAWo+B,EAAM40B,gBAAN,EAC3DugH,OAAQzvJ,EAAKm/I,UACbhwK,MACE,sBAAKwM,UAAWV,EAAQlQ,IAAxB,SACE,uBAAK4Q,UAAWV,EAAQu+B,OAAxB,UACE,eAACr2B,GAAA,EAAD,CAAY0B,QAAQ,QAAQlJ,UAAWV,EAAQk0K,iBAA/C,mBACMnvJ,EAAK7wB,SAEX,eAACgU,GAAA,EAAD,CACE0B,QAAQ,QACRlJ,UAAWV,EAAQm0K,mBACnBvzK,MAAO,CACLC,MAAO+kE,EAAa,QAAUxkE,EAAMnE,QAAQjM,KAAKmM,WAJrD,SAOkB,aAAf4nB,EAAK7wB,WACF3D,EACA,UAAGw0B,EAAKinG,kBAAsB7nG,kBAAO,OAACY,QAAD,IAACA,OAAD,EAACA,EAAM0iJ,gBAA2C,UAAzB1iJ,EAAKinG,gBAEjE,GAF2B,YACtB,IAAI,IAAI9gH,IAAI6Z,EAAK0iJ,cAAc96K,KAAIuB,GAAKA,EAAE89H,oBAAmBvvH,KAAK,MAD5C,aAQzCuD,QAAS,CACPnC,KAAMmC,EAAQnC,KACdilB,QAAS9iB,EAAQ8iB,QACjBnK,SAAU3Y,EAAQ2Y,SAClBpK,SAAUvO,EAAQuO,SAClB6lK,cAAep0K,EAAQo0K,cACvB9rI,MAAOtoC,EAAQsoC,MACfp0C,MAAO8L,EAAQ9L,OAjCZ,SAoCJ6wB,EAAK0iJ,eAAiB1iJ,EAAK0iJ,cAAc96K,KAAIo4B,GACrC,eAACivJ,GAAD,CAAmCjvJ,KAAMA,EAAM8L,MAAOA,EAAQ,EAAGtiB,SAAUA,GAAxDwW,EAAKm/I,cArCnC,IAkDIuQ,GAAwBlrK,cAAWnI,IAAK,CAC5C43F,OAAQ,CACN19D,OAAQ,YAGNi4I,GAAe70K,IAAMoI,MAAK,IAA8B,IAAD,sDAA5B,MAACzc,EAAD,SAAQo3C,EAAR,KAAkB1c,GAAU,EAC3D,MAAM5jB,EAASszK,KACTC,EAAM,OAAG3vJ,QAAH,IAAGA,OAAH,EAAGA,EAAM4vJ,WACfC,EAAchsG,GAAY8rG,GAC1BC,EAAU,UAAMD,GAAN,OAAeE,EAAW,YAAQA,EAAR,KAAyB,IAC7DC,EAASvtK,mBAAQ,KACrB,MAAMwtK,GAAe3wJ,kBAAQY,GACvB23E,GAAWv4E,kBAAO,OAACY,QAAD,IAACA,OAAD,EAACA,EAAMp3B,MACzBq9H,GAAe7mG,kBAAO,OAACY,QAAD,IAACA,OAAD,EAACA,EAAMt5B,UAmCnC,MApBe,CACbspL,YAAaD,GAAe,CAC1B5gL,MAAO,eAETvG,KAAM+uG,GAAW,CACfxoG,MAAO,QAET8gL,SArBkB,CAClBjwJ,EAAKkwJ,wBACLlwJ,EAAKmwJ,uBACLnwJ,EAAKowJ,wBACLpwJ,EAAKqwJ,kBACLrwJ,EAAKswJ,cACLtwJ,EAAKuwJ,eACL1jL,MAAK1D,IAAM6K,gBAAM7K,MAcQ,CACvBgG,MAAO,YAETqhL,IAhBa,CACbxwJ,EAAKywJ,SACLzwJ,EAAK0wJ,yBACL7jL,MAAK1D,IAAM6K,gBAAM7K,MAaF,CACbgG,MAAO,OAETzI,SAAUu/H,GAAe,CACvB92H,MAAO,YAETwhL,UAlByBvxJ,kBAAO,OAACY,QAAD,IAACA,OAAD,EAACA,EAAM4wJ,kBACgB,eAAZ,OAAJ5wJ,QAAI,IAAJA,OAAA,EAAAA,EAAM7wB,QAiBpB,CACvBA,MAAO,aAGX,GACC,CAAC6wB,IAEE0jD,EAAaosG,EAAOxqL,GAASA,EAAQ,cAE3C,OAAO,uCACL,eAACurL,GAAA,EAAD,CACEvrL,MAAOo+E,EACPhnC,SAAUA,EACVo0I,eAAe,UACf53C,UAAU,UACVr0H,QAAQ,aACRksK,cAAc,OACdC,qBAAsB,CAAC/1K,QAAS,CAACwzC,SAAUryC,EAAO60K,eAPpD,SASG98K,OAAOC,QAAQ07K,GAAQloL,KAAI,QAAEsM,EAAK5O,GAAP,SAAkBA,EAAQ,eAAC4rL,GAAA,EAAD,CAAe5rL,MAAO4O,KAAS5O,GAArB4O,GAAgC,IAApE,MAE9B,eAACi9K,GAAD,CAAa3nK,SAAUk6D,EAAYp+E,MAAM,cAAzC,SACE,gBAACw/E,GAAD,CAAe13B,OAAK,EAApB,UACE,gBAAC43B,GAAD,CAAa/yD,WAAS,EAAtB,UACE,eAACizD,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,OAAF,EAAEA,EAAMzL,sBAAuB7S,SAAS,oDAC3D,eAACwjE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,OAAF,EAAEA,EAAMoxJ,uBAAwB1vK,SAAS,wDAE9D,gBAACsjE,GAAD,WACE,eAACE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,OAAF,EAAEA,EAAMinG,gBAAiBvlH,SAAS,8CACrD,eAACwjE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,OAAF,EAAEA,EAAM7wB,MAAOuS,SAAS,oCAC3C,eAACwjE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,OAAF,EAAEA,EAAMqkD,YAAa3iE,SAAS,6CAEnD,gBAACsjE,GAAD,WACE,eAACE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,OAAF,EAAEA,EAAMuoB,SAAU7mC,SAAS,uCAC9C,eAACwjE,GAAD,CACExjE,SAAS,uCACTpc,MAAOsqL,EACPv5J,QAAQ,IAEV,eAAC6uD,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,OAAF,EAAEA,EAAMw/I,QAAS99J,SAAS,8CAInD,eAACyvK,GAAD,CAAa3nK,SAAUk6D,EAAYp+E,MAAM,WAAzC,SACE,gBAACw/E,GAAD,CAAe13B,OAAK,EAApB,UACE,gBAAC43B,GAAD,WACE,eAACE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,OAAF,EAAEA,EAAMkwJ,wBAAyB/gL,MAAM,MAAMuS,SAAS,sDACzE,eAACwjE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,OAAF,EAAEA,EAAMmwJ,uBAAwBhhL,MAAM,MAAMuS,SAAS,qDACxE,eAACwjE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,OAAF,EAAEA,EAAMqxJ,+CAAgDliL,MAAM,OAAOuS,SAAS,gFAEnG,gBAACsjE,GAAD,WACE,eAACE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,OAAF,EAAEA,EAAMowJ,wBAAyBjhL,MAAM,MAAMuS,SAAS,sDACzE,eAACwjE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,OAAF,EAAEA,EAAMqwJ,kBAAmBxxI,QAAS,EAAG1vC,MAAM,KAAKuS,SAAS,mDAEhF,gBAACsjE,GAAD,WACE,eAACE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,OAAF,EAAEA,EAAMswJ,cAAe5uK,SAAS,4CACnD,eAACwjE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,OAAF,EAAEA,EAAMsxJ,WAAYzyI,QAAS,EAAGn9B,SAAS,iDAIlE,eAACyvK,GAAD,CAAa3nK,SAAUk6D,EAAYp+E,MAAM,MAAzC,SACE,eAACw/E,GAAD,CAAe13B,OAAK,EAApB,SACE,gBAAC43B,GAAD,WACA,eAACE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,OAAF,EAAEA,EAAM0wJ,wBAAyBhvK,SAAS,sDAC7D,eAACwjE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,OAAF,EAAEA,EAAMywJ,SAAU/uK,SAAS,8CAIlD,eAACyvK,GAAD,CAAa3nK,SAAUk6D,EAAYp+E,MAAM,OAAzC,SACE,gBAACw/E,GAAD,CAAe13B,OAAK,EAApB,UACE,gBAAC43B,GAAD,WACE,eAACE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,GAAF,UAAEA,EAAMp3B,YAAR,aAAE,EAAYwB,EAAGsX,SAAS,qCAC7C,eAACwjE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,GAAF,UAAEA,EAAMp3B,YAAR,aAAE,EAAYmqB,EAAGrR,SAAS,qCAC7C,eAACwjE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,GAAF,UAAEA,EAAMp3B,YAAR,aAAE,EAAYE,EAAG4Y,SAAS,wCAE/C,gBAACsjE,GAAD,WACE,eAACE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,GAAF,UAAEA,EAAMp3B,YAAR,aAAE,EAAYmlF,MAAOrsE,SAAS,yCACjD,eAACwjE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,GAAF,UAAEA,EAAMp3B,YAAR,aAAE,EAAY2tF,KAAM70E,SAAS,wCAChD,eAACwjE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,GAAF,UAAEA,EAAMp3B,YAAR,aAAE,EAAY4tF,MAAO90E,SAAS,4CAEnD,gBAACsjE,GAAD,WACE,eAACE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,GAAF,UAAEA,EAAMp3B,YAAR,aAAE,EAAY2oL,OAAQ7vK,SAAS,0CAClD,eAACwjE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,GAAF,UAAEA,EAAMp3B,YAAR,aAAE,EAAY4oL,aAAc9vK,SAAS,gDACxD,eAACwjE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,GAAF,UAAEA,EAAMp3B,YAAR,aAAE,EAAY6oL,eAAgB/vK,SAAS,0DAIhE,eAACyvK,GAAD,CAAa3nK,SAAUk6D,EAAYp+E,MAAM,WAAzC,SACE,gBAACw/E,GAAD,WACE,gBAACE,GAAD,WACE,eAACE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,GAAF,UAAEA,EAAMt5B,gBAAR,aAAE,EAAgBgrL,eAAgBhwK,SAAS,sDAC9D,eAACwjE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,GAAF,UAAEA,EAAMt5B,gBAAR,aAAE,EAAgBirL,gBAAiBjwK,SAAS,uDAC/D,eAACwjE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,GAAF,UAAEA,EAAMt5B,gBAAR,aAAE,EAAgBkrL,4BAA6BlwK,SAAS,mEAC3E,eAACwjE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,GAAF,UAAEA,EAAMt5B,gBAAR,aAAE,EAAgBmrL,mBAAoBnwK,SAAS,6DAEpE,gBAACsjE,GAAD,WACE,eAACE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,GAAF,UAAEA,EAAMt5B,gBAAR,aAAE,EAAgBorL,mBAAoBpwK,SAAS,0DAClE,eAACwjE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,GAAF,UAAEA,EAAMt5B,gBAAR,aAAE,EAAgBqrL,YAAarwK,SAAS,mDAC3D,eAACwjE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,GAAF,UAAEA,EAAMt5B,gBAAR,aAAE,EAAgBsrL,YAAatwK,SAAS,mDAC3D,eAACwjE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,GAAF,UAAEA,EAAMt5B,gBAAR,aAAE,EAAgBurL,YAAavwK,SAAS,sDAE7D,gBAACsjE,GAAD,WACE,eAACE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,GAAF,UAAEA,EAAMt5B,gBAAR,aAAE,EAAgBwrL,eAAgBxwK,SAAS,sDAC9D,eAACwjE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,GAAF,UAAEA,EAAMt5B,gBAAR,aAAE,EAAgByrL,sBAAuBzwK,SAAS,qEAI3E,eAACyvK,GAAD,CAAa3nK,SAAUk6D,EAAYp+E,MAAM,WAAzC,SACE,gBAACw/E,GAAD,WACE,gBAACE,GAAD,WACE,eAACE,GAAD,CAAc5/E,MAAK,OAAE06B,QAAF,IAAEA,OAAF,EAAEA,EAAMuoB,SAAU7mC,SAAS,uCAC9C,eAACwjE,GAAD,CACE5/E,MAAK,OAAE06B,QAAF,IAAEA,GAAF,UAAEA,EAAM4wJ,uBAAR,aAAE,EAAuBwB,oBAC9B1wK,SAAS,gEACTvS,MAAM,oBACNi0E,mBAAmB,IAErB,eAAC8B,GAAD,CACE5/E,MAAK,OAAE06B,QAAF,IAAEA,GAAF,UAAEA,EAAM4wJ,uBAAR,aAAE,EAAuByB,WAC9B3wK,SAAS,uDACT0hE,mBAAmB,OAGvB,gBAAC4B,GAAD,WACE,eAACE,GAAD,CACE5/E,MAAK,OAAE06B,QAAF,IAAEA,GAAF,UAAEA,EAAM4wJ,uBAAR,aAAE,EAAuB0B,iBAC9B5wK,SAAS,6DACTvS,MAAM,IACNi0E,mBAAmB,IAErB,eAAC8B,GAAD,CACI5/E,MAAK,OAAE06B,QAAF,IAAEA,GAAF,UAAEA,EAAM4wJ,uBAAR,aAAE,EAAuB2B,iBAC9B7wK,SAAS,6DACTvS,MAAM,IACNi0E,mBAAmB,IAEvB,eAAC8B,GAAD,CACI5/E,MAAK,OAAE06B,QAAF,IAAEA,GAAF,UAAEA,EAAM4wJ,uBAAR,aAAE,EAAuB4B,kBAC9B9wK,SAAS,8DACTvS,MAAM,KACNi0E,mBAAmB,IAEvB,eAAC8B,GAAD,CACI5/E,MAAK,OAAE06B,QAAF,IAAEA,GAAF,UAAEA,EAAM4wJ,uBAAR,aAAE,EAAuB6B,kBAC9B/wK,SAAS,8DACTvS,MAAM,OACNi0E,mBAAmB,cAzI/B,IAsJI+tG,GAAcx3K,IAAMoI,MAAK,IAAkC,IAAjC,SAACyH,EAAD,MAAWlkB,EAAX,SAAkB0V,GAAc,EAC9D,OAAO,sBACL2jC,KAAK,WACL0oF,OAAQ79G,IAAalkB,EACrByR,GAAE,8BAAyBzR,GAC3B,2CAAmCA,GAJ9B,SAMJ0V,GANH,IAea6yK,UCndA6E,OA/Ba/4K,IAAMoI,MAAK,IAAc,IAAD,MAAZ,MAACqI,GAAW,EAClD,OAAI,OAACA,QAAD,IAACA,GAAD,UAACA,EAAOtJ,eAAR,OAAC,EAAgBwT,SAId,eAACsvG,GAAD,CAAchrF,MAAM,WAApB,SACL,eAAC0rF,GAAD,UACE,eAACI,GAAD,CAAc9rF,MAAM,cAAc6hC,GAAI,GAAIlkC,OAAO,OAAjD,SACE,gBAACuuC,GAAD,CAAejnE,KAAMuM,EAArB,UACE,gBAAC46D,GAAD,WACE,eAACE,GAAD,CAAcxjE,SAAS,4CACvB,eAACwjE,GAAD,CAAcxjE,SAAS,iDAEzB,gBAACsjE,GAAD,WACE,eAACE,GAAD,CAAcxjE,SAAS,2CACvB,eAACwjE,GAAD,CAAcxjE,SAAS,qDAEzB,gBAACsjE,GAAD,WACE,eAACE,GAAD,CAAcxjE,SAAS,8BACvB,eAACwjE,GAAD,CAAcxjE,SAAS,4CAjBxB,IAGT,ICNF,MAAMixK,GAAqBnuK,cAAWnI,IAAK,CACzCvD,KAAM,CACJy9B,OAAQ,SAmBGq8I,OAfGj5K,IAAMoI,MAAK,YAA6B,IAAV,MAACqI,GAAQ,EACvD,MAAMnP,EAAU03K,KAChB,MAA0B,6CAAtBvoK,EAAMsK,YACD,KAGP,eAACimD,GAAA,EAAD,CAAMh/D,UAAWV,EAAQnC,KAAzB,SACE,eAAC,GAAD,CAAOsuB,UAAWhd,EAAMgd,UAAWtJ,SAAU1T,EAAMoP,SAAU4hD,YAAY,OAG9E,ICdD,MAAMy3G,GAAel5K,IAAMoI,MAAK,IAOzB,IAP0B,KAC/BlE,EAD+B,OAE/BqnC,EAF+B,UAG/BvpC,EAH+B,MAI/B8L,EACA,cAAesnC,KACZijB,GACC,EACJ,MAAM8gH,EAAWvwK,mBAAQ,IAAM,IAAI2H,GAAK,WAAW,IAC7C6oK,EAAexwK,mBAAQ,IAAM,IAAI2H,GAAK,mBAAmB,KACxDk7D,EAAW+lC,GAAgBhpG,mBAAUtE,OAAcrS,EAAPqS,GAC7CxB,EAAQy6C,eAGRgxD,EAAcvlG,mBAAQ,KAC1B,MAAM2lG,EAAgB,CACpBO,MAAO,CACL7vE,MAAO,CACL3sC,KAAK,gBAAD,OAAkB6mL,EAAShjK,SAASrI,GAAOtY,QAA3C,MAENy9G,UAAU,GAEZlE,MAAO,CACL9vE,MAAO,CACL3sC,KAAK,kBAAD,OAAoB8mL,EAAajjK,SAASrI,GAAOtY,QAAjD,MAENy9G,UAAU,IAGd,OAAO15F,GAAagyB,EAAQgjE,EAA5B,GACC,CAAChjE,EAAQz9B,EAAOqrK,EAAUC,IA+B7B,OAzBA1wK,qBAAU,KACR,IAAKxE,EAEH,YADAstG,EAAattG,GAKf,MAIM6tG,EAAW,CAAC,CAChBviH,EALmB,IAAIqnB,GAAS3S,EAAKm1K,aAAcF,GAAUhjK,SAASrI,GAAOniB,QAM7Ew0D,EALqB,IAAItpC,GAAS3S,EAAKo1K,gBAAiBF,GAAcjjK,SAASrI,GAAOniB,QAMtFoG,KAAM,UACN+pB,KAAM,QACNyD,KAAM,CACJpd,MAAOO,EAAMnE,QAAQC,QAAQf,KAC7Bk/B,MAAO,KAIX60E,EAAaO,EAAb,GACC,CAAC7tG,EAAM4J,EAAOqrK,EAAUC,EAAc12K,IAElC,eAAC,GAAD,CACLwB,KAAMunE,EACNlgC,OAAQ4iE,EACR/B,WAAW,gBACXC,aAAY,OAAEnoG,QAAF,IAAEA,OAAF,EAAEA,EAAMw2F,OACpB,cAAatlD,EACbpzC,UAAWA,KACPq2D,GAPN,IAyBF6gH,GAAatwI,aAAe,CAC1B72C,KAAM,cAGOuvE,UAAiB,gCAAjBA,CAAkD43G,IC1FjE,MAAMK,GAAsBv5K,IAAMoI,MAAK,IAOhC,IAPiC,KACtClE,EADsC,OAEtCqnC,EAFsC,UAGtCvpC,EAHsC,MAItC8L,EACA,cAAesnC,KACZijB,GACC,EACJ,MAAM8gH,EAAWvwK,mBAAQ,IAAM,IAAI2H,GAAK,WAAW,IAC7CohG,EAAa/oG,mBAAQ,IAAM,IAAI2H,GAAK,UAAU,IAG9C49F,EAAcvlG,mBAAQ,KAC1B,MAAM2lG,EAAgB,CACpBO,MAAO,CACL7vE,MAAO,CACL3sC,KAAK,gBAAD,OAAkB6mL,EAAShjK,SAASrI,GAAOtY,QAA3C,MAENy9G,UAAU,GAEZlE,MAAO,CACL9vE,MAAO,CACL3sC,KAAK,0BAAD,OAA4Bq/G,EAAWx7F,SAASrI,GAAOtY,QAAvD,MAENy9G,UAAU,IAGd,OAAO15F,GAAagyB,EAAQgjE,EAA5B,GACC,CAAChjE,EAAQz9B,EAAO6jG,EAAYwnE,KAExB1tG,EAAW+lC,GAAgBhpG,mBAAUtE,OAAcrS,EAAPqS,GAC7CxB,EAAQy6C,eA+Bd,OAzBAz0C,qBAAU,KACR,IAAKxE,EAEH,YADAstG,EAAattG,GAKf,MAIM6tG,EAAW,CAAC,CAChBviH,EALmB,IAAIqnB,GAAS3S,EAAKm1K,aAAcF,GAAUhjK,SAASrI,GAAOniB,QAM7Ew0D,EALe,IAAItpC,GAAS3S,EAAKwwG,SAAU/C,GAAYx7F,SAASrI,GAAOniB,QAMvEoG,KAAM,UACN+pB,KAAM,QACNyD,KAAM,CACJpd,MAAOO,EAAMnE,QAAQC,QAAQf,KAC7Bk/B,MAAO,KAIX60E,EAAaO,EAAb,GACC,CAAC7tG,EAAM4J,EAAO6jG,EAAYwnE,EAAUz2K,IAEhC,eAAC,GAAD,CACLwB,KAAMunE,EACNlgC,OAAQ4iE,EACR/B,WAAW,wBACXC,aAAY,OAAEnoG,QAAF,IAAEA,OAAF,EAAEA,EAAMw2F,OACpB,cAAatlD,EACbpzC,UAAWA,KACPq2D,GAPN,IA0BaiJ,UAAiB,wCAAjBA,CAA0Di4G,ICI1DC,OA3Fex5K,IAAMoI,MAAK,IAMlC,IANmC,GACxC+vG,EADwC,IAExCV,EAFwC,WAGxCgiE,EAHwC,aAIxCC,EAJwC,MAKxC5rK,GACI,EAEJ,MAAMqpC,EAAQvuC,mBAAQ,KACpB,IAAIuuC,EAAQ,MAACtlD,OAAWA,GACxB,GAAI4lH,EAAK,CACP,MAAM/C,EAAW,GACjB+C,EAAIx7G,SAAQ6Z,IACNA,EAAE4+F,UAAUA,EAAS9kH,QAAQkmB,EAAE4+F,SAAnB,IAElB,MAAMv8G,EAAM/J,KAAK+J,OAAOu8G,GAClB5uE,EAAM13C,KAAK03C,OAAO4uE,GACxBv9D,EAAQ,IAAItgC,GAAS,CAAC1e,EAAK2tC,GAAM,SAAS3vB,SAASrI,GAAOniB,OAC3D,CACD,OAAOwrD,CAAP,GACC,CAACsgE,EAAK3pG,IAGHixJ,EAAan2J,mBAAQ,IAAM,IAAIo2J,MAAW,IAC1CC,EAAcr2J,mBAAQ,IAAM,IAAIo2J,MAAW,IAC3CH,EAAWj2J,mBAAQ,MAAQmmG,MAAO,CAAC1jE,WAAW,EAAO8L,MAAOA,MAAU,CAACA,IACvE2nH,EAAYl2J,mBAAQ,MAAQmmG,MAAO,CAAC1jE,WAAW,EAAO8L,MAAOA,MAAU,CAACA,IAGxE+nH,EAAsB/vJ,uBAAawxB,IACvC,MAAM1gB,EAAS,CAAC8uF,MAAO,CAAC53D,MAAO,CAACxW,EAAM,kBAAmBA,EAAM,qBAC/Do+H,EAAWpuJ,KAAKsP,EAAhB,GACC,CAAC8+I,IACEI,EAAuBhwJ,uBAAawxB,IACxC,MAAM1gB,EAAS,CAAC8uF,MAAO,CAAC53D,MAAO,CAACxW,EAAM,kBAAmBA,EAAM,qBAC/Ds+H,EAAYtuJ,KAAKsP,EAAjB,GACC,CAACg/I,IAEJ,OAAO,gBAACt0C,GAAD,WACL,eAACI,GAAD,CAAc9rF,MAAM,oBAAoB6hC,GAAI,EAA5C,SACE,eAAC,GAAD,CACE58D,KAAMi0G,EACN5sE,OAAQszH,EACR/wJ,MAAOA,EACP8+F,cAAesyD,EACfhlE,QAAS,KAAQ6kE,EAAWpuJ,KAAK,CAACo+F,MAAO,CAAC53D,MAAOA,IAAhC,EACjB+1D,cAAe+xD,EACf5yD,aAAc8L,EAAKA,EAAG,GAAGzd,OAAS,KAClC3oG,KAAK,cACL,cAAY,gBAGhB,eAACg5H,GAAD,CAAc9rF,MAAM,2BAA2B6hC,GAAI,EAAnD,SACE,eAAC,GAAD,CACE58D,KAAMuzG,EACNlsE,OAAQuzH,EACRlyD,cAAeuyD,EACfjlE,QAAS,KAAQ+kE,EAAYtuJ,KAAK,CAACo+F,MAAO,CAAC53D,MAAOA,IAAjC,EACjBrpC,MAAOA,EACPo/F,cAAe6xD,EACf1yD,aAAcoL,EAAMA,EAAI,GAAG/c,OAAS,KACpC3oG,KAAK,cACL,cAAY,iBAGhB,eAACg5H,GAAD,CAAc9rF,MAAM,gBAAgB6hC,GAAI,EAAxC,SACE,eAAC,GAAD,CACE58D,KAAMw1K,EACN5rK,MAAOA,EACP,cAAY,oBAGhB,eAACi9G,GAAD,CAAc9rF,MAAM,wBAAwB6hC,GAAI,EAAhD,SACE,eAAC,GAAD,CACE58D,KAAMu1K,EACN3rK,MAAOA,EACP,cAAY,oBAtClB,ICqCa6rK,OA1EmB35K,IAAMoI,MAAK,IAAmC,IAAD,4BAAjC,MAACqI,EAAD,WAAQq7G,EAAR,QAAoBtrG,GAAa,EAC7E,MAAM,MAAC1S,GAASgC,KACV88G,EAAS,UAAMltG,KAAN,SAGTk6J,EAAS9tD,EAAWr/G,IAAI,cACxB8yJ,EAAQzzC,EAAWr/G,IAAI,yBACvBotK,EAAgB/tD,EAAWr/G,IAAI,yBAC/BqtK,EAAkBhuD,EAAWr/G,IAAI,iCAGvC,IAAKmtK,IAAWra,IAAUsa,IAAkBC,EAC1C,OAAO,KAIT,IAAIriE,IAAMmiE,GAAS,KACnB,MAAMG,EAAO,OAAGv5J,QAAH,IAAGA,GAAH,UAAGA,EAASrZ,eAAZ,iBAAG,EAAkB2kH,kBAArB,iBAAG,EAA8BorB,mBAAjC,aAAG,EAA2ChoG,WACvD6qI,IACFtiE,EAAM,CAAC,EACPA,EAAI/C,SAAWzxF,GAAmB82J,EAAQrlE,SAAUl0F,GACpDi3F,EAAI1B,UAAY9yF,GAAmB82J,EAAQz6I,MAAO9e,GAASvyB,KAAIwpH,GAAOA,EAAI9rH,QAC1E8rH,EAAI/c,OAAJ,UAAgBkyB,EAAhB,YAA6BlyF,GAAQq/I,EAAQrlE,SAASn8G,MAAM,KAAKhG,MAAM,GAAI,GAAGwL,KAAK,OACnF05G,EAAM,CAACA,IAIT,IAAIU,IAAKonD,GAAQ,KACjB,MAAMya,EAAM,OAAGx5J,QAAH,IAAGA,GAAH,UAAGA,EAASrZ,eAAZ,iBAAG,EAAkB2kH,kBAArB,iBAAG,EAA8BorB,mBAAjC,aAAG,EAA2C/nG,sBACtD6qI,IACF7hE,EAAK,CAAC,EACNA,EAAG1/F,QAAUwK,GAAmB+2J,EAAOvhK,QAAS+H,GAChD23F,EAAGzd,OAAH,UAAekyB,EAAf,YAA4BlyF,GAAQs/I,EAAOvhK,QAAQ,GAAGlgB,MAAM,KAAKhG,MAAM,GAAI,GAAGwL,KAAK,OACnFo6G,EAAK,CAACA,IAIR,IAAI8hE,IAAaJ,GAAgB,KACjC,MAAMK,EAAc,OAAG15J,QAAH,IAAGA,GAAH,UAAGA,EAASrZ,eAAZ,iBAAG,EAAkB2kH,kBAArB,iBAAG,EAA8BorB,mBAAjC,aAAG,EAA2C9nG,sBAC9D8qI,IACFD,EAAa,CAAC,EACdA,EAAWvlE,SAAWzxF,GAAmBi3J,EAAexlE,SAAUl0F,GAClEy5J,EAAWZ,aAAep2J,GAAmBi3J,EAAeb,aAAc74J,GAC1Ey5J,EAAWv/E,OAAX,UAAuBkyB,EAAvB,YAAoClyF,GAAQw/I,EAAexlE,YAI7D,IAAIglE,IAAeI,GAAkB,KACrC,MAAMK,EAAgB,OAAG35J,QAAH,IAAGA,GAAH,UAAGA,EAASrZ,eAAZ,iBAAG,EAAkB2kH,kBAArB,iBAAG,EAA8BorB,mBAAjC,aAAG,EAA2C7nG,8BASpE,OARI8qI,IACFT,EAAe,CAAC,EAChBA,EAAaJ,gBAAkBr2J,GAAmBk3J,EAAiBb,gBAAiB94J,GACpFk5J,EAAaL,aAAep2J,GAAmBk3J,EAAiBd,aAAc74J,GAC9Ek5J,EAAah/E,OAAb,UAAyBkyB,EAAzB,YAAsClyF,GAAQy/I,EAAiBb,mBAI1D,eAACrvD,GAAD,CAAchrF,MAAM,yBAApB,SACL,eAAC,GAAD,CACEk5E,GAAIA,EACJV,IAAKA,EACLiiE,aAAcA,EACdD,WAAYQ,EACZnsK,MAAOA,KANX,IC3DF,MAAMssK,GAAoB,CACxBroL,KAAM,CAACyD,MAAO,OAAQyqC,MAAO,QAC7Bt0C,MAAO,CAAC6J,MAAO,QAASyqC,MAAO,UA8ClBo6I,OA5Ccr6K,IAAMoI,MAAK,IAKjC,IALkC,SACvCkyK,EADuC,YAEvCC,EAFuC,aAGvCC,EAHuC,MAIvC1sK,GACI,EACJ,OAAO,gBAAC68G,GAAD,YACS,IAAb2vD,GAAsB,eAACvvD,GAAD,CAAc9rF,MAAM,sBAAsB6hC,GAAI,GAAIlkC,OAAO,QAAzD,SACrB,eAAC,GAAD,CACE14B,KAAMo2K,EACNxsK,MAAOA,EACP,cAAY,0BAGhB,eAACi9G,GAAD,CAAc9rF,MAAM,eAAe6hC,GAAI,EAAGlkC,OAAO,OAAjD,SACE,eAAC8uC,GAAD,CACE9pE,YAAU,EACVm5B,QAAQ,6CACR10B,WAAY+zK,GACZl2K,KAAMq2K,EACNzsK,MAAOA,EACP,cAAY,mBAGhB,eAACi9G,GAAD,CAAc9rF,MAAM,gBAAgB6hC,GAAI,EAAGlkC,OAAO,OAAlD,SACE,eAAC8uC,GAAD,CACE9pE,YAAU,EACVm5B,QAAQ,8CACR10B,WAAY+zK,GACZl2K,KAAMs2K,EACN1sK,MAAOA,EACP,cAAY,sBAzBlB,ICoDa2sK,OA5DkBz6K,IAAMoI,MAAK,IAAmC,IAAlC,MAACqI,EAAD,WAAQq7G,EAAR,QAAoBtrG,GAAa,EAC5E,MAAM,MAAC1S,GAASgC,KACV88G,EAAS,UAAMltG,KAAN,SAGTg7J,EAAc5uD,EAAWr/G,IAAI,uBAC7BkuK,EAAiB7uD,EAAWr/G,IAAI,gBAChCmuK,EAAkB9uD,EAAWr/G,IAAI,iBAGvC,IAAKkuK,IAAmBD,IAAgBE,EACtC,OAAO,KAIT,IAAIN,IAAWI,GAAc,KAC7B,GAAIA,GAAel6J,EAAS,CAAC,IAAD,MAC1B,MAAMq6J,EAAW,OAAGr6J,QAAH,IAAGA,GAAH,UAAGA,EAASrZ,eAAZ,iBAAG,EAAkB2kH,kBAArB,iBAAG,EAA8BsrB,kBAAjC,aAAG,EAA0C5nG,oBAC9D8qI,EAAW,CACT5/E,OAAO,GAAD,OAAKkyB,EAAL,YAAkBlyF,GAAQmgJ,EAAY,GAAG9jE,QAAQx+G,MAAM,KAAKhG,MAAM,GAAI,GAAGwL,KAAK,OACpFmG,KAAM22K,EAAY5sL,KAAI6sL,IAAE,CACtB/jE,QAAS9zF,GAAmB63J,EAAG/jE,QAASv2F,GACxCk0F,SAAUzxF,GAAmB63J,EAAGC,cAAgBD,EAAGE,aAAcx6J,GACjE1sB,KAAMgnL,EAAG/oL,SAGd,CAGD,IAAIwoL,GAAc,EACG,IAAD,MAAhBI,IACFJ,EAAc,CACZr2K,KAAI,OAAEuM,QAAF,IAAEA,GAAF,UAAEA,EAAOtJ,eAAT,iBAAE,EAAgB2kH,kBAAlB,iBAAE,EAA4BsrB,kBAA9B,aAAE,EAAwC9nG,eAKlD,IAAIkrI,GAAe,EACG,IAAD,MAAjBI,IACFJ,EAAe,CACbt2K,KAAI,OAAEuM,QAAF,IAAEA,GAAF,UAAEA,EAAOtJ,eAAT,iBAAE,EAAgB2kH,kBAAlB,iBAAE,EAA4BsrB,kBAA9B,aAAE,EAAwC7nG,gBAIlD,OAAO,eAAC06E,GAAD,CAAchrF,MAAM,wBAApB,SACL,eAAC,GAAD,CACEq7I,SAAUA,EACVC,YAAaA,EACbC,aAAcA,EACd1sK,MAAOA,KALX,ICtCF,MAAMmtK,GAAW,IAAI1qK,GAAK,UACpBohG,GAAa,IAAIphG,GAAK,SACtB2qK,GAAkB,IAAI3qK,GAAK,UAC3B4qK,GAAe,IAAI5qK,GAAK,UACjB6qK,GAAiB,CAAC,UAAW,aAAc,gBAAiB,cAC5DC,GAAkB,kCAKzBzwK,GAAYC,cAAYnI,IAAD,CAC3B+sC,WAAY,CAAC,MAET6rI,GAAat7K,IAAMoI,MAAK,IAUvB,IAVwB,YAC7BmzK,EAD6B,SAE7BC,EAF6B,gBAG7BC,EAH6B,WAI7B/d,EAJ6B,OAK7BnyH,EAL6B,UAM7BvpC,EAN6B,QAO7BV,EAP6B,WAQ7Bo6K,KACGrjH,GACC,EACAsjH,EAAS,GACO,IAAhBJ,KAAyBI,GACZ,IAAbH,KAAsBG,GACF,IAApBF,KAA6BE,EACjC,MAAMl5K,EAASmI,GAAU,CAACtJ,QAASA,IAC7BoB,EAAQy6C,gBACR,MAACrvC,GAASgC,MACT27D,EAAW+lC,GAAgBhpG,mBAAoB,IAAXmzK,QAAuB9pL,IAC3Ds8G,EAAa6G,GAAkBxsG,qBAgDtC,OA7CAE,qBAAU,KAGR,GAAI,CAAC6yK,EAAaC,EAAUC,GAAiBvoL,KAAKmH,SAEhD,YADAm3G,OAAa3/G,GAIf,GAAe,IAAX8pL,EAEF,YADAnqE,GAAa,GAGf,MAAMwF,EAAS,CACb,CACE9yG,KAAMq3K,GAAe,CACnB/rL,EAAG,IAAIqnB,GAAS0kK,EAAY5/D,KAAMs/D,IAAU9kK,SAASrI,GAAOniB,QAC5Dw0D,EAAG,IAAItpC,GAAS0kK,EAAY5vL,MAAOuvL,IAAiB/kK,SAASrI,GAAOniB,SAEtEiwL,OAAQ,CAACtpL,KAAK,gBAAD,OAAkB4oL,GAAgB/kK,SAASrI,GAAOtY,QAAlD,OAEf,CACE0O,KAAMs3K,GAAY,CAChBhsL,EAAG,IAAIqnB,GAAS2kK,EAAS7/D,KAAMs/D,IAAU9kK,SAASrI,GAAOniB,QACzDw0D,EAAG,IAAItpC,GAAS2kK,EAAS7vL,MAAOwvL,IAAchlK,SAASrI,GAAOniB,SAEhEiwL,OAAQ,CAACtpL,KAAK,aAAD,OAAe6oL,GAAahlK,SAASrI,GAAOtY,QAA5C,OAEf,CACE0O,KAAMu3K,GAAmB,CACvBjsL,EAAG,IAAIqnB,GAAS4kK,EAAgB9/D,KAAMs/D,IAAU9kK,SAASrI,GAAOniB,QAChEw0D,EAAG,IAAItpC,GAAS4kK,EAAgB9vL,MAAOgmH,IAAYx7F,SAASrI,GAAOniB,SAErEiwL,OAAQ,CAACtpL,KAAK,qBAAD,OAAuBq/G,GAAWx7F,SAASrI,GAAOtY,QAAlD,QAGX+4G,EpKmTH,SAA+B4nD,EAAO0lB,EAAQn5K,GAEnD,MAAM6oC,EAAS,CACbmjE,YAAY,EACZ5S,KAAM,CACJggF,KAAM,IACNp8I,QAAS,EACTha,QAAS,cACTq2J,SAAU,kBAKd,IAAIC,EAAQ,EACZ,IAAK,MAAMxyC,KAAQ2sB,EACjB,IAAkB,IAAd3sB,EAAKtlI,KAAgB,GACrB83K,EACF,MAAMxkL,EAAc,IAAVwkL,EAAc,GAAKA,EAC7BzwI,EAAO,QAAD,OAAS/zC,IAAO,IAAK+gD,GAAe71C,GAAQu8B,MAAOuqG,EAAKoyC,QAC9DrwI,EAAO,QAAD,OAAS/zC,IAAO,IACjBmgD,GAAej1C,GAClBu5K,WAAW,EACXC,gBAAgB,EAEnB,CAkBH,OAbA3wI,EAAO,QAAD,OADc,IAAVywI,EAAc,GAAKA,IACP,IACjBrkI,GAAej1C,GAClBw5K,gBAAgB,EAChBj9I,MAAO48I,GAITtwI,EAAOuwD,KAAKqgF,SAAWhlI,gBAAM,EAAG6kI,EAAQ,GAAG/tL,KAAIO,IAC7C,MAAMgJ,EAAU,IAANhJ,EAAU,GAAKA,EACzB,MAAM,IAAN,OAAWgJ,EAAX,YAAgBA,EAAhB,IAEF+zC,EAAOuwD,KAAKx3C,KAAO03H,EAEZzwI,CACR,CoK9VyB6wI,CACpBplE,EACA,CAAC1kH,KAAK,SAAD,OAAW2oL,GAAS9kK,SAASrI,GAAOtY,QAApC,MACLkN,GAEI25K,EAAe9iK,GAAagyB,EAAQgjE,GAC1CiD,EpKgWG,SAA+B2kD,EAAOzzJ,GAC3C,MAAMs0G,EAAS,GACf,IAAIglE,EAAQ,EACZ,IAAK,MAAMxyC,KAAQ2sB,EACjB,GAAI3sB,EAAKtlI,KAAM,GACX83K,EACF,MAAMxkL,EAAc,IAAVwkL,EAAc,GAAKA,EAC7BhlE,EAAOpnH,KACL,CACEJ,EAAGg6I,EAAKtlI,KAAK1U,EACb2wD,EAAGqpF,EAAKtlI,KAAKi8C,EACb4uD,MAAM,IAAD,OAAMv3G,GACXs3G,MAAM,IAAD,OAAMt3G,GACXzF,KAAM,UACN+pB,KAAM,QACNyD,KAAM,CACJpd,MAAOO,EAAMnE,QAAQC,QAAQf,KAC7Bk/B,MAAO,IAId,CAEH,OAAOr6B,eAAK00G,GAAUA,OAASnlH,CAChC,CoKxXgByqL,CAAsBtlE,EAAQt0G,IAC3CsyG,EAAeqnE,EAAf,GACC,CAACd,EAAaC,EAAUC,EAAiBlwI,EAAQz9B,EAAOpL,EAAOi5K,IAE3D,gBAACryK,GAAA,EAAD,CAAKjG,QAAQ,OAAO09B,cAAc,SAASnE,OAAO,OAAOD,MAAM,OAA/D,UACL,eAACrzB,GAAA,EAAD,CAAK+9B,KAAK,WAAV,SACE,eAAC,GAAD,CACEnjC,KAAMunE,EACNlgC,OAAQ4iE,EACR/B,WAAW,aACXG,cAAc,EACdvqG,UAAWS,EAAOgtC,WAClB,cAAY,aACZ48D,aAAcqvE,KACVrjH,MAGPqlG,GAAc,eAACp0J,GAAA,EAAD,CAAK+9B,KAAK,WAAV,SACb,eAAC4jF,GAAD,CAAwBnqD,GAAI,GAA5B,SACE,eAACuqD,GAAD,CACEpsF,MAAM,qBACN/6B,KAAMw5J,EAAWrmB,mBACjBzyI,KAAO,IAAIw2K,GAAgB,aAAc,sBAAuBr9K,KAAK,aAlB7E,IA4CaujE,GAAiB+5G,GAAjB/5G,CAAkCg6G,IAKjD,MAAMiB,GAAwB1xK,cAAYnI,IAAD,CACvC+sC,WAAY,CAAC7S,OAAQ,aAEjB4/I,GAAkBx8K,IAAMoI,MAAK,IAAuB,IAAtB,MAACqI,EAAD,QAAQ+P,GAAa,EACvD,MAAM/d,EAAS85K,KACT3vD,EAAS,UAAMltG,KAAN,SAGT+8J,EAAa13K,cAAI0L,EAAO2qK,KAAmB,GAC3CsB,EAAe33K,cAAIyb,EAAS46J,KAAmB,GAErD,OAAOqB,EAAWxuL,KAAI,CAAC0uL,EAAWnuL,KAChC,MAAMouL,EAAiB,IAAIpwK,KAAa,OAATmwK,QAAS,IAATA,OAAA,EAAAA,EAAWE,uBAAwB,IAC5DC,EAAcJ,EAAaluL,GAE3BgtL,IADcoB,EAAenwK,IAAI,cACX,OAAGqwK,QAAH,IAAGA,OAAH,EAAGA,EAAatB,UAEtCD,IADiBqB,EAAenwK,IAAI,iBACR,OAAGqwK,QAAH,IAAGA,OAAH,EAAGA,EAAavB,aAE5CE,IADqBmB,EAAenwK,IAAI,sBACJ,OAAGqwK,QAAH,IAAGA,OAAH,EAAGA,EAAaC,kBACpDrf,GAAsB,OAATif,QAAS,IAATA,OAAA,EAAAA,EAAWjf,cAAc,EAE5C,OAAO,eAAC4d,GAAD,CAELE,SAAUA,EACVD,YAAaA,EACbE,gBAAiBA,EACjB/d,WAAYA,EACZp8J,QAAS,CAACmuC,WAAYhtC,EAAOgtC,YAC7BisI,WAAU,UAAK9uD,EAAL,YAAkBwuD,GAAer9K,KAAK,KAAtC,YAA8CvP,IANnDA,EADP,GAXF,IA4BWwuL,GAAe17G,GAAiB+5G,GAAjB/5G,CAAkCk7G,ICpK/CS,OAbiBj9K,IAAMoI,MAAK,IAAuB,IAAtB,MAACqI,EAAD,QAAQ+P,GAAa,EAC/D,OAAO,eAACmqG,GAAD,UACL,eAACI,GAAD,CAAcjqD,GAAI,GAAI7hC,MAAM,aAAarC,OAAO,OAAhD,SACE,eAACogJ,GAAD,CAAcvsK,MAAOA,EAAO+P,QAASA,OAFzC,ICgBa08J,OAjBqBl9K,IAAMoI,MAAK,IAAmC,IAAlC,MAACqI,EAAD,WAAQq7G,EAAR,QAAoBtrG,GAAa,EAI/E,OADsBsrG,EAAWr/G,IAAI,cAG9B,eAACw9G,GAAD,CAAchrF,MAAM,2BAApB,SACL,eAAC,GAAD,CAAyBxuB,MAAOA,EAAO+P,QAASA,MAHvB,IAE3B,ICAF,MAAMy6J,GAAW,IAAI1qK,GAAK,UACpB4sK,GAAsB,IAAI5sK,GAAK,YAC/B6sK,GAAgB,IAAI7sK,GAAK,qBAClB8sK,GAAU,CAAC,UAAW,aAAc,YAAa,6BACjDC,GAAW,iDAOlBC,GAA0Bv9K,IAAMoI,MAAK,IAIpC,IAJqC,IAC1Co1K,EAD0C,UAE1Cx7K,EACA,cAAeozC,GACX,EACJ,MAAM1yC,EAAQy6C,gBACPsuB,EAAW+lC,GAAgBhpG,mBAASg1K,IACpCrvE,EAAa6G,GAAkBxsG,sBAChC,MAACsF,GAASgC,KAGhB83G,KAAOltH,wBAAc8iL,GAAM,8BAM3B90K,qBAAU,KAER,MAAM+0K,EAAY,CAAC,EACbC,EAAY,CAAC,EACnB,IAAK,MAAO3rL,EAAM+J,KAAWtB,OAAOC,QAAQ+iL,GAAM,CAChD,MAAM54K,EAAO,CAAC7S,GACd,GAAIsI,gBAAMyB,GAAS,CACjBsO,cAAIqzK,EAAW74K,OAAM/S,GACrBuY,cAAIszK,EAAW94K,OAAM/S,GACrB,QACD,CACD,IAAe,IAAXiK,EAAkB,CACpBsO,cAAIqzK,EAAW74K,GAAM,GACrB,QACD,CACD,IAAIpW,EAAI,EACR,MAAMwoH,EAAS,GACTr+D,EAAaH,GAAc18C,EAAOxL,OAAQoS,GAC1C6oC,EAAS,CACbmjE,YAAY,EACZtV,OAAQ,CACN5pG,EAAG,EACH2wD,EAAG,EACH+yD,QAAS,SAEXpE,MAAO,CACL7vE,MAAO,CACL3sC,KAAK,SAAD,OAAW2oL,GAAS9kK,SAASrI,GAAOtY,QAApC,MAENzD,KAAM,MACNs5C,WAAW,EACX4nE,UAAU,GAEZlE,MAAO,CACL9vE,MAAO,CACL3sC,KAAK,QAAD,OAAU6qL,GAAoBhnK,SAASrI,GAAOtY,QAA9C,MAENzD,KAAM,MACNs5C,WAAW,EACX4nE,UAAU,IAGd,IAAK,MAAMtnH,KAASmQ,EAAQ,CAC1B8rH,KAAO3/G,kBAAO,OAACtc,QAAD,IAACA,OAAD,EAACA,EAAOgyL,OAAhB,2FAAqGH,QAArG,IAAqGA,OAArG,EAAqGA,EAAKG,QAChH/1D,KAAO3/G,kBAAO,OAACtc,QAAD,IAACA,OAAD,EAACA,EAAOA,OAAhB,8FAAwG6xL,QAAxG,IAAwGA,OAAxG,EAAwGA,EAAK7xL,QACnH,MAAMiN,EAAI,IAAIie,GAAJ,OAAalrB,QAAb,IAAaA,OAAb,EAAaA,EAAOgyL,MAAO1C,IAAU9kK,SAASrI,GAAOniB,QACzDqH,EAAM,IAAI6jB,GAAJ,OAAalrB,QAAb,IAAaA,OAAb,EAAaA,EAAOA,MAAOwxL,IAAqBhnK,SAASrI,GAAOniB,QACtEiyL,EAAoB,IAAI/mK,GAAJ,OAAalrB,QAAb,IAAaA,OAAb,EAAaA,EAAOkyL,yBAA0BT,IAAejnK,SAASrI,GAC1Fg/J,EAAInxJ,GAAaiiK,EAAkBjyL,QAASiwB,GAAMC,MAAO,aAAc,GACvEiiK,EAAUF,EAAkBpoL,QAE5BuoL,EAAIpiK,GADqB,IAAI9E,GAAJ,OAAalrB,QAAb,IAAaA,OAAb,EAAaA,EAAOqyL,0BAA2BZ,IAChCzxL,QAASiwB,GAAMC,MAAO,WAAY,GAEhFm7F,EAAOpnH,KAAK,CACVJ,EAAGoJ,EACHunD,EAAGntD,EACHc,KAAK,GAAD,cAAKnI,QAAL,IAAKA,OAAL,EAAKA,EAAO6J,MAAZ,eAAwBs3K,EAAxB,YAA6BgR,EAA7B,eAA2CC,GAC/ChsL,KAAM,UACN28G,YAAY,EACZnvF,KAAMo5B,EAAWnqD,OAEjBA,CACH,CACD4b,cAAIqzK,EAAW74K,EAAMoyG,GACrB5sG,cAAIszK,EAAW94K,EAAM2mC,EAEtB,CACDimE,EAAaisE,GACbzoE,EAAe0oE,EAAf,GACC,CAACF,EAAK1vK,EAAOpL,IAEhB,MAAMyzJ,EAAQvtJ,mBAAQ,KACpB,MAAMutJ,EAAQ,GAiBd,OAhBA1qF,GAAajxE,OAAOC,QAAQgxE,GAAWxvE,SAAQ,IAAqB,IAAnBlK,EAAM+J,GAAY,EACjE,MAAMmjC,EAAK,UAAM9mB,qBAAWpmB,GAAjB,+BACXokK,EAAMvmK,KACJ,eAAC,GAAD,CAAc8Q,QAAO,yBAAoBu+B,EAAMnlB,eAA/C,SACE,eAACixG,GAAD,CAAcjqD,GAAI,GAAI7hC,MAAOA,EAAOrC,OAAO,QAA3C,SACE,eAAC,GAAD,CACE14B,KAAI,OAAEunE,QAAF,IAAEA,OAAF,EAAEA,EAAY15E,GAClBw5C,OAAM,OAAE4iE,QAAF,IAAEA,OAAF,EAAEA,EAAcp8G,GACtBq6G,WAAYntE,EACZstE,cAAc,EACdvqG,UAAWA,EACX,wBAAgBozC,EAAhB,YAA0BrjD,EAAK+nB,kBAPqB/nB,IADWA,GADvE,IAcKokK,CAAP,GACC,CAACn0J,EAAWypE,EAAW0iC,EAAa/4D,IAEvC,OAAO,eAACu1E,GAAD,UACJwrC,GADH,IAqBFonB,GAAwB30I,aAAe,CACrC,cAAe,6BAGF04B,GAAiBg8G,GAAjBh8G,CAA2Bi8G,IAM1C,MAAMU,GAA8Bj+K,IAAMoI,MAAK,IAGxC,IAHyC,MAC9CqI,EAD8C,QAE9C+P,GACI,EACJ,MAAM09J,EAAY/uK,uBAAY,CAACsB,EAAO+P,KACpC,IAAI29J,EAAS,CAAC,EACd,MAAMvxD,EAAS,UAAMltG,KAAN,SACT0+J,EAAWr5K,cAAI0L,EAAO4sK,IAG5B,OAAKe,GAILA,EAASniL,SAASuhL,IAChBpzK,cAAI+zK,EAAQ,CAACX,EAAIzrL,WAAOF,EAAxB,IAIG2uB,GAGL29J,EAAS,CAAC,EACVC,EAASniL,SAAQ,CAACuhL,EAAKhvL,KAAO,IAAD,EAC3B,MAAMuD,EAAOyrL,EAAIzrL,KACZ0a,cAAI0xK,EAAQpsL,KAAOosL,EAAOpsL,GAAQ,IACvC,MAAMssL,EAAU,UAAGt5K,cAAIyb,EAAS68J,WAAhB,aAAG,EAAwB7uL,GAC3C2vL,EAAOpsL,GAAMnC,KAAK,IACb4tL,KACAa,EACHx0E,WAAW,GAAD,OAAK+iB,EAAL,YAAkBywD,GAAQt/K,KAAK,KAA/B,YAAuCvP,IAHnD,IAMK2vL,GAdcA,GATCA,CAuBtB,GACC,IACGX,EAAMU,EAAUztK,EAAO+P,GAE7B,OAAO,eAAC+8J,GAAD,CAAyBC,IAAKA,GAArC,IAQWc,GAA2Bh9G,GAAiBg8G,GAAjBh8G,CAA2B28G,ICzLpDM,OAjBiBv+K,IAAMoI,MAAK,IAAmC,IAAlC,MAACqI,EAAD,WAAQq7G,EAAR,QAAoBtrG,GAAa,EAG3E,MAAMg+J,EAAS1yD,EAAWr/G,IAAI,6BAC9B,OAAK+xK,EAEE,eAACv0D,GAAD,CAAchrF,MAAM,uBAApB,SACJu/I,GAAU,eAACF,GAAD,CAA0B7tK,MAAOA,EAAO+P,QAASA,MAH1C,IAEpB,I,mBCAF,MAAMi+J,GAAe,IAAIluK,GAAK,SACjBmuK,GAAU,CAAC,UAAW,aAAc,aAAc,gCAClDC,GAAW,oDAOlBC,GAA6B5+K,IAAMoI,MAAK,IAIvC,IAJwC,IAC7Cy2K,EAD6C,UAE7C78K,EACA,cAAeozC,GACX,EACJ,MAAM1yC,EAAQy6C,gBACPsuB,EAAW+lC,GAAgBhpG,mBAASq2K,IACpC1wE,EAAa6G,GAAkBxsG,sBAChC,MAACsF,GAASgC,KAGhB83G,KAAOltH,wBAAcmkL,GAAM,8BAM3Bn2K,qBAAU,KAER,MAAM+0K,EAAY,CAAC,EACbC,EAAY,CAAC,EACnB,IAAK,MAAO3rL,EAAMuD,KAAWkF,OAAOC,QAAQokL,GAC1C,IAAK,MAAOrpL,EAAOsG,KAAWtB,OAAOC,QAAQnF,GAAS,CACpD,MAAMsP,EAAO,CAAC7S,EAAMyD,GACpB,GAAI6E,gBAAMyB,GAAS,CACjBsO,cAAIqzK,EAAW74K,OAAM/S,GACrBuY,cAAIszK,EAAW94K,OAAM/S,GACrB,QACD,CACD,IAAe,IAAXiK,EAAkB,CACpBsO,cAAIqzK,EAAW74K,GAAM,GACrB,QACD,CACD,IAAIpW,EAAI,EACR,MAAMwoH,EAAS,GACTr+D,EAAaH,GAAc18C,EAAOxL,OAAQoS,GAC1C6oC,EAAS,CACbmjE,YAAY,EACZtV,OAAQ,CACN5pG,EAAG,EACH2wD,EAAG,EACH+yD,QAAS,SAEXpE,MAAO,CACL7vE,MAAO,CACL3sC,KAAK,GAAD,OAAKkD,EAAL,sBAAwBipL,GAAatoK,SAASrI,GAAOtY,QAArD,MAENy9G,UAAU,GAEZlE,MAAO,CACL9vE,MAAO,CACL3sC,KAAK,QAEP2gH,UAAU,IAGd,IAAK,MAAMtnH,KAASmQ,EAAQ,CAC1B8rH,KAAO3/G,kBAAO,OAACtc,QAAD,IAACA,OAAD,EAACA,EAAOw+I,MAAhB,+FAAwG00C,QAAxG,IAAwGA,OAAxG,EAAwGA,EAAK10C,OACnHviB,KAAO3/G,kBAAO,OAACtc,QAAD,IAACA,OAAD,EAACA,EAAOA,OAAhB,iGAA2GkzL,QAA3G,IAA2GA,OAA3G,EAA2GA,EAAKlzL,QACtH,MAAM+K,EAAI,IAAImgB,GAAJ,OAAalrB,QAAb,IAAaA,OAAb,EAAaA,EAAOw+I,KAAMs0C,IAActoK,SAASrI,GAAOniB,QAClEqrH,EAAOpnH,KAAK,CACVJ,EAAGkH,EACHypD,EAAGx0D,EAAMA,MACTmI,KAAK,WAAD,OAAanI,EAAMmzL,YAAnB,YAAkCnzL,EAAMozL,WAC5ChtL,KAAM,UACN28G,YAAY,EACZnvF,KAAMo5B,EAAWnqD,OAEjBA,CACH,CACD4b,cAAIqzK,EAAW74K,EAAMoyG,GACrB5sG,cAAIszK,EAAW94K,EAAM2mC,EACtB,CAEHimE,EAAaisE,GACbzoE,EAAe0oE,EAAf,GACC,CAACmB,EAAK/wK,EAAOpL,IA8BhB,OA5BckG,mBAAQ,KACpB,MAAMutJ,EAAQ,GAwBd,OAvBA1qF,GAAajxE,OAAOC,QAAQgxE,GAAWxvE,SAAQ,IAAqB,IAAnBlK,EAAMuD,GAAY,EACjE,MAAM2pC,EAAK,UAAM9mB,qBAAWpmB,GAAjB,kCACXokK,EAAMvmK,KACJ,eAAC,GAAD,CAAc8Q,QAAO,yBAAoBu+B,EAAMnlB,eAA/C,SACE,eAACixG,GAAD,CAAcjqD,GAAI,GAAI7hC,MAAOA,EAAOrC,OAAO,OAA3C,SACE,eAACiuF,GAAD,UACGrwH,OAAOK,KAAKvF,GAAQrH,KAAI,CAACuH,EAAOhH,KAAR,eAAc,eAACu8H,GAAD,CACrCjqD,GAAI,GAEJlkC,OAAO,QAH8B,SAItC,eAAC,GAAD,CACC14B,KAAI,OAAEunE,QAAF,IAAEA,GAAF,UAAEA,EAAY15E,UAAd,aAAE,EAAoByD,GAC1B+1C,OAAM,OAAE4iE,QAAF,IAAEA,GAAF,UAAEA,EAAcp8G,UAAhB,aAAE,EAAsByD,GAC9B42G,WAAYntE,EACZstE,cAAc,EACdvqG,UAAWA,EACX,wBAAgBozC,EAAhB,YAA0BrjD,EAAK+nB,cAA/B,YAAgDtkB,EAAMskB,kBAVjB,UAE7B/nB,EAF6B,YAErByD,EAFqB,YAEZhH,GAFF,OAF0BuD,IADYA,GADvE,IAqBKokK,CAAP,GACC,CAACn0J,EAAWypE,EAAW0iC,EAAa/4D,GAEvC,IAGI4pI,GAAeC,KAAUC,UAAU,CACvCD,KAAUzlJ,MAAM,CACd2wG,KAAM80C,KAAUE,QAAQF,KAAUzzL,QAClCG,MAAOszL,KAAUE,QAAQF,KAAUzzL,UAErCyzL,KAAUG,MAAM,EAAC,OAAOvtL,MAEpBwtL,GAAgBJ,KAAUK,SAASL,KAAUE,QAAQH,KACrDO,GAAWN,KAAUK,SAASD,IAEpCT,GAA2B38H,UAAY,CACrC48H,IAAKU,GACLv9K,UAAWi9K,KAAU5+H,OACrB,cAAe4+H,KAAU5+H,QAG3Bu+H,GAA2Bh2I,aAAe,CACxC,cAAe,gCAGF04B,GAAiBq9G,GAAjBr9G,CAA2Bs9G,IAM1C,MAAMY,GAAiCx/K,IAAMoI,MAAK,IAG3C,IAH4C,MACjDqI,EADiD,QAEjD+P,GACI,EACJ,MAAM09J,EAAY/uK,uBAAY,CAACsB,EAAO+P,KACpC,IAAIi/J,EAAS,CAAC,EACd,MAAM7yD,EAAS,UAAMltG,KAAN,SACTggK,EAAW36K,cAAI0L,EAAOiuK,IAG5B,OAAKgB,GAILA,EAASzjL,SAAQ,CAAC4iL,EAAKrwL,KACrB4b,cAAIq1K,EAAQ,CAACZ,EAAI9sL,KAAM8sL,EAAIrpL,YAAQ3D,EAAnC,IAIG2uB,GAGLi/J,EAAS,CAAC,EACVC,EAASzjL,SAAQ,CAAC4iL,EAAKrwL,KAAO,IAAD,EAC3B,MAAMuD,EAAO8sL,EAAI9sL,KACXyD,EAAQqpL,EAAIrpL,MACbiX,cAAIgzK,EAAQ1tL,KAAO0tL,EAAO1tL,GAAQ,CAAC,GACnC0a,cAAIgzK,EAAO1tL,GAAOyD,KAAQiqL,EAAO1tL,GAAMyD,GAAS,IACrD,MAAMmqL,EAAU,UAAG56K,cAAIyb,EAASk+J,WAAhB,aAAG,EAAwBlwL,GAC3CixL,EAAO1tL,GAAMyD,GAAO5F,KAAK,IACpBivL,KACAc,EACH91E,WAAW,GAAD,OAAK+iB,EAAL,YAAkB8xD,GAAQ3gL,KAAK,KAA/B,YAAuCvP,IAHnD,IAMKixL,GAhBcA,GATCA,CAyBtB,GACC,IACGZ,EAAMX,EAAUztK,EAAO+P,GAE7B,OAAO,eAACo+J,GAAD,CAA4BC,IAAKA,GAAxC,IAQWe,GAA8Bt+G,GAAiBq9G,GAAjBr9G,CAA2Bk+G,IC/LhEvE,GAAW,IAAI1qK,GAAK,UACpBkuK,GAAe,IAAIluK,GAAK,SACjBsvK,GAAS,CAAC,UAAW,aAAc,aAAc,sBACjDC,GAAU,0CAOjBC,GAAmB//K,IAAMoI,MAAK,IAI7B,IAJ8B,GACnC43K,EADmC,UAEnCh+K,EACA,cAAeozC,GACX,EACJ,MAAM1yC,EAAQy6C,gBACPsuB,EAAW+lC,GAAgBhpG,mBAASw3K,IACpC7xE,EAAa6G,GAAkBxsG,sBAChC,MAACsF,GAASgC,KAGhB83G,KAAOltH,wBAAcslL,GAAK,6BAM1Bt3K,qBAAU,KAER,MAAM+0K,EAAY,CAAC,EACbC,EAAY,CAAC,EACnB,IAAK,MAAO3rL,EAAM+J,KAAWtB,OAAOC,QAAQulL,GAAK,CAC/C,MAAMp7K,EAAO,CAAC7S,GACd,GAAIsI,gBAAMyB,GAAS,CACjBsO,cAAIqzK,EAAW74K,OAAM/S,GACrBuY,cAAIszK,EAAW94K,OAAM/S,GACrB,QACD,CACD,IAAe,IAAXiK,EAAkB,CACpBsO,cAAIqzK,EAAW74K,GAAM,GACrB,QACD,CAED,IAAIpW,EAAI,EACR,MAAMwoH,EAAS,CAAC,GAAI,IACdr+D,EAAaH,GAAc18C,EAAOxL,OAAQoS,GAC1C6oC,EAAS,GACfA,EAAO37C,KAAK,CACV8+G,YAAY,EACZtV,OAAQ,CACN5pG,EAAG,EACH2wD,EAAG,EACH+yD,QAAS,SAEXpE,MAAO,CACL7vE,MAAO,CACL3sC,KAAK,SAAD,OAAW2oL,GAAS9kK,SAASrI,GAAOtY,QAApC,MAEN61C,WAAW,EACX4nE,UAAU,GAEZlE,MAAO,CACL9vE,MAAO,CACL3sC,KAAK,OAAD,OAASmsL,GAAatoK,SAASrI,GAAOtY,QAAtC,MAEN61C,WAAW,EACX4nE,UAAU,KAGd1nE,EAAO37C,KAAK,CACV8+G,YAAY,EACZtV,OAAQ,CACN5pG,EAAG,EACH2wD,EAAG,EACH+yD,QAAS,SAEXnE,MAAO,CACL9vE,MAAO,iBACPoM,WAAW,EACX4nE,UAAU,GAEZnE,MAAO,CACL7vE,MAAO,CACL3sC,KAAK,OAAD,OAASmsL,GAAatoK,SAASrI,GAAOtY,QAAtC,MAEN61C,WAAW,EACX4nE,UAAU,KAId,IAAK,MAAMtnH,KAASmQ,EAAQ,CAC1B8rH,KAAO3/G,kBAAO,OAACtc,QAAD,IAACA,OAAD,EAACA,EAAOgwH,MAAhB,sFAA+FqkE,QAA/F,IAA+FA,OAA/F,EAA+FA,EAAIrkE,OACzGiM,KAAO3/G,kBAAO,OAACtc,QAAD,IAACA,OAAD,EAACA,EAAOA,OAAhB,uFAAiGq0L,QAAjG,IAAiGA,OAAjG,EAAiGA,EAAIr0L,QAC3G,MAAMiN,EAAI,IAAIie,GAAJ,OAAalrB,QAAb,IAAaA,OAAb,EAAaA,EAAOgwH,KAAMs/D,IAAU9kK,SAASrI,GAAOniB,QACxDqH,EAAM,IAAI6jB,GAAJ,OAAalrB,QAAb,IAAaA,OAAb,EAAaA,EAAOA,MAAO8yL,IAActoK,SAASrI,GAAOniB,QAErEqrH,EAAO,GAAGpnH,KAAK,CACbJ,EAAGoJ,EACHunD,EAAGntD,EACHc,KAAK,GAAD,cAAKnI,QAAL,IAAKA,OAAL,EAAKA,EAAO6J,OAChBzD,KAAM,UACN28G,YAAY,EACZnvF,KAAMo5B,EAAWnqD,KAGnBwoH,EAAO,GAAGpnH,KAAK,CACbJ,EAAGwD,EACHc,KAAK,GAAD,cAAKnI,QAAL,IAAKA,OAAL,EAAKA,EAAO6J,OAChBzD,KAAM,YACNkuL,SAAU,UACVvxE,YAAY,EACZnvF,KAAMo5B,EAAWnqD,OAEjBA,CACH,CACD4b,cAAIqzK,EAAW74K,EAAMoyG,GACrB5sG,cAAIszK,EAAW94K,EAAM2mC,EACtB,CACDimE,EAAaisE,GACbzoE,EAAe0oE,EAAf,GACC,CAACsC,EAAIlyK,EAAOpL,IAsCf,OApCckG,mBAAQ,KACpB,MAAMutJ,EAAQ,GAgCd,OA/BA1qF,GAAajxE,OAAOC,QAAQgxE,GAAWxvE,SAAQ,IAAqB,IAAD,QAAlBlK,EAAM+J,GAAY,EACjE,MAAMmjC,EAAK,UAAM9mB,qBAAWpmB,GAAjB,sBACXokK,EAAMvmK,KACJ,eAAC,GAAD,CAAc8Q,QAAO,yBAAoBu+B,EAAMnlB,eAA/C,SACE,eAACixG,GAAD,CAAcjqD,GAAI,GAAI7hC,MAAOA,EAAOrC,OAAO,OAA3C,SACE,gBAACiuF,GAAD,WACE,eAACE,GAAD,CAAcjqD,GAAI,GAAIlkC,OAAO,QAA7B,SACE,eAAC,GAAD,CACE14B,KAAMpI,IAAM,OAAIA,QAAJ,IAAIA,OAAJ,EAAIA,EAAS,IACzByvC,OAAM,OAAE4iE,QAAF,IAAEA,GAAF,UAAEA,EAAcp8G,UAAhB,aAAE,EAAsB,GAC9Bq6G,WAAYntE,EACZstE,cAAc,EACdvqG,UAAWA,EACX,wBAAgBozC,EAAhB,YAA0BrjD,EAAK+nB,cAA/B,UAGJ,eAACixG,GAAD,CAAcjqD,GAAI,GAAIlkC,OAAO,QAA7B,SACE,eAAC,GAAD,CACE14B,KAAMpI,IAAM,OAAIA,QAAJ,IAAIA,OAAJ,EAAIA,EAAS,IACzByvC,OAAM,OAAE4iE,QAAF,IAAEA,GAAF,UAAEA,EAAcp8G,UAAhB,aAAE,EAAsB,GAC9Bq6G,WAAYntE,EACZstE,cAAc,EACdvqG,UAAWA,EACX,wBAAgBozC,EAAhB,YAA0BrjD,EAAK+nB,cAA/B,cAnB+C/nB,IADYA,GADvE,IA6BKokK,CAAP,GACC,CAACn0J,EAAWypE,EAAW0iC,EAAa/4D,GAEvC,IAGI8qI,GAAcjB,KAAUC,UAAU,CACtCD,KAAUzlJ,MAAM,CACdmiF,KAAMsjE,KAAUE,QAAQF,KAAUzzL,QAClCG,MAAOszL,KAAUE,QAAQF,KAAUzzL,UAErCyzL,KAAUG,MAAM,EAAC,OAAOvtL,MAEpBsuL,GAAelB,KAAUE,QAAQe,IACjCE,GAAUnB,KAAUK,SAASa,IAEnCJ,GAAiB99H,UAAY,CAC3B+9H,GAAII,GACJC,YAAapB,KAAUl/H,OACvB/9C,UAAWi9K,KAAU5+H,OACrB,cAAe4+H,KAAU5+H,QAG3B0/H,GAAiBn3I,aAAe,CAC9B,cAAe,sBAGF04B,GAAiBw+G,GAAjBx+G,CAA0By+G,IAMzC,MAAMO,GAAqBtgL,IAAMoI,MAAK,IAG/B,IAHgC,MACrCqI,EADqC,QAErC+P,GACI,EACJ,MAAM09J,EAAY/uK,uBAAY,CAACsB,EAAO+P,KACpC,MAAMtc,EAAO,CACX87K,IAAI,EACJK,aAAa,GAETzzD,EAAS,UAAMltG,KAAN,SACT6gK,EAAUx7K,cAAI0L,EAAOovK,IAG3B,OAAKU,GAOLA,EAAQtkL,SAAQ,CAAC+jL,EAAIxxL,KACnB,GAAIwxL,EAAGK,YAAa,CAClB,GAAIn8K,EAAKm8K,cAAgBvuH,kBAAQ5tD,EAAKm8K,YAAaL,EAAGK,aACpD,MAAMzvL,MAAM,oDAEdsT,EAAKm8K,YAAcL,EAAGK,WACvB,CACDj2K,cAAIlG,EAAK87K,GAAI,CAACA,EAAGQ,WAAO3uL,EAAxB,IAIG2uB,GAKLtc,EAAK87K,GAAK,CAAC,EACXO,EAAQtkL,SAAQ,CAAC+jL,EAAIxxL,KAAO,IAAD,EACzB,MAAMgyL,EAAOR,EAAGQ,KACX/zK,cAAIvI,EAAK87K,GAAIQ,KAChBt8K,EAAK87K,GAAGQ,GAAQ,IAElB,MAAMC,EAAS,UAAG17K,cAAIyb,EAASq/J,WAAhB,aAAG,EAAuBrxL,GACzC0V,EAAK87K,GAAGQ,GAAM5wL,KAAK,IACdowL,KACAS,EACH52E,WAAW,GAAD,OAAK+iB,EAAL,YAAkBizD,GAAO9hL,KAAK,KAA9B,YAAsCvP,IAHlD,IAMK0V,GAjBEA,GAlBAA,CAmCT,GACC,IACGA,EAAOg6K,EAAUztK,EAAO+P,GAE9B,OAAO,eAACu/J,GAAD,IAAsB77K,GAA7B,IAQWw8K,GAAkBp/G,GAAiBw+G,GAAjBx+G,CAA0Bg/G,ICxO1CK,OArBc3gL,IAAMoI,MAAK,IAIjC,IAJkC,MACvCqI,EADuC,WAEvCq7G,EAFuC,QAGvCtrG,GACI,EAEJ,MAAMogK,EAAS90D,EAAWr/G,IAAI,gCACxBo0K,EAAQ/0D,EAAWr/G,IAAI,sBAE7B,OAAO,gBAACk+G,GAAD,WACJi2D,GAAU,eAAChB,GAAD,CAA6BnvK,MAAOA,EAAO+P,QAASA,IAC9DqgK,GAAS,eAACH,GAAD,CAAiBjwK,MAAOA,EAAO+P,QAASA,MAFpD,ICgBasgK,OA3BkB9gL,IAAMoI,MAAK,IAAmC,IAAlC,MAACqI,EAAD,WAAQq7G,EAAR,QAAoBtrG,GAAa,EAI5E,MAAMogK,EAAS90D,EAAWr/G,IAAI,gCACxBo0K,EAAQ/0D,EAAWr/G,IAAI,sBAG7B,OAAKm0K,GAAWC,EAIT,eAAC52D,GAAD,CAAchrF,MAAM,wBAApB,SACL,eAAC,GAAD,CACExuB,MAAOA,EACPq7G,WAAYA,EACZtrG,QAASA,MAPJ,IAGT,ICNF,MAAMmxF,GAAa,IAAIphG,GAAK,SAItBwwK,GAAuB/gL,IAAMoI,MAAK,IAMjC,IANkC,SACvCssG,EADuC,YAEvCssE,EAFuC,UAGvCh/K,EAHuC,QAIvCV,EACA,cAAe8zC,GACX,EACJ,MAAOq2B,EAAW+lC,GAAgBhpG,mBAAUksG,OAAsB7iH,EAAX6iH,IACjD,MAAC5mG,GAASgC,KACVpN,EAAQy6C,eAMdz0C,qBAAU,KACR,IAAKgsG,EAEH,YADAlD,EAAakD,GAKfkT,KACE3/G,kBAAQysG,GADJ,qFAE0EA,IAEhF,MAAMusE,EAAkB,IAAIpqK,G1LiYzB,SAAmB/a,GACxB,MAAMolL,EAAa,GACbC,EAAUrlL,EAAO,GACvB,IAAK,IAAItN,EAAI,EAAGA,EAAIsN,EAAOxL,OAAQ9B,IACjC0yL,EAAWtxL,KAAKkM,EAAOtN,GAAK2yL,GAE9B,OAAOD,CACR,C0LxYwCE,CAAU1sE,GAAW/C,IAAYx7F,SAASrI,GAAOniB,QAChF01L,EAAsBhnL,gBAAK,OAAC2mL,QAAD,IAACA,OAAD,EAACA,EAAaM,8CAC3CzvL,EACA,IAAIglB,GAASmqK,EAAYM,wCAAyC3vE,IAAYx7F,SAASrI,GAAOniB,QAE5F4kJ,EAAQ,IAAI15I,MAAM69G,EAASpkH,QAAQuK,QACnC0mL,EAAa,GACnB,IAAK,IAAI/yL,EAAI,EAAGA,EAAIyyL,EAAgB3wL,OAAS,IAAK9B,EAChD+yL,EAAW3xL,KAAKxB,KAAKK,IAAIwyL,EAAgBzyL,EAAI,GAAKyyL,EAAgBzyL,KAEpE,MAAMwoH,EAAS,CACb,CACExnH,EAAG+gJ,EACHpwF,EAAG8gI,EACHntL,KAAM,eACN/B,KAAM,UACN28G,YAAY,EACZnvF,KAAM,CACJpd,MAAOO,EAAMnE,QAAQC,QAAQf,KAC7Bk/B,MAAO,IAGX,CACEntC,EAAG+gJ,EAAMh+I,MAAM,EAAGg+I,EAAMjgJ,QACxB6vD,EAAGohI,EACHxyE,MAAO,KACPj7G,KAAM,uBACN/B,KAAM,UACN28G,YAAY,EACZnvF,KAAM,CACJpd,MAAOO,EAAMnE,QAAQE,UAAUhB,KAC/Bk/B,MAAO,KAIT0kJ,GACFrqE,EAAOpnH,KAAK,CACVJ,EAAG,CAAC+gJ,EAAM,GAAIA,EAAMA,EAAMjgJ,OAAS,IACnC6vD,EAAG,CACDkhI,EACAA,GAEFtyE,MAAO,KACPj7G,KAAM,uBACN46G,YAAY,EACZ38G,KAAM,OACN+pB,KAAM,QACNyD,KAAM,CACJpd,MAAOO,EAAMnE,QAAQE,UAAUhB,KAC/Bk/B,MAAO,EACPqc,KAAM,eAIZw4D,EAAawF,EAAb,GACC,CAACtC,EAAUssE,EAAalzK,EAAOpL,IAElC,MAAMw0G,EAAatuG,mBAAQ,IACpB8rG,EAGE,CACLhG,YAAY,EACZtV,OAAQ,CACN5pG,EAAG,EACH2wD,EAAG,EACH+yD,QAAS,QAEXpE,MAAO,CACLiG,aAAc,QACd91E,MAAO,CACL3sC,KAAM,eAER0hH,SAAU,OACVwtE,WAAY,KACZn2I,WAAW,EACX8L,MAAO,CAAC,EAAGu9D,EAASpkH,OAAS,GAC7B2iH,UAAU,EACVwuE,YAAY,EACZC,eAAgB,EAChBC,UAAW,MACXC,WAAY,UACZC,UAAW,UACb9yE,MAAO,CACL9vE,MAAO,CACL3sC,KAAK,iBAAD,OAAmBq/G,GAAWx7F,SAASrI,GAAOtY,QAA9C,MAEN8iD,SAAU,CACRn2C,MAAOO,EAAMnE,QAAQC,QAAQb,MAE/B0tC,WAAW,EACX4nE,UAAU,GAEZjE,OAAQ,CACN/vE,MAAO,CACL3sC,KAAK,yBAAD,OAA2Bq/G,GAAWx7F,SAASrI,GAAOtY,QAAtD,MAEN8iD,SAAU,CACRn2C,MAAOO,EAAMnE,QAAQE,UAAUd,MAEjC5L,KAAM,MACNs5C,WAAW,EACX4nE,UAAU,EACVu6C,WAAY,IACZniE,KAAM,UA7CD,MAgDR,CAACqpB,EAAUhyG,EAAOoL,IAErB,OAAO,gBAAC68G,GAAD,WACL,eAACI,GAAD,CAAc9rF,MAAM,qBAAqB6hC,GAAI,GAA7C,SACE,eAAC,GAAD,CAAcpgE,QAAQ,2BAAtB,SACE,eAAC,GAAD,CACEwD,KAAMunE,EACNlgC,OAAQ2rE,EACR9K,WAAW,qBACX,wBAAgBh3D,EAAhB,eAIN,eAAC21E,GAAD,CAAc9rF,MAAM,sBAAsB6hC,GAAI,GAAIlkC,OAAO,OAAzD,SACE,eAACuuC,GAAD,UACE,gBAACE,GAAD,WACE,eAACE,GAAD,CACExjE,SAAS,mEACTpc,MAAK,OAAEq1L,QAAF,IAAEA,OAAF,EAAEA,EAAac,0BAEtB,eAACv2G,GAAD,CACExjE,SAAS,sEACTpc,MAAK,OAAEq1L,QAAF,IAAEA,OAAF,EAAEA,EAAae,6BAEtB,eAACx2G,GAAD,CACExjE,SAAS,+DACTpc,MAAK,OAAEq1L,QAAF,IAAEA,OAAF,EAAEA,EAAagB,+BAxB9B,IAoDFjB,GAAqBn4I,aAAe,CAClC,cAAe,yBAGF04B,UAAiB,6CAAjBA,CAA+Dy/G,IC/J/DkB,OA5CkBjiL,IAAMoI,MAAK,IAAmC,IAAD,oCAAjC,MAACqI,EAAD,QAAQ+P,EAAR,WAAiBsrG,GAAgB,EAC5E,MAAMo2D,EAAW,OAAGzxK,QAAH,IAAGA,GAAH,UAAGA,EAAOtJ,eAAV,iBAAG,EAAgB2kH,kBAAnB,aAAG,EAA4BwrB,sBAK1C6qC,EAAcr2D,EAAWr/G,IAAI,2BAC5B,OAALgE,QAAK,IAALA,GAAA,UAAAA,EAAOtJ,eAAP,mBAAgB2kH,kBAAhB,eAA4Bs2D,gBAAiB,EACzCC,EAAiBv2D,EAAWr/G,IAAI,4BAE7B,OAALgE,QAAK,IAALA,GAAA,UAAAA,EAAOtJ,eAAP,mBAAgB2kH,kBAAhB,mBAA4BwrB,6BAA5B,eAAmDwqC,2BAAnD,OACArxK,QADA,IACAA,GADA,UACAA,EAAOtJ,eADP,iBACA,EAAgB2kH,kBADhB,iBACA,EAA4BwrB,6BAD5B,aACA,EAAmDyqC,8BADnD,OAEAtxK,QAFA,IAEAA,GAFA,UAEAA,EAAOtJ,eAFP,iBAEA,EAAgB2kH,kBAFhB,iBAEA,EAA4BwrB,6BAF5B,aAEA,EAAmD0qC,sBAIvD,IAAKG,IAAgBE,EACnB,OAAO,KAIT,IAAI3tE,IAAWytE,GAAc,KAC7B,MAAMG,EAAe,OAAG9hK,QAAH,IAAGA,GAAH,UAAGA,EAASrZ,eAAZ,iBAAG,EAAkB2kH,kBAArB,iBAAG,EAA8BwrB,6BAAjC,aAAG,EAAqD5iC,SACzEytE,GAAeG,IACjB5tE,EAAWzxF,GAAmBq/J,EAAiB9hK,IAIjD,MAAMwgK,IAAcqB,GAAiBH,EAErC,OAAO,eAACj4D,GAAD,CAAchrF,MAAM,wBAApB,SACL,eAAC,GAAD,CACEy1E,SAAUA,EACVssE,YAAaA,KAHjB,IC6BauB,OAzDqBviL,IAAMoI,MAAK,IAAmC,IAAlC,MAACqI,EAAD,WAAQq7G,EAAR,QAAoBtrG,GAAa,EAE/E,MAAMgiK,EAAa12D,EAAWr/G,IAAI,WAGlC,IAAK+1K,EAAY,OAAO,KAKxB,MAAMC,IAAWD,GAAa,CAAC,EAC/B,IAAK,MAAME,KAAX,OAAsBjyK,QAAtB,IAAsBA,GAAtB,UAAsBA,EAAOtJ,eAA7B,iBAAsB,EAAgB2kH,kBAAtC,iBAAsB,EAA4B62D,qBAAlD,aAAsB,EAA2CD,QAAS,CAAC,IAAD,MACxED,EAASC,EAAQ3wL,WAAQF,CAC1B,CAGD,GAAI2uB,EAAS,CAAC,IAAD,MACX,IAAIoiK,EAAiB,OAAGpiK,QAAH,IAAGA,GAAH,UAAGA,EAASrZ,eAAZ,iBAAG,EAAkB2kH,kBAArB,iBAAG,EAA8B62D,qBAAjC,aAAG,EAA6CD,QAErE,GADK7rL,MAAMoR,QAAQ26K,KAAoBA,EAAoB,CAACA,IACxDA,EACF,IAAK,MAAMF,KAAWE,EAAmB,CACvC,MAAM1+K,EAAO,CAAC,EACdA,EAAKnS,KAAO2wL,EAAQ3wL,KACpBmS,EAAK1O,MAA0B,gBAAlBktL,EAAQltL,MAA0B,QAAU,OACzD0O,EAAKuwG,YAAciuE,EAAQjuE,YAC3BvwG,EAAKwwG,SAAWguE,EAAQhuE,SACpBxwG,EAAKwwG,WACH+tE,EAASC,EAAQ3wL,MACnB0wL,EAASC,EAAQ3wL,MAAMnC,KAAKsU,GAE5Bu+K,EAASC,EAAQ3wL,MAAQ,CAACmS,GAG/B,CAEJ,CAED,OAAO,eAAC+lH,GAAD,CAAchrF,MAAM,2BAApB,SACL,eAAC0rF,GAAD,UACC83D,GAAYjoL,OAAOC,QAAQgoL,GAAUx0L,KAAI,IAAmB,IAAjBsM,EAAK5O,GAAW,EAC1D,OAAO,eAACo/H,GAAD,CAAwB9rF,MAAO1kC,EAAKumE,GAAI,GAAxC,SACL,eAAC,GAAD,CACE58D,KAAMvY,EACN4/C,OAAQ,CAACwjE,MAAO,CAAC1jE,WAAW,OAHN9wC,EAA1B,OAHJ,IChCF,MAAMsoL,GAA2Bh4K,cAAWnI,IAAK,CAC/CogL,gBAAiB,CACfn5K,QAASjH,EAAMkH,QAAQ,IAEzBm5K,wBAAyB,CACvB1/K,QAAS,OACTs5B,MAAO,OACPpzB,OAAQ,KAEVy5K,mBAAoB,CAClB9lJ,aAAcx6B,EAAMkH,QAAQ,IAE9Bq5K,uBAAwB,CACtB5/K,QAAS,OACT4qH,UAAW,OACXxoF,SAAU,EACVwiC,WAAY,EACZjnC,eAAgB,WAChBhF,aAAct5B,EAAMkH,QAAQ,GAC5B8xB,UAAWh5B,EAAMkH,QAAQ,IAE3Bs5K,YAAa,CACXrnJ,SAAU,SACVyhB,aAAc,WACd3gB,MAAO,aAILwmJ,GAAkBnjL,IAAMoI,MAAK,IAAa,IAAZ,KAAClE,GAAU,EAC7C,MAAM5C,EAAUuhL,KACVO,EAAe,CAACC,cAAe5mK,GAAe,OAACvY,QAAD,IAACA,OAAD,EAACA,EAAMm/K,gBAE3D,OAAO,sBAAKrhL,UAAWV,EAAQwhL,gBAAxB,SACL,uBAAK9gL,UAAWV,EAAQyhL,wBAAxB,UACE,uBAAK/gL,UAAWV,EAAQ0hL,mBAAxB,UACE,eAAC,GAAD,CAAUj7K,SAAS,gBAAgBvS,MAAM,qBAAqB0O,KAAMk/K,IACpE,eAAC,GAAD,CAAUr7K,SAAS,iBAAiBvS,MAAM,iBAAiB0O,KAAMA,OAEnE,sBAAKlC,UAAWV,EAAQ0hL,mBAAxB,SACE,eAAC,GAAD,CAAUj7K,SAAS,mBAAmBvS,MAAM,mBAAmB0O,KAAMA,MAEvE,sBAAKlC,UAAWV,EAAQ0hL,mBAAxB,SACE,eAAC,GAAD,CAAUj7K,SAAS,UAAUvS,MAAM,UAAU0O,KAAMA,UAVzD,IAoBIo/K,GAAkBtjL,IAAMoI,MAAK,IAAa,IAAZ,KAAClE,GAAU,EAC7C,OAAO,eAAC,GAAD,CACL+6B,MAAM,uBAAuBlc,UAAW1gB,KACxCE,QAAS,KAAQ5I,OAAOC,SAAWsK,EAAKzK,GAAvB,EAFZ,SAIL,eAAC,KAAD,KAJF,IAsHa8pL,OA1GcvjL,IAAMoI,MAAK,IAAuB,IAAtB,MAACqI,EAAD,QAAQ+P,GAAa,EAC5D,MAAM,aAAC3X,GAAgBI,MACjB,WAAC9I,GAAcmD,MACdkgL,EAAmBC,GAAwBj7K,sBAC3CmhB,EAAYqiC,GAAiBxjD,mBAAS,CAC3CX,UAAW,GAAI+hB,KAAM,EAAGE,SAAU,KAAMD,MAAO,MAAOyV,MAAO,IAG/D52B,qBAAU,KAAO,IAAD,YACd,MAAMiS,EAAQ,OAAG6F,QAAH,IAAGA,GAAH,UAAGA,EAASrZ,eAAZ,aAAG,EAAkBwT,SAC7B+oK,EAAG,OAAG/oK,QAAH,IAAGA,GAAH,UAAGA,EAAU5tB,gBAAb,aAAG,EAAoBorL,mBAC1BpsD,EAAU,OAAGvrG,QAAH,IAAGA,GAAH,UAAGA,EAASrZ,eAAZ,iBAAG,EAAkB2kH,kBAArB,aAAG,EAA8BC,WAC3C43D,EAAW,OAAG53D,QAAH,IAAGA,GAAH,UAAGA,EAAYG,8BAAf,aAAG,EAAoC03D,aAClDC,EAAUF,EAAcA,EAAY11L,KAAKmc,IAAW,OAAHA,QAAG,IAAHA,OAAA,EAAAA,EAAK05K,iBAAkB,KAAM,KAC9EjmG,GAAoB,OAAVkuC,QAAU,IAAVA,GAAA,UAAAA,EAAYE,0BAAZ,eAAgCiB,mBAAoB,KAC9D62D,EAASlmG,EAAUA,EAAQvtF,OAAS,KACpCoqB,EAAO,OAAGC,QAAH,IAAGA,OAAH,EAAGA,EAAUgxG,yBACpB3mH,EAAS,GACX0+K,GACF1+K,EAAOpV,KAAP,6BAAkC8zL,IAEhCG,GACF7+K,EAAOpV,KAAP,0BAA+Bi0L,EAAQ9lL,KAAK,uBAE1CgmL,GACF/+K,EAAOpV,KAAP,kBAAuBm0L,IAErBrpK,GACF1V,EAAOpV,KAAP,mCAAwC8qB,IAE1C7R,EAAa9D,IAAb,YAAsBC,EAAOjH,KAAK,OAAQgI,MAAKhC,IAC3C0/K,EAAqB1/K,GACrBioD,GAAcriC,IAAU,IAASA,EAAY2V,MAAOv7B,EAASG,KAAK5T,UAAlE,IACC2V,MAAM9F,EAHX,GAIG,CAACqgB,EAAS3X,EAAc1I,EAAYsjL,EAAsBz3H,IAE/D,MAAMtsB,EAAU92B,mBAAQ,IAAM,CAC5B,CACErO,IAAK,KACLwlC,UAAU,EACVE,MAAO,OACP7+B,OAAQ8C,GACN,eAACsF,GAAA,EAAD,CAAYm1C,QAAM,EAAlB,SACE,eAAC,GAAD,UAAWz6C,EAAK9G,QAItB,CACE7C,IAAK,MACLwlC,UAAU,EACVE,MAAO,OACP7+B,OAAQ8C,GACN,eAACsF,GAAA,EAAD,CAAYm1C,QAAM,EAAlB,SACE,eAACxzC,GAAA,EAAD,CAAMlR,KAAMiK,EAAKzK,IAAjB,SACE,eAAC,GAAD,UAAWyK,EAAKzK,WAKxB,CACEc,IAAK,WACLwlC,UAAU,EACVE,MAAO,OACP7+B,OAAQ8C,GAAQA,EAAK8/K,iBAEtB,IAEH,IAAKR,IAAuBA,EAAkBS,oBAAwD,IAAlCT,EAAkBt/K,KAAK5T,OACzF,MAAO,GAGT,MAAM,UAACuX,EAAD,KAAY+hB,EAAZ,MAAkB0V,EAAlB,MAAyBzV,EAAzB,SAAgCC,GAAYH,EAK5Cv9B,EAAQyb,GAAa+hB,EAAO,GAE5Bt5B,EADMuX,EAAYzb,EACFkzC,EAASA,EAAQlzC,EAAQyb,EACzC3D,EAAO,IAAIs/K,EAAkBt/K,MAAM8f,MAPzB,CAACvzB,EAAG2oB,KAClB,MAAMztB,EAAQuY,GAAQlD,OAAOkD,EAAK4lB,IAClC,OAAOn+B,EAAM8E,GAAGslC,cAAcpqC,EAAMytB,KAAiB,QAAVyQ,EAAkB,GAAK,EAAlE,IAKqDt3B,MAAMnG,EAAOA,EAAQkE,GAE5E,OAAO,gBAAC25H,GAAD,CAAchrF,MAAM,oBAApB,UACJukJ,EAAkBS,oBAAwD,IAAlCT,EAAkBt/K,KAAK5T,QAC9D,eAACgZ,GAAA,EAAD,CAAKK,QAAS,EAAd,SACE,eAACH,GAAA,EAAD,6DAGFg6K,EAAkBt/K,KAAK5T,OAAS,GAChC,eAAC,GAAD,CACEovC,QAASA,EACTx7B,KAAMA,EACNylB,WAAYA,EAAY2W,oBAAqB0rB,EAH/C,SAKE,eAAC,GAAD,CAAgBxnB,QAAS2+I,GAAiBphJ,QAASuhJ,GAAnD,SACE,eAAC,GAAD,CAAyBjjJ,eAAgB,CAAC,GAAI,GAAI,aAb1D,I,8GC9IF,MAAM6jJ,GAAyBr5K,cAAWnI,IAAK,CAC7CvD,KAAM,CACJw9B,MAAO,OACP6X,SAAU,IACV,UAAW,CACT19C,KAAM,OACNqtL,cAAe,GACftmH,YAAa,GACbD,YAAa,KAEf,UAAW,CACTx/D,WAAYN,EACZmB,SAAU,GACVjH,GAAI,SACJwnI,WAAY,UAEd,UAAW,CACT5hE,YAAa,EACbumH,cAAe,SAKrB,IAAIC,GAAW,CAAC,EAEhB,MAAMC,GAAiB54J,MAAOjS,EAAQ3U,KAAW,IAAD,oBAC9C,GAAInK,wBAAc8e,EAAOuhB,SAEvB,OAAOvhB,EAGT,IAAI5U,EAAO4U,EAAO5U,KACE,kBAATA,IAAmBA,EAAO4U,EAAOuhB,SAAW,KACvD,MAAM02E,EAAe7sG,EAAKrM,MAAM,KAAKuC,QAAOlG,GAAKA,IAEjD,IAEImmC,EAFAva,EAAUhH,EAAOgH,QACjBsB,EAAUY,GAAennB,EAAD,UAAUilB,SAAV,iBAAU,EAASyH,gBAAnB,aAAU,EAAmBwF,UAA7B,UAAwCjN,SAAxC,iBAAwC,EAASyH,gBAAjD,aAAwC,EAAmBmL,UAEvF,GAA4B,IAAxBq+E,EAAanhH,OAAc,CAE7BsU,EAAO6sG,EAAa,GACpB,IACE12E,EAAUvhB,EAAOuhB,QAAUvhB,EAAO5U,KAAOqe,GAAmBre,EAAM4b,EAInE,CAHC,MAAOjgB,GAEP,YADAO,QAAQP,MAAR,iCAAwCqE,GAEzC,CACF,KAAM,CAIL,IAAI4B,EACJ,MAAM+a,EAAQ3c,EAAK2c,MAAM,0BACzB,GAAIA,EACF/a,EAAU+a,EAAM,OACX,CAEL/a,EADYqb,GAAgBjd,EAAMkd,GACpBtb,OACf,CACD,MAAM,IAACjC,EAAD,SAAMupB,GAAYjpB,EACxB,IAEE,GADA2b,EAAU4jK,GAAS59K,IACdga,EAAS,CAEZA,SADuBjc,EAAIgC,KAAJ,mBAAqBC,EAArB,kBAA8C,CAACsnB,SAAUA,KAC7D5pB,KAAKsc,QACxB4jK,GAAS59K,GAAWga,CACrB,CACD5b,EAAO6sG,EAAa,GACf7sG,EAAKjE,WAAW,OAAMiE,EAAI,WAAOA,IACtCm2B,EAAUvhB,EAAOuhB,QAAUvhB,EAAO5U,KAAOqe,GAAmBre,EAAM4b,EAInE,CAHC,MAAOjgB,GAEP,YADAO,QAAQP,MAAR,+BAAsCiG,EAAtC,aAAkDjG,GAEnD,CACF,CAED,IAAKw6B,EAAS,OAEdjZ,EAAUY,GAAennB,EAAD,UAAUilB,SAAV,iBAAU,EAASyH,gBAAnB,aAAU,EAAmBwF,UAA7B,UAAwCjN,SAAxC,iBAAwC,EAASyH,gBAAjD,aAAwC,EAAmBmL,UACnF,MAAM7R,EAAQ3c,EAAK2c,MAAM,sBAEnB+iK,EAAcz/K,EAAMy/K,aAAe,GACnCC,EAAaxpJ,GAAaupJ,EAAYr2L,KAAIsM,IAAQwgC,EAAQxgC,IAAQ,IAAIjK,SAAS0G,QAAO,CAACvG,EAAG2oB,IAAM3oB,EAAI2oB,IAC1G,GAAI2hB,EAAQypJ,KAAM,CAChB,MAAMA,QAAaH,GAAe,CAACz/K,KAAMm2B,EAAQypJ,KAAMhkK,QAASA,GAAU3b,GAC1E,IAAK2/K,EAAM,OAIX,OAHAA,EAAKzpJ,QAAQ0pJ,OAAS1pJ,EAAQ0pJ,QAAU1pJ,EAAQ0pJ,OAAOn0L,OAASyqC,EAAQ0pJ,OAASD,EAAKzpJ,QAAQ0pJ,OAC9FD,EAAKzpJ,QAAQ2pJ,QAAU3pJ,EAAQ2pJ,SAAW3pJ,EAAQ2pJ,QAAQp0L,OAASyqC,EAAQ2pJ,QAAUF,EAAKzpJ,QAAQ2pJ,QAClGF,EAAKD,UAAYA,EAAUC,EAAKzpJ,SACzBypJ,CACR,CAED,MAAO,CACL1wL,KAAMinC,EAAQjnC,KACdinC,QAASA,EACT4pJ,YAAapjK,EAAQA,EAAM,GAAK3c,EAAKrM,MAAM,KAAK8Z,MAChDzN,KAAMA,EACN4b,QAAShH,EAAOuhB,QAAU,KAAOva,EACjC/mB,IAAK,CAACqoB,EAASld,GAAM7G,KAAK,KAC1ByI,QAAO,UAAEga,SAAF,iBAAE,EAASyH,gBAAX,aAAE,EAAmBmL,SAC5BjxB,MAAO44B,EAAQ54B,MACfoiL,UAAWA,EAAUxpJ,GATvB,EAaIoc,GAAQ,CAAC/qD,EAAOw2G,IAAS/rG,MAAMm6D,KAAKn6D,MAAM+rG,EAAOx2G,GAAO0K,KAAK1K,GAAO6B,KAAI,CAACuJ,EAAGhJ,IAAMgJ,EAAIhJ,KAEtFo2L,GAAWn5J,MAAOjS,EAAQ3U,KAC9B,IAAI,eAACggL,EAAD,SAAiBC,GAAYjgL,EACjC,MAAM,YAACy/K,GAAez/K,EAEtB,IAAIkwK,EAAQv7J,EAAOu7J,OAAS,GAC5B,GAAIA,EAAMzkL,SAAWu0L,EAAgB,OAAO9P,EAEvC+P,IAAUA,EAAW,GAE1B,MAAMC,QAAiBV,GAAe7qK,EAAQ3U,GAC9C,IAAKkgL,EAAU,OAAOhQ,EACtB,MAAMnlJ,EAASm1J,EAAShqJ,QACxB,IAAKnL,EAAQ,OAAOmlJ,EAEpBA,EAAQ,GACR,MAAMv0J,EAAUukK,EAASvkK,QACzB,IAAK,MAAMjmB,KAAO+pL,EAAa,CAC7B,IAAIjjL,EAAWuuB,EAAOr1B,IAAQ,GAC9B,MAAMgqL,EAAYljL,EAAS/Q,OACtBuG,MAAMoR,QAAQ5G,KAAWA,EAAW,CAACA,IAE1C,IAAI2jL,EAAiB7tI,GAAM,EAAGotI,GAC9B,GAAIM,GAAkBA,EAAetqL,GACnCyqL,EAAiBH,EAAetqL,IAAQyqL,OACnC,GAAIF,EAAWP,EAAW,CAC/B,MAAMU,EAAM72L,KAAK6E,MAAM6xL,EAAW,GAElCE,EAAiB,IAAI7tI,GAAM,EAAG8tI,MAAS9tI,GAAMotI,EAAYU,EAAKV,GAC/D,CAED,IAAK,MAAM9zK,KAASu0K,EAAgB,CAClC,MAAMx+J,EAAQnlB,EAASoP,GACvB,IAAK+V,EAAO,SAEZ,IAAI5hB,EAAO4hB,EACNA,EAAMuU,UAASn2B,EAAI,UAAM4U,EAAO5U,KAAb,YAAqBrK,EAArB,YAA4BkW,IACpD,MAAMsqB,QAAgBspJ,GAAe,CAACtpJ,QAASvU,EAAMuU,QAASn2B,KAAMA,EAAM4b,QAASA,GAAU3b,GACxFk2B,IAELA,EAAQjnC,KAAO0yB,EAAM1yB,KACrBinC,EAAQhpC,KAAOwI,EACfwgC,EAAQtqB,MAAQA,EAChBsqB,EAAQnL,OAASpW,EACjBuhB,EAAQuE,MAAQilJ,EAChBxP,EAAMnlL,KAAKmrC,GACZ,CACF,CAED,OAAOg6I,CAAP,EAGImQ,GAAWz5J,MAAOjS,EAAQ3U,KAC9B,GAAI2U,EAAO0iJ,MAAO,OAAO1iJ,EAAO0iJ,MAEhC,MAAM6Y,EAAQv7J,EAAOu7J,MACrB,IAAKv7J,EAAOu7J,MAAO,OAEnB,MAAM7Y,EAAQ,GACd,IAAK,MAAM71I,KAAQ0uJ,EACC,UAAd1uJ,EAAKt0B,OACPs0B,EAAK0uJ,YAAc6P,GAASv+J,EAAMxhB,IAItC,MAAMsgL,EAAW,CAAC3rK,EAAQC,KACxB,GAAID,EAAO/f,MAAQggB,EAAOhgB,IAAK,OAAO,EAEtC,MAAMirL,EAAU,GACI,UAAhBlrK,EAAOznB,MAAoBynB,EAAOu7J,MACpC2P,EAAQ90L,QAAQ4pB,EAAOu7J,MAAMj6K,QAAOurB,GAAsB,YAAdA,EAAKt0B,OAAoB9D,KAAIo4B,GAAQA,EAAK5sB,OAEtFirL,EAAQ90L,KAAK4pB,EAAO/f,KAGtB,MAAMgrL,EAAS,GACK,UAAhBhrK,EAAO1nB,MAAoB0nB,EAAOs7J,MACpC0P,EAAO70L,QAAQ6pB,EAAOs7J,MAAMj6K,QAAOurB,GAAQA,EAAKt0B,MAAQs0B,EAAKt0B,KAAK4O,WAAW,YAAW1S,KAAIo4B,GAAQA,EAAK5sB,OAEzGgrL,EAAO70L,KAAK6pB,EAAOhgB,KAGrB,IAAI2rL,GAAS,EACb,IAAK,MAAMC,KAAUX,EACnB,GAAKW,GACDZ,EAAOpzL,SAASg0L,GAAS,CAC3BD,GAAS,EACT,KACD,CAEH,OAAOA,CAAP,EAIarQ,EAAMj6K,QAAOurB,GAAQA,EAAKt0B,MAAQs0B,EAAKt0B,KAAK4O,WAAW,WAAa0lB,EAAK5sB,MACjFwC,SAAQqK,IACb41J,EAAMtsK,KAAK,CAAC4pB,OAAQlT,EAAOmT,OAAQD,EAAQhkB,MAAO,SAAlD,IAGcu/K,EAAMj6K,QAAOurB,GAAsB,YAAdA,EAAKt0B,MAAsBs0B,EAAK5sB,MAC7DwC,SAAQopL,IACdnpB,EAAMtsK,KAAK,CAAC4pB,OAAQA,EAAQC,OAAQ4rK,EAAQ7vL,MAAO,UAAnD,IAKF,IAAK,MAAMgkB,IAAU,CAAC,SAAU,SAC9B,IAAK,MAAMC,IAAU,CAAC,UAAW,SAAU,CACzC,MAAM6rK,EAAcvQ,EAAMj6K,QAAOurB,GAAQA,EAAKt0B,MAAQs0B,EAAKt0B,KAAK4O,WAAW6Y,IAAW6M,EAAK5sB,MACrF8rL,EAAcxQ,EAAMj6K,QAAOurB,GAAQA,EAAKt0B,OAAS0nB,GAAU4M,EAAK5sB,MACtE6rL,EAAYrpL,SAAQupL,IAClBD,EAAYtpL,SAAQwpL,IAClB,GAAIN,EAASK,EAAYC,GAAa,CACpC,IAAIjwL,EAAQ,GAEVA,EADa,WAAXgkB,EACM,QACY,YAAXC,EACD,SAEA,oCAEVyiJ,EAAMtsK,KAAK,CAAC4pB,OAAQgsK,EAAY/rK,OAAQgsK,EAAYjwL,MAAOA,GAC5D,IAXH,GAcH,CAGH,OAAO0mK,CAAP,EAGIwpB,GAAQ1lL,IAAMoI,MAAK,IAQhB,IARiB,OACxBoR,EADwB,MAExB3U,EAFwB,OAGxB0mC,EAHwB,kBAIxBo6I,EAJwB,eAKxBC,EALwB,cAMxBC,EANwB,eAOxBC,GACM,EACN,MAAMxkL,EAAU4iL,KACVhnH,EAAS50C,mBACT24B,EAAUW,cACVwjH,EAAanxH,KACbk6D,EAAcvlG,mBAAQ,KAuBnB,IAtBe,CACpB+zB,MAAO,IACPpzB,OAAQ,CAACq4B,IAAK,GAAIkY,OAAQ,GAAI4Y,KAAM,GAAIxuB,MAAO,IAC/C6hJ,aAAc,GACdC,YAAa,EACbC,QAAS,IACT9jL,MAAO,CACL7P,KAAM4rD,KAAK,KACXpzC,KAAMo7K,KAAI,KACVhqG,QAASiqG,KAAS,KAClBlrK,SAAU,UACVupK,KAAM,UACNl+K,MAAO,UACP++K,OAAQ,WAEV7rJ,MAAO,CACLlzB,MAAO,SACP2U,SAAU,OACVupK,KAAM,OACNa,OAAQ,cAGiB95I,KAC5B,CAACA,IA80BJ,OA70BA64I,GAAW,CAAC,EAEZ17K,qBAAU,KACR,MAAM,MAACi0B,EAAD,YAAQqpJ,EAAR,QAAqBC,EAArB,MAA8B9jL,GAASgsG,EACvCi4E,EAAYj4E,EAAY30E,MACxB6sJ,EAAU,IACVC,EAAa,GACb1pJ,EAASD,EAAQ0pJ,EAEjBztB,EAAMld,KAAUx+E,EAAO1kD,SAEvB+tK,EAAa7qC,KAAkBv5I,EAAMmE,MAAOnE,EAAMkjL,OAArC3pC,CAA6C,IAEhE,IAAIq5B,EAAO1uJ,EAAM9G,EAEbknJ,EACAloE,EAEAp/F,EAJA/B,EAAK,EAGLopL,EAAe,OAEnB,MAAMC,EAAS,IAAI5hL,EAAOggL,eAAgB,CAAC,GAC3C,IAAI6B,EAAcvnL,EACd2D,GAAW,EACX6jL,GAAc,EACdC,GAAU,EACVC,EAAgBnrC,KAEpB,MAAMorC,EAAchxK,IAClB,GAAIA,EAAE6uK,aAAe7uK,EAAE6uK,YAAYhkL,WAAW,YAAa,OAAO,EAElE,OADemV,EAAEi/J,OAAS,IAAIj6K,QAAOtD,GAAgB,UAAXA,EAAEzF,OAC/BzB,OAAS,CAAtB,EAGIy2L,EAAajxK,GACbA,EAAE3T,MAAc2T,EAAE3T,MACP,SAAX2T,EAAE/jB,KAAwB,UAC1B+0L,EAAWhxK,GAAW3T,EAAM8Y,SACjB,UAAXnF,EAAE/jB,KAAyBoQ,EAAMqiL,KACtB,mBAAX1uK,EAAE/jB,KAAkCw0L,EACtB,WAAXzwK,EAAE/jB,KAAoBoQ,EAAMmE,MAAQnE,EAAMkjL,OAG7C2B,EAAYlzL,GAASA,GAAQA,EAAKxD,OAAS,GAAtB,UAA8BwD,EAAK+e,UAAU,EAAG,IAAhD,OAA2D/e,EAEtF8kK,EAAIvI,KAAK,QAAS1zH,GACf0zH,KAAK,SAAUzzH,GAElBg8H,EAAIhpE,OAAO,KACRygE,KAAK,QAAS,YAEjB,MAAM42B,EAAWruB,EAAI3gE,OAAO,aAE5B2gE,EAAIhpE,OAAO,QACRygE,KAAK,QAAS,QAwBjBuI,EAAIhpE,OAAO,KACRygE,KAAK,QAAS,UACdA,KAAK,aAAc,WAEtB,MAAMj3D,EAASw/D,EAAI3gE,OAAO,WA8D1BmB,EAAOxJ,OAAO,QACXygE,KAAK,KAAK,IACI3U,OAAUlsJ,GAAEsmB,GAAKA,EAAE,KAAIqqC,GAAErqC,GAAKA,EAAE,IACtCyJ,CAAK,CACV,CAACod,EAAQ,EAAI,GAAIC,EAAS0pJ,IAC1B,CAAC,EAAI3pJ,EAAQ,EAAGC,EAAS0pJ,IACzB,CAAC,EAAI3pJ,EAAQ,EAAGC,GAChB,CAACD,EAAQ,EAAGC,GACZ,CAACD,EAAQ,EAAGC,EAAS0pJ,IACrB,CAAC3pJ,EAAQ,EAAI,GAAIC,EAAS0pJ,QAG7Bj2B,KAAK,SAAUnyG,KAAK,MACpBmyG,KAAK,eAAgB,IACrBA,KAAK,OAAQ,QAChBj3D,EAAOxJ,OAAO,QACXt9F,KAAK,UACL+9J,KAAK,QAAS,QACdA,KAAK,cAAe,QACpBA,KAAK,IAAK1zH,EAAQ,EAAI,IACtB0zH,KAAK,IAAKzzH,EAAsB,IAAb0pJ,GAED9rL,OAAOK,KAAKurL,GACpBnqL,SAAQ,CAACzG,EAAOib,IAnFX,EAACjb,EAAOib,KACxB,MAAMy2K,EAAU9tF,EAAOxJ,OAAO,KAC3BygE,KAAK,SAAU,WACfA,KAAK,iBAAkB,OACpB72H,EAAQ4sJ,EAAU5wL,GAClB2jD,EAAO+tI,EAAQt3F,OAAOp2D,GACtBzhC,EAAK4kC,EAAQ,EACbntC,EAAImtC,EAAQ,EAAI5kC,EAAK0Y,EAAa,IAAL1Y,EAC7BooD,EAAIvjB,EAAS0pJ,GAEL,SAAV9sJ,EACF2f,EAAKk3G,KAAK,QAASi2B,oBAChBj2B,KAAK,SAAUi2B,GACfj2B,KAAK,KAAmB,GAAbi2B,GACXj2B,KAAK,IAAK7gK,EAAI82L,mBACdj2B,KAAK,IAAKlwG,EAAImmI,GAEjBntI,EAAKk3G,KAAK,IAAKi2B,GACZj2B,KAAK,KAAM7gK,GACX6gK,KAAK,KAAMlwG,GAEhBhH,EACGk3G,KAAK,OAAQ02B,EAAU,CAACh1L,KAAMyD,EAAQ,IAAKmvL,YAAanvL,EAAQ,OAEnE0xL,EAAQt3F,OAAO,QACZygE,KAAK,QAAS,QACd/9J,KAAKkD,GACL0M,MAAM,cAAe,UACrBmuJ,KAAK,IAAK7gK,GACV6gK,KAAK,IAAKlwG,EAAiB,IAAbmmI,GACdpkL,MAAM,qBAAsB,UAE/BglL,EACGz2E,GAAG,aAAa,KACf,IAAI1xG,EAAU,GACA,UAAVvJ,EACFuJ,EAAU,8DAGS,WAAVvJ,EACTuJ,EAAU,iEAGS,aAAVvJ,EACTuJ,EAAU,oEAGS,SAAVvJ,IACTuJ,EAAU,2EAIZ4mL,EAAkB5mL,EAAlB,IAED0xG,GAAG,YAAY,KACdk1E,EAAkB,GAAlB,GAvBJ,EAmDqCwB,CAAU3xL,EAAOib,KAGxD,MAAM22K,EAAgB1rC,OACnBjrC,GAAG,QAAQ,KACVo2E,EAAgBnrC,KAASn9F,UACzB0oI,EAAS52B,KAAK,YAAaw2B,EAA3B,IAGJjuB,EAAI97F,KAAKsqH,GAGT,MAAMC,EAAS3wL,GAAMimC,EAAQspJ,EAAUvvL,EAGjCokB,EAAa4gI,OAChB4rC,MAAM,OAAQ5rC,OAAet+I,IAAG0Y,GAAKA,EAAE1Y,MACvCkqL,MAAM,SAAU5rC,QAChB6rC,cAAc,IACdC,WAAW,IAGRC,EAAgB/rC,OACnBjrC,GAAG,QAAQ36F,IACV,IAAKA,EAAE8Z,QAAU9Z,EAAE1Y,KAAO23K,EAAM,GAAG33K,GAAI,OACvC,MAAMujC,EAAQ+6G,KAASgsC,YACjBp4L,EAAI+3L,EAAM5gB,EAAK,IACfj3K,IAAMmxC,EAAMgnJ,QAAUd,EAAcr3L,GAAKq3L,EAAcv3L,EAAIqtC,EAAQ,GAAKrtC,EAAIm3K,EAAK,GACjFtmH,IAAMxf,EAAMinJ,QAAUf,EAAc1mI,GAAK0mI,EAAcv3L,EAAIstC,EAAS,GAAKttC,EAAIm3K,EAAK,GACxFkf,EAAkB,IACdgB,GACF7wK,EAAEhe,GAAKtI,EACPsmB,EAAE+xK,GAAK1nI,IAEPrqC,EAAEtmB,EAAIA,EACNsmB,EAAEqqC,EAAIA,EACN2nI,EAAOrhB,GACR,IAEFh2D,GAAG,SAAS36F,IACN6wK,GACL7rK,EAAWitK,YAAY,IAAKC,SAA5B,IAEDv3E,GAAG,OAAO36F,IACT8wK,GAAU,EACLD,IACL7rK,EAAWitK,YAAY,GACvBjyK,EAAEhe,GAAK,KACPge,EAAE+xK,GAAK,KAAP,IAGEI,EAAQhB,EAASr3F,OAAO,KAC3BygE,KAAK,QAAS,QACdA,KAAK,SAAU,WACfA,KAAK,iBAAkB,OAEpB63B,EAAQjB,EAASr3F,OAAO,KAC3BygE,KAAK,QAAS,QACdA,KAAK,SAAU,WACfA,KAAK,iBAAkB,OACvBA,KAAK,SAAUluJ,EAAM2I,MAElBq9K,EAAoBhpL,IAGxB,IAAKA,EAAK41K,OAAS51K,EAAKkC,SAAU,OAElC,MAAM0kL,EAAe5mL,EAAKzI,EAAI,GACxBqB,EAAoB,EAAfguL,EAELqC,EAAQjpL,EAAK41K,MAAMj6K,QAAOurB,GAAsB,UAAdA,EAAKt0B,OAC7CoN,EAAKkC,SAAW+mL,EAEhBA,EAAMnsL,SAAQ,CAACoqB,EAAM5V,KACnB,MAAMw7J,EAAS,EAAI79K,KAAKuB,GAAK8gB,EAAQ23K,EAAM93L,OAAUlC,KAAKuB,GAAK,EAC/D02B,EAAK3vB,EAAItI,KAAKU,KAAKu3B,EAAK/jB,MAAQ,GAAKyjL,EAAe,IACpD,MAAMrvL,EAAIyI,EAAKzI,EAAI2vB,EAAK3vB,EACxB2vB,EAAK72B,EAAS,KAAJkH,EAAWtI,KAAKC,IAAI49K,GAASoa,EAAUlnL,EAAK3P,EACtD62B,EAAK85B,GAAKzpD,GAAKu1K,EAAQ,GAAKA,EAAQ79K,KAAKuB,GAAK,IAAO,KAAQvB,KAAKG,IAAI09K,GAAS9sK,EAAKghD,CAApF,IAIF,MAAMskI,EAAStlL,EAAK41K,MAAMj6K,QAAOurB,GAAsB,WAAdA,EAAKt0B,OAC9C,IAAI41L,GAAWlD,EAAOn0L,OAAS,GAAKyH,EAAK,EACzC0sL,EAAOxoL,SAAQ,CAACoqB,EAAM5V,KACpB4V,EAAK85B,EAAI1vC,EAAQ1Y,EAAK4vL,EAAUxoL,EAAKghD,EACrC95B,EAAK72B,EAjBI,KAiBC2P,EAAKzI,EAAS2vL,EAAUlnL,EAAK3P,EACvC62B,EAAK3vB,EAAIqvL,CAAT,IAIF,MAAMsC,EAASlpL,EAAK41K,MAAMj6K,QAAOurB,GAAsB,mBAAdA,EAAKt0B,OAC9C41L,GAAWU,EAAO/3L,OAAS,GAAKyH,EAChCswL,EAAOpsL,SAAQ,CAACoqB,EAAM5V,KACpB4V,EAAK72B,EAAIihB,EAAQ1Y,EAAK,EAAI4vL,EAAUxoL,EAAK3P,EACzC62B,EAAK85B,EA1BI,KA0BChhD,EAAKzI,EAASyI,EAAKghD,EAC7B95B,EAAK3vB,EAAIqvL,CAAT,IAIF,MAAMrB,EAAUvlL,EAAK41K,MAAMj6K,QAAOurB,GAAsB,YAAdA,EAAKt0B,OAC/C41L,GAAWjD,EAAQp0L,OAAS,GAAKyH,EAAK,EACtC2sL,EAAQzoL,SAAQ,CAACoqB,EAAM5V,KACrB4V,EAAK85B,EAAI1vC,EAAQ1Y,EAAK4vL,EAAUxoL,EAAKghD,EACrC95B,EAAK72B,EAAI2P,EAAKzI,EAAI2vL,EAnCT,IAmCwBlnL,EAAK3P,EACtC62B,EAAK3vB,EAAIqvL,CAAT,IAEF5mL,EAAK41K,MAAQ,IAAI0P,KAAW4D,KAAWlpL,EAAKkC,YAAaqjL,EAAzD,EAmDIoD,EAAU/wL,IACd,IAAKsvB,EAAM,OAGX,MAAM/2B,EAAI+3L,EAAMtwL,EAAE,IACZuxL,EAAMjiK,GACHA,EAAKjpB,KAAOmhG,EAAMnhG,IAAO0pL,EAAWzgK,GAAgB,EAAR,EAAI,EAEnDkiK,EAASzyK,IACb,IAAItmB,GAAKsmB,EAAEtmB,EAAIuH,EAAE,IAAMzH,EAAIqtC,EAAQ,EAC/BwjB,GAAKrqC,EAAEqqC,EAAIppD,EAAE,IAAMzH,EAAIstC,EAAS,EACpC,MAAM3lC,EAAI,GAAMgvL,EAKhB,MAJe,UAAXnwK,EAAE/jB,MAAoB+jB,EAAE1Y,KAAOoc,EAAOpc,KACxC5N,EAAIpB,KAAK+J,IAAI/J,KAAK03C,IAAIt2C,EAAGyH,EAAI0lC,IAAS,EAAI1lC,GAAK0lC,GAC/CwjB,EAAI/xD,KAAK+J,IAAI/J,KAAK03C,IAAIqa,EAAGlpD,EAAI2lC,IAAU,EAAI3lC,GAAK2lC,IAE3C,CAACptC,EAAG2wD,EAAX,EAGFsmH,EAAO1vK,EACPsvB,EACGgqI,KAAK,aAAav6I,IACjB,MAAOtmB,EAAG2wD,GAAKooI,EAAMzyK,GACrB,MAAM,aAAN,OAAoBtmB,EAApB,YAAyB2wD,EAAzB,QAEJ95B,EAAKyyI,UAAU,UAAUzI,KAAK,KAAKv6I,GAAKA,EAAEpf,EAAI4xL,EAAGxyK,GAAKxmB,IACtD+2B,EAAKyyI,UAAU,QACZzI,KAAK,KAAKv6I,IAAMA,EAAEpf,EAAI4xL,EAAGxyK,GAAKxmB,EAAI+2L,IAClCh2B,KAAK,KAAKv6I,IAAMA,EAAEpf,EAAI4xL,EAAGxyK,GAAKxmB,IAC9B+gK,KAAK,MAAMv6I,GAAKA,EAAEpf,EAAI4xL,EAAGxyK,GAAKxmB,EAAI,MAClC+gK,KAAK,SAASv6I,GAAW,EAANA,EAAEpf,EAAQ4xL,EAAGxyK,GAAKxmB,EAAI+2L,IACzCh2B,KAAK,UAAUv6I,GAAW,EAANA,EAAEpf,EAAQ4xL,EAAGxyK,GAAKxmB,IACzCiwB,EAAK8wI,KAAK,KAAKv6I,IACb,MAAM6/D,EAAatvD,IACjB,MAAMmiK,EAAW,CAAC,SAAU,UAAW,kBAAkBn3L,SAASg1B,EAAKt0B,MACjE02L,EAAKpiK,EAAK3vB,EAAI4xL,EAAGjiK,GAAQ/2B,GACxBE,EAAG2wD,GAAKooI,EAAMliK,GACrB,MAAO,CACL72B,EAAGA,EACH2wD,EAAGA,EACHzpD,EAAG8xL,EAAWC,GAAMA,EAHtB,EAMF,MA3FU,EAACjvK,EAAQC,KACrB,IAAIivK,EAAKjvK,EAAOjqB,EAAIgqB,EAAOhqB,EACvBm5L,EAAKlvK,EAAO0mC,EAAI3mC,EAAO2mC,EAC3B,MAAMyoI,EAAKx6L,KAAKU,KAAK45L,EAAKA,EAAKC,EAAKA,GAC9Bp6L,EAAMo6L,EAAKC,EACXv6L,EAAMq6L,EAAKE,EACX91B,EAAK61B,EAAKv6L,KAAK03C,KAAK,EAAG13C,KAAK+J,IAAI9J,EAAME,EAAK,IAAMH,KAAKM,KAAKH,GAAOH,KAAKM,KAAKg6L,GAC5EG,EAAKH,EAAKt6L,KAAK03C,KAAK,EAAG13C,KAAK+J,IAAI5J,EAAMF,EAAK,IAAMD,KAAKM,KAAKL,GAAOD,KAAKM,KAAKi6L,GAC5EG,EAAWr2J,GAAMrkC,KAAKK,IAAIgrB,EAAO/iB,GAAK+7B,EAC5C,IAAIs2J,EAAUC,EAAUC,EAAUC,EAC9B1vK,EAAO9iB,EAAI,GAEbuyL,EAAW56L,EAAMmrB,EAAO9iB,EACxBwyL,EAAW36L,EAAMirB,EAAO9iB,IAGxBuyL,GAAYn2B,EAAKt5I,EAAO9iB,EAAI2vL,EAC5B6C,GAAYL,EAAKrvK,EAAO9iB,GAEtB+iB,EAAO/iB,EAAI,GAEbqyL,EAAW16L,EAAMy6L,EAAQ,GACzBE,EAAWz6L,EAAMu6L,EAAQ,KAGzBC,EAAWj2B,EAAKg2B,EAAQzC,GACxB2C,EAAWH,EAAKC,EAAQ,IAE1BtvK,EAAS,CAAChqB,EAAGgqB,EAAOhqB,EAAIy5L,EAAU9oI,EAAG3mC,EAAO2mC,EAAI+oI,GAEhDR,GADAjvK,EAAS,CAACjqB,EAAGiqB,EAAOjqB,EAAIu5L,EAAU5oI,EAAG1mC,EAAO0mC,EAAI6oI,IACpCx5L,EAAIgqB,EAAOhqB,EACvBm5L,EAAKlvK,EAAO0mC,EAAI3mC,EAAO2mC,EACvB,MAAM5gC,EAAOm8H,OAAUlsJ,GAAEsmB,GAAKA,EAAE,KAAIqqC,GAAErqC,GAAKA,EAAE,KAC1CmhG,MAAMykC,MACHplE,EAAS,CAAC,CAAC98D,EAAOhqB,EAAGgqB,EAAO2mC,IAWlC,OAVI/xD,KAAKK,IAAIi6L,GAAMt6L,KAAKK,IAAIk6L,GAC1BlvK,EAAOjqB,EAAIiqB,EAAOjqB,EAAkB,EAAdw2L,EAAkB53L,KAAKM,KAAKg6L,GAIlDjvK,EAAO0mC,EAAI1mC,EAAO0mC,EAAkB,EAAd6lI,EAAkB53L,KAAKM,KAAKi6L,GAIpDryG,EAAO1mF,KAAK,CAAC6pB,EAAOjqB,EAAGiqB,EAAO0mC,IACvB5gC,EAAK+2D,EAAZ,EA8CS6yG,CAAMxzG,EAAU7/D,EAAE0D,QAASm8D,EAAU7/D,EAAE2D,QAA9C,IAEF4M,EAAKyyI,UAAU,QAAQzI,KAAK,KAAKv6I,IAAM,IAAMA,EAAEpf,EAAI4xL,EAAGxyK,GAAKxmB,GAA3D,EAGIq/E,EAAQ74D,IAEZ,GADAyoF,EAAQzoF,GACHyoF,EAAO,OACZ,MAAMikB,EAAao2C,EAAIp2C,aACpB22C,SAAS,KACTiwB,MAAM,QAAQtzK,IACb,MAAMtnB,EAAIktJ,KAAmB+qB,EAAM,CAACloE,EAAM/uG,EAAG+uG,EAAMp+C,EAAa,EAAVo+C,EAAM7nG,IAC5D,OAAOkC,GAAKkvL,EAAOt5L,EAAEoK,GAArB,IAGJytB,EAAKyyI,UAAU,QACZt2C,WAAWA,EADd,EAIIviG,EAAUzG,IACd,IAAKA,EAAQ,OAEb,IAAKA,EAAOu7J,QAAUv7J,EAAOu7J,MAAMzkL,OAAQ,OAE3Cs2L,GAAU,EAEV,MAAMyC,EAAgBzzH,IACpB,MAAMjqE,EAAQ,GACVmX,GAAU8iL,EAAec,GAC7B,IAAIlB,EAAakB,EAIjB,GAHI,CAAC,SAAU,WAAWr1L,SAASq1L,EAAY30L,QAC7CyzL,EAAakB,EAAY92J,SAEtB41J,EAAY,OACjB,IAAIlmJ,EAAQ,EACZ,MAAMy1I,EAAQyQ,EAAWzQ,MAAMj6K,QAAOurB,GAAQA,EAAKt0B,QAAU20L,EAAY30L,MAAQ,WAC7EgjL,EAAMzkL,SAAQgvC,EAAQy1I,EAAM,GAAGz1I,OACnC,MAAMgqJ,EAAY39L,GACZA,EAAM0F,SAAS,KAAajD,KAAK6E,MAAM8F,WAAWpN,EAAM2P,QAAQ,MAAQgkC,EAAQ,KAChF3zC,EAAM0F,SAAS,KAAajD,KAAK6E,MAAM8F,WAAWpN,EAAM2P,QAAQ,MAAQgkC,KAC5E3zC,EAAQ63B,SAAS73B,IACL,IAAGA,EAAQ2zC,EAAQ3zC,GACxBA,GAET,IAAK,MAAMkZ,KAAS+wD,EAAWr9D,MAAM,KACnC,IACE,MAAM86C,EAAIxuC,EAAMtM,MAAM,KACL,IAAb86C,EAAE/iD,OACJ3E,EAAMiE,QAAQunD,MAAS9D,EAAEplD,KAAI,CAACs7L,EAAI/xL,IAAM+xL,EAAKD,EAASC,GAAY,IAAN/xL,EAAU,EAAI8nC,MAE1E3zC,EAAMiE,KAAK05L,EAASj2I,EAAE,IAOzB,CALC,MAAO9yC,GACPO,QAAQP,MAAMA,GACduC,GAAW,EACX8iL,EAAe,MACf,KACD,CAEH,IAAKj6L,EAAM2E,OAAQ,OACnBm2L,EAAM,eAAmBC,EAAY30L,MAAQ,SAAW,IAAI,IAAIya,IAAI7gB,IACpE6tB,EAAOu7J,MAAQv7J,EAAOu7J,MAAMj6K,QAAOurB,GAAQA,EAAKjpB,KAAOspL,EAAYtpL,KAEnE,MAAM0Y,EAAI0D,EACV1D,EAAEzU,cAAWxP,EACbikB,EAAEomJ,WAAQrqK,EACVikB,EAAE8Z,OAASpW,EAAOoW,OAClBy0J,GAAevuK,EAAGjR,GAAOkB,MAAK+P,IACvBA,GACL8uK,GAAS9uK,EAAG2wK,GAAQ1gL,MAAKgvK,IACvBj/J,EAAEi/J,MAAQA,EACVmQ,GAASpvK,EAAGjR,GAAOkB,MAAKm2J,IACtBpmJ,EAAEomJ,MAAQA,EACVj8I,EAAOnK,GACP64D,EAAK74D,EAAL,IACC7P,MAAMm/J,EAJT,IAKCn/J,MAAMm/J,GACRn/J,MAAMm/J,EARP,GAFF,EAcF1pB,KAAU,uBACPjrC,GAAG,SAAS,KACX,MAAMw0E,GAAOpgL,EAAMigL,UAAY,GAAK,EACpCuE,EAAa,IAAD,OAAKpE,EAAL,aAAaA,EAAb,KAAZ,IAGJvpC,KAAU,uBACPjrC,GAAG,WAAW,KACb,MAAM76C,EAAa8lF,KAASjiI,OAAO9tB,MACd,UAAjB+vJ,KAASnhJ,KAAmBq7D,GAAYyzH,EAAazzH,EAAb,IAGhD8lF,KAAU,eACPjrC,GAAG,SAAS,KACX+1E,EAAehtK,EAAOoW,OACtB45J,EAAgBhwK,EAAhB,IAGJkiI,KAAU,gBACPjrC,GAAG,SAAS,KACX+1E,EAAe,OACfrnL,EAAK41K,MAAQ,KACb51K,EAAK+8J,MAAQ,KACb/8J,EAAKkC,SAAW,KAChBolL,EAAO5B,eAAiB,CAAC,EACzBR,GAAellL,EAAM0F,GAAOkB,MAAK+P,IAC1BA,GACL8uK,GAAS9uK,EAAGjR,GAAOkB,MAAKgvK,IACtBj/J,EAAEi/J,MAAQA,EACVmQ,GAASpvK,EAAGjR,GAAOkB,MAAKm2J,IACtBpmJ,EAAEomJ,MAAQA,EACVj8I,EAAOnK,GACP64D,EAAK74D,EAAL,IACC7P,MAAMm/J,EAJT,IAKCn/J,MAAMm/J,GACRn/J,MAAMm/J,EARP,IAUFxM,EAAI97F,KAAKsqH,EAAc7oI,UAAWm9F,MAC9BirC,GAAa7rK,EAAWitK,YAAY,EAAvB,IAGrBrsC,KAAU,uBACPjrC,GAAG,SAAS,KACX,MAAMxiD,EAA2C,YAA9BmrC,EAAOi3D,KAAK,cAA8B,SAAW,UACxEj3D,EAAOi3D,KAAK,aAAcpiG,GAC1B43H,EAA6B,YAAf53H,EAAd,IAGJytF,KAAU,sBACPjrC,GAAG,SAAS,KACXk2E,GAAeA,EACfb,EAAea,GACf1mK,EAAOzG,GACPm1D,EAAKn1D,GACDmtK,EACF7rK,EAAWitK,YAAY,IAAKC,UAE5BltK,EAAWitK,YAAY,EACxB,IAIL,MAAM0B,EAAYr7L,KAAK03C,OAAOtsB,EAAOu7J,MAClCj6K,QAAOurB,GAAsB,UAAdA,EAAKt0B,OAAkB9D,KAAIo4B,GAAQA,EAAKk+J,WAAa,KACvE/qK,EAAOlX,KAAOkX,EAAO+qK,UAAYkF,EACjCjwK,EAAOpc,GAAKA,EACZA,GAAU,EACVoc,EAAOu7J,MAAM94K,SAASoqB,IACpBA,EAAK/jB,KAAOwkL,EAAWzgK,GAAQA,EAAKk+J,UAAYkF,EAAY,EAE5DpjK,EAAK/jB,KAAOlU,KAAK03C,IAAIzf,EAAK/jB,KAAM,IAChC+jB,EAAKjpB,GAAKA,EACVA,GAAU,CAAV,IAGF+qL,EAAiB3uK,GAEjBu7J,EAAQ,CAACv7J,KAAWA,EAAOu7J,OAC3B,MAAM7Y,EAAQ1iJ,EAAO0iJ,MAQrB,GANAA,EAAMjgK,SAAS6O,IACbA,EAAK1N,GAAL,UAAa0N,EAAK0O,OAAOpc,GAAzB,YAA+B0N,EAAK2O,OAAOrc,GAA3C,IA1doB8+J,KACtBtD,EAAI3gE,OAAO,SACR6gE,UAAU,UACV/qC,OAAOpjH,SACPzG,KAAKg4J,EAAMjuK,KAAI6c,GAAQA,EAAK1N,MAC5B27J,QACAnpE,OAAO,UACPygE,KAAK,SAASv6I,GAAC,iBAAcA,KAC7Bu6I,KAAK,KAAMrvJ,QACXqvJ,KAAK,UAAW,cAChBA,KAAK,OAAQ,GACbA,KAAK,OAAQ,GACbA,KAAK,cAAe21B,GACpB31B,KAAK,eAAgB21B,GACrB31B,KAAK,YAAa,WAClBA,KAAK,SAAU,QACfnuJ,MAAM,OAAQC,EAAM2I,MACpBulJ,KAAK,eAAgB,IACrBzgE,OAAO,QACPygE,KAAK,IAAK,iBAlBb,EA4dAq5B,CAAextB,GAEXyqB,EAAa,CACf,MAAMr3L,EAAI+3L,EAAiB,EAAX7tK,EAAO9iB,GACvBokB,EACGi6J,MAAMv7J,EAAOu7J,MAAMj6K,QAAOurB,GAAsB,UAAdA,EAAKt0B,QACvC0+G,GAAG,QAAQ,IAAMq3E,EAAOrhB,KAE3B3rJ,EACGwsK,MAAM,UACNqC,UAAU,GAAKr6L,GAAK,GAEvBwrB,EACGwsK,MAAM,QACNqC,SAAS,KAAQr6L,GACjB6pB,SAASK,EAAO9iB,GAChBwlK,MAAM1iJ,EAAO0iJ,MAAMphK,QAAOgQ,GAA6B,UAArBA,EAAK0O,OAAOznB,MAAyC,UAArB+Y,EAAK2O,OAAO1nB,QAEjF+oB,EACGwsK,MAAM,SAAU5rC,KAAeliI,EAAOhqB,EAAGgqB,EAAO2mC,IAEnDrlC,EACGwsK,MAAM,UAAW5rC,KAAgBliI,EAAO9iB,EAAI,GAAGizL,SAAS,GAC5D,CAED,MAAMC,EAAuB9zK,IAE3B,GADA4lI,KAAA,gBAAmB5lI,EAAE1Y,KAAM8E,MAAM,iBAAkB,GAC/C4T,EAAE1Y,KAAOoc,EAAOpc,GAAI,CACtB,IAAKopL,GAAiC,SAAjBA,EAAyB,OAE9C,YADAb,EAAkB,qDAEnB,CACG,CAAC,SAAU,WAAWt0L,SAASykB,EAAE/jB,OACnC4zL,EAAkB,kDAAoB7vK,EAAE/jB,KAAtB,cAEpB,MAAM4yL,EAAgC,UAAlB7uK,EAAE6uK,YAA0B,OAAS,WAC1C,UAAX7uK,EAAE/jB,MAAkB4zL,EAAkB,kDAAoBhB,KAAtC,EAGpBkF,EAAsB/zK,IAC1B6vK,EAAkB,IAClBjqC,KAAA,gBAAmB5lI,EAAE1Y,KAAM8E,MAAM,iBAAkB,GAAnD,EAGIsnL,EAAmB1zK,IAMvB,GALI8wK,IAAS9wK,EAAEzU,SAAW,MAC1Bq6I,KAAS72G,kBACT+gJ,EAAe9vK,GACf2wK,EAAM,eAAmB3wK,EAAE/jB,MAAQ,SAAW,KAC9C20L,EAAc5wK,EACTA,EAAEi/J,OAAUj/J,EAAEi/J,MAAMzkL,OAAzB,CAGA,GAAIwlB,EAAE1Y,KAAOoc,EAAOpc,GAAI,CACtB,IAAKopL,GAAiC,SAAjBA,EAAyB,OAM9C,OALAZ,EAAeY,GACfE,EAAcF,EACdvmK,EAAOumK,GACP73G,EAAK63G,QACLA,EAAeA,EAAa52J,OAE7B,CACD9Z,EAAE8Z,OAASpW,EACXgtK,EAAe1wK,EAAE8Z,OACjBy0J,GAAevuK,EAAGjR,GAAOkB,MAAK+P,IACvBA,GACL8uK,GAAS9uK,EAAGjR,GAAOkB,MAAKgvK,IACtBj/J,EAAEi/J,MAAQA,EACVmQ,GAASpvK,EAAGjR,GAAOkB,MAAKm2J,IACtBpmJ,EAAEomJ,MAAQA,EACVj8I,EAAOnK,GACP64D,EAAK74D,EAAL,IACC7P,MAAMm/J,EAJT,IAKCn/J,MAAMm/J,GACRn/J,MAAMm/J,EARP,GAdD,CAYD,EAcF/+I,EAAO4hK,EAAMnvB,UAAU,KACpBzI,KAAK,aAAc,UACnBA,KAAK,iBAAkB,QACvBtiC,OAAOpjH,SACPzG,KAAK6wK,GAAOj/J,GAAKA,EAAE1Y,KACnBizJ,KAAK,UAAUv6I,GAAKA,EAAEi/J,MAAQ,KAAO,YACrCh3K,KAAK,KACL++D,KAAK2qH,GAERphK,EACGvrB,QAAOgb,GAAgB,UAAXA,EAAE/jB,MAAoB+jB,EAAE1Y,KAAOoc,EAAOpc,KAClDwyF,OAAO,QACPygE,KAAK,QAAS,QACdA,KAAK,MAAMv6I,GAAC,eAAYA,EAAE1Y,MAC1BizJ,KAAK,SAAUluJ,EAAM+5E,SACrBm0E,KAAK,QAAQv6I,GAAKixK,EAAUjxK,KAC5Bu6I,KAAK,gBAAgBv6I,GACL,SAAXA,EAAE/jB,KAAwB,EACzB+jB,EAAEi/J,OAAUj/J,EAAEi/J,MAAMj6K,QAAOurB,GAAsB,UAAdA,EAAKt0B,OAAkBzB,QAC3DwlB,EAAE1Y,KAAOoc,EAAOpc,GAAW,GAD+C,IAI/EqzG,GAAG,YAAam5E,GAChBn5E,GAAG,WAAYo5E,GACfp5E,GAAG,QAAS+4E,GAEfnjK,EACGvrB,QAAOgb,GAAgB,WAAXA,EAAE/jB,MAAgC,YAAX+jB,EAAE/jB,MAAiC,mBAAX+jB,EAAE/jB,OAC7D69F,OAAO,UACPygE,KAAK,QAAS,QACdA,KAAK,MAAMv6I,GAAC,eAAYA,EAAE1Y,MAC1BizJ,KAAK,SAAUluJ,EAAM+5E,SACrBm0E,KAAK,QAAQv6I,GAAKixK,EAAUjxK,KAC5B26F,GAAG,YAAam5E,GAChBn5E,GAAG,WAAYo5E,GACfp5E,GAAG,QAAS+4E,GAEfnjK,EAAKupE,OAAO,QACTygE,KAAK,QAAS,QACdA,KAAK,OAAQluJ,EAAM7P,MACnB+9J,KAAK,eAAev6I,GAAKA,EAAE1Y,KAAOoc,EAAOpc,GAAK,OAAS,SACvDizJ,KAAK,MAAMv6I,GAAC,eAAYA,EAAE1Y,MAC1B9K,MAAKwjB,GAAKkxK,EAASlxK,EAAEhiB,QACrBoO,MAAM,aAAa4T,GAAKA,EAAE1Y,KAAO23K,EAAM,GAAG33K,GAAK,GAAK,KACpDqzG,GAAG,SAAS36F,IAEX,GADA4lI,KAAS72G,mBACJ/uB,EAAEtP,UAAYsP,EAAE8Z,OAAQ,OAC7B,IAAIhrB,EAAI,mBAAekR,EAAEtP,SACzB,MAAM0qC,EAAcp7B,EAAElR,KAAOkR,EAAElR,KAAKtJ,QAAQ,YAAa,KAAO,KAChEsJ,EAAOkiL,EAAWhxK,GAAKlR,EAAOssC,EAAW,UAAMtsC,EAAN,gBAAkBssC,GAAgBtsC,EAC3E,MAAMnL,EAAMmwH,GAAOhlH,GACnBq8C,EAAQrxD,KAAK6J,EAAb,IAEDg3G,GAAG,aAAa36F,IACf,IAAKA,EAAE/jB,OAAS+jB,EAAE8Z,OAAQ,OAC1B,IAAK9Z,EAAE6uK,YAAa,OACpBjpC,KAAA,gBAAmB5lI,EAAE1Y,KAAM8E,MAAM,cAAe,QAC7C5P,KAAKwjB,EAAEhiB,MACV,MAAMxB,EAAOw0L,EAAWhxK,GAAK,gBAAkB,kBAC3CA,EAAEtP,SACJm/K,EAAkB,iDAAmBrzL,EAAnB,aAAkC,wBAAMwjB,EAAEtP,WAC7D,IAEFiqG,GAAG,YAAY36F,IACd6vK,EAAkB,IAClBjqC,KAAA,gBAAmB5lI,EAAE1Y,KAAM8E,MAAM,cAAe,MAC7C5P,MAAKwjB,GAAKkxK,EAASlxK,EAAEhiB,OADxB,IAIJ,MAAMgX,EAAOo9K,EAAMpvB,UAAU,QAC1BzI,KAAK,aAAc,UACnBA,KAAK,iBAAkB,QACvBtiC,OAAOpjH,SACPzG,KAAKg4J,GAER38I,EAAOzU,EAAKiuJ,QACTnpE,OAAO,QACPygE,KAAK,iBAAkB,OACvBA,KAAK,MAAMv6I,GAAC,eAAYA,EAAE1Y,MAC1BizJ,KAAK,cAAcv6I,GAAC,eAAYA,EAAE1Y,GAAd,OACpBizJ,KAAK,aAAc,WACnB5/C,GAAG,SAAS36F,IACX4lI,KAAS72G,kBACT,MAAMjV,EAAS9Z,EAAE0D,OAAOoW,QAAU9Z,EAAE2D,OAAOmW,OAC3C,IAAKA,EAAQ,OAEb,MAAMk6J,EAAWl6J,EACX41J,EAAa1vK,EAAE0D,OACfisK,EAAa3vK,EAAE2D,OACrB,GAAwB,UAApB+rK,EAAWzzL,MAAwC,UAApB0zL,EAAW1zL,KAAkB,OAEhE,MAAM81B,EAAQ,CAACxB,EAAMkK,KACC,kBAATlK,IACXA,EAAK0jK,MAAQ1jK,EAAKvyB,KAClBuyB,EAAK2jK,MAAQ3jK,EAAKt0B,KAClBs0B,EAAKhlB,SAAW,KACZglB,EAAK61I,QACP71I,EAAK4jK,OAAS,IAAI5jK,EAAK61I,OACvB71I,EAAK61I,MAAQ,MAEX71I,EAAK0uJ,QACP1uJ,EAAK6jK,OAAS,IAAI7jK,EAAK0uJ,OACnBxkJ,GACFlK,EAAK0uJ,MAAM94K,SAAQzE,IACjBqwB,EAAMrwB,EAAN,KAGL,EAGG2yL,EAAW9jK,IACK,kBAATA,GAAsBA,EAAK6jK,SACtC7jK,EAAK0uJ,MAAQ1uJ,EAAK6jK,OAClB7jK,EAAK61I,MAAQ71I,EAAK4jK,OAClB5jK,EAAKhlB,SAAW,KAChBglB,EAAKvyB,KAAOuyB,EAAK0jK,OAAS1jK,EAAKvyB,KAC/BuyB,EAAKt0B,KAAOs0B,EAAK2jK,OAAS3jK,EAAKt0B,KAA/B,EAIF81B,EAAMiiK,GACNjiK,EAAM29J,GACN39J,EAAM49J,GAGN,MAAMhB,EAAS,IAAIgB,EAAW1Q,MAAMj6K,QAAOurB,GAAsB,WAAdA,EAAKt0B,QACxD,IAAI0H,EAAM,CAAC,EACX+rL,EAAWzQ,MAAM94K,SAAQoqB,IACvB5sB,EAAI4sB,EAAK5sB,KAAO4sB,EAAKvyB,IAArB,IAEF2wL,EAAOxoL,SAAQqK,IACb,GAAI9L,OAAOK,KAAKpB,GAAKpI,SAASiV,EAAM7M,KAAM,CACxC+rL,EAAWzQ,MAAMnlL,KAAK0W,GACtBA,EAAMyjL,MAAQzjL,EAAMxS,KACD2F,EAAI6M,EAAM7M,OACV6M,EAAMxS,OAAMwS,EAAMxS,KAAN,UAAgBwS,EAAMxS,KAAtB,YAA8B2F,EAAI6M,EAAM7M,OACvE6M,EAAM0jL,MAAQ1jL,EAAMvU,KACpBuU,EAAMvU,KAAO,gBACd,KAGH+3L,EAAS/3L,KAAO,OAEhB+3L,EAAS/U,MAAQ,CAACyQ,EAAYC,GAE9BqE,EAAS/U,MAAMnlL,QAAQ60L,GAGvBhrL,EAAMgrL,EAAOx2L,KAAIo4B,GAAQA,EAAK5sB,MAC9B,MAAMirL,EAAUc,EAAWzQ,MAAMj6K,QAAOurB,GAAsB,YAAdA,EAAKt0B,OAAuB0H,EAAIpI,SAASg1B,EAAK5sB,OAC9FqwL,EAAS/U,MAAMnlL,QAAQ80L,GAGvBoF,EAAS/U,MAAMnlL,QAAQ61L,EAAW1Q,MAAMj6K,QAAOurB,GAAsB,YAAdA,EAAKt0B,QAG5DmzL,GAAS4E,EAAUjlL,GAAOkB,MAAKm2J,IAC7B,IAAK,MAAOzrJ,EAAO3F,KAASoxJ,EAAMzhK,UAC5BqQ,EAAK2O,OAAOhgB,MAAQ+rL,EAAW/rL,IAEjCyiK,EAAMzrJ,GAAS,CAAC+I,OAAQ1O,EAAK2O,OAAQA,OAAQ3O,EAAK0O,OAAQpc,GAAI0N,EAAK1N,GAAI5H,MAAO,WACrEsV,EAAK2O,OAAOhgB,MAAQqwL,EAASrwL,KAAOqR,EAAK0O,OAAO/f,MAAQqwL,EAASrwL,KAGjEqR,EAAK0O,OAAO/f,MAAQ+rL,EAAW/rL,KAAOqR,EAAK2O,OAAOhgB,MAAQgsL,EAAWhsL,OAD9EyiK,EAAMzrJ,GAAS,MAMnBq5K,EAAS5tB,MAAQA,EAAMphK,QAAOgQ,GAAQA,IACtCg/K,EAASh2L,KAAO,KAEhBmsB,EAAO6pK,GACPn7G,EAAKm7G,GACLtD,EAAesD,EAEfrF,EAAOxoL,SAAQqK,IACbA,EAAMvU,KAAO,SACbuU,EAAMxS,KAAOwS,EAAMyjL,OAASzjL,EAAMxS,KAClCwS,EAAMjF,SAAW,IAAjB,IAEFyoL,EAAS/3L,KAAO+3L,EAASE,MACzBG,EAAQL,GACRK,EAAQ3E,GACR2E,EAAQ1E,GACR0C,EAAiB2B,EAAjB,GA7BF,IAgCDr5E,GAAG,aAAa36F,IACf4lI,KAAA,gBAAmB5lI,EAAE1Y,KAAM8E,MAAM,iBAAkB,GACnD02J,EAAI3gE,OAAJ,kBAAsBniF,EAAE1Y,KAAMizJ,KAAK,eAAgB,GACnD3U,KAAA,gBAAmB5lI,EAAE0D,OAAOpc,KAAM8E,MAAM,SAAUC,EAAM2I,MAAM5I,MAAM,iBAAkB,GACtFw5I,KAAA,gBAAmB5lI,EAAE2D,OAAOrc,KAAM8E,MAAM,SAAUC,EAAM2I,MAAM5I,MAAM,iBAAkB,GACtFyjL,EAAkB,6BAAI7vK,EAAEtgB,QAAxB,IAEDi7G,GAAG,YAAY36F,IACd4lI,KAAA,gBAAmB5lI,EAAE1Y,KAAM8E,MAAM,iBAAkB,IACnD02J,EAAI3gE,OAAJ,kBAAsBniF,EAAE1Y,KAAMizJ,KAAK,eAAgB,IACnD3U,KAAA,gBAAmB5lI,EAAE0D,OAAOpc,KAAM8E,MAAM,SAAUC,EAAM+5E,SAASh6E,MAAM,iBAAkB,IACzFw5I,KAAA,gBAAmB5lI,EAAE2D,OAAOrc,KAAM8E,MAAM,SAAUC,EAAM+5E,SAASh6E,MAAM,iBAAkB,IACzFyjL,EAAkB,GAAlB,GA7HJ,EAiIFtB,GAAe7qK,EAAQ3U,GAAOkB,MAAKyT,IAC5BA,GACLorK,GAASprK,EAAQ3U,GAAOkB,MAAKgvK,IAC3Bv7J,EAAOu7J,MAAQA,EACfv7J,EAAOhqB,EAAI,EACXgqB,EAAO2mC,EAAI,EACX3mC,EAAO9iB,EAAIimC,EAAQ,EACnBuoJ,GAAS1rK,EAAQ3U,GAAOkB,MAAKm2J,IAC3B1iJ,EAAO0iJ,MAAQA,EACf39D,EAAQ/kF,EACRra,EAAOqa,EACPosK,EAAepsK,GACfktK,EAAcltK,EACdyG,EAAOzG,GACPsuK,EAAO,CAACtuK,EAAOhqB,EAAGgqB,EAAO2mC,EAAc,EAAX3mC,EAAO9iB,GAAnC,IACCuP,MAAMm/J,EART,IASCn/J,MAAMm/J,GACRn/J,MAAMm/J,EAfP,GAFF,GAmBC,CACDnkH,EACA0kI,EACAC,EACAC,EACAC,EACAjhL,EACA2U,EACA0jD,EACAixC,EACAi3D,IAGK,sBAAKpjK,UAAWV,EAAQnC,KAAM+jB,IAAKg6C,GAA1C,IAuIaktH,OA1HMpqL,IAAMoI,MAAK,IAAgB,IAAf,QAACoY,GAAa,EAC7C,MAAM,IAACjc,GAAO0E,MACP4uJ,EAAgB8tB,GAAqBn9K,mBAAS,KAC9C6hL,EAAiBC,GAAsB9hL,mBAAS,CAAChZ,OAAGqC,EAAWsuD,OAAGtuD,KAClE04L,EAAY1E,GAAiBr9K,oBAAS,IACtCm+K,EAAab,GAAkBt9K,oBAAS,IACxCk+K,EAAad,GAAkBp9K,mBAAS,CAACzW,KAAM,WAC/C6jE,EAAYe,GAAiBnuD,mBAAS,IACvC3D,EAAQ+D,mBAAQ,MACpBrE,IAAKA,EACLupB,SAAU,CAAE,UAAa,IAAK,SAAY,IAAK,KAAQ,KACvDw2J,YAAa,CAAC,SAAU,QAAS,WACjCQ,SAAU,KACR,CAACvgL,IAECyyJ,EAAQpuJ,mBAAQ,KACpB,IAAK4X,IAAYA,EAAQgqK,UAAW,MAAO,GAE3C,MAAMhxK,EAAS,CACb5U,KAAM,aACN4b,QAASA,GAGX,OAAO,eAACklK,GAAD,CACLlsK,OAAQA,EACR3U,MAAOA,EACP8gL,kBAAmBA,EACnBC,eAAgBA,EAChBC,cAAeA,EACfC,eAAgBA,GANlB,GAQC,CAACtlK,EAAS3b,IAEb,IAAI4lL,EAAW,QACXC,EAAa,EACjB,GAAIhE,EAAa,CACf+D,EAAW/D,EAAY30L,MAAQ,QAC/B,IAAIyzL,EAAakB,EACb,CAAC,SAAU,WAAWr1L,SAASo5L,KAAWjF,EAAakB,EAAY92J,QAAU82J,GACjF,MAAM3R,EAAQyQ,EAAWzQ,MAAQyQ,EAAWzQ,MAAMj6K,QAAOurB,GAAQA,EAAKt0B,OAAS04L,IAAY,GACvF1V,EAAMzkL,SAAQo6L,EAAa3V,EAAM,GAAGz1I,MACzC,CAED,IAAI9pC,EAAK,aAASi1L,EAASl4L,MAAM,GAAI,GAA5B,YACLm4L,IAAYl1L,EAAK,iBAAai1L,EAAb,eAA4BC,EAA5B,MAErB,MAAM3oJ,EAAU,iCACd,eAAC6X,GAAA,EAAD,CAAarwC,OAAO,OAApB,SACE,eAACwpD,GAAA,EAAD,CACExyD,OAAQmmL,EACRpkL,KAAK,SACLlF,GAAG,qBACH5H,MAAOkxL,EAAclxL,EAAQ,gBAC7Bs/C,UAAW41I,IAAehE,EAC1B78I,YAAa,6BACb3+B,QAAQ,WACRvf,MAAOiqE,EACP7yB,SAAWpC,GAAUg2B,EAAch2B,EAAMlnB,OAAO9tB,OAChD4oE,WAAY,CACV+B,aACE,eAACj0D,GAAA,EAAD,CAAYjF,GAAG,qBAAqBmF,QAAS,IAAMo0D,EAAc,IAAKr0D,KAAK,SAA3E,SACE,eAAC,KAAD,WAMV,eAACD,GAAA,EAAD,CAAYjF,GAAG,oBAAf,SACE,eAAC8hC,GAAA,EAAD,CAASD,MAAK,UAAK0nJ,EAAc,UAAY,SAA/B,qBAAd,SACGA,EAAc,eAACgE,GAAA,EAAD,IAAgB,eAACC,GAAA,EAAD,QAGnC,eAACvoL,GAAA,EAAD,CAAYjF,GAAG,qBAAf,SACE,eAAC8hC,GAAA,EAAD,CAASD,MAAOsrJ,EAAa,cAAgB,cAA7C,SACGA,EAAa,eAACM,GAAA,EAAD,IAAe,eAACC,GAAA,EAAD,QAGjC,eAACzoL,GAAA,EAAD,CAAYjF,GAAG,aAAf,SACE,eAAC8hC,GAAA,EAAD,CAASD,MAAM,OAAf,SACE,eAAC8rJ,GAAA,EAAD,QAGJ,eAAC1oL,GAAA,EAAD,CAAYjF,GAAG,cAAf,SACE,eAAC8hC,GAAA,EAAD,CAASD,MAAM,QAAf,SACE,eAAC,KAAD,WAKN,OAAO+3H,GAAS,eAAC/sC,GAAD,CAAchrF,MAAM,iBAAiB78B,OAAQ2/B,EAA7C,SACd,eAAC4oF,GAAD,UACE,eAACzrF,GAAA,EAAD,CAASD,MAAO44H,EACdmzB,YAAarqJ,GAAS2pJ,EAAmB,CAAC96L,EAAGmxC,EAAMmvC,MAAO3vB,EAAGxf,EAAMovC,QACnE/F,YACE,CAACtiC,SAAU,CACTw+B,aAAc,EACdloB,YAAa,EACbimB,sBAAuB,MACrBriC,IAAKyoJ,EAAgBlqI,EACrBuS,KAAM23H,EAAgB76L,EACtB00C,MAAOmmJ,EAAgB76L,EACvBsqD,OAAQuwI,EAAgBlqI,EACxBxjB,MAAO,EACPC,OAAQ,MAZhB,SAiBE,+BACGo6H,SApBT,ICrqCai0B,OA1CSjrL,IAAMoI,MAAK,YAA4C,IAAD,gBAAlB,MAACqI,EAAD,QAAQ+P,GAAU,EAC5E,MAAM,QAACha,EAAD,SAAUoZ,GAAYmiF,KAE5B,GAAI,OAACtxF,QAAD,IAACA,GAAD,UAACA,EAAOpK,kBAAR,QAAC,EAAmBhV,SAAS,eAC/B,OAAO,KAGT,MAAM0wC,EACJ,eAACmnH,GAAD,CACEnmI,UAAW1gB,KACXmE,QAASA,EAASoZ,SAAUA,EAC5Bhb,KAAM,cAHR,SAKE,eAAC,KAAD,MAGE9Q,EAAO0sB,GAAU,UAAAA,EAAQwH,mBAAR,eAAqBl0B,OAAQ,GAAK,MACnDklC,EAAWxY,EAAO,UAAGA,EAAQwH,mBAAX,iBAAG,EAAqBqN,2BAAxB,aAAG,EAA0C/kC,OAAS,MAC9E,OAAO,eAAC25H,GAAD,CAAchrF,MAAM,qBAAqB78B,OAAQ2/B,EAAjD,SACL,gBAACz4B,GAAA,EAAD,CAAKC,OAAQ,EAAb,UACE,eAACD,GAAA,EAAD,CAAK0yB,aAAc,EAAnB,SACE,gBAACxyB,GAAA,EAAD,mDACwC1V,EADxC,SACoDklC,EADpD,6BAFJ,OAMGxY,QANH,IAMGA,GANH,UAMGA,EAASwH,mBANZ,iBAMG,EAAsBqN,2BANzB,aAMG,EAA2CpnC,KAAI+iC,IAAe,IAAD,EAC5D,MAAMpsB,EAAO,eAAiBosB,EAAWl9B,KACzC,OAAO,eAAC0V,GAAA,EAAD,UACL,eAAC0/I,GAAD,CAAenmI,UAAW5X,KAAMvG,KAAMA,EAAM4B,QAASA,EAASoZ,SAAUA,EAAxE,UACG,UAAAoR,EAAW5J,YAAX,eAAiB5xB,QAASw7B,EAAWl9B,QAFlBk9B,EAAWl9B,KAAnC,QASP,IC7BD,MAAM4rC,GAAU,CACd,CACEnlC,IAAK,aACL/E,MAAO,OACPyqC,MAAO,OACPF,UAAU,EACV3+B,OAAQgZ,GAAS,eAAC,GAAD,CAAUrS,SAAU,aAAc42C,QAAM,EAAC4qB,SAAO,EAAC1/B,YAAY,UAAU3lC,KAAMkW,KAEhG,CAAC7f,IAAK,aAAc0lC,MAAO,OAAQF,UAAU,EAAOvqC,MAAO,QAC3D,CACE+E,IAAK,WACL0lC,MAAO,OACP7+B,OAAQgZ,GAAS,eAAC,GAAD,CAAUrS,SAAU,WAAYwhE,SAAO,EAAC5qB,QAAM,EAAC6qB,eAAa,EAACtlE,KAAMkW,KAEtF,CACE7f,IAAK,YACL6G,OAAQmf,GAAU,eAAC,GAAD,CAAUxY,SAAU,YAAawhE,SAAO,EAAC5qB,QAAM,EAAC6qB,eAAa,EAACtlE,KAAMqc,MAIpF2qK,GAAiB,CACrB,aACA,aACA,YAGI9zB,GAAY,CAChB,SAAY,CACV,SAAY,KAEd,MAAS,UACT,WAAc,CACZ,SAAY,qBAAsB,MAAS,OAAQ,UAAa,KAIvD+zB,GAAiB/iL,gBAAK,IAA0C,IAAzC,QAACgjL,EAAD,eAAUF,EAAV,SAA0Bv8D,GAAc,EAC1E,OAAO,eAAC,GAAD,CACLjvF,QAASA,GAASyC,aAAc+oJ,EAChChnL,KAAMknL,EAAQn9L,KAAImsB,IAAK,IAASA,EAAMixK,kBAAmBjxK,MAFpD,SAIL,eAAC,GAAD,CAAgB2nB,SAAU4sF,GAAYX,GAAiBxpF,QAAS+pF,MAJlE,IA0Ga+8D,I,MAAAA,GAxFYljL,gBAAK,IAAc,IAAb,MAACqI,GAAW,EAC3C,MAAO86K,EAAiBC,GAAsBhjL,mBAAS,OAChDijL,EAAgBC,GAAqBljL,mBAAS,OAC9CmjL,EAAiBC,GAAsBpjL,oBAAS,IAChDqjL,EAAgBC,GAAqBtjL,oBAAS,IAE/C,IAACjE,GAAO0E,MACR,WAAC9I,GAAcmD,KAGrBoF,qBAAU,KACR,GAAI,OAAC+H,QAAD,IAACA,MAAO+mJ,iBAEV,YADAg0B,EAAmB,MAIrB,MAAMO,EAAiB,IAAIv/K,IAC3B,IAAK,MAAM4N,KAAS3J,EAAM+mJ,iBAAkBu0B,EAAex1L,IAAI6jB,EAAMu9I,iBAErE,MAAMD,EAAoB,IACrBN,GACHvyJ,MAAO,CACL,eAAgB,IAAIknL,KAGxBxnL,EAAIM,MAAM,UAAW6yJ,EAAmB,CAACzwJ,WAAW,IACjDlB,MAAM7B,IACLsnL,EAAmBtnL,EAAKA,KAAxB,IAED+B,MAAM9F,EAJT,GAKC,CAACoE,EAAKkM,EAAOtQ,IAEhB,MAAM6rL,GAAiC,OAAfT,QAAe,IAAfA,OAAA,EAAAA,EAAiBj7L,QAAS,EAC9C,eAAC66L,GAAD,CAAgBC,QAASG,EAAiBL,eAAgBA,KAC1D,eAAC9pH,GAAA,EAAD,CAAOC,SAAS,OAAhB,4CAGJ34D,qBAAU,KACR,MAAMujL,EAAmB,IACpB70B,GACCvyJ,MAAO,CAAC,mCAAoC4L,EAAM2iB,WAExD7uB,EAAIM,MAAM,UAAWonL,EAAkB,CAAChlL,WAAW,IAAOlB,MAAM7B,IAC9DwnL,EAAkBxnL,EAAKA,KAAvB,IACC+B,MAAM9F,EAFT,GAGC,CAACoE,EAAKkM,EAAOtQ,IAGhB,MAAM+rL,GAA+B,OAAdT,QAAc,IAAdA,OAAA,EAAAA,EAAgBn7L,QAAS,EAC5C,eAAC66L,GAAD,CAAgBC,QAASK,EAAgBP,eAAgBA,KACzD,eAAC9pH,GAAA,EAAD,CAAOC,SAAS,OAAhB,8CAEJ,OAAQ,eAAC4oD,GAAD,CAAchrF,MAAM,mBAApB,SACN,gBAAC+I,GAAA,EAAD,CAAME,OAAO,EAAb,UACE,gBAACD,GAAA,EAAD,CAAUj9B,QAAM,EAACzI,QAAS,IAAMqpL,GAAoBD,GAApD,UACE,eAACzsJ,GAAA,EAAD,CAASD,MAAM,2BAAf,SACE,eAACoJ,GAAA,EAAD,CAAc8vB,uBAAwB,CAACjtD,QAAS,aAClC1M,QAAQ,wCAEvBmtL,EAAkB,eAAC,KAAD,CAAgB1sL,SAAS,UAAY,eAAC,KAAD,CAAgBA,SAAS,aAEnF,eAACkmC,GAAA,EAAD,CAAUC,GAAIumJ,EAAiBtmJ,QAAQ,OAAvC,SACE,eAAC/7B,GAAA,EAAD,CAAK0yB,aAAc,EAAnB,SACGgwJ,MAGL,gBAAC/jJ,GAAA,EAAD,CAAUj9B,QAAM,EAACzI,QAAS,IAAMupL,GAAmBD,GAAnD,UACE,eAAC3sJ,GAAA,EAAD,CACED,QAAsB,OAAdwsJ,QAAc,IAAdA,OAAA,EAAAA,EAAgBn7L,SAAU,GAAK,uCAAyC,IAAM,2BADxF,SAEE,eAAC+3C,GAAA,EAAD,CAAc8vB,uBAAwB,CAACjtD,QAAS,aAClC1M,QAAQ,0CAEvBqtL,EAAiB,eAAC,KAAD,CAAgB5sL,SAAS,UAAY,eAAC,KAAD,CAAgBA,SAAS,aAElF,eAACkmC,GAAA,EAAD,CAAUC,GAAIymJ,EAAgBxmJ,QAAQ,OAAtC,SAA8C6mJ,QAtBlD,IChHF,MAAMhpL,GAAUmL,oBAAS,OAAC3S,QAAD,IAACA,GAAD,WAACA,EAAIG,YAAL,mBAAC,GAAUlB,eAAX,cAAC,GAAmBF,SAGvCE,GAAU,CACd,WAAc,CAAC,MAAS,OAAQ,MAAS,QACzC,WAAc,CAAC,MAAS,aAAc,MAAS,QAC/C,kBAAqB,CAAC,MAAS,sBAAuB,MAAS,QAC/D,YAAe,CAAC,MAAS,cAAe,MAAS,QACjD,UAAa,CAAC,MAAS,YAAa,MAAS,QAC7C,mBAAsB,CAAC,MAAS,cAAe,MAAS,QACxD,QAAW,CAAC,MAAS,UAAW,MAAS,OAAQ,UAAY,GAC7D,sBAAuB,CAAC,MAAS,QAGnCH,OAAOK,KAAKF,IAASsB,SAAQ1B,IAASI,GAAQJ,GAAKA,IAAMA,CAAnB,IACtC2I,GAAQw8B,QAAQ/kC,QAAUA,GAC1BuI,GAAQw8B,QAAQ7vB,SAfK,CAAC,aAAc,aAAc,qBAgBlD3M,GAAQohD,KAAK9f,QAAU,CAAEkoC,SAAS,GAClCxpE,GAAQohD,KAAKviB,QAAU,CAAE2qC,SAAS,GAElC,MAAMy/G,GAAc/jL,gBAAK,KACvB,MAAM,WAAE++C,GAAe5Q,MACjB,KAAEryC,GAASijD,IAEjB,OAAKjjD,GAAwB,IAAhBA,EAAK5T,OAKhB,eAAC25H,GAAD,CAAchrF,MAAM,UAApB,SACE,eAAC+vF,GAAD,CACE/vF,MAAM,WACNgD,aAAa,EACb4sF,WAAY,CAAC5yD,UAAW,OARrB,IAGT,IAiDamwH,OAtCgBhkL,gBAAK,IAAgB,IAAD,MAAd,MAAEqI,GAAY,EACjD,MAAM07C,EAAgBvjD,mBAAQ,MAC5B,mCAAoC,CAAC6H,EAAM2iB,UAC3C,yCAA0C,CAAC,qDACzC,CAAC3iB,EAAM2iB,WAEX,OAAI,UAAC3iB,EAAM47K,oBAAP,OAAC,EAAoBn5L,MAAK8Z,GAA0C,kDAAhC,OAAHA,QAAG,IAAHA,OAAA,EAAAA,EAAKs/K,6BAKxC,eAAC98H,GAAD,CACEpN,SAAQ,OAAEl/C,SAAF,IAAEA,QAAF,EAAEA,GAASk/C,SACnBK,kBAAiB,OAAEv/C,SAAF,IAAEA,QAAF,EAAEA,GAASymB,WAC5B24B,eAAc,OAAEp/C,SAAF,IAAEA,QAAF,EAAEA,GAASw8B,QACzB6iB,YAAW,OAAEr/C,SAAF,IAAEA,QAAF,EAAEA,GAASohD,KACtB9B,mBAAkB,OAAEt/C,SAAF,IAAEA,QAAF,EAAEA,GAASksH,aAC7B/sE,qBAAsB8J,EACtBvJ,sBAAqB,OAAE1/C,SAAF,IAAEA,QAAF,EAAEA,GAASgsH,gBAPlC,SASE,eAACi9D,GAAD,MAbK,IAGT,ICrDF,MAAMzsJ,GAAU,CACd,CAACnlC,IAAK,WAAY0lC,MAAO,OAAQzqC,MAAO,YACxC,CAAC+E,IAAK,YAAa0lC,MAAO,OAAQzqC,MAAO,YAAa4L,OAAQ8C,GAAQ,eAAC,GAAD,CAAU6D,SAAU,YAAawhE,SAAO,EAAC5qB,QAAM,EAAC6qB,eAAa,EAACtlE,KAAMA,MA6B7HqoL,OA1BwBvsL,IAAMoI,MAAK,IAAgD,IAA/C,gBAACokL,EAAD,cAAkBC,EAAlB,QAAiC/rL,GAAa,EAC/F,MAAMgsL,EAA4B9jL,mBAAQ,IACjC4jL,EAAgBv+L,KAAIusC,IAAS,IAASA,EAAW3a,SAAU2a,EAAUmyJ,gBAAiBl/J,UAAW+M,EAAUoyJ,sBACjH,CAACJ,IAEJ,OACEC,EAAcn8L,OAAS,EAAI,gBAAC,IAAM+Y,SAAP,WAC3B,eAACigG,GAAA,EAAD,UACE,uBAAMpnG,MAAO,CAACC,MAAO,OAArB,SAA8BzB,GAAW,2EAE3C,gBAAC4oG,GAAA,EAAD,sCAEE,eAAC,GAAD,CAAW5pE,QAASA,GAASx7B,KAAMwoL,OAErC,gBAACpjF,GAAA,EAAD,4BAEE,eAAC,GAAD,CAAW5pE,QAASA,GAASx7B,KAAMuoL,UAEnB,IAbpB,ICgHaI,OAjHoB7sL,IAAMoI,MAAK,IAA0F,IAAzF,QAACrJ,EAAD,SAAU+1C,EAAV,YAAoBoiD,EAApB,KAAiCv5F,EAAjC,gBAAuCmvL,EAAvC,cAAwDC,EAAxD,YAAuEx9K,GAAiB,EACrI,MAAM0xC,EAAUW,cACV+uE,EAAgBnH,KAChBxnB,EAAeD,MACf,IAACx9F,GAAO0E,MACR,WAAC9I,GAAcmD,MACd0pL,EAAyBC,GAA8BzkL,oBAAS,IAChE0kL,EAAeC,GAAoB3kL,oBAAS,IAC7C,SAACoX,GAAY+wG,GAAiB3uB,GAC9B,aAACr3E,GAAgBgmG,GAAiB,CAAC,GACnC,QAACnqH,EAAD,SAAUgmB,GAAYw1E,GAAgB,CAAC,EACvCvjF,EAAQjY,EAAU,EAAIumL,GACrBP,EAAiBY,GAAsB5kL,mBAAS,KAChDikL,EAAeY,GAAoB7kL,mBAAS,IAE7C24B,EAAchyB,uBAAY,KAC9B89K,GAA2B,EAA3B,GACC,CAACA,IAEJvkL,qBAAU,KACR,IAAKskL,EACH,OAEF,MAAMx6D,EAA6B,OAAfs6D,QAAe,IAAfA,KAAiB15J,SAC/B,CAACF,MAAO,UAAWruB,MAAO,CAAC2yJ,iBAAkB,CAAC,uBAAsC,OAAfs1B,QAAe,IAAfA,OAAA,EAAAA,EAAiB15J,WAAY,MAClG,CAACF,MAAO,UAAWruB,MAAO,CAAC2yJ,iBAAkB,CAAC,uBAAuC,OAAfs1B,QAAe,IAAfA,KAAiBr/J,UAAY,QAACq/J,QAAD,IAACA,OAAD,EAACA,EAAiBr/J,WAAa,MACxIlpB,EAAIgC,KAAJ,gBAA0BisH,GACvBzsH,MAAKoB,IACJ,MAAMjD,GAAc,OAAPiD,QAAO,IAAPA,OAAA,EAAAA,EAASjD,OAAQ,GAC9B,GAAIA,EAAK5T,OAAS,EAAG,CACnB,MAAMm8L,EAA+B,OAAfK,QAAe,IAAfA,KAAiB15J,SACjClvB,EAAKpJ,QAAOsf,KAAS,OAAC0yK,QAAD,IAACA,KAAiB15J,SAAS/hC,SAAS+oB,EAAMgZ,aAC/DlvB,EAAKpJ,QAAOsf,GAASA,EAAMqT,aAAN,OAAoBq/J,QAApB,IAAoBA,OAApB,EAAoBA,EAAiBr/J,aAChE4/J,EAAiBZ,GACjB,MAAMa,EAAgBppL,EAAKjW,KAAImsB,GAASA,EAAMo9I,mBAAkBnoC,OAC1D90F,EAAa,IAAI,IAAIyyF,IAAIsgE,EAAcr/L,KAAImsB,GAAS,CAACA,EAAMu9I,gBAAiBv9I,MAASte,UAC3FsxL,EAAmB7yJ,EACpB,KAEFt0B,OAAMijH,GACL/oH,EAAW+oH,IAdf,GAgBC,CAAC3kH,EAAKyoL,EAAyB7sL,EAAY2sL,IAE9C,MAAMS,EAAep+K,uBAAY,KAC/B89K,GAA2B,GAC3B,MAAMz6D,EAAc,CAAC3tH,MAAOioL,GAAmB,CAAC15J,SAAU5sB,GAAUgnL,uBAAwBN,GAC5F3oL,EAAIgC,KAAJ,kBAAoBqZ,EAApB,8BAA0D4yG,GACvDzsH,MAAKoB,IACJwjB,GAAgBA,EAAa,CAACpK,OAAQpZ,EAAQjD,OAC9CqL,GAAeA,EAAY,IAAI/C,KAC/BhG,GAAWy6C,EAAQrxD,KAAR,kCAAwCgwB,GAAnD,IAED3Z,OAAMijH,GACL/oH,EAAW+oH,IAPf,GASC,CAAC+jE,EAA4B1oL,EAAKpE,EAAYyf,EAAUktK,EAAiBv9K,EAAaob,EAAcnkB,EAASy6C,EAASisI,IAEzH,OACEv8D,GAAkB3uB,GAAgBx1E,EAAY,gBAAC,IAAMnjB,SAAP,WAC5C,eAAChH,GAAA,EAAD,IACM60F,EACJpiD,SAAUA,EACVvyC,QAAS4+B,EACTj/B,MAAOvE,EAAO,CAACwE,MAAO,SAAW,KAJnC,SAME,eAAC+8B,GAAA,EAAD,CAASD,MAAOlgC,GAAWijG,EAAe,eAAiB,0BAA3D,SACE,eAAC,KAAD,QAGJ,gBAACpjE,GAAA,EAAD,CACE/8B,KAAMmrL,EACN,mBAAiB,2BAFnB,UAIE,gBAACluJ,GAAA,EAAD,WACE,eAACwqE,GAAA,EAAD,CAAmBlsG,GAAG,2BAAtB,SACE,mEAAmCmhB,GAAU,QAASE,GAAO,GAA7D,SAEF,gBAAC6qF,GAAA,EAAD,gCACqB/qF,GAAU,QAASE,GAAO,GAD/C,kDACqGF,GAAU,QAASE,GAAO,GAD/H,OAGA,eAACw3B,GAAA,EAAD,CACEC,QAAS,eAACtT,GAAA,EAAD,CACPG,SAAUpC,GAASwsJ,EAAiBxsJ,EAAMlnB,OAAOqpB,SACjD3gC,MAAM,UACN2gC,QAASoqJ,EACTp5L,KAAK,mBAEP0B,MAAK,0BAAqB+oB,GAAU,UAAWE,GAAO,GAAjD,oDAEP,eAAC,GAAD,CAAyB+tK,gBAAiBA,EAAiBC,cAAeA,OAE5E,gBAAC1tJ,GAAA,EAAD,WACE,eAAC3zB,GAAA,EAAD,CAAQ7I,QAAS,IAAM0qL,GAA2B,GAAQ1jF,WAAS,EAAnE,oBACA,eAACn+F,GAAA,EAAD,CAAQ7I,QAAS,IAAMgrL,IAAgB,cAAa,8BAApD,SACGL,EAAa,UACTT,EAAcn8L,OAAS,EAAI,gBAAkB,SADpC,YACgDiuB,GAAU,QAASE,GAAO,GAD1E,oBAC2FF,GAAU,SAAUE,GAAO,IADtH,UAETguK,EAAcn8L,OAAS,EAAI,gBAAkB,SAFpC,YAEgDiuB,GAAU,QAASE,GAAO,eAI5E,IA3CtB,ICnCF,SAASgvK,GAAT,GAA6C,IAApB,MAACxuJ,EAAD,SAAQ59B,GAAW,EAC1C,OAAO,gBAACiI,GAAA,EAAD,CAAKoyB,UAAW,EAAGM,aAAc,EAAjC,UACJiD,GAAS,eAACz1B,GAAA,EAAD,CAAYuZ,UAAU,MAAtB,SACR,eAACzZ,GAAA,EAAD,CAAKrK,SAAS,cAAc+8B,aAAc,EAA1C,SACGiD,MAGJ59B,IAEJ,CAOD,MAAMuJ,GAAYC,cAAWnI,IAAK,CAChCvD,KAAM,CACJ68B,aAAct5B,EAAMkH,QAAQ,IAE9B29I,WAAY,CACVhqH,SAAU,MACV0wF,UAAW,MACXxoF,SAAU,EACVvI,aAAcx6B,EAAMkH,QAAQ,IAE9B8jL,YAAa,CACXnwJ,SAAU,SACV0wF,UAAW,SACXxoF,SAAU,EACV,UAAW,CACTzJ,aAAct5B,EAAMkH,QAAQ,KAGhC+jL,YAAa,CACX3xJ,aAAa,GAAD,OAAKt5B,EAAMkH,QAAQ,GAAnB,kBAEdozB,QAAS,CACPtB,UAAWh5B,EAAMkH,QAAQ,GACzBoyB,aAAct5B,EAAMkH,QAAQ,QAK1BkkB,GAAW,CACf7F,SAAU,IACV/jB,KAAM,IACN8jB,YAAa,IACbwiK,UAAW,IACXrjL,QAAS,CACPwT,SAAU,IACV/T,OAAQ,IACRklH,WAAY,CACV8hE,WAAY,IACZ7hE,WAAY,IACZ8hE,UAAW,IACX92C,WAAY,CACV/nG,4BAA6B,mBAC7BD,eAAgB,mBAIhB6wH,mBAAoB,CAClB17J,KAAM,CACJwwG,SAAU,mBACVp1E,MAAO,mBACPwuJ,aAAc,IACd7tB,WAAY,IACZ8tB,aAAc,IACdr2E,SAAU,qBAGd5oE,0BAA2B,mBAC3B4oE,SAAU,KAEZ0/B,WAAY,mBACZurC,cAAe,mBACfzrC,YAAa,mBACb82C,cAAe,mBACf12C,sBAAuB,CACrB5iC,SAAU,uBAMZu5E,GAAejuL,IAAMoI,MAAK,KAAO,IAAD,QACpC,MAAM,MAAE+5F,GAAUF,MACV/9F,KAAMuM,EAAO1M,SAAUmqL,G/I7FT,MACtB,MAAM,QAAE1nL,GAAYy7F,MACd,IAAE19F,GAAQ0E,MACTlF,EAAUoqL,GAAe3lL,mBAAS,CAAC,GAW1C,OAPAE,qBAAU,KACRylL,EAAY,CAAC,GACb5pL,EACGQ,IADH,kBACkByB,GAAW,KAAM,CAACM,eAAe,IAChDf,MAAKhC,IAAQ,aAAIoqL,EAAY,CAACjqL,KAAI,OAAEH,QAAF,IAAEA,GAAF,UAAEA,EAAUA,gBAAZ,aAAE,EAAoBG,KAAMH,SAAUA,GAA3D,GAFhB,GAGC,CAACQ,EAAKiC,IAEFzC,CAAP,E+I+EgDqqL,IAC1C,IAAE30L,EAAF,OAAO8yB,EAAP,SAAeC,EAAUhM,QAAS6tK,EAAlC,eAA8ChiK,GAAmB01E,GAAcj0E,KAC9EkL,EAAUk3F,GAAe1nH,mBAAS,IAKnCgY,GAAe,OAAL/P,QAAK,IAALA,OAAA,EAAAA,EAAO2iB,aAAP,OAAoB/G,QAApB,IAAoBA,GAApB,UAAoBA,EAAgBtoB,gBAApC,iBAAoB,EAA0BG,YAA9C,aAAoB,EAAgCkvB,UAChEi7J,OACAx8L,EAEEyP,EAAUsJ,MACV,WAACzK,GAAcmD,KACfigB,EAAe,OAAP/C,QAAO,IAAPA,GAAA,UAAAA,EAAStc,YAAT,SAAe6rJ,SAAf,UAA6BvvI,EAAQtc,KAAKqf,MAA1C,YAAmD/C,EAAQtc,KAAK6rJ,UAAhE,OAA6EvvI,QAA7E,IAA6EA,GAA7E,UAA6EA,EAAStc,YAAtF,aAA6E,EAAeqf,MAEpG+qK,ElMnCD,SAAwB70L,GAC7B,MAAM83B,EAAYpJ,MACZ,WAAEhoB,GAAemD,MAChBirL,EAAaC,GAAkBhmL,mBAAS,MAoB/C,OAlBAE,qBAAU,KACHjP,EAEMA,EAAI8G,OACbJ,EAAW1G,EAAI8G,OACfiuL,EAAe,OAEfj9J,EAAUX,oBAAoBn3B,GAC3BsM,MAAKc,IACJ2nL,EAAe3nL,EAAf,IAEDZ,OAAM1F,IACLJ,EAAWI,GACXiuL,EAAe,KAAf,IAXJA,EAAe,KAahB,GACA,CAAC/0L,EAAK+0L,EAAgBj9J,EAAWpxB,IAE7BouL,CACR,CkMWyBE,CADGh1L,GAAOwoB,GAAuBsB,EAAO9pB,IAG1DqyH,EAAaljH,mBAAQ,KAAO,IAAD,IAC/B,OAAO,IAAI4D,KAAS,OAALiE,QAAK,IAALA,GAAA,UAAAA,EAAOtJ,eAAP,mBAAgB2kH,kBAAhB,eAA4B+wD,uBAAwB,GAAnE,GACC,CAACpsK,IAEJ/H,qBAAU,KACR,IAAK4lL,GAAmB,OAAC9tK,QAAD,IAACA,MAAStc,KAChC,OAEkBunB,WAClB,MAAMuN,EAAW,GAUjB,OATA8B,GAASta,EAAQtc,KAAMoqL,EAAiB,QAAQ,CAACvzJ,EAAS/J,EAAYpsB,KAAU,IAAD,OAChE,SAATA,GAAA,UAAmBosB,EAAW9J,qBAA9B,iBAAmB,EAA0BC,WAA7C,iBAAmB,EAAgC,UAAnD,OAAmB,EAAoCunK,WACzD11J,EAASppC,KAAK,CACZ25J,YAAa3kJ,EACbosB,WAAYA,EACZ+J,QAASA,GAEZ,IAEI/B,CAAP,EAEF21J,GAAc5oL,MAAMizB,IAClBk3F,EAAYl3F,EAAZ,IACC/yB,MAAM9F,EAFT,GAGC,CAACqgB,EAAS8tK,EAAiBp+D,EAAa/vH,IAG3C,MAAMyuL,EAAYhmL,mBAAQ,KAAO,IAAD,QAC9B,IAAK2jB,IAAW9b,EAAO,MAAO,GAC9B,MAAMo+K,EAAU,CACd7mK,YAAaijK,GACb6D,MAAO7V,GACPt+J,SAAe,OAALlK,QAAK,IAALA,GAAA,UAAAA,EAAOtJ,eAAP,mBAAgBwT,gBAAhB,SAA0By5J,SAChCF,GACK,OAALzjK,QAAK,IAALA,GAAA,UAAAA,EAAOtJ,eAAP,mBAAgB2kH,kBAAhB,SAA4BC,WAC1BF,GACAktD,GACNhiC,WAAYqoB,GACZpoB,UAAW8sB,GACX5sB,YAAayiC,GACbviC,WAAYqjC,GACZuT,cAAe9Q,GACf0Q,WAAY9M,GACZ+M,UAAWtP,GACXjnC,sBAAuB2qC,GACvBU,cAAeJ,GACftnK,SAAUmvK,GACV7vJ,WAAY+wJ,GACZrqI,QAASmrI,GACT2C,iBAAkBxL,IAGpB,OAAI99J,kBAAO,OAAC08E,QAAD,IAACA,OAAD,EAACA,EAAOxnG,SACV,eAACymE,GAAA,EAAD,CAAOC,SAAS,UAAhB,wGAKF7mE,OAAOsB,OAAOqmG,EAAMxnG,SAAS1M,KAAKgN,IACvC,IAAIk/I,EAAO,KACX,MAAMt6I,EAAM5E,EAAOsF,OAAS,yBACtBhG,EAAMU,EAAOV,IACnB,GAAY,aAARA,EACF4/I,EAAO,eAAC,IAAM9wI,SAAP,UACF2vB,EACA/qC,KAAI,CAAC8sC,EAAStqB,IACb,eAAC,GAAD,CAA0B/P,QAASb,EAAnC,SACE,eAAC,GAAD,IACMk7B,EACJwuH,YAAaxuH,EAAQwuH,YAAYjuJ,QAAQ,MAAO,KAChD4iE,UAAW1xC,KAJI/b,MAHGlW,OAYvB,CACL,MAAMy+I,EAAO61C,EAAQt0L,GACjBy+I,IACFmB,EAAO,eAAC,GAAD,CAAwBz5I,QAASb,EAAjC,SACL,eAACm5I,EAAD,CAAMvoI,MAAOA,EAAO+P,QAASA,EAASsrG,WAAYA,KAD1BvxH,GAI7B,CACD,OAAO4/I,CAAP,GAzBF,GA2BC,CAAC5tH,EAAQ9b,EAAO0xF,EAAOnpE,EAAUxM,EAAUhM,EAASsrG,IAEvD,OAAKv/F,EAQA9b,EAEE,eAACozF,GAAD,CAAMH,cAAY,EAAlB,SACL,gBAAC3iC,GAAA,EAAD,CAAMG,WAAS,EAACt3D,QAAS,EAAG5H,UAAWV,EAAQnC,KAA/C,UACE,gBAAC4hE,GAAA,EAAD,CAAMl9C,MAAI,EAACi9C,GAAI,EAAG9+D,UAAWV,EAAQimJ,WAArC,UACE,eAACkmC,GAAD,CAAiBxuJ,MAAM,WAAvB,SACE,eAACuuF,GAAD,CAAgBtpH,KAAMuM,MAExB,eAAC20F,GAAA,EAAD,CAASpjG,UAAWV,EAAQ07B,UAC5B,eAACywJ,GAAD,UACE,gBAAC,GAAD,CAAUpmJ,MAAI,EAAd,UACE,eAAC,GAAD,CAAUt/B,SAAS,UAAU7D,KAAMuM,IACnC,eAAC,GAAD,CAAU1I,SAAS,aAAa7D,KAAMuM,IACtC,eAAC,GAAD,CAAU1I,SAAS,UAAU7D,KAAMuM,IACnC,eAAC,GAAD,CAAU1I,SAAS,WAAW7D,KAAMuM,SAGxC,eAAC20F,GAAA,EAAD,CAASpjG,UAAWV,EAAQ07B,UAC5B,eAACywJ,GAAD,UACE,gBAAC,GAAD,CAAU5tJ,QAAM,EAAC39B,MAAO,CAACq7B,SAAU,KAAnC,UACE,eAAC,GAAD,CAAUx1B,SAAS,WAAW7D,KAAMuM,IACpC,eAAC,GAAD,CAAU1I,SAAS,WAAW7D,KAAMuM,IACpC,eAAC,GAAD,CAAU1I,SAAS,+BAA+B7D,KAAMuM,IACxD,eAAC,GAAD,CAAU1I,SAAS,YAAY7D,KAAMuM,IACrC,eAAC,GAAD,CAAU1I,SAAS,qBAAqB7D,KAAMuM,IAC9C,eAAC,GAAD,CAAU1I,SAAS,SAAS7D,KAAMuM,IAClC,eAAC,GAAD,CAAU1I,SAAS,cAAc7D,KAAMuM,IACvC,eAAC,GAAD,CAAU1I,SAAS,uBAAuB7D,KAAMuM,IAChD,eAAC,GAAD,CAAU1I,SAAS,0BAA0B7D,KAAMuM,SAGvD,gBAAC,GAAD,CAAuBjb,MAAM,MAAM+nC,SAAS,KAAKs4B,WAAS,EAAC1gB,YAAa,CAACjqC,QAAS,YAAa5I,KAAM,SAArG,UACG4rL,GAAgB,eAACv0E,GAAD,IACXu0E,EACJjqL,YAAY,sFAEd,eAACu1G,GAAD,IACCntF,GAAkB,eAACstF,GAAD,IACbttF,EACJpoB,YAAY,4IAKlB,gBAAC88D,GAAA,EAAD,CAAMl9C,MAAI,EAACi9C,GAAI,EAAG9+D,UAAWV,EAAQosL,YAArC,UACGlhK,GACC,gBAACljB,GAAA,EAAD,CAAK2zB,UAAU,QAAQj7B,UAAWV,EAAQqsL,YAAatqL,QAAS,OAAQ29B,eAAgB,WAAxF,UACE,eAAC,GAAD,IACA,eAAC,GAAD,IACA,eAACkuH,GAAD,IACA,eAAC,GAAD,CACE8/B,QAAM,EACN93F,YAAa,CAAC/0F,MAAO,gBAI1BysL,UAxDY,KAPV,eAAC/qF,GAAD,UACL,eAACr6F,GAAA,EAAD,0CAQJ,IA4DFykL,GAAagB,iBAAkB,EAEhBhB,UCvSR,MAUDrjL,GAAYC,cAAWnI,IAAK,CAChCwsL,eAAgB,CACdxzJ,UAAWh5B,EAAMkH,QAAQ,IAE3BrJ,MAAO,CACLm7B,UAAWh5B,EAAMkH,QAAQ,IAE3BulL,YAAa,CACXp1I,OAAQ,EACR7V,MAAO,GACP4V,OAAQ,GACRne,SAAU,wBAIC,SAASyzJ,GAAiB7tL,GACvC,MAAMD,EAAUsJ,MACV,IAACnR,EAAD,QAAM+mB,EAAN,eAAe6L,EAAf,OAA+BE,GAAUw1E,GAAc,KAE7D,OAAKx1E,EAaH,eAACs3E,GAAD,CAAMlnE,MAAO,OAAb,SAEInc,GAA8B,kBAAZA,EACd,sBAAKxe,UAAWV,EAAQ4tL,eAAxB,SACA,eAACr2E,GAAer3G,SAAhB,CAAyB7V,MAAO0gC,EAAhC,SACE,eAAC,GAAD,CAAgB5yB,IAAKA,QAEhB,+BACP+mB,EACI,iCACA,eAAChX,GAAA,EAAD,+EACA,eAACw3D,GAAA,EAAD,UACE,eAACC,GAAA,EAAD,UACE,+BAAMzgD,GAAW,YAIrB,eAAChX,GAAA,EAAD,8BA5BV,eAACq6F,GAAD,UACE,eAACr6F,GAAA,EAAD,CAAYxH,UAAWV,EAAQf,MAA/B,yLAgCP,C,eCzDD,MAAM8uL,GAAoBxkL,cAAWnI,IAAK,CACxCwpG,QAAS,CACP/pG,MAAOmtL,KAAM,MAEfC,UAAW,CACT1yJ,UAAW,SACXtzB,OAAQ,OAINimL,GAAWxvL,IAAMoI,MAAK,SAAkB7G,GAC5C,MAAMD,EAAU+tL,MACV,KAACnrL,EAAD,SAAOurL,GAAYluL,EAEnBmuL,EAAe,CAAC,EAMtB,MALmB,UAAfxrL,EAAKiuB,OAAoC,aAAfjuB,EAAKiuB,MACjCu9J,EAAavtL,MAAQ,QACG,YAAf+B,EAAKiuB,QACdu9J,EAAapuL,QAAU,CAACnC,KAAMmC,EAAQ4qG,UAGtC,gBAAC5H,GAAA,EAAD,CAAW,cAAY,aAAvB,UACE,eAACC,GAAA,EAAD,CAAkBC,WAAY,eAAC,KAAD,IAA9B,SACE,gBAACh7F,GAAA,EAAD,IAAgBkmL,EAAhB,UAA+BxrL,EAAKiuB,MAApC,KAA8Cs9J,EAASxhM,KAAKsM,GAAD,UAAY2J,EAAK3J,MAAQwD,KAAK,YAE3F,eAAC0mG,GAAA,EAAD,UACE,eAAC,KAAD,CACEpF,IAAKn7F,EACLs7F,iBAAiB,EACjBC,mBAAmB,MAEtBv7F,EAAKqrL,WAAa,eAAC9qF,GAAA,EAAD,UACjB,sBAAKziG,UAAWV,EAAQiuL,UAAxB,SAAoCrrL,EAAKqrL,gBAIhD,IAMK3kL,GAAYC,cAAWnI,IAAK,CAChCitL,SAAU,CACRj0J,UAAWh5B,EAAMkH,QAAQ,IAE3BulL,YAAa,CACXp1I,OAAQ,EACR7V,MAAO,GACP4V,OAAQ,GACRne,SAAU,oBAEZi0J,YAAa,CACXrmL,OAAQ7G,EAAMkH,QAAQ,GACtB4qC,SAAU,IACVjX,SAAU,KAEZg8G,MAAO,CACLl2I,QAAS,OACT49B,SAAU,QAEZgmC,KAAM,CACJ19D,OAAQ,GAEVggE,QAAS,CACP7tC,UAAWh5B,EAAMkH,QAAQ,IAE3BimL,QAAS,CACPtmL,OAAQ7G,EAAMkH,QAAQ,QAIpBkmL,GAAoB9vL,IAAMoI,MAAK,SAA2B7G,GAC9D,MAAM,UAACwuL,EAAD,mBAAYC,GAAsBzuL,EACxC,OACE,gBAAC0tJ,GAAA,EAAD,CAAW79J,KAAG,EAAd,UACE,eAACoY,GAAA,EAAD,CAAYtH,MAAO,CAACyH,QAAS,MAAOszB,UAAW,UAA/C,mCAGC,CAAC,QAAS,WAAY,UAAW,OAAQ,SAAShvC,KAAI,CAACsM,EAAK/L,IAEzD,eAACynD,GAAA,EAAD,CACEC,QAAS,eAACtT,GAAA,EAAD,CACPE,QAASitJ,EAAUx1L,GACnBwoC,SAAUitJ,EACVl8L,KAAMyG,EAAK6C,GAAE,UAAK5O,KACpBgH,MAAO+E,GALc/L,OAWhC,IAMKyhM,GAAsBjwL,IAAMoI,MAAK,SAA6B7G,GAClE,MAAM,UAACS,EAAD,SAAYytL,EAAZ,kBAAsBS,EAAtB,WAAyCC,GAAc5uL,EAC7D,OACE,gBAACq4C,GAAA,EAAD,CAAa,cAAY,gBAAgB53C,UAAWA,EAAU4tL,YAA9D,UACE,eAAC/1I,GAAA,EAAD,CAAY,cAAY,iBAAiBz8C,GAAG,qBAA5C,6BACA,eAACu4C,GAAA,EAAD,CACEy6I,QAAQ,qBACRhzL,GAAG,eACH,cAAa,eACb4iC,UAAQ,EACRr0C,MAAO8jM,EACP1sJ,SAAUmtJ,EACV5pL,MAAO,eAAC+pL,GAAA,EAAD,CAAOjzL,GAAG,yBACjBusE,YAAc95D,GACZ,sBAAK7N,UAAWA,EAAUu3I,MAA1B,SACG1pI,EAAS5hB,KAAKtC,GACb,eAAC07E,GAAA,EAAD,CAAkB7xE,MAAO7J,EAAOqW,UAAWA,EAAUilE,MAA1Ct7E,OAXnB,SAgBGwkM,EAAWliM,KAAK6F,GACf,eAACiiD,GAAA,EAAD,CAAU,wBAAgBjiD,GAAmBnI,MAAOmI,EAApD,SACGA,GADoCA,SAOhD,IAQc,SAASw8L,GAAe/uL,GAAQ,IAAD,EAC5C,MAAMD,EAAUsJ,MACV,QAACpE,EAAD,SAAUyhB,GAAY85E,MACtB,IAACx9F,GAAO0E,MACR,WAAC9I,GAAcmD,MAEdY,EAAMiyH,GAAW3tH,mBAAS,OAC1B+nL,EAAcC,GAAmBhoL,oBAAS,IAE1CunL,EAAWU,GAAgBjoL,mBAAS,CACzCkoL,OAAO,EACPC,OAAO,EACPC,UAAU,EACVC,SAAS,EACTC,MAAM,KAGDC,EAAcC,GAAmBxoL,mBAAS,KAC1CinL,EAAUwB,GAAezoL,mBAAS,CAAC,SAAU,UAE9C0oL,EAAyBptL,IAC7BmtL,EAAYntL,EAAE2V,OAAO9tB,MAArB,EAGIwlM,EAA0BrtL,IAC9B2sL,EAAa,IAAIV,EAAW,CAACjsL,EAAE2V,OAAO3lB,MAAOgQ,EAAE2V,OAAOqpB,SAAtD,EAGFp6B,qBAAU,KACRnE,EAAIgC,KAAJ,mBAAqBC,EAArB,kBAA8C,CAACsnB,SAAU,CAACS,gBAAiB,OACxExoB,MAAKhC,IACJ,MAAMG,EAAOH,EAASG,KAAKsc,QAAQ+N,iBAAmB,GACtD4nG,EAAQjyH,EAAR,IAED+B,OAAM1F,IACc,iBAAfA,EAAMzM,KACR08L,GAAgB,GAEhBrwL,EAAWI,EACZ,GAVL,GAYC,CAAC41H,EAASq6D,EAAiBjsL,EAAKpE,EAAYqG,IAO/C,MAAM4qL,EAAeltL,EAAO,IAAIA,GAAQ,GAUxC,GATA,OAAI+jB,QAAJ,IAAIA,GAAJ,UAAIA,EAAU6sG,yBAAd,OAAI,EAA6BxkI,QAC/B8gM,EAAaxhM,KAAK,CAChB+wC,MAAO,mBACPxO,MAAO,QACPk6B,UAAWpkC,EAASwG,qBACpBqmG,kBAAmB7sG,EAAS6sG,oBAI5By7D,IAAiBa,EAAa9gM,OAChC,OACE,eAACuzG,GAAD,UACE,eAACr6F,GAAA,EAAD,uGAQN,IAAI4a,EAAU,cACd,GAAIgtK,EAAa9gM,OAAQ,CACvB,MAAM6/L,EAAa,IAAI,IAAI3jL,IACzB4kL,EAAap6L,QAAO,CAACq6L,EAAgBxtK,IAAS,IAAIwtK,KAAmB72L,OAAOK,KAAKgpB,KAAQ,MACrFytK,EAAkBF,EAAanjM,KAAI,CAACmsB,EAAO5rB,IAAMuhM,EAAU31K,EAAM+X,OAAS3jC,EAAI,OAAMsM,QAAOvK,GAAa,OAAPA,IAEvG6zB,EACE,eAAC28C,GAAA,EAAD,CAAMG,WAAS,EAACr3D,WAAW,WAA3B,SACE,gBAACk3D,GAAA,EAAD,CAAMG,WAAS,EAACr3D,WAAW,WAA3B,UACE,eAACk3D,GAAA,EAAD,CAAMl9C,MAAI,EAACi9C,GAAI,EAAf,SACE,eAAC,GAAD,CAAmBivH,UAAWA,EAAWC,mBAAoBmB,MAE/D,eAACpwH,GAAA,EAAD,CAAMl9C,MAAI,EAACi9C,GAAI,EAAf,SACE,eAAC,GAAD,CACE9+D,UAAWV,EACXmuL,SAAUA,EACVS,kBAAmBgB,EACnBf,WAAYA,MAGhB,eAACpvH,GAAA,EAAD,CAAMG,WAAS,EAACt3D,QAAS,EAAzB,SACC0nL,EAAgB/+L,MAAM,EAAGw+L,GAAc9iM,KAAIO,GAC1C,eAACuyE,GAAA,EAAD,CAAMl9C,MAAI,EAACi9C,GAAI,GAAf,SAA2B,eAAC,GAAD,CAAkB58D,KAAMktL,EAAa5iM,GAAIihM,SAAUA,GAApCjhM,IAAlBA,OAE1B,eAACuyE,GAAA,EAAD,CAAMG,WAAS,EAACr3D,WAAW,SAASm3B,eAAe,SAAnD,SAC8B,IAA3BswJ,EAAgBhhM,OACb,eAACkZ,GAAA,EAAD,CAAYrH,MAAM,QAAlB,uDACAmvL,EAAgBhhM,OAASygM,EACvB,eAACvnL,GAAA,EAAD,4BAAwBunL,EAAxB,eAA2CO,EAAgBhhM,OAA3D,uBACA,eAACkZ,GAAA,EAAD,oBAAgB8nL,EAAgBhhM,OAAhC,yBAAuDiuB,GAAU,QAAS+yK,EAAgBhhM,QAA1F,cAER,eAACywE,GAAA,EAAD,CAAMG,WAAS,EAACr3D,WAAW,SAASm3B,eAAe,SAAnD,SACGswJ,EAAgBhhM,OAASygM,GACxB,eAAC3lL,GAAA,EAAD,CACEpJ,UAAWV,EAAQuuL,QAAS3kL,QAAQ,YAAY/I,MAAM,UACtDI,QAAS,IAAMyuL,EAAgBD,EAAe,IAFhD,6BAQX,CAED,OACE,eAACltF,GAAD,CAAMH,cAAY,EAAlB,SACGt/E,GAGN,CChQD,MAAMxZ,GAAYC,cAAWnI,IAAK,CAChCnC,MAAO,CACLm7B,UAAWh5B,EAAMkH,QAAQ,QAmDd2nL,OAhDcvxL,IAAMoI,MAAM7G,IACvC,MAAM,QAACiF,GAAWu7F,KACZzgG,EAAUsJ,MACV,IAACrG,GAAO0E,MACR,WAAC9I,GAAcmD,MAEdY,EAAMiyH,GAAW3tH,mBAAS,OAC1B+nL,EAAcC,GAAmBhoL,oBAAS,GAgBjD,GAdAE,qBAAU,KACRnE,EAAIQ,IAAJ,mBAAoByB,EAApB,0EACGT,MAAKhC,IACJoyH,EAAQpyH,EAASG,KAAjB,IAED+B,OAAM1F,IACc,iBAAfA,EAAMzM,KACR08L,GAAgB,GAEhBrwL,EAAWI,EACZ,GATL,GAWC,CAAC41H,EAASq6D,EAAiBjsL,EAAKpE,EAAYqG,IAE3C+pL,EACF,OACE,eAAC1sF,GAAD,UACE,eAACr6F,GAAA,EAAD,CAAYxH,UAAWV,EAAQf,MAA/B,0CAMN,GAAI2D,GAAI,OAAIA,QAAJ,IAAIA,KAAMupB,WAAd,OAA2BvpB,QAA3B,IAA2BA,KAAM2b,SAAU,CAC7C,MAAM2xK,EAAYttL,EAAK2b,SAASiP,YAAY,KACtC2iK,GAAiC,IAAfD,EAAmB,GAAKttL,EAAK2b,SAASjK,OAAO,EAAG47K,GAClEE,EAAmBxtL,EAAK2b,SAAStnB,MAAM,KAAK8Z,MAClD,OAAO,eAACwxF,GAAD,UACL,eAAC,GAAD,CACEyB,UAAWjjF,GAAgB9mB,EAAS2I,EAAKupB,UAAWgkK,GACpDlsF,UAAU,cACVC,gBAAiBksF,KAGtB,CACC,OAAO,eAAC7tF,GAAD,UAAM,eAACr6F,GAAA,EAAD,2BACd,I,sBC9CH,MAAMoB,GAAYC,cAAWnI,IAAK,CAChCivL,UAAW,CACTxvL,MAAOO,EAAMnE,QAAQgC,MAAM9C,MAE7Bm0L,UAAW,CACTC,cAAe,SACf30J,aAAc,QAIlB,SAAS40J,GAAT,GAAqC,IAAD,MAAjB,IAACrd,EAAD,SAAM1xI,GAAW,EAClC,MAAM,SAAC9a,GAAY85E,KACbxwE,EAAYpJ,KACZ1lB,EAASmI,KACTmnL,GAAkC,OAAR9pK,QAAQ,IAARA,GAAA,UAAAA,EAAU6sG,yBAAV,eAA6BxkI,QAAS,EAEtEoY,qBAAU,KACR6oB,EAAU3I,WAAWG,WAAkB,OAARd,QAAQ,IAARA,OAAA,EAAAA,EAAUspG,cAAe,UACxDhgG,EAAU3I,WAAWI,UAAiB,OAARf,QAAQ,IAARA,OAAA,EAAAA,EAAUzN,cAAV,OAAwByN,QAAxB,IAAwBA,OAAxB,EAAwBA,EAAUpI,WAAY,QAA5E,GACC,CAAC0R,EAAU3I,WAAX,OAAuBX,QAAvB,IAAuBA,OAAvB,EAAuBA,EAAUzN,WAAjC,OAA6CyN,QAA7C,IAA6CA,OAA7C,EAA6CA,EAAUpI,SAAvD,OAAiEoI,QAAjE,IAAiEA,OAAjE,EAAiEA,EAAUspG,cAc9E,OAAO,gBAAC2lD,GAAA,EAAD,CACHvrL,MAAO8oL,EACP1xI,SAAUA,EACVo0I,eAAe,UACf53C,UAAU,UACVr0H,QAAQ,YALL,UAOH,eAACqsK,GAAA,EAAD,CAAK/hL,MAAM,WAAW7J,MAAM,aAC5B,eAAC4rL,GAAA,EAAD,CAAK/hL,MAAM,QAAQ7J,MAAM,UACzB,eAAC4rL,GAAA,EAAD,CAAK/hL,MAAM,OAAO7J,MAAM,SACxB,eAAC4rL,GAAA,EAAD,CAAK/hL,MArBHu8L,EAEA,uBAAK/vL,UAAWS,EAAOkvL,UAAvB,UACE,eAAC,KAAD,CAAkB3vL,UAAWS,EAAOmvL,YADtC,UAMG,OAa6BjmM,MAAM,WAE7C,CAoEcqmM,OA9CGhyL,IAAMoI,MAAK,KAAO,IAAD,EACjC,MAAM64C,EAAUW,cACVqwI,EAAchxI,EAAQrnD,SAASuQ,UAC/B,KAACvF,EAAD,IAAOnL,GAAO8pE,cACdhiD,EAAQg6C,YAAU02H,EAAa,CAAErtL,KAAK,GAAD,OAAKA,EAAL,aACpCI,QAAQ,IAACyvK,EAAM,aAAelzJ,EAC/B/a,EAAO,OAAG+a,QAAH,IAAGA,GAAH,UAAGA,EAAOvc,cAAV,aAAG,EAAewB,QACzB0rL,EAActpL,mBAAQ,KAC1B,MAAMupL,EAAaC,kBAAQ34L,EAAK,KAChC,MAAO,CACL,SAAW,GAAX,OAAe04L,EAAf,aACA,MAAQ,GAAR,OAAYA,EAAZ,oBACA,KAAO,GAAP,OAAWA,EAAX,SACA,KAAO,GAAP,OAAWA,EAAX,SAJF,GAMC,CAAC14L,IAKE44L,EAAO/pK,iBAAO4pK,GAcpB,OANAtpL,mBAAQ,KACFpC,IACF6rL,EAAK75K,QAAU05K,EAChB,GACA,CAAC1rL,EAAS0rL,EAAaG,IAEnB,gBAACnwF,GAAD,CAAc17F,QAASA,EAAvB,UACL,eAACsrL,GAAD,CAAWrd,IAAKA,EAAK1xI,SAbF,CAACqlB,EAAGz8D,KACvB0mM,EAAK75K,QAAQi8J,GAAOwd,EACpBhxI,EAAQrxD,KAAKyiM,EAAK75K,QAAQ7sB,GAA1B,IAYA,gBAAC,eAAD,WACE,eAAC,cAAD,CAAYiZ,KAAI,UAAKA,GAAQ0tL,OAAK,EAAClxL,OAAQ,IAAM,eAAC,GAAD,MACjD,eAAC,cAAD,CAAYmxL,KAAK,SAAS3tL,KAAI,UAAKA,EAAL,UAAmBxD,OAAQ,IAAM,eAAC,GAAD,MAC/D,eAAC,cAAD,CAAYmxL,KAAK,OAAO3tL,KAAI,UAAKA,EAAL,SAAkBxD,OAAQ,IAAM,eAACguL,GAAD,MAC5D,eAAC,cAAD,CAAYxqL,KAAI,UAAKA,EAAL,SAAkBxD,OAAQ,IAAM,eAACkvL,GAAD,MAChD,eAAC,IAAD,CAAUkC,QAAM,EAACxhI,KAAI,UAAKpsD,EAAL,aAAsBmR,GAAE,UAAKnR,UAPtD,IC3Ga,SAAS6tL,GAAT,GAAsC,OAATlxL,GAAQ,EAClD,MAAM,IAACgD,GAAO0E,KACR/I,EAASoD,KACT29C,EAAUW,cACVhoD,EAAW+nD,eACV+wI,EAASC,GAAcnqL,oBAAS,GAavC,OAAO,eAAC4C,GAAA,EAAD,CAAQF,QAAQ,YAAY3I,QAZf,KAClBowL,GAAW,GACXpuL,EAAIgC,KAAK,YACNR,MAAMwa,IACL0gC,EAAQrxD,KAAKg6H,GAAO,aAAD,OAAcrpG,EAAOkN,WAAa7zB,GAArD,IAEDqM,OAAO1F,IACNoyL,GAAW,GACXzyL,EAAOC,WAAWI,EAAlB,GANJ,EAUuDu0C,SAAU49I,KAAanxL,EAAzE,gCAGR,CCpBD,MAAMqxL,GAAsB5yL,IAAMoI,MAAK,SAA6B7G,GAClE,MAAM,SAAEkyD,KAAao/H,GAAgBtxL,EAE/BuxL,EAAuBlqL,mBAAQ,KAAQ,OAAFlN,QAAE,IAAFA,OAAA,EAAAA,EAAIwB,iBAAkB,CAAC,GAAG,IAC/D61L,EAAiB5jL,uBAAY5U,GACjC,CAACA,IAAQu4L,EAAqBl4L,SAAWk4L,EAAqBl4L,QAAQvJ,SAASkJ,KAA/E,CACCA,IAAQu4L,EAAqB/3L,UAAY+3L,EAAqB/3L,QAAQ1J,SAASkJ,KAC/E,CAACu4L,IAEEE,EAAiB7jL,uBAAYhS,GAC1B3C,OAAOK,KAAKsC,GAChBrC,OAAOi4L,GACP9kM,KAAIsM,IACH,MAAM04L,EAAgB91L,EAAS5C,GAC/B,OACE,gBAAC+O,GAAA,EAAD,CAAejG,QAAQ,OAAO09B,cAAc,MAAM/E,aAAc,EAAGnyB,WAAW,WAA9E,UACE,gBAACP,GAAA,EAAD,CAAKQ,YAAa,EAAG27B,SAAU,EAA/B,UACE,eAACj8B,GAAA,EAAD,CAAY0B,QAAQ,KAApB,SAA0B+nL,EAAch0J,QACxC,eAAC,GAAD,oBAAcg0J,EAAchvL,kBAE9B,eAACmH,GAAA,EAAD,CACEF,QAAQ,YAAY/I,MAAM,UAAUG,KAAK,QACzCC,QAAS,IAAMkxD,EAASw/H,GAF1B,mBALQ14L,EADZ,KAeH,CAACw4L,EAAgBt/H,IAEpB,OACE,gBAAC70B,GAAA,EAAD,IAAYi0J,EAAZ,UACE,eAACh0J,GAAA,EAAD,CAAazhC,GAAG,oBAAhB,oCACA,eAAC0hC,GAAA,EAAD,UACE,eAACx1B,GAAA,EAAD,CAAKqvF,UAAW,IAAhB,SACGn+F,OAAOK,KAAKqC,GAAgBjP,KAAIilM,GAC/B,gBAAC5pL,GAAA,EAAD,CAAuB0yB,aAAc,EAArC,UACE,eAACxyB,GAAA,EAAD,CAAY0B,QAAQ,KAApB,SAA0BgoL,IAC1B,eAAC5pL,GAAA,EAAD,CAAKoyB,UAAW,EAAhB,SAAoBs3J,EAAe91L,EAAeg2L,QAF1CA,SAOhB,eAACn0J,GAAA,EAAD,UACE,eAAC3zB,GAAA,EAAD,CAAQ7I,QAASswL,EAAY1xL,QAA7B,wBAIP,IAOc,SAASgyL,GAAoB5xL,GAC1C,MAAM,IAACgD,GAAO0E,MACR,WAAC9I,GAAcmD,KACf29C,EAAUW,eAETwxI,EAAQ30J,GAAWj2B,oBAAS,GAmBnC,OACE,iCACE,eAAC4C,GAAA,EAAD,CAAQF,QAAQ,YAAY3I,QAnBR,KACtBk8B,GAAQ,EAAR,EAkBE,iCAGA,eAAC,GAAD,CACE58B,KAAMuxL,EACNjyL,QApBc,IAAMs9B,GAAQ,GAqB5Bg1B,SAnBgBw/H,IACpB1uL,EAAIgC,KAAJ,8BAAgC0sL,EAAcI,WAA9C,wBAAwEJ,EAAch0J,QACnFl5B,MAAM7B,IACL+8C,EAAQrxD,KAAR,kCAAwCsU,EAAKupB,WAA7C,IAEDxnB,MAAM9F,GACNyzC,SAAQ,KACPnV,GAAQ,EAAR,GANJ,MAsBH,CCsBc60J,OAtGatzL,IAAMoI,MAAK,IAQhC,IARiC,QACtCrJ,EADsC,SAEtC+1C,EAFsC,YAGtCoiD,EAHsC,KAItCv5F,EAJsC,QAKtCg2H,EALsC,UAMtC4/D,EACA,cAAen+I,GACX,EACJ,MAAOo+I,EAAYC,GAAiBjrL,oBAAS,IACvC,IAACjE,GAAO0E,MACR,WAAC9I,GAAcmD,MACdkpL,EAAiBY,GAAsB5kL,mBAAS,KAChDikL,EAAeY,GAAoB7kL,mBAAS,KAC7C,UAACkrL,EAAD,SAAYC,EAAZ,OAAsB3qJ,EAAtB,WAA8B4qJ,EAA9B,SAA0CC,GAAYjrL,mBAAQ,KAClE,MAAM+qL,GAAkB,OAAPhgE,QAAO,IAAPA,OAAA,EAAAA,EAASrjI,SAAU,EAC9BsjM,EAAar1K,GAAU,SAAUo1K,GAAU,GAC3CE,EAAWt1K,GAAU,MAAOo1K,GAAU,GAC5C,MAAO,CACLD,WAAkB,OAAP//D,QAAO,IAAPA,OAAA,EAAAA,EAAS1lI,KAAIsyB,GAAUA,EAAOkN,cAAc,GACvDkmK,WACA3qJ,OAAM,OAAE2qF,QAAF,IAAEA,OAAF,EAAEA,EAASzgI,MAAKknB,IAAK,eAAS,OAALA,QAAK,IAALA,GAAA,UAAAA,EAAO0uB,iBAAP,eAAkBx4C,QAAS,IAAU,OAAL8pB,QAAK,IAALA,GAAA,UAAAA,EAAO2uB,iBAAP,eAAkBz4C,QAAS,CAA/D,IAC3BsjM,aACAC,WALF,GAOC,CAAClgE,IAIJjrH,qBAAU,KACH8qL,GAELjvL,EAAIgC,KAAJ,gBACE,CACE2sB,MAAO,UACPruB,MAAO,CAAC2yJ,iBAAkB,CAAC,uBAAwBk8B,MAGpD3tL,MAAKoB,IACJ,MAAMjD,GAAc,OAAPiD,QAAO,IAAPA,OAAA,EAAAA,EAASjD,OAAQ,GAC9B,GAAIA,EAAK5T,OAAS,EAAG,CACnB,MAAMm8L,EAAgBvoL,EAAKpJ,QAAOsf,IAAUs5K,EAAUriM,SAAS+oB,EAAMqT,aACrE4/J,EAAiBZ,GACjB,MAAMa,EAAgBppL,EAAKjW,KAAImsB,GAASA,EAAMo9I,mBAAkBnoC,OAC1D90F,EAAa,IAAI,IAAIyyF,IAAIsgE,EAAcr/L,KAAImsB,GAAS,CAACA,EAAMu9I,gBAAiBv9I,MAASte,UAC3FsxL,EAAmB7yJ,EACpB,KAEFt0B,MAAM9F,EAhBT,GAiBC,CAACoE,EAAKivL,EAAYrzL,EAAYuzL,IAEjC,MAAMvyJ,EAAchyB,uBAAY,KAC9BskL,GAAc,EAAd,GACC,IAEGlG,EAAep+K,uBAAY,KAC/BskL,GAAc,GACdF,GAAaA,GAAb,GACC,CAACA,IAEJ,OACE,gBAAC,IAAMlqL,SAAP,WACE,eAAChH,GAAA,EAAD,IACM60F,EACJpiD,SAAUA,EACVvyC,QAAS4+B,EACTj/B,MAAOvE,EAAO,CAACwE,MAAO,SAAW,KACjC,cAAaizC,EALf,SAOE,eAAClW,GAAA,EAAD,CAASD,MAAOlgC,GAAO,0BAAuB60L,GAA9C,SACE,eAAC,KAAD,QAGJ,gBAACh1J,GAAA,EAAD,CAAQ/8B,KAAM2xL,EAAd,UACE,gBAAC10J,GAAA,EAAD,WACE,eAACwqE,GAAA,EAAD,UACE,mEAAmCsqF,OAErC,gBAACtqF,GAAA,EAAD,WACGqqF,EAAW,EAAX,4BAAoCA,EAApC,YAAgDC,EAAhD,MAAiE,GACjE5qJ,EAAM,cAAU4qJ,EAAV,oCAAgDC,EAAhD,yDAAkH,GAF3H,uDAGmDD,EAHnD,QAKA,eAAC,GAAD,CAAyBpH,gBAAiBA,EAAiBC,cAAeA,OAE5E,gBAAC1tJ,GAAA,EAAD,WACE,eAAC3zB,GAAA,EAAD,CAAQ7I,QAAS,IAAMkxL,GAAc,GAAQlqF,WAAS,EAAtD,oBACA,eAACn+F,GAAA,EAAD,CAAQ7I,QAAS,IAAMgrL,IAAvB,SAAwCd,EAAcn8L,OAAS,EAAI,gBAAkB,mBA3B7F,I,uFChCawjM,OA5CI9zL,IAAMoI,MAAK,SAAoB7G,GAChD,MAAM,MAAC09B,EAAD,KAAQ3sC,EAAR,UAAcyhM,EAAd,SAAyB1yL,KAAawxL,GAAetxL,GACpDM,EAAM48B,GAAWj2B,oBAAS,GAE3B24B,EAAchyB,uBAAY,KAC9BsvB,GAAQ,EAAR,GACC,CAACA,IAEE38B,EAAcqN,uBAAY,KAC9BsvB,GAAQ,EAAR,GACC,CAACA,IAEJ,OACE,gBAAC,IAAMp1B,SAAP,WACE,gBAACu1B,GAAA,EAAD,CAAQ/8B,KAAMA,EAAMV,QAASW,KAAiB+wL,EAA9C,UACE,eAACh0J,GAAA,EAAD,UAAcI,IACd,eAACH,GAAA,EAAD,UACGz9B,IAEH,eAAC09B,GAAA,EAAD,UACE,eAAC3zB,GAAA,EAAD,CAAQjJ,MAAM,UAAUI,QAAST,EAAjC,wBAGJ,eAACqJ,GAAA,EAAD,CAAM5I,QAAS4+B,EAAalnC,KAAK,OAAQ85L,EAAzC,SACGzhM,MAIR,IC1BD,MAAMsY,GAAYC,cAAWnI,IAAK,CAChCvD,KAAM,CACJkE,QAAS,OACT09B,cAAe,MACfl3B,WAAY,SACZ,QAAS,CACPC,YAAapH,EAAMkH,QAAQ,SAKlB,SAASoqL,GAAT,GAAqF,IAAjE,SAAC3yL,EAAD,OAAW2J,EAAX,KAAmBmuC,EAAnB,QAAyBp6C,EAAzB,QAAkCwD,EAAlC,UAA2C0xL,KAAc9yK,GAAO,EACjG,MAAM7f,EAAUsJ,KA6BhB,OA3BKuuC,GAAQ86I,IACX96I,EAAO,eAAC,KAAD,CAAej3C,MAAO,CAACjD,SAAU,MACxCkiB,EAAK7e,KAAO6e,EAAK7e,MAAQ,SAGtB0I,IACHA,EAAS,eAAC3I,GAAA,EAAD,CAAYE,QAASA,KAAa4e,EAAlC,SACNg4B,KAIDp6C,IACFiM,EAAS,eAACk0B,GAAA,EAAD,CAASD,MAAOlgC,EAAhB,SACNiM,KAIDipL,IACFjpL,EAAS,eAAC,KAAD,CACP1Y,KAAM2hM,EAAW9rH,OAAQ,IAAM,KADxB,SAGP,sBAAK5lE,QAASuB,GAAKA,EAAE+gC,kBAArB,SACG75B,OAKA,uBAAKhJ,UAAWV,EAAQnC,KAAxB,UACL,+BAAMkC,IACL2J,IAEJ,CCpDD,MAAMJ,GAAYC,cAAWnI,IAAK,CAChC09G,OAAQ,CACNzjF,MAAO,OACP6X,SAAU,KAEZ0/I,UAAW,CACTl4J,aAAct5B,EAAMkH,QAAQ,GAC5B+yB,MAAO,QAETw3J,YAAa,CACXn4J,aAAct5B,EAAMkH,QAAQ,GAC5B+yB,MAAO,QAETy3J,WAAY,CACV14J,UAAW,EACXr4B,QAAS,YAIb,SAASgxL,GAA4B/9H,EAAc/zD,GACjD,MAAMlB,EAAWrB,IAAMu4D,SAASC,QAAQlC,EAAa/0D,MAAMF,UAM3D,OALAA,EAASzR,KAAK,eAACyS,GAAA,EAAD,CAAiCC,KAAM,QAASC,QAASA,EAAzD,SACZ,eAAC28B,GAAA,EAAD,CAASD,MAAM,uBAAf,SACE,eAAC,KAAD,OAF2B,iBAKxBj/B,IAAM05D,aAAapD,EAAc,CAAC,EAAGj1D,EAC7C,CAqTcizL,OAnTKt0L,IAAMoI,MAAM7G,IAC9B,MAAMD,EAAUsJ,MACV,cAACiW,EAAD,SAAgBjB,EAAhB,aAA0BoK,GAAgBw/F,MAC1C,IAACjlH,GAAO0E,MACR,WAAC9I,GAAcmD,KACfsvB,EAAiBW,MAChBghK,EAAkBC,GAAuBhsL,mBAAS,KAClDisL,EAAiBC,GAAsBlsL,mBAAS,OAChDmsL,EAAgBC,GAAqBpsL,mBAAS,OAC9C1U,EAAM+gM,GAAWrsL,mBAAS,KAC1B3G,EAAM48B,GAAWj2B,oBAAS,GAC3By4C,EAAUW,cACVhoD,EAAW+nD,eACVmzI,EAA8BC,GAAmCvsL,oBAAS,IAC1EwsL,EAAuBC,GAA4BzsL,oBAAS,IAC5D0sL,EAAYC,GAAiB3sL,mBAAS,aACtCjI,EAAO2zC,GAAY1rC,qBAE1BE,qBAAU,KAGR,IAAKkqB,EACH,OAIF,GAAI5I,EACF,OA8CmByB,UA3CqB,EAACzD,EAAavgB,EAAQ+Y,EAAS40K,KACvE,MAAMC,EAAYrtK,EAAYltB,QAAOwb,IAAe,IAAD,EACjD,OAAIA,EAAWiN,QAAUmQ,KAGzB,UAAOpd,EAAWogB,wBAAlB,aAAO,EAA6BhJ,MAAKsJ,GAAoC,cAArBA,EAAYljC,OAApE,IACC7F,KAAIqoB,IAAe,IAAD,UACnB,MAAM9gB,EAAQ8gB,EAAW9gB,OAAS8gB,EAAWxiB,KACvCu6G,GAAW,UAAA/3F,EAAW4Q,qBAAX,mBAA0BmnF,gBAA1B,eAAqC,KAAM,CAAC,EACvDinF,EAAeh/K,GACnBA,EAAWkgB,WAAW9I,MAAKvwB,GACzBA,EAASq5B,WAAW9I,MAAKvwB,GAAwC,2CAA5BA,EAAS+zB,mBAGlD,IAAI/zB,EACJ,IAAK,MAAMo4L,IAAkB,CAACj/K,KAAeA,EAAWogB,kBAEtD,GADAv5B,EAAWm4L,EAAaC,GACpBp4L,EACF,MAGJ,MAAO,CACLC,GAAG,GAAD,OAAKqK,EAAL,YAAe6O,EAAW4a,gBAC5BskK,eAAuB,QAAR,EAAAr4L,SAAA,eAAU3H,SAAV,UAAmB2H,SAAnB,aAAmB,EAAUrJ,OAAQ,QACpDwmK,cAAsB,QAAR,EAAAn9J,SAAA,eAAUrJ,OAAQ,QAChCwiB,aACA9gB,QACAgrB,QAAS,CACPtc,KAAM,CACJqf,MAAO6xK,EAAa9+K,MACjB+3F,IATT,IAcIonF,EAAgBJ,EAAUpnM,KAAIogH,GAAYA,EAASisD,eACnDo7B,EAAgB,CAAC,mBAAoB,qBAAsB,yBAA0B,qBAAsB,uBAAwB,SAIzI,OAHAD,EAAczxK,MAAK,CAACvzB,EAAG2oB,IAAMs8K,EAAcz0L,QAAQxQ,GAAKilM,EAAcz0L,QAAQmY,KAC9Ei8K,EAAUrxK,MAAK,CAACvzB,EAAG2oB,IAAM3oB,EAAE+E,MAAMugC,cAAc3c,EAAE5jB,SACjD6/L,EAAUrxK,MAAK,CAACvzB,EAAG2oB,IAAMq8K,EAAcx0L,QAAQxQ,EAAE6pK,cAAgBm7B,EAAcx0L,QAAQmY,EAAEkhJ,gBAClF+6B,CAAP,EAKwBM,OADQ/iK,EAAekC,UAE1B,aAAc,GAAMiG,GAAWA,EAAQ7J,iBACrCjjC,KAAIogH,IAAQ,CAAMzkE,MAAO,WAAYykE,MAG9DunF,GAAe7vL,MAAKsvL,IAClBb,EAAoBa,GACpBX,EAAmBW,EAAU,GAA7B,IACCpvL,MAAM9F,EAHT,GAIC,CAACoE,EAAKpE,EAAYq0L,EAAqB5hK,EAAgB5I,EAAcnJ,EAAejB,IAEvF,MAAMo4G,EAAY7oH,uBAAY,KAC5B,MAAM0mL,EAAkC,aAAfX,EAA4BT,EAAkBE,EACvEpwL,EAAIwC,IAAJ,kBAAmB6Y,EAAnB,2BAA8C9rB,EAA9C,oEAAsH+hM,EAAiBr1K,SACpIza,MAAKhC,IAEJ,MAAMyC,EAAUzC,EAASqwH,WAAWhhG,SACpC6tB,EAAQrxD,KAAKg6H,GAAO,YAAD,OAAapjH,EAAb,cAAkC5M,IACrDq7L,GAAyB,EAAzB,IAEDhvL,OAAM1F,IAAU,IAAD,EACd,UAAIA,EAAMM,kBAAV,OAAI,EAAkBF,WAAW,oCAC/Bo0L,GAAgC,GAEhC50L,EAAWI,EACZ,GAZL,GAcC,CAACw0L,EAAiCxwL,EAAKpE,EAAY+0L,EAAYT,EAAiBE,EAAgB7gM,EAAM8rB,EAAUqhC,EAASrnD,IAEtHk8L,EAAsB3mL,uBAAY,CAACwxB,EAAOh1C,KAC9C+oM,EAAmB/oM,EAAnB,GACC,IAEGoqM,EAA4B5mL,uBAAY,CAAC6mL,EAAavuL,EAAQ+Y,EAAS40K,KAAkB,IAAD,QAC5F,IAAI5/L,EAAQwgM,EAAYliM,KACxB,MAAM0mB,EAAU,OAAGgG,QAAH,IAAGA,GAAH,UAAGA,EAASyH,gBAAZ,aAAG,EAAmBzN,WAChCqF,EAAQ,OAAGW,QAAH,IAAGA,GAAH,UAAGA,EAASyH,gBAAZ,aAAG,EAAmBpI,SAEpC,GAAIrF,EACFhlB,EAAK,UAAMA,EAAN,aAAgBglB,EAAhB,UACA,GAAIqF,EAAU,CACnB,MAAMo2K,EAAYp2K,EAAShN,UAAUgN,EAASiP,YAAY,KAAO,GACjEt5B,EAAK,UAAMA,EAAN,aAAgBygM,EAAhB,IACN,KAAqB,eAAXxuL,IACTjS,EAAK,UAAMA,EAAN,aAEP,MAAM64G,GAAW,UAAA2nF,EAAY9uK,qBAAZ,mBAA2BmnF,gBAA3B,eAAsC,KAAM,CAAC,EAC9D,MAAO,CACLjxG,GAAG,GAAD,OAAKqK,EAAL,YAAeuuL,EAAY9kK,gBAC7B17B,MAAOA,EACP49B,SAAU3rB,EACV9b,MAAOqqM,EAAYliM,KACnB0sB,QAAS,CACPtc,KAAM,CACJqf,MAAO6xK,EAAaY,MACjB3nF,IART,GAYC,IAEG6nF,EAAqB/mL,uBAAaxjB,IACtC,MAAMuY,EAAI,OAAGvY,QAAH,IAAGA,OAAH,EAAGA,EAAOuY,KACpB,IAAKA,EAEH,YADA0wL,EAAkB,MAGpB,MAAMD,EAAiBoB,EAA0B7xL,EAAK8sB,WAAY9sB,EAAKsc,QAAQyH,SAASmL,SAAUlvB,EAAKsc,SACrGua,GACS1K,GAAqB0K,EAAS,CAACla,gBAAejB,aAAW,KAEpEg1K,EAAkBD,EAAlB,GACC,CAAC9zK,EAAek1K,EAA2Bn2K,IAExCglB,EAAez1B,uBAAaxjB,IAChC,MAAMuY,EAAI,OAAGvY,QAAH,IAAGA,OAAH,EAAGA,EAAOuY,KACpB,IAAKA,EAEH,YADA0wL,EAAkB,MAGpB,MAAMD,EAAiBoB,EAA0B7xL,EAAK8sB,WAAY9sB,EAAKsc,QAAQyH,SAASmL,SAAUlvB,EAAKsc,SACnGua,GACS1K,GAAqB0K,EAAS,CAACla,gBAAejB,aAAW,KAEtEg1K,EAAkBD,GAClBl2J,GAAQ,EAAR,GACC,CAACs3J,EAA2Bl1K,EAAejB,IAExCusC,EAAgBvjD,mBAAQ,MAAQ,yCAA0C,CAAC,yCAAyC,IAMpH81D,EAAcvvD,uBAAa5O,IAC/B2zC,EAAS3zC,EAAT,GACC,IAEH,OAAO,gBAAC,IAAM8I,SAAP,WACL,eAAC+B,GAAA,EAAD,CACE7I,QAAS,IAAM0yL,GAAyB,GACxCngJ,SAAU9qB,KACNzoB,IAEN,gBAACq9B,GAAA,EAAD,CACEt9B,QAAS,CAACg8B,MAAOh8B,EAAQ8+G,QACzBv+G,KAAMmzL,EACN7zL,QAAS,IAAM8zL,GAAyB,GACxC,cAAY,sBAJd,UAME,eAACp2J,GAAA,EAAD,2CACA,gBAACC,GAAA,EAAD,WACE,eAACwqE,GAAA,EAAD,gCAGA,eAACv2C,GAAA,EAAD,CACE/wD,UAAWV,EAAQ4yL,UACnBhpL,QAAQ,SACR1V,MAAM,OACN7J,MAAOmI,EACPivC,SAAUpC,GAASk0J,EAAQl0J,EAAMlnB,OAAO9tB,MAAM2P,QAAQ,KAAM,QAC9D,eAACguG,GAAA,EAAD,8BAGA,eAAC1vD,GAAA,EAAD,CAAa72B,UAAU,WAAW/gB,UAAWV,EAAQ8yL,WAArD,SACE,gBAACz3I,GAAA,EAAD,CACEvrD,KAAG,EACH,aAAW,WACX0C,KAAK,WACLnI,MAAOupM,EACPnyJ,SAxCepC,IACvBw0J,EAAcx0J,EAAMlnB,OAAO9tB,MAA3B,EAwCQqW,UAAWV,EAAQ8yL,WANrB,UAQE,eAACn+I,GAAA,EAAD,CACEtqD,MAAM,WACNuqD,QAAS,eAAC0G,GAAA,EAAD,CAAOz6C,MAAM,YACtB3M,MAAM,kBACN4iH,eAAe,QAEjB,eAACniE,GAAA,EAAD,CACEtqD,MAAM,SACNuqD,QAAS,eAAC0G,GAAA,EAAD,CAAOz6C,MAAM,UAAU,cAAY,wBAC5C3M,MAAM,gBACN4iH,eAAe,aAIL,aAAf88E,GAA6B,eAACz/H,GAAA,EAAD,CAC5BzzD,UAAWV,EAAQ6yL,YACnBr/I,UAAWy/I,EACX5oM,MAAO4oM,GAAgB,OAAIA,QAAJ,IAAIA,KAAkB7mK,MAAK2gF,GAAYA,EAASjxG,MAAT,OAAgBq3L,QAAhB,IAAgBA,OAAhB,EAAgBA,EAAiBr3L,MAAMq3L,EAAkB,KACvH1xJ,SAAU+yJ,EACVn7L,QAAS45L,GAAoB,GAC7BzgI,QAAS74D,GAAUA,EAAOu6L,cAC1B3hI,eAAgB54D,GAAUA,EAAOzF,MACjC0gE,YAAclxD,GAER,eAAC+tD,GAAA,EAAD,IACM/tD,EACJxP,MAAM,kBACN0V,QAAQ,SACR,cAAY,4BAKN,WAAfgqL,GAA2B,eAAC5rL,GAAA,EAAD,UAC1B,eAAC,GAAD,CACIqoH,eAAgBukE,EAChBvqM,MAAOgpM,EACPxoI,cAAeA,EACf3rD,QAASk+D,EACTxI,YAAclxD,GAER,eAAC+tD,GAAA,EAAD,IACQ/tD,EACJkG,QAAQ,SACR3K,QAASA,EACT41D,WAAY51D,EACZ/K,MAAM,gBACNq0C,YAAa,oCACb0qB,WAAY,IACPvvD,EAAOuvD,WACV+B,aAAc+9H,GACVrvL,EAAOuvD,WAAW+B,cAClB,IAAM73B,GAAQ,MAGpB,cAAY,6BAM5B,eAAC6qE,GAAA,EAAD,UACGx1G,EAAI,qBAAiBA,EAAjB,iBAAuC,KAE9C,eAAC,GAAD,CACE+N,KAAMA,EACN0+G,SAAU,IAAM9hF,GAAQ,GACxByD,kBAAmB0C,EACnB/0B,SAAU8kL,GAAkB,CAACvhK,SAAQ,OAAEuhK,QAAF,IAAEA,OAAF,EAAEA,EAAgBvhK,SAAUznC,MAAK,OAAEgpM,QAAF,IAAEA,OAAF,EAAEA,EAAgBhpM,OACxFwgE,cAAeA,OAGnB,gBAACptB,GAAA,EAAD,WACE,uBAAM78B,MAAO,CAACujC,SAAU,KACxB,eAACr6B,GAAA,EAAD,CAAQ7I,QAAS,IAAM0yL,GAAyB,GAAQ9yL,MAAM,YAA9D,oBAGA,eAACiJ,GAAA,EAAD,CAAQ0pC,UAAWhhD,GAAiB,KAATA,KAAgC,aAAfohM,EAA4BT,EAAkBE,GAAiBpyL,QAASy1H,EAAW71H,MAAM,YAArI,0BAKJ,gBAACy8B,GAAA,EAAD,CACE/8B,KAAMizL,EACN3zL,QAAS,IAAM4zL,GAAgC,GAFjD,UAIE,eAACl2J,GAAA,EAAD,mCACA,eAACC,GAAA,EAAD,UACE,eAACwqE,GAAA,EAAD,mGAIF,eAACvqE,GAAA,EAAD,UACE,eAAC3zB,GAAA,EAAD,CAAQ7I,QAAS,IAAMwyL,GAAgC,GAAQxrF,WAAS,EAAxE,uBAhIN,I,qBCnLF,SAAS4sF,GAAa50L,GACpB,MAAM,MAAC5V,EAAD,SAAQo3C,GAAYxhC,EAE1B,OAAO,gBAAC+H,GAAA,EAAD,CAAKjG,QAAS,QAAd,UACL,eAACiG,GAAA,EAAD,CAAK0yB,aAAc,EAAGN,UAAW,EAAjC,SACE,eAAClyB,GAAA,EAAD,CAAY0B,QAAQ,YAApB,wBAIF,eAAC6nD,GAAA,EAAD,CACE8C,WAAS,EAACrgE,MAAM,UAAUmpE,WAAS,EACnCV,QAAS,EAAG/L,aAAcvmE,EAAOuf,QAAQ,SAAS5I,KAAK,QACvDygC,SAAWpC,GAAUoC,EAASpC,EAAMlnB,OAAO9tB,OAC3CwsI,WAAY,CAAE,cAAe,8BAGlC,CAMD,SAASi+D,GAAe70L,GACtB,MAAM,OAACzF,EAAD,MAASu6L,EAAT,SAAgBC,GAAY/0L,GAC3Bg1L,EAAcC,GAAmBhuL,mBAAS,KAC1CiuL,EAAeC,GAAoBluL,mBAAS,IAE7C00G,EAAc/tG,uBAAaxjB,IAC/B,IACc,IAAIqO,IAAIrO,EAIrB,CAFC,MAAOy8D,GACP,MAAO,6BACR,IACA,IAEG8sF,EAAatsI,mBAAQ,KACzB,GAAqB,KAAjB2tL,EACJ,cAAIz6L,QAAJ,IAAIA,KAAQzK,SAASklM,GAAsB,4CAA3C,CACA,GACC,CAACz6L,EAAQy6L,IAEN72J,EAAU92B,mBAAQ,IACf,CACL,CAACrO,IAAK,MACJ0lC,MAAO,OACP7+B,OAAQo5B,GACC,eAAClxB,GAAA,EAAD,CAAKi0B,SAAS,QAAQJ,WAAW,SAASmgB,aAAa,WAAWzhB,SAAS,SAA3E,SACL,eAAC,GAAD,CAAU9zB,SAAS,OAAOwhE,SAAO,EAAC5qB,QAAM,EAACz6C,KAAM,CAACA,KAAMs2B,EAAU/gC,KAAM+vE,eAAa,SAK1F,IAEGmtH,EAAwBxnL,uBAAawxB,IACzC+1J,OAAiB7kM,GACjB2kM,EAAgB71J,EAAMlnB,OAAO9tB,MAA7B,GACC,IAEGqsI,EAAY7oH,uBAAY,KAC5B,MAAMynL,EAAmB15E,EAAYq5E,GACrCG,EAAiBE,GACbA,IACJP,EAAME,GACNC,EAAgB,IAAhB,GACC,CAACD,EAAcF,EAAOn5E,IAEnB25E,EAAWjuL,mBAAQ,kBAAM9M,IAAM,UAAIA,EAAO4xB,MAAK/hC,KAAU,OAAEA,QAAF,IAAEA,MAAOmrM,0BAAnC,aAAI,EAAkDA,gBAAlE,GAAmF,CAACh7L,IAE7G,OAAO,gBAACwN,GAAA,EAAD,CAAKjG,QAAS,QAAd,UACL,eAACiG,GAAA,EAAD,CAAK0yB,aAAc,EAAGN,UAAW,EAAjC,SACE,eAAClyB,GAAA,EAAD,CAAY0B,QAAQ,YAApB,0BAIF,eAAC6nD,GAAA,EAAD,CACE7wD,MAAO,CAACy6B,MAAO,QAASnnC,MAAM,gBAAgButC,SAAU4zJ,EACxDp2L,SAAU20I,IAAcuhD,GAAgBtgI,WAAY++E,GAAcuhD,EAAevrL,QAAQ,SAAS5I,KAAK,QAAQ3W,MAAO4qM,EACtHp+D,WAAY,CAAE,cAAe,yBAE/B,eAAC7uH,GAAA,EAAD,CAAKjG,QAAQ,OAAO29B,eAAe,QAAQyiE,QAAS,EAApD,SACE,eAACr4F,GAAA,EAAD,CAAQF,QAAQ,YAAY/I,MAAM,UAAUI,QAASy1H,EAAWljF,YAAaogG,GAA+B,KAAjBqhD,GAAsB,cAAY,uBAA7H,mBAID72J,GAAW5jC,EAAOxL,OAAS,GAAK,gBAAC,IAAM+Y,SAAP,WAC9BwtL,GAAY,eAACrtL,GAAA,EAAD,CAAYrH,MAAM,QAAQ6iC,KAAK,sBAA/B,SACV6xJ,IAEH,eAACzxF,GAAA,EAAD,IACA,eAAC,GAAD,CAAW1lE,QAASA,EAASx7B,KAAMpI,EAAOhB,QAAOnP,KAAS,OAAEA,QAAF,IAAEA,KAAOmrM,mBAAkB7oM,KAAItC,GAAS6O,OAAO,CAACf,IAAK9N,EAAO2qM,SAAUA,MAAhI,SACE,eAAC,GAAD,CAAgBv0J,QAASg1J,GAAmBpxJ,UAAQ,WAI3D,CAOD,MAAMoxJ,GAAoB/2L,IAAMoI,MAAM7G,IACpC,MAAM,KAAC2C,GAAQ3C,EAMf,OAAO,gBAAC+H,GAAA,EAAD,CAAKjG,QAAS,eAAd,UACL,eAAChB,GAAA,EAAD,CAAYC,KAAK,QAAQC,QALJ,KACrB5I,OAAOkI,KAAKqC,EAAKzK,IAAK,SAAtB,EAIA,SACE,eAACylC,GAAA,EAAD,CAASD,MAAM,kBAAf,SACE,eAAC,KAAD,QAGJ,eAAC58B,GAAA,EAAD,CAAYC,KAAK,QAAQC,QAAS,IAAM2B,EAAKoyL,SAASpyL,EAAKzK,KAAM,cAAY,0BAA7E,SACE,eAACylC,GAAA,EAAD,CAASD,MAAM,uBAAf,SACE,eAAC,KAAD,UARN,IAiBF,SAAS+3J,GAAaz1L,GACpB,MAAM,OAACzF,EAAD,aAASm7L,EAAT,SAAuBC,EAAvB,MAAiCb,EAAjC,SAAwCC,GAAY/0L,GACnD41L,EAAYC,GAAiB5uL,mBAAS,KACtC6uL,EAAcC,GAAmB9uL,mBAAS,IAE3Ck3B,EAAU92B,mBAAQ,IAAO,CAC7B,CAACrO,IAAK,UAAW0lC,MAAO,OAAQ7+B,OAAQhQ,GAAQ,QAASA,EAAIgzD,QAAU,gDAAWhzD,EAAIgzD,QAAQC,aAAvB,eAA8C,eAACskB,GAAD,CAAKF,IAAKr3E,EAAIgzD,QAAQqkB,SAAiBr3E,EAAIgzD,QAAQC,gBACtK,IAEEuzE,EAAehvH,mBAAQ,MAClB9M,EAAO4xB,MAAK02B,GAAWA,EAAQimB,YAAcjmB,EAAQimB,aAAegtH,EAAahtH,cACzF,CAACgtH,EAAcv7L,IAEZo5I,EAAatsI,mBAAQ,IACrBquL,EAAahpM,KAAIm2D,GAAWA,EAAQC,eAAchzD,SAAS8lM,IAC3Dr7L,EAAO7N,KAAIm2D,GAAWA,EAAQC,eAAchzD,SAAS8lM,GADyB,wCAAN,OAA+CA,GAErG,MAAlBA,EAAW,GAAkB,2BAC1B,IACN,CAACA,EAAYr7L,EAAQm7L,IAElBM,EAA4BpoL,uBAAY,CAACwxB,EAAOh1C,KACnDA,GAAK,OAAIA,QAAJ,IAAIA,KAAO0+E,WAAaitH,EAAgB3rM,GAAS2rM,EAAgB,GAAvE,GACC,IAEGE,EAA0BroL,uBAAawxB,IAC3Cy2J,EAAcz2J,EAAMlnB,OAAO9tB,MAA3B,GACC,IAEG8rM,EAAetoL,uBAAY,KAC/B+nL,EAASC,GACTC,EAAc,GAAd,GACC,CAACD,EAAYD,IAEVl/D,EAAY7oH,uBAAY,KAC5BknL,EAAMgB,GACNC,EAAgB,GAAhB,GACC,CAACD,EAAchB,IAEZqB,EAAmB9uL,mBAAQ,IACZ,KAAfssI,GAAoC,KAAfiiD,EAChB,eAAC/rL,GAAA,EAAD,CAAQjJ,MAAM,UAAU+I,QAAQ,YAAY3I,QAASk1L,EAArD,sCAGG7/D,GAAiC,KAAjBy/D,EAKnB,eAACjsL,GAAA,EAAD,CAAQjJ,MAAM,UAAU+I,QAAQ,YAAY4pC,UAAQ,EAApD,iBAJA,eAAC1pC,GAAA,EAAD,CAAQF,QAAQ,YAAY/I,MAAM,UAAUI,QAASy1H,EAArD,4CAMR,CAACq/D,EAAcF,EAAYn/D,EAAWy/D,EAAcviD,EAAYtd,IAE7Di/D,EAAWjuL,mBAAQ,kBAAM9M,IAAM,UAAIA,EAAO4xB,MAAK/hC,KAAU,OAAEA,QAAF,IAAEA,MAAOgsM,wBAAnC,aAAI,EAAgDA,cAAhE,GAA+E,CAAC77L,IAEzG,OAAO,gBAACwN,GAAA,EAAD,CAAKjG,QAAS,QAAd,UACL,eAACiG,GAAA,EAAD,CAAK0yB,aAAc,EAAGN,UAAW,EAAjC,SACE,eAAClyB,GAAA,EAAD,CAAY0B,QAAQ,YAApB,wBAIF,eAAC5B,GAAA,EAAD,CAAK0yB,aAAc,EAAnB,SACE,eAAC+2B,GAAA,EAAD,CACEpnE,MAAOwrM,EAAYp0J,SAAUy0J,EAC7Bt1L,MAAO,CAACy6B,MAAO,QAASnnC,MAAM,uBAAuBq0C,YAAY,eACjEtpC,MAAsB,KAAf20I,EAAmB/+E,WAA4B,KAAf++E,GAAqBA,EAC5DhqI,QAAQ,SAAS5I,KAAK,QACtB61H,WAAY,CAAE,cAAe,yBAGjC,eAAC,KAAD,CACEj2H,MAAO,CAACy6B,MAAO,QACfhiC,QAASs8L,EACTpjI,eAAgB54D,GAAUA,EAAOopD,cAAgB,GACjDthB,SAAUw0J,EACV5rM,MAAO0rM,EACPrhI,kBAAmB,CAAC/6D,EAAQtP,KAAWA,IAAc,OAANsP,QAAM,IAANA,OAAA,EAAAA,EAAQopD,iBAAR,OAAyB14D,QAAzB,IAAyBA,OAAzB,EAAyBA,EAAO04D,cAC/E6R,YAAalxD,GACX,eAAC+tD,GAAA,EAAD,IACM/tD,EACJkG,QAAQ,SAAS1V,MAAM,iCACvBq0C,YAAY,eAAetgC,OAAO,SAASssD,WAAS,EAACvzD,KAAK,QAC1D/B,MAAOq3H,GAAiBy/D,EAAahzI,cAAgB6wF,EAAWvpJ,QAAU0rM,EAAahzI,aACvF8R,WAAayhE,EAAe,8CAAiDsd,EAAWvpJ,QAAU0rM,EAAahzI,aAAe6wF,EAAW30I,MAAQ,OAIvJ,eAAC+I,GAAA,EAAD,CAAKjG,QAAQ,OAAO29B,eAAe,QAAQyiE,QAAS,EAApD,SACGi0F,IAEFb,GAAY,eAACrtL,GAAA,EAAD,CAAYrH,MAAM,QAAQ6iC,KAAK,oBAA/B,SACV6xJ,IAEH,eAACzxF,GAAA,EAAD,IACC1lE,GAAW5jC,EAAOxL,OAAS,GAAK,eAAC,GAAD,CAAWovC,QAASA,EAASx7B,KAAMpI,EAAOhB,QAAOnP,KAAS,OAAEA,QAAF,IAAEA,KAAOgsM,iBAAgB1pM,KAAItC,GAAS6O,OAAO,CAAC4pD,QAASz4D,EAAO2qM,SAAUA,MAAlI,SAC/B,eAAC,GAAD,CAAgBv0J,QAAS61J,GAAiBjyJ,UAAQ,QAGvD,CASD,MAAMiyJ,GAAkB53L,IAAMoI,MAAM7G,IAAW,IAAD,IAC5C,MAAM,KAAC2C,GAAQ3C,EACT3H,EAAW+nD,cAEXk2I,EAAiBjvL,mBAAQ,IAEtBghH,GADG,8BAA0B1lH,EAAKkgD,QAAQimB,YAC7BzwE,IACnB,CAACsK,EAAMtK,IAEV,OAAO,gBAAC0P,GAAA,EAAD,CAAKjG,QAAS,eAAd,UACJa,EAAKkgD,QAAQimB,YAAc,eAAChoE,GAAA,EAAD,CAAYC,KAAK,QAAQygB,UAAW5X,QAAM4K,GAAI8hL,EAAgBp+K,OAAO,SAArE,SAC1B,eAACylB,GAAA,EAAD,CAASD,MAAM,kBAAf,SACE,eAAC,KAAD,QAGJ,eAAC58B,GAAA,EAAD,CAAYC,KAAK,QAAQC,QAAS,IAAM2B,EAAKoyL,SAASpyL,EAAKkgD,SAAUtP,WAAY5wC,EAAKkgD,QAAQqkB,OAAO,UAACvkE,EAAKkgD,eAAN,OAAC,EAAc0zI,cAAc51L,MAAO,CAACw5D,cAAe,QAAS,cAAY,wBAA9K,SACE,eAACx8B,GAAA,EAAD,CAASD,OAAQ/6B,EAAKkgD,QAAQqkB,KAAO,UAACvkE,EAAKkgD,eAAN,OAAC,EAAc0zI,aAA0F,qBAA3E,yEAAnE,SACE,eAAC,KAAD,UARN,IAiBIC,GAA8BltL,cAAWnI,IAAK,CAClD09G,OAAQ,CACNzjF,MAAO,YAgSIq7J,OA5Rf,YAAyC,OAATz2L,GAAQ,EACtC,MAAM,OAACytL,EAAD,gBAASlC,GAAmBvrL,EAC5BD,EAAUy2L,MACV,IAACxzL,EAAD,KAAMiD,GAAQyB,MACd,WAAC9I,GAAcmD,MACf,SAACsc,EAAD,OAAWW,EAAX,QAAmB9lB,EAAnB,aAA4BkwB,GAAgB6+F,MAC3C3nH,EAAM48B,GAAWj2B,oBAAS,IAC1BiwH,EAAmBC,GAAwBlwH,oBAAS,GACrDwhB,EAAY,OAAGzJ,QAAH,IAAGA,OAAH,EAAGA,EAAQ2K,gBACvB+sK,EAAanL,EAAgBr/J,UAAhB,OAA4BlN,QAA5B,IAA4BA,OAA5B,EAA4BA,EAAQ9lB,QAAUqyL,EAAgB15J,SAAS9iC,QACnF2mM,EAAciB,GAAmB1vL,mBAAS,KAC1C2vL,EAAqBC,GAA0B5vL,oBAAS,IACxDu5B,EAASs2J,GAAc7vL,mBAAS,IAEjC8vL,EAAuBnpL,uBAAY,KACvCupH,GAAqB,GACrBj6F,GAAQ,EAAR,GACC,IAEH/1B,qBAAU,KACJ7G,IAASs2L,IACXC,GAAuB,GACvB7zL,EAAIQ,IAAJ,+BAAgC,IAAhC,SAA6C,EAA7C,YAA0DyC,EAAK8jB,MAC5DvlB,MAAKo+C,IACJ+zI,EAAe,OAAC/zI,QAAD,IAACA,OAAD,EAACA,EAAUjgD,KAA1B,IAED+B,OAAMijH,IACLgvE,EAAgB,IAChB/3L,EAAW+oH,EAAX,IAEL,GACA,CAAC3kH,EAAKiD,EAAMrH,EAAY0B,EAAMs2L,EAAqBC,IAEtD,MAAMG,EAAyB3vL,mBAAQ,IAC9BkkL,EAAgBr/J,UAAYhzB,EAAUA,EAAQK,QAAOsf,GAAS0yK,EAAgB15J,SAAS/hC,SAAzB,OAAkC+oB,QAAlC,IAAkCA,OAAlC,EAAkCA,EAAOgZ,aAC7G,CAAC34B,EAASqyL,EAAgB15J,SAAU05J,EAAgBr/J,YAEjD+qK,EAAiB5vL,mBAAQ,oBACtB,OAAPnO,QAAO,IAAPA,OAAA,EAAAA,EAASnK,QAAS,IAAI,UAAAioM,EAAuB,UAAvB,mBAA2BlN,sBAA3B,eAA2C/gH,UAAgB,EADpD,GAE5B,CAAC7vE,EAAS89L,IAEPE,EAAoB7vL,mBAAQ,KAChC,IAAW,OAAPnO,QAAO,IAAPA,OAAA,EAAAA,EAASnK,QAAS,EACpB,MAAO,GAET,MAAMooM,EAAiBH,EAAuBtqM,KAAImsB,IAAK,oBAAIA,QAAJ,IAAIA,GAAJ,UAAIA,EAAOixK,sBAAX,aAAI,EAAuB9wJ,UAA3B,IAAuC80F,OAC9F,OAAOqpE,EAAe59L,QAAO,CAACnP,EAAO8kB,IAAUioL,EAAez3L,QAAQtV,KAAW8kB,GAAjF,GACC,CAAChW,EAAQnK,OAAQioM,IAEdI,EAAkB/vL,mBAAQ,KAC9B,IAAW,OAAPnO,QAAO,IAAPA,OAAA,EAAAA,EAASnK,QAAS,EACpB,MAAO,GAET,MAAMsoM,EAAeL,EAAuBtqM,KAAImsB,IAAK,oBAAIA,QAAJ,IAAIA,GAAJ,UAAIA,EAAOixK,sBAAX,aAAI,EAAuBlnI,QAA3B,IACrD,OAAO8yI,EAAan8L,QAAO+9L,GAAmBD,EAAavpE,OAAOphI,KAAIm2D,GAAWA,EAAQimB,aAAYh5E,SAASwnM,EAAgBxuH,aAA9H,GACC,CAACkuH,EAAwB99L,EAAQnK,OAAQ2mM,IAEtC6B,EAAmB3pL,uBAAY,KACnCkpL,EAAW,IACX55J,GAAQ,EAAR,GACC,IAEGs6J,EAAoB5pL,uBAAY,KACpC,MAAM6pL,EAAWj3J,EAAQjnC,QAAOsH,GAAUA,EAAO62L,iBAAgBhrM,KAAImU,GAAUmC,EAAIgC,KAAJ,aAAuB,CAAC89C,aAAcjiD,EAAO62L,mBAC5H,OAAOtzL,QAAQiuI,IAAIolD,EAAnB,GACC,CAACz0L,EAAKw9B,IAEHj6B,EAAOqH,uBAAY,CAAC8Y,EAAUssH,IAC3B,IAAI5uI,SAAQ,CAACC,EAASC,KAC3B,IACE,MAAM2sH,EAAc,CAACvqG,SAAUA,EAAUssH,YAAaA,EAAarhH,MAAO,QACtE45J,EAAgB15J,WAAUo/F,EAAY3tH,MAAQioL,GAChDvoL,EAAIgC,KAAJ,kBAAoBqZ,EAApB,SAAqC4yG,GAClCzsH,MAAK,IAAMH,EAAQ,MACnBK,OAAM1F,GAASsF,EAAOtF,EAAMM,aAGlC,CAFC,MAAON,GACPsF,EAAOtF,EAAMM,WACd,MAEF,CAAC0D,EAAKqb,EAAUktK,IAEboM,EAAgB/pL,uBAAa8Y,IACjCngB,EAAKmgB,GAAU,GACZliB,MAAKhC,IACJ+D,EAAKmgB,GAAU,GACZliB,MAAKoB,IACJkxL,EAAW,IACX1tK,EAAa,CAACpK,OAAQpZ,EAAQjD,MAA9B,IACC+B,OAAMijH,IACP/oH,EAAW+oH,EAAX,GALJ,IAQDjjH,OAAM/F,IACLA,EAAOjE,SAAQsE,IACTA,EAAMm0I,IAAIrjJ,SAAS,eAAegnM,GAAWc,GAAc,IAAIA,EAAY,CAAC,gBAAmB54L,EAAMV,QACrGU,EAAMm0I,IAAIrjJ,SAAS,aAAagnM,GAAWc,GAAc,IAAIA,EAAY,CAAC,cAAiB54L,EAAMV,OAAjE,GAFtC,GAXJ,GAgBC,CAACiI,EAAM6iB,EAAcxqB,IAElBi5L,EAAmBxwL,mBAAQ,MAAQm5B,EAAQrU,MAAKtrB,GAAU,gBAAiBA,KAAS,CAAC2/B,IACrFs3J,EAAsBzwL,mBAAQ,MAAQm5B,EAAQrU,MAAKtrB,GAAU,kBAAmBA,GAAU,qBAAsBA,KAAS,CAAC2/B,IAC1Hu3J,EAAmB1wL,mBAAQ,MAAQm5B,EAAQrU,MAAKtrB,GAAU,gBAAiBA,GAAU,mBAAoBA,GAAU,mBAAoBA,KAAS,CAAC2/B,IAEjJuoC,EAAU1hE,mBAAQ,KACtB,MAAMxG,EAAS2/B,EAAQrU,MAAKtrB,GAAU,gBAAiBA,IACvD,OAAQA,EAASA,EAAOm3L,YAAcf,CAAtC,GACC,CAACz2J,EAASy2J,IAEPj+J,EAAa3xB,mBAAQ,KACzB,IAAI2xB,EAAa,IAAIk+J,GAMrB,OALA12J,EAAQ9lC,SAAQmG,IACVA,EAAOo3L,gBAAej/J,EAAa,IAAIA,EAAYn4B,EAAOo3L,gBAC1Dp3L,EAAOq3L,mBAAkBl/J,EAAaA,EAAWz/B,QAAO0/B,GAAaA,IAAcp4B,EAAOq3L,oBAC1Fr3L,EAAO00L,kBAAiBv8J,EAAa,IAAIA,EAAYn4B,GAA7B,IAEvBm4B,CAAP,GACC,CAACwH,EAAS02J,IAEPt0I,EAAWv7C,mBAAQ,KACvB,IAAIu7C,EAAW,IAAIw0I,GAWnB,OAVA52J,EAAQ9lC,SAAQmG,IACd,GAAIA,EAAOs3L,YAAa,CACtB,MAAMC,EAAsB1C,EAAavpK,MAAKmrK,GAAmBz2L,EAAOs3L,cAAgBb,EAAgBxuH,aACxGsvH,EAAoB7B,cAAe,EACnC3zI,EAAW,IAAIA,EAAUw1I,EAC1B,CACGv3L,EAAO62L,iBAAgB90I,EAAW,IAAIA,EAAU,CAAC,aAAgB/hD,EAAO62L,kBACxE72L,EAAOw3L,iBAAgBz1I,EAAWA,EAASrpD,QAAOspD,GAAWA,EAAQimB,aAAejoE,EAAOw3L,kBAC3Fx3L,EAAOu1L,gBAAexzI,EAAW,IAAIA,EAAU/hD,GAAzB,IAErB+hD,CAAP,GACC,CAACpiB,EAAS42J,EAAiB1B,IAExB4C,EAAsB1qL,uBAAY,KACtC,GAAIiqL,GAAoBC,GAAuBC,EAAkB,CAC/D,MAAMrxK,EAAW,CAAC,EACdmxK,IAAkBnxK,EAASqiD,QAAUA,GACrC+uH,IACFpxK,EAASsS,WAAa,CAAC,EACnBwH,EAAQrU,MAAKtrB,GAAU,kBAAmBA,MAAS6lB,EAASsS,WAAWhkC,IAAMwrC,EAAQ+3J,SAAQ13L,GAAUA,EAAOo3L,eAAiB,MAC/Hz3J,EAAQrU,MAAKtrB,GAAU,qBAAsBA,MAAS6lB,EAASsS,WAAW5vB,OAASo3B,EAAQ+3J,SAAQ13L,GAAUA,EAAOq3L,kBAAoB,OAE1IH,GACFrxK,EAASk8B,SAAW,CAAC,EACrB40I,IAAoBhzL,MAAKg0L,IACvB,MAAMC,EAAiBD,EAAY9rM,KAAIgsM,GAAYA,EAAS5vH,aACxDtoC,EAAQrU,MAAKtrB,GAAU,gBAAiBA,GAAU,mBAAoBA,MAAS6lB,EAASk8B,SAAS5tD,IAAMwrC,EAAQ+3J,SAAQ13L,GAAUA,EAAOs3L,aAAe,KAAI9iM,OAAOojM,IAClKj4J,EAAQrU,MAAKtrB,GAAU,mBAAoBA,MAAS6lB,EAASk8B,SAASx5C,OAASo3B,EAAQ+3J,SAAQ13L,GAAUA,EAAOw3L,gBAAkB,MACtIV,EAAcjxK,EAAd,KAGFixK,EAAcjxK,EAEjB,MACCwW,GAAQ,EACT,GACA,CAACsD,EAASuoC,EAASyuH,EAAmBK,EAAkBE,EAAkBD,EAAqBH,IAE5FgB,EAAmB/qL,uBAAaxjB,IACpC,MAAMyW,EAAS2/B,EAAQrU,MAAKtrB,GAAU,gBAAiBA,IACvD,GAAIA,EAAQ,CACV,MAAM+3L,EAAa,IAAIp4J,GACnBp2C,IAAU6sM,EACZ2B,EAAWtuL,OAAOk2B,EAAQ9gC,QAAQmB,GAAS,GAE3C+3L,EAAWp4J,EAAQ9gC,QAAQmB,IAAW,CAACm3L,YAAa5tM,GAEtD0sM,EAAW8B,EACZ,MACC9B,GAAWc,GAAc,IAAIA,EAAY,CAACI,YAAa5tM,KACxD,GACA,CAACo2C,EAASy2J,IAEP4B,EAAqBjrL,uBAAaxjB,IACtC0sM,GAAWc,GAAcA,EAAWr+L,QAAOsH,KAAY,oBAAqBA,OACxE2/B,EAAQ+3J,SAAQ13L,GAAUA,EAAOq3L,kBAAoB,KAAIpoM,SAAS1F,GACpE0sM,GAAWgC,GAAYA,EAASv/L,QAAOsH,GAAUA,EAAOq3L,mBAAqB9tM,MAE7E0sM,GAAWgC,GAAY,IAAIA,EAAU,CAACb,cAAe7tM,KACtD,GACA,CAACo2C,IAEEu4J,EAAwBnrL,uBAAaxjB,IACzC0sM,GAAWc,GAAcA,EAAWr+L,QAAOsH,KAAY,oBAAqBA,OACxE2/B,EAAQ+3J,SAAQ13L,GAAUA,EAAOo3L,eAAiB,KAAInoM,SAAS1F,GACjE0sM,GAAWgC,GAAYA,EAASv/L,QAAOsH,GAAUA,EAAOo3L,gBAAkB7tM,MAE1E0sM,GAAWgC,GAAY,IAAIA,EAAU,CAACZ,iBAAkB9tM,KACzD,GACA,CAACo2C,IAEEw4J,EAAsBprL,uBAAaxjB,IACvC0sM,GAAWc,GAAcA,EAAWr+L,QAAOsH,KAAY,kBAAmBA,OACtEzW,IAAUo2C,EAAQrU,MAAKtrB,GAAUA,EAAO62L,iBAAmBttM,KAC7D0sM,GAAWgC,GAAY,IAAIA,EAAU,CAACpB,eAAgBttM,KACvD,GACA,CAACo2C,IAEEy4J,EAAmBrrL,uBAAaxjB,IAChCA,IACF0sM,GAAWc,GAAcA,EAAWr+L,QAAOsH,KAAY,kBAAmBA,OACtE2/B,EAAQ+3J,SAAQ13L,GAAUA,EAAOw3L,gBAAkB,KAAIvoM,SAAS1F,EAAM0+E,YACxEguH,GAAWgC,GAAYA,EAASv/L,QAAOsH,GAAUA,EAAOw3L,iBAAmBjuM,EAAM0+E,eAEjFguH,GAAWgC,GAAY,IAAIA,EAAU,CAACX,YAAa/tM,EAAM0+E,eAE5D,GACA,CAACtoC,IAEE04J,EAAsBtrL,uBAAaxjB,IACvC0sM,GAAWc,GAAcA,EAAWr+L,QAAOsH,KAAY,kBAAmBA,OACtE2/B,EAAQ+3J,SAAQ13L,GAAUA,EAAO62L,gBAAkB,KAAI5nM,SAAS1F,EAAM04D,cACxEg0I,GAAWgC,GAAYA,EAASv/L,QAAOsH,GAAUA,EAAO62L,iBAAmBttM,EAAM04D,iBACxEtiB,EAAQ+3J,SAAQ13L,GAAUA,EAAOs3L,aAAe,KAAIroM,SAAS1F,EAAM0+E,YAC5EguH,GAAWgC,GAAYA,EAASv/L,QAAOsH,GAAUA,EAAOs3L,cAAgB/tM,EAAM0+E,eAE9EguH,GAAWgC,GAAY,IAAIA,EAAU,CAACT,eAAgBjuM,EAAM0+E,cAC7D,GACA,CAACtoC,IAEE24J,EAAgBvrL,uBAAY,KAC5BiqL,GAAoBC,GAAuBC,EAC7C5gE,GAAqB,GAErBj6F,GAAQ,EACT,GACA,CAAC26J,EAAkBE,EAAkBD,IAExC,OAAO,gBAAC,IAAMhwL,SAAP,WACJ2lL,GAAU,eAAC3sL,GAAA,EAAD,CAAYE,QAAS,IAAMu2L,IAA3B,SACT,eAAC55J,GAAA,EAAD,CAASD,MAAM,gBAAf,SACE,eAAC,KAAD,SAGF+vJ,GAAU,eAAC5jL,GAAA,EAAD,CAAQ7I,QAAS,IAAMu2L,IAAoB5tL,QAAQ,YAAY/I,MAAM,UAAU2yC,SAAU9qB,EAAc,cAAY,uBAAnH,UACH,OAANzJ,QAAM,IAANA,OAAA,EAAAA,EAAQ9lB,YAAkB,OAAN8lB,QAAM,IAANA,OAAA,EAAAA,EAAQ9lB,SAAU,EAAlB,sCAA8C8lB,QAA9C,IAA8CA,OAA9C,EAA8CA,EAAQ9lB,QAAtD,kDAEtBoH,GAAQ,gBAAC+8B,GAAA,EAAD,CAAQt9B,QAAS,CAACg8B,MAAOh8B,EAAQ8+G,QAASv+G,KAAMA,EAAM2+G,sBAAoB,EAAC,cAAY,uBAAvF,UACP,eAAC3hF,GAAA,EAAD,mCACA,gBAACC,GAAA,EAAD,WACE,gBAACwqE,GAAA,EAAD,iFAEE,wBACC2uF,EAHH,cAGkB13K,QAHlB,IAGkBA,OAHlB,EAGkBA,EAAQ9lB,QAH1B,IAGwD,KAAd,OAAN8lB,QAAM,IAANA,OAAA,EAAAA,EAAQ9lB,SAAgB,QAAU,UAHtE,mBAKA,eAAC2qG,GAAA,EAAD,IACA,iCACE,eAAC+wF,GAAD,CAAcxqM,MAAO6sM,EAAgBz1J,SAAUm3J,IAC/C,eAAC9D,GAAD,CAAgBt6L,OAAQy+B,EAAY87J,MAAO+D,EAAoB9D,SAAUgE,IACzE,eAACtD,GAAD,CAAcl7L,OAAQqoD,EAAU8yI,aAAcA,EAAcC,SAAUqD,EAAqBlE,MAAOmE,EAAkBlE,SAAUmE,UAGlI,gBAAC17J,GAAA,EAAD,WACE,uBAAM78B,MAAO,CAACujC,SAAU,KACxB,eAACr6B,GAAA,EAAD,CAAQ7I,QAASm4L,EAAev4L,MAAM,YAAtC,oBAGA,eAACiJ,GAAA,EAAD,CAAQ7I,QAASs3L,EAAqB/kJ,WAAYskJ,GAAoBC,GAAuBC,GAAmBn3L,MAAM,YAAtH,uBAIF,gBAACy8B,GAAA,EAAD,CACE/8B,KAAM42H,EACN,mBAAiB,2BAFnB,UAIE,eAAC35F,GAAA,EAAD,UACE,eAACwqE,GAAA,EAAD,CAAmBlsG,GAAG,2BAAtB,oEAIF,gBAAC2hC,GAAA,EAAD,WACE,eAAC3zB,GAAA,EAAD,CAAQ7I,QAAS,IAAMm2H,GAAqB,GAAQnvB,WAAS,EAA7D,oBACA,eAACn+F,GAAA,EAAD,CAAQ7I,QAAS+1L,EAAjB,gCAKT,EChjBD,MAAM15F,GAAuB/zF,cAAWnI,IAAK,CAC3Cs+F,SAAU,CACRrkE,MAAO,MACPE,UAAW,OACX16B,MAAOO,EAAMnE,QAAQC,QAAQolC,aAC7BhlC,gBAAiB8D,EAAMnE,QAAQC,QAAQb,KACvC+9B,UAAWh5B,EAAMkH,QAAQ,GACzBD,QAAS,UACTvL,WAAY,yDACZa,SAAU,QAIC,SAAS+gG,GAAT,GAAiD,IAA5B,SAACpgF,EAAD,KAAWhb,EAAX,QAAiBzD,GAAU,EAC7D,MAAMw5L,EAAYryK,oBACXlE,GAAW5b,mBAAS,MACrBlH,EAAUs9F,KAEhB,OAAO,gBAAChgE,GAAA,EAAD,CAAQ/8B,MAAI,EAAZ,UACL,gBAACg9B,GAAA,EAAD,4BAA4Bj6B,KAC5B,eAACk6B,GAAA,EAAD,CAAe5b,IAAKy3K,EAApB,SACE,eAAC,KAAD,CACE34L,UAAWV,EAAQy/F,aACnBp6D,UAAW,EACXC,SAAU,IAAM9lC,QAAQC,IAAI,iBAC5B8lC,SAAS,EACTC,WAAW,EACXC,gBAAiB,IAAM4zJ,EAAUniL,QANnC,SAQE,uBAAKtW,MAAO,CAACqH,OAAQ,GAArB,oBACM6a,GADN,cAMJ,eAAC2a,GAAA,EAAD,UACE,eAAC3zB,GAAA,EAAD,CAAQ7I,QAASpB,EAASgB,MAAM,UAAhC,wBAKL,CCnCD,MAAMy4L,GAAkB/vL,cAAWnI,IAAK,CACtCvD,KAAM,CAAC,EACP0kB,KAAM,CACJ,UAAW,CACTjlB,gBAAiB8D,EAAMnE,QAAQ2/C,KAAK,MAEtCvhB,MAAO,OACPt5B,QAAS,OACT09B,cAAe,MACfl3B,WAAY,SACZo3B,SAAU,SACVrE,OAAQ,GACRM,aAAcx6B,EAAMkH,QAAQ,IAE9BuvC,KAAM,CAAC,EAEPrlD,KAAM,CAAC,EAGPnC,KAAM,CAEJ0Z,WAAY3I,EAAMkH,QAAQ,IAE5B3Z,KAAM,CACJob,WAAY3I,EAAMkH,QAAQ,IAE5Bm4B,QAAS,CACP12B,WAAY3I,EAAMkH,QAAQ,GAC1BvG,QAAS,OACT09B,cAAe,MACfC,eAAgB,WAChBC,SAAU,UAEZ5/B,SAAU,CACRgK,WAAY3I,EAAMkH,QAAQ,QAI9B,SAASixL,GAAT,GAAoG,IAA9E,SAACC,EAAD,KAAWj5L,EAAX,YAAiBwxI,EAAjB,SAA8BhyI,EAA9B,KAAwCvN,EAAxC,OAA8CkkB,EAA9C,KAAsD/nB,EAAtD,SAA4DmjC,EAA5D,KAAsExuB,GAAO,EACjG,MAAMtD,EAAUs5L,KAOVtnD,EAAY,CAChBtxI,UAAWV,EAAQ63C,KACnBl6C,SAAU,SAENk6C,EAAOk6F,EACRxxI,EAAO,eAAC,KAAD,IAAoByxI,IAAgB,eAAC,KAAD,IAAsBA,IAClE,sBAAKtxI,UAAWV,EAAQ63C,OAE5B,OAAO,uBAAKn3C,UAAWV,EAAQnC,KAAxB,UACL,uBAAKoD,QAfco+B,IACnBA,EAAMkE,kBACFi2J,GACFA,GACD,EAW2B94L,UAAWV,EAAQuiB,KAA/C,UACGs1B,EACD,eAAC7vC,GAAA,EAAD,CAAK+B,WAAY8tC,EAAO,EAAI,EAA5B,SACE,eAAC3vC,GAAA,EAAD,CAAYxH,UAAWV,EAAQxN,KAA/B,SAAsCA,GAAQ,SAE9C7D,GAAQ+nB,IAAW,sBAAKhW,UAAWV,EAAQrR,KAAxB,SAClBA,IAEH,sBAAK+R,UAAWV,EAAQ3P,KAAxB,SACGqmB,GAAU,eAACqvD,GAAA,EAAD,CAAM/kE,KAAK,QAAQ9M,MAAOwiB,EAAO1c,QAAQ,UAAW,SAAU6G,MAAM,cAEhFixB,GACC,gBAAC,IAAM/pB,SAAP,WACE,eAACC,GAAA,EAAD,CAAKm8B,SAAU,IACf,eAACvG,GAAA,EAAD,CAASD,MAAM,uBAAf,SACE,eAACqrE,GAAD,CAAa9jG,QAAS4sB,EAAUrQ,UAAW1gB,KAAYC,KAAK,QAA5D,SACE,eAAC,KAAD,cAMV,eAAC6iC,GAAA,EAAD,CAAUC,GAAIvjC,EAAMG,UAAWV,EAAQD,SAAvC,SACGA,GAAY,kBAGlB,CAiBD,MAAMuJ,GAAYC,cAAWnI,IAAK,CAChCvD,KAAM,CACJwK,QAASjH,EAAMkH,QAAQ,GACvB+xB,SAAU,YAEZmZ,SAAU,CACRnZ,SAAU,WACV+2B,KAAM,EACNxuB,MAAO,EACPtC,IAAK,EACLkY,OAAQ,EACRle,aAAc,EACdyB,WAAY,2BACZ0c,OAAQ,IAEVghJ,iBAAkB,CAChBp/J,SAAU,WACVpyB,OAAQ,EACRq4B,IAAK,MACL8wB,KAAM,MACNnU,UAAW,6BAIA,SAASy8I,GAAT,GAA4C,IAAvB,SAACp7K,EAAD,SAAWk1B,GAAW,EACxD,MAAMxzC,EAAUsJ,MACV,IAACrG,GAAO0E,KACR/I,EAASoD,MACR23L,EAAeC,GAAoB1yL,oBAAU,IAC7C2yL,EAAaC,GAAkB5yL,mBAAS,MACzC6yL,EAAU/yK,iBAAO,CAAC,GAElBs9E,EAAYh9F,mBAAQ,IAAM,CAAChE,EAAM/C,KAmBhCizC,GAlBLrpB,iBACE,MAAMm1E,EAAch8F,EAAKrM,MAAM,KAAKtK,KAAIwqB,GAAWuK,mBAAmBvK,KAAU1a,KAAK,KAC/EoJ,QAAgB5C,EAAIQ,IAAJ,mBAAoB6a,EAApB,mBAAuCghF,EAAvC,2CACtBy6F,EAAQ7iL,QAAQ5T,GAAQ,CACtB/C,KAAMA,KACHsF,GAEL,MAAMm0L,EAAgB,CAAC,EACvBn0L,EAAQ2+F,mBAAmB1hF,QACxBtpB,QAAO+oB,GAAQA,EAAKoiF,UACpBhqG,SAAQ4nB,IACPy3K,EAAc,GAAD,OAAI12L,EAAJ,YAAYif,EAAK/vB,OAAU+vB,EACpCA,EAAK9I,cACP8I,EAAK7L,OAAS6L,EAAK9I,YAAYzf,QAAQ,WAAY,IAAIA,QAAQ,UAAW,IAC3E,IAEL4/L,GAAiBD,GAAiBA,EAAgB,GACnD,CAECr1F,GAAY3/F,MAAM/F,EAAOC,WAC1B,GACA,CAACyf,EAAUrb,EAAKrE,EAAQg7L,EAAkBpmJ,IAE7CpsC,qBAAU,KACHosC,GACH8wD,EAAU,GACX,GACA,CAACA,EAAW9wD,IAyCf,MAAM31C,EAAOk8L,EAAQ7iL,QAAQ,IAE7B,OAAO,gBAACygF,GAAA,EAAD,CAAOj3F,UAAWV,EAAQnC,KAAM88D,UAAWnnB,EAAW,OAAIjjD,EAA1D,UACJijD,GAAY,sBAAK9yC,UAAWV,EAAQwzC,WACpCA,GAAY,sBAAK9yC,UAAWV,EAAQy5L,iBAAxB,SAA0C,eAAC35J,GAAA,EAAD,CAAkBj/B,MAAM,cAC9EhD,GA5BH,SAASo8L,EAAmB32L,EAAMif,GAAO,IAAD,IACtC,MAAM,QAACoiF,GAAWpiF,EACZ3f,EAAOm3L,EAAQ7iL,QAAQ5T,GACvB42L,EAAa52L,EAAI,UAAMA,EAAN,KAAgB,GAEjCrD,EAAQ,CACZhH,IAAKqK,EACLA,KAAMA,EACNgb,SAAUA,EACVyzH,aAAcptC,EACdpkG,KAAI,OAAEqC,QAAF,IAAEA,OAAF,EAAEA,EAAMrC,KACZR,SAAQ,OAAE6C,QAAF,IAAEA,GAAF,UAAEA,EAAM4hG,0BAAR,iBAAE,EAA0B1hF,eAA5B,aAAE,EAAmCn2B,KAP5B41B,GAAQ03K,EAAmB,GAAD,OAAIC,GAAJ,OAAiB33K,EAAK/vB,MAAQ+vB,KAQzEi3K,SAAU70F,EAAU,KAAO,IA5BTrhG,KACpB,MAAM62L,EAAaJ,EAAQ7iL,QAAQ5T,GAC/B62L,GAIGA,EAAW55L,MACd+jG,EAAUhhG,GAAM,GAElB62L,EAAW55L,MAAQ45L,EAAW55L,KAC9Bq5L,EAAiBD,EAAgB,IAEjCr1F,EAAUhhG,GAAM,EACjB,EAekCujC,CAAavjC,MAK3Cif,GAGL,OAAO,eAACg3K,GAAD,IAAkBt5L,GAC1B,CAOUg6L,CAAmB,GAAIp8L,GAC/Bg8L,GAAe,eAAC,GAAD,CAAav7K,SAAUA,EAAUhb,KAAMu2L,EAAah6L,QAAS,IAAMi6L,EAAe,UAErG,CC1MD,MAAM17J,GAAU,CACd,CACEnlC,IAAK,aACL/E,MAAO,OACPyqC,MAAO,OACPF,UAAU,EACV3+B,OAAQgZ,GAAS,eAAC,GAAD,CAAUrS,SAAU,aAAc42C,QAAM,EAAC4qB,SAAO,EAAC1/B,YAAY,UAAU3lC,KAAMkW,KAEhG,CAAC7f,IAAK,aAAc0lC,MAAO,OAAQF,UAAU,EAAOvqC,MAAO,QAC3D,CACE+E,IAAK,WACL0lC,MAAO,OACP7+B,OAAQgZ,GAAS,eAAC,GAAD,CAAUrS,SAAU,WAAYwhE,SAAO,EAAC5qB,QAAM,EAAC6qB,eAAa,EAACtlE,KAAMkW,KAEtF,CACE7f,IAAK,WACL0lC,MAAO,OACPF,UAAU,EACV3+B,OAAQgZ,GAAS,eAAC,GAAD,CAAUrS,SAAU,WAAYwhE,SAAO,EAAC5qB,QAAM,EAAC6qB,eAAa,EAACtlE,KAAMkW,KAEtF,CAAC7f,IAAK,cAAe0lC,MAAO,QAC5B,CAAC1lC,IAAK,UAAW0lC,MAAO,OAAQ7+B,OAAQhQ,GAAO+oB,GAAW/oB,IAC1D,CAACmJ,IAAK,iBAAkB0lC,MAAO,QAC/B,CACEzqC,MAAO,WACP+E,IAAK,gBACL0lC,MAAO,OACPF,UAAU,EACV3+B,OAAQgZ,GAASqC,GAAgBrC,EAAMurF,gBAEzC,CAACprG,IAAK,UAAWwlC,UAAU,EAAOE,MAAO,QACzC,CACE1lC,IAAK,aACLwlC,UAAU,EACVE,MAAO,OACP7+B,OAAQhQ,IACN,MAAM8yD,EAAO9yD,EAAImpC,YAAc,GAC/B,OAAI2pB,EAAK5zD,OAAS,EAEd,sBAAK4R,MAAO,CAACmB,QAAS,UAAtB,SACG6gD,EAAKj2D,KAAI,CAACi1B,EAAK10B,IAAM,kCACpB,eAAC2c,GAAA,EAAD,CAAMlR,KAAMipB,EAAZ,SAAkBA,IAAa10B,EAAI,EAAK01D,EAAK5zD,OAAS,KAAO,eAAC,IAAM+Y,SAAP,MAD9B6Z,OAM9B,8CACR,GAGL,CACE3oB,IAAK,WACL0lC,MAAO,OACPF,UAAU,EACV3+B,OAAQgZ,IACN,MAAM+pC,EAAW/pC,EAAM+pC,UAAY,GACnC,OAAIA,EAAS7zD,OAAS,EACb6zD,EAASl2D,KAAIm2D,GAAWA,EAAQC,eAActmD,KAAK,MAEnD,4CACR,IAKP0hC,GAAkBC,GAASsM,IAE3B,MAAM0vJ,GAAyB,CAC7B,aACA,aACA,WACA,kBAGa,SAASC,GAAgBp6L,GACtC,MAAOsO,EAAUN,GAAe/G,mBAAS,IAAIgE,MACvC,WAACmd,EAAD,YAAaiyK,GAAer6L,GAC5B,OAACgf,EAAD,WAAS6J,GAAco/F,KAEvBqyE,EAAgBjzL,mBAAQ,IACX,QAAbiH,EACK,CAAC,UAAa0Q,EAAOkN,WAGvB,CAAC2F,SAAU,IAAIvjB,KACrB,CAACA,EAAU0Q,IAEd,OAAO,eAAC04E,GAAA,EAAD,CAAO,cAAa,mBAApB,SACL,gBAAC,GAAD,CACEv5D,QAASA,GAASyC,aAAcu5J,MAA4Bn6L,EAC5DsO,SAAUA,EAAU60B,MAAOzpC,GAAUA,EAAOm4B,SAAU8O,kBAAmB3yB,EAF3E,UAIE,eAAC,GAAD,CAAkB0vB,MAAO1gB,GAAWq9K,GAAe,gBAAkBjyK,EAAW2V,OAAO,GAAvF,SACE,gBAAC,GAAD,CAAyB2H,WAAS,EAAlC,UACE,eAAC,GAAD,CAAqBloC,QAAQ,iBAAiB8F,MAAOg3L,IACpDzxK,GACC,eAAC,GAAD,CACE4kK,QAAM,EACNlC,gBAAiB+O,IAEpBzxK,GACC,eAAC,GAAD,CACE4kK,QAAM,EACNlC,gBAAiB+O,EACjB9O,cAA4B,QAAbl9K,EAAqB8Z,EAAW2V,MAAhC,OAAwCzvB,QAAxC,IAAwCA,OAAxC,EAAwCA,EAAUvN,KACjEiN,YAAaA,SAIrB,eAAC,GAAD,CAAgBwyB,QAASisF,GAAiBxpF,QAAS+pF,GAAnD,SACE,eAAC,GAAD,CAAyBluF,eAAgB,CAAC,EAAG,GAAI,GAAI,aAI5D,CC1HD,MAAMz1B,GAAYC,cAAWnI,IAAK,CAChCtR,IAAK,CACHiS,QAAS,OACTwG,WAAY,SACZ,uBAAwB,CACtBwB,WAAY3I,EAAMkH,QAAQ,SAiDjBkyL,OA5CW97L,IAAMoI,MAAK,IAA8B,IAA7B,YAACmpH,EAAD,SAAcxuF,GAAc,EAChE,MAAOj7B,EAAMi0L,GAAWvzL,oBAAS,IAC1B7c,EAAO8mD,GAAYjqC,qBACpB/F,EAASmI,KAGflC,qBAAU,KACR+pC,EAAS8+E,EAAT,GACC,CAACA,IAKJ,MAAM81B,EAAal4I,uBAAY,KAC7B4sL,GAAQ,GACR,MAAMC,GAAoB,OAALrwM,QAAK,IAALA,OAAA,EAAAA,EAAOuN,SAAU,GACtC6pC,GAAYA,EAASi5J,GACrBvpJ,EAASupJ,EAAT,GACC,CAACj5J,EAAUp3C,IAER+zD,EAAavwC,uBAAY,KAC7B4sL,GAAQ,EAAR,GACC,IAEGxkI,EAAepoD,uBAAawxB,IAChC8R,EAAS9R,EAAMlnB,OAAO9tB,MAAtB,GACC,IAEH,OAAOmc,EACH,uBAAK9F,UAAWS,EAAOrR,IAAvB,UACE,eAAC2hE,GAAA,EAAD,CAAWpnE,MAAOA,GAAS,GAAIo3C,SAAUw0B,EAAc1B,WAAS,IAChE,eAACzqD,GAAA,EAAD,CAAQ9I,KAAK,QAAQ4I,QAAQ,YAAY3I,QAAS8kJ,EAAlD,qBAEF,eAAC2sC,GAAD,CAAY1xL,KAAK,QAAQ62C,KAAM,eAAC,KAAD,IAAa52C,QAASm9C,EAArD,SACE,eAACl2C,GAAA,EAAD,CAAY0B,QAAQ,KAApB,SACGvf,GAAS,mDAPlB,ICqBaswM,OA7DMj8L,IAAMoI,MAAK,IAKzB,IAL0B,KAC/BixC,EAD+B,MAE/B7jD,EAF+B,eAG/Bw6C,EAH+B,SAI/B3uC,GACI,EACEuuC,EAAUI,GAAkBx1C,OAAOC,QAAQu1C,GAAgB1/C,OAAS,GAAKkK,OAAOC,QAAQu1C,GAAgB/hD,KAAIuB,GAAKA,EAAEuO,KAAK,OAAMA,KAAK,KAEvI,GADA6xC,EAAUA,EAAO,WAAOA,GAAY,IAC/ByJ,EAAKA,KAAM,OAAO,KAEvB,MAAM7iB,EAAa,CAAC,EASpB,IAAIpS,EA2BN,OAnCEi1B,EAAK6iJ,OACFphM,QAAO+oB,GAAQA,EAAK1mB,WACpBlB,SAAQ4nB,IACF2S,EAAW3S,EAAK1mB,YAAWq5B,EAAW3S,EAAK1mB,UAAY,IAC5Dq5B,EAAW3S,EAAK1mB,UAAUvN,KAAKi0B,EAA/B,IAMFO,EADEqB,kBAAQ+Q,GACA6iB,EAAK6iJ,OAAOphM,QAAOwgE,GAASA,EAAMjiB,OAAMprD,KAAI,CAACkuM,EAAW3tM,IAChE,eAAC6sE,GAAD,CACU7lE,MAAO2mM,EAAU9iJ,KAAMt6C,QAASo9L,EAAUp9L,QAClDu8D,MAAO6gI,EAAUv3L,MAAV,WAAsBy0C,EAAKz0C,KAA3B,YAAmCu3L,EAAUv3L,MAA7C,OAAoDgrC,GAC3D31C,KAAMkiM,EAAUliM,MAFXzL,KAOCgM,OAAOC,QAAQ+7B,GAAYvoC,KAAI,CAAC,EAAoBwiB,KAAW,IAA9BtT,EAAUrB,GAAmB,EACpE,OAAO,iCACJ2U,EAAQ,eAAC20F,GAAA,EAAD,CAASljG,MAAO,CAAC85B,aAAc,KAAQ,KAChD,eAACg/B,GAAD,CAAaC,OAAQ99D,EAArB,SACGrB,EAAO7N,KAAI41B,GACV,eAACw3C,GAAD,CACkB7lE,MAAOquB,EAAKw1B,KAAMt6C,QAAS8kB,EAAK9kB,QAChDu8D,MAAOz3C,EAAKjf,MAAL,WAAiBy0C,EAAKz0C,KAAtB,YAA8Bif,EAAKjf,MAAnC,OAA0CgrC,GACjD31C,KAAM4pB,EAAK5pB,MAFN4pB,EAAKjf,YALDzH,EAAjB,IAeD,eAACy+D,GAAD,CAA6BpmE,MAAOA,EAAO8lE,MAAO,IAAMjiB,EAAKz0C,KAAMu0C,KAAM93C,EAAzE,SACA+iB,GADkBi1B,EAAKz0C,KAA9B,IC3Baw3L,OAnBUp8L,IAAMoI,MAAK,IAE7B,IAF8B,SACnCwX,GACI,EACJ,MAAMy8K,EAAgBH,GAAOphM,QAAQu+C,GAAuB,YAAdA,EAAKA,OACnD,GAA6B,IAAzBgjJ,EAAc/rM,OAChB,OAAO,KAET,MAAM+oD,EAAOgjJ,EAAc,GACzB,OACE,eAAC,GAAD,CAAchjJ,KAAMA,EAAM7jD,MAAO,wBAAyBw6C,eAAgB,CAACviB,UAAW7N,GAAtF,SACE,eAAC,KAAD,KAFJ,IC4BJ,MAAM08K,GAAsBzxL,cAAWnI,IAAK,CAC1Cq+G,SAAU,CACRpkF,MAAO,QAET4/J,eAAgB,CACd,WAAY,CACVl/J,WAAY36B,EAAMnE,QAAQE,UAAUhB,KACpC0E,MAAOO,EAAMnE,QAAQi+L,OAAOC,QAGhCC,eAAgB,CACd,WAAY,CACVr/J,WAAY36B,EAAMnE,QAAQgC,MAAM9C,KAChC0E,MAAOO,EAAMnE,QAAQi+L,OAAOC,YAKlC,SAASE,GAAT,GAA+C,IAA3B,OAACt2F,KAAWnP,GAAc,EAC5C,MAAM51F,EAAUg7L,MACV,aAACpzF,EAAD,cAAeC,EAAf,aAA8B+Y,EAA9B,aAA4C06E,GAAgBxzF,aAAY,CAAC/C,WACzErkG,EAAakgH,GAAgB5gH,EAAQi7L,gBAAoBK,GAAgBt7L,EAAQo7L,gBAAmBp7L,EAAQy/G,SAClH,OACE,sBAAK/+G,UAAWA,EAAhB,SACE,0BAASknG,IAAT,UACE,2BAAWC,MACX,eAAC/9F,GAAA,EAAD,CACEF,QAAQ,YACR/I,MAAM,UACNoJ,UAAW,eAAC,KAAD,OACP2rF,EAJN,yDAWP,CAKD,SAAS2lG,GAAT,GAA6D,IAAtC,QAACC,EAAD,SAAU/5J,EAAV,eAAoBg6J,GAAiB,EAC1D,OAAO,gBAACnjJ,GAAA,EAAD,CAAa13C,MAAO,CAACy6B,MAAO,QAA5B,UACL,eAACkd,GAAA,EAAD,CAAY0Z,QAAM,EAAC0kE,QAAQ,4BAA3B,4BAGA,gBAACtiF,GAAA,EAAD,CACEhqD,MAAOmxM,EACP/5J,SAAUpC,GAASoC,EAASpC,EAAMlnB,OAAO9tB,OACzC2a,MAAO,eAAC+pL,GAAA,EAAD,CAAOv8L,KAAK,UAAUsJ,GAAG,8BAChCk8J,cAAY,EACZxlK,KAAK,UACLghD,WAAYioJ,EANd,UAQE,eAAChnJ,GAAA,EAAD,CAAUpqD,MAAO,EAAjB,SACE,+CAEF,eAACoqD,GAAA,EAAD,CAAUpqD,MAAO,EAAjB,eACA,eAACoqD,GAAA,EAAD,CAAUpqD,MAAO,EAAjB,eACA,eAACoqD,GAAA,EAAD,CAAUpqD,MAAO,GAAjB,gBACA,eAACoqD,GAAA,EAAD,CAAUpqD,MAAO,GAAjB,gBACA,eAACoqD,GAAA,EAAD,CAAUpqD,MAAO,GAAjB,mBAEF,eAAConK,GAAA,EAAD,UACGgqC,IACED,EAAU,EAAI,wCAA0C,+BAGhE,CAQD,SAASE,GAAT,GAA8D,IAAvC,OAACz8K,EAAD,UAAS08K,EAAT,gBAAoB5yK,GAAkB,EAC3D,MAAOyyK,EAASI,GAAc10L,wBAAmC3W,IAA1B0uB,EAAO48K,eAA+B,EAAI58K,EAAO48K,iBACjF1kE,EAAmBC,GAAwBlwH,oBAAS,GAY3D,GANAE,qBAAU,KACJ2hB,GACF6yK,EAAW,EACZ,GACA,CAAC7yK,IAEA9J,EAAOiL,UACT,OAAO,eAAC,GAAD,oEAKT,MAAM4xK,EAAcN,EAAU,EAAI,uBAAyB,UAE3D,OAAO,gBAAC,IAAMzzL,SAAP,WACL,gBAACu1B,GAAA,EAAD,CACE/8B,KAAM42H,EACNt3H,QAAS,IAAMu3H,GAAqB,GAFtC,UAIE,eAAC75F,GAAA,EAAD,0DACA,eAACC,GAAA,EAAD,UACE,eAACwqE,GAAA,EAAD,kKAKF,gBAACvqE,GAAA,EAAD,WACE,eAAC3zB,GAAA,EAAD,CAAQ7I,QAAS,IAAMm2H,GAAqB,GAAQnvB,WAAS,EAA7D,oBACA,eAACn+F,GAAA,EAAD,CAAQ7I,QAjCQ,KACpBm2H,GAAqB,GACrBukE,EAAU,CAACE,eAAgBL,EAASO,kBAAkB,GAAtD,EA+BI,SAAiCD,UAGrC,eAAC,GAAD,s3BAcA,eAAC9zL,GAAA,EAAD,CAAKoyB,UAAW,EAAhB,SACE,gBAACqlC,GAAA,EAAD,CAAMG,WAAS,EAAC79B,UAAU,MAAMz5B,QAAS,EAAzC,UACE,eAACm3D,GAAA,EAAD,CAAMl9C,MAAI,EAAC3hB,MAAO,CAACy6B,MAAO,KAA1B,SACE,eAACkgK,GAAD,CACEC,QAASA,EACT/5J,SAAUm6J,EACVH,eAAgB1yK,EAAkB,+CAAiD,SAGvF,eAAC02C,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACva,GAAA,EAAD,CAAKoyB,UAAW,EAAhB,SACE,eAACtwB,GAAA,EAAD,CACElJ,MAAO,CAAC06B,OAAQ,GAAI0gK,QAAS,KAC7Bh7L,KAAK,QAAQ4I,QAAQ,YACrB3I,QAAS,IAAMm2H,GAAqB,GAAOv2H,MAAM,UACjD2yC,SAAUv0B,EAAO2K,gBACjB,cAAY,wBALd,SAOGkyK,eAOd,CAOD,SAASG,GAAT,GAAqF,IAAD,MAAnD,OAACh9K,EAAD,UAAS08K,EAAT,YAAoBO,EAApB,gBAAiCnzK,GAAkB,EAClF,MAAOyyK,EAASI,GAAc10L,wBAAmC3W,IAA1B0uB,EAAO48K,eAA+B,EAAI58K,EAAO48K,iBACjF1kE,EAAmBC,GAAwBlwH,oBAAS,GAY3D,GANAE,qBAAU,KACJ2hB,GACF6yK,EAAW,EACZ,GACA,CAAC7yK,IAEJ,OAAI9J,QAAJ,IAAIA,GAAJ,UAAIA,EAAQk9K,oBAAZ,OAAI,EAAsB/vK,MAAKgwK,GAAqB,qCAAXA,IACvC,OAAO,eAAC,GAAD,qFAKT,MAAMN,EAAc,2BAEpB,OAAO,gBAAC,IAAM/zL,SAAP,WACL,gBAACu1B,GAAA,EAAD,CACE/8B,KAAM42H,EACNt3H,QAAS,IAAMu3H,GAAqB,GAFtC,UAIE,eAAC75F,GAAA,EAAD,2EACA,gBAACC,GAAA,EAAD,WACE,eAACwqE,GAAA,EAAD,qEAGA,eAACA,GAAA,EAAD,2JAIA,eAACA,GAAA,EAAD,gOAMF,gBAACvqE,GAAA,EAAD,WACE,eAAC3zB,GAAA,EAAD,CAAQ7I,QAAS,IAAMm2H,GAAqB,GAAQnvB,WAAS,EAA7D,oBACA,eAACn+F,GAAA,EAAD,CAAQ7I,QAzCQ,KACpBm2H,GAAqB,GACrBukE,EAAU,CAACE,eAAgBL,EAASO,kBAAkB,GAAtD,EAuCI,SAAiCD,UAGrC,eAAC5zL,GAAA,EAAD,kHAGA,eAACF,GAAA,EAAD,CAAKoyB,UAAW,EAAhB,SACE,gBAACqlC,GAAA,EAAD,CAAMG,WAAS,EAAC79B,UAAU,MAAMz5B,QAAS,EAAzC,UACE,eAACm3D,GAAA,EAAD,CAAMl9C,MAAI,EAAC3hB,MAAO,CAACy6B,MAAO,KAA1B,SACE,eAACkgK,GAAD,CACEC,QAASA,EACT/5J,SAAUm6J,EACVH,eAAgB1yK,EAAkB,+CAAiD,SAGvF,eAAC02C,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACva,GAAA,EAAD,CAAKoyB,UAAW,EAAhB,SACE,eAACtwB,GAAA,EAAD,CACElJ,MAAO,CAAC06B,OAAQ,GAAI0gK,QAAS,KAC7Bh7L,KAAK,QAAQ4I,QAAQ,YACrB3I,QAAS,IAAMm2H,GAAqB,GAAOv2H,MAAM,UACjD2yC,UAAW0oJ,EACX,cAAY,mCALd,SAOGJ,eAOd,CASD,SAASO,GAAT,GAAmC,IAAT,KAACz5L,GAAO,EAChC,MAAM,WAACylB,EAAD,OAAapJ,EAAb,sBAAqBq9K,EAArB,kBAA4CC,GAAqB35L,EACvE,IAAI45L,EAAc,KAYlB,OAVEA,EADEv9K,EAAO2K,gBACK,iBAEgB,YAA1B3K,EAAOkmB,eACK,uBACqB,YAA1BlmB,EAAOkmB,eACF,qBAAuBlmB,EAAOrgB,OAAOnC,KAAK,MAE1C,6BAGX,eAACuL,GAAA,EAAD,CAAKoyB,UAAW,EAAGM,aAAc,EAAjC,SACL,gBAACxyB,GAAA,EAAD,WACGs0L,EADH,KACkBF,EADlB,WAC0Cj0K,QAD1C,IAC0CA,OAD1C,EAC0CA,EAAY2V,MADtD,qBACgFu+J,EAAoB,GAArB,YAAgCA,EAAhC,eAGlF,CAKD,MAAMjzL,GAAYC,cAAWnI,IAAK,CAChCq7L,QAAS,CACPn/L,gBAAiB,UACjB09B,YAAa,EACbY,aAAc,GAEhB8gK,YAAa,CACXhiK,aAAct5B,EAAMkH,QAAQ,IAE9Bq0L,gBAAiB,CACfh/L,SAAU,OACV6K,YAAapH,EAAMkH,QAAQ,QAIxB,SAASs0L,GAAT,GAAqC,IAAb,SAAC78L,GAAW,EACzC,OAAO,eAAC,GAAD,CAAY49B,MAAM,kBAAkB3sC,KAAM+O,EAA1C,SACL,gBAACmI,GAAA,EAAD,0FAEW,eAACo2D,GAAD,CAAUC,wBAAsB,IAF3C,yFAMH,CAKM,SAASs+H,GAAT,GAA0C,IAAb,SAAC98L,GAAW,EAC9C,OAAO,eAAC8J,GAAA,EAAD,CAAMlR,KAAI,UAAKoB,EAAL,gDAAV,SACJgG,GAEJ,CAKM,SAAS+8L,GAAT,GAA0C,IAAb,SAAC/8L,GAAW,EAC9C,OAAO,eAAC8J,GAAA,EAAD,CAAMlR,KAAI,UAAKoB,EAAL,4BAAV,SACJgG,GAEJ,CA6Tcg9L,OAxTf,SAAwB98L,GAAQ,IAAD,EAC7B,MAAMD,EAAUsJ,KACV2mB,EAAYpJ,MACZ,IAAC5jB,EAAD,KAAMiD,GAAQyB,MACd,WAAC9I,GAAcmD,MACf,SACJsc,EADI,OACMW,EADN,QACc9lB,EADd,QACuBivB,EADvB,UACgCK,EADhC,aAC2CC,EAD3C,MACyDzpB,EADzD,gBACgE8pB,EADhE,SAEJH,EAFI,WAEMP,EAFN,gBAEkB20K,EAFlB,aAEmC3zK,EAFnC,qBAEiDE,EAFjD,aAEuEV,GAAgBq/F,MACtF3I,EAAWU,GAAgB/4G,mBAAS,OACpC+1L,EAA0BC,GAA+Bh2L,oBAAS,IAClEw8G,EAAQy5E,GAAaj2L,mBAAS,OAC9Bk2L,EAAuBC,GAA4Bn2L,oBAAS,GAE7Do2L,EAAwBzvL,uBAAawxB,IACzC,MAAMv+B,EAASu+B,EAAMlnB,OAAOqpB,QAAU,MAAQ,SAC9Cv+B,EAAIgC,KAAJ,mBAAqBqZ,EAArB,SAAsC,CAACqI,SAAU,CAC/C,gBAAmB,CAAE,CAAC7lB,GAAS,UAEhC2D,KAAK8kB,GACL5kB,MAAM9F,EAJP,GAKC,CAACoE,EAAKsmB,EAAsB1qB,EAAYyf,IAE3ClX,qBAAU,KACJm4G,IACJtvF,EAAU3I,WAAWG,WAAgB,OAANxI,QAAM,IAANA,OAAA,EAAAA,EAAQgxG,cAAe,UACtDhtH,EAAIQ,IAAJ,mBAAoB6a,EAApB,mBACG7Z,KAAK04L,GACLx4L,OAAM1F,IACLk+L,EAAU,MACS,iBAAfl+L,EAAMzM,MACRqM,EAAWI,EACZ,IANL,GAQC,CAACgE,EAAKpE,EAAYyf,EAAUihG,EAAW49E,EAAWltK,EAAU3I,WAA5D,OAAwErI,QAAxE,IAAwEA,OAAxE,EAAwEA,EAAQgxG,cAEnF,MAAMppB,EAAkBh5F,uBAAYi5F,IAAU,IAAD,EAC3C,GAAI,UAACA,EAAM,UAAP,QAAC,EAAUt0G,KACb,OAEF,MAAMu0G,EAAW,IAAIC,SACrB,IAAK,MAAMvmC,KAAQqmC,EACjBC,EAASzY,OAAO,OAAQ7tB,GAE1Bw/C,EAAa,GACbh9G,EAAIwC,IAAJ,mBAAoB6Y,EAApB,SAAqCyoF,EAAU,CAC7CyZ,iBAAmBC,IACjB,MAAMC,EAAmB5zH,KAAK2oF,MAA8B,IAAvBgrC,EAAcE,OAAgBF,EAAcziF,OACjFiiF,EAAaS,EAAb,IAGDj8G,MAAKoB,GAAWwjB,EAAa,CAACpK,OAAQpZ,EAAQjD,SAC9C+B,MAAM9F,GACNyzC,SAAQ,KACP2tE,EAAa,KAAb,GATJ,GAWC,CAAC3hG,EAAU+K,EAAc42F,EAAch9G,EAAKpE,IAQzC0+L,EAAgB,IAAyC,IAAxC,eAAC1B,EAAD,iBAAiBE,GAAsB,EAC5D94L,EAAIgC,KAAJ,mBAAqBqZ,EAArB,0CAA+Du9K,EAA/D,6BAAkGE,IAC/Ft3L,MAAKoB,GAAWwjB,EAAa,CAACpK,OAAQpZ,EAAQjD,SAC9C+B,MAAM9F,EAFT,EA4BF,IAAK4pB,IAActvB,EACjB,OAAO,eAACopG,GAAD,CAAMH,cAAY,EAAlB,SACHnjG,EAAQ,eAACiJ,GAAA,EAAD,UAAajJ,EAAMM,YAAcN,EAAMG,SAAW,mBAAiC,eAAC8I,GAAA,EAAD,4BAIjG,MAAMs1L,EAAkBv6L,EAAIY,SAASwD,cAC/B60L,EAAcj9K,EAAOiL,UACrB/F,EAA6B,IAAnBlF,EAAO9lB,QAEvB,OACE,gBAACopG,GAAD,CAAMH,cAAY,EAAlB,UACE,eAACkd,GAAD,CAAsBC,UAAWA,IACjC,gBAAC9/C,GAAA,EAAD,CAAMG,WAAS,EAACt3D,QAAS,EAAGC,WAAW,SAAvC,UACE,eAACk3D,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAAC,GAAD,CAAkB3f,KAAMqc,EAAQ/Y,KAAMA,EAAMvI,SAAS,YAEvD,gBAAC8hE,GAAA,EAAD,CAAMl9C,MAAI,EAAC3hB,MAAO,CAACujC,SAAU,GAA7B,UACE,eAAC,GAAD,CAAY8rF,YAAW,OAAEhxG,QAAF,IAAEA,OAAF,EAAEA,EAAQgxG,YAAaxuF,SArD5BwuF,IACxBhtH,EAAIgC,KAAJ,mBAAqBqZ,EAArB,SAAsC,CAACqI,SAAU,CAACspG,YAAaA,KAC5DxrH,MAAK,IAAM8kB,MACX5kB,MAAM9F,EAFT,IAqDM,eAAC6zL,GAAD,CAAYC,UAAWr0K,EAAvB,SACE,gBAACpW,GAAA,EAAD,yBAAwBoW,UAG5B,eAACmhD,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,gBAACva,GAAA,EAAD,CAAKjG,QAAS,OAAd,UACE,eAAC,GAAD,CAAkBuc,SAAUA,IAC5B,eAACvd,GAAA,EAAD,CACEE,QAAS,IAAMo8L,GAAyB,GACxC7pJ,UAAW5qB,GAAYF,EACvB,cAAY,sBAHd,SAKE,eAACkV,GAAA,EAAD,CAASD,MAAM,sBAAf,SACE,eAAC,KAAD,QAGJ,eAAC,GAAD,CAAmBp9B,KAAM68L,EAAuBjgK,QAASkgK,IACzD,eAAC,GAAD,CACE57K,UAAW1gB,KAAYtD,QAAQ,iBAC/BtF,IAAG,kBAAammB,EAAb,uBACH,cAAY,yBAHd,SAKE,eAAC,KAAD,MAEF,eAACvd,GAAA,EAAD,CAAYE,QA3DD,KACnBsoB,GAAsB,EA0Dd,SACE,eAACqU,GAAA,EAAD,CAASD,MAAM,SAAf,SACE,eAAC,KAAD,QAGJ,eAAC58B,GAAA,EAAD,CAAYyyC,SAAU0oJ,IAAgBtzK,EAAU3nB,QA5DlC,KACtBgC,EAAIgC,KAAJ,mBAAqBqZ,EAArB,oBACG7Z,MAAKoB,GAAWwjB,EAAa,CAACpK,OAAQpZ,EAAQjD,SAC9C+B,MAAM9F,EAFT,EA2DkF,cAAY,0BAAtF,SACE,eAAC++B,GAAA,EAAD,CAASD,MAAM,YAAf,SACE,eAAC,KAAD,QAGJ,eAAC,GAAD,CAAuB1B,SAAS,KAAKs4B,WAAS,EAA9C,SACE,eAAC8jD,GAAD,IAAmBjwF,MAErB,eAAC,GAAD,CACE3qB,QAAQ,gBACR+1C,SAAU0oJ,IAAgBrzK,EAC1B,cAAY,uBACZwpG,QAAS,CAACpzG,GACVgzK,UAnES,KACnBhvL,EAAIyC,OAAJ,mBAAuB4Y,IACpB7Z,MAAKoB,GAAWwjB,EAAa,CAACpK,OAAQpZ,EAAQjD,SAC9C+B,MAAM9F,EAFT,YAuEG6kH,GACC,eAAC17G,GAAA,EAAD,CAAK+B,WAAY,EAAGqwB,UAAW,EAAGM,aAAc,EAAGlyB,YAAa,EAAhE,SACE,gBAACw6F,GAAA,EAAD,CAAWmnB,iBAAe,EAA1B,UACE,eAAClnB,GAAA,EAAD,CAAkBC,WAAY,eAAC,KAAD,IAA9B,uBAGA,eAACC,GAAA,EAAD,UACE,eAAC,GAAD,UAAWugB,WAKnB,gBAAC+5E,GAAA,EAAD,CAASz9L,QAAS,CAACnC,KAAMmC,EAAQy8L,SAAUj6D,YAAY,WAAvD,UACE,gBAACk7D,GAAA,EAAD,CAAM/kL,UAAQ,EAACmpB,QAAQ,EAAvB,UACE,eAAC67J,GAAA,EAAD,4CACA,gBAACC,GAAA,EAAD,WACG1B,GAAe,eAACh0L,GAAA,EAAD,CAAYxH,UAAWV,EAAQ08L,YAA/B,iFAGdR,GAAesB,GAAmB50K,GAClC,gBAAC,IAAM7gB,SAAP,WACE,gBAACG,GAAA,EAAD,CAAYxH,UAAWV,EAAQ08L,YAA/B,qJAE2B,eAACG,GAAD,8BAF3B,gBAG0C,eAACD,GAAD,8BAH1C,4HAK+D,eAACE,GAAD,sBAL/D,OAOA,gBAAC90L,GAAA,EAAD,CAAKjG,QAAQ,OAAO09B,cAAc,MAAlC,UACE,eAACz3B,GAAA,EAAD,CAAKm8B,SAAU,EAAf,SACE,eAACk3J,GAAD,CACE36L,UAAWV,EAAQ08L,YACnB17L,KAAK,QACLuzD,WAAS,EAACwwC,OAAQ8B,EAClBrzD,SAAU9qB,MAGd,eAAC1gB,GAAA,EAAD,CAAK+B,WAAY,EAAjB,SACE,eAAC,GAAD,CACE/I,KAAK,QACLwyC,SAAU9qB,EACV9e,QAAQ,YACR/I,MAAM,UAJR,wCAYR,sBAAKH,UAAWV,EAAQ08L,YAAxB,SACE,eAAChD,GAAD,CAAap7K,SAAUA,EAAUk1B,SAAU9qB,GAAgBs0K,YAIjE,gBAACU,GAAA,EAAD,CAAM/kL,UAAWwL,EAAS2d,QAAQ,EAAlC,UACE,eAAC67J,GAAA,EAAD,2BACA,gBAACC,GAAA,EAAD,WACE,eAAC,GAAD,CAAkBh7L,KAAMwlB,EAAQ3lB,WAChC,eAAC43L,GAAD,CACEz3L,KAAMzJ,EAAQxM,KAAImsB,IAAK,IAASA,EAAMixK,kBAAmBjxK,MACzDuP,WAAY0V,GAAkB1V,EAAD,UAAaD,EAAQ3lB,gBAArB,aAAa,EAAkB4lB,YAC5DiyK,YAAY,QACZt7J,oBAAqB6+J,GAAiBx0K,EAAa,CAAChB,WAAYw1K,YAGpEL,GAAmB50K,GAAa,gBAAC80K,GAAA,EAAD,CAAM/kL,UAAQ,EAACmpB,QAAQ,EAAvB,UAChC,eAAC67J,GAAA,EAAD,yCACA,gBAACC,GAAA,EAAD,WACE,eAACjpJ,GAAA,EAAD,CACE,cAAY,+BACZzgD,MAAM,2HACN0gD,QACE,eAACtT,GAAA,EAAD,CACEE,QAASzY,EACTyqB,SAAUv0B,EAAOgpB,cAAgBvf,EACjC+Y,SAAU67J,MAIhB,eAACp1L,GAAA,EAAD,CAAYxH,UAAWV,EAAQ08L,YAA/B,kGAGA,gBAAC5yL,GAAA,EAAD,CACE7I,QAAS,IAAMo8L,GAAyB,GACxCzzL,QAAQ,YACR/I,MAAM,UACN2yC,SAAU9qB,EAJZ,UAME,eAAC,KAAD,CAAahoB,UAAWV,EAAQ28L,kBANlC,gCAUFa,GAAmB50K,GAAa,gBAAC80K,GAAA,EAAD,CAAM/kL,UAAWwL,EAAS2d,QAAQ,EAAlC,UAChC,eAAC67J,GAAA,EAAD,4BACA,gBAACC,GAAA,EAAD,WACE,gBAAC11L,GAAA,EAAD,CAAYxH,UAAWV,EAAQ08L,YAA/B,gEACqD,0CADrD,IAEE,4CAFF,qDAGE,0CAHF,yBAKA,eAACx0L,GAAA,EAAD,CAAYxH,UAAWV,EAAQ08L,YAA/B,kHAIEv4K,GAAW,eAAC,GAAD,CAAoBqnK,gBAAiB,CAAC,UAAavsK,EAAOkN,mBAGzEqxK,GAAmB50K,GAAa,gBAAC80K,GAAA,EAAD,CAAM/kL,UAAWwL,EAAS2d,QAAQ,EAAlC,UAChC,eAAC67J,GAAA,EAAD,sBACA,gBAACC,GAAA,EAAD,WACG1B,GAAe,eAACh0L,GAAA,EAAD,CAAYxH,UAAWV,EAAQ08L,YAA/B,SACP,OAANz9K,QAAM,IAANA,KAAQgpB,aAAR,+EAAwFhpB,QAAxF,IAAwFA,OAAxF,EAAwFA,EAAQ48K,eAAhG,wBAA8H1gL,GAAe,OAAC8D,QAAD,IAACA,OAAD,EAACA,EAAQ6+K,cAAtJ,kDAGD5B,GAAe,eAACR,GAAD,CACfz8K,OAAQA,EAAQ08K,UAAW4B,EAAex0K,gBAAiBA,IAE5DmzK,IAAW,OAAIj9K,QAAJ,IAAIA,OAAJ,EAAIA,EAAQgpB,gBAAsB,OAANhpB,QAAM,IAANA,OAAA,EAAAA,EAAQ48K,gBAAiB,GAC/D,eAAC/xL,GAAA,EAAD,CAAQ7I,QAAS,IAAMi8L,GAA4B,GAAOtzL,QAAQ,YAAY/I,MAAM,UAAU2yC,SAAU9qB,EAAxG,0BAGF,gBAAC4U,GAAA,EAAD,CACE/8B,KAAM08L,EACN,mBAAiB,2BAFnB,UAIE,eAACz/J,GAAA,EAAD,UACE,eAACwqE,GAAA,EAAD,CAAmBlsG,GAAG,2BAAtB,wFAIF,gBAAC2hC,GAAA,EAAD,WACE,eAAC3zB,GAAA,EAAD,CAAQ7I,QAAS,IAAMi8L,GAA4B,GAAQj1F,WAAS,EAApE,oBACA,eAACn+F,GAAA,EAAD,CAAQ7I,QA9NI,KACxBi8L,GAA4B,GAC5Bj6L,EAAIgC,KAAJ,mBAAqBqZ,EAArB,SAAsC,CAACqI,SAAU,CAACk1K,eAAgB,KAC/Dp3L,MAAK,IAAM8kB,MACX5kB,MAAM9F,EAFT,EA4NY,sCAKN2+L,GAAmB50K,GAAYztB,GAAU,gBAACuiM,GAAA,EAAD,CAAM/kL,UAAWwL,EAAS2d,QAAQ,EAAlC,UACzC,eAAC67J,GAAA,EAAD,uCACA,eAACC,GAAA,EAAD,UACE,eAAC3B,GAAD,CACEh9K,OAAQA,EACR08K,UAAW4B,EACXrB,YAAaA,EACbnzK,gBAAiBA,cAO9B,EC5nBM,MAAMkvF,GAAI,o1JA8E2B99G,EA9E3B,2CAqFjB,MAAM4jM,GAAyBx0L,cAAWnI,IAAK,CAC7CvD,KAAM,CACJw9B,MAAO,QAET2iK,iBAAkB,CAChBj8L,QAAS,OACT09B,cAAe,MACfl3B,WAAY,UAEd01L,cAAe,CACb95J,SAAU,EACV37B,YAAapH,EAAMkH,QAAQ,GAC3BiyB,SAAU,cAId,SAAS2jK,GAAT,GAA2C,IAAnB,eAACC,GAAiB,EACxC,MAAMn+L,EAAU+9L,KAEhB,OAAO,sBAAKr9L,UAAWV,EAAQnC,KAAxB,SACL,uBAAK6C,UAAWV,EAAQg+L,iBAAkBt6J,KAAK,kBAA/C,UACE,sBAAKhjC,UAAWV,EAAQi+L,cAAxB,SACE,eAAC,GAAD,iDAEME,EAAeC,eAFrB,iCAMF,eAAC,mBAAD,CAAiBptM,KAAMmtM,EAAeC,eAAgBv3H,OAAQ,IAAM,KAApE,SACE,eAACjpC,GAAA,EAAD,CAASD,MAAM,4BAAf,SACE,eAAC58B,GAAA,EAAD,UACE,eAAC,KAAD,UAIN,eAAC68B,GAAA,EAAD,CAASD,MAAM,6BAAf,SACE,eAACb,GAAD,CAAYb,SAAS,KAAKe,QAAQ,6BAA6Bla,QAAO,sOAMhEq7K,EAAeE,wBANiD,yHAUlEF,EAAeG,mBAVmD,yPAiBlEH,EAAeI,oBAjBmD,2mBA6BlEJ,EAAeK,yBA7BmD,mOAqC7E,CAED,MAAMC,GAAgB//L,IAAMoI,MAAK,YAAgC,IAAT,KAAClE,GAAO,EAC9D,OAAO,eAACg7B,GAAA,EAAD,CAASD,MAAM,mBAAf,SACL,eAAC+gK,GAAD,CAAcj9K,UAAW1gB,KAAYud,SAAU1b,EAAKupB,UAApD,SACE,eAAC,KAAD,OAGL,IA4Nc1jB,I,MAAAA,OAnNR,WAAwB,IAAD,EAC5B,MAAM,IAACxF,EAAD,KAAMiD,GAAQyB,KACd/I,EAASoD,MACRomB,EAASoiC,GAActjD,mBAAS,MACjCtE,EAAO0E,mBAAQ,WAAM8gB,QAAN,IAAMA,OAAN,EAAMA,EAAS3lB,UAAU,CAAC2lB,KACxC8mG,EAAaC,GAAkBjoH,mBAAS,OACxCi3L,EAAgBQ,GAAqBz3L,mBAAS,OAC9CqH,EAAUN,GAAe/G,mBAAS,IAAIgE,KACvC0zL,EAAa53K,kBAAQ,IACpBqB,EAAYqiC,GAAiBxjD,mBAAS,CAC3CX,UAAW,GACX+hB,KAAM,EACNE,SAAU,qBACVD,MAAO,SAEHo3B,EAAUW,cAEVgkD,EAAYz2F,uBAAY,KAC5B,MAAM,UAACtH,EAAD,KAAY+hB,EAAZ,SAAkBE,EAAlB,MAA4BD,GAASF,EACrClwB,EAAG,6BAAyBoO,EAAzB,iBAA2C+hB,EAA3C,qBAA0E,cAAbE,EAA2B,eAAiBA,EAAzG,kBAA4HD,GACrItlB,EAAIQ,IAAItL,EAAK,KAAM,CAACqN,eAAe,IAChCf,MAAK4tH,IACJ7nE,EAAW6nE,GAEiB,IADPA,EAAQ5vH,SAASG,KAAKpJ,QAAOylB,GAAsC,mBAAtB,OAANA,QAAM,IAANA,OAAA,EAAAA,EAAQ4K,mBAAmE,aAArB,OAAN5K,QAAM,IAANA,OAAA,EAAAA,EAAQkmB,iBAA2D,aAArB,OAANlmB,QAAM,IAANA,OAAA,EAAAA,EAAQkmB,mBAC3In2C,SACa,IAAxB4vM,EAAW1nL,SACb2nL,cAAcD,EAAW1nL,SAE3B0nL,EAAW1nL,SAAW,IAEM,IAAxB0nL,EAAW1nL,UACb0nL,EAAW1nL,QAAU4nL,YAAYx6F,EAAW,KAE/C,IAEF3/F,MAAM/F,EAAOC,YAChBoE,EAAIQ,IAAJ,iFAAgG,cAAb+kB,EAA2B,eAAiBA,EAA/H,kBAAkJD,IAC/I9jB,MAAKhC,IACJ0sH,EAAe1sH,EAAf,IAEDkC,MAAM/F,EAAOC,WAJhB,GAKC,CAACwpB,EAAYmiC,EAAY2kE,EAAgBvwH,EAAQqE,IASpDmE,qBAAU,KACRk9F,IACO,MACuB,IAAxBs6F,EAAW1nL,SAAgB2nL,cAAcD,EAAW1nL,SACxD0nL,EAAW1nL,SAAW,CAAtB,IAED,CAACotF,EAAW3kD,IAEf,MAAMo/I,IAAa7vE,MACdA,EAAY7mG,YAAa6mG,EAAY7mG,WAAW2V,OAASnjC,GAG9DuM,qBAAU,KACRnE,EAAIQ,IAAI,6BACLgB,KAAKk6L,GACLh6L,MAAM/F,EAAOC,WAFhB,GAGC,CAACoE,EAAKrE,EAAQ+/L,IAEjB,MAAMK,EAAkB13L,mBAAQ,iBAAmB,QAAbiH,EAClC2gH,EAAYtsH,KADsB,OAElCA,QAFkC,IAElCA,GAFkC,UAElCA,EAAMA,YAF4B,aAElC,EAAYpJ,QAAOylB,GAAU1Q,EAASpD,IAAI8T,EAAOkN,YAFrB,GAG7B,CAACvpB,EAAM2L,EAAU2gH,IAGd+vE,EAAwB33L,mBAAQ,KACpC,MAAM3a,EAAM,IAAI++H,IAMhB,OALI9oH,GAAQsD,GACVtD,EAAKA,KAAKjI,SAAS6Z,IACjB7nB,EAAI6nB,EAAE2X,WAAa3X,EAAEyV,cAAgB/jB,EAAK8jB,GAA1C,IAGGr9B,CAAP,GACC,CAACiW,EAAMsD,IAGJg5L,EAAsB53L,mBAAQ,IACjB,QAAbiH,GAAsB3L,EACjBA,EAAKA,KAAKhR,MAAK,QAAC,UAACu6B,GAAF,SAAkB8yK,EAAsB9yK,EAAxC,IAEf52B,MAAMm6D,KAAKnhD,GAAU3c,MAAMkK,IAAQmjM,EAAsBnjM,MAEjE,CAAC8G,EAAM2L,EAAU0wL,IAEdE,EAAgBtxL,uBAAY,KAChC,MAAM6pL,EAAWsH,EAAgBryM,KAAIsyB,GAAUhc,EAAIyC,OAAJ,kBAAsBuZ,EAAOkN,cAC5E,OAAO9nB,QAAQ+6L,WAAW1H,EAA1B,GACC,CAACsH,EAAiB/7L,IAEfo8L,EAAwBxxL,uBAAY,KACxCsxL,IAAgB16L,MAAK66L,IACnBA,EAAU3kM,SAAS8H,IACO,cAApBA,EAASnD,SAEkB,aAApBmD,EAASnD,OAClBV,EAAOC,WAAW,IAAIvP,MAAMmT,EAASqxD,OAAOv0D,aAE5CX,EAAOC,WAAW,IAAIvP,MAAM,sBAC7B,IAEH2e,EAAY,IAAI/C,IAAI,KACpBo5F,GAAW,GAXb,GAaC,CAAC66F,EAAevgM,EAAQ0lG,IAGrBlmE,EAAU92B,mBAAQ,KACtB,MAAM82B,EAAU,CACd,CACEnlC,IAAK,qBACL6G,OAAQmf,GAAU9D,GAAgB8D,EAAOyjC,qBAE3C,CAACzpD,IAAK,eACN,CACEA,IAAK,YACL6G,OAAQmf,GAAU,eAAC,GAAD,CAAUxY,SAAU,YAAawhE,SAAO,EAAC5qB,QAAM,EAAC6qB,eAAa,EAACtlE,KAAMqc,KAExF,CAAChmB,IAAK,sBAAuB/E,MAAO,UACpC,CAAC+E,IAAK,UAAW6G,OAAQmf,GAAUA,EAAO9lB,QAASwlC,MAAO,UAC1D,CAAC1lC,IAAK,YAAa6G,OAAQmf,GAAU,eAAC,GAAD,CAAkBrc,KAAMqc,EAAQ/Y,KAAMA,IAAUy4B,MAAO,WAG9F,OADAR,GAAkBC,EAAS,CAACO,MAAO,QAAS+L,IACrCtM,CAAP,GACC,CAACl4B,IAEJ,OACE,gBAACq8F,GAAD,CAAM/wD,UAAW5uC,GAAQu7L,GAAzB,UACE,eAACn2L,GAAA,EAAD,CAAK0yB,aAAc,EAAnB,SACE,eAACxyB,GAAA,EAAD,sFAIF,gBAACF,GAAA,EAAD,CAAKO,WAAW,SAAS3H,MAAO,CAACmB,QAAS,QAA1C,UACE,eAACovL,GAAD,CAAiBtwL,MAAM,UAAU2yC,SAAUurJ,IAC3C,eAAC72L,GAAA,EAAD,CAAYrH,MAAM,UAAUD,MAAO,CAACyH,QAAS,QAA7C,gBACA,eAACwpL,GAAD,CAAqBhxL,MAAM,UAAU2yC,SAAUurJ,IAC/C,eAAC/2L,GAAA,EAAD,CAAKjG,QAAQ,eAAegI,WAAY,EAAxC,SACGg1L,GAAc,eAAC72L,GAAA,EAAD,CAAYrH,MAAM,QAAQ6iC,KAAK,sCAA/B,0EAKnB,eAAC17B,GAAA,EAAD,CAAKoyB,UAAW,EAAhB,SACE,eAAClyB,GAAA,EAAD,0FAIF,eAACF,GAAA,EAAD,UACGm2L,GAAkB,eAACD,GAAD,CAAgBC,eAAgBA,MAErD,eAACn2L,GAAA,EAAD,UACE,gBAACE,GAAA,EAAD,yCAC6B,eAAC20L,GAAD,8BAD7B,YACgG,eAACD,GAAD,8BADhG,WAII,OAAJh6L,QAAI,IAAJA,GAAA,UAAAA,EAAMylB,kBAAN,eAAkB2V,QAAS,GAAK,GAAK,gBAAC,IAAMj2B,SAAP,WACrC,eAACC,GAAA,EAAD,CAAKoyB,UAAW,EAAGM,aAAc,EAAjC,SACE,eAACopE,GAAA,EAAD,MAEF,eAACnM,GAAA,EAAD,UACE,gBAAC,GAAD,CACEv5D,QAASA,EAASyC,aAAczC,EAAQzxC,KAAI4xC,GAAUA,EAAOtlC,MAC7D6nC,eAAgB,CAAC,qBAAsB,cAAe,sBAAuB,aAC7El+B,KAAMA,EAAKA,MAAQ,GACnBylB,WAAY0V,GAAkB1V,EAAYzlB,EAAKylB,YAC/C2W,oBAAqB0rB,EACrBn8C,SAAUA,EACV60B,MAAOzpC,GAAUA,EAAOwyB,UACxByU,kBAAmB3yB,EARrB,UAUE,gBAAC,GAAD,CAAkB0vB,MAAM,wBAAxB,UACE,gBAAC,GAAD,WACE,eAAC,GAAD,CACEA,MAAM,qBACNlc,UAAW1gB,KACXE,QA7IK,KACnBqjG,GAAW,EAyIC,SAKE,eAAC,KAAD,MAEF,eAAC,GAAD,CAAuBroE,SAAS,KAAKs4B,WAAS,EAA9C,SACE,eAAC8jD,GAAD,IAAmBjwF,SAGvB,eAAC,GAAD,CAAyBud,WAAS,EAAlC,SACE,eAAC,GAAD,CACE+nJ,QAAM,EACNl6I,SAAU0rJ,EACV7sE,QAAS2sE,EACT/M,UAAWoN,SAIjB,eAAC,GAAD,CAAgB5+J,QAASg+J,GAAzB,SACE,eAAC,GAAD,gBAOb,IC1ZM,MAoDD78L,GAAUmL,oBAAS,OAAC3S,QAAD,IAACA,GAAD,WAACA,EAAIG,YAAL,mBAAC,GAAUlB,eAAX,cAAC,GAAmBF,SAC7CyI,GAAQgsH,gBAAgBn0H,aAAUlJ,EAElC,MAAMwwD,GAAuB,CAC3B,WAAc,QAkBDt4C,UAhBM/J,IAAMoI,MAAK,IACvB,eAAConD,GAAD,CACLpN,SAAQ,OAAEl/C,SAAF,IAAEA,QAAF,EAAEA,GAASk/C,SACnBK,kBAAiB,OAAEv/C,SAAF,IAAEA,QAAF,EAAEA,GAASymB,WAC5B24B,eAAc,OAAEp/C,SAAF,IAAEA,QAAF,EAAEA,GAASw8B,QACzB6iB,YAAW,OAAEr/C,SAAF,IAAEA,QAAF,EAAEA,GAASohD,KACtB9B,mBAAkB,OAAEt/C,SAAF,IAAEA,QAAF,EAAEA,GAASksH,aAC7Bp/E,eAAc,OAAE9sC,SAAF,IAAEA,QAAF,EAAEA,GAAS0sC,QACzByS,qBAAsBA,GACtBK,iBAAgB,OAAEx/C,SAAF,IAAEA,QAAF,EAAEA,GAASshD,UAC3B5B,sBAAqB,OAAE1/C,SAAF,IAAEA,QAAF,EAAEA,GAASgsH,gBAT3B,SAWL,eAAC,GAAD,QAI2C,qC,sDCpE/C,MAAMtkH,GAAYC,aAAW,CAC3B1L,KAAM,CACJwK,QAAS,KAIE,SAASk3L,KACtB,MAAMv/L,EAAUsJ,MACV,SAACzF,GAAYkD,gBACb,IAAC9D,GAAO0E,KACR/I,EAASoD,MAER/C,EAAO2zC,GAAY1rC,sBACnBozG,EAAWC,GAAgBrzG,mBAAS,IAAI8B,OACxC5E,EAAOo7L,GAAYt4L,qBAE1B,IAAIu4L,EAAUC,aAAQC,aAAW,IAAI32L,KAAQ3N,GAAuB,GAC/D6hH,aAAQuiF,KAAUA,OAAUlvM,GAEjC6W,qBAAU,KACJnI,GAAO2zC,OAASriD,GAEpB,MAAMqvM,EAAYC,aAASvlF,GACrBwlF,EAAaC,aAAYH,GAAaG,aAAY,IAAI/2L,MAC5D/F,EAAIQ,IAAJ,qCAAsCq8L,IACnCr7L,MAAMhC,IACL+8L,EAAS/8L,EAASu9L,UAAlB,IAEDr7L,OAAOspL,IAGN,GAFAuR,OAASjvM,GAEgB,MAArB09L,EAAU3uL,OAIZ,YAHyB,MAArB2uL,EAAU3uL,QACZV,EAAOC,WAAWovL,IAKtB,MAAMgS,EAAkBhS,EAAU1uL,WAAW,GAAGi4E,IAAI0oH,YAC9CC,EAAiBT,aAAQC,aAAW,IAAI32L,KAAQi3L,GAAkB,GACxErtJ,EAAS,gCAAyBx3B,aAAO+kL,EAAgB,cAAhD,mBACOC,aAAoBD,GAD3B,MAAT,GAhBJ,GAmBC,CAAC7lF,EAAWr3G,EAAKu8L,EAAUvgM,EAAOL,IAIrC,OACE,eAACwJ,GAAD,CAAepI,QAAS,CAACnC,KAAMmC,EAAQnC,MAAvC,SACE,gBAACmK,GAAA,EAAD,CAAKjG,QAAQ,OAAOq4B,UAAW,EAA/B,UACE,eAACimK,GAAA,EAAD,CACEC,QAAM,EACNrhM,MAAOA,EACP41D,WAAY51D,EACZu0C,UAAW3vC,EAASwD,cACpBk5L,aAAW,EACXd,QAASA,EACTz+L,KAAK,QACL4I,QAAQ,SACRouC,aAAa,SACb9jD,MAAM,0BACNutC,SAhBiBp3C,GAASkwH,EAAalwH,GAiBvC+wB,OAAO,aACP/wB,MAAOiwH,IAET,eAACtyG,GAAA,EAAD,CAAK+B,WAAY,EAAjB,SACE,eAAC,mBAAD,CAAiB/Y,KAAMoT,EAAvB,SACE,eAACw5B,GAAA,EAAD,CAASD,MAAM,0BAAf,SACE,eAAC58B,GAAA,EAAD,CAAYyyC,UAAWpvC,EAAvB,SACE,eAAC,KAAD,gBAQf,CCpFD,MAAMkF,GAAYC,cAAWnI,IAAK,CAChCvD,KAAM,CACJwK,QAASjH,EAAMkH,QAAQ,GACvB2zB,SAAU,KACVh0B,OAAQ,OACRozB,MAAO,YCHX,MAAM/xB,GAAYC,cAAWnI,IAAK,CAChCvD,KAAM,CACJwK,QAASjH,EAAMkH,QAAQ,QCH3B,MAAMgB,GAAYC,cAAWnI,IAAK,CAChCvD,KAAM,CACJwK,QAASjH,EAAMkH,QAAQ,Q,UCEpB,MAOD1G,GAAUmL,oBAAS,OAAC3S,QAAD,IAACA,GAAD,WAACA,EAAIG,YAAL,mBAAC,GAAUlB,eAAX,cAAC,GAAmBF,SAC7CyI,GAAQgsH,gBAAgBn0H,aAAUlJ,EAElC,MAAM+Y,GAAYC,cAAWnI,IAAK,CAChCu4D,OAAQ,CACN53D,QAAS,OACT09B,cAAe,cA0DJ+gK,OAvDK9hM,IAAMoI,MAAK,IAAc,IAAD,MAAZ,MAACmZ,GAAW,EAC1C,MAAM9e,EAASmI,MACRw5C,EAAS29I,GAAcv5L,sBACxB,WAACrI,GAAcoD,qBAAWxD,KAC1B,IAACwE,GAAO0E,KAGR/C,EAAS,OAAGqb,QAAH,IAAGA,GAAH,UAAGA,EAAOvc,cAAV,aAAG,EAAekB,UAC3B87L,EAAgBp5L,mBAAQ,MAC5B,WAAc,MACd,sBAAuB1C,KACrB,CAACA,IAcL,OAXAwC,qBAAU,KACRnE,EAAI4/C,SAASj+C,GACVH,KAAKg8L,GACL97L,OAAM1F,IACLwhM,OAAWlwM,GACXsO,EAAWI,EAAX,GAJJ,GAMC,CAAC2F,EAAW3B,EAAKpE,IAIbikD,EACH,eAACoL,GAAD,CACApN,SAAQ,OAAEl/C,SAAF,IAAEA,QAAF,EAAEA,GAASk/C,SACnBK,kBAAiB,OAAEv/C,SAAF,IAAEA,QAAF,EAAEA,GAASymB,WAC5B24B,eAAc,OAAEp/C,SAAF,IAAEA,QAAF,EAAEA,GAASw8B,QACzB6iB,YAAW,OAAEr/C,SAAF,IAAEA,QAAF,EAAEA,GAASohD,KACtB9B,mBAAkB,OAAEt/C,SAAF,IAAEA,QAAF,EAAEA,GAASksH,aAC7Bp/E,eAAc,OAAE9sC,SAAF,IAAEA,QAAF,EAAEA,GAAS0sC,QACzByS,qBAAsB2/I,EACtBt/I,iBAAgB,OAAEx/C,SAAF,IAAEA,QAAF,EAAEA,GAASshD,UAC3B5B,sBAAqB,OAAE1/C,SAAF,IAAEA,QAAF,EAAEA,GAASgsH,gBAChC9xH,GAAG,iBAVH,SAYA,eAAC,GAAD,CAAY69D,OACV,uBAAKj5D,UAAWS,EAAOw4D,OAAvB,UACE,eAACzxD,GAAA,EAAD,CAAY0B,QAAQ,KAApB,SACGk5C,EAAQC,cAAiBD,EAAQ3+B,SAAW,iCAAoC,gBAEnF,gBAACjc,GAAA,EAAD,qBACU46C,EAAQqkB,IAAM,gDAAiB,eAACE,GAAD,CAAKF,IAAKrkB,EAAQqkB,SAAiB,aAKhF,IAxBJ,I,sBChCK,MAOD/oC,GAAU,CACd,CAACnlC,IAAK,gBACN,CACEA,IAAK,MACL/E,MAAO,kCACP4L,OAAQgjD,GACFA,EAAQqkB,IACH,eAAC,GAAD,CACL1gE,SAAU,eAAgBwhE,SAAO,EAAC5qB,QAAM,EAAC6qB,eAAa,EACtDtlE,KAAM,CAACigD,SAAUC,KAGd,MAGX,CACE7pD,IAAK,aACL6G,OAAQgjD,GAAW,eAAC,GAAD,CAAUr8C,SAAU,sBAAuBwhE,SAAO,EAAC5qB,QAAM,EAAC6qB,eAAa,EAACtlE,KAAM,CAACigD,SAAUC,MAE9G,CACE7pD,IAAK,sBACL/E,MAAO,cACP4L,OAAQgjD,GAAW3nC,GAAgB2nC,EAAQ69I,sBAE7C,CACE1nM,IAAK,wBACL/E,MAAO,cACP4L,OAAQgjD,GAAYA,EAAQ89I,sBAAwBzlL,GAAgB2nC,EAAQ89I,uBAAyB,KAIzGziK,GAAkBC,GAAS,CAACO,MAAO,SAEnC,MAAMkiK,GAAcniM,IAAMC,cAAc,CAAC,GAEnCmiM,GAAiBpiM,IAAMoI,MAAK,YAAqC,IAAT,KAAClE,GAAO,EACpE,MAAM,IAACK,GAAO0E,MACR,WAAC9I,GAAcmD,MACf,QAAC2vB,GAAW1vB,qBAAW4+L,KACtBE,EAAyBC,GAA8B95L,oBAAS,IAChE+5L,EAAsBC,GAA2Bh6L,oBAAS,GAE3D+kL,EAAep+K,uBAAY,KAC/BmzL,GAA2B,GAC3B/9L,EAAIyC,OAAJ,oBAAwB9C,EAAKmmE,aAC1BtkE,KAAKktB,GAAShtB,MAAM9F,EADvB,GAEC,CAACoE,EAAKpE,EAAY+D,EAAKmmE,WAAYp3C,EAASqvK,IAEzCG,EAAkBtzL,uBAAY,KAClCqzL,GAAwB,GACxBj+L,EAAIgC,KAAJ,oBAAsBrC,EAAKmmE,WAA3B,gBACGtkE,KAAKktB,GACLhtB,MAAM9F,EAFT,GAGC,CAACoE,EAAKpE,EAAY+D,EAAKmmE,WAAYp3C,EAASuvK,IAE/C,OAAO,gBAAC,IAAMn5L,SAAP,WACL,eAAC61B,GAAA,EAAD,CAASD,MAAM,eAAf,SACE,gCACE,eAAC58B,GAAA,EAAD,CAAYE,QAAS,IAAMigM,GAAwB,GAAO1tJ,WAAY5wC,EAAKukE,IAA3E,SACE,eAAC,KAAD,UAIN,eAACvpC,GAAA,EAAD,CAASD,MAAQ/6B,EAAKukE,IAAM,yEAA2E,qBAAvG,SACE,gCACE,eAACpmE,GAAA,EAAD,CAAYE,QAAS,IAAM+/L,GAA2B,GAAOxtJ,WAAY5wC,EAAKukE,IAAKvmE,MAAO,CAACw5D,cAAe,QAA1G,SACE,eAAC,KAAD,UAIN,eAACx8B,GAAA,EAAD,CAASD,MAAM,mBAAf,SACE,eAACyjK,GAAD,CAAe3/K,UAAW1gB,KAAY6D,UAAWhC,EAAKmmE,WAAtD,SACE,eAAC,KAAD,QAGJ,gBAACzrC,GAAA,EAAD,CACE/8B,KAAMwgM,EADR,UAGE,eAACvjK,GAAA,EAAD,UACE,eAACwqE,GAAA,EAAD,CAAmBlsG,GAAG,2BAAtB,wEAIF,gBAAC2hC,GAAA,EAAD,WACE,eAAC3zB,GAAA,EAAD,CAAQ7I,QAAS,IAAM+/L,GAA2B,GAAQ/4F,WAAS,EAAnE,oBACA,eAACn+F,GAAA,EAAD,CAAQ7I,QAASgrL,EAAjB,0BAGJ,gBAAC3uJ,GAAA,EAAD,CACE/8B,KAAM0gM,EACNphM,QAAS,IAAMqhM,GAAwB,GAFzC,UAIE,eAAC3jK,GAAA,EAAD,oDACA,eAACC,GAAA,EAAD,UACE,eAACwqE,GAAA,EAAD,sJAKF,gBAACvqE,GAAA,EAAD,WACE,eAAC3zB,GAAA,EAAD,CAAQ7I,QAAS,IAAMigM,GAAwB,GAAQj5F,WAAS,EAAhE,oBACA,eAACn+F,GAAA,EAAD,CAAQ7I,QAASkgM,EAAjB,gCAIP,IA0Dc14L,WArDf,WACE,MAAM,IAACxF,EAAD,KAAMiD,GAAQyB,KACd/I,EAASoD,MACRomB,EAASoiC,GAActjD,mBAAS,MACjCtE,EAAO0E,mBAAQ,WAAM8gB,QAAN,IAAMA,OAAN,EAAMA,EAAS3lB,UAAU,CAAC2lB,KACxCC,EAAYqiC,GAAiBxjD,mBAAS,CAC3CX,UAAW,GACX+hB,KAAM,EACNE,SAAU,sBACVD,MAAO,SAGH6zD,EAAOvuE,uBAAY,KACvB,IAAK3H,EACH,OAEF,MAAM,UAACK,EAAD,KAAY+hB,EAAZ,SAAkBE,EAAlB,MAA4BD,GAASF,EACrClwB,EAAG,+BAA2BoO,EAA3B,iBAA6C+hB,EAA7C,qBAA8DE,EAA9D,kBAAgFD,EAAhF,oBAAiGriB,EAAK8jB,KAC/G/mB,EAAIQ,IAAItL,EAAK,KAAM,CAACqN,eAAe,IAChCf,KAAK+lD,GACL7lD,MAAM/F,EAAOC,WAFhB,GAGC,CAACwpB,EAAYmiC,EAAY5rD,EAAQqE,EAAKiD,IAMzC,OAJAkB,qBAAU,KACRg1E,GAAM,GACL,CAACA,IAEG,eAACmmB,GAAD,CAAM/wD,SAAU5uC,EAAhB,SACL,eAACi+L,GAAY3gM,SAAb,CAAsB7V,MAAO,CAACsnC,QAASyqD,GAAvC,SACGx5E,GACC,eAAC+0F,GAAA,EAAD,UACE,gBAAC,GAAD,CACEv5D,QAASA,GAASijK,gBAAiBjjK,GAAQzxC,KAAI4xC,GAAUA,EAAOtlC,MAChE6nC,eAAgB,CAAC,sBAAuB,wBAAyB,gBACjEl+B,KAAMA,EAAKA,MAAQ,GACnBylB,WAAY0V,GAAkB1V,EAAYzlB,EAAKylB,YAC/C2W,oBAAqB0rB,EALvB,UAOE,eAAC,GAAD,CAAkB/sB,MAAM,gBAAxB,SACE,eAAC,GAAD,CAAuB1B,SAAS,KAAKs4B,WAAS,EAA9C,SACE,eAAC8jD,GAAD,IAAmBjwF,QAGvB,eAAC,GAAD,CAAgBqY,QAASqgK,GAAzB,SACE,eAAC,GAAD,cAOb,ICrLD,MAAMx3L,GAAYC,cAAWnI,IAAK,CAChCvD,KAAM,CACJwK,QAASjH,EAAMkH,QAAQ,QCE3B,MAAMg5L,GAAqBtyM,GAAWuG,MAAMm6D,KAAK,CAAC1gE,OAAQA,IAAS,CAAC83D,EAAG55D,KAAJ,CACjE4O,IAAK5O,EAAI,GAAG+Q,WAAY5T,MAAO6C,EAAI,MAG/BkxC,GAAU,CACd,CACEnlC,IAAK,KACLwlC,UAAU,EACVE,MAAO,QACP7+B,OAAQ8C,GAAQA,EAAK9G,IAEvB,CACE7C,IAAK,QACLwlC,UAAU,EACV3+B,OAAQ8C,GAAI,+BAA4BA,EAAKvY,MAAjC,OAIhB,SAASk3M,GAAT,GAAiC,IAAT,KAAC3+L,GAAO,EAC9B,OAAO,6CAAeA,EAAK9G,KAC5B,CAKD,SAAS0lM,GAAT,GAAiC,IAAT,KAAC5+L,GAAO,EAC9B,OAAO,eAAC,GAAD,CACL+6B,MAAM,gBAAgBlc,UAAW1gB,KACjCE,QAAS,IAAMzB,QAAQC,IAAR,iCAAsCmD,EAAK9G,GAA3C,MAFV,SAIL,eAAC,KAAD,KAEH,CAKD,SAAS2lM,KACP,MAAMC,EAAcp6L,mBAAQ,IAAMg6L,GAAkB,OAAO,KACpDj5K,EAAYqiC,GAAiBxjD,mBAAS,CAC3C82B,MAAO,KAAMz3B,UAAW,OAEnB3D,EAAMiyH,GAAW3tH,mBAAS,KAC1BqH,EAAUN,GAAe/G,mBAAS,IAAIgE,KAa7C,OAXA9D,qBAAU,KACRoV,GAAM,KAAK/X,MAAK,KACd,MAAMk9L,EAAwBz/K,SAASmG,EAAW4V,kBAAoB,GAAK5V,EAAW9hB,UACtFsuH,EAAQ6sE,EAAYzwM,MAAM,EAAG0wM,IAC7Bj3I,GAAcriC,IAAU,IACnBA,EACH6V,sBAAuByjK,EAAwBD,EAAY1yM,OAAS,KAAO0Q,OAAOiiM,MAFpF,GAHF,GAQC,CAACt5K,EAAW4V,iBAAkB5V,EAAW9hB,UAAWm7L,IAEhD,eAAC/pG,GAAA,EAAD,CAAO/2F,MAAO,CAAC06B,OAAQ,QAAvB,SACL,gBAAC,GAAD,CACE8C,QAASA,GAASx7B,KAAMA,EACxBylB,WAAYA,EAAY2W,oBAAqB0rB,EAC7Cn8C,SAAUA,EACV60B,MAAOzpC,GAAUA,EAAOmC,GACxB8kC,kBAAmB3yB,EALrB,UAOE,eAAC,GAAD,CAAkB0vB,MAAM,mBACxB,eAAC,GAAD,CACEuF,QAASq+J,GACT9gK,QAAS+gK,GAFX,SAIE,eAACxhK,GAAD,CAA2B4hK,eAAe,yCAIjD,CAED,SAASC,KACP,MAAMH,EAAcp6L,mBAAQ,IAAMg6L,GAAkB,OAAO,KACpDj5K,EAAYqiC,GAAiBxjD,mBAAS,CAC3C82B,MAAO,KAAMz3B,UAAW,MAEnB3D,EAAMiyH,GAAW3tH,mBAAS,KAC1BqH,EAAUN,GAAe/G,mBAAS,IAAIgE,KAa7C,OAXA9D,qBAAU,KACRoV,GAAM,KAAK/X,MAAK,KACd,MAAMk9L,EAAwBz/K,SAASmG,EAAW4V,kBAAoB,GAAK5V,EAAW9hB,UACtFsuH,EAAQ6sE,EAAYzwM,MAAM,EAAG0wM,IAC7Bj3I,GAAcriC,IAAU,IACnBA,EACH6V,sBAAuByjK,EAAwBD,EAAY1yM,OAAS,KAAO0Q,OAAOiiM,MAFpF,GAHF,GAQC,CAACt5K,EAAW4V,iBAAkB5V,EAAW9hB,UAAWm7L,IAEhD,eAAC/pG,GAAA,EAAD,UACL,gBAAC,GAAD,CACEv5D,QAASA,GAASx7B,KAAMA,EACxBylB,WAAYA,EAAY2W,oBAAqB0rB,EAC7Cn8C,SAAUA,EACV60B,MAAOzpC,GAAUA,EAAOmC,GACxB8kC,kBAAmB3yB,EALrB,UAOE,eAAC,GAAD,CAAkB0vB,MAAM,mBACxB,eAAC,GAAD,CACEuF,QAASq+J,GACT9gK,QAAS+gK,GAFX,SAIE,eAAC,GAAD,CAA6B3gM,MAAM,UAAnC,6BAMP,CAEM,SAASihM,KACd,MAAMJ,EAAcp6L,mBAAQ,IAAMg6L,GAAkB,KAAK,KAElD1+L,EAAMiyH,GAAW3tH,mBAAS,KAC1BmhB,EAAYqiC,GAAiBxjD,mBAAS,CAC3CX,UAAW,GAAI+hB,KAAM,EAAGE,SAAU,KAAMD,MAAO,MAAOyV,MAAO0jK,EAAY1yM,UAEpEuf,EAAUN,GAAe/G,mBAAS,IAAIgE,KAE7C9D,qBAAU,KACR,MAAM,UAACb,EAAD,KAAY+hB,EAAZ,MAAkB0V,EAAlB,MAAyBzV,EAAzB,SAAgCC,GAAYH,EAK5CzlB,EAAO,IAAI8+L,GAAah/K,MAJd,CAACvzB,EAAG2oB,KAClB,MAAMztB,EAAQuY,GAAQsf,SAASxiB,OAAOkD,EAAK4lB,KAC3C,OAAQn+B,EAAM8E,GAAK9E,EAAMytB,KAAiB,QAAVyQ,EAAkB,GAAK,EAAvD,IAGIz9B,EAAQyb,GAAa+hB,EAAO,GAE5Bt5B,EADMuX,EAAYzb,EACFkzC,EAASA,EAAQlzC,EAAQyb,EAC/CsuH,EAAQjyH,EAAK3R,MAAMnG,EAAOA,EAAQkE,GAAlC,GACC,CAACq5B,EAAYq5K,IAEhB,MAAOvuB,EAAKC,GAAUlsK,mBAAS,GAE/B,OAAO,gBAACc,GAAA,EAAD,CAAKszB,OAAO,OAAOv5B,QAAQ,OAAO09B,cAAc,SAAhD,UACL,gBAACm2I,GAAA,EAAD,CAAMvrL,MAAO8oL,EAAK1xI,SAAU,CAACpC,EAAO8zI,IAAQC,EAAOD,GAAnD,UACE,eAAC8C,GAAA,EAAD,CAAK/hL,MAAM,sBACX,eAAC+hL,GAAA,EAAD,CAAK/hL,MAAM,cACX,eAAC+hL,GAAA,EAAD,CAAK/hL,MAAM,UACX,eAAC+hL,GAAA,EAAD,CAAK/hL,MAAM,WACX,eAAC+hL,GAAA,EAAD,CAAK/hL,MAAM,iBAGb,gBAAC8T,GAAA,EAAD,CAAK+9B,KAAM,EAAX,UACE,eAACw8D,GAAD,CAAMH,cAAY,EAACgqB,OAAgB,IAAR+mD,EAA3B,SACE,eAACx7E,GAAA,EAAD,UACE,gBAAC,GAAD,CACEv5D,QAASA,GACTx7B,KAAMA,EACNylB,WAAYA,EACZ2W,oBAAqB0rB,EACrBn8C,SAAUA,EACV60B,MAAOzpC,GAAUA,EAAOmC,GACxB8kC,kBAAmB3yB,EAPrB,UASE,gBAAC,GAAD,CAAkB0vB,MAAM,iBAAxB,UACE,eAAC,GAAD,CAAyBgI,WAAS,EAAlC,SACE,eAAC5kC,GAAA,EAAD,CAAYE,QAAS,IAAMzB,QAAQC,IAAI,gCAAvC,SACE,eAAC,KAAD,QAGJ,eAAC,GAAD,UACE,eAACsB,GAAA,EAAD,CAAYE,QAAS,IAAMzB,QAAQC,IAAI,2BAAvC,SACE,eAAC,KAAD,WAIN,eAAC,GAAD,CAAgByjC,QAASq+J,GAAgB9gK,QAAS+gK,GAAlD,SACE,eAAC,GAAD,CAAyBziK,eAAgB,CAAC,EAAG,GAAI,GAAI,gBAM7D,eAACwjE,GAAD,CAAMH,cAAY,EAACgqB,OAAgB,IAAR+mD,EAA3B,SACE,eAACx7E,GAAA,EAAD,UACE,gBAAC,GAAD,CACEv5D,QAASA,GACTx7B,KAAMA,EACNylB,WAAYA,EACZ2W,oBAAqB0rB,EACrBn8C,SAAUA,EACV60B,MAAOzpC,GAAUA,EAAOmC,GACxB8kC,kBAAmB3yB,EAPrB,UASE,gBAAC,GAAD,CAAkB0vB,MAAM,iBAAxB,UACE,eAAC,GAAD,CAAyBgI,WAAS,EAAlC,SACE,eAAC5kC,GAAA,EAAD,CAAYE,QAAS,IAAMzB,QAAQC,IAAI,gCAAvC,SACE,eAAC,KAAD,QAGJ,eAAC,GAAD,UACE,eAACsB,GAAA,EAAD,CAAYE,QAAS,IAAMzB,QAAQC,IAAI,2BAAvC,SACE,eAAC,KAAD,WAIN,eAAC,GAAD,UACE,eAAC,GAAD,CAAyBs/B,eAAgB,CAAC,EAAG,GAAI,GAAI,gBAK7D,eAACwjE,GAAD,CAAMH,cAAY,EAACgqB,OAAgB,IAAR+mD,EAA3B,SACE,eAACx7E,GAAA,EAAD,UACE,eAAC,GAAD,CAAWv5D,QAASA,GAASx7B,KAAM8+L,QAGvC,eAACn/F,GAAD,CAAMH,cAAY,EAACC,eAAa,EAAC+pB,OAAgB,IAAR+mD,EAAzC,SACE,eAACsuB,GAAD,MAEF,eAACl/F,GAAD,CAAMH,cAAY,EAACC,eAAa,EAAC+pB,OAAgB,IAAR+mD,EAAzC,SACE,eAAC0uB,GAAD,WAIP,CCzNM,MAAME,GAAqBrjM,IAAMoI,MAAM7G,IAAW,IAAD,EACtD,MAAM,YAAC05G,EAAD,MAActvH,EAAd,SAAqBo3C,EAArB,SAA+B46E,EAA/B,SAAyCC,KAAa0lF,GAAe/hM,EACrEnH,EAASwgD,YAAewgE,IACxB5lH,EAAQsxB,GAAgBm0F,GAAa,EAAd,OAAoB7gH,QAApB,IAAoBA,OAApB,EAAoBA,EAAQihH,WAEnD,MAACvtG,GAASgC,KACVutG,EAAcz0G,mBAAQ,IAAMqyG,EAAYztH,MAAQ,IAAI+iB,GAAK0qG,EAAYztH,OAAO,CAACytH,IAC7E/tG,EAAYmwG,GAAeA,EAAYnwG,aACtC1f,EAAM6xH,GAAW72G,oBAAS,UAAAsF,EAAMZ,UAAN,eAAkBoJ,aAAc2kG,EAAYztH,MACvE+1M,EAAoB36L,mBAAQ,IACzBpb,EACH,IAAIqpB,GAAS8mG,EAAU1C,EAAYztH,MAAMuoB,GAAGvoB,GAAM7B,QAClDgyH,GACH,CAACA,EAAU1C,EAAaztH,IACrBg2M,EAAoB56L,mBAAQ,IACzBpb,EACH,IAAIqpB,GAAS+mG,EAAU3C,EAAYztH,MAAMuoB,GAAGvoB,GAAM7B,QAClDiyH,GACH,CAACA,EAAU3C,EAAaztH,IACrBi2M,EAAc76L,mBAAQ,IACnBpb,EACH,IAAIqpB,GAASlrB,GAAS,EAAGsvH,EAAYztH,MAAMuoB,GAAGvoB,GAAM7B,QACpDA,GAAS,GACZ,CAAC6B,EAAMytH,EAAatvH,IAEjB+3M,EAAoBv0L,uBAAY,CAACwxB,EAAOh1C,KAC5C,MAAMg4M,EAAiBn2M,EAAO,IAAIqpB,GAASlrB,EAAO6B,GAAMuoB,GAAGklG,EAAYztH,MAAM7B,QAAUA,EACnFo3C,GACFA,EAAS4gK,EACV,GACA,CAACn2M,EAAMu1C,EAAUk4E,IAEpB,OAAO,gBAACrhE,GAAA,EAAD,CAAaic,WAAS,EAAtB,UACL,eAACnZ,GAAA,EAAD,UAAYlnD,IACZ,gBAAC8T,GAAA,EAAD,CAAKjG,QAAQ,OAAOwG,WAAW,SAA/B,UACE,eAACyjI,GAAA,EAAD,CACE3hJ,MAAO83M,EACPtrM,IAAKorM,EACLz9J,IAAK09J,EACLzgK,SAAU2gK,EACVl2D,kBAAqBhgJ,EAAc,MAAP,QACxB81M,IAEL91M,GACC,eAAC+xH,GAAD,CAAYryG,UAAWA,EAAW1f,KAAMA,EAAMu1C,SAAUs8E,SAZ9D,IC7BIukF,GAAa,CACjB,mBAAoB,4BAA6B,oCAAqC,yDAA0D,eAChJ,wBAAyB,yBAA0B,4BAA6B,0BAA2B,kDAC3G,cAAe,sCAAuC,uBAAwB,0BAA2B,qBACzG,oBAAqB,mCAAoC,0CAA2C,qBAAsB,eAAgB,YAC1I,8BAA+B,gCAAiC,YAAa,kBAAmB,mDAChG,UAAW,sBAAuB,iBAAkB,WAAY,iBAAkB,mCAAoC,kBACtH,mBAAoB,6BAA8B,+CAAgD,qCAAsC,iCACxI,iDAAkD,oBAAqB,gBAAiB,eAAgB,cAAe,0BAA2B,kBAClJ,wBAAyB,eAAgB,mCAAoC,iBAAkB,yBAA0B,uBACzH,qBAAsB,gBAAiB,cAAe,cAAe,6BAA8B,oBAAqB,eAAgB,eAE1I,SAASC,GAAT,GAAoC,IAAnB,KAACzkL,EAAD,SAAO/d,GAAW,EACjC,OACE,gBAACiI,GAAA,EAAD,CAAKjG,QAAQ,OAAO09B,cAAc,MAAMl3B,WAAW,cAAcmyB,aAAc,EAA/E,UACE,eAAC1yB,GAAA,EAAD,CAAKqzB,MAAO,IAAK7yB,YAAa,EAA9B,SACGzI,IAEH,eAAC,GAAD,CACE+d,KAAMD,GAAYC,OAIzB,CAMM,SAAS0kL,KACd,MAAO,CAAEC,GAAav7L,mBAAS,GACzBw7L,EAAW17K,iBAAO,CAAC,GACnB27K,EAAa37K,iBAAO,CAAC,GAErB47K,EAAqB,CAACpwM,EAAMyN,KAC3ByiM,EAASxrL,QAAQ1kB,KACpBkwM,EAASxrL,QAAQ1kB,GAAQ,CACvBmnH,YAAa,CACXnnH,KAAMA,EACNo9B,eAAe,GAAD,OAAKp9B,EAAL,kBACdmQ,YAAY,+DAGR1C,GAAS,CAAC,GAEhBwhC,SAAUp3C,IACRs4M,EAAWzrL,QAAQ1kB,GAAQnI,EAC3Bo4M,GAAUp4M,GAASA,EAAQ,GAA3B,IAIC,IACDq4M,EAASxrL,QAAQ1kB,GACrBnI,MAAOs4M,EAAWzrL,QAAQ1kB,KAIxBvI,EAAQ,CACZ8xB,UAAW,SACXD,UAAW,SAGP+mL,EAAM,CACV9mL,UAAW,SACXD,UAAW,OAQb,OAAO,eAAC9T,GAAA,EAAD,CAAKC,OAAQ,EAAb,SACL,gBAACw3D,GAAA,EAAD,CAAMG,WAAS,EAAC79B,UAAU,MAAMz5B,QAAS,EAAzC,UACE,eAACm3D,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACm9C,GAAA,EAAD,UACE,eAACC,GAAA,EAAD,UACE,eAAC33D,GAAA,EAAD,CAAKqzB,MAAO,KAAZ,SACE,gBAACokC,GAAA,EAAD,CAAMG,WAAS,EAAC79B,UAAU,SAASz5B,QAAS,EAA5C,UACE,eAACm3D,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACggL,GAAD,CACEzkL,KAAI,iMADN,SAQE,eAAC49F,GAAD,IAAwBknF,EAAmB,gBAG/C,eAACnjI,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACggL,GAAD,CACEzkL,KAAI,gMADN,SAQE,eAAC+9F,GAAD,IAAqB+mF,EAAmB,aAG5C,eAACnjI,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACggL,GAAD,CACEzkL,KAAI,oMADN,SAQE,eAAC2/F,GAAD,IAAwBmlF,EAAmB,QAAS,CAACnyM,KAAMxG,UAG/D,eAACw1E,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACggL,GAAD,CACEzkL,KAAI,iSADN,SAUE,eAAC2/F,GAAD,IAAwBmlF,EAAmB,aAAc,CAACnyM,KAAMxG,EAAOiC,KAAM,SAAU05B,cAAe,CAACC,IAAK,CAAC,CAACm2F,mBAAoB,gBAGtI,eAACv8C,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACggL,GAAD,CACEzkL,KAAI,wSADN,SAUE,eAAC2/F,GAAD,IAAwBmlF,EAAmB,qBAAsB,CAACnyM,KAAMxG,EAAOiC,KAAM,QAAS05B,cAAe,CAACC,IAAK,CAAC,CAACm2F,mBAAoB,gBAG7I,eAACv8C,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACggL,GAAD,CACEzkL,KAAI,iVADN,SAUE,eAAC2/F,GAAD,IAAwBmlF,EAAmB,qBAAsB,CAACnyM,KAAMxG,EAAOiC,KAAM,4BAA6B05B,cAAe,CAACC,IAAK,CAAC,CAACm2F,mBAAoB,qCAGjK,eAACv8C,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACggL,GAAD,CACEzkL,KAAI,kUADN,SAWE,eAAC2/F,GAAD,IACMmlF,EAAmB,oBAAqB,CAACnyM,KAAMxG,EAAOiC,KAAM,UAChEmwH,SAAU,EAAGC,SAAU,SAI7B,eAAC78C,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACggL,GAAD,CACEzkL,KAAI,2LADN,SAQE,eAAC2/F,GAAD,IAAwBmlF,EAAmB,MAAO,CAACnyM,KAAMoyM,UAG7D,eAACpjI,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACggL,GAAD,CACEzkL,KAAI,sRADN,SAUE,eAAC2/F,GAAD,IACMmlF,EAAmB,kBAAmB,CAACnyM,KAAMoyM,IACjDxmF,SAAU,EAAGC,SAAU,SAI7B,eAAC78C,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACggL,GAAD,CACEzkL,KAAI,2LADN,SAQE,eAAC,GAAD,IAAsB8kL,EAAmB,cAG7C,eAACnjI,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACggL,GAAD,CACEzkL,KAAI,kXADN,SAYE,eAAC,GAAD,IAAsB8kL,EAAmB,oBACvBjkF,cAAe,CAACr1E,KAAM,KAAMC,MAAO,MAAOh5C,UAAW,mBAG3E,eAACkvE,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACggL,GAAD,CACEzkL,KAAI,mXADN,SAaE,eAAC66G,GAAD,IAA2BiqE,EAAmB,aAAc,CAC1DnyM,KAAM,CACJqrB,UAAW,CAAC,MAAO,MAAO,kBAKlC,eAAC2jD,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACggL,GAAD,CACEzkL,KAAI,+WADN,SAaE,eAACygG,GAAD,IAAsBqkF,EAAmB,cAAe,CACtDnyM,KAAM,CACJqrB,UAAW,CAAC,MAAO,MAAO,kBAKlC,eAAC2jD,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACggL,GAAD,CACEzkL,KAAI,6QADN,SASE,eAACygG,GAAD,IAAsBqkF,EAAmB,2BAA4BngL,YAAa,CAAC,MAAO,MAAO,eAGrG,eAACg9C,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACggL,GAAD,CACEzkL,KAAI,sVADN,SAYE,eAAC2gG,GAAD,IAA8BmkF,EAAmB,oBAAqB,CACpEnyM,KAAM,CACJqrB,UAAWwmL,YAKnB,eAAC7iI,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACggL,GAAD,CACEzkL,KAAI,8QADN,SAUE,eAACikL,GAAD,IAAwBa,EAAmB,UAAWvmF,SAAU,EAAGC,SAAU,SAGjF,eAAC78C,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACggL,GAAD,CACEzkL,KAAI,uNADN,SAQE,eAACs8F,GAAD,IAA0BwoF,EAAmB,mBAGjD,eAACnjI,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACggL,GAAD,CACEzkL,KAAI,8MADN,SAQE,eAAC+8F,GAAD,IAAsB+nF,EAAmB,cAG7C,eAACnjI,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACggL,GAAD,CACEzkL,KAAI,8MADN,SAQE,eAACg9F,GAAD,IAAsB8nF,EAAmB,cAG7C,eAACnjI,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACggL,GAAD,CACEzkL,KAAI,mMADN,SAQE,eAAC,GAAD,IAA0B8kL,EAAmB,mBAGjD,eAACnjI,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACggL,GAAD,CACEzkL,KAAI,gOADN,SASE,eAAC,GAAD,CACE2D,UAAWi6F,MACPknF,EAAmB,OAAQ,CAAC1qK,MAAO,CAAC,aAI9C,eAACunC,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACggL,GAAD,CACEzkL,KAAI,oOADN,SASE,eAAC,GAAD,CACE2D,UAAWi6F,MACPknF,EAAmB,aAAc,CAAC1qK,MAAO,CAAC,WAIpD,eAACunC,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACggL,GAAD,CACEzkL,KAAI,+LADN,SAQE,eAAC,GAAD,IAAwB8kL,EAAmB,OAAQ,CAACnyM,KAxVzD,CACXsrB,UAAW,OACXD,UAAW,gBAyVC,eAAC2jD,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACggL,GAAD,CACEzkL,KAAI,iMADN,SAQE,eAAC,GAAD,IAAwB8kL,EAAmB,gBAG/C,eAACnjI,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACggL,GAAD,CACEzkL,KAAI,8LADN,SAQE,eAAC,GAAD,IACM8kL,EAAmB,UAAW,CAACv4M,MAAO,CAAC,IAC3C28J,gBAAgB,mBAShC,eAACvnF,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACva,GAAA,EAAD,CAAKC,OAAQ,EAAb,SACE,eAACC,GAAA,EAAD,CAAYuZ,UAAU,MAAtB,SACG5rB,KAAKE,UAAU4sM,EAAWzrL,QAAS,KAAM,aAMrD,CC9bc4rL,OAnBSpkM,IAAMoI,MAAK,WACjC,MAAM,cAACyY,EAAD,SAAgBjB,EAAhB,MAA0Brf,EAA1B,UAAiCwpB,GAAay/F,KAEpD,OAAKz/F,EAME,eAAC85E,GAAD,UACL,eAAC,GAAD,CACEyB,UAAWjjF,GAAgBxB,EAAejB,EAAU,IACpD2lF,UAAU,mBARL,eAAC1B,GAAD,CAAMH,cAAY,EAAlB,SACHnjG,EAAQ,eAACiJ,GAAA,EAAD,UAAajJ,EAAMM,YAAcN,EAAMG,SAAW,mBAAiC,eAAC8I,GAAA,EAAD,2BAUlG,I,WClBD,MAAMoB,GAAYC,cAAWnI,IAAK,CAChCvD,KAAM,CACJw8B,SAAU,WACV+2B,KAAM,EACNxuB,MAAO,EACPxI,WAAY,GACZnyB,QAAS,GACTI,QAAS,GACTq6B,WAAY,GACZ+V,OAAQ,SA+BGsqJ,OA3BgBrkM,IAAMoI,MAAK,WACxC,MAAM,aAAC4hB,EAAD,OAAezJ,GAAUipG,KACzBloH,EAAUsJ,KAEhB,OAAK2V,EAKH,eAAC+jL,GAAA,EAAD,CAAOjhK,UAAU,OAAO+B,GAAIpb,EAAcu6K,cAAY,EAACj/J,eAAa,EAApE,SACE,eAAC2zD,GAAA,EAAD,CAAOj3F,UAAWV,EAAQnC,KAA1B,SACE,eAAC0kG,GAAD,CAAMH,cAAY,EAAlB,SACE,gBAAC3iC,GAAA,EAAD,CAAMG,WAAS,EAACt3D,QAAS,EAAGC,WAAW,SAAvC,UACE,eAACk3D,GAAA,EAAD,CAAMl9C,MAAI,EAAV,SACE,eAACud,GAAA,EAAD,MAEF,gBAAC2/B,GAAA,EAAD,CAAMl9C,MAAI,EAAC3hB,MAAO,CAACujC,SAAU,GAA7B,UACE,eAACj8B,GAAA,EAAD,uCACA,eAACA,GAAA,EAAD,UAAa+W,EAAOikL,kCAbvB,IAoBV,ICjCD,MAAMC,GAAa,CACjB3wM,KAAM,cACN4wM,aAAc,EAAE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MACtyBC,0BAA2B,CAAC,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,OAAQ,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,OAAQ,OAAQ,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,OAAQ,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,OAAQ,QAAS,QAAS,QAAS,QAAS,QAAS,OAAQ,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,OAAQ,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,OAAQ,OAAQ,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,SACvrCC,sBAAuB,CAAC,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,OAAQ,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,OAAQ,QAAS,QAAS,QAAS,QAAS,OAAQ,QAAS,MAAO,QAAS,OAAQ,OAAQ,QAAS,QAAS,QAAS,OAAQ,QAAS,QAAS,QAAS,OAAQ,OAAQ,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,OAAQ,QAAS,OAAQ,QAAS,QAAS,QAAS,QAAS,QAAS,OAAQ,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,OAAQ,QAAS,QAAS,QAAS,OAAQ,QAAS,QAAS,QAAS,QAAS,MAAO,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,OAAQ,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,SAC1qCC,iBAAkB,CAAC,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,IAAM,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,IAAM,KAAO,IAAM,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,IAAM,KAAO,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,IAAM,KAAO,IAAM,IAAM,IAAM,KAAO,IAAM,IAAM,KAAO,IAAM,IAAM,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,KAAO,IAAM,KAAM,KAAM,KAAM,KAAM,IAAM,KAAO,MAAS,MAAU,MAAU,MAAU,MAAU,MAAU,MAAU,MAAU,OAWx6BC,GAAiB,CACrBC,eAAgB,CAACN,GATM,CACvB3wM,KAAM,cACN4wM,aAAc,EAAE,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,GAAI,GAAI,GAAI,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MACtyBC,0BAA2B,CAAC,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,OAAQ,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,OAAQ,OAAQ,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,OAAQ,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,OAAQ,QAAS,QAAS,QAAS,QAAS,QAAS,OAAQ,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,OAAQ,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,OAAQ,OAAQ,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,QAAS,SACvrCC,sBAAuB,CAAC,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,QAAS,SAAU,OAAQ,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,QAAS,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,QAAS,SAAU,SAAU,SAAU,SAAU,SAAU,QAAS,SAAU,SAAU,SAAU,SAAU,QAAS,SAAU,OAAQ,SAAU,OAAQ,QAAS,SAAU,SAAU,SAAU,QAAS,SAAU,QAAS,SAAU,OAAQ,QAAS,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,QAAS,SAAU,SAAU,SAAU,SAAU,QAAS,SAAU,QAAS,SAAU,SAAU,SAAU,SAAU,SAAU,QAAS,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SAAU,SA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","file":"static/js/main.ae1b1138.chunk.js","sourcesContent":["'use strict';\n\n/* Rules taken from the technical specification for CIF 1.1 as seen at:\n\n    https://www.iucr.org/resources/cif/spec/version1.1/cifsyntax\n*/\n\n/* CIF format standard tokens in RegExp form\n\nThese Regular Expressions are meant to embody the standard syntax of CIF\nfiles as found at the URL above. However, they will not all be used in\npractice, as some needed features (especially the look-behind assertions) are\nrelatively new and may not be supported for all users.\n\n*/\n\n\nvar sp = ' ';\nvar ht = '\\\\t';\nvar eol = '\\\\r*\\\\n';\n\nmodule.exports.end_of_line = eol;\n\n/*\n\n<OrdinaryChar>:\n\n{ '!' | '%' | '&' | '(' | ')' | '*' | '+' | ',' | '-' | '.' | '/' | '0' | '1' \n| '2' | '3' | '4' | '5' | '6' | '7' | '8' | '9' | ':' | '<' | '=' | '>' | '?' \n| '@' | 'A' | 'B' | 'C' | 'D' | 'E' | 'F' | 'G' | 'H' | 'I' | 'J' | 'K' | 'L' \n| 'M' | 'N' | 'O' | 'P' | 'Q' | 'R' | 'S' | 'T' | 'U' | 'V' | 'W' | 'X' | 'Y' \n| 'Z' | '\\' | '^' | '`' | 'a' | 'b' | 'c' | 'd' | 'e' | 'f' | 'g' | 'h' | 'i' \n| 'j' | 'k' | 'l' | 'm' | 'n' | 'o' | 'p' | 'q' | 'r' | 's' | 't' | 'u' | 'v' \n| 'w' | 'x' | 'y' | 'z' | '{' | '|' | '}' | '~' }\n */\nvar ordinary_char = \"a-zA-Z0-9!%&\\(\\)*+,\\-.\\\\/:<=>\\?@\\\\^`\\{\\\\}~\";\nmodule.exports.ordinary_char = \"[\" + ordinary_char + \"]\";\n/*\n\n<NonBlankChar>:\n\n<OrdinaryChar> | <double_quote> | '#' | '$' | <single_quote> | '_' |';' | '[' \n| ']' \n */\nvar nonblank_char = ordinary_char + \"\\\"#$'_;\\\\[\\\\]\";\nmodule.exports.nonblank_char = \"[\" + nonblank_char + \"]\";\n// These variations are useful for strings with quotes\nvar nonblank_char_nosingle = ordinary_char + \"\\\"#$_;\\\\[\\\\]\";\nvar nonblank_char_nodouble = ordinary_char + \"#$'_;\\\\[\\\\]\";\n/*\n\n<TextLeadChar>:\n\n<OrdinaryChar> | <double_quote> | '#' | '$' | <single_quote> | '_' | <SP> | \n<HT> |'[' | ']' \n */\nvar textlead_char = ordinary_char + \"\\\"#$'_\\\\[\\\\]\" + sp + ht;\nmodule.exports.textlead_char = \"[\" + textlead_char + \"]\";\n/*\n\n<AnyPrintChar>:\n\n<OrdinaryChar> | <double_quote> | '#' | '$' | <single_quote> | '_' | <SP> |\n<HT> | ';' | '[' | ']'  \n */\nvar anyprint_char = nonblank_char + sp + ht;\nmodule.exports.anyprint_char = \"[\" + anyprint_char + \"]\";\n/*\n\n<Digit>\n\n{ '0' | '1' | '2' | '3' | '4' | '5' | '6' | '7' | '8' | '9' }\n */\nvar digit = '0-9';\nmodule.exports.digit = \"[\" + digit + \"]\";\n/*\n\n<Comments>\n\n{ '#' {<AnyPrintChar>}* <eol>}+ \n */\nvar comments = \"(?:#[\" + anyprint_char + \"]*\" + eol + \")+\";\nmodule.exports.comments = comments;\n/*\n\n<TokenizedComments>\n\n{ <SP> | <HT> | <eol> |}+ <Comments>    \n */\nvar tok_comments = \"[\" + sp + ht + eol + \"]+\" + comments;\nmodule.exports.tok_comments = tok_comments;\n/*\n\n<WhiteSpace>\n\n{ <SP> | <HT> | <eol> | <TokenizedComments>}+   \n */\nvar whitespace = \"(?:\" + tok_comments + \"|\" + sp + \"|\" + ht + \"|\" + eol +\n    \")+\";\nmodule.exports.whitespace = whitespace;\n/*\n\n<SemiColonTextField>\n\n';' { {<AnyPrintChar>}* <eol>\n{{<TextLeadChar> {<AnyPrintChar>}*}? <eol>}*\n} ';'\n */\nvar semicolontext = \";[\" + anyprint_char + \"]*\" + eol +\n    \"(?:(?:[\" + textlead_char + \"][\" + anyprint_char + \"]*)?\" + eol + \")*;\";\nmodule.exports.semicolontext = semicolontext;\n/*\n\n<SingleQuotedString>\n\n<single_quote>{<AnyPrintChar>}* <single_quote>\n */\nvar squotestring = \"'[\" + nonblank_char_nosingle + sp + ht + \"]*'\";\nmodule.exports.squotestring = squotestring;\n/*\n\n<DoubleQuotedString>\n\n<double_quote>{<AnyPrintChar>}* <double_quote>\n */\nvar dquotestring = '\"[' + nonblank_char_nodouble + sp + ht + ']*\"';\nmodule.exports.dquotestring = dquotestring;\n/* \n\n<UnquotedString>\n\n<eol><OrdinaryChar> {<NonBlankChar>}*   \nor \n<eol><OrdinaryChar> {<NonBlankChar>}*   \n<noteol>{<OrdinaryChar>|';'} {<NonBlankChar>}\n\nNOTE: this is troublesome because in theory it requires lookbehinds.\nWe will try not to use it in practice. This is an approximation\n**/\nvar uquotestring = \"[\" + eol + sp + ht + \"][\" + ordinary_char + \"][\" +\n    nonblank_char + \"]*\";\nmodule.exports.uquotestring = uquotestring;\n/*\n\n<QuotedString> \n\n<SingleQuotedString> | <DoubleQuotedString>\n*/\nvar quotestring = \"(?:\" + squotestring + \"|\" + dquotestring + \")\";\nmodule.exports.quotestring = quotestring;\n/*\n\n<CharString>\n\n<UnquotedString> | <SingleQuotedString> | <DoubleQuotedString>  \n */\nvar chrstring = \"(?:\" + squotestring + \"|\" + dquotestring + \"|\" +\n    uquotestring + \")\";\nmodule.exports.chrstring = chrstring;\n/*\n\n<UnsignedInteger>\n\n{ <Digit> }+\n */\nvar unsigned_int = \"[\" + digit + \"]+\";\nmodule.exports.unsigned_int = unsigned_int;\n/*\n\n<Integer>\n\n{ '+' | '-' }? <UnsignedInteger>\n */\nvar integer = \"[+\\-]?\" + unsigned_int;\nmodule.exports.integer = integer;\n/*\n\n<Exponent>\n\n{ {'e' | 'E' } | {'e' | 'E' } { '+' | '- ' } } <UnsignedInteger>\n */\nvar exponent = \"[eE]\" + integer;\nmodule.exports.exponent = exponent;\n/*\n\n<Float>\n\n{ <Integer><Exponent> | { {'+'|'-'} ? { {<Digit>} * '.' <UnsignedInteger> } |\n{ <Digit>} + '.' } } {<Exponent>} ? } }\n */\nvar float = \"(?:(?:[+\\-]?(?:[\" + digit + \"]*\\\\.\" + unsigned_int +\n    \"|[\" + digit + \"]+\\\\.)(?:\" + exponent + \")?)|(?:\" + integer +\n    exponent + \"))\";\nmodule.exports.float = float;\n/*\n\n<Number>\n\n{<Integer> | <Float> }\n */\nvar number = \"(?:\" + float + \"|\" + integer + \")\";\nmodule.exports.number = number;\n/*\n\n<Numeric>\n\n{ <Number> | <Number> '(' <UnsignedInteger> ')' }\n */\nvar numeric = \"(?:(\" + number + \")\\\\((\" + unsigned_int + \")\\\\)|(\" + number +\n    \"))\";\nmodule.exports.numeric = numeric;\n/*\n\n<Tag>\n\n'_'{ <NonBlankChar>}+\n */\nvar tag = \"_[\" + nonblank_char + \"]+\";\nmodule.exports.tag = tag;\n/*\n\n<Value> \n\n{ '.' | '?' | <Numeric> | <CharString> | <TextField> }\n */\nvar value = \"(\\\\.|\\\\?|\" + numeric + \"|\" + chrstring + \"|\" + semicolontext +\n    \")\";\nmodule.exports.value = value;\n/*\n\n<LOOP_>\n\n*/\nvar loop_kw = \"[Ll][Oo][Oo][Pp]_\";\nmodule.exports.loop_kw = loop_kw;\n/*\n\n<LoopHeader>\n\n<LOOP_> {<WhiteSpace> <Tag>}+\n */\nvar loop_header = loop_kw + \"(\" + whitespace + tag + \")+\";\nmodule.exports.loop_header = loop_header;\n/*\n\n<LoopBody>\n\n<Value> { <WhiteSpace> <Value> }*   \n */\nvar loop_body = value + \"(\" + whitespace + value + \")*\";\nmodule.exports.loop_body = loop_body;\n/*\n\n<DataHeader>\n\n<DATA_> { <NonBlankChar> }+\n*/\nvar data_header = \"[Dd][Aa][Tt][Aa]_[\" + nonblank_char + \"]+\";\nmodule.exports.data_header = data_header;\n/*\n\n<DataItem>\n\n<Tag> <WhiteSpace> <Value> | <LoopHeader> <LoopBody>\n */\nvar data_item = \"(?:(\" + tag + \")\" + whitespace + value + \"|\" + loop_header +\n    loop_body + \")\";\nmodule.exports.data_item = data_item;\n// Reserved keywords\nmodule.exports.reserved = \"(data|loop|global|save|stop)\";\n\n// Utility function to get ready regular expressions\nmodule.exports.tokenRegex = function(tname, start, end, flags) {\n    var flags = flags || 'g';\n    if (tname == 'reserved') {\n        flags = 'gi';\n    }\n    var restr = module.exports[tname];\n    if (start) {\n        restr = '^' + restr;\n    }\n    if (end) {\n        restr = restr + '$';\n    }\n    return RegExp(restr, flags);\n}","'use strict';\n\nvar mjs = require('mathjs');\nvar mndtable = require('mendeleev').PeriodicTable;\n\nvar utils = require('./utils.js');\nvar parseCif = require('./parse.js').parseCif;\nvar symmetry = require('./symmetry.js');\n\n/*\n\nFunctions and classes useful to transform a parsed CIF data structure into a\nseries of crystallographic structures.\n\n*/\n\n/**\n *   Convert a cartesian coordinates cell into a lengths and angles representation\n *   @param  {Array} cell    Cartesian form cell (must be 3x3)\n *   @param  {bool}  radians If true, angles are returned in radians\n *   @return {Array}         Parameters in form [lengths, angles]\n */\nfunction cellToCellpar(cell, radians) {\n    var lengths = cell.map(function(c) { return mjs.norm(c); });\n    var angles = [];\n    for (var i = 0; i < 3; ++i) {\n        var j = (i + 2) % 3;\n        var k = (i + 1) % 3;\n        var ll = lengths[j] * lengths[k];\n        if (ll > 1e-16) {\n            var x = mjs.dot(cell[j], cell[k]) / ll;\n            var angle = Math.acos(x);\n        } else {\n            var angle = Math.PI / 2.0;\n        }\n        angles.push(angle);\n    }\n    if (!radians) {\n        angles = angles.map(utils.radToDeg);\n    }\n    return [lengths, angles];\n}\nmodule.exports.cellToCellpar = cellToCellpar;\n\n/**\n *  Convert a cell into lengths and angles representation to cartesian form\n *  @param  {Array} cellpar     Lengths and angles form of cell (must be 2x3)\n *  @param  {Array} ab_normal   Desired direction for the normal to the AB plane\n *  @param  {Array} a_direction Direction for the a parameter\n *  @param  {bool}  radians     If true, consider the angles in radians\n *  @return {Array}             Cell in Cartesian form\n */\nfunction cellparToCell(cellpar, ab_normal, a_direction, radians) {\n\n    ab_normal = ab_normal || [0, 0, 1]; // Default is the XY plane\n\n    if (!a_direction) {\n        if (mjs.norm(utils.cross(ab_normal, [1, 0, 0])) < 1e-5) {\n            a_direction = [0, 0, 1]; // Only if the AB plane contains X\n        } else {\n            a_direction = [1, 0, 0];\n        }\n    }\n\n    // Define rotated X,Y,Z-system, with Z along ab_normal and X along\n    // the projection of a_direction onto the normal plane of Z.\n    var ad = utils.unit(a_direction);\n    var Z = utils.unit(ab_normal);\n    var X = utils.unit(mjs.subtract(ad, mjs.dotMultiply(mjs.dot(ad, Z), Z)));\n    var Y = utils.cross(Z, X);\n\n    // Express va, vb and vc in the X,Y,Z-system\n    var l = cellpar[0];\n    var angs = cellpar[1];\n\n    if (!radians) {\n        angs = angs.map(utils.degToRad);\n    }\n\n    var cosa = angs.map(Math.cos);\n    var sina = angs.map(Math.sin);\n\n    for (var i = 0; i < 3; ++i) {\n        // Round for orthorombic cells\n        if (Math.abs(Math.abs(sina[i]) - 1) < 1e-14) {\n            sina[i] = Math.sign(sina[i]);\n            cosa[i] = 0.0;\n        }\n    }\n\n    // Build the cell vectors\n    var va = [l[0], 0, 0];\n    var vb = [l[1] * cosa[2], l[1] * sina[2], 0];\n    var vc = [l[2] * cosa[1],\n        l[2] * (cosa[0] - cosa[1] * cosa[2]) / sina[2],\n        0\n    ];\n    vc[2] = Math.sqrt(l[2] * l[2] - vc[0] * vc[0] - vc[1] * vc[1]);\n\n    // Convert to the Cartesian x, y, z - system\n    var cell = mjs.multiply([va, vb, vc], [X, Y, Z]);\n\n    return cell\n}\nmodule.exports.cellparToCell = cellparToCell;\n\n/** \n *  A class holding a crystallographic structure. Inspired by the Atoms class\n *  of the Atomic Simulation Environment.\n *  @class\n *  @param {Array}  elems       Array of element symbols or atomic numbers\n *  @param {Array}  positions   Array of 3D positions\n *  @param {Array}  cell        Array describing the unit cell. Can be any of\n *                              the following:\n *                              - false/null: no periodic boundary\n *                              - Single float: cubic cell with that parameter\n *                              - Array of 3 floats: orthorombic cell with \n *                                those parameters\n *                              - Array of 3x3 floats: full carthesian cell\n *                                definition\n *                              - Any of the previous two, but with one or two\n *                                elements replaced by false/null: partial \n *                                periodicity\n *                              - Array of 2x3 floats: cell in lengths+angles\n *                                format. Angles must be in degrees\n *  @param {Object} info        Additional data attached to the structure\n *  @param {bool}   scaled      If true, interpret the positions as scaled\n *                              instead of absolute\n *  @param {bool}   tolerant    If true, accept even symbols of elements that\n *                              do not exist in the periodic table\n */\nvar Atoms = function(elems, positions, cell, info, scaled, tolerant) {\n\n    // Sanity checks\n    var symbols = [];\n    var numbers = [];\n    for (var i = 0; i < elems.length; ++i) {\n        var el = elems[i];\n        var a;\n        var is_num = (typeof(el) == 'number');\n        if (is_num) {\n            a = mndtable.getAtomic(el);\n        } else {\n            a = mndtable.getElement(el);\n        }\n        if (a === null) {\n            if (is_num || !tolerant) {\n                throw Error('Non-existing element \"' + el + '\" passed to Atoms');\n            } else {\n                a = {\n                    'symbol': el, // Default for unknown element symbols\n                    'number': -1\n                }\n            }\n        }\n        symbols.push(a.symbol);\n        numbers.push(a.number);\n    }\n\n    this._arrays = {\n        'symbols': symbols,\n        'numbers': numbers,\n    }\n    this._N = symbols.length;\n\n    // Now on to storing the cell\n    this._pbc = [true, true, true];\n    this._inv_cell = null;\n    if (!cell) {\n        this._pbc = [false, false, false];\n        this._cell = null;\n    } else if (typeof(cell) == 'number') {\n        var a = cell;\n        this._cell = [\n            [a, 0, 0],\n            [0, a, 0],\n            [0, 0, a]\n        ];\n    } else if (cell.length == 2 && cell[0].length == 3 && cell[1].length == 3) {\n        // Lenghts + angles format\n        this._cell = cellparToCell(cell);\n    } else if (cell.length != 3) {\n        throw Error('Invalid cell passed to set_cell');\n    } else {\n        this._cell = [];\n        for (var i = 0; i < 3; ++i) {\n            if (!cell[i]) {\n                this._cell.push(null);\n                this._pbc[i] = false;\n            } else if (typeof(cell[i]) == 'number') {\n                var row = [0, 0, 0];\n                row[i] = cell[i];\n                this._cell.push(row);\n            } else if (cell[i].length != 3) {\n                throw Error('Invalid cell passed to set_cell');\n            } else {\n                this._cell.push(cell[i]);\n            }\n        }\n    }\n\n    if (cell && !(this._cell.includes(null)))\n        this._inv_cell = mjs.inv(this._cell);\n\n    // Check that the positions are the right size\n    var check_pos = (positions.length == this._N);\n    for (var i = 0; i < positions.length; ++i) {\n        check_pos = check_pos && (positions[i].length == 3);\n    }\n    if (!check_pos) {\n        throw Error('Invalid positions array passed to Atoms');\n    }\n\n    if (scaled) {\n        if (this._inv_cell === null) {\n            // Periodicity isn't full!\n            throw Error('Impossible to use scaled coordinates with non-periodic system');\n        }\n        positions = mjs.multiply(positions, this._cell);\n    }\n\n    this.set_array('positions', positions);\n\n    info = info || {};\n    this.info = info;\n}\n\n// Prototype for Atoms. We focus on getters, not setters, because it's not \n// meant to be modified besides its arrays.\nAtoms.prototype = {\n    length: function() {\n        return this._N;\n    },\n    set_array: function(name, arr) {\n        // Check that it's the right shape\n        if (!(arr.length == this._N)) {\n            throw Error('Invalid array size');\n        }\n        this._arrays[name] = arr;\n    },\n    get_array: function(name) {\n        return this._arrays[name];\n    },\n    get_chemical_symbols: function() {\n        return utils.deepClone(this.get_array('symbols'));\n    },\n    get_atomic_numbers: function() {\n        return utils.deepClone(this.get_array('numbers'));\n    },\n    get_cell: function() {\n        return utils.deepClone(this._cell);\n    },\n    get_inv_cell: function() {\n        return utils.deepClone(this._inv_cell);\n    },\n    get_pbc: function() {\n        return utils.deepClone(this._pbc);\n    },\n    get_positions: function() {\n        return utils.deepClone(this.get_array('positions'));\n    },\n    get_scaled_positions: function() {\n        var pos = this.get_array('positions');\n        var spos = [];\n        var ic = this._inv_cell;\n        // Going the long way about this because it's performance critical\n        for (var i = 0; i < pos.length; ++i) {\n            var p = pos[i];\n            var sp = [p[0]*ic[0][0]+p[1]*ic[1][0]+p[2]*ic[2][0],\n                      p[0]*ic[0][1]+p[1]*ic[1][1]+p[2]*ic[2][1],\n                      p[0]*ic[0][2]+p[1]*ic[1][2]+p[2]*ic[2][2]];\n            spos.push(sp);\n        }\n        return spos;\n    }\n}\n\n// Utility functions needed for CIF parsing. Not meant for outside use!\n\n/** \n *  This function extracts a series of tags from a cif block. It searches for\n *  them and, if they are loops, only returns the ones that are as long as the\n *  FIRST element of tags (which is assumed obligatory; if not found, null is\n *  returned)\n */\nfunction _extract_tags(cblock, tags) {\n    var extracted = tags.map(function(tag) {\n        return cblock[tag];\n    });\n    if (extracted[0] === undefined)\n        return null;\n    // Verify that, in case of loops, all tags have the same length\n    var basetype = extracted[0].type;\n    var baselen = null;\n    if (basetype == 'loop') {\n        baselen = extracted[0].value.length;\n    }\n\n    extracted = extracted.map(function(x) {\n        if (x === undefined)\n            return null;\n        if (x.type != basetype)\n            return null;\n        if (basetype == 'loop' && x.value.length != baselen)\n            return null;\n\n        if (basetype == 'loop') {\n            return x.value;\n        } else {\n            return [x.value];\n        }\n    });\n\n    return extracted;\n}\n\nfunction _atom_types(cblock) {\n    // Extract atom types from cblock\n    var atype_tags = ['_atom_type_symbol',\n        '_atom_type_description',\n        '_atom_type_radius_bond'\n    ];\n    var typevals = _extract_tags(cblock, atype_tags);\n    if (!typevals) {\n        return null; // No types found\n    }\n\n    var atypes = {};\n    for (var i = 0; i < typevals[0].length; ++i) {\n        var sym = typevals[0][i].text;\n        atypes[sym] = {};\n        for (var j = 1; j < atype_tags.length; ++j) {\n            if (typevals[j] != null)\n                atypes[sym][atype_tags[j].slice(11)] =\n                typevals[j][i].get_value();\n        }\n    }\n\n    return atypes;\n}\n\nfunction _atom_sites(cblock) {\n    // Extract atom sites from cblock\n    var asite_tags = ['_atom_site_label',\n        '_atom_site_type_symbol',\n        '_atom_site_Cartn_x',\n        '_atom_site_Cartn_y',\n        '_atom_site_Cartn_z',\n        '_atom_site_fract_x',\n        '_atom_site_fract_y',\n        '_atom_site_fract_z'\n    ];\n    var sitevals = _extract_tags(cblock, asite_tags);\n    if (!sitevals) {\n        return null; // No sites found\n    }\n\n    var asites = [];\n    for (var i = 0; i < sitevals[0].length; ++i) {\n        asites.push({});\n        for (var j = 0; j < asite_tags.length; ++j) {\n            if (sitevals[j] != null)\n                asites[i][asite_tags[j].slice(11)] = sitevals[j][i].get_value();\n        }\n    }\n\n    return asites;\n}\n\nfunction _cellpars(cblock) {\n\n    var cell_tags = [\n        '_cell_length_a',\n        '_cell_length_b',\n        '_cell_length_c',\n        '_cell_angle_alpha',\n        '_cell_angle_beta',\n        '_cell_angle_gamma'\n    ];\n\n    var cellpars = [\n        [],\n        []\n    ];\n    for (var i = 0; i < 6; ++i) {\n        var val = cblock[cell_tags[i]];\n        if (val === undefined)\n            return null;\n        cellpars[Math.floor(i / 3)].push(val.value.get_value());\n    }\n\n    // If any of a, b, c is zero, then it's invalid\n    if (cellpars[0].some(function(x) { return (x == 0);})) {\n        return null;\n    }\n\n    return cellpars;\n}\n\nfunction _symops(cblock) {\n\n    // Look for either tag\n    var symopvals = (cblock._space_group_symop_operation_xyz ||\n        cblock._symmetry_equiv_pos_as_xyz);\n\n    // Hall symbol?\n    var hallsymbol = (cblock._space_group_name_Hall ||\n        cblock._symmetry_space_group_name_Hall);\n\n    var symops = null;\n\n    if (symopvals) {\n        symops = [];\n        if (symopvals.type == 'single' ||\n            symopvals.value.length == 1) {\n            // Either way is pointless (only one value means identity)\n            return null;\n        }\n\n        for (var i = 1; i < symopvals.value.length; ++i) {\n            symops.push(symmetry.parseSymOp(symopvals.value[i].text));\n        }\n    } else if (hallsymbol) {\n        symops = symmetry.interpretHallSymbol(hallsymbol);\n    }\n\n    return symops;\n}\n\n/** CIF to Atoms parser\n *  @static\n *  @param  {string}    cif     CIF file in text format\n *  @param  {float}     symtol  Distance under which two symmetric copies are\n *                              considered equivalent\n *                              \n *  @return {Object}            Dictionary of parsed crystal structures\n */\nAtoms.readCif = function(cif, symtol=1e-3) {\n\n    var cifdict = parseCif(cif);\n\n    // Consider any data block\n    var structs = {};\n    for (var bname in cifdict) {\n        var block = cifdict[bname];\n        if ('_atom_site_label' in block) {\n            structs[bname] = block;\n        }\n    }\n\n    for (var sname in structs) {\n        var cblock = cifdict[sname];\n        // Start by identifying atom types, if present\n        var atypes = _atom_types(cblock);\n        var asites = _atom_sites(cblock);\n        var cellpars = _cellpars(cblock);\n\n        // Is this system periodic?\n        var pbc = (cellpars !== null);\n        if (pbc) {\n            var cell = cellparToCell(cellpars);\n        }\n\n        // Extract symbols, labels, and positions\n        var symbols = [];\n        var labels = [];\n        var positions = [];\n        for (var i = 0; i < asites.length; ++i) {\n            symbols.push(asites[i].type_symbol);\n            labels.push(asites[i].label);\n            var p = [asites[i].Cartn_x, asites[i].Cartn_y, asites[i].Cartn_z];\n            if (p.some(function(x) { return x === undefined; })) {\n                // Then we need the fractional ones!\n                if (!pbc) {\n                    // Does not make sense...\n                    throw Error('Absolute coordinates are necessary without a unit cell');\n                }\n                p = [asites[i].fract_x, asites[i].fract_y, asites[i].fract_z];\n                p = mjs.multiply(p, cell);\n            }\n            positions.push(p);\n        }\n\n        // Now for symmetry operations...\n        if (pbc) {\n            var symops = _symops(cblock);\n            if (symops){\n                var fpos = mjs.multiply(positions, mjs.inv(cell));\n                var allfpos = [];\n                var allsyms = [];\n                var alllabs = [];\n                // Otherwise, find the new positions\n                for (var i = 0; i < fpos.length; ++i) {\n                    var p0 = fpos[i];\n                    var allp = [p0];\n                    for (var j = 0; j < symops.length; ++j) {\n                        var rot = symops[j][0];\n                        var tr = symops[j][1];\n                        var p = mjs.add(mjs.multiply(rot, p0), tr);\n                        p = utils.mod1(p);\n                        // Is it equivalent to something else?\n                        var eq = false;\n                        for (var k = 0; k < allp.length; ++k) {\n                            var r = mjs.subtract(p, allp[k]);\n                            r = utils.shortestPeriodicLength(utils.mod1(r));\n                            if (r < symtol) {\n                                eq = true;\n                                break;\n                            }\n                        }\n                        if (!eq) {\n                            allp.push(p);\n                        }\n                    }\n                    // Concatenate\n                    allfpos = allfpos.concat(allp);\n                    allsyms = allsyms.concat(Array(allp.length).fill(symbols[i]));\n                    alllabs = alllabs.concat(Array(allp.length).fill(labels[i]));\n                }\n                symbols = allsyms;\n                labels = alllabs;\n                positions = mjs.multiply(allfpos, cell);\n            }\n        }\n\n        // Create the atoms object\n        var a = new Atoms(symbols, positions, cell, {});\n        a.set_array('labels', labels);\n\n        structs[sname] = a;\n    }\n\n    return structs;\n}\n\nmodule.exports.Atoms = Atoms;","'use strict';\n\n/* Utility functions */\n\n/**\n *  Deep clone an object\n *  @param  {Object}    obj     Object to clone\n *  @return {Object}            Clone \n */\nfunction deepClone(obj) {\n    return JSON.parse(JSON.stringify(obj));\n}\nmodule.exports.deepClone = deepClone;\n\n/**\n *  Cross product of two vectors of 3 elements\n *  @param  {Array} v1  \n *  @param  {Array} v2\n *  @return {Array}     v1 X v2\n */\nfunction cross(v1, v2) {\n    return [v1[1] * v2[2] - v1[2] * v2[1],\n        v1[2] * v2[0] - v1[0] * v2[2],\n        v1[0] * v2[1] - v1[1] * v2[0]\n    ];\n}\nmodule.exports.cross = cross;\n\n/** Norm of a vector v\n *  @param  {Array}  v   \n *  @return {Number}    Norm of v\n */\nfunction norm(v) {\n    return Math.sqrt(v.reduce(function(s, x) {\n        return s + x * x;\n    }, 0));\n}\nmodule.exports.norm = norm;\n\n/**\n *  Returns the unit vector version of v\n *  @param  {Array} v\n *  @return {Array}     Unit vector\n */\nfunction unit(v) {\n    var n = norm(v);\n    return v.map(function(x) {\n        return x / n;\n    });\n}\nmodule.exports.unit = unit;\n\n\n/**\n * Reduce a vector to modulo 1 (interval [0,1]). Meant for fractional \n * coordinates\n * @param  {Array} v \n * @return {Array}      Reduced vector\n */\nfunction mod1(v) {\n    return v.map(function(x) {\n        x = x % 1;\n        return x >= 0 ? x : x + 1\n    });\n}\nmodule.exports.mod1 = mod1;\n\nvar _deg2rad = Math.PI / 180.0;\n/**\n *  Convert degrees to radians\n *  @param  {number}    deg     Angle in degrees\n *  @return {number}            Angle in radians\n */\nfunction degToRad(deg) {\n    return deg * _deg2rad;\n}\nmodule.exports.degToRad = degToRad;\n\n/**\n *  Convert radians to degrees\n *  @param  {number}    rad     Angle in radians\n *  @return {number}            Angle in degrees\n */\nfunction radToDeg(rad) {\n    return rad / _deg2rad;\n}\nmodule.exports.radToDeg = radToDeg;\n\n/**\n *  Check if an array includes multiple elements\n *  @param  {Array}     arr     Array to check\n *  @param  {Array}     elems   Elements to search in arr\n *  @return {bool}              Whether the check was successful\n */\nfunction includesAll(arr, elems) {\n    var ans = true;\n    for (var i = 0; i < elems.length; ++i) {\n        ans = ans && arr.includes(elems[i]);\n    }\n    return ans;\n}\nmodule.exports.includesAll = includesAll;\n\n/**\n * Shortest periodic length of a distance in fractional coordinates\n * @param  {Array} fx Fractional coordinates vector (p2-p1)\n * @return {Number}   Shortest length including periodic boundary conditions\n */\nfunction shortestPeriodicLength(fx) {\n    var r = norm(fx);\n\n    for (var dx = -1; dx < 2; ++dx) {\n        for (var dy = -1; dy < 2; ++dy) {\n            for (var dz = -1; dz < 2; ++dz) {\n                if (dx == 0 && dy == 0 && dz == 0)\n                    continue;\n                var df = [fx[0] + dx, fx[1] + dy, fx[2] + dz];\n                r = Math.min(r, norm(df));\n            }\n        }\n    }\n\n    return r;\n}\nmodule.exports.shortestPeriodicLength = shortestPeriodicLength;","'use strict';\n\nvar symdata = require('../data/symmetry.json');\n\n/* Symmetry and space group related methods \n */\n\n/**\n * Parse a symmetry operation string in the format:\n *     +x,y-1/2,z\n * into a rotation matrix + translation vector representation.\n * @param  {string} symopstr A string representation of the symmetry operation\n * @return {Object}          The symmetry operation as [rotation, translation]\n */\nfunction parseSymOp(symopstr) {\n    // First, split by commas\n    var xyz = symopstr.split(',');\n    if (xyz.length != 3) {\n        throw 'Invalid symop string';\n    }\n    // Then capture all elements\n    var symre = /([+-]{0,1})(?:([xyz])|(?:([0-9]+)\\/([0-9]+)))/g;\n    var rotm = []; // Rotation\n    var trns = []; // Translation\n\n    for (var i = 0; i < 3; ++i) {\n        var tokens = [];\n        symre.lastIndex = 0;\n        var r = [0, 0, 0];\n        var t = 0.0;\n        do {\n            var res = symre.exec(xyz[i]);\n            if (!res)\n                break;\n            var sign = (res[1] == '-') ? -1 : 1;\n            if (res[2] === undefined) {\n                // Translation!\n                t += sign * parseFloat(res[3]) / parseFloat(res[4]);\n            } else {\n                // Rotation!\n                var j = 'xyz'.search(res[2]);\n                r[j] += sign;\n            }\n        } while (res);\n        rotm.push(r);\n        trns.push(t);\n    }\n\n    return [rotm, trns];\n}\nmodule.exports.parseSymOp = parseSymOp;\n\n/**\n * Interpret a Hall symbol and return a full list of symmetry\n * operations for it in.\n * @param  {string} hsym Hall symbol\n * @return {Object}      Symmetry operations as list of [rotation, translation]\n */\nfunction interpretHallSymbol(hsym) {\n\n    var hsym = hsym.trim()\n\n    for (var i = 1; i <= 530; ++i) {\n        // Iterate over all spacegroups\n        if (symdata[i]['hall_symbol'] == hsym) {\n            var rotms = symdata[i]['rotations'];\n            var trnss = symdata[i]['translations'];\n\n            return rotms.map(function(r, i) {\n                return [r, trnss[i]];\n            });\n        }\n    }\n\n    throw 'Invalid Hall symbol';\n}\nmodule.exports.interpretHallSymbol = interpretHallSymbol;","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { createBrowserHistory } from 'history'\nexport default createBrowserHistory({basename: process.env.PUBLIC_URL})\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { createTheme } from '@material-ui/core'\nimport { isPlainObject, isNil, forOwn } from 'lodash'\n\n/**\n * Used to normalized the given URL into an absolute form which starts with\n * protocol, host and port.\n *\n * @param {*} url The url to convert\n * @param {*} base The URL base address. Contains the protocol, host and port. Defaults to\n *   current window origin.\n * @param {*} protocol The desired protocol. By default the protocol in 'base'\n *   is used.\n * @returns Absolute url as a string\n */\n export function urlAbs(url, base = window.location.origin, protocol) {\n  let absUrl = new URL(url, base).href\n\n  // Convert protocol if one is given\n  if (protocol) {\n    const oldProtocol = absUrl.split('//', 1)[0]\n    absUrl = `${protocol}${absUrl.slice(oldProtocol.length)}`\n  }\n\n  return absUrl\n}\n\n/**\n * Returns a normalized version of an UI config model. The following changes are applied\n * in the normalized version:\n *\n *  - The 'include' and 'exclude' attributes have been used to filter and order the\n *    options object and the key is automatically included as an option property.\n *\n * @param {object} config The original UI config.\n * @return Normalized version of the UI config model.\n */\nexport function normalizeConfig(config) {\n    if (isNil(config)) return config\n\n    function normalize(obj) {\n      for (const [key, value] of Object.entries(obj)) {\n        if (isPlainObject(value)) {\n          normalize(value)\n\n          // Normalize the options\n          if (!value.options) continue\n          const include = value.include || (value.options && Object.keys(value.options))\n          const options = include\n            ? include\n              .filter(key => !value?.exclude?.includes(key))\n              .map(key => ({key, ...value.options[key]}))\n            : []\n\n          const config = {options: Object.fromEntries(options.map(option => [option.key, option]))}\n\n          // Carry over all additional fields\n          forOwn(value, (v, k) => {\n            if (k !== 'options' && k !== 'include' && k !== 'exclude') {\n              config[k] = v\n            }\n          })\n\n          obj[key] = config\n        }\n      }\n    }\n\n    // Recursively normalize the config\n    normalize(config)\n\n    return config\n}\n\nwindow.nomadEnv = window.nomadEnv || {}\nexport const version = window.nomadEnv.version\nexport const appBase = urlAbs(window.nomadEnv.appBase.replace(/\\/$/, ''))\nexport const apiBase = `${appBase}/api`\nexport const northBase = urlAbs(window.nomadEnv.northBase)\nexport const guiBase = process.env.PUBLIC_URL\nexport const ui = normalizeConfig(window.nomadEnv.ui)\nexport const entry_points = normalizeConfig(window.nomadEnv?.plugins?.entry_points)\nexport const apps = Object.values(ui?.apps?.options || [])\nObject.values(entry_points?.options || [])\n  .filter(entry_point => entry_point.entry_point_type === 'app')\n  .forEach(entry_point => {\n    apps.push(entry_point.app)\n  })\nexport const servicesUploadLimit = window.nomadEnv.servicesUploadLimit\nexport const keycloakBase = window.nomadEnv.keycloakBase\nexport const keycloakRealm = window.nomadEnv.keycloakRealm\nexport const keycloakClientId = window.nomadEnv.keycloakClientId\nexport const debug = window.nomadEnv.debug || false\nexport const encyclopediaBase = window.nomadEnv.encyclopediaBase\nexport const oasis = window.nomadEnv.oasis || false\nexport const globalLoginRequired = window.nomadEnv.globalLoginRequired || false\nexport const appTokenMaxExpiresIn = window.nomadEnv.appTokenMaxExpiresIn || \"2023-10-25\"\nexport const email = 'support@nomad-lab.eu'\nexport const maxLogsToShow = 50\nexport const schemaSeparator = '#'\nexport const dtypeSeparator = '#'\nexport const yamlSchemaPrefix = 'entry_id:'\n\nwindow.nomadArtifacts = window.nomadArtifacts || {}\nexport const searchQuantities = window.nomadArtifacts.searchQuantities\nexport const metainfo = window.nomadArtifacts.metainfo\nexport const parserMetadata = window.nomadArtifacts.parserMetadata\nexport const toolkitMetadata = window.nomadArtifacts.toolkitMetadata\nexport const exampleUploads = {}\nObject.values(entry_points?.options || [])\n  .filter(entry_point => entry_point.entry_point_type === 'example_upload')\n  .forEach(entry_point => {\n    exampleUploads[entry_point.category] = {...exampleUploads[entry_point.category], [entry_point.id]: entry_point}\n  })\nexport const northTools = window.nomadArtifacts.northTools\nexport const unitList = window.nomadArtifacts.unitList\nexport const unitPrefixes = window.nomadArtifacts.unitPrefixes\n\nexport const nomadPrimaryColor = {\n  main: '#2A4CDF',\n  light: '#7F94EC',\n  dark: '#192E86',\n  veryLight: '#eaedfc'\n}\n\nexport const nomadSecondaryColor = {\n  main: '#008A67',\n  light: '#80C583',\n  dark: '#00533e',\n  veryLight: '#CCE8E1'\n}\n\nexport const nomadFontFamily = [\n  'Titillium Web',\n  'sans-serif'\n].join(',')\n\nexport const nomadTheme = createTheme({\n  typography: {\n    useNextVariants: true,\n    fontFamily: nomadFontFamily,\n    fontWeightRegular: 400,\n    fontWeightMedium: 600\n  },\n  palette: {\n    primary: nomadPrimaryColor,\n    secondary: nomadSecondaryColor\n  },\n  overrides: {\n    // This is used to inject global css styles through the CssBaseline\n    // component, see: https://v4.mui.com/howto/customization/globals/#global-css\n    MuiCssBaseline: {\n      '@global': {\n        '.react-grid-item.react-grid-placeholder': {\n            backgroundColor: nomadSecondaryColor.main\n        },\n        // This rule is overwritten. The normalization was added quite late into\n        // the app and the 'box-sizing: inherit' -rule would mess up the layout\n        // quite a bit.\n        '*, *::before, *::after': {\n          boxSizing: 'revert'\n        }\n      }\n    },\n    MuiTooltip: {\n      tooltip: {\n        fontWeight: 'normal',\n        fontSize: '0.75rem'\n      }\n    },\n    MuiTableRow: {\n      root: {\n        '&:last-child td': {\n          borderBottom: 0\n        }\n      }\n    }\n  }\n})\n\nexport const formatQuantity = (x) => {\n  const parts = x.toString().split('.')\n  parts[0] = parts[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',')\n  return parts.join('.')\n}\n\nexport function normalizeDisplayValue(value) {\n  if (value === 'not processed' || value === 'unavailable') {\n    return '-'\n  }\n  return value\n}\n\n/**\n * The range of electronic energies in eV.\n */\nexport const electronicRange = [-5, 10]\n/**\n * The default date format.\n */\nexport const dateFormat = 'dd/MM/yyyy'\n/**\n * Warning shown when energy values could not be normalized.\n */\nexport const msgNormalizationWarning = `\nEnergy reference could not be found: energies have an unknown shift with\nrespect to the highest occupied energy.\n`\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { SnackbarContent, IconButton, Snackbar, withStyles } from '@material-ui/core'\nimport CloseIcon from '@material-ui/icons/Close'\n\nexport class VersionMismatch extends Error {\n  constructor(msg) {\n    super(msg)\n    this.name = 'VersionMismatch'\n  }\n}\n\nexport const errorContext = React.createContext({\n  errors: [],\n  raiseError: () => { throw Error('Error context used incorrectly.') }\n})\n\nclass ErrorSnacksUnstyled extends React.Component {\n  static propTypes = {\n    classes: PropTypes.object.isRequired,\n    children: PropTypes.any.isRequired\n  }\n  static styles = theme => ({\n    root: {},\n    errorSnack: {\n      backgroundColor: theme.palette.error.dark\n    }\n  })\n\n  state = {\n    errors: [],\n    raiseError: (error) => {\n      this.onError(error)\n    }\n  }\n\n  onError(error) {\n    let errorStr = 'Unexpected error. Please try again and let us know, if this error keeps happening.'\n    if (error instanceof Error) {\n      if (error.name === 'BadRequest') {\n        errorStr = error.message\n      } else if (error.name === 'CannotReachApi') {\n        errorStr = 'Cannot reach NOMAD, please try again later.'\n      } else if (error.name === 'NotAuthorized') {\n        errorStr = error.message\n      } else if (error.name === 'DoesNotExist') {\n        errorStr = 'You are trying to access information that does not exist. Please try again and let us know, if this error keeps happening.'\n      } else if (error.name === 'VersionMismatch') {\n        errorStr = 'There is a new GUI version available. Please press \"shift\" and reload the page.'\n      } else if (error.message.startsWith('could not parse optimade')) {\n        errorStr = 'The given OPTiMaDe query can not be parsed.'\n      } else if (error.status === 422) {\n        errorStr = `Unexpected api error: ${error.apiMessage[0].msg}. Please try again and let us know, if this error keeps happening.`\n        console.log(error)\n      } else if (error.message) {\n        errorStr = `Unexpected error: \"${error.message}\". Please try again and let us know, if this error keeps happening.`\n        console.log(error)\n      }\n    } else if (typeof error === 'string' || error instanceof String) {\n      errorStr = `${error} Please close all NOMAD tabs and try again. Let us know, if this error keeps happening.`\n    }\n\n    if (this.state.errors.indexOf(errorStr) === -1) {\n      this.setState({errors: [errorStr, ...this.state.errors]})\n    }\n  }\n\n  onClose() {\n    if (this.state.errors.length > 0) {\n      this.setState({errors: this.state.errors.slice(1)})\n    }\n  }\n\n  render() {\n    const {children, classes} = this.props\n    return (\n      <errorContext.Provider value={this.state}>\n        {children}\n        <Snackbar\n          anchorOrigin={{vertical: 'bottom', horizontal: 'left'}}\n          open={this.state.errors.length > 0}\n          onClose={this.handleClose}\n        >\n          <SnackbarContent\n            className={classes.errorSnack}\n            message={\n              <span style={{color: 'white'}}>{'' + this.state.errors[0]}</span>\n            }\n            action={[\n              <IconButton key={0} size=\"small\" color=\"inherit\" onClick={this.onClose.bind(this)}>\n                <CloseIcon />\n              </IconButton>\n            ]}\n          />\n        </Snackbar>\n      </errorContext.Provider>\n    )\n  }\n}\n\nexport const ErrorSnacks = withStyles(ErrorSnacksUnstyled.styles)(ErrorSnacksUnstyled)\n\nexport function withErrors(Component) {\n  function WithErrorComponent(props) {\n    return (\n      <errorContext.Consumer>\n        {errorContext => <Component {...props} raiseError={errorContext.raiseError} />}\n      </errorContext.Consumer>\n    )\n  }\n\n  return WithErrorComponent\n}\n\nexport class ErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = { hasError: false }\n  }\n\n  static propTypes = {\n    children: PropTypes.any,\n    onError: PropTypes.func\n  }\n\n  static getDerivedStateFromError(_error) {\n    // Update state so the next render will show the fallback UI.\n    return { hasError: true }\n  }\n\n  componentDidCatch(error, errorInfo) {\n    console.log('caught error in boundary', error, errorInfo)\n    if (this.context) {\n      this.context.raiseError('There has been a Javascript error.')\n    }\n  }\n\n  render() {\n    // If an error is caught, show the 'root' error message. This message will\n    // be shown on top of everything does not contain any React or MUI specific\n    // code to keep it functional no matter where the error originates from.\n    if (this.state.hasError) {\n      const error = document.getElementById(\"rootError\")\n      if (error) {\n        error.style.display = 'block'\n      }\n      return null\n    }\n\n    return this.props.children\n  }\n}\n\nErrorBoundary.contextType = errorContext\n\nexport function useErrors() {\n  return useContext(errorContext)\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useEffect, useMemo, useState, useContext } from 'react'\nimport {\n  atom,\n  useSetRecoilState,\n  useRecoilValue,\n  useRecoilState\n} from 'recoil'\nimport PropTypes from 'prop-types'\nimport Cookies from 'universal-cookie'\nimport { apiBase, globalLoginRequired, appBase, searchQuantities } from '../config'\nimport { Box, Typography, withStyles } from '@material-ui/core'\nimport LoginLogout from './LoginLogout'\nimport { useKeycloak } from '@react-keycloak/web'\nimport axios from 'axios'\nimport { useErrors } from './errors'\n\nexport class DoesNotExist extends Error {\n  constructor(msg) {\n    super(msg)\n    this.name = 'DoesNotExist'\n  }\n}\n\nexport class NotAuthorized extends Error {\n  constructor(msg) {\n    super(msg)\n    this.name = 'NotAuthorized'\n  }\n}\n\nexport class ApiError extends Error {\n  constructor(msg) {\n    super(msg)\n    this.name = 'CannotReachApi'\n  }\n}\n\nexport class ApiRequestError extends Error {\n  constructor(msg) {\n    super(msg)\n    this.name = 'BadRequest'\n  }\n}\n\nfunction handleApiError(e) {\n  if (e.name === 'CannotReachApi' || e.name === 'NotAuthorized' || e.name === 'DoesNotExist' || e.name === 'BadRequest') {\n    throw e\n  }\n\n  let error = null\n  if (e?.message === 'Failed to fetch' || e?.message === 'Network Error') {\n    error = new ApiError(e.message)\n    error.status = 400\n  } else if (e.response) {\n    const body = e.response.body\n    const message = (body && (body.message || body.description)) || e.response?.data?.detail || e.response.statusText\n    const errorMessage = `${message} (${e.response.status})`\n    if (e.response.status === 404) {\n      error = new DoesNotExist(errorMessage)\n    } else if (e.response.status === 401) {\n      error = new NotAuthorized(errorMessage)\n    } else if (e.response.status === 400) {\n      error = new ApiRequestError(errorMessage)\n    } else if (e.response.status === 502) {\n      error = new ApiError(errorMessage)\n    } else {\n      error = new Error(errorMessage)\n    }\n    error.status = e.response.status\n    error.apiMessage = message\n  } else {\n    const errorMessage = e.status ? `${e} (${e.status})` : '' + e\n    error = new Error(errorMessage)\n  }\n  throw error\n}\n\nclass ResourcesApi {\n  constructor(api) {\n    this.api = api\n    this.apiKey = null\n    this.axios = axios.create({\n      baseURL: `${appBase}/resources`\n    })\n  }\n\n  async get(path, query, config) {\n    const GET = (path, body, config) => this.axios.get(path, config)\n    return this.api.doHttpRequest(GET, path, null, {params: query, methodName: 'GET', ...config})\n  }\n}\n\nclass Api {\n  constructor(keycloak, setLoading) {\n    this.keycloak = keycloak\n    this.setLoading = setLoading\n    this.baseURL = `${apiBase}/v1`\n    this.axios = axios.create({\n      baseURL: this.baseURL\n    })\n\n    this.nLoading = 0\n\n    this.onFinishLoading = (show) => {\n      if (show) {\n        this.nLoading--\n        if (this.nLoading === 0) {\n          setLoading(false)\n        }\n      }\n    }\n    this.onStartLoading = (show) => {\n      if (show) {\n        this.nLoading++\n        if (this.nLoading > 0) {\n          setLoading(true)\n        }\n      }\n    }\n\n    this.subscriptions = {}\n  }\n\n  /**\n   * Fetches the up-to-date authorization headers. Performs a token update if\n   * the current token has expired.\n   * @returns Object containing the authorization header.\n   */\n  async authHeaders() {\n    if (this.keycloak.token) {\n      return new Promise((resolve, reject) => {\n        this.keycloak.updateToken()\n          .then(() => {\n            resolve({\n              headers: {\n                'Authorization': `Bearer ${this.keycloak.token}`\n              }\n            })\n          })\n          .catch(() => {\n            reject(new ApiError())\n          })\n      })\n    } else {\n      return {}\n    }\n  }\n\n  /**\n   * Returns the data related to the specified dataset.\n   *\n   * @param {string} datasetID\n   * @returns Object containing the search index contents.\n   */\n  async datasets(datasetId) {\n    this.onStartLoading()\n    const auth = await this.authHeaders()\n    try {\n      const entry = await this.axios.get(`/datasets/${datasetId}`, auth)\n      return entry.data.data\n    } catch (errors) {\n      handleApiError(errors)\n    } finally {\n      this.onFinishLoading()\n    }\n  }\n\n  /**\n   * Returns a list of suggestions for the given metainfo quantities.\n   *\n   * @param {string} quantity The quantity names for which suggestions are\n   * returned.\n   * @param {string} input Input used to filter the responses. Must be provided\n   * in order to return suggestions.\n   *\n   * @returns List of suggested values. The items are ordered by how well they\n   * match the input.\n   */\n  async suggestions(quantities, input) {\n    const auth = await this.authHeaders()\n    try {\n      const suggestions = await this.axios.post(\n        `/suggestions`,\n        {\n          input: input,\n          quantities: quantities\n        },\n        auth\n      )\n      return suggestions.data\n    } catch (errors) {\n      handleApiError(errors)\n    }\n  }\n\n  /**\n   * Return the raw file metadata for a given entry.\n   * @param {string} entryId\n   * @returns Object containing the raw file metadata.\n   */\n  async getRawFileListFromEntry(entryId) {\n    this.onStartLoading()\n    const auth = await this.authHeaders()\n    try {\n      const entry = await this.axios.get(`/entries/${entryId}/rawdir`, auth)\n      return entry.data\n    } catch (errors) {\n      handleApiError(errors)\n    } finally {\n      this.onFinishLoading()\n    }\n  }\n\n  /**\n   * Executes the given entry query\n   * @param {object} search contains the search object\n   * @param {string} searchTarget The target of the search: entries or materials\n   * @returns Object containing the raw file metadata.\n   */\n  async query(searchTarget, search, config) {\n    this.onStartLoading(config?.loadingIndicator || false)\n    const auth = await this.authHeaders()\n    try {\n      const request = {\n        method: 'POST',\n        path: `${searchTarget}/query`,\n        url: `${this.baseURL}/${searchTarget}/query`,\n        body: search\n      }\n      const result = await this.axios.post(request.path, request.body, auth)\n      if (config.returnRequest) {\n        request.response = result.data\n        return request\n      } else {\n        return result.data\n      }\n    } catch (errors) {\n      handleApiError(errors)\n    } finally {\n      this.onFinishLoading(config?.loadingIndicator || false)\n    }\n  }\n\n  async get(path, query, config) {\n    const GET = (path, body, config) => this.axios.get(path, config)\n    return this.doHttpRequest(GET, path, null, {params: query, methodName: 'GET', ...config})\n  }\n\n  async post(path, body, config) {\n    const POST = (path, body, config) => this.axios.post(path, body, config)\n    return this.doHttpRequest(POST, path, body, {methodName: 'POST', ...config})\n  }\n\n  async put(path, body, config) {\n    const PUT = (path, body, config) => this.axios.put(path, body, config)\n    return this.doHttpRequest(PUT, path, body, {methodName: 'PUT', ...config})\n  }\n\n  async delete(path, config) {\n    const DELETE = (path, body, config) => this.axios.delete(path, config)\n    return this.doHttpRequest(DELETE, path, null, {methodName: 'DELETE', ...config})\n  }\n\n  async doHttpRequest(method, path, body, config) {\n    const noLoading = config?.noLoading\n    this.onStartLoading(!noLoading)\n    const auth = await this.authHeaders()\n    config = config || {}\n    config.params = config.params || {}\n    config.headers = {\n      accept: 'application/json',\n      ...auth.headers,\n      ...(config?.headers || {})\n    }\n    try {\n      const results = await method(path, body, config)\n      if (config.jsonResponse) {\n        results.data = repairJsonResponse(results.data)\n      }\n      const response = config.fullResponse\n        ? results\n        : results.data\n      if (config.returnRequest) {\n        return {\n          method: config.methodName || method.name,\n          url: `${this.baseURL}/${path}`,\n          body: body,\n          response: response\n        }\n      }\n      return response\n    } catch (errors) {\n      if (config.noHandleErrors) {\n        throw errors\n      }\n      handleApiError(errors)\n    } finally {\n      this.onFinishLoading(!noLoading)\n    }\n  }\n\n  async getUsers(query) {\n    // no loading indicator, because this is only used in the background of the edit dialog\n    return this.get('users', query, {noLoading: true}).then(response => response.data)\n  }\n\n  async inviteUser(user) {\n    return this.put('users/invite', user, {noHandleErrors: true})\n  }\n\n  async getDatasets(prefix) {\n    // no loading indicator, because this is only used in the background of the edit dialog\n    const user = await this.keycloak.loadUserInfo()\n    const query = {\n      prefix: prefix,\n      dataset_type: 'owned',\n      user_id: user.id,\n      page_size: 1000\n    }\n    return this.get('datasets', query, {noLoading: true}).then(response => response.data)\n  }\n\n  async edit(edit) {\n    // We do not call the start and finish loading callbacks, because this one is\n    // only used in the background.\n\n    // repair the query, the API will only access correct use of lists for many\n    // quantities\n    Object.keys(edit.query).forEach(quantity => {\n      if (searchQuantities[quantity] && searchQuantities[quantity].many) {\n        if (!Array.isArray(edit.query[quantity])) {\n          edit.query[quantity] = edit.query[quantity].split(',')\n        }\n      }\n    })\n    return this.post('entries/edit_v0', edit)\n  }\n}\n\n/**\n * Custom JSON parse function that can handle NaNs that can be created by the\n * python JSON serializer.\n */\nfunction repairJsonResponse(result) {\n  if (typeof result === 'string') {\n    try {\n      return JSON.parse(result)\n    } catch (e) {\n      try {\n        return JSON.parse(result.replace(/\\bNaN\\b/g, '\"NaN\"'))\n      } catch (e) {\n        return result\n      }\n    }\n  } else {\n    return result\n  }\n}\n\n/**\n * React context that provides access to the API, user information and server\n * information throughout the app.\n */\nexport const apiContext = React.createContext()\nexport const APIProvider = React.memo(({\n  children\n}) => {\n  const {keycloak} = useKeycloak()\n  const setLoading = useSetLoading()\n  const api = useState(new Api(keycloak, setLoading))[0]\n  const [user, setUser] = useState()\n\n  // Update user whenever keycloak instance changes\n  useEffect(() => {\n    if (keycloak.authenticated) {\n      keycloak.loadUserInfo().then(response => {\n        setUser(response)\n      })\n    }\n  }, [keycloak, setUser])\n\n  const value = useMemo(() => ({\n    api: api,\n    resourcesApi: new ResourcesApi(api),\n    user: user\n  }), [api, user])\n\n  return <apiContext.Provider value={value}>\n    {children}\n  </apiContext.Provider>\n})\nAPIProvider.propTypes = {\n  children: PropTypes.node\n}\n\n/**\n * Hook for using server info.\n*/\nconst infoState = atom({\n  key: 'info',\n  default: undefined\n})\nexport function useInfo() {\n  const [info, setInfo] = useRecoilState(infoState)\n  const { api } = useApi()\n\n  // Get info only once\n  useEffect(() => {\n    if (!info) {\n      api.get('/info').then(setInfo).catch(() => {})\n    }\n  }, [info, api, setInfo])\n\n  return info\n}\n\n/**\n * Hook for using the API context.\n*/\nexport function useApi() {\n  return useContext(apiContext)\n}\n\n/**\n * Hooks/state for reading/writing whether the API is loading something.\n*/\nconst apiLoading = atom({\n  key: 'apiLoading',\n  default: false\n})\nexport function useLoading() {\n  return useRecoilValue(apiLoading)\n}\nexport function useLoadingState() {\n  return useRecoilState(apiLoading)\n}\nexport function useSetLoading() {\n  return useSetRecoilState(apiLoading)\n}\n\nfunction VerifyGlobalLogin({children}) {\n  const {api} = useApi()\n  const [verified, setVerified] = useState(null)\n\n  useEffect(() => {\n    api.get('users/me').then(() => setVerified(true)).catch(() => setVerified(false))\n  }, [api, setVerified])\n\n  if (verified === null) {\n    return null\n  }\n\n  if (!verified) {\n    return <Box margin={2}>\n      <LoginLogout color=\"primary\" />\n      <Typography color=\"error\">\n        You are not allowed to access this NOMAD installation. Please logout and try again.\n      </Typography>\n    </Box>\n  }\n\n  return <React.Fragment>\n    {children}\n  </React.Fragment>\n}\nVerifyGlobalLogin.propTypes = {\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ]).isRequired\n}\n\nexport function GlobalLoginRequired({children}) {\n  if (!globalLoginRequired) {\n    return <React.Fragment>\n      {children}\n    </React.Fragment>\n  }\n\n  return <LoginRequired message=\"You have to be logged in to use this NOMAD installation.\">\n    <VerifyGlobalLogin>\n      {children}\n    </VerifyGlobalLogin>\n  </LoginRequired>\n}\nGlobalLoginRequired.propTypes = {\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ]).isRequired\n}\n\nexport const LoginRequired = withStyles(theme => ({\n  root: {\n    padding: theme.spacing(2),\n    display: 'flex',\n    alignItems: 'center',\n    '& p': {\n      marginRight: theme.spacing(1)\n    }\n  }\n}))(({classes, message, children}) => {\n  const {api} = useApi()\n  if (api.keycloak.authenticated) {\n    return <React.Fragment>\n      {children}\n    </React.Fragment>\n  } else {\n    return <div className={classes.root}>\n      <Typography>\n        {message || 'You have to login to use this functionality.'}\n      </Typography>\n      <LoginLogout color=\"primary\" />\n    </div>\n  }\n})\nLoginRequired.propTypes = {\n  message: PropTypes.string,\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ]).isRequired\n}\n\n/**\n * HOC for wrapping components that require a login. Without login will return\n * the given message together with a login link.\n *\n * @param {*} Component\n * @param {*} message The message to display\n */\nexport function withLoginRequired(Component, message) {\n  return ({...props}) => <LoginRequired message={message}>\n    <Component {...props} />\n  </LoginRequired>\n}\n\nexport const withApi = (Component) => React.forwardRef((props, ref) => {\n  const apiProps = useApi()\n  const {raiseError} = useErrors()\n  return <Component ref={ref} {...apiProps} raiseError={raiseError} {...props} />\n})\n\nexport const onKeycloakEvent = (keycloak) => {\n  const cookies = new Cookies()\n  const path = apiBase.startsWith('/') ? apiBase : new URL(apiBase).pathname\n  return () => {\n    // Will be called whenever a keycloak event occurs\n    if (keycloak.authenticated) {\n      // Authenticated. Set authentication cookie\n      cookies.set('Authorization', 'Bearer ' + keycloak.token,\n        {\n          path: path,\n          expires: new Date((keycloak.tokenParsed.exp + keycloak.timeSkew) * 1000),\n          sameSite: 'strict'\n        })\n    } else {\n      // Not authenticated. Remove the cookie.\n      cookies.remove('Authorization', {path: path})\n    }\n  }\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport Typography from '@material-ui/core/Typography'\nimport { Button, Link, makeStyles } from '@material-ui/core'\nimport { keycloakBase, keycloakRealm } from '../config'\nimport LoginIcon from '@material-ui/icons/AccountCircle'\nimport { useApi } from './api'\nimport { useKeycloak } from '@react-keycloak/web'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex',\n    alignItems: 'center',\n    '& p': {\n      marginRight: theme.spacing(2)\n    }\n  },\n  link: {\n    textDecoration: 'underline'\n  },\n  button: {} // to allow overrides\n}))\n\nconst LoginLogout = React.memo(function LoginLogout(props) {\n  const classes = useStyles()\n  const {user} = useApi()\n  const {keycloak} = useKeycloak()\n  const {variant, color} = props\n\n  if (keycloak?.authenticated) {\n    return (\n      <div className={classes.root}>\n        <Typography color=\"primary\" variant=\"body1\">\n          Welcome <Link\n            className={classes.link}\n            href={`${keycloakBase.replace(/\\/$/, '')}/realms/${keycloakRealm}/account/`}>\n            { user ? user.name : '...' }\n          </Link>\n        </Typography>\n        <Button\n          className={classes.button} style={{marginLeft: 8}}\n          variant={variant} color={color}\n          onClick={() => keycloak.logout()}\n          startIcon={<LoginIcon/>}\n        >Logout</Button>\n      </div>\n    )\n  } else {\n    return (\n      <div className={classes.root}>\n        <Button\n          className={classes.button} variant={variant} color={color}\n          startIcon={<LoginIcon/>}\n          onClick={() => keycloak.login()}\n          data-testid='login-register-button'\n        >Login / Register</Button>\n      </div>\n    )\n  }\n})\nLoginLogout.propTypes = {\n  variant: PropTypes.string,\n  color: PropTypes.string\n}\n\nexport default LoginLogout\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {useState, useMemo, useContext, useCallback, useEffect} from 'react'\nimport PropTypes from 'prop-types'\nimport { isNil, isFunction, startCase, toLower, cloneDeep } from 'lodash'\nimport { Unit as UnitMathJS, createUnit } from 'mathjs'\nimport { unitList, unitPrefixes as prefixes } from '../../config'\n\n// Delete all units and prefixes that come by default with Math.js. This way\n// they cannot be intermixed with the NOMAD units. Notice that we have to clear\n// them in place: they are defined as const.\nObject.keys(UnitMathJS.UNITS).forEach(name => UnitMathJS.deleteUnit(name))\nUnitMathJS.BASE_DIMENSIONS.splice(0, UnitMathJS.BASE_DIMENSIONS.length)\nObject.getOwnPropertyNames(UnitMathJS.BASE_UNITS).forEach(function(prop) {\n  delete UnitMathJS.BASE_UNITS[prop]\n})\nObject.getOwnPropertyNames(UnitMathJS.PREFIXES).forEach(function(prop) {\n  delete UnitMathJS.PREFIXES[prop]\n})\nUnitMathJS.PREFIXES.NONE = {'': { name: '', value: 1, scientific: true }}\nUnitMathJS.PREFIXES.PINT = prefixes\n\n// Customize the unit parsing to allow certain special symbols\nconst isAlphaOriginal = UnitMathJS.isValidAlpha\nconst isSpecialChar = function(c) {\n  const specialChars = new Set(['_', '', '', '', '', '', '', '', '', ''])\n  return specialChars.has(c)\n}\nconst isGreekLetter = function(c) {\n  const charCode = c.charCodeAt(0)\n  return (charCode > 912 && charCode < 970)\n}\nUnitMathJS.isValidAlpha = function(c) {\n  return isAlphaOriginal(c) || isSpecialChar(c) || isGreekLetter(c)\n}\n\n// Create MathJS unit definitions from the data exported by 'nomad dev units'.\nexport const unitToAbbreviationMap = {}\nconst unitDefinitions = {}\nfor (let def of unitList) {\n  const name = def.name\n  def = {\n    ...def,\n    baseName: def.dimension,\n    prefixes: 'pint'\n  }\n  unitDefinitions[name] = def\n  if (def.abbreviation) {\n    unitToAbbreviationMap[name] = def.abbreviation\n    if (def.aliases) {\n      for (const alias of def.aliases) {\n        unitToAbbreviationMap[alias] = def.abbreviation\n      }\n    }\n  }\n}\ncreateUnit(unitDefinitions, {override: true})\n\n// Export unit options for each unit and dimension\nexport const unitMap = Object.fromEntries(unitList.map(x => [x.name, x]))\nexport const dimensionMap = {}\nfor (const def of unitList) {\n  const name = def.name\n  const dimension = def.dimension\n  if (isNil(dimension)) {\n    continue\n  }\n  const oldInfo = dimensionMap[dimension] || {\n    label: startCase(toLower(dimension.replace('_', ' ')))\n  }\n  const oldList = oldInfo.units || []\n  oldList.push(name)\n  oldInfo.units = oldList\n  dimensionMap[dimension] = oldInfo\n}\n\n/**\n * Convenience function for getting compatible units for a given dimension.\n * Returns all compatible units that have been registered.\n *\n * @param {string} dimension The dimension.\n * @returns Array of compatible units.\n */\nexport function getUnits(dimension) {\n  return dimensionMap?.[dimension]?.units || []\n}\n\n/**\n * React context for interacting with unit configurations.\n */\nexport const unitContext = React.createContext()\nexport const UnitProvider = React.memo(({initialUnitSystems, initialSelected, children}) => {\n  const resetUnitSystems = useState(cloneDeep(initialUnitSystems))[0]\n  const [isReset, setIsReset] = useState(true)\n  const [unitSystems, setUnitSystems] = useState(cloneDeep(initialUnitSystems))\n  const [selectedSystem, setSelectedSystem] = useState(initialSelected)\n  const [currentScope, setCurrentScope] = useState()\n  const [scopes, setScopes] = useState({})\n  const [scope, setScope] = useState()\n\n  const reset = useCallback(() => {\n    setUnitSystems(cloneDeep(resetUnitSystems))\n    setIsReset(true)\n    if (currentScope && scopes?.[currentScope]?.system) {\n      setSelectedSystem(scopes[currentScope].system)\n    }\n  }, [currentScope, scopes, resetUnitSystems])\n\n  const setScopeInfo = useCallback((scopeKey, unit) => {\n    if (!(scopeKey in scopes)) {\n      scopes[scopeKey] = {system: unit || initialSelected, unitSystems: unitSystems}\n      setScopes({...scopes})\n    }\n    setCurrentScope(scopeKey)\n  }, [scopes, initialSelected, unitSystems])\n\n  useEffect(() => {\n    if (currentScope in scopes) {\n      setSelectedSystem(scopes[currentScope].system)\n      setUnitSystems(scopes[currentScope].unitSystems)\n    }\n  }, [currentScope, scopes])\n\n  const setSelected = useCallback((unitSystem) => {\n    setIsReset(false)\n    setSelectedSystem(unitSystem)\n    setScopes(scopes => {\n      scopes[currentScope].system = unitSystem\n      return {...scopes}\n    })\n  }, [currentScope])\n\n  const setUnits = useCallback((value) => {\n    setIsReset(false)\n    setUnitSystems(old => {\n      const newSystems = {...old}\n      newSystems[selectedSystem].units = isFunction(value)\n        ? value(newSystems[selectedSystem].units)\n        : value\n      setScopes(scopes => {\n        scopes[currentScope].unitSystems = newSystems\n        return {...scopes}\n      })\n      return newSystems\n    })\n  }, [currentScope, selectedSystem])\n\n  const values = useMemo(() => {\n    return {\n      units: unitSystems[selectedSystem].units,\n      setUnits: setUnits,\n      unitSystems,\n      unitMap,\n      dimensionMap,\n      selected: selectedSystem,\n      setSelected,\n      reset,\n      isReset,\n      setScopeInfo,\n      scope,\n      setScope\n    }\n  }, [unitSystems, selectedSystem, setUnits, setSelected, reset, isReset, setScopeInfo, scope, setScope])\n\n  return <unitContext.Provider value={values}>\n    {children}\n  </unitContext.Provider>\n})\n\nUnitProvider.propTypes = {\n  initialUnitSystems: PropTypes.object,\n  initialSelected: PropTypes.string,\n  children: PropTypes.node\n}\n\n/**\n * Convenience hook for using the current unit context.\n *\n * @returns Object containing the currently set units for each dimension (e.g.\n * {energy: 'joule'})\n */\nexport const useUnitContext = (scopeKey, defaultUnitSystem) => {\n  const context = useContext(unitContext)\n  const {setScopeInfo, scope, setScope, ...others} = context\n\n  useEffect(() => {\n    setScope(!scopeKey ? scopeKey : 'Schema')\n  }, [scopeKey, setScope])\n\n  useEffect(() => {\n    if (scopeKey && scope === 'Schema') {\n      setScopeInfo(scopeKey, defaultUnitSystem)\n    } else {\n      setScopeInfo('Global')\n    }\n  }, [scopeKey, scope, setScopeInfo, defaultUnitSystem])\n\n  return {...others, scope, setScope}\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {memoize, has, isNil} from 'lodash'\nimport {Unit} from './Unit'\nimport { Unit as UnitMathJS } from 'mathjs'\n\nexport const deltaPrefixes = ['delta_', '']\n\n/**\n * Convenience function for parsing value and unit information from a string.\n * Can parse values, units or both at the same time.\n *\n * @param {string} input The input string to parse\n * @param {object} options Parsing options. These include:\n *   - dimension: Dimension for the unit. Note that you should use the base\n *       dimensions which you can get e.g. with .dimension(true).\n *   - requireValue: Whether an explicit numeric value is required at the start\n  *      of the input.\n *   - requireUnit: Whether an explicit unit in the input is required.\n * @returns Object containing the following properties, if available:\n *  - value: Numerical value as a number\n *  - valueString: The original number input as a string. Note that this can only return\n *      the number when it is used as a prefix, and does not work with numbers\n *      that are part of a complex expression, e.g. 300 eV / 1000 K.\n *  - unit: Unit instance\n *  - error: Error messsage\n */\nexport function parse(input, options) {\n  options = {\n    dimension: null,\n    requireValue: false,\n    requireUnit: false,\n    ...options\n  } || {}\n\n  const result = {}\n\n  try {\n    const parseResults = parseInternal(input, options)\n    result.value = isNil(parseResults.value) ? undefined : parseResults.value\n    result.valueString = parseResults.valueString || undefined\n    if (parseResults.unit?.units?.length) {\n      result.unit = new Unit(parseResults.unit)\n    }\n  } catch (e) {\n    result.error = e.message\n    return result\n  }\n\n  // TODO: This check is not enough: the input may be compatible after the base\n  // units are compared.\n  if (options.dimension !== null && result.unit) {\n    if (!(result.unit.dimension(true) === options.dimension || result.unit.dimension(false) === options.dimension)) {\n      result.error = `Unit \"${result.unit.label(false)}\" is incompatible with dimension \"${options.dimension}\".`\n    }\n  }\n\n  return result\n}\n\n/**\n * Parse a string into an optional value and a MathJS Unit definition.\n *\n * Throws an exception if the provided string does not contain a valid unit or\n * cannot be parsed.\n *\n * @memberof Unit\n * @param {string} str A string like \"5.2 inch\", \"4e2 cm/s^2\"\n * @param {object} options Parsing options. These include:\n *   - requireValue: Whether an explicit numeric value is required at the start\n  *      of the input.\n *   - requireUnit: Whether an explicit unit in the input is required.\n * @returns Object containing the following properties, if available:\n *  - value: Numerical value as a number\n *  - valueString: The original number input as a string. Note that this can only return\n *      the number when it is used as a prefix, and does not work with numbers\n *      that are part of a complex expression, e.g. 300 eV / 1000 K.\n *  - unit: Unit instance\n */\nexport function parseInternal(str, options) {\n  // Replace ** with ^\n  str = str.replace(/\\*\\*/g, '^')\n\n  options = options || {}\n  const text = str\n  let index = -1\n  let c = ''\n\n  function skipWhitespace() {\n    while (c === ' ' || c === '\\t') {\n      next()\n    }\n  }\n\n  function isDigitDot(c) {\n    return ((c >= '0' && c <= '9') || c === '.')\n  }\n\n  function isDigit(c) {\n    return ((c >= '0' && c <= '9'))\n  }\n\n  function next() {\n    index++\n    c = text.charAt(index)\n  }\n\n  function revert(oldIndex) {\n    index = oldIndex\n    c = text.charAt(index)\n  }\n\n  function parseUnit() {\n    let unitName = ''\n\n    // Alphanumeric characters only; matches [a-zA-Z0-9]\n    while (isDigit(c) || UnitMathJS.isValidAlpha(c)) {\n      unitName += c\n      next()\n    }\n\n    // Must begin with [a-zA-Z]\n    const firstC = unitName.charAt(0)\n    if (UnitMathJS.isValidAlpha(firstC)) {\n      return unitName\n    } else {\n      return null\n    }\n  }\n\n  function parseCharacter(toFind) {\n    if (c === toFind) {\n      next()\n      return toFind\n    } else {\n      return null\n    }\n  }\n\n  function parseNumber() {\n    let number = ''\n    const oldIndex = index\n\n    if (c === '+') {\n      next()\n    } else if (c === '-') {\n      number += c\n      next()\n    }\n\n    if (!isDigitDot(c)) {\n      // a + or - must be followed by a digit\n      revert(oldIndex)\n      return null\n    }\n\n    // get number, can have a single dot\n    if (c === '.') {\n      number += c\n      next()\n      if (!isDigit(c)) {\n        // this is no legal number, it is just a dot\n        revert(oldIndex)\n        return null\n      }\n    } else {\n      while (isDigit(c)) {\n        number += c\n        next()\n      }\n      if (c === '.') {\n        number += c\n        next()\n      }\n    }\n    while (isDigit(c)) {\n      number += c\n      next()\n    }\n\n    // check for exponential notation like \"2.3e-4\" or \"1.23e50\"\n    if (c === 'E' || c === 'e') {\n      // The grammar branches here. This could either be part of an exponent or the start of a unit that begins with the letter e, such as \"4exabytes\"\n\n      let tentativeNumber = ''\n      const tentativeIndex = index\n\n      tentativeNumber += c\n      next()\n\n      if (c === '+' || c === '-') {\n        tentativeNumber += c\n        next()\n      }\n\n      // Scientific notation MUST be followed by an exponent (otherwise we assume it is not scientific notation)\n      if (!isDigit(c)) {\n        // The e or E must belong to something else, so return the number without the e or E.\n        revert(tentativeIndex)\n        return number\n      }\n\n      // We can now safely say that this is scientific notation.\n      number = number + tentativeNumber\n      while (isDigit(c)) {\n        number += c\n        next()\n      }\n    }\n\n    return number\n  }\n\n  if (typeof text !== 'string') {\n    throw new TypeError('Invalid argument in Unit.parse, string expected')\n  }\n\n  const unit = new UnitMathJS()\n  unit.units = []\n\n  let powerMultiplierCurrent = 1\n  let expectingUnit = false\n\n  // A unit should follow this pattern:\n  // [number] ...[ [*/] unit[^number] ]\n  // unit[^number] ... [ [*/] unit[^number] ]\n\n  // Rules:\n  // number is any floating point number.\n  // unit is any alphanumeric string beginning with an alpha. Units with names like e3 should be avoided because they look like the exponent of a floating point number!\n  // The string may optionally begin with a number.\n  // Each unit may optionally be followed by ^number.\n  // Whitespace or a forward slash is recommended between consecutive units, although the following technically is parseable:\n  //   2m^2kg/s^2\n  // it is not good form. If a unit starts with e, then it could be confused as a floating point number:\n  //   4erg\n\n  next()\n  skipWhitespace()\n\n  // Optional number at the start of the string\n  const valueString = parseNumber()\n  let value = null\n  if (valueString) {\n    value = parseFloat(valueString)\n    skipWhitespace() // Whitespace is not required here\n\n    // handle multiplication or division right after the value, like '1/s'\n    if (parseCharacter('*')) {\n      powerMultiplierCurrent = 1\n      expectingUnit = true\n    } else if (parseCharacter('/')) {\n      powerMultiplierCurrent = -1\n      expectingUnit = true\n    }\n  } else if (options.requireValue) {\n    throw new SyntaxError('Enter a valid numerical value')\n  }\n\n  // Stack to keep track of powerMultipliers applied to each parentheses group\n  const powerMultiplierStack = []\n\n  // Running product of all elements in powerMultiplierStack\n  let powerMultiplierStackProduct = 1\n\n  while (true) {\n    skipWhitespace()\n\n    // Check for and consume opening parentheses, pushing powerMultiplierCurrent to the stack\n    // A '(' will always appear directly before a unit.\n    while (c === '(') {\n      powerMultiplierStack.push(powerMultiplierCurrent)\n      powerMultiplierStackProduct *= powerMultiplierCurrent\n      powerMultiplierCurrent = 1\n      next()\n      skipWhitespace()\n    }\n\n    // Is there something here?\n    let uStr\n    if (c) {\n      const oldC = c\n      uStr = parseUnit()\n      if (uStr === null) {\n        throw new SyntaxError('Unexpected \"' + oldC + '\" in \"' + text + '\" at index ' + index.toString())\n      }\n    } else {\n      // End of input.\n      break\n    }\n\n    // Verify the unit exists and get the prefix (if any)\n    const res = findUnit(uStr)\n    if (res === null) {\n      // Unit not found.\n      throw new SyntaxError('Unit \"' + uStr + '\" not found.')\n    }\n\n    let power = powerMultiplierCurrent * powerMultiplierStackProduct\n    // Is there a \"^ number\"?\n    skipWhitespace()\n    if (parseCharacter('^')) {\n      skipWhitespace()\n      const p = parseNumber()\n      if (p === null) {\n        // No valid number found for the power!\n        throw new SyntaxError('In \"' + str + '\", \"^\" must be followed by a floating-point number')\n      }\n      power *= p\n    }\n\n    // Add the unit to the list\n    unit.units.push({\n      unit: res.unit,\n      prefix: res.prefix,\n      delta: res.delta,\n      power\n    })\n    for (let i = 0; i < UnitMathJS.BASE_DIMENSIONS.length; i++) {\n      unit.dimensions[i] += (res.unit.dimensions[i] || 0) * power\n    }\n\n    // Check for and consume closing parentheses, popping from the stack.\n    // A ')' will always follow a unit.\n    skipWhitespace()\n    while (c === ')') {\n      if (powerMultiplierStack.length === 0) {\n        throw new SyntaxError('Unmatched \")\" in \"' + text + '\" at index ' + index.toString())\n      }\n      powerMultiplierStackProduct /= powerMultiplierStack.pop()\n      next()\n      skipWhitespace()\n    }\n\n    // \"*\" and \"/\" should mean we are expecting something to come next.\n    // Is there a forward slash? If so, negate powerMultiplierCurrent. The next unit or paren group is in the denominator.\n    expectingUnit = false\n\n    if (parseCharacter('*')) {\n      // explicit multiplication\n      powerMultiplierCurrent = 1\n      expectingUnit = true\n    } else if (parseCharacter('/')) {\n      // division\n      powerMultiplierCurrent = -1\n      expectingUnit = true\n    } else {\n      // implicit multiplication\n      powerMultiplierCurrent = 1\n    }\n\n    // Replace the unit into the auto unit system\n    if (res.unit.base) {\n      const baseDim = res.unit.base.key\n      UnitMathJS.UNIT_SYSTEMS.auto[baseDim] = {\n        unit: res.unit,\n        prefix: res.prefix\n      }\n    }\n  }\n\n  // Has the string been entirely consumed?\n  skipWhitespace()\n  if (c) {\n    throw new SyntaxError('Could not parse: \"' + str + '\"')\n  }\n\n  // Is there a trailing slash?\n  if (expectingUnit) {\n    throw new SyntaxError('Trailing characters: \"' + str + '\"')\n  }\n\n  // Is the parentheses stack empty?\n  if (powerMultiplierStack.length !== 0) {\n    throw new SyntaxError('Unmatched \"(\" in \"' + text + '\"')\n  }\n\n  // Are there any units at all?\n  if (unit.units.length === 0 && options.requireUnit) {\n    throw new SyntaxError('Unit is required')\n  }\n\n  return {value, valueString, unit}\n}\n\n/**\n * Find a unit from a string\n *\n * @param {string} str A string like 'cm' or 'inch'\n * @returns {Object | null} When found, an object with fields unit and\n*    prefix is returned. Else, null is returned.\n */\nconst findUnit = memoize((str) => {\n  // First, match units names exactly. For example, a user could define 'mm' as\n  // 10^-4 m, which is silly, but then we would want 'mm' to match the\n  // user-defined unit.\n  if (has(UnitMathJS.UNITS, str)) {\n    const unit = UnitMathJS.UNITS[str]\n    const prefix = unit.prefixes['']\n    return { unit, prefix, delta: false }\n  }\n\n  for (const name in UnitMathJS.UNITS) {\n    if (has(UnitMathJS.UNITS, name)) {\n      if (str.endsWith(name)) {\n        const unit = UnitMathJS.UNITS[name]\n        const prefixLen = (str.length - name.length)\n        let prefixName = str.substring(0, prefixLen)\n        let delta = false\n        for (const deltaPrefix of deltaPrefixes) {\n          if (prefixName.startsWith(deltaPrefix)) {\n            prefixName = prefixName.substring(deltaPrefix.length)\n            delta = true\n            break\n          }\n        }\n        const prefix = has(unit.prefixes, prefixName)\n          ? unit.prefixes[prefixName]\n          : undefined\n        if (prefix !== undefined) {\n          return { unit, prefix, delta }\n        }\n      }\n    }\n  }\n\n  return null\n})\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {isNil, has, isString} from 'lodash'\nimport {Unit as UnitMathJS} from 'mathjs'\nimport {unitToAbbreviationMap} from './UnitContext'\nimport {parseInternal} from './common'\n\nexport const DIMENSIONLESS = 'dimensionless'\n\n/**\n * Helper class for persisting unit information.\n *\n * Builds upon the math.js Unit class, but adds additional functionality,\n * including:\n *  - Ability to convert to any unit system given as an argument\n *  - Abbreviated labels for dense formatting\n */\nexport class Unit {\n  /**\n   * @param {str | Unit} unit Unit for the quantity.\n   */\n  constructor(unit) {\n    if (isString(unit)) {\n      unit = parseInternal(unit, {requireUnit: true}).unit\n    } else if (unit instanceof Unit) {\n      unit = unit.mathjsUnit.clone()\n    } else if (unit instanceof UnitMathJS) {\n      unit = unit.clone()\n    } else {\n      throw Error('Please provide the unit as a string or as an instance of Unit.')\n    }\n    this.mathjsUnit = unit\n  }\n\n  /**\n   * Checks if the given unit has the same base dimensions as this one.\n   * @param {str | Unit} unit Unit to compare to\n   * @returns boolean Whether the units have the same base dimensions.\n   */\n  equalBase(unit) {\n    if (isString(unit)) {\n      unit = new Unit(unit)\n    }\n    return this.mathjsUnit.equalBase(unit.mathjsUnit)\n  }\n\n  /**\n   * Used to create a human-readable description of the unit as a string.\n   *\n   * @param {bool} abbreviate Whether to abbreviate the label using the\n   * abbreviations for each unit and prefix. If false, the original unit names\n   * (as given or defined by the unit system) are used.\n   * @returns A string representing the unit.\n   */\n  label(abbreviate = true, showDelta = false) {\n    // TODO: The label caching is disabled for now. Because Quantities are\n    // stored as recoil.js atoms, they become immutable which causes problems\n    // with internal state mutation.\n    const units = this.mathjsUnit.units\n    let strNum = ''\n    let strDen = ''\n    let nNum = 0\n    let nDen = 0\n\n    function getDelta(unit) {\n      return (showDelta && unit.delta)\n        ? abbreviate ? '' : 'delta_'\n        : ''\n    }\n\n    function getName(unit) {\n      if (unit.base.key === DIMENSIONLESS) return ''\n      return abbreviate\n        ? unitToAbbreviationMap?.[unit.name] || unit.name\n        : unit.name\n    }\n\n    function getPrefix(original) {\n      if (!abbreviate) return original\n      const prefixMap = {\n        // SI\n        deca: 'da',\n        hecto: 'h',\n        kilo: 'k',\n        mega: 'M',\n        giga: 'G',\n        tera: 'T',\n        peta: 'P',\n        exa: 'E',\n        zetta: 'Z',\n        yotta: 'Y',\n        deci: 'd',\n        centi: 'c',\n        milli: 'm',\n        micro: 'u',\n        nano: 'n',\n        pico: 'p',\n        femto: 'f',\n        atto: 'a',\n        zepto: 'z',\n        yocto: 'y',\n        // IEC\n        kibi: 'Ki',\n        mebi: 'Mi',\n        gibi: 'Gi',\n        tebi: 'Ti',\n        pebi: 'Pi',\n        exi: 'Ei',\n        zebi: 'Zi',\n        yobi: 'Yi'\n      }\n      return prefixMap?.[original] || original\n    }\n\n    for (let i = 0; i < units.length; i++) {\n      const unitDef = units[i]\n      if (unitDef.power > 0) {\n        nNum++\n        const prefix = getPrefix(unitDef.prefix.name)\n        const name = getName(unitDef.unit)\n        const delta = getDelta(unitDef)\n        strNum += ` ${delta}${prefix}${name}`\n        if (Math.abs(unitDef.power - 1.0) > 1e-15) {\n          strNum += '^' + unitDef.power\n        }\n      } else if (unitDef.power < 0) {\n        nDen++\n      }\n    }\n\n    if (nDen > 0) {\n      for (let i = 0; i < units.length; i++) {\n        const unitDef = units[i]\n        if (unitDef.power < 0) {\n          const prefix = getPrefix(unitDef.prefix.name)\n          const name = getName(unitDef.unit)\n          const delta = getDelta(unitDef)\n          if (nNum > 0) {\n            strDen += ` ${delta}${prefix}${name}`\n            if (Math.abs(unitDef.power + 1.0) > 1e-15) {\n              strDen += '^' + (-unitDef.power)\n            }\n          } else {\n            strDen += ` ${delta}${prefix}${name}`\n            strDen += '^' + (unitDef.power)\n          }\n        }\n      }\n    }\n    // Remove leading whitespace\n    strNum = strNum.substr(1)\n    strDen = strDen.substr(1)\n\n    // Add parentheses for better copy/paste back into evaluate, for example, or\n    // for better pretty print formatting\n    if (nNum > 1 && nDen > 0) {\n      strNum = '(' + strNum + ')'\n    }\n    if (nDen > 1 && nNum > 0) {\n      strDen = '(' + strDen + ')'\n    }\n\n    let str = strNum\n    if (nNum > 0 && nDen > 0) {\n      str += ' / '\n    }\n    str += strDen\n\n    return str\n  }\n\n  /**\n   * Gets the dimension of this unit as a string. The order of the dimensions is\n   * fixed (determined at unit registration time).\n   *\n   * @param {boolean} base Whether to return dimension in base units. Otherwise\n   * the original unit dimensions are used.\n   * @returns The dimensionality as a string, e.g. 'time^2 energy mass^-2'\n   */\n  dimension(base = false) {\n    const dimensions = Object.keys(UnitMathJS.BASE_UNITS)\n    const dimensionMap = Object.fromEntries(dimensions.map(name => [name, 0]))\n\n    if (base) {\n      const BASE_DIMENSIONS = UnitMathJS.BASE_DIMENSIONS\n      for (let i = 0; i < BASE_DIMENSIONS.length; ++i) {\n        const power = this?.mathjsUnit.dimensions?.[i]\n        if (power) {\n          dimensionMap[BASE_DIMENSIONS[i]] += power\n        }\n      }\n    } else {\n      for (const unit of this?.mathjsUnit.units) {\n        const power = unit.power\n        if (power) {\n          dimensionMap[unit.unit.base.key] += power\n        }\n      }\n    }\n    const dims = Object.entries(dimensionMap).filter(d => d[1] !== 0)\n    return dims.length > 0\n      ? dims.map(d => `${d[0]}${((d[1] < 0 || d[1] > 1) && `^${d[1]}`) || ''}`).join(' ')\n      : DIMENSIONLESS\n  }\n\n  /**\n   * Function for converting to another unit.\n   *\n   * @param {str | Unit} unit The target unit\n   * @returns A new Unit expressed in the given units.\n   */\n  to(unit) {\n    let mathjsUnit\n    if (unit instanceof Unit) {\n      mathjsUnit = unit.mathjsUnit\n    } else if (isString(unit)) {\n      mathjsUnit = parseInternal(unit, {requireUnit: true}).unit\n    } else {\n      throw Error('Unknown unit type. Please provide the unit as as string or as instance of Unit.')\n    }\n    return new Unit(this.mathjsUnit.to(mathjsUnit))\n  }\n\n  /**\n   * Converts all units to their delta versions.\n   *\n   * @returns A new Unit with delta units.\n   */\n  toDelta() {\n    const unitMathJS = this.mathjsUnit.clone()\n    for (const unit of unitMathJS.units) {\n      unit.delta = true\n    }\n    return new Unit(unitMathJS)\n  }\n\n  /**\n   * Function for converting the value of this Unit to the SI unit system.\n   *\n   * @returns A new Unit instance in the SI unit system.\n   */\n  toSI() {\n    return this.toSystem({\n      \"dimensionless\": { \"definition\": \"dimensionless\" },\n      \"length\": { \"definition\": \"m\" },\n      \"mass\": { \"definition\": \"kg\" },\n      \"time\": { \"definition\": \"s\" },\n      \"current\": { \"definition\": \"A\" },\n      \"temperature\": { \"definition\": \"K\" },\n      \"luminosity\": { \"definition\": \"cd\" },\n      \"luminous_flux\": { \"definition\": \"lm\" },\n      \"substance\": { \"definition\": \"mol\" },\n      \"angle\": { \"definition\": \"rad\" },\n      \"information\": { \"definition\": \"bit\" },\n      \"force\": { \"definition\": \"N\" },\n      \"energy\": { \"definition\": \"J\" },\n      \"power\": { \"definition\": \"W\" },\n      \"pressure\": { \"definition\": \"Pa\" },\n      \"charge\": { \"definition\": \"C\" },\n      \"resistance\": { \"definition\": \"\" },\n      \"conductance\": { \"definition\": \"S\" },\n      \"inductance\": { \"definition\": \"H\" },\n      \"magnetic_flux\": { \"definition\": \"Wb\" },\n      \"magnetic_field\": { \"definition\": \"T\" },\n      \"frequency\": { \"definition\": \"Hz\" },\n      \"luminance\": { \"definition\": \"nit\" },\n      \"illuminance\": { \"definition\": \"lx\" },\n      \"electric_potential\": { \"definition\": \"V\" },\n      \"capacitance\": { \"definition\": \"F\" },\n      \"activity\": { \"definition\": \"kat\" }\n    })\n  }\n\n  /**\n   * Function for converting the value of this unit to another unit system.\n   *\n   * Notice that converting a unit to another unit system is not as easy as\n   * conversions to a specific unit. When converting to a specific unit one can\n   * simply check that the dimensions match and go ahead with the conversion.\n   * With unit systems, there can be multiple alternative forms, and choosing a\n   * good one is more difficult. E.g. should 'a_u_force * angstrom' be converted\n   * into:\n   *\n   * a) N m\n   * b) J\n   * c) (kg m^2) / s^2\n   *\n   * By default this function will try to preserve the original unit dimensions\n   * and not convert everything down to base units. If a derived unit is not\n   * present, it will, however, attempt to convert it to the base units. Any\n   * further simplication is not performed.\n   *\n   * If the converted unit has any delta-units, the converted units will also\n   * become delta-units.\n   *\n   * @param {object} system The target unit system.\n   * @returns A new Unit instance in the given system.\n   */\n  toSystem(system) {\n    // Go through the currently defined units, identify their dimension and look\n    // for the corresponding dimension in the given unit system. If one is\n    // present, convert to it. Otherwise convert to base dimensions.\n    const UNITS = UnitMathJS.UNITS\n    const PREFIXES = UnitMathJS.PREFIXES\n    const BASE_DIMENSIONS = UnitMathJS.BASE_DIMENSIONS\n    const BASE_UNITS = UnitMathJS.BASE_UNITS\n    const proposedUnitList = []\n    for (const unit of this.mathjsUnit.units) {\n      const dimension = unit.unit.base.key\n      const newUnitDefinition = system?.[dimension]?.definition\n\n      // If the unit for this dimension is defined, use it\n      if (!isNil(newUnitDefinition)) {\n        const newUnit = new Unit(newUnitDefinition)\n        for (const unitDef of newUnit.mathjsUnit.units) {\n          proposedUnitList.push({...unitDef, power: unitDef.power * unit.power, delta: unit.delta})\n        }\n      // Otherwise convert to base units\n      } else {\n        let missingBaseDim = false\n        const baseUnit = BASE_UNITS[dimension]\n        const newDimensions = baseUnit.dimensions\n        for (let i = 0; i < BASE_DIMENSIONS.length; i++) {\n          const baseDim = BASE_DIMENSIONS[i]\n          if (Math.abs(newDimensions[i] || 0) > 1e-12) {\n            if (has(system, baseDim)) {\n              let unitDef\n                const baseUnitDefinition = system[baseDim].definition\n                // First try to look up the unit in the list of known units:\n                // most likely it is already there. If not found, then we need\n                // to try and parse the unit definition: this happens e.g. when\n                // units with prefixes are used as base units in the unit\n                // system.\n                unitDef = UNITS[system[baseDim]?.definition]\n                if (!unitDef) {\n                  try {\n                    const baseUnit = new Unit(baseUnitDefinition)\n                    const baseUnitList = baseUnit.mathjsUnit.units\n                    if (baseUnitList.length === 1) unitDef = baseUnitList[0].unit\n                  } catch (e) {}\n                }\n              if (!unitDef) {\n                throw Error(`Could not find base unit for \"${system[baseDim].definition}\"`)\n              }\n              proposedUnitList.push({\n                unit: unitDef,\n                prefix: PREFIXES.NONE[''],\n                power: unit.power ? newDimensions[i] * unit.power : 0,\n                delta: unit.delta\n              })\n            } else {\n              missingBaseDim = true\n            }\n          }\n        }\n        if (missingBaseDim) {\n          throw Error(`The given unit system does not contain the required unit definitions for converting ${unit.name} with dimension ${dimension}.`)\n        }\n      }\n    }\n\n    const ret = this.mathjsUnit.clone()\n    ret.units = proposedUnitList\n    return new Unit(ret)\n  }\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {isNumber, isArray} from 'lodash'\nimport {Unit} from './Unit'\nimport {mapDeep} from '../../utils'\n\n/**\n * Class for persisting persisting a numeric value together with unit\n * information.\n */\nexport class Quantity {\n  /**\n   * @param {number | n-dimensional array of numbers} value Numeric value. See\n   * also the argument 'normalized'.\n   * @param {str | Unit} unit Unit for the quantity.\n   * @param {boolean} normalized Whether the given numeric value is already\n   * normalized to base units.\n   */\n  constructor(value, unit, normalized = false) {\n    this.unit = new Unit(unit)\n    if (!isNumber(value) && !isArray(value)) {\n      throw Error('Please provide the value for a Quantity as a number, or as a multidimensional array of numbers.')\n    }\n\n    // This attribute stores the quantity value in 'normalized' form that is\n    // given in the base units (=SI). This value should only be determined once\n    // during initialization and all calls to value() will then lazily determine\n    // the value in the currently set units. This avoids 'drift' in the value\n    // caused by several consecutive changes of the units.\n    this.normalized_value = normalized ? value : this.normalize(value)\n  }\n\n  /**\n   * Get value in current units.\n   * @returns The numeric value in the currently set units.\n   */\n  value() {\n    return this.denormalize(this.normalized_value)\n  }\n\n  /**\n   * Convert value from currently set units to base units.\n   * @param {n-dimensional array} value Value in currently set units.\n   * @returns Value in base units.\n   */\n  normalize(values) {\n    // Pre-calculate coefficients for currently set units. This speeds up\n    // conversion for large arrays.\n    const unit = this.unit.mathjsUnit\n    const ignoreOffset = unit._isDerived()\n    const coefficients = this.conversion_coefficients()\n\n    return mapDeep(values, (value) => {\n      if (value === null || value === undefined) {\n        return value\n      }\n\n      let result = value\n      for (let i = 0; i < unit.units.length; i++) {\n        const unitDef = unit.units[i]\n        const unitOffset = unitDef.unit.offset\n        const variable = (ignoreOffset || unitDef.delta)\n          ? result\n          : result + unitOffset\n        result = variable * coefficients[i]\n      }\n      return result\n    })\n  }\n\n  /**\n   * Convert value from base units to currently set units.\n   * @param {n-dimensional array} value Value in base units.\n   * @returns Value in currently set units.\n   */\n  denormalize(values) {\n    // Pre-calculate coefficients for currently set units. This speeds up\n    // conversion for large arrays.\n    const unit = this.unit.mathjsUnit\n    const ignoreOffset = unit._isDerived()\n    const coefficients = this.conversion_coefficients()\n\n    return mapDeep(values, (value) => {\n      if (value === null || value === undefined) {\n        return value\n      }\n\n      let result = value\n      for (let i = 0; i < unit.units.length; i++) {\n        const unitDef = unit.units[i]\n        const unitOffset = unitDef.unit.offset\n        result = (ignoreOffset || unitDef.delta)\n          ? result / coefficients[i]\n          : result / coefficients[i] - unitOffset\n      }\n      return result\n    })\n  }\n\n  /**\n   * Returns a set of conversion coefficients based on the currently set units.\n   * @returns Array of conversion coefficients, one for each unit that is present.\n   */\n  conversion_coefficients() {\n    const unit = this.unit.mathjsUnit\n    const coefficients = []\n    for (let i = 0; i < unit.units.length; i++) {\n      const unitDef = unit.units[i]\n      const unitValue = unitDef.unit.value\n      const unitPrefixValue = unitDef.prefix.value\n      const unitPower = unitDef.power\n      coefficients.push((Math.pow(unitValue * unitPrefixValue, unitPower)))\n    }\n    return coefficients\n  }\n\n  label() {\n    return this.unit.label()\n  }\n\n  dimension(base = false) {\n    return this.unit.dimension(base)\n  }\n\n  to(unit) {\n    return new Quantity(this.normalized_value, this.unit.to(unit), true)\n  }\n\n  toSI() {\n    return new Quantity(this.normalized_value, this.unit.toSI(), true)\n  }\n\n  toSystem(system) {\n    return new Quantity(this.normalized_value, this.unit.toSystem(system), true)\n  }\n\n  /**\n   * Checks if the given Quantity is equal to this one.\n   * @param {Quantity} quantity Quantity to compare to\n   * @returns boolean Whether quantities are equal\n    */\n  equal(quantity) {\n    if (quantity instanceof Quantity) {\n      return this.normalized_value === quantity.normalized_value && this.unit.equalBase(quantity.unit)\n    } else {\n      throw Error('The given value is not an instance of Quantity.')\n    }\n  }\n}\n","/* eslint-disable no-unused-vars */\n/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport minimatch from 'minimatch'\nimport { cloneDeep, merge, isSet, isNil, isArray, isString, isNumber, isPlainObject, startCase, isEmpty, keys } from 'lodash'\nimport { Quantity } from './components/units/Quantity'\nimport { format } from 'date-fns'\nimport jmespath from 'jmespath'\nimport { dateFormat, guiBase, apiBase, searchQuantities, parserMetadata, schemaSeparator, dtypeSeparator, yamlSchemaPrefix } from './config'\nconst crypto = require('crypto')\n\nconst parserLabels = Object.keys(parserMetadata).reduce((result, key) => {\n  const parser = parserMetadata[key]\n  result[`parsers/${parser.codeName}`] = parser.codeLabel\n  result[parser.codeName] = parser.codeLabel\n  return result\n}, {})\n\nexport const isEquivalent = (a, b) => {\n  // Create arrays of property names\n  const aProps = Object.getOwnPropertyNames(a)\n  const bProps = Object.getOwnPropertyNames(b)\n\n  // If number of properties is different,\n  // objects are not equivalent\n  if (aProps.length !== bProps.length) {\n    return false\n  }\n\n  for (let i = 0; i < aProps.length; i++) {\n    const propName = aProps[i]\n\n    // If values of same property are not equal,\n    // objects are not equivalent\n    if (a[propName] !== b[propName]) {\n      return false\n    }\n  }\n\n  // If we made it this far, objects\n  // are considered equivalent\n  return true\n}\n\nexport const capitalize = (s) => {\n  if (typeof s !== 'string') {\n    return ''\n  }\n  return s.charAt(0).toUpperCase() + s.slice(1)\n}\n\n/**\n * Recursive object traversal.\n *\n * @param {*} data The data to traverse.\n * @param {bool} fullPath Whether to return the full path as a list of keys. Defaults to\n *   false which means that only the last key is returned.\n * @return List of pairs of keys and values.\n */\nexport function traverseDeep(object, fullPath = false) {\n  const items = []\n  const traverse = (obj, path) => {\n    for (const [key, value] of Object.entries(obj)) {\n      const newPath = [...path]\n      newPath.push(key)\n      if (value && isPlainObject(value)) {\n        traverse(value, newPath)\n      } else {\n        items.push([fullPath ? [...newPath] : key, value])\n      }\n    }\n  }\n  traverse(object, [])\n  return items\n}\n\n/**\n * Used to resolve a property from a nested object. Also supports indices in the\n * path.\n *\n * @param {object} data The data to traverse.\n * @param {str} path Path to use\n * @return The value at the given path or undefined if none can be found.\n */\nexport function getDeep(data, path, separator = '.') {\n    const segments = path.split(separator)\n    return segments.reduce((current, segment) => current && current[segment], data)\n}\n\n/**\n * Used to retrieve all found options from a nested and repeated structure using\n * depth-first search.\n *\n * @param {object} data The data to traverse\n * @param {str} path Path to traverse\n * @return All found values at the given path. Empty list if nothing was found.\n */\nexport function getDeepAll(data, path, separator = '.') {\n  const segments = path.split(separator)\n  const values = []\n\n  function getRecursive(data, segments, values) {\n    let current = data\n    let i = 0\n    for (const segment of segments) {\n      i += 1\n      current = current[segment]\n      if (!current) break\n      if (isArray(current)) {\n        for (const item of current) {\n          getRecursive(item, segments.slice(i), values)\n        }\n      } else if (isPlainObject(current)) {\n        getRecursive(current, segments.slice(i + 1), values)\n      } else {\n        values.push(current)\n      }\n    }\n  }\n\n  getRecursive(data, segments, values)\n  return values\n}\n\n/**\n * Used to set a value to a nested object. Will create the hierarchy on the go\n * if it is missing.\n *\n * @param {object} data The data to traverse.\n * @param {str} path Path to use\n * @param {value} path Value to store\n */\nexport function setDeep(data, path, value, separator = '.') {\n  const segments = path.split(separator)\n  let current = data\n  for (let i = 0; i < segments.length; ++i) {\n    const segment = segments[i]\n    if (i === segments.length - 1) {\n      current[segment] = value\n    } else {\n      if (isNil(current[segment])) {\n        current[segment] = {}\n      }\n      current = current[segment]\n    }\n  }\n}\n\n/**\n * Map that works on n-dimensional arrays. Implemented with simple for loops for\n * performance.\n *\n * @param {*} value The original values.\n * @param {number} factor Number used for scaling.\n *\n * @return {*} A copy of the original data with numbers scaled.\n */\nexport function mapDeep(value, func) {\n  // Function for recursively applying the function\n  function mapRecursive(list, newList) {\n    const isScalarArray = !Array.isArray(list[0])\n    if (isScalarArray) {\n      for (let i = 0, size = list.length; i < size; ++i) {\n        newList.push(func(list[i]))\n      }\n    } else {\n      for (let i = 0, size = list.length; i < size; ++i) {\n        const iList = []\n        newList.push(iList)\n        mapRecursive(list[i], iList)\n      }\n    }\n  }\n  // If given a scalar variable, simply apply the function. If a list is given,\n  // perform the mapping recursively.\n  let newValue\n  if (!isArray(value)) {\n    newValue = func(value)\n  } else {\n    newValue = []\n    mapRecursive(value, newValue)\n  }\n  return newValue\n}\n\n/**\n * Scales values of an n-dimensional array.\n *\n * @param {n-dimensional array} value The original values.\n * @param {number} factor Scaling factor.\n *\n * @return {n-dimensional array} A copy of the original data with numbers scaled.\n */\nexport function scale(value, factor) {\n  return mapDeep(value, x => x * factor)\n}\n\n/**\n * Adds the given value to all elements of an n-dimensional array.\n *\n * @param {n-dimensional array} value The original values.\n * @param {number} addition Value to add.\n *\n * @return {n-dimensional array} A copy of the original data with the addition.\n */\nexport function add(value, addition) {\n  return mapDeep(value, x => x + addition)\n}\n\n/**\n * Used to calculate the distance between two n-dimensional points,\n *\n * @param {*} a First point\n * @param {*} b Second point\n *\n * @return {*} Euclidean distance between the given two points.\n */\nexport function distance(a, b) {\n  return a\n    .map((x, i) => Math.abs(x - b[i]) ** 2) // square the difference\n    .reduce((sum, now) => sum + now) ** // sum\n    (1 / 2)\n}\n\n/**\n * Used to merge two Javascript objects into a new third object by recursively\n * overwriting and extending the target object with properties from the source\n * object.\n *\n * @param {*} target The values to convert\n * @param {*} source Original unit.\n *\n * @return {*} A copy of the original data with units converted.\n */\nexport function mergeObjects(source, target, copy = false) {\n  // First create a deep clone that will be used as the returned object\n  const cloned = cloneDeep(target)\n  const val = merge(cloned, source)\n  return val\n}\n\nexport function arraysEqual(_arr1, _arr2) {\n  if (!Array.isArray(_arr1) || !Array.isArray(_arr2) || _arr1.length !== _arr2.length) {\n    return false\n  }\n\n  const arr1 = _arr1.concat().sort()\n  const arr2 = _arr2.concat().sort()\n\n  for (let i = 0; i < arr1.length; i++) {\n    if (arr1[i] !== arr2[i]) { return false }\n  }\n\n  return true\n}\n\nexport function onlyUnique(value, index, self) {\n  return self.indexOf(value) === index\n}\n\nexport function objectFilter(obj, predicate) {\n  return Object.keys(obj)\n    .filter(key => predicate(key))\n    .reduce((res, key) => {\n      res[key] = obj[key]\n      return res\n    }, {})\n}\n\nexport function titleCase(str) {\n  const splitStr = str.toLowerCase().split(/[_ ]/)\n  for (let i = 0; i < splitStr.length; i++) {\n    // You do not need to check if i is larger than splitStr length, as your for does that for you\n    // Assign it back to the array\n    splitStr[i] = splitStr[i].charAt(0).toUpperCase() + splitStr[i].substring(1)\n  }\n  // Directly return the joined string\n  return splitStr.join(' ')\n}\n\nexport function nameList(users, expanded) {\n  const names = users.map(user => titleCase(user.name)).filter(name => name !== '')\n  if (names.length > 3 && !expanded) {\n    return [names[0], names[names.length - 1]].join(', ') + ' et al'\n  } else {\n    return names.join(', ')\n  }\n}\n\nexport function authorList(entry, expanded) {\n  if (!entry) {\n    return ''\n  }\n\n  if (entry.external_db) {\n    if (entry.authors?.length > 1 && expanded) {\n      return `${entry.external_db} (${nameList(entry.authors)})`\n    }\n    return entry.external_db\n  } else {\n    return nameList(entry.authors || [], expanded)\n  }\n}\n\n/**\n * @param {*} entry metadata retrived from NOMAD api\n * @returns The name from the metadata, a fallback entry name for simulations, or null\n */\nexport function entryName(entry) {\n  const results = entry?.results\n  const name = entry?.entry_name\n  if (name) {\n    return name\n  }\n  const type = entryType(entry)\n  if (!type) {\n    return null\n  }\n  const formula = results?.material?.chemical_formula_hill\n  if (formula) {\n    return `${formula} ${type}`\n  }\n  return type\n}\n\n/**\n * @param {*} entry metadata retrived from NOMAD api\n * @returns The type from the metadata, a fallback entry type for simulations, or null\n */\nexport function entryType(entry) {\n  const results = entry?.results\n  let type = entry?.entry_type\n  if (type) {\n    return type\n  }\n  if (!(results?.method?.simulation && results?.material)) {\n    const parser = entry?.parser_name\n    if (!parser) {\n      return null\n    }\n    if (parser === 'parsers/eels') {\n      return 'EELS DB entry'\n    }\n    const program = parserLabels[parser]\n    if (!program) {\n      return null\n    }\n    return `${program} simulation`\n  }\n  type = ''\n  let workflow = results.method.workflow_name?.[0]\n  if (workflow === 'single_point') {\n    workflow = null\n  }\n  if (workflow) {\n    type += workflow + ' '\n  }\n  const program = results.method.simulation.program_name\n  if (program) {\n    type += program + ' '\n  }\n  if (type === '') {\n    return null\n  }\n  type += 'simulation'\n  return type\n}\n\n/**\n * Returns whether the used browser supports WebGL.\n * @return {boolean} Is WebGL supported.\n */\nlet hasWebGL\nexport function hasWebGLSupport() {\n  if (isNil(hasWebGL)) {\n    const w = window\n    try {\n      const canvas = document.createElement('canvas')\n      hasWebGL = !!(w.WebGLRenderingContext && (\n        canvas.getContext('webgl') ||\n        canvas.getContext('experimental-webgl'))\n      )\n    } catch (e) {\n      hasWebGL = false\n    }\n  }\n  return hasWebGL\n}\n\n/**\n * Converts the given structure in the format used by section_results into the\n * format used by the materia-library.\n *\n * @param {object} structure.\n *\n * @return {undefined|object} If the given structure cannot be converted,\n * returns an empty object.\n */\nexport function toMateriaStructure(structure) {\n  if (!structure) {\n    return undefined\n  }\n\n  try {\n    // Resolve atomic species using the labels and their mapping to chemical\n    // elements.\n    const speciesMap = new Map(structure.species.map(s => [s.name, s.chemical_symbols[0]]))\n\n    const structMateria = {\n      species: structure.species_at_sites.map(x => speciesMap.get(x)),\n      cell: structure.lattice_vectors\n        ? new Quantity(structure.lattice_vectors, 'meter').to('angstrom').value()\n        : undefined,\n      positions: new Quantity(structure.cartesian_site_positions, 'meter').to('angstrom').value(),\n      fractional: false,\n      pbc: structure.dimension_types ? structure.dimension_types.map((x) => !!x) : undefined\n    }\n    return structMateria\n  } catch (error) {\n    return {}\n  }\n}\n\n/**\n * Given an array of numbers, calculates and returns the difference between\n * each array item and the first value in the array.\n *\n * @param {array} values Array containing values\n *\n * @return {array} Array containing the total difference values.\n */\nexport function diffTotal(values) {\n  const diffValues = []\n  const initial = values[0]\n  for (let i = 0; i < values.length; i++) {\n    diffValues.push(values[i] - initial)\n  }\n  return diffValues\n}\n\n/**\n * Formats the given number.\n *\n * @param {number} value Number to format\n * @param {string} type Number data type.\n * @param {number} decimals Number of decimals to use. Note\n * @param {string} mode The formatting mode to use. One of:\n *  - 'scientific'\n *  - 'separators'\n *  - 'standard'\n *\n * @return {string} The number as a string with new formatting\n */\nexport function formatNumber(value, type = DType.Float, mode = 'scientific', decimals = 3) {\n  // Nill values\n  if (isNil(value)) {\n    return value\n  }\n  // Zero\n  if (value === 0) {\n    return value.toString()\n  }\n\n  // Scientific format. parseFloat is used to get rid of trailig insignificant\n  // zeros.\n  if (mode === 'scientific') {\n    const absValue = Math.abs(value)\n    return (absValue > 1e3 || absValue < 1e-2)\n      ? parseFloat(value.toExponential(decimals)).toExponential()\n      : parseFloat(Number(value.toFixed(decimals))).toString()\n  } else {\n    // Integers in-non-scientific formats are always shown without decimals\n    if (type?.startsWith('int')) {\n      decimals = 0\n    }\n    const formatted = Number(value.toFixed(decimals))\n    // Format with separators\n    if (mode === 'separators') {\n      return formatted.toLocaleString()\n    // Standard formatting\n    } else if (mode === 'standard') {\n      return formatted.toString()\n    // SI formatting\n    } else if (mode === 'SI') {\n      return approxInteger(formatted)\n    } else {\n      throw Error('Unknown formatting mode')\n    }\n  }\n}\n\n/**\n * Formats the given integer number.\n *\n * @param {number} value Integer to format\n *\n * @return {number} The number with new formatting\n */\nexport function formatInteger(value) {\n  return formatNumber(value, DType.Int, 'separators', 0)\n}\n\n/**\n * Formats the given timestamp.\n *\n * @param {number} value The timestamp to format\n * @return {str} The timestamp with new formatting\n */\nexport function formatTimestamp(value, mode = undefined) {\n  if (isNil(value)) {\n    return value\n  }\n\n  let format\n  switch (mode) {\n    case 'date':\n      format = {dateStyle: 'short'}\n      break\n    case 'time':\n      format = {timeStyle: 'short'}\n      break\n    default:\n      format = undefined\n  }\n\n  if (value.search(/([+-][0-9]{2}:[0-9]{2}|Z)\\b/) === -1) { // search for timezone information\n    try {\n      // assume UTC timestamp from server and attempt to manually add UTC timezone,\n      // new Date will wrongly assume local timezone.\n      const result = new Date(`${value}Z`).toLocaleString(undefined, format)\n      if (result !== 'Invalid Date') {\n        return result\n      }\n    } catch {}\n  }\n  // create string for timestamp with correct timezone information or fallback\n  return new Date(value).toLocaleString(undefined, format)\n}\n\n/**\n * Determines the data type of the given metainfo.\n *\n * @param {object | str} def The metainfo name or definition.\n *\n * @return {DType} The data type of the metainfo.\n */\nexport const DType = {\n  Int: 'int',\n  Float: 'float',\n  Timestamp: 'timestamp',\n  String: 'string',\n  Enum: 'enum',\n  Boolean: 'boolean',\n  Unknown: 'unknown'\n}\nconst numericTypes = new Set([DType.Int, DType.Float])\nexport const multiTypes = new Set([DType.String, DType.Enum, DType.Boolean])\nexport function getDatatype(quantity) {\n  if (typeof quantity === 'string') {\n    quantity = searchQuantities[quantity]\n  }\n  const type_data = quantity?.type?.type_data\n  const type_kind = quantity?.type?.type_kind\n\n  if (isString(type_data) && type_data.includes('int')) {\n    return DType.Int\n  } else if (isString(type_data) && type_data.includes('float')) {\n    return DType.Float\n  } else if (type_data === 'nomad.metainfo.metainfo._Datetime' || type_data === 'nomad.metainfo.data_type.Datetime') {\n    return DType.Timestamp\n  } else if (type_data === 'str') {\n    return DType.String\n  } else if (type_kind?.toLowerCase() === 'enum') {\n    return DType.Enum\n  } else if (type_data === 'bool') {\n    return DType.Boolean\n  } else {\n    return DType.Unknown\n  }\n}\n\n/**\n * Returns the unit of the given metainfo if any specified.\n *\n * @param {string} quantity The metainfo name (full path). Must exist in\n * window.nomadArtifacts.searchQuantities.\n *\n * @return {string} The unit of the metainfo or undefined if no unit definition\n * found.\n */\nexport function getUnit(quantity) {\n  return searchQuantities[quantity]?.unit\n}\n\n/**\n * Returns a function that can be used to serialize values for a given datatype.\n * @param {string} dtype The datatype\n * @param {bool} pretty Whether to serialize using a prettier, but possibly\n * lossy format.\n *\n * @return {func} Function for serializing values with the given datatype.\n */\nexport function getSerializer(dtype, pretty = true) {\n  if (numericTypes.has(dtype)) {\n    return (value, units) => {\n      if (isNil(value)) {\n        return value\n      }\n      if (value instanceof Quantity) {\n        const newVal = units ? value.toSystem(units) : value\n        const label = newVal.label()\n        const valueConv = newVal.value()\n        return `${pretty ? formatNumber(valueConv) : valueConv}${label ? ` ${label}` : ''}`\n      }\n      return pretty ? formatNumber(value) : value\n    }\n  } else if (dtype === DType.Timestamp) {\n    return (value) => {\n      if (isNil(value)) {\n        return value\n      }\n      return pretty ? format(new Date(value), dateFormat) : value\n    }\n  } else if (dtype === DType.Boolean) {\n    return (value) => value ? 'true' : 'false'\n  } else {\n    return (value) => value\n  }\n}\n\n/**\n *\n */\nexport function serializeMetainfo(quantity, value, units) {\n  const dtype = getDatatype(quantity)\n  if (dtype === DType.Int || dtype === DType.Float) {\n    if (!(value instanceof Quantity) && !isNil(value)) {\n      const unit = getUnit(quantity) || 'dimensionless'\n      value = new Quantity(value, unit)\n    }\n  }\n  const serializer = getSerializer(dtype)\n  return serializer(value, units)\n}\n\n/**\n * Returns a function that can be used to deserialize values for a given datatype.\n * @param {string} dtype The datatype\n * @param {string} dimension Optional dimension for the filter. Used to\n *   determine default unit when a dimensionless value is given.\n *\n * @return {func} Function for deserializing values with the given datatype.\n */\nexport function getDeserializer(dtype, dimension) {\n  if (numericTypes.has(dtype)) {\n    return (value, units) => {\n      if (isNil(value)) {\n        return value\n      }\n      if (isString(value)) {\n        const split = value.split(' ')\n        value = Number(split[0])\n        if (isNaN(value)) {\n          throw Error(`Could not parse the number ${split[0]}`)\n        }\n        return split.length === 1\n          ? new Quantity(value, units?.[dimension]?.definition || 'dimensionless')\n          : new Quantity(value, split[1])\n      } if (isNumber(value)) {\n        return new Quantity(value, units?.[dimension]?.definition || 'dimensionless')\n      }\n      return value\n    }\n  } else if (dtype === DType.Timestamp) {\n    return (value) => {\n      if (isNil(value)) {\n        return value\n      }\n      return parseInt(value)\n    }\n  } else if (dtype === DType.Boolean) {\n    return (value) => {\n      if (isNil(value)) {\n        return value\n      }\n      let newValue = value\n      if (isString(value)) {\n        const lowercase = value.toLowerCase()\n        const keywords = {\n          true: true,\n          false: false\n        }\n        newValue = keywords[lowercase]\n        if (isNil(newValue)) {\n          throw Error(`Could not parse boolean value from ${value}`)\n        }\n      }\n      return newValue\n    }\n  } else {\n    return (value) => {\n      const keywords = {\n        true: true,\n        false: false\n      }\n      if (value in keywords) {\n        return keywords[value]\n      }\n      return value\n    }\n  }\n}\n\n/**\n * Converts a set into an array. The array will be in the insertion order of the\n * set.\n *\n * @param {Set} target Set to be converted.\n *\n * @return {number} Array containing the total difference values.\n */\nexport function setToArray(target) {\n  if (target !== undefined && isSet(target)) {\n    return [...target]\n  }\n  return target\n}\n\n/**\n * A simple promise based sleep.\n * @param {} ms Time in ms.\n * @returns The promise. Use .then(() => ...) to do something after sleep.\n */\nexport function sleep(ms) {\n  return new Promise(resolve => setTimeout(resolve, ms))\n}\n\n/**\n * Converts a number into an approximated format with SI suffixes. The number is\n * guaranteed to be no longer than five characters, including the possible SI\n * suffix.\n *\n * @param {number} number Number to approximate\n *\n * @return {string} The number in approximated format.\n */\nexport function approxInteger(number) {\n  // Determine the number of digits and the tier of the number\n  const temp = Math.log10(Math.abs(number))\n  const tier = temp / 3 | 0\n\n  // What tier? (determines SI symbol)\n  const SISymbol = ['', 'k', 'M', 'G', 'T', 'P', 'E']\n\n  // If zero, we don't need a suffix\n  if (tier === 0) return number.toFixed(0)\n\n  // Get suffix and determine scale\n  const suffix = SISymbol[tier]\n  const scale = Math.pow(10, tier * 3)\n\n  // Scale the number and count the number of decimals\n  const scaled = number / scale\n  let nUsed, nDecimals\n  const split = scaled.toString().split('.')\n  if (split.length > 1) {\n    nUsed = split[0].length\n    nDecimals = split[1].length\n  } else {\n    nUsed = split[0].length\n    nDecimals = 0\n  }\n\n  // Format number and add suffix\n  return scaled.toFixed(Math.min(3 - nUsed, nDecimals)) + suffix\n}\n\n/**\n * Forces the given function to be placed in the Javascript event queue and\n * executed once the queue is free. Returns a promise that also correctly\n * catches errors within the execution.\n *\n * @param {func} func Function to delay\n */\nexport function delay(func) {\n  return new Promise((resolve, reject) => {\n    setTimeout(() => {\n      try {\n        func()\n        resolve()\n      } catch (e) {\n        reject(e)\n      }\n    })\n  })\n}\n\n/**\n * Returns the correct form (plural/singular) for the given word. The syntax is\n * similar to the \"pluralize\"-library.\n *\n * @param {string} word The word to pluralize\n * @param {count} number How many of the words exist\n * @param {boolean} inclusive Whether to prefix with the number (e.g. 3 ducks)\n * @param {boolean} format Whether to format the number.\n * @param {string} prefix An optional prefix that is placed between the number\n * and the word.\n */\nexport function pluralize(word, count, inclusive, format = true, prefix) {\n  // Dictionary of known words. If it becomes too bothersome to keep track of\n  // these words, the pluralize-library should be used instead.\n  const dictionary = {\n    'result': 'results',\n    'entry': 'entries',\n    'value': 'values',\n    'material': 'materials',\n    'dataset': 'datasets',\n    'item': 'items',\n    'upload': 'uploads',\n    'code': 'codes',\n    'manager': 'managers',\n    'filter': 'filters',\n    'mainfile': 'mainfiles',\n    'folder': 'folders',\n    'has': 'have',\n    'activity': 'activities',\n    'parser': 'parsers',\n    'normalizer': 'normalizers',\n    'app': 'apps',\n    'package': 'packages'\n  }\n  const words = word.trim().split(\" \")\n  let lastWord = words[words.length - 1]\n  const isPossessive = lastWord.endsWith(\"'s\")\n  if (isPossessive) {\n    lastWord = lastWord.slice(0, -2)\n  }\n  let plural = dictionary[lastWord]\n  if (isNil(plural)) {\n    throw Error(`The word ${word} is not in the dictionary, please add it.`)\n  }\n  if (isPossessive) {\n    plural = plural.endsWith(\"s\") ? `${plural}'` : `${plural}'s`\n  }\n  words[words.length - 1] = plural\n  plural = words.join(\" \")\n  const form = count === 1\n    ? word\n    : plural\n\n  const number = inclusive\n    ? format ? formatNumber(count, DType.Int, 'separators', 0) : count\n    : undefined\n  return `${isNil(number)\n    ? ''\n    : `${number} `}${isNil(prefix)\n    ? ''\n    : `${prefix} `}${form}`\n}\n\n/**\n * Used to create a formatted label for a metainfo name or value. Replaces\n * underscores with whitespace and capitalizes the first letters.\n *\n * @param {str} name Metainfo name\n * @returns A formatted label constructed from the metainfo name.\n */\nexport function formatLabel(label) {\n  label = label.replace(/_/g, ' ')\n  label = startCase(label)\n  return label\n}\n\n/**\n * Used for testing purposes: setting a data-testid to this value signals that the\n * component waits for further updates of some kind. This is used by some automated tests\n * to determine if a component is *really* done rendering (when we don't really care what\n * we are waiting for, and just want a way to determine when we're done). When done,\n * the data-testid should be removed or updated to something else.\n */\nexport const isWaitingForUpdateTestId = 'waiting-for-update'\n\n/**\n * Removes indentation from the given multiline code string\n * @param {*} code\n */\nexport function stripIndent(code) {\n  let lines = code.split('\\n')\n  const start = lines.findIndex(line => line.trim() !== '')\n  lines = lines.slice(start)\n  if (lines.length === 0) {\n    return ''\n  }\n  const indent = lines[0].length - lines[0].trimStart().length\n  return lines.map(line => line.substring(indent)).join('\\n')\n}\n\n/**\n * Used to imperatively get a path that works for react-router and points to the\n * currently displayed page. The useLocation hook should be preferred, but\n * sometimes getting the path imperatively can prevent unnecessary renders.\n *\n * @returns A formatted label constructed from the metainfo name.\n */\nexport function getLocation() {\n  return `${window.location.pathname.slice(guiBase.length)}`\n}\n\n/**\n * Calculates the entryId given the uploadId, the mainfile, and, optionally, the mainfileKey.\n */\n export function generateEntryId(uploadId, mainfile, mainfileKey) {\n  const hash = crypto.createHash('sha512').update(uploadId).update(mainfile)\n  if (mainfileKey) {\n    hash.update(mainfileKey)\n  }\n  return hash.digest('base64').slice(0, 28)\n    .replace(/\\+/g, '-') // Convert '+' to '-'\n    .replace(/\\//g, '_') // Convert '/' to '_'\n}\n\n/**\n * Utilities parse and analyze *nomad urls*. A nomad url identifies some *base resource*,\n * which can be:\n *  1) a nomad deployment,\n *  2) an upload,\n *  3) an archive, or\n *  4) a metainfo schema.\n *\n * A *metainfo schema* is a json data structure, which is either\n *  A) the system metainfo, generated from the python classes,\n *  B) provided in an entry uploaded by a user, or\n *  C) a *frozen* metainfo schema.\n * A frozen metainfo schema is a historical \"snapshot\" of a metainfo schema provided using\n * method A or B. The only difference between the frozen version and the original version is that\n * in the frozen version, references to other metainfo schemas are replaced with references to\n * frozen versions of these schemas. The purpose of this is to allow us to handle changing\n * metainfo schemas.\n *\n * In addition to specifying the base resource, a nomad url can specify a location *within*\n * this resource (identifying a raw file or folder in an upload, a location in an archive, or\n * a section in a metainfo schema). For urls identifying sections in a metainfo schema,\n * it is generally also possible to specify a versionHash, which uniquely identifies a frozen\n * version of this section definition.\n *\n * Nomad urls can be absolute or relative. Absolute urls contain all information needed to\n * locate the resource, including the nomad deployment url. Relative urls can only be resolved\n * when given a *base url*, which defines our \"point of origin\".\n *\n * Possible formats (expressions in [brackets] are optional):\n * ----------------------------------------------------------\n *  Absolute urls:\n *    <deploymentUrl>\n *    <deploymentUrl>/uploads/<uploadId> [ /raw/<rawPath> [ #<dataPath> [ @<versionHash> ] ] ]\n *    <deploymentUrl>/uploads/<uploadId>/archive/<entryid> [ #<dataPath> [ @<versionHash> ] ]\n *    <deploymentUrl>/uploads/<uploadId>/archive/mainfile/<mainfile> [ #<dataPath> [ @<versionHash> ] ]\n *  Urls relative to the current deployment:\n *    ../uploads/<uploadId> [ /raw/<rawPath> [ #<dataPath> [ @<versionHash> ] ] ]\n *    ../uploads/<uploadId>/archive/<entryid> [ #<dataPath> [ @<versionHash> ] ]\n *    ../uploads/<uploadId>/archive/mainfile/<mainfile> [ #<dataPath> [ @<versionHash> ] ]\n *    <qualifiedName> (TODO: how to handle versions, deploymentUrl etc)\n *  Urls relative to the current upload:\n *    ../upload [ /raw/<rawPath> [ #<dataPath> [ @<versionHash> ] ] ]\n *    ../upload/archive/<entryid> [ #<dataPath> [ @<versionHash> ] ]\n *    ../upload/archive/mainfile/<mainfile> [ #<dataPath> [ @<versionHash> ] ]\n *  Urls relative to the current data (i.e. current archive or metainfo schema json):\n *    #<dataPath> (preferred)\n *    /<dataPath>\n * Note:\n *  - An <deploymentUrl> is a normal url, starting with \"http://\" or \"https://\", locating\n *    the api of the nomad deployment. Should always end with \"/api\".\n *    Example:\n *      https://nomad-lab.eu/prod/rae/api\n *  - Urls with versionHash are considered to be relative to the deployment rather than the\n *    upload or data.\n *  - The rawPath and mainFile paths need to be escaped with urlEncodePath to ensure a valid url.\n *    (i.e. each segment needs to individually be escaped using encodeURIComponent)\n *  - The dataPath, if provided, must always start from the root of the archive.\n *    Leading and duplicate slashes are ignored.\n *  - If the first segment in dataPath is 'definitions' or 'packages', the url is recognized\n *    as a reference to a metainfo schema.\n *  - Metainfo sections defined in python can be referred using the qualifiedName, which\n *    is a \"python style\" name of alphanumerics separated by dots.\n *  - If no versionHash is specified for a url identifying a metainfo schema, it means\n *    we refer to the version defined by the base url (if the url is schema-relative), otherwise\n *    the latest version (in the nomad deployment in question).\n */\n\nexport const systemMetainfoUrl = `system-metainfo` // TODO: should use absolute url with hash when implemented\n\n/**\n * Enum for the `type` attribute of parsed/resolved url objects\n */\nexport const refType = Object.freeze({\n  deployment: 'deployment',\n  upload: 'upload',\n  archive: 'archive',\n  metainfo: 'metainfo'\n})\n\n/**\n * Enum for the `relativeTo` attribute of parsed/resolved url objects\n */\nexport const refRelativeTo = Object.freeze({\n  deployment: 'deployment',\n  upload: 'upload',\n  data: 'data',\n  nothing: null\n})\n\n/**\n * Parses a nomad url and returns an object with the following attributes:\n *  url\n *    the original url string.\n *  type\n *    One of: refType.deployment | refType.upload | refType.archive | refType.metainfo\n *  relativeTo\n *    One of: refRelativeTo.deployment | refRelativeTo.upload | refRelativeTo.data | refRelativeTo.nothing (null)\n *  deploymentUrl\n *    The nomad deployment url, if it can be determined.\n *  uploadId\n *    The uploadId, if it can be determined.\n *  entryId\n *    The entryId, if it can be determined.\n *  mainfile\n *    The mainfile path, if it can be determined (unescaped!).\n *  path\n *    The path within the base resource (dataPath | rawPath (unescaped!)), if specified.\n *    If it is a dataPath, it will have a leading slash.\n *  qualifiedName\n *    The qualifiedName, if specified.\n *  versionHash\n *    The versionHash, if specified.\n *  isResolved\n *    True if the url is fully resolved, i.e. we have everything we need to fetch the data.\n *  isExternal\n *    If the url refers to a resource in an external nomad deployment. Note, for relative\n *    urls the value will be undefined, which means we don't know.\n *\n * If the url cannot be parsed, an error is thrown.\n *\n * @param {*} url either a string, or an object. If an object, it is expected to be parsed already,\n *    and we will return the object \"as is\" directly, without any parsing.\n */\nexport function parseNomadUrl(url) {\n  if (isPlainObject(url) && url.url && url.type) return url // already parsed, pass through.\n  const prefix = `Could not parse nomad url \"${url}\": `\n  if (!url) throw new Error(prefix + 'empty value')\n  if (typeof url !== 'string') throw new Error(prefix + 'bad type, expected string, got ' + typeof url)\n\n  if (url === systemMetainfoUrl) {\n    // TODO proper handling, using a url containing deploymentUrl + versionHash somehow?\n    return {\n      url,\n      relativeTo: refRelativeTo.deployment,\n      type: refType.metainfo,\n      deploymentUrl: apiBase,\n      isResolved: true,\n      isExternal: false\n    }\n  }\n\n  let relativeTo, type, deploymentUrl, uploadId, entryId, mainfile, path, qualifiedName, versionHash\n  let dataPath, rest, rawPath\n  if (url.startsWith('/')) {\n    dataPath = url\n    rest = ''\n  } else {\n    const bracketPos = url.indexOf('#')\n    dataPath = bracketPos !== -1 ? url.slice(bracketPos + 1) : undefined\n    rest = bracketPos !== -1 ? url.slice(0, bracketPos) : url\n  }\n\n  if (rest.startsWith('http://') || rest.startsWith('https://')) {\n    // Url includes deploymentUrl\n    let apiPos = rest.indexOf('/api/')\n    if (apiPos === -1 && rest.endsWith('/api')) apiPos = rest.length - 4\n    if (apiPos === -1) throw new Error(prefix + 'absolute nomad deployment url does not contain \"/api\"')\n    deploymentUrl = url.slice(0, apiPos + 4)\n    rest = rest.slice(apiPos + 5)\n    if (rest && !rest.startsWith('uploads/')) throw new Error(prefix + 'expected \"/uploads/<uploadId>\" in absolute url')\n    relativeTo = null\n  } else if (url.startsWith('../')) {\n    rest = rest.slice(3)\n  } else if (url.startsWith('#') || url.startsWith('/')) {\n    relativeTo = refRelativeTo.data\n  } else if (url.match(/^([a-zA-Z]\\w*\\.)*[a-zA-Z]\\w*$/)) {\n    qualifiedName = url\n    relativeTo = refRelativeTo.deployment\n  } else if (url.startsWith(yamlSchemaPrefix)) {\n    [entryId, qualifiedName] = split(url.slice(yamlSchemaPrefix.length), '.', 1)\n    relativeTo = refRelativeTo.deployment\n  } else {\n    throw new Error(prefix + 'bad url')\n  }\n  const restParts = rest.split('/')\n  if ((deploymentUrl && rest) || url.startsWith('../')) {\n    // Expect upload ref\n    if (restParts[0] === 'uploads') {\n      // Ref with upload id\n      if (!deploymentUrl) {\n        relativeTo = refRelativeTo.deployment\n      }\n      if (restParts.length === 1) throw new Error(prefix + 'expected \"/uploads/<uploadId>\" in url')\n      uploadId = restParts[1]\n      restParts.splice(0, 2)\n    } else if (restParts[0] === 'upload') {\n      // Relative ref\n      relativeTo = refRelativeTo.upload\n      restParts.splice(0, 1)\n    } else {\n      throw new Error(prefix + 'expected \"/upload\" or \"/uploads\" in url')\n    }\n    if (restParts.length) {\n      // There is more. Expect \"raw\" or \"archive\"\n      if (restParts[0] === 'raw') {\n        rawPath = restParts.slice(1).map(decodeURIComponent).join('/')\n      } else if (restParts[0] === 'archive') {\n        if (restParts.length === 1) throw new Error(prefix + '\"archive\" must be followed by entry id or \"mainfile\"')\n        if (restParts[1] === 'mainfile') {\n          if (restParts.length === 2) throw new Error(prefix + '\"mainfile\" must be followed by a mainfile path')\n          mainfile = restParts.slice(2).map(decodeURIComponent).join('/')\n        } else {\n          if (restParts.length !== 2) throw new Error(prefix + 'unexpected path element after entry id')\n          entryId = restParts[1]\n        }\n      } else {\n        throw new Error(prefix + 'expected \"raw\" or \"archive\" after upload ref')\n      }\n    }\n  }\n  if (qualifiedName && !entryId) {\n    // Refers to the global schema\n    type = refType.metainfo\n  } else if (deploymentUrl && !uploadId) {\n    // Pure deployment url\n    type = refType.deployment\n  } else if (dataPath !== undefined) {\n    // Has dataPath\n    if (!url.startsWith('#') && !url.startsWith('/') && !entryId && !mainfile && !rawPath) throw new Error(prefix + 'Unexpected dataPath without entry reference')\n    mainfile = mainfile || rawPath\n    const atPos = dataPath.indexOf('@')\n    if (atPos !== -1) {\n      versionHash = dataPath.slice(atPos + 1)\n      dataPath = dataPath.slice(0, atPos)\n    }\n    const dataPathSegments = dataPath.split('/').filter(segment => segment)\n    const firstDataPathSegment = dataPathSegments[0]\n    type = (firstDataPathSegment === 'definitions' || firstDataPathSegment === 'packages') ? refType.metainfo : refType.archive\n    dataPath = '/' + dataPathSegments.join('/') // Ensure leading slash, but no duplicate slashes\n    path = dataPath\n  } else if (entryId || mainfile) {\n    // Refers to an archive, but has no dataPath\n    type = refType.archive\n  } else {\n    // Refers to an upload\n    type = refType.upload\n    path = rawPath\n  }\n  if (versionHash !== undefined) {\n    if (type !== refType.metainfo) throw new Error(prefix + 'versionHash can only be specified for metainfo urls.')\n    if (!versionHash.match(/\\w+/)) throw new Error(prefix + 'bad versionHash provided')\n    if (relativeTo) {\n      relativeTo = refRelativeTo.deployment\n    }\n  }\n\n  if (uploadId && mainfile) {\n    entryId = generateEntryId(uploadId, mainfile)\n  }\n\n  return {\n    url,\n    relativeTo,\n    type,\n    deploymentUrl,\n    uploadId,\n    entryId,\n    mainfile,\n    path,\n    qualifiedName,\n    versionHash,\n    isResolved: !relativeTo,\n    isExternal: deploymentUrl ? (deploymentUrl !== apiBase) : undefined,\n    toString: () => { return url + ' (parsed)' }\n  }\n}\n\n/**\n * Resolves the url with respect to the given baseUrl. Each of the two url arguments can\n * be either a string or a parsed/resolved nomad url object (i.e. an object returned by calling\n * parseNomadUrl or resolveNomadUrl). If the url is absolute, no baseUrl is required and the argument\n * is ignored. If url is relative, however, baseUrl is required, and it needs to be either a string\n * which is an absolute url, or a resolved nomad url object.\n *\n * If succesful, returns an resolved nomad url object, which is similar to the one returned\n * by parseNomadUrl, but\n *  1) It additionally has the attribute baseUrl, which stores the baseUrl argument,\n *  2) the isResolved flag should be guaranteed to be true, and\n *  3) all applicable attributes (like deploymentUrl, uploadId, entryId, etc) are set\n *     to the resolved valules.\n *\n * NOTE, if you pass an object as the url argument, and it is not already resolved, the\n * original object will be modified by this call, and the modified version is also the\n * object that will be returned by the function.\n */\nexport function resolveNomadUrl(url, baseUrl) {\n  const parsedUrl = parseNomadUrl(url)\n  if (parsedUrl.isResolved) return parsedUrl\n  parsedUrl.baseUrl = baseUrl\n  const prefix = `Could not normalize url \"${parsedUrl.url}\" with baseUrl \"${baseUrl?.url || baseUrl}\": `\n\n  if (parsedUrl.relativeTo) {\n    // Url is relative.\n    if (!baseUrl) throw new Error(prefix + 'a baseUrl is required.')\n    const parsedBaseUrl = parseNomadUrl(baseUrl)\n    if (!parsedBaseUrl.isResolved) throw new Error(prefix + 'unresolved baseUrl')\n    // Copy data from parsedBaseUrl\n    parsedUrl.deploymentUrl = parsedBaseUrl.deploymentUrl // Should always be copied\n    if (parsedUrl.relativeTo === refRelativeTo.upload) {\n      if (!parsedBaseUrl.uploadId) throw new Error(prefix + 'missing information about uploadId')\n      parsedUrl.uploadId = parsedBaseUrl.uploadId\n      if (parsedUrl.mainfile) {\n        parsedUrl.entryId = generateEntryId(parsedUrl.uploadId, parsedUrl.mainfile)\n      }\n    } else if (parsedUrl.relativeTo === refRelativeTo.data) {\n      if (!parsedBaseUrl.entryId || !parsedBaseUrl.uploadId) throw new Error(prefix + 'missing information about entryId')\n      parsedUrl.uploadId = parsedBaseUrl.uploadId\n      parsedUrl.entryId = parsedBaseUrl.entryId\n    }\n  }\n\n  parsedUrl.isExternal = !!parsedUrl.deploymentUrl && parsedUrl.deploymentUrl !== apiBase\n  parsedUrl.isResolved = true\n  return parsedUrl\n}\n\n/**\n * Works like resolveNomadUrl, but does not throw errors in case of failure. Instead:\n *  1) If url is empty, we return null\n *  2) If the url is non-empty and unresolvable, we return an *resolve failed object*, which\n *     is an object containing {url, baseUrl, error}\n */\nexport function resolveNomadUrlNoThrow(url, baseUrl) {\n  if (!url) return null\n  try {\n    return resolveNomadUrl(url, baseUrl)\n  } catch (error) {\n    return {url, baseUrl, error}\n  }\n}\n\n/**\n * Relativizes a url with respect to the provided deploymentUrl, uploadId, entryId, and\n * returns the shortest possible relative url, as a string.\n * This method thus basically does the *opposite* of resolveNomadUrl. You can specify either none,\n * the first, the two first, or all three arguments of the (deploymentUrl, uploadId, entryId)\n * tuple. The url provided must be absolute.\n */\nexport function relativizeNomadUrl(url, deploymentUrl, uploadId, entryId) {\n  const parsedUrl = parseNomadUrl(url)\n  if (!parsedUrl.isResolved) {\n    throw new Error(`Absolute url required, got ${url}.`)\n  }\n  if (!parsedUrl.uploadId) {\n    throw new Error(`Expected url to specify an upload, got ${url}`)\n  }\n  if (parsedUrl.deploymentUrl !== deploymentUrl) {\n    // Nothing to relativize\n    return normalizeNomadUrl(parsedUrl)\n  }\n  if (parsedUrl.entryId === entryId) {\n    // Same deployment and entry\n    return '#' + (parsedUrl.path || '/')\n  }\n  // Same deployment, possibly also same upload\n  let rv = parsedUrl.uploadId === uploadId ? '../upload' : `../uploads/${parsedUrl.uploadId}`\n  if (parsedUrl.type === refType.archive || parsedUrl.type === refType.metainfo) {\n    rv = `${rv}/archive/${parsedUrl.entryId}`\n    if (parsedUrl.path) {\n      rv = `${rv}#${parsedUrl.path}`\n    }\n  } else if (parsedUrl.type === refType.upload) {\n    if (parsedUrl.path) {\n      rv = `${rv}/raw/${parsedUrl.path}`\n    }\n  }\n  return rv\n}\n\n/**\n * Returns a url string which is \"normalized\", i.e. it is absolute and have the preferred\n * url form for referencing the resource/data. Normalized urls always prefer identifying\n * entries with entryId rather than by specifying a mainfile.\n * @param {*} url A string or resolved nomad url object.\n */\nexport function normalizeNomadUrl(url) {\n  const parsedUrl = parseNomadUrl(url)\n  if (!parsedUrl.isResolved) throw new Error(`Failed to normalize url ${url.url}: provided url is unresolved`)\n  if (parsedUrl.type === refType.deployment) {\n    return parsedUrl.deploymentUrl\n  } else if (parsedUrl.type === refType.upload) {\n    return `${parsedUrl.deploymentUrl}/uploads/${parsedUrl.uploadId}` + (parsedUrl.path ? '/raw/' + parsedUrl.path : '')\n  } else if (parsedUrl.entryId) {\n    return `${parsedUrl.deploymentUrl}/uploads/${parsedUrl.uploadId}/archive/${parsedUrl.entryId}` + (\n      parsedUrl.path ? '#' + parsedUrl.path + (parsedUrl.versionHash ? '@' + parsedUrl.versionHash : '') : '')\n  } else if (parsedUrl.qualifiedName) {\n    return parsedUrl.qualifiedName\n  }\n  throw new Error(`Failed to normalize url ${url.url}: unhandled url format`) // Should not happen\n}\n\n/**\n * Utility for creating an absolute upload url, given deploymentUrl, uploadId and an UNESCAPED rawPath\n */\nexport function createUploadUrl(deploymentUrl, uploadId, rawPathUnescaped, index) {\n  if (isNaN(index)) {\n    const rawPathEscaped = urlEncodePath(rawPathUnescaped || '')\n    return `${deploymentUrl}/uploads/${uploadId}/raw/${rawPathEscaped}`\n  } else {\n    if (rawPathUnescaped[index] !== null) {\n      const rawPathEscaped = urlEncodePath(rawPathUnescaped[index] || '')\n      return `${deploymentUrl}/uploads/${uploadId}/raw/${rawPathEscaped}`\n    } else {\n      return `${deploymentUrl}/uploads/${uploadId}/raw`\n    }\n  }\n}\n\n/**\n * Utility for creating an absolute entry url, given deploymentUrl, uploadId, entryId, and dataPath\n */\nexport function createEntryUrl(deploymentUrl, uploadId, entryId, dataPath) {\n  let rv = `${deploymentUrl}/uploads/${uploadId}/archive/${entryId}`\n  if (dataPath) {\n    rv += '#' + (!dataPath.startsWith('/') ? '/' : '') + dataPath\n  }\n  return rv\n}\n\n/**\n * Given parsedUrl, which should be a resolved, parsed url, specifying an entry and some dataPath\n * within this entry (the path may be empty), append the dataPathSuffix, and return the resulting\n * url as a string. If the dataPath of parsedUrl is empty, it will be interpreted to mean the archive\n * root element. The dataPathSuffix should not start with a '/'.\n */\nexport function appendDataUrl(parsedUrl, dataPathSuffix) {\n  if (!parsedUrl.isResolved) throw new Error(`appendDataUrl: a resolved url required, got ${parsedUrl}`)\n  if (parsedUrl.type !== refType.archive) throw new Error(`appendDataUrl: an archive url required, got ${parsedUrl}`)\n  return urlJoin(\n    `${parsedUrl.deploymentUrl}/uploads/${parsedUrl.uploadId}/archive/${parsedUrl.entryId}#${parsedUrl.path || '/'}`,\n    dataPathSuffix)\n}\n\n/**\n * A simple method for joining url components. The componenst should be strings, and the return\n * value is also a string. A '/' is inserted between all components, if needed (i.e. if the preceding\n * component does not end with a '/').\n *\n * Note that the standard join method defined in the path library does not quite work like\n * this, it reduces all occurances of '//' to '/' in the returned value, and we don't want this\n * for urls (we want to keep the double slash in expressions like 'http://' etc).\n */\nexport function urlJoin(...components) {\n  let rv = ''\n  for (const component of components) {\n    if (component) {\n      if (rv && !rv.endsWith('/')) {\n        rv += '/'\n      }\n      rv += component\n    }\n  }\n  return rv\n}\n\n/**\n * Encodes a file system path (which may include various characters not allowed in urls, or that\n * have special meanings in urls, like ' ' and '#' and '?') into a path that is url safe.\n */\nexport function urlEncodePath(path) {\n  return path.split('/').map(encodeURIComponent).join('/')\n}\n\n/**\n * Decodes a url encoded file system path (the inverse of urlEncodePath)\n */\nexport function urlDecodePath(urlPath) {\n  return urlPath.split('/').map(decodeURIComponent).join('/')\n}\n\n/**\n * Given an internal url and a data object, gets the value at the corresponding location (path)\n * in this data object. The data object should be an archive or a metainfo data object. The\n * url parameter can be a single url or an array of urls. If it is an array of urls, the method\n * will return an array of values instead of a single value. The url argument can be empty,\n * in which case null will be returned. Otherwise, the url(s) MUST be internal (i.e. data-relative,\n * starting with a '#' or a '/'), and they can be either strings or parsed nomad url objects.\n */\nexport function resolveInternalRef(url, data, throwOnError = true) {\n  if (!url) return null\n  if (Array.isArray(url)) {\n    return url.map(ref => resolveInternalRefSingle(ref, data, throwOnError))\n  }\n  return resolveInternalRefSingle(url, data, throwOnError)\n}\n\nfunction resolveInternalRefSingle(url, data) {\n  let path\n  if (url.relativeTo === refRelativeTo.data) {\n    // We have a parsed url obj\n    path = url.path\n  } else {\n    // Should be a string object\n    if (typeof url !== 'string' || (!url.startsWith('#') && !url.startsWith('/'))) throw new Error(`Expected internal ref, got ${url}`)\n    path = url.slice(1)\n  }\n  const segments = path.split('/').filter(segment => segment !== '')\n  let current = data\n  for (const segment of segments) {\n    if (!current) throw new Error(`Path does not exist: ${path}`)\n    if (isNaN(segment)) {\n      current = current[segment] || current._properties?.[segment] || current.sub_section?._properties?.[segment]\n    } else {\n      if (current.repeats && current.m_def) {\n      } else {\n        let index = parseInt(segment)\n        if (index < 0) index = current.length + index\n        current = current[index]\n      }\n    }\n  }\n  return current\n}\n\n/**\n * Defines an alphabet in capital letters\n */\nexport const alphabet = [\n  'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R',\n  'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'\n]\n\n/**\n * Function for creating suggestions functionality for a list of string values.\n * Mimics the suggestion logic used by the suggestions API endpoint.\n *\n * @param {array} values Array of available values\n * @param {number} minLength Minimum input length before suggestions are considered.\n * @param {func} text Function that maps the value into the suggested text input\n *\n * @return {object} Object containing a list of options and a function for\n *   filtering them based on the input.\n */\nexport function getSuggestions(values, minLength = 2, get = (x) => x) {\n  const normalizer = (input) => {\n    return input\n      .replace(/[_.]/g, ' ') // Ignore dots and underscores\n      .replace(/[ ]/g, '') // Ignore whitespacing\n      .toLowerCase() // Ignore case\n  }\n\n  const options = values\n    .map(item => {\n      const value = get(item)\n      return {\n        value: value,\n        normalized: normalizer(value),\n        original: item\n      }\n    })\n  const filter = (input) => {\n    // Minimum input length\n    if (input.length < minLength) {\n      return []\n    }\n    // Gather all matches\n    const inputNormalized = normalizer(input)\n    let suggestions = options.filter(option => option.normalized.includes(inputNormalized))\n\n    // Sort matches based on value length (the more the input covers from the\n    // value, the better the match)\n    suggestions = suggestions.sort((a, b) => a.value.length - b.value.length)\n    return suggestions.map(suggestion => suggestion.original)\n  }\n\n  return {options, filter}\n}\n\n/**\n * Removes the given prefix from the string if it is present.\n *\n * @param {str} string String to remove prefix from\n * @param {str} prefix Prefix to remove\n */\nexport function removePrefix(string, prefix) {\n  if (string.startsWith(prefix)) {\n    string = string.substring(prefix.length)\n  }\n  return string\n}\n\n/**\n * Used to download a file using the native browser mechanism. You can either\n * provide an URL or the raw data as content.\n */\nexport function download(filename, content) {\n  const link = document.createElement('a')\n  link.style.display = \"none\"\n  document.body.appendChild(link)\n  const remoteData = isString(content)\n  const url = remoteData\n    ? content\n    : window.URL.createObjectURL(content)\n  link.href = url\n  link.download = filename\n  link.click()\n  document.body.removeChild(link)\n  !remoteData &&\n    setTimeout(() => {\n      window.URL.revokeObjectURL(url)\n    }, 0)\n}\n\n/**\n * Mimics the Python split function.\n */\nexport function split(value, sep, maxsplit) {\n    const split = value.split(sep)\n    return maxsplit\n      ? split.slice(0, maxsplit).concat(split.slice(maxsplit).join(sep))\n      : split\n}\n\n/**\n * Mimics the Python rsplit function.\n */\nexport function rsplit(value, sep, maxsplit) {\n    const split = value.split(sep)\n    return maxsplit\n      ? [split.slice(0, -maxsplit).join(sep)].concat(split.slice(-maxsplit))\n      : split\n}\n\n/**\n * Used to abbreviate a schema name.\n */\nexport function getSchemaAbbreviation(schema) {\n  if (!schema) return schema\n  return schema.startsWith('../')\n    ? schema\n    : rsplit(schema, '.', 1).pop()\n}\n\n/**\n * Used to split a quantity name into path, schema and dtype.\n */\nexport function parseQuantityName(fullName) {\n  if (!fullName) return {}\n  const parts = split(fullName, schemaSeparator, 1)\n  const [path, schema] = parts.length === 2\n    ? parts\n    : [fullName, undefined]\n  const dtypeParts = split(schema, dtypeSeparator, 1)\n  const [schemaNew, dtype] = parts.length === 2\n    ? dtypeParts\n    : [schema, undefined]\n  return {path, schema: schemaNew, dtype}\n}\n\n/**\n * Used to parse a possible query operator from a quantity name.\n */\nexport function parseOperator(fullName) {\n  const operators = new Set(['any', 'all', 'none'])\n  const parts = rsplit(fullName, ':', 1)\n  let [quantity, op] = parts.length === 2\n    ? parts\n    : [fullName, undefined]\n  if (!operators.has(op)) {\n    quantity = fullName\n    op = undefined\n  }\n  return {quantity, op}\n}\n\n/**\n * Used to determine the final set of available option names from an object that\n * adheres to the include/exclude/options pattern.\n */\nexport function getOptions(config, options) {\n  const include = config?.include || (options || (config?.options ? Object.keys(config.options) : []))\n  const exclude = config?.exclude || []\n  return include.filter((key) => !exclude?.includes(key))\n}\n\n/**\n * Returns a filtered object of options based on the config object that adheres\n * to the include/exclude/options pattern.\n */\nexport function filterOptions(config) {\n  const options = {}\n  for (const option of getOptions(config)) {\n    options[option] = config.options[option]\n  }\n  return options\n}\n\n/**\n * Returns whether the given path should be accepted based on include and\n * exclude glob patterns.\n */\nexport function glob(path, include, exclude) {\n  let match = false\n  if (!isEmpty(include)) {\n    for (const pattern of include) {\n      if (minimatch(path, pattern)) {\n        match = true\n        break\n      }\n    }\n  }\n  if (!isEmpty(exclude)) {\n    for (const pattern of exclude) {\n      if (minimatch(path, pattern)) {\n        match = false\n        break\n      }\n    }\n  }\n  return match\n}\n\n/**\n * Used to validate JMESPath.\n * @param {str} input\n * @returns\n */\nexport function validateJMESPath(input) {\n  return jmespath.compile(input)\n}\n\n/**\n * Used to parse a JMESPath input.\n * @param {str} input\n * @returns\n */\nexport function parseJMESPath(input) {\n  // Remove possible schema+dtype specification\n  const regexp = /#[a-zA-Z0-9_.#]+/g\n  const match = regexp.exec(input)\n  let schema = ''\n  let path = input\n  if (match) {\n    schema = match[0]\n    path = input.slice(0, match.index) + input.slice(match.index + schema.length)\n  }\n\n  // Try to compile JMESPath call, report error\n  let error\n  let ast\n  try {\n    ast = validateJMESPath(path)\n  } catch (e) {\n    return {quantity: undefined, path: undefined, extras: undefined, error: e.message, schema: ''}\n  }\n\n  // Walk down depth-first the AST to extract the targeted quantity\n  function recurseAST(node) {\n    const type = node?.type\n    const name = node?.name\n    const children = node?.children\n    let field = []\n    let extras = []\n\n    if (children) {\n      const childFields = []\n      const childExtras = []\n      for (const child of children) {\n        const [fieldInner, extrasInner] = recurseAST(child)\n        childFields.push(fieldInner)\n        childExtras.push(extrasInner)\n      }\n      // In filter projections we save the filter field in extras\n      if (type === 'FilterProjection') {\n        for (const childField of childFields.slice(0, 2)) {\n          field = [...field, ...childField]\n        }\n        extras = [...extras, [...childFields[0], ...childFields[2]]]\n      // In *_by we save the referenced variable in extras\n      } else if (type === 'Function' && name === 'min_by') {\n        field = [...field, ...childFields[0]]\n        extras = [...extras, [...childFields[0], ...childFields[1]]]\n      // For other types we simply extend definitions and extras in the order\n      // they are defined in\n      } else {\n        for (const childField of childFields) {\n          field = [...field, ...childField]\n        }\n        for (const childExtra of childExtras) {\n          extras = [...extras, ...childExtra]\n        }\n      }\n    } else {\n      if (type === 'Field') {\n        return [[name], extras]\n      }\n    }\n    return [field, extras]\n  }\n\n  const [field, extrasList] = recurseAST(ast)\n  const quantity = field.join('.') + schema\n  const extras = extrasList.map(x => x.join('.') + schema)\n\n  return {quantity, extras, path, schema, error}\n}\n\n/**\n * Cleans the given object/array recursively from undefined values and empty\n * objects.\n * @param {*} obj The input list or object to clean.\n */\nexport function cleanse(obj) {\n  // Clean array\n  if (isArray(obj)) {\n    for (const item of obj) {\n      cleanse(item)\n    }\n  // Clean object\n  } else {\n    for (const key of keys(obj)) {\n      // Get this value and its type\n      const value = obj[key]\n      const type = typeof value\n      if (isPlainObject(value)) {\n        cleanse(value)\n        if (isEmpty(value)) {\n          delete obj[key]\n        }\n      } else if (isArray(value)) {\n        for (const item of value) {\n          cleanse(item)\n        }\n      } else if (type === \"undefined\") {\n        delete obj[key]\n      }\n    }\n  }\n}\n\n/**\n * Get the display label of the quantity\n * @param {*} def The quantity definition\n * @param {*} isArchive Determines the archive scope\n * @param {*} technicalView Returns the technical exploring name\n */\nexport function getDisplayLabel(def, isArchive = false, technicalView = false) {\n  if (!def) {\n    return undefined\n  }\n  if (technicalView) {\n    return def.name\n  }\n  const labelAnnotation = def?.m_annotations?.display?.[0]?.label\n  const eln = def?.m_annotations?.eln\n  if (labelAnnotation) {\n    if (typeof labelAnnotation === 'string') {\n      return labelAnnotation\n    } else {\n      throw new Error('Unsupported format for label annotation')\n    }\n  }\n  const name = def.m_def === 'nomad.metainfo.metainfo.Section' || def.m_def === 'nomad.metainfo.metainfo.SubSection'\n    ? def.name.replace(/_/g, ' ').replace(/([a-z])([A-Z])/g, '$1 $2')\n    : def.name.replace(/_/g, ' ')\n  return eln?.[0].label || def?.more?.label || def?.label || (isArchive ? name : capitalize(name))\n}\n\n/**\n * Checks if the given string is empty: undefined, null or contains only\n * whitespace.\n * @param {*} value The value to check\n * @returns Whether the string is empty\n */\nexport function isEmptyString(value) {\n  return value === undefined || value === null || !value?.trim?.()?.length\n}\n\n/**\n * Checks if upload is visible for all users (including guests)\n * @param {Object} upload The upload object\n * @returns {boolean|undefined} Whether the upload is visible\n */\nexport function isUploadVisibleForAll(upload) {\n  return upload?.viewer_groups?.includes('all')\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useContext, useRef, useState, useCallback, useEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport { useApi, DoesNotExist } from './api'\nimport { useErrors } from './errors'\nimport { apiBase, metainfo as currentSystemMetainfoData } from '../config'\nimport { refType, parseNomadUrl, createEntryUrl, systemMetainfoUrl, isUploadVisibleForAll } from '../utils'\nimport { getMetainfoFromDefinition, getUrlFromDefinition, Metainfo } from './archive/metainfo'\nimport YAML from 'yaml'\n\nfunction addSubscription(storeObj, cb) {\n  storeObj._subscriptions.push(cb)\n}\n\nfunction removeSubscription(store, key, cb) {\n  const storeObj = store[key]\n  if (storeObj) {\n    storeObj._subscriptions = storeObj._subscriptions.filter(subscription => subscription !== cb)\n  }\n}\n\nconst metainfoArchiveFilter = Object.freeze({\n  // Archive data required to create a Metainfo object\n  definitions: '*',\n  metadata: '*'\n})\n\nexport const dataStoreContext = React.createContext()\n\nexport function useDataStore() {\n  return useContext(dataStoreContext)\n}\n\nconst DataStore = React.memo(({children}) => {\n  const {raiseError} = useErrors()\n  const {api, user} = useApi()\n  const userRef = useRef()\n  userRef.current = user // The logged in user may change during component lifecycle\n  const storeKey = useRef() // A key used to determine when the caches should be cleared\n  const selectedEntry = useRef() // stores identity of the selected entry (used to determine if editable)\n  const entryBreadCrumb = useRef({innerText: 'Entry'})\n  const uploadBreadCrumb = useRef({innerText: 'Upload'})\n  const breadcrumb = {\n    uploadRef: uploadBreadCrumb,\n    entryRef: entryBreadCrumb,\n    setUpload: (breadcrumb) => {\n      if (uploadBreadCrumb.current) {\n        uploadBreadCrumb.current.innerText = breadcrumb\n      }\n    },\n    setEntry: (breadcrumb) => {\n      if (entryBreadCrumb.current) {\n        entryBreadCrumb.current.innerText = breadcrumb\n      }\n    },\n    getUpload: () => uploadBreadCrumb.current?.innerText,\n    getEntry: () => entryBreadCrumb.current?.innerText\n  }\n\n  const uploadStore = useRef({}) // The upload store objects\n  const entryStore = useRef({}) // The entry store objects\n  const metainfoDataStore = useRef({}) // The metainfo data store objects\n  const frozenMetainfoCache = useRef({}) // Stores frozen metainfo objects by their version hash\n  const externalInheritanceCache = useRef({}) // Used to keep track of inheritance between metainfos\n\n  /**\n   * Gets an upload object from the store, creating it if it doesn't exist (in which case\n   * an object with default values, mostly undefined or nulls, will be returned). Note, it\n   * does not cause the store to fetch any data, it just returns what's currently in the store.\n   */\n  function getUpload(deploymentUrl, uploadId) {\n    if (!uploadId) return undefined\n    if (deploymentUrl !== apiBase) throw new Error('Fetching uploads from external deployments is not yet supported')\n    let uploadStoreObj = uploadStore.current[uploadId]\n    if (!uploadStoreObj) {\n      // Creates an initial, empty upload store object.\n      uploadStoreObj = {\n        deploymentUrl, // ReadOnly\n        uploadId, // ReadOnly\n        isExternal: deploymentUrl !== apiBase, // ReadOnly\n        deletionRequested: false, // Writable - If this upload has been sent for deletion\n        upload: undefined, // Writeable - The last upload proc data fetched.\n        entries: undefined, // ReadOnly - The last list of entries fetched by the store (when subscribing to an entry page).\n        apiData: undefined, // ReadOnly - Object with the last api request and response fetched by the store (when subscribing to an entry page).\n        pagination: {\n          page_size: 5, page: 1, order: 'asc', order_by: 'process_status'\n        }, // Writeable - Value for pagination to use when an entries page is requested\n\n        // ReadOnly - Derived values (computed when calling updateUpload)\n        hasUpload: false,\n        isProcessing: false,\n        isViewer: false,\n        isWriter: false,\n        isMainAuthor: false,\n        isEditable: false,\n        isVisibleForAll: false,\n\n        // ReadOnly - Managed by the store\n        error: undefined, // If we had an api error from the last store refresh\n        isRefreshing: false,\n        requestOptions: {requireUpload: false, requireEntriesPage: false}, // Options specifying data requested\n        refreshOptions: null, // Options specifying data actually fetched (or attempted to fetch) at last refresh\n        _subscriptions: [],\n\n        // Convenience methods\n        updateUpload: (dataToUpdate) => { updateUpload(deploymentUrl, uploadId, dataToUpdate) },\n        requestRefreshUpload: () => { requestRefreshUpload(deploymentUrl, uploadId) }\n      }\n      uploadStore.current[uploadId] = uploadStoreObj\n    }\n    return uploadStoreObj\n  }\n\n  /**\n   * Gets an upload from the store asychronously, waiting for the store to refresh if needed.\n   * If the required data has already been fetched, we return the store object immediately.\n   */\n  async function getUploadAsync(deploymentUrl, uploadId, requireUpload, requireEntriesPage) {\n    if (!uploadId) return undefined\n    const uploadStoreObj = getUpload(deploymentUrl, uploadId)\n    if (uploadRefreshSatisfiesOptions(uploadStoreObj, requireUpload, requireEntriesPage)) {\n      return uploadStoreObj // Store has already been refreshed with the required options\n    }\n    // Set up temporary subscription and wait for it to refresh\n    return new Promise(function(resolve, reject) {\n      function cb(oldStoreObj, newStoreObj) {\n        if (uploadRefreshSatisfiesOptions(newStoreObj, requireUpload, requireEntriesPage)) {\n          removeSubscription(uploadStore.current, uploadId, cb)\n          resolve(newStoreObj)\n        }\n      }\n      subscribeToUpload(deploymentUrl, uploadId, cb, requireUpload, requireEntriesPage)\n    })\n  }\n\n  /**\n   * Subscribes the callback cb to an upload, and returns a function to be called to unsubscribe.\n   * Typically used in useEffect. The callback will be called when the store value changes.\n   */\n  function subscribeToUpload(deploymentUrl, uploadId, cb, requireUpload, requireEntriesPage) {\n    if (!uploadId) return undefined\n    if (requireUpload === undefined || requireEntriesPage === undefined) {\n      throw Error('Store error: missing upload subscription parameter')\n    }\n    const uploadStoreObj = getUpload(deploymentUrl, uploadId)\n    // Update requestOptions\n    uploadStoreObj.requestOptions.requireUpload = uploadStoreObj.requestOptions.requireUpload || requireUpload\n    uploadStoreObj.requestOptions.requireEntriesPage = uploadStoreObj.requestOptions.requireEntriesPage || requireEntriesPage\n    // Add subscription and trigger refresh if needed\n    addSubscription(uploadStoreObj, cb)\n    initiateUploadRefreshIfNeeded(deploymentUrl, uploadId)\n    return function unsubscriber() { removeSubscription(uploadStore.current, uploadId, cb) }\n  }\n\n  /**\n   * Updates the store upload with the specified data and notifies all subscribers.\n   */\n  function updateUpload(deploymentUrl, uploadId, dataToUpdate) {\n    if (deploymentUrl !== apiBase) throw new Error('Cannot update external upload')\n    const oldStoreObj = getUpload(deploymentUrl, uploadId)\n    const newStoreObj = {...oldStoreObj, ...dataToUpdate}\n    // Compute derived values\n    const user = userRef.current\n    newStoreObj.hasUpload = !!newStoreObj.upload\n    newStoreObj.isProcessing = !!newStoreObj.upload?.process_running\n    if (dataToUpdate.upload || dataToUpdate.entries) {\n      dataToUpdate.error = undefined // Updating upload or entries -> reset error\n    }\n    if (dataToUpdate?.upload?.current_process === 'delete_upload') {\n      newStoreObj.deletionRequested = true // Will treat subsequent 404 errors\n    }\n    const viewers = newStoreObj.upload?.viewers\n    const writers = newStoreObj.upload?.writers\n    newStoreObj.isViewer = !!(user && viewers?.includes(user.sub))\n    newStoreObj.isWriter = !!(user && writers?.includes(user.sub))\n    newStoreObj.isMainAuthor = user && newStoreObj.upload?.main_author === user.sub\n    newStoreObj.isEditable = newStoreObj.isWriter && !newStoreObj.upload.published\n    newStoreObj.isVisibleForAll = isUploadVisibleForAll(newStoreObj.upload)\n\n    // Update the store\n    uploadStore.current[uploadId] = newStoreObj\n\n    // Notify subscribers\n    for (const cb of newStoreObj._subscriptions) {\n      try {\n        cb(oldStoreObj, newStoreObj)\n      } catch (error) {\n        console.error('DataStore: failed to notify subscriber: ' + error.message)\n      }\n    }\n    // Report any unexpected api errors to the user\n    if (newStoreObj.error && (!oldStoreObj.error || oldStoreObj.error?.apiMessage !== newStoreObj.error?.apiMessage)) {\n      if (newStoreObj.error instanceof DoesNotExist && newStoreObj.deletionRequested) {\n        // Expected to happen when user deletes an upload, ignore\n      } else {\n        // Unexpected error occured when refreshing\n        raiseError(newStoreObj.error)\n      }\n    }\n    // Possibly, start a refresh job\n    initiateUploadRefreshIfNeeded(deploymentUrl, uploadId)\n  }\n\n  async function refreshUpload(deploymentUrl, uploadId) {\n    // Internal use: refresh an upload store obj with data from the API.\n    const uploadStoreObj = getUpload(deploymentUrl, uploadId)\n    const refreshOptions = {...uploadStoreObj.requestOptions}\n    const {requireUpload, requireEntriesPage} = refreshOptions\n    if (!requireUpload && !requireEntriesPage) return\n    // There's something that can be refreshed\n    uploadStoreObj.isRefreshing = true\n    const currentPagination = uploadStoreObj.pagination\n\n    const apiCall = requireEntriesPage\n      ? api.get(`/uploads/${uploadId}/entries`, currentPagination, {returnRequest: true})\n      : api.get(`/uploads/${uploadId}`)\n\n    apiCall.then(apiData => {\n      const dataToUpdate = requireEntriesPage\n        ? {error: undefined, isRefreshing: false, upload: apiData.response?.upload, entries: apiData.response?.data, apiData, pagination: currentPagination, refreshOptions}\n        : {error: undefined, isRefreshing: false, upload: apiData.data, entries: undefined, apiData: undefined, refreshOptions}\n      updateUpload(deploymentUrl, uploadId, dataToUpdate)\n    }).catch((error) => {\n      if (requireEntriesPage && error.apiMessage === 'Page out of range requested.') {\n        // Special case: can happen if entries have been deleted and the page we were on is no longer in range\n        if (currentPagination && currentPagination.page !== 1) {\n          // Rather than sending an update to all subscribers with an error, we first try\n          // jumping to page 1 (will probably solve the problem)\n          getUpload(deploymentUrl, uploadId).pagination.page = 1\n          refreshUpload(deploymentUrl, uploadId)\n          return\n        }\n      }\n      updateUpload(deploymentUrl, uploadId, {error: error, isRefreshing: false, refreshOptions})\n    })\n  }\n\n  /**\n   * Use to nicely request a refresh of the upload store object.\n   */\n  function requestRefreshUpload(deploymentUrl, uploadId) {\n    const uploadStoreObj = getUpload(deploymentUrl, uploadId)\n    if (!uploadStoreObj.isRefreshing) {\n      // Refresh is not already in progress\n      refreshUpload(deploymentUrl, uploadId)\n    }\n  }\n\n  async function initiateUploadRefreshIfNeeded(deploymentUrl, uploadId) {\n    // Internal use: check if a refresh of the store is needed, and if so, initiate it.\n    let uploadStoreObj = getUpload(deploymentUrl, uploadId)\n    if (uploadStoreObj.isRefreshing) return // refresh already in progress\n    if (uploadStoreObj.isProcessing) {\n      // Upload is processing\n      uploadStoreObj.isRefreshing = true // Signal start of a refresh\n      await new Promise(resolve => setTimeout(resolve, 1000)) // wait one sec\n      uploadStoreObj = getUpload(deploymentUrl, uploadId)\n    }\n    // Determine if a refresh is needed or not\n    const {requireUpload, requireEntriesPage} = uploadStoreObj.requestOptions\n    const uploadDataMissing = requireUpload && !uploadStoreObj.upload\n    const entryDataMissing = requireEntriesPage && !uploadStoreObj.entries\n    const pag = uploadStoreObj.pagination\n    const pagIs = uploadStoreObj.apiData?.response?.pagination\n    const wrongPagination = requireEntriesPage && !Object.entries(pag).every(([key, value]) => pagIs?.[key] === value)\n    if (!uploadStoreObj.error && (uploadDataMissing || entryDataMissing || wrongPagination || uploadStoreObj.isProcessing)) {\n      // Need to fetch data from the api\n      refreshUpload(deploymentUrl, uploadId)\n    } else {\n      uploadStoreObj.isRefreshing = false\n    }\n  }\n\n  /**\n   * Gets an entry object from the store, creating it if it doesn't exist (in which case\n   * an object with default values, mostly undefined or nulls, will be returned). Note, it\n   * does not cause the store to fetch any data, it just returns what's currently in the store.\n   */\n  function getEntry(deploymentUrl, entryId, raise = true) {\n    if (!entryId) return undefined\n    if (deploymentUrl !== apiBase) throw new Error('Fetching entries from external deployments is not yet supported')\n    let entryStoreObj = entryStore.current[entryId]\n    if (!entryStoreObj) {\n      // Creates an initial, empty entry store object.\n      entryStoreObj = {\n        deploymentUrl, // ReadOnly\n        entryId: entryId, // ReadOnly\n        uploadId: undefined, // ReadOnly - fetched by the store\n        url: undefined, // ReadOnly - populated when uploadId fetched from the store\n        metadata: undefined, // ReadOnly - fetched by the store\n        metadataApiData: undefined, // ReadOnly - fetched by the store\n        archive: undefined, // Modifiable object - fetched by the store, but the object *content* can be changed when editing.\n        archiveApiData: undefined, // Modifiable object - fetched by the store, but the \"archive\" key is the same object as above, i.e. modifiable.\n        originalDefinition: undefined, // original definition defined by user obtained from raw file\n\n        // ReadOnly - Derived or managed by the store\n        exists: true,\n        isProcessing: false,\n        editable: false,\n        archiveVersion: 0, // Used to keep track of manual edits\n        savedArchiveVersion: 0,\n        archiveHasChanges: false,\n\n        raise: raise, // Whether to use raiseError on exceptions\n        error: undefined, // If we had an api error from the last store refresh\n        isRefreshing: false,\n        requestOptions: {requireMetadata: false, requireArchive: undefined}, // Options specifying data requested\n        refreshOptions: null, // Options specifying data actually fetched (or attempted to fetch) at last refresh\n        _subscriptions: [],\n\n        // Convenience methods\n        handleArchiveChanged: () => { handleArchiveChanged(deploymentUrl, entryId) },\n        saveArchive: () => { return saveArchive(deploymentUrl, entryId) },\n        reload: () => { requestRefreshEntry(deploymentUrl, entryId) }\n      }\n      entryStore.current[entryId] = entryStoreObj\n    }\n    return entryStoreObj\n  }\n\n  /**\n   * Gets an entry from the store asychronously, waiting for the store to refresh if needed.\n   * If the required data has already been fetched, we return the store object immediately.\n   */\n  async function getEntryAsync(deploymentUrl, entryId, requireMetadata, requireArchive, raise = true) {\n    if (!entryId) return undefined\n    const entryStoreObj = getEntry(deploymentUrl, entryId, raise)\n    if (entryRefreshSatisfiesOptions(entryStoreObj, requireMetadata, requireArchive)) {\n      return entryStoreObj // Store has already been refreshed with the required options\n    }\n    // Set up temporary subscription and wait for it to refresh\n    return new Promise(function(resolve, reject) {\n      function cb(oldStoreObj, newStoreObj) {\n        if (entryRefreshSatisfiesOptions(newStoreObj, requireMetadata, requireArchive)) {\n          removeSubscription(entryStore.current, entryId, cb)\n          resolve(newStoreObj)\n        }\n      }\n      subscribeToEntry(deploymentUrl, entryId, cb, requireMetadata, requireArchive, raise)\n    })\n  }\n\n  /**\n   * Subscribes the callback cb to an entry, and returns a function to be called to unsubscribe.\n   * Typically used in useEffect. The callback will be called when the store value changes.\n   */\n  function subscribeToEntry(deploymentUrl, entryId, cb, requireMetadata, requireArchive, raise = true) {\n    if (!entryId) return undefined\n    if (requireMetadata === undefined || !(requireArchive === undefined || requireArchive === '*' || typeof requireArchive === 'object')) {\n      throw Error('Store error: bad subscription parameter supplied')\n    }\n    const entryStoreObj = getEntry(deploymentUrl, entryId)\n    // Update requestOptions\n    entryStoreObj.requestOptions.requireMetadata = entryStoreObj.requestOptions.requireMetadata || requireMetadata\n    entryStoreObj.requestOptions.requireArchive = mergeArchiveFilter(\n      entryStoreObj.requestOptions.requireArchive, requireArchive)\n    // Add subscription and trigger refresh if needed\n    addSubscription(entryStoreObj, cb)\n    initiateEntryRefreshIfNeeded(deploymentUrl, entryId, raise)\n    return function unsubscriber() { removeSubscription(entryStore.current, entryId, cb) }\n  }\n\n  /**\n   * Updates the store entry with the specified data and notifies all subscribers.\n   */\n  function updateEntry(deploymentUrl, entryId, dataToUpdate, raise = true) {\n    const oldStoreObj = getEntry(deploymentUrl, entryId)\n    const newStoreObj = {...oldStoreObj, ...dataToUpdate}\n    // Compute derived values not set by the refreshEntry method\n    newStoreObj.url = newStoreObj.uploadId ? `${deploymentUrl}/uploads/${newStoreObj.uploadId}/archive/${entryId}` : undefined\n    newStoreObj.exists = newStoreObj?.error?.name !== 'DoesNotExist'\n    newStoreObj.archiveHasChanges = newStoreObj.archiveVersion !== newStoreObj.savedArchiveVersion\n\n    // Update the store\n    entryStore.current[entryId] = newStoreObj\n\n    // Notify subscribers\n    for (const cb of newStoreObj._subscriptions) {\n      try {\n        cb(oldStoreObj, newStoreObj)\n      } catch (error) {\n        console.error('DataStore: failed to notify subscriber: ' + error.message)\n      }\n    }\n    // Report any unexpected api errors to the user\n    if (newStoreObj.exists && newStoreObj.error && (!oldStoreObj.error || oldStoreObj.error?.apiMessage !== newStoreObj.error?.apiMessage)) {\n      // Unexpected error occured when refreshing\n      raise && raiseError(newStoreObj.error)\n    }\n    // Possibly, start a refresh job\n    initiateEntryRefreshIfNeeded(deploymentUrl, entryId, raise)\n  }\n\n  async function refreshEntry(deploymentUrl, entryId, raise = true) {\n    // Internal use: refresh an entry store obj with data from the API.\n    let entryStoreObj = getEntry(deploymentUrl, entryId)\n    let refreshOptions = {...entryStoreObj.requestOptions}\n    let {requireMetadata, requireArchive} = refreshOptions\n    if (!requireMetadata && !requireArchive) return\n    // There's something that can be refreshed\n    entryStoreObj.isRefreshing = true\n    const dataToUpdate = {refreshOptions}\n    try {\n      if (requireMetadata) {\n        const metadataApiData = await api.get(`/entries/${entryId}`, null, {returnRequest: true})\n        const metadata = metadataApiData?.response?.data\n        const uploadId = metadata?.upload_id\n        const user = userRef.current\n        const isWriter = user && metadata?.writers && metadata.writers.find(u => u.user_id === user.sub)\n        const isEditableArchive = metadata && !metadata.published && metadata.quantities && metadata.quantities.includes('data')\n        const editable = isWriter && isEditableArchive && selectedEntry.current === `${deploymentUrl}:${entryId}`\n        const isProcessing = !!metadata?.process_running\n        Object.assign(dataToUpdate, {metadataApiData, metadata, uploadId, editable, isProcessing, error: undefined})\n        // Fetch the options again, in case some subscriptions were added while waiting for the api call\n        entryStoreObj = getEntry(deploymentUrl, entryId)\n        refreshOptions = {...entryStoreObj.requestOptions}\n        requireArchive = refreshOptions.requireArchive\n        dataToUpdate.refreshOptions.requireArchive = requireArchive\n      }\n      if (requireArchive) {\n        const required = requireArchive === '*' ? '*' : {...requireArchive, 'resolve-inplace': false}\n        const archiveApiData = await api.post(\n          `/entries/${entryId}/archive/query`, {required}, {returnRequest: true, jsonResponse: true})\n        const archive = archiveApiData?.response?.data?.archive\n        if (archive) {\n          const fileName = archive.metadata.mainfile\n          const isYaml = fileName.endsWith('yaml') || fileName.endsWith('yml')\n          const isJson = fileName.endsWith('json')\n          if (isYaml || isJson) {\n            const path = `/uploads/${archive.metadata.upload_id}/raw/${fileName}`\n            let content\n            try {\n              content = await api.get(path,\n              {decompress: true, ignore_mime_type: true}, {transformResponse: []})\n            } catch (e) {}\n            if (content) {\n              let rawArchive = {}\n              if (isYaml) {\n                try {\n                  rawArchive = YAML.parse(content)\n                } catch (error) {\n                  throw Error(`Could not parse YAML Schema defined here: ${path}. Failed with the following parsing error: ${error.message}`)\n                }\n              } else if (isJson) {\n                try {\n                  rawArchive = JSON.parse(content)\n                } catch (error) {\n                  throw Error(`Could not parse JSON Schema defined here: ${path}. Failed with the following parsing error: ${error.message}`)\n                }\n              }\n              if ('definitions' in rawArchive) {\n                dataToUpdate.originalDefinition = rawArchive.definitions\n              }\n            }\n          }\n          archive.processing_logs = undefined\n          if (archive.metadata?.upload_id) {\n            dataToUpdate.uploadId = archive.metadata.upload_id\n          }\n        }\n        dataToUpdate.archiveApiData = archiveApiData\n        dataToUpdate.archive = archive\n      }\n    } catch (error) {\n      dataToUpdate.error = error\n    }\n\n    // Check: should we keep current data? (A bit hacky)\n    const oldTimestamp = entryStoreObj.archive?.metadata?.last_processing_time\n    const newTimestamp = dataToUpdate.archive?.metadata?.last_processing_time\n    if (oldTimestamp && oldTimestamp === newTimestamp) {\n      const oldRequireArchive = entryStoreObj.refreshOptions.requireArchive\n      if (oldRequireArchive === '*' || oldRequireArchive?.data === '*') {\n        // Fields under the data key might be edited by the user, so we don't want to overwrite\n        // it with data fetched from the api unless the archive timestamp has changed.\n        dataToUpdate.archive.data = entryStoreObj.archive.data\n      }\n    }\n\n    dataToUpdate.isRefreshing = false\n    updateEntry(deploymentUrl, entryId, dataToUpdate, raise)\n  }\n\n  /**\n   * Use to nicely request a refresh of the entry store object.\n   */\n  function requestRefreshEntry(deploymentUrl, entryId) {\n    const entryStoreObj = getEntry(deploymentUrl, entryId)\n    if (!entryStoreObj.isRefreshing) {\n      // Refresh is not already in progress\n      refreshEntry(deploymentUrl, entryId)\n    }\n  }\n\n  async function initiateEntryRefreshIfNeeded(deploymentUrl, entryId, raise = true) {\n    // Internal use: check if a refresh of the store is needed, and if so, initiate it.\n    let entryStoreObj = getEntry(deploymentUrl, entryId)\n    if (entryStoreObj.isRefreshing) return // refresh already in progress\n    if (entryStoreObj.isProcessing) {\n      // Entry is processing\n      entryStoreObj.isRefreshing = true // Signal start of a refresh\n      await new Promise(resolve => setTimeout(resolve, 1000)) // wait one sec\n      entryStoreObj = getEntry(deploymentUrl, entryId)\n    }\n    // Determine if a refresh is needed or not\n    const {requireMetadata, requireArchive} = entryStoreObj.requestOptions\n    const lastRefreshSatisfiesOptions = entryRefreshSatisfiesOptions(entryStoreObj, requireMetadata, requireArchive)\n    if (!entryStoreObj.error && (!lastRefreshSatisfiesOptions || entryStoreObj.isProcessing)) {\n      // Need to fetch data from the api\n      refreshEntry(deploymentUrl, entryId, raise)\n    } else {\n      entryStoreObj.isRefreshing = false\n    }\n  }\n\n  /**\n   * Used to save the archive and trigger a store refresh.\n   */\n  function saveArchive(deploymentUrl, entryId) {\n    const {uploadId, metadata, archive, archiveVersion, originalDefinition} = getEntry(deploymentUrl, entryId)\n    const {mainfile} = metadata\n    if (uploadId) {\n      const separatorIndex = mainfile.lastIndexOf('/')\n      const path = mainfile.substring(0, separatorIndex + 1)\n      const fileName = mainfile.substring(separatorIndex + 1)\n      const newArchive = {...archive}\n      delete newArchive.metadata\n      delete newArchive.results\n      delete newArchive.processing_logs\n      delete newArchive.m_ref_archives\n\n      if (originalDefinition) {\n        newArchive.definitions = originalDefinition\n      }\n\n      const config = {}\n      let stringifiedArchive\n      if (fileName.endsWith('yaml') || fileName.endsWith('yml')) {\n        config.headers = {\n          'Content-Type': 'application/yaml'\n        }\n        stringifiedArchive = YAML.stringify(newArchive)\n      }\n      return new Promise((resolve, reject) => {\n        api.put(`/uploads/${uploadId}/raw/${path}?file_name=${fileName}&wait_for_processing=true&entry_hash=${archive.metadata.entry_hash}`, stringifiedArchive || newArchive, config)\n          .then(response => {\n            requestRefreshEntry(deploymentUrl, entryId)\n            resolve()\n          })\n          .catch(error => {\n            if (error?.status === 409) {\n              reject(error)\n            } else {\n              raiseError(error)\n            }\n          })\n        updateEntry(deploymentUrl, entryId, {savedArchiveVersion: archiveVersion})\n      })\n    }\n  }\n\n  /**\n   * Call to signal that the archive has been manually edited.\n   */\n  function handleArchiveChanged(deploymentUrl, entryId) {\n    const {archiveVersion} = getEntry(deploymentUrl, entryId)\n    updateEntry(deploymentUrl, entryId, {archiveVersion: archiveVersion + 1})\n  }\n\n  /**\n   * Gets a parsed metainfo object from the store, asynchronously.\n   * The url can be a string or a parsed Url object. If it is empty, null will be returned.\n   * Note, this method always returns the whole metainfo object. I.e. if the url specifies a\n   * particular section definition, we return the metainfo object which *contains* this\n   * definition, not just the definition itself.\n   */\n  async function getMetainfoAsync(url, raise = true) {\n    if (!url) return null\n    // Check cache (different caches, depending on if we have a versionHash or not)\n    let metainfoData\n    const metainfoBaseUrl = getMetainfoBaseUrl(url)\n    if (metainfoBaseUrl.versionHash) {\n      const frozenDef = frozenMetainfoCache.current[metainfoBaseUrl.versionHash]\n      if (frozenDef) {\n        return await getMetainfoFromDefinition(frozenDef)._result\n      }\n    } else {\n      metainfoData = metainfoDataStore.current[metainfoBaseUrl]\n    }\n    if (!metainfoData) {\n      // Not found in cache. Fetch data object.\n      metainfoData = await fetchMetainfoData(metainfoBaseUrl, raise)\n      if (!metainfoBaseUrl.versionHash) {\n        metainfoDataStore.current[metainfoBaseUrl] = metainfoData\n      }\n    }\n    // If needed, create metainfo (which will also initiate parsing)\n    if (!metainfoData._metainfo) {\n      const parent = metainfoBaseUrl === systemMetainfoUrl ? undefined : await getMetainfoAsync(systemMetainfoUrl, raise)\n      metainfoData._metainfo = new Metainfo(\n        parent, metainfoData, getMetainfoAsync, frozenMetainfoCache.current, externalInheritanceCache.current)\n    }\n    // Returned object after parsing is completed.\n    return await metainfoData._metainfo._result\n  }\n\n  /**\n   * Gets the parsed metainfo definition specified by the url, asynchronously.\n   * The url can be a string or a parsed Url object. If it is empty, null will be returned.\n   */\n  async function getMetainfoDefAsync(url) {\n    if (!url) return null\n    const parsedUrl = parseNomadUrl(url)\n    if (parsedUrl.versionHash) {\n      const frozenDef = frozenMetainfoCache.current[parsedUrl.versionHash]\n      if (frozenDef) {\n        return frozenDef\n      }\n    }\n    const metainfo = await getMetainfoAsync(parsedUrl)\n    if (parsedUrl.versionHash) {\n      return frozenMetainfoCache.current[parsedUrl.versionHash] // If we get here, it should be in the cache\n    } else if (parsedUrl.qualifiedName) {\n      return metainfo.getDefByQualifiedName(parsedUrl.qualifiedName)\n    } else if (parsedUrl.path) {\n      return metainfo.getDefByPath(parsedUrl.path)\n    }\n    throw new Error(`Expected metainfo definition url, got: ${url}`)\n  }\n\n  function getMetainfoBaseUrl(url) {\n    // Internal use: computes the *metainfo base url*, given an absolute metainfo url.\n    // The base url is an absolute url, identifying the metainfo data obj to parse\n    // (to get the Metainfo object). For urls identifying non-frozen schemas, the\n    // metainfo base url is also used as the cache key to store the resulting Metainfo object.\n    // For urls referring to frozen schemas, we just return the parsed url. The\n    // frozen schemas are stored in a different cache, indexed by versionHashes rather than\n    // by the base url).\n    if ((url.url || url) === systemMetainfoUrl) return systemMetainfoUrl\n    url = parseNomadUrl(url)\n    if (url.type !== refType.metainfo && url.type !== refType.archive) throw new Error(`Cannot get metainfo: bad url type (${url})`)\n    if (!url.isResolved) throw new Error(`Url not resolved: ${url}`)\n\n    if (url.versionHash) {\n      return url\n    } else if (url.entryId) {\n      return createEntryUrl(url.deploymentUrl, url.uploadId, url.entryId, '/definitions')\n    } else if (url.qualifiedName) {\n      return systemMetainfoUrl\n    }\n  }\n\n  async function fetchMetainfoData(metainfoBaseUrl, raise = true) {\n    // Internal use: fetches the metainfo data\n    if (metainfoBaseUrl === systemMetainfoUrl) {\n      currentSystemMetainfoData._url = systemMetainfoUrl\n      currentSystemMetainfoData._parsedUrl = parseNomadUrl(systemMetainfoUrl)\n      return currentSystemMetainfoData\n    }\n    const parsedMetainfoBaseUrl = parseNomadUrl(metainfoBaseUrl)\n    if (parsedMetainfoBaseUrl.versionHash) {\n      const frozenMetainfo = await api.get(`/metainfo/${parsedMetainfoBaseUrl.versionHash}`)\n      frozenMetainfo._url = createEntryUrl(\n        parsedMetainfoBaseUrl.deploymentUrl,\n        'todo-uploadid',\n        'todo-entryid',\n        `definitions@${frozenMetainfo.data.definition_id}`)\n        frozenMetainfo._parsedUrl = parseNomadUrl(frozenMetainfo._url)\n      // Rename data -> definitions\n      frozenMetainfo.definitions = frozenMetainfo.data\n      delete frozenMetainfo.data\n      return frozenMetainfo\n    } else if (parsedMetainfoBaseUrl.entryId) {\n      const entryStoreObj = await getEntryAsync(\n        parsedMetainfoBaseUrl.deploymentUrl, parsedMetainfoBaseUrl.entryId, false, metainfoArchiveFilter, raise)\n      if (entryStoreObj.error) {\n        throw new Error(`Error fetching entry ${parsedMetainfoBaseUrl.entryId}: ${entryStoreObj.error}`)\n      } else if (!entryStoreObj.archive?.definitions) {\n        throw new Error(`Entry ${parsedMetainfoBaseUrl.entryId} does not contain metainfo definitions`)\n      }\n      return {\n        definitions: JSON.parse(JSON.stringify(entryStoreObj.archive.definitions)),\n        metadata: JSON.parse(JSON.stringify(entryStoreObj.archive.metadata)),\n        _url: metainfoBaseUrl,\n        _parsedUrl: parsedMetainfoBaseUrl\n      }\n    }\n  }\n\n  function traversAllInheritingSections(definition) {\n    const rv = []\n    // Add subclasses (i.e. *directly* inheriting from this section)\n    const url = getUrlFromDefinition(definition)\n    rv.push(...(definition._allInternalInheritingSections || []))\n    rv.push(...(externalInheritanceCache.current[url] || []))\n    // Add recursively (sub-sub classes, sub-sub-sub classes etc.)\n    const recursive = []\n    for (const inheritingSection of rv) {\n      recursive.push(...traversAllInheritingSections(inheritingSection))\n    }\n    rv.push(...recursive)\n    return rv\n  }\n\n  /**\n   * Gets all the inheriting sections of the provided section definition. That is: all inheriting\n   * sections *currently known to the store*. The result is returned as a list of definitions.\n   */\n  function getAllInheritingSections(definition) {\n    const inheritingSections = traversAllInheritingSections(definition)\n    // There may be duplicated section defs resulted from different parents.\n    return inheritingSections.filter((sectionDef, index, sectionDefs) => {\n      return sectionDefs.findIndex(def => (def._qualifiedName === sectionDef._qualifiedName)) === index\n    })\n  }\n\n  /**\n   * Used to reset the data store (i.e. clear its caches). If the provided newStoreKey is\n   * non-empty and different from the current storeKey, we clear everything.\n   */\n  function resetIfNeeded(newStoreKey) {\n    if (newStoreKey && newStoreKey !== storeKey.current) {\n      if (storeKey.current) {\n        // Reset!\n        uploadStore.current = {}\n        entryStore.current = {}\n        metainfoDataStore.current = {}\n        externalInheritanceCache.current = {}\n      }\n      storeKey.current = newStoreKey\n    }\n  }\n\n  /**\n   * Used to specifically clear the entry and metainfo caches of the data store.\n   */\n  function resetEntryAndMetainfoCaches() {\n    entryStore.current = {}\n    metainfoDataStore.current = {}\n    externalInheritanceCache.current = {}\n  }\n\n  const contextValue = {\n    getUpload,\n    getUploadAsync,\n    subscribeToUpload,\n    updateUpload,\n    requestRefreshUpload,\n    getEntry,\n    getEntryAsync,\n    subscribeToEntry,\n    selectedEntry,\n    breadcrumb,\n    getMetainfoAsync,\n    getMetainfoDefAsync,\n    getAllInheritingSections,\n    resetIfNeeded,\n    resetEntryAndMetainfoCaches\n  }\n\n  return <dataStoreContext.Provider value={contextValue}>\n    {children}\n  </dataStoreContext.Provider>\n})\nDataStore.propTypes = {\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ])\n}\nexport default DataStore\n\n/**\n * React function for getting an entry from the store with certain subscription options.\n * If the store already has fetched the entry and all the required data, it will be returned\n * immediately from the cache. If the store has loaded the entry, but it has not yet fetched\n * all data required by the subscription options, the function will return a copy of the store\n * object without the following fields: metadata, metadataApiData, archive, archiveApiData.\n * This is to signal to the component that all data requested is not yet available in the store.\n * For optimization purposes, we ignore updates from the store that should not invalidate\n * any of the requested data.\n *\n * Subscription options:\n * @param {Boolean} requireMetadata If we require the store to fetch the entry metadata\n * @param {*} requireArchive If we require the store to fetch the archive, and if so, what\n *    parts of it. Should be one of:\n *      a) undefined (no archive data required)\n *      b) '*' (load entire archive), or\n *      c) an object specifying a simple archive data filter (see the doc for mergeArchiveFilter).\n */\nexport function useEntryStoreObj(deploymentUrl, entryId, requireMetadata, requireArchive) {\n  const dataStore = useDataStore()\n  const [entryStoreObj, setEntryStoreObj] = useState(\n    () => {\n      if (deploymentUrl && entryId) {\n        const rawStoreObj = dataStore.getEntry(deploymentUrl, entryId)\n        const satisfiesOptions = entryRefreshSatisfiesOptions(rawStoreObj, requireMetadata, requireArchive)\n        return satisfiesOptions ? rawStoreObj : reducedEntryStoreObj(rawStoreObj)\n      }\n      return null\n    })\n  const oldFilterKey = useRef()\n\n  const onEntryStoreUpdated = useCallback((oldStoreObj, newStoreObj) => {\n    // Determine if we should actually trigger an update\n    const satisfiesOptions = entryRefreshSatisfiesOptions(newStoreObj, requireMetadata, requireArchive)\n    const newError = newStoreObj.error !== entryStoreObj?.error\n    if (!newError) {\n      if (!satisfiesOptions) {\n        return // Skip update, still waiting for our data.\n      }\n      // Satisfies the options\n      const lastProcessingTime = (\n        newStoreObj.metadata?.last_processing_time || newStoreObj.archive?.metadata?.last_processing_time)\n      const newFilterKey = `${deploymentUrl}${entryId}${lastProcessingTime}${newStoreObj.archiveVersion}`\n      if (newFilterKey === oldFilterKey.current) {\n        return // Skip update, using old data should be fine.\n      }\n      oldFilterKey.current = newFilterKey\n    }\n    // Trigger update\n    setEntryStoreObj(satisfiesOptions ? newStoreObj : reducedEntryStoreObj(newStoreObj))\n  }, [entryStoreObj, setEntryStoreObj, deploymentUrl, entryId, requireMetadata, requireArchive])\n\n  useEffect(() => {\n    if (deploymentUrl && entryId) {\n      return dataStore.subscribeToEntry(deploymentUrl, entryId, onEntryStoreUpdated, requireMetadata, requireArchive)\n    }\n  }, [deploymentUrl, entryId, requireMetadata, requireArchive, dataStore, onEntryStoreUpdated])\n\n  return entryStoreObj\n}\n\n/**\n * Misc internal helper funcions\n */\n\nfunction reducedEntryStoreObj(entryStoreObj) {\n  // Returns a reduced entry store obj, signalling that not all data is available.\n  const rv = {...entryStoreObj}\n  delete rv.metadata\n  delete rv.metadataApiData\n  delete rv.archive\n  delete rv.archiveApiData\n  return rv\n}\n\nfunction uploadRefreshSatisfiesOptions(uploadStoreObj, requireUpload, requireEntriesPage) {\n  // Internal use: Determine if the last store refresh satisfies the given options.\n  const refreshOptions = uploadStoreObj?.refreshOptions\n  if (refreshOptions) {\n    return (refreshOptions.requireUpload || !requireUpload) || (refreshOptions.requireEntriesPage || !requireEntriesPage)\n  }\n  return false\n}\n\nfunction entryRefreshSatisfiesOptions(entryStoreObj, requireMetadata, requireArchive) {\n  // Internal use: Determine if the last store refresh satisfies the given options.\n  const refreshOptions = entryStoreObj?.refreshOptions\n  if (refreshOptions) {\n    return (refreshOptions.requireMetadata || !requireMetadata) && archiveFilterExtends(refreshOptions.requireArchive, requireArchive)\n  }\n  return false\n}\n\n/**\n * Merges two archive data filters, filter1 and filter2, returning a filter which will fetch all data\n * fetched by either filter1 or filter2.\n * Note, this method only handles certain simple types of filters, used by the gui.\n * Each filter can either have the value\n *  1) undefined (meaning include nothing)\n *  2) '*' (meaning include everything, but do not add resolved data)\n *  3) 'include-resolved' (include everything and add resolved data)\n *  4) an object with subkeys (will be treated recursively)\n * The `resolve-inplace` option should not be specified (it will be implicitly set to false).\n */\nfunction mergeArchiveFilter(filter1, filter2, level = 0) {\n  if (filter1 === filter2) return filter1\n  if (filter1 === undefined) return filter2\n  if (filter2 === undefined) return filter1\n  if (filter1 === 'include-resolved' || filter2 === 'include-resolved') return 'include-resolved'\n  const obj1 = typeof filter1 === 'object'\n  const obj2 = typeof filter2 === 'object'\n  if (filter1 === '*' && obj2) return level !== 0 && hasIncludeResolved(filter2) ? 'include-resolved' : '*'\n  if (filter2 === '*' && obj1) return level !== 0 && hasIncludeResolved(filter1) ? 'include-resolved' : '*'\n  if (!obj1 || !obj2) throw new Error('Cannot merge filters: bad values')\n\n  // Two objects. Inspect recursively.\n  const rv = {}\n  for (const key in {...filter1, ...filter2}) {\n    const value1 = filter1[key]\n    const value2 = filter2[key]\n    rv[key] = mergeArchiveFilter(value1, value2, level + 1)\n  }\n  return rv\n}\n\n/**\n * True if the archive filter filter1 *extends* the filter filter2, i.e. if all data passing\n * filter2 will also pass filter1.\n * Note, this method only handles certain simple types of filters, used by the gui.\n */\nfunction archiveFilterExtends(filter1, filter2, level = 0) {\n  if (filter1 === filter2) return true\n  if (filter2 === undefined) return true\n  if (filter1 === undefined) return false\n  if (filter1 === 'include-resolved') return true\n  if (filter2 === 'include-resolved') return false\n  const obj1 = typeof filter1 === 'object'\n  const obj2 = typeof filter2 === 'object'\n  if (filter1 === '*' && obj2) return level === 0 || !hasIncludeResolved(filter2)\n  if (filter2 === '*' && obj1) return false\n  if (!obj1 || !obj2) throw new Error('Cannot compare filters: bad values')\n  // Two objects. Inspect recursively.\n  for (const key in filter2) {\n    const value1 = filter1[key]\n    const value2 = filter2[key]\n    if (!archiveFilterExtends(value1, value2, level + 1)) return false\n  }\n  return true\n}\n\nfunction hasIncludeResolved(f) {\n  for (const key in f) {\n    const v = f[key]\n    if (v === 'include-resolved') return true\n    if (typeof v === 'object') {\n      if (hasIncludeResolved(v)) return true\n    }\n  }\n  return false\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useCallback, useContext, useEffect, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { isEmpty } from 'lodash'\nimport { useErrors } from '../errors'\nimport { useApi } from '../api'\nimport { useDataStore } from '../DataStore'\nimport {\n  parseNomadUrl, resolveNomadUrl, resolveInternalRef, systemMetainfoUrl, createEntryUrl,\n  urlEncodePath, urlJoin, relativizeNomadUrl\n} from '../../utils'\nimport { apiBase } from '../../config'\n\nconst metainfoContext = React.createContext()\n\nexport const GlobalMetainfo = React.memo(function GlobalMetainfo({ children }) {\n  const dataStore = useDataStore()\n  const globalMetainfo = useMetainfo(systemMetainfoUrl)\n  const { api } = useApi()\n  const [allCustomMetainfos, setAllCustomMetainfos] = useState()\n\n  const fetchAllCustomMetainfos = useCallback(async (refresh, query) => {\n    if (allCustomMetainfos && !refresh) {\n      return allCustomMetainfos\n    }\n    if (allCustomMetainfos) {\n      // Refreshing.\n      dataStore.resetEntryAndMetainfoCaches()\n    }\n\n    // TODO paginate?\n    // TODO Only grab new ones?\n    query = query || {}\n    const response = await api.post(`entries/archive/query`, {\n      owner: 'visible',\n      query: {\n        ...query,\n        quantities: 'definitions.section_definitions',\n        processed: true\n      },\n      required: {\n        metadata: {\n          entry_id: '*'\n        }\n      }\n    })\n    const foundCustomMetainfos = []\n    for (const data of response.data) {\n      try {\n        const url = createEntryUrl(apiBase, data.upload_id, data.entry_id)\n        const customMetainfo = await dataStore.getMetainfoAsync(url)\n        foundCustomMetainfos.push(customMetainfo)\n      } catch (error) {\n        // Unparseable metainfo\n      }\n    }\n    setAllCustomMetainfos(foundCustomMetainfos)\n    return foundCustomMetainfos\n  }, [api, dataStore, allCustomMetainfos, setAllCustomMetainfos])\n\n  if (globalMetainfo) {\n    globalMetainfo.fetchAllCustomMetainfos = fetchAllCustomMetainfos\n  }\n  return <metainfoContext.Provider value={globalMetainfo}>\n    {children}\n  </metainfoContext.Provider>\n})\nGlobalMetainfo.propTypes = {\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ])\n}\n\nexport function useGlobalMetainfo() {\n  return useContext(metainfoContext)\n}\n\n/**\n * React function for fetching a parsed metainfo object, given a url.\n * The url can be a string or a parsed Url object. If it is empty, null will be returned.\n * Note, this method always returns the whole data object. I.e. if the url specifies a\n * particular section definition, we return the metainfo data object which *contains* this\n * definition, not just the definition itself.\n */\nexport function useMetainfo(url) {\n  const dataStore = useDataStore()\n  const { raiseError } = useErrors()\n  const [metainfo, setMetainfo] = useState()\n\n  useEffect(() => {\n    dataStore.getMetainfoAsync(url)\n      .then(setMetainfo)\n      .catch(error => {\n        raiseError(error)\n        setMetainfo(null)\n      })\n  }, [url, dataStore, raiseError, setMetainfo])\n\n  return metainfo\n}\n\n/**\n * React function for fetching a parsed metainfo def, given a url.\n * The url can be a string or a parsed Url object. If it is empty, null will be returned.\n */\nexport function useMetainfoDef(url) {\n  const dataStore = useDataStore()\n  const { raiseError } = useErrors()\n  const [metainfoDef, setMetainfoDef] = useState(null)\n\n  useEffect(() => {\n    if (!url) {\n      setMetainfoDef(null)\n    } else if (url.error) {\n      raiseError(url.error)\n      setMetainfoDef(null)\n    } else {\n      dataStore.getMetainfoDefAsync(url)\n        .then(result => {\n          setMetainfoDef(result)\n        })\n        .catch(error => {\n          raiseError(error)\n          setMetainfoDef(null)\n        })\n    }\n  }, [url, setMetainfoDef, dataStore, raiseError])\n\n  return metainfoDef\n}\n\nexport const PackageMDef = 'nomad.metainfo.metainfo.Package'\nexport const SectionMDef = 'nomad.metainfo.metainfo.Section'\nexport const QuantityMDef = 'nomad.metainfo.metainfo.Quantity'\nexport const SubSectionMDef = 'nomad.metainfo.metainfo.SubSection'\nexport const CategoryMDef = 'nomad.metainfo.metainfo.Category'\nexport const AttributeMDef = 'nomad.metainfo.metainfo.Attribute'\n\nexport function quantityUsesFullStorage(def) {\n  return def.repeats || def.variable || def.attributes?.length\n}\n\n/**\n * Represents and manages schema data.\n *\n * It is responsible to create derived definition properties that are necessary for the\n * browser's function and to allow to resolve references to definitions.\n *\n * It allows to access schema data in two ways: via references and via qualified names\n * (e.g. based on packages name + section name).\n *\n * For package-based access, metainfo instances can be linked. A metainfo can have a parent.\n * Here metainfo instances will first try to resolve a qualified names with itself and it's\n * parent.\n *\n * For reference-based access, contexts can be used. A metainfo instance represents a single\n * root section (e.g. Package or Environment). URL fragments can be resolved here. The\n * rest of the reference URL can be used load respective resources with the context.\n */\nexport class Metainfo {\n  /**\n   * Constructs a Metainfo object. Note, this should only be invoked by the store.\n   */\n  constructor(parent, data, getMetainfoAsync, frozenMetainfoCache, externalInheritanceCache) {\n    this._parent = parent\n    this._data = data\n    this._getMetainfoAsync = getMetainfoAsync\n    this._frozenMetainfoCache = frozenMetainfoCache\n    this._externalInheritanceCache = externalInheritanceCache\n    this._url = data._url // the data url, always string\n    this._parsedUrl = parseNomadUrl(data._url)\n\n    this._defs = new Set()\n    this._packageDefs = {}\n    this._defsByNameCache = null\n    this._packagePrefixCache = null\n    this._rootSectionsCache = null\n\n    // Initiate a single call to _parse, using a promise\n    this._isParsed = false\n    this._result = new Promise((resolve, reject) => {\n      this._parse().then(resolve).catch(reject)\n    })\n  }\n\n  /**\n   * @returns All definitions as an Array.\n   */\n  getDefs() {\n    if (this._parent) {\n      return this._parent.getDefs().concat([...this._defs])\n    } else {\n      return [...this._defs]\n    }\n  }\n\n  /**\n   * @returns An object with all definition names as keys. Packages are excluded.\n   *   The values are arrays with all the definitions that share the name.\n   */\n  getDefsByName() {\n    if (this._defsByNameCache) {\n      return this._defsByNameCache\n    }\n    this._defsByNameCache = this.getDefs().filter(def => def.m_def !== PackageMDef).reduce((result, def) => {\n      result[def.name] = result[def.name] || []\n      result[def.name].push(def)\n      return result\n    }, {})\n    return this._defsByNameCache\n  }\n\n  /**\n   * Gets a definition by its qualified name\n   */\n  getDefByQualifiedName(qualifiedName) {\n    const defQualifiedNameSegments = qualifiedName.split('.')\n    let def\n\n    // Nexus inner sections require special handling as they are not stored at\n    // the package root\n    if (qualifiedName.startsWith('nexus.')) {\n      const pkg = this._packageDefs[defQualifiedNameSegments.shift()]\n      const sectionName = defQualifiedNameSegments.shift()\n      for (const section_def of pkg.section_definitions) {\n        if (sectionName === section_def.name) {\n          def = section_def\n          break\n        }\n      }\n      for (const part of defQualifiedNameSegments) {\n        for (const inner_section_def of def.inner_section_definitions) {\n          if (part === inner_section_def.name) {\n            def = inner_section_def\n            break\n          }\n        }\n      }\n    } else {\n      const packageName = defQualifiedNameSegments.slice(0, -1).join('.')\n      const sectionName = defQualifiedNameSegments[defQualifiedNameSegments.length - 1]\n      const pkg = this._packageDefs[packageName || '*']\n      def = pkg?._sections?.[sectionName]\n    }\n\n    return def\n  }\n\n  /**\n   * Gets a definition by its path (starting with '#' or '/', i.e. from the 'root' of the metainfo data)\n   */\n  getDefByPath(path) {\n    return resolveInternalRef(path, this._data)\n  }\n\n  /**\n   * @returns An object with all package prefixes (the part of the name before the first \".\")\n   *   The values are arrays with all the packages that share the prefix.\n   */\n  getPackagePrefixes() {\n    if (this._packagePrefixCache) {\n      return this._packagePrefixCache\n    }\n    this._packagePrefixCache = this.getDefs()\n      // The definition needs to point to a Package which has a name\n      .filter(def => def.m_def === PackageMDef && def.name)\n      .reduce((results, pkg) => {\n        const packageName = pkg.name\n        if (packageName !== '*') {\n          const prefix = packageName.split('.')[0]\n          results[prefix] = results[prefix] || {}\n          results[prefix][packageName] = pkg\n        }\n        return results\n      }, {})\n    return this._packagePrefixCache\n  }\n\n  /**\n   * @returns An array with all section definitions where not sub-section is using them\n   *   as section definition.\n   */\n  getRootSectionDefinitions() {\n    if (this._rootSectionsCache) {\n      return this._rootSectionsCache\n    }\n    const sortDefs = defs => defs.sort((a, b) => a.name.localeCompare(b.name))\n    this._rootSectionsCache = sortDefs(this.getDefs().filter(def => (\n      def.m_def === SectionMDef && !def.extends_base_section && def._parentSections.length === 0)\n    ))\n    return this._rootSectionsCache\n  }\n\n  getEntryArchiveDefinition() {\n    // TODO this is a super wasteful implementation\n    const entryArchiveDefinition = this.getRootSectionDefinitions().find(def => def.name === 'EntryArchive')\n    return entryArchiveDefinition\n  }\n\n  /**\n   * Parses the metainfo data\n   */\n  async _parse() {\n    // Parse data\n    if (this._data.packages) {\n      // Initial parsing\n      for (const pkg of this._data.packages) {\n        this._addDefIdsToCache(pkg)\n      }\n      // Main parsing\n      let pkgIndex = 0\n      for (const pkg of this._data.packages) {\n        await this._addPackage(pkg, null, this._data, 'packages', pkgIndex++)\n      }\n    }\n    if (this._data.definitions) {\n      // Initial parsing\n      this._addDefIdsToCache(this._data.definitions)\n      // Main parsing\n      const entryId = this._parsedUrl.entryId\n      await this._addPackage(this._data.definitions, `entry_id:${entryId}`, this._data, 'definitions')\n    }\n    this._isParsed = true\n    return this\n  }\n\n  _addDefIdsToCache(def) {\n    // Used for an initial, synchronous shallow parsing, which adds all encountered definition_ids\n    // to this._frozenMetainfoCache, so they can be used when resolving references during the\n    // main parsing step.\n    if (def.definition_id) {\n      if (!this._frozenMetainfoCache[def.definition_id]) {\n        this._frozenMetainfoCache[def.definition_id] = def\n      }\n    }\n    for (const subDefs of [def.category_definitions, def.section_definitions, def.inner_section_definitions, def.quantities]) {\n      if (subDefs) {\n        for (const subDef of subDefs) {\n          this._addDefIdsToCache(subDef)\n        }\n      }\n    }\n  }\n\n  async _addDef(def) {\n    // only add if not already added\n    if (this._defs.has(def)) {\n      return\n    }\n    def.more = def.more || {}\n    def.categories = await this.resolveDefinitionList(def.categories || [])\n    this._defs.add(def)\n    this._defsByNameCache = null\n  }\n\n  async _initSection(sectionDef) {\n    if (sectionDef._allBaseSections !== undefined) {\n      return sectionDef\n    }\n\n    sectionDef.base_sections = sectionDef.base_sections || []\n    sectionDef.quantities = sectionDef.quantities || []\n    sectionDef.sub_sections = sectionDef.sub_sections || []\n    sectionDef.inner_section_definitions = sectionDef.inner_section_definitions || []\n    sectionDef._allBaseSections = []\n    sectionDef._allInternalInheritingSections = []\n    sectionDef._parentSections = []\n    sectionDef._parentSubSections = []\n\n    const resolvedBaseSections = []\n    for (const baseSectionRef of sectionDef.base_sections) {\n      const baseSection = await this.resolveDefinition(baseSectionRef)\n      resolvedBaseSections.push(baseSection)\n      if (!sectionDef.extends_base_section) {\n        await this._initSection(baseSection)\n        sectionDef._allBaseSections.push(baseSection)\n        baseSection._allBaseSections.forEach(baseBaseSection => sectionDef._allBaseSections.push(baseBaseSection))\n        if (typeof baseSectionRef === 'string' && (baseSectionRef.startsWith('#') || baseSectionRef.startsWith('/'))) {\n          // Internal base section link (both this and the base section defined in the same metainfo data)\n          if (!baseSection._allInternalInheritingSections.includes(sectionDef)) {\n            baseSection._allInternalInheritingSections.push(sectionDef)\n          }\n        } else {\n          // External base section link. These are stored in a separate cache in the store.\n          const baseSectionUrl = getUrlFromDefinition(baseSection)\n          let externalInheritingSections = this._externalInheritanceCache[baseSectionUrl]\n          if (!externalInheritingSections) {\n            externalInheritingSections = []\n            this._externalInheritanceCache[baseSectionUrl] = externalInheritingSections\n          }\n          if (!externalInheritingSections.includes(sectionDef)) {\n            externalInheritingSections.push(sectionDef)\n          }\n        }\n      }\n    }\n    sectionDef.base_sections = resolvedBaseSections\n    return sectionDef\n  }\n\n  async _createAllAttributes(sectionDef) {\n    const allSectionAttributes = {}\n    const allQuantityAttributes = {}\n    function createAddAttributes(inherited) {\n      return (sectionDef) => {\n        function createAddAttribute(m_def, allAttributes, inherited) {\n          return (attribute) => {\n            if (!inherited && allAttributes[attribute.name]) {\n              attribute._overwritten = true\n            }\n            attribute.m_def = m_def\n            allAttributes[attribute.name] = attribute\n          }\n        }\n        sectionDef.attributes?.forEach(createAddAttribute(AttributeMDef, allSectionAttributes, inherited))\n        sectionDef.quantities.forEach(quantitiy => {\n          allQuantityAttributes[quantitiy.name] = allQuantityAttributes[quantitiy.name] || {}\n          const quantityAttributes = allQuantityAttributes[quantitiy.name]\n          quantitiy.attributes?.forEach(createAddAttribute(\n            AttributeMDef, quantityAttributes, quantitiy._parent !== sectionDef))\n        })\n      }\n    }\n    sectionDef = await this._initSection(sectionDef)\n    const reversedBaseSections = [...sectionDef._allBaseSections].reverse()\n    reversedBaseSections.forEach(createAddAttributes(true))\n    createAddAttributes(false)(sectionDef)\n\n    sectionDef._allAttributes = Object.keys(allSectionAttributes).map(key => allSectionAttributes[key])\n    sectionDef.quantities.forEach(quantitiy => {\n      const allAttritbutes = allQuantityAttributes[quantitiy.name]\n      quantitiy._allAttributes = Object.keys(allAttritbutes).map(key => allAttritbutes[key])\n    })\n  }\n\n  async _getAllProperties(sectionDef) {\n    const results = {}\n    function createAddProperties(inherited) {\n      return (sectionDef) => {\n        function createAddProperty(m_def) {\n          return (property) => {\n            if (!inherited && results[property.name]) {\n              property._overwritten = true\n            }\n            property.m_def = m_def\n            results[property.name] = property\n          }\n        }\n        sectionDef.quantities.forEach(createAddProperty(QuantityMDef))\n        sectionDef.sub_sections.forEach(createAddProperty(SubSectionMDef))\n      }\n    }\n    sectionDef = await this._initSection(sectionDef)\n    const reversedBaseSections = [...sectionDef._allBaseSections].reverse()\n    reversedBaseSections.forEach(createAddProperties(true))\n    createAddProperties(false)(sectionDef)\n    return Object.keys(results).map(key => results[key])\n  }\n\n  async _addSection(pkg, sectionDef, parentDef, parentProperty, parentIndex) {\n    this._rootSectionsCache = null\n    sectionDef.m_def = SectionMDef\n    sectionDef._parent = parentDef\n    sectionDef._parentProperty = parentProperty\n    sectionDef._parentIndex = parentIndex\n    pkg._sections[sectionDef.name] = sectionDef\n    await this._initSection(sectionDef)\n    sectionDef._qualifiedName = parentDef ? `${parentDef._qualifiedName || parentDef._unique_id || parentDef.name}.${sectionDef.name}` : sectionDef.name\n    sectionDef._package = pkg\n\n    let index = 0\n    for (const innerSectionDef of sectionDef.inner_section_definitions) {\n      await this._addSection(pkg, innerSectionDef, sectionDef, 'inner_section_definitions', index)\n      index++\n    }\n\n    const addPropertiesFromSections = async sections => {\n      for (const ref of sections) {\n        const extendingSectionDef = await this.resolveDefinition(ref)\n        if (extendingSectionDef.quantities) {\n          sectionDef.quantities.push(...extendingSectionDef.quantities)\n        }\n        if (extendingSectionDef.sub_sections) {\n          sectionDef.sub_sections.push(...extendingSectionDef.sub_sections)\n        }\n      }\n    }\n    sectionDef.extending_sections = sectionDef.extending_sections || []\n    await addPropertiesFromSections(sectionDef.extending_sections)\n    if (!sectionDef.extends_base_section) {\n      await this._addDef(sectionDef)\n    }\n\n    sectionDef._allProperties = await this._getAllProperties(sectionDef)\n    sectionDef._properties = {}\n\n    // Do for new properties (i.e. defined in THIS section, not inherited from base sections)\n    const addNewProperty = async (property, parentProperty, index) => {\n      property._section = sectionDef\n      property._parentProperty = parentProperty\n      property._parentIndex = index\n      property._qualifiedName = `${sectionDef._qualifiedName}.${property.name}`\n      property._package = pkg\n      property._parent = sectionDef\n      for (const attribute of (property?.attributes || [])) {\n        attribute._parent = property\n      }\n      await this._addDef(property)\n      if (property.m_def === QuantityMDef) {\n        property.shape = property.shape || []\n        if (isReference(property)) {\n          const referencedDefinition = await this.resolveDefinition(property.type.type_data)\n          property.type._referencedDefinition = referencedDefinition\n        }\n      } else if (property.m_def === SubSectionMDef) {\n        property.sub_section = await this.resolveDefinition(property.sub_section)\n        const subSectionsSectionDef = property.sub_section\n        await this._initSection(subSectionsSectionDef)\n        subSectionsSectionDef._parentSections.push(sectionDef)\n        subSectionsSectionDef._parentSubSections.push(property)\n        property._section = sectionDef\n      }\n    }\n    for (const attribute of (sectionDef?.attributes || [])) {\n      attribute._parent = sectionDef\n    }\n    for (const def of sectionDef.quantities) {\n      await addNewProperty(def, 'quantities', index)\n    }\n    for (const def of sectionDef.sub_sections) {\n      await addNewProperty(def, 'sub_sections', index)\n    }\n\n    // Do for all properties (new + inherited)\n    for (const property of sectionDef._allProperties) {\n      sectionDef._properties[property.name] = property\n    }\n\n    await this._createAllAttributes(sectionDef)\n  }\n\n  async _addPackage(pkg, unique_id, pkgParentData, parentProperty, parentIndex) {\n    this._packagePrefixCache = null\n    pkg.m_def = PackageMDef\n    if (unique_id) {\n      pkg._unique_id = unique_id\n    }\n    const packageName = pkg.name || '*'\n    this._packageDefs[packageName] = pkg\n    for (const alias of pkg?.aliases || []) {\n      this._packageDefs[alias] = pkg\n    }\n    await this._addDef(pkg)\n\n    pkg._pkgParentData = pkgParentData\n    pkg._parentProperty = parentProperty\n    pkg._parentIndex = parentIndex\n    pkg._sections = {}\n    pkg.category_definitions = pkg.category_definitions || []\n    pkg.section_definitions = pkg.section_definitions || []\n    for (const categoryDef of pkg.category_definitions) {\n      categoryDef.m_def = CategoryMDef\n      categoryDef._qualifiedName = `${pkg._unique_id || pkg.name}.${categoryDef.name}`\n      categoryDef._package = pkg\n      await this._addDef(categoryDef)\n    }\n\n    let index = 0\n    for (const sectionDef of pkg.section_definitions) {\n      await this._addSection(pkg, sectionDef, pkg, 'section_definitions', index++)\n    }\n  }\n\n  path(nameOrDef) {\n    let def\n    if (typeof nameOrDef === 'string') {\n      const defsByName = this.getDefsByName()\n      def = defsByName[nameOrDef] && defsByName[nameOrDef].find(def => true)\n    } else {\n      def = nameOrDef\n    }\n\n    if (!def) {\n      return null\n    }\n\n    if (def.m_def === SubSectionMDef) {\n      def = def.sub_section\n    }\n\n    if (def.m_def === CategoryMDef) {\n      return `${def._package.name.split('.')[0]}/category_definitions@${def._qualifiedName}`\n    }\n\n    const path = []\n    const visitedSubSections = new Set()\n    while (def) {\n      if (def.m_def === SectionMDef) {\n        // See if there is a sub-section that uses this section. If there is only one\n        // sub-section, we use this sub-section to represent the section def, because\n        // typically it is more desirable to show the section within the overall hierarchy\n        // than just the section def in its defining package.\n        // We also remember visited sub-sections to avoid circles.\n        const parentSubSections = def._parentSubSections && def._parentSubSections.filter(\n          subSection => !visitedSubSections.has(subSection))\n        if (parentSubSections.length === 1) {\n          def = parentSubSections[0]\n          visitedSubSections.add(def)\n        }\n      }\n\n      if (def._parent?.m_def === PackageMDef) {\n        // For package contents, we need to annotate the path segment corresponding to\n        // the package adaptor in the Metainfo browser.\n        if (def.m_def === SectionMDef) {\n          path.push(`section_definitions@${def._qualifiedName}`)\n        } else if (def.m_def === CategoryMDef) {\n          path.push(`category_definitions@${def._qualifiedName}`)\n        }\n      } else if (def.m_def === PackageMDef) {\n        // For packages, we use only the root package name. This merges you all the\n        // sub-pacakges in one. This is just how the Metainfo adaptor hierarchy is setup.\n        path.push(def.name.split('.')[0])\n      } else {\n        path.push(def.name)\n      }\n\n      if (def._qualifiedName === 'nomad.datamodel.datamodel.EntryArchive') {\n        // If definitions are contained in EntryArchive, we adapt to show them below\n        // the root section EntryArchive instead of its package nomad.\n        path[path.length - 1] = def._qualifiedName\n        def = null\n      } else {\n        def = def._parent\n      }\n\n      while (def && def.extends_base_section) {\n        def = def.base_sections[0]\n      }\n    }\n    return path.reverse().join('/')\n  }\n\n  async resolveDefinitionList(references) {\n    const result = []\n    for (const reference of references) {\n      result.push(await this.resolveDefinition(reference))\n    }\n    return result\n  }\n\n  /**\n   * Resolves a reference found inside this metainfo object\n   */\n  async resolveDefinition(reference, raise = true) {\n    if (typeof reference !== 'string') {\n      // already resolved\n      return reference\n    }\n    let resolvedUrl\n    if (reference.includes('@')) {\n      const versionHash = reference.split('@')[1]\n      const frozenDef = this._frozenMetainfoCache[versionHash]\n      if (frozenDef) {\n        // Found in cache\n        return frozenDef\n      } else {\n        // Not found in cache. Fetch it.\n        resolvedUrl = resolveNomadUrl(reference, this._parsedUrl)\n        await this._getMetainfoAsync(resolvedUrl, raise)\n        return this._frozenMetainfoCache[versionHash] // Should now be in the cache\n      }\n    }\n    if (reference.startsWith('#') || reference.startsWith('/')) {\n      // Local path reference\n      return this.getDefByPath(reference)\n    }\n    resolvedUrl = resolveNomadUrl(reference, this._parsedUrl)\n    if (resolvedUrl.entryId && resolvedUrl.qualifiedName) {\n      // Reference to entry metainfo\n      const metainfo = await this._getMetainfoAsync(resolvedUrl, raise)\n      return metainfo.getDefByQualifiedName(resolvedUrl.qualifiedName)\n    } else if (resolvedUrl.qualifiedName) {\n      // Reference to the system metainfo, using qualified name\n      const systemMetainfo = this._url === systemMetainfoUrl ? this : await this._getMetainfoAsync(systemMetainfoUrl, raise)\n      return systemMetainfo.getDefByQualifiedName(resolvedUrl.qualifiedName)\n    } else if (resolvedUrl.entryId) {\n      // Reference to entry metainfo\n      const metainfo = await this._getMetainfoAsync(resolvedUrl, raise)\n      return metainfo.getDefByPath(resolvedUrl.path)\n    }\n    throw new Error(`Bad reference encountered: ${reference}`)\n  }\n}\n\n/**\n * Converts a reference given in the /section/<index>/subsection format (used\n * in the metainfo) to the /section:<index>/subsection format (used by the\n * archive browser).\n * @param {*} ref The reference to convert.\n */\nexport function refPath(ref) {\n  try {\n    if (ref.startsWith('#')) {\n      ref = ref.slice(1)\n    }\n    const segments = ref.split('/').filter(segment => segment !== '')\n    const reducer = (current, segment) => {\n      return isNaN(segment) ? `${current}/${segment}` : `${current}:${segment}`\n    }\n    return segments.reduce(reducer)\n  } catch (e) {\n    console.log('could not convert the path: ' + ref)\n    throw e\n  }\n}\n\nexport function isReference(property) {\n  return property.type && (\n    property.type.type_kind === 'reference' ||\n    property.type.type_kind === 'quantity_reference')\n}\n\n/**\n * @param {*} def A section definition.\n * @returns True, if sections of the given section def are editable.\n */\nexport function isEditable(def) {\n  return !!def._allProperties.find(prop => prop.m_annotations?.eln) || !!def.m_annotations?.eln\n}\n\nexport function removeSubSection(section, subSectionDef, index) {\n  if (subSectionDef.repeats) {\n    section[subSectionDef.name].splice(index, 1)\n  } else {\n    section[subSectionDef.name] = undefined\n    delete section[subSectionDef.name]\n  }\n}\n\n/**\n * Given a definition, compute its url (string). Optionally, you can specify relativeTo, an\n * object of the form {deploymentUrl, uploadId, entryId} (containing the first, the two first,\n * or all three atributes, depending on what you want the url to be relative to). If relativeTo\n * is left out, we return an absolute url. You may also specify preferMainfile = true if you\n * want the url to use the mainfile rather than the entryId when possible (more humanly readable).\n */\nexport function getUrlFromDefinition(definition, relativeTo = null, preferMainfile = false) {\n  const pkg = definition.m_def === PackageMDef ? definition : definition._package\n  const metainfo = pkg._pkgParentData._metainfo\n  if (!metainfo._parsedUrl.entryId && relativeTo?.deploymentUrl === metainfo._parsedUrl.deploymentUrl) {\n    return definition._qualifiedName\n  }\n  let parentUrl\n  switch (definition.m_def) {\n    case PackageMDef: {\n      const entryId = metainfo._parsedUrl.entryId\n      if (entryId) {\n        // Custom metainfo\n        let rv\n        if (relativeTo) {\n          rv = relativizeNomadUrl(\n            metainfo._parsedUrl, relativeTo.deploymentUrl, relativeTo.uploadId, relativeTo.entryId)\n        } else {\n          rv = metainfo._url\n        }\n        if (preferMainfile) {\n          const mainfile = metainfo._data.metadata.mainfile\n          rv = rv.replace(`/archive/${entryId}`, `/raw/${urlEncodePath(mainfile)}`)\n        }\n        return rv\n      }\n      // System metainfo\n      return urlJoin(metainfo._url, 'packages', definition._parentIndex)\n    }\n    case SectionMDef:\n      parentUrl = getUrlFromDefinition(definition._parent, relativeTo, preferMainfile)\n      break\n    case SubSectionMDef:\n    case QuantityMDef:\n      parentUrl = getUrlFromDefinition(definition._section, relativeTo, preferMainfile)\n      break\n    case CategoryMDef:\n      parentUrl = getUrlFromDefinition(definition._package, relativeTo, preferMainfile)\n      break\n    default:\n      throw new Error('Could not get url from definition: bad m_def')\n  }\n  const ref = `${parentUrl}/${definition._parentProperty}`\n  if (!isNaN(definition._parentIndex)) {\n    return `${ref}/${definition._parentIndex}`\n  }\n  return ref\n}\n\n/**\n * Given a definition, gets the metainfo object in which it is defined.\n */\nexport function getMetainfoFromDefinition(definition) {\n  if (definition._pkgParentData) return definition._pkgParentData._metainfo\n  return getMetainfoFromDefinition(definition._package || definition._parent || definition._section)\n}\n\n/**\n * Allows to traverse a given section through all its sub-sections.\n * @param {Object} section The section to traverse\n * @param {Object} definition The definition of the section\n * @param {str} path The archive path to the section\n * @param {function} callback The callback that is called on each section\n */\nexport function traverse(section, definition, path, callback) {\n  callback(section, definition, path)\n  for (const subSectionDef of definition._allProperties.filter(prop => prop.m_def === SubSectionMDef)) {\n    let subSections = []\n    if (!subSectionDef.repeats) {\n      const subSection = section[subSectionDef.name]\n      if (subSection) {\n        subSections = [subSection]\n      }\n    } else {\n      subSections = section[subSectionDef.name] || []\n    }\n\n    subSections.forEach((subSection, index) => {\n      let childPath = `${path}/${subSectionDef.name}`\n      if (subSectionDef.repeats) {\n        childPath = `${childPath}/${index}`\n      }\n      traverse(subSection, subSectionDef.sub_section, childPath, callback)\n    })\n  }\n}\n\n/**\n * Generator for efficiently returning all quantities of a section. Note that\n * speed becomes quite important with very large metainfo.\n *\n * @param {Object} definition The definition of the section\n * @param {str} prefix The current path\n * @param {array} branch Container that is populated with with add secion\n * definitions that have been ancountered on a certain path through the\n * metainfo. This information is used for avoiding loops that may be\n * present in the metainfo.\n *\n */\nexport function * getQuantities(definition, prefix, branch, repeats = false) {\n  if (!branch) {\n    branch = new Set()\n  }\n  if (definition._allProperties) {\n    for (const def of definition._allProperties) {\n      const quantityName = prefix ? `${prefix}.${def.name}` : def.name\n      if (def.m_def === 'nomad.metainfo.metainfo.Quantity') {\n        yield [def, quantityName, repeats || !isEmpty(def.shape)]\n      } else {\n        yield * getQuantities(def, quantityName, new Set(branch), repeats || def.repeats)\n      }\n    }\n  }\n  const sub_section_def = definition.sub_section\n  if (sub_section_def) {\n    if (branch.has(sub_section_def)) return\n    branch.add(sub_section_def)\n    yield * getQuantities(sub_section_def, prefix, branch, repeats)\n  }\n}\n\n/**\n * Constructs a graph from and with the definition. The graph will contain the given nodes,\n * all its outgoing and incomming references, the parents up to root (for sections and categories)\n *\n * @param {Object} def\n */\nexport function vicinityGraph(def) {\n  const nodesMap = {}\n  const nodes = []\n  const edges = []\n  const dx = 100\n  const dy = 75\n\n  function addEdge(from, to, def) {\n    const edge = {\n      def: def,\n      source: from,\n      target: to,\n      value: 1\n    }\n    edges.push(edge)\n  }\n\n  function addNode(def, more, id) {\n    id = id || (d => d._qualifiedName)\n    const { recursive, x, y, i } = more || {}\n\n    const key = id(def)\n    if (nodesMap[key]) {\n      return nodesMap[key]\n    }\n\n    const node = {\n      id: key,\n      def: def,\n      x: x,\n      y: y,\n      i: i\n    }\n\n    nodes.push(node)\n    nodesMap[key] = node\n\n    if (recursive) {\n      if (def.m_def === SectionMDef) {\n        def._parentSections.forEach(parentSection => {\n          const parent = addNode(parentSection, {\n            recursive: true,\n            x: x - dx,\n            y: y,\n            i: i + 1\n          })\n          addEdge(node, parent, {})\n        })\n        const references = def.quantities.filter(quantity => quantity.type.type_kind === 'reference')\n        const layoutMiddle = (references.length - 1) * dx / 2\n        const metainfo = getMetainfoFromDefinition(def)\n        references.forEach((reference, i) => {\n          try {\n            const referencedSectionDef = resolveInternalRef(reference.type.type_data, metainfo)\n            const referenced = addNode(\n              referencedSectionDef,\n              { x: x + i * dx - layoutMiddle, y: y + dy, i: i },\n              () => reference._qualifiedName)\n            addEdge(node, referenced, reference)\n          } catch (error) {\n            // Ignore for now. External ref?\n          }\n        })\n      } else if (def.m_def === QuantityMDef) {\n        const section = addNode(def._section, {\n          recursive: true,\n          x: x - dx,\n          y: y,\n          i: i + 1\n        })\n        addEdge(node, section, {})\n      }\n\n      if (def.categories) {\n        const layoutMiddle = (def.categories.length - 1) * dx / 2\n        def.categories.forEach((categoryDef, i) => {\n          const category = addNode(categoryDef, {\n            recursive: true,\n            x: x + i * dx - layoutMiddle,\n            y: y - dy,\n            i: i\n          })\n          addEdge(node, category, {})\n        })\n      }\n    }\n\n    return node\n  }\n\n  addNode(def, { recursive: true, x: 0, y: 0, i: 0 })\n\n  return {\n    nodes: nodes,\n    links: edges\n  }\n}\n","/* eslint-disable no-unused-vars */\n/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { withStyles, Link } from '@material-ui/core'\nimport { Link as RouterLink } from 'react-router-dom'\nimport extend from '@babel/runtime/helpers/extends'\nimport ReactMarkdown from 'react-markdown'\nimport MathJax from 'react-mathjax'\nimport RemarkMathPlugin from 'remark-math'\nimport remarkGfm from 'remark-gfm'\nimport { useGlobalMetainfo } from './archive/metainfo'\nimport { appBase } from '../config'\n\n/**\n * A simple markdown component.\n *\n * It uses marked with styled 'borrowed' from the materials ui docs system.\n */\n\nconst styles = theme => {\n  return {\n    root: {\n      fontFamily: theme.typography.fontFamily,\n      fontSize: 16,\n      color: theme.palette.text.primary,\n      '& .anchor-link': {\n        marginTop: -96,\n        // Offset for the anchor.\n        position: 'absolute'\n      },\n      '& pre, & pre[class*=\"language-\"]': {\n        margin: '24px 0',\n        padding: '12px 18px',\n        backgroundColor: theme.palette.primary.veryLight,\n        borderRadius: theme.shape.borderRadius,\n        overflow: 'auto',\n        WebkitOverflowScrolling: 'touch' // iOS momentum scrolling.\n\n      },\n      '& code': {\n        display: 'inline-block',\n        lineHeight: 1,\n        fontFamily: 'Consolas, \"Liberation Mono\", Menlo, Courier, monospace',\n        padding: '5px 4px 2px 4px',\n        color: theme.palette.text.primary.dark,\n        backgroundColor: theme.palette.primary.veryLight,\n        borderRadius: theme.shape.borderRadius,\n        fontSize: 14\n      },\n      '& p code, & ul code': {\n        fontSize: 14\n      },\n      '& pre code': {\n        fontSize: 14,\n        lineHeight: 1.6\n      },\n      '& p:first-child': {\n        marginTop: 0\n      },\n      '& p:last-child': {\n        marginBottom: 0\n      },\n      '& h1': (0, extend)({}, theme.typography.h3, {\n        color: theme.palette.text.primary,\n        margin: '32px 0 16px'\n      }),\n      '& .description': (0, extend)({}, theme.typography.h5, {\n        margin: '0 0 40px'\n      }),\n      '& h2': (0, extend)({}, theme.typography.h4, {\n        color: theme.palette.text.primary,\n        margin: '32px 0 24px'\n      }),\n      '& h3': (0, extend)({}, theme.typography.h5, {\n        color: theme.palette.text.primary,\n        margin: '32px 0 24px'\n      }),\n      '& h4': (0, extend)({}, theme.typography.h6, {\n        color: theme.palette.text.primary,\n        margin: '24px 0 16px'\n      }),\n      '& p, & ul, & ol': {\n        lineHeight: theme.typography.lineHeight,\n        marginBottom: theme.spacing(1)\n      },\n      '& ul': {\n        paddingLeft: theme.spacing(4),\n        '& li': {\n          listStyleType: 'square',\n          fontSize: 'inherit'\n        }\n      },\n      '& h1, & h2, & h3, & h4': {\n        '& code': {\n          fontSize: 'inherit',\n          lineHeight: 'inherit',\n          // Remove scroll on small screens.\n          wordBreak: 'break-word'\n        },\n        '& .anchor-link-style': {\n          opacity: 0,\n          // To prevent the link to get the focus.\n          display: 'none'\n        },\n        '&:hover .anchor-link-style': {\n          display: 'inline-block',\n          opacity: 1,\n          padding: '0 8px',\n          color: theme.palette.text.hint,\n          '&:hover': {\n            color: theme.palette.text.secondary\n          },\n          '& svg': {\n            width: '0.55em',\n            height: '0.55em',\n            fill: 'currentColor'\n          }\n        }\n      },\n      '& table': {\n        width: '100%',\n        display: 'block',\n        overflowX: 'auto',\n        WebkitOverflowScrolling: 'touch',\n        // iOS momentum scrolling.\n        borderCollapse: 'collapse',\n        borderSpacing: 0,\n        overflow: 'hidden',\n        '& .prop-name': {\n          fontSize: 13,\n          fontFamily: 'Consolas, \"Liberation Mono\", Menlo, monospace'\n        },\n        '& .required': {\n          color: theme.palette.type === 'light' ? '#006500' : '#9bc89b'\n        },\n        '& .prop-type': {\n          fontSize: 13,\n          fontFamily: 'Consolas, \"Liberation Mono\", Menlo, monospace',\n          color: theme.palette.type === 'light' ? '#932981' : '#dbb0d0'\n        },\n        '& .prop-default': {\n          fontSize: 13,\n          fontFamily: 'Consolas, \"Liberation Mono\", Menlo, monospace',\n          borderBottom: '1px dotted '.concat(theme.palette.text.hint)\n        }\n      },\n      '& thead': {\n        fontSize: 14,\n        fontWeight: theme.typography.fontWeightMedium,\n        color: theme.palette.text.secondary\n      },\n      '& tbody': {\n        fontSize: 14,\n        lineHeight: 1.5,\n        color: theme.palette.text.primary\n      },\n      '& td': {\n        borderBottom: '1px solid '.concat(theme.palette.divider),\n        padding: '8px 16px 8px 8px',\n        textAlign: 'left'\n      },\n      '& td:last-child': {\n        paddingRight: 24\n      },\n      '& td compact': {\n        paddingRight: 24\n      },\n      '& td code': {\n        fontSize: 13,\n        lineHeight: 1.6\n      },\n      '& th': {\n        whiteSpace: 'pre',\n        borderBottom: '1px solid '.concat(theme.palette.divider),\n        fontWeight: theme.typography.fontWeightMedium,\n        padding: '0 16px 0 8px',\n        textAlign: 'left'\n      },\n      '& th:last-child': {\n        paddingRight: 24\n      },\n      '& tr': {\n        height: 48\n      },\n      '& thead tr': {\n        height: 64\n      },\n      '& strong': {\n        fontWeight: theme.typography.fontWeightMedium\n      },\n      '& blockquote': {\n        borderLeft: '5px solid '.concat(theme.palette.text.hint),\n        backgroundColor: theme.palette.background.paper,\n        padding: '4px 24px',\n        margin: '24px 0'\n      },\n      '& a, & a code': {\n      // Style taken from the Link component\n        color: theme.palette.primary.main,\n        textDecoration: 'none',\n        '&:hover': {\n          textDecoration: 'underline'\n        }\n      },\n      '& img': {\n        maxWidth: '100%'\n      }\n    }\n  }\n}\n\nfunction MarkdownLink({href, ...props}) {\n  if (href.match(/^https?:\\/\\//) || href.startsWith(appBase)) {\n    return <Link href={href} {...props} />\n  } else {\n    return <Link component={RouterLink} to={href} {...props} />\n  }\n}\nMarkdownLink.propTypes = {\n  href: PropTypes.string.isRequired\n}\n\nfunction Markdown(props) {\n  const { classes, text, children, ...moreProps } = props\n  const globalMetainfo = useGlobalMetainfo()\n\n  let content = text\n  if (children) {\n    const state = []\n    // We modify the children for the following reasons:\n    // - remove unnecessary whitespaces that might break the markdown layout\n    // - escape _ (usually in metainfo names) with sensitivity to _ used in latex math\n    // - put metainfo names into code quotes\n    // - turn metainfo names into links into the metainfo\n    let word = ''\n    const letters = children.replace(/^ +/gm, '').split('')\n    content = letters.map((c, i) => {\n      if (c === '`' || c === '$') {\n        if (state.peek === c) {\n          state.pop()\n        } else {\n          state.push(c)\n        }\n      }\n\n      if (c === '[') {\n        state.push(c)\n      }\n      if (c === ']' && state.peek === '[') {\n        state.pop()\n      }\n\n      if (c.match(/[a-zA-Z0-9_]/)) {\n        word += c\n        if (letters.length - 1 === i) {\n          return word\n        }\n      } else {\n        if (state.length === 0 && (word.match(/_/g) || word.match(/[a-z]+[A-Z]/g)) && word.match(/^[a-zA-Z0-9_]+$/g) && c !== ']') {\n          const path = globalMetainfo?.path(word)\n          if (path) {\n            word = `[\\`${word}\\`](/metainfo/${path})`\n          } else if (word.includes('_')) {\n            word = `\\`${word}\\``\n          }\n        }\n        const result = word + c\n        word = ''\n        return result\n      }\n      return ''\n    }).join('')\n  }\n\n  const math = ({value}) => <MathJax.Node formula={value} />\n  const inlineMath = ({value}) => <MathJax.Node inline formula={value} />\n  const newProps = {\n    ...moreProps,\n    children: content,\n    remarkPlugins: [\n      RemarkMathPlugin,\n      remarkGfm\n    ],\n    components: {\n      ...moreProps.components,\n      math: math,\n      inlineMath: inlineMath,\n      a: props => <MarkdownLink {...props} />\n    }\n  }\n  const md = (\n    <MathJax.Provider input=\"tex\">\n      <ReactMarkdown {...newProps} />\n    </MathJax.Provider>\n  )\n\n  return (\n    <div className={classes.root}>{md}</div>\n  )\n}\n\nMarkdown.propTypes = {\n  classes: PropTypes.object.isRequired,\n  text: PropTypes.string,\n  children: PropTypes.string\n}\n\nexport default withStyles(styles)(Markdown)\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { forwardRef, useCallback, useState } from 'react'\nimport { Button, IconButton, Dialog, DialogTitle, DialogContent, DialogActions } from '@material-ui/core'\nimport Markdown from './Markdown'\nimport PropTypes from 'prop-types'\nimport HelpIcon from '@material-ui/icons/Help'\n\nexport const HelpButton = forwardRef(({heading, content, text, maxWidth, IconProps, children, ...IconButtonProps}, ref) => {\n  const [open, setOpen] = useState(false)\n  const handleToggleOpen = useCallback(() => {\n    setOpen(old => !old)\n    IconButtonProps?.onClick?.()\n  }, [IconButtonProps])\n\n  return <>\n    <IconButton {...IconButtonProps} onClick={handleToggleOpen} ref={ref}>\n      {children || <HelpIcon {...IconProps}/>}\n    </IconButton>\n    <HelpDialog heading={heading} content={content} text={text} open={open} onClose={handleToggleOpen} maxWidth={maxWidth} />\n  </>\n})\n\nHelpButton.propTypes = {\n  heading: PropTypes.string,\n  content: PropTypes.string,\n  text: PropTypes.string,\n  maxWidth: PropTypes.string,\n  IconProps: PropTypes.object,\n  children: PropTypes.node\n}\n\nconst HelpDialog = ({heading, content, text, maxWidth, open, onClose}) => {\n  return <Dialog\n    maxWidth={maxWidth}\n    onClose={onClose}\n    open={open}\n  >\n    <DialogTitle>{heading || 'Help'}</DialogTitle>\n    <DialogContent>\n      <Markdown text={text}>{content}</Markdown>\n    </DialogContent>\n    <DialogActions>\n      <Button onClick={onClose} color=\"primary\">\n        Close\n      </Button>\n    </DialogActions>\n  </Dialog>\n}\n\nHelpDialog.propTypes = {\n  heading: PropTypes.string,\n  content: PropTypes.string,\n  text: PropTypes.string,\n  maxWidth: PropTypes.string,\n  open: PropTypes.bool,\n  onClose: PropTypes.func\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { Button, Tooltip } from '@material-ui/core'\n\n/** A button wrapped in a tooltip. All further props are forwarded to the button component. */\nconst TooltipButton = React.forwardRef(function TooltipButton(props, ref) {\n  const {title, component, ...moreProps} = props\n  const button = React.createElement(component || Button, {...moreProps, ref: ref})\n  return <Tooltip title={title}>\n    {button}\n  </Tooltip>\n})\nTooltipButton.propTypes = {\n  /** The tooltip title. */\n  title: PropTypes.string.isRequired,\n  /** The button component. Default is MUI Button. */\n  component: PropTypes.elementType,\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ])\n}\n\nexport default TooltipButton\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useContext, useRef, useState, useMemo, useCallback } from 'react'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\nimport { isNil, isEmpty, isFunction } from 'lodash'\nimport { IconButton, makeStyles, lighten, TableHead, TableRow, TableCell, TableSortLabel,\n  Checkbox, TableContainer, Table, TableBody, TablePagination, Box, Collapse, Toolbar, Typography,\n  List, ListItem, ListItemText, Popover, CircularProgress, Button, Tooltip } from '@material-ui/core'\nimport TooltipButton from '../utils/TooltipButton'\nimport EditColumnsIcon from '@material-ui/icons/ViewColumn'\nimport InfiniteScroll from 'react-infinite-scroller'\nimport {capitalize} from \"../../utils\"\n\nconst DatatableContext = React.createContext({})\nconst StaticDatatableContext = React.createContext({})\n\n/**\n * Combines a pagination request object with an reponse object. This allows to create\n * pagination object as they are expected by Datatable.\n *\n * @param {object} request The request pagination object (i.e. without total, next_page_afte_value, etc.)\n * @param {object} response The response pagination object (returned by NOMAD API)\n * @returns The combined pagination object.\n */\nexport function combinePagination(request, response) {\n  const result = {\n    page_size: request.page_size || response?.page_size,\n    order_by: response.order_by || request?.order_by,\n    order: request.order || response?.order,\n    page: request.page || response?.page,\n    total: response?.total\n  }\n\n  if (!result.page) {\n    result.page_after_value = request.page_after_value || response?.page_after_value\n    result.next_page_after_value = response?.next_page_after_value\n  }\n\n  return result\n}\n\n/**\n * Ensures that all given columns have default values for necessary keys.\n * @param {array} columns An array of columns to extend/check.\n * @param {object} moreDefaults Object containing additional default values\n * @param {object} filterData Object that contains quantity/Filter pairs\n */\nexport function addColumnDefaults(columns, moreDefaults, filterData) {\n  columns.forEach(column => {\n    if (moreDefaults) {\n      Object.keys(moreDefaults).filter(key => !column[key]).forEach(key => { column[key] = moreDefaults[key] })\n    }\n    if (!column.label) {\n      const keySegments = column.key.split('.')\n      const name = keySegments[keySegments.length - 1]\n      column.label = name.replace(/_/g, ' ')\n      column.label = column.label[0].toUpperCase() + column.label.slice(1)\n    }\n    if (!column.render) {\n      const segments = column.key.split('.')\n      column.render = (row) => segments.reduce((current, segment) => current && current[segment], row)\n    }\n    if (column.sortable !== false) {\n      column.sortable = true\n    }\n    const multiple = !isEmpty(filterData?.[column.key]?.shape)\n    if (multiple) {\n      column.sortable = false\n    } else if (isNil(column.sortable)) {\n      column.sortable = !multiple\n    }\n    if (!column.align) {\n      column.align = 'center'\n    }\n    if (!column.description) {\n      column.description = filterData?.[column.key]?.description\n    }\n  })\n}\n\nfunction useDatatableContext() {\n  const context = useContext(DatatableContext)\n  return context\n}\n\nfunction useStaticDatatableContext() {\n  const context = useContext(StaticDatatableContext)\n  return context\n}\n\n/** The page based table pagination. Must be a child of DatatableTable component. */\nexport const DatatablePagePagination = React.memo(function DatatablePagePagination({pageSizeValues}) {\n  const {pagination, onPaginationChanged} = useDatatableContext()\n\n  const handleChangePage = (event, newPage) => {\n    onPaginationChanged({\n      ...pagination,\n      page: newPage + 1\n    })\n  }\n\n  const handleChangeRowsPerPage = (event) => {\n    onPaginationChanged({\n      ...pagination,\n      page: 1,\n      page_size: parseInt(event.target.value, 10)\n    })\n  }\n\n  return <TablePagination\n    rowsPerPageOptions={pageSizeValues || [5, 10, 50, 100]}\n    component=\"div\"\n    count={pagination.total}\n    rowsPerPage={pagination.page_size}\n    page={pagination.page - 1}\n    onPageChange={handleChangePage}\n    onRowsPerPageChange={handleChangeRowsPerPage}\n    data-testid='table-pagination'\n  />\n})\nDatatablePagePagination.propTypes = {\n  /** Optional array of selectable page size values. Default is [5, 10, 50, 100]. */\n  pageSizeValues: PropTypes.arrayOf(PropTypes.number)\n}\n\nconst useDatatableLoadMorePaginationStyles = makeStyles(theme => ({\n  root: {\n    padding: theme.spacing(1),\n    display: 'flex',\n    flexDirection: 'row',\n    justifyContent: 'center',\n    alignItems: 'center',\n    flexWrap: 'nowrap'\n  }\n}))\n\n/** Pagination that uses a \"load more button\" if more data is available. */\nexport const DatatableLoadMorePagination = React.memo(function DatatableLoadMorePagination(props) {\n  const classes = useDatatableLoadMorePaginationStyles()\n  const {pagination, onPaginationChanged} = useDatatableContext()\n\n  const handleClick = useCallback(() => {\n    onPaginationChanged({\n      ...pagination,\n      page_after_value: pagination.next_page_after_value\n    })\n  }, [pagination, onPaginationChanged])\n\n  if (pagination.next_page_after_value) {\n    if (pagination.page_after_value === pagination.next_page_after_value) {\n      return <div className={classes.root}>\n        <CircularProgress size={36} />\n      </div>\n    }\n\n    return <div className={classes.root}>\n      <Button\n        {...props}\n        onClick={handleClick}\n      />\n    </div>\n  }\n\n  return null\n})\nDatatableLoadMorePagination.propTypes = {}\n\nconst useDateatableScollPaginationStyles = makeStyles(theme => ({\n  root: {\n    padding: theme.spacing(2),\n    display: 'flex',\n    flexDirection: 'row',\n    justifyContent: 'center',\n    alignItems: 'center',\n    flexWrap: 'nowrap',\n    fontWeight: 'bold',\n    '& > *': {\n      paddingLeft: theme.spacing(1)\n    }\n  }\n}))\n\n/** The scroll based table pagination. Must be a child of DatatableTable component. */\nexport const DatatableScrollPagination = React.memo(function DatatablePagePagination({loadMessage}) {\n  const {pagination} = useDatatableContext()\n  const classes = useDateatableScollPaginationStyles()\n  if (pagination.next_page_after_value && (pagination.next_page_after_value === pagination.page_after_value)) {\n    return <div className={classes.root}>\n      <CircularProgress size={20} />\n      <Typography color=\"primary\">{loadMessage || 'oading more items ...'}</Typography>\n    </div>\n  } else {\n    return null\n  }\n})\nDatatableScrollPagination.propTypes = {\n  loadMessage: PropTypes.string\n}\n\nconst useDatatableHeaderStyles = makeStyles(theme => ({\n  root: {},\n  visuallyHidden: {\n    border: 0,\n    clip: 'rect(0 0 0 0)',\n    height: 1,\n    margin: -1,\n    overflow: 'hidden',\n    padding: 0,\n    position: 'absolute',\n    top: 20,\n    width: 1\n  },\n  stickyHeader: {\n    background: '#fff'\n  }\n}))\n\nconst DatatableHeader = React.memo(function DatatableHeader({actions}) {\n  const classes = useDatatableHeaderStyles()\n  const {withSelectionFeature, multiSelect} = useStaticDatatableContext()\n  const {\n    selected,\n    onSelectedChanged,\n    shownColumns,\n    sortingColumns,\n    pagination,\n    onPaginationChanged\n  } = useDatatableContext()\n  const columns = shownColumns\n  const {order, order_by} = pagination\n  const withSorting = !!onPaginationChanged\n\n  const handleSelectAllChanged = () => {\n    if (selected === 'all') {\n      onSelectedChanged(new Set())\n    } else {\n      onSelectedChanged('all')\n    }\n  }\n\n  const createSortHandler = (column) => (event) => {\n    const isAsc = order_by === column.key && order === 'asc'\n    onPaginationChanged?.({\n      ...pagination,\n      order: isAsc ? 'desc' : 'asc',\n      order_by: column.key\n    })\n  }\n\n  const sortableColumns = useMemo(() => {\n    if (sortingColumns) {\n      return sortingColumns\n    } else {\n      return columns.filter(column => column.sortable).map(column => column.key)\n    }\n  }, [sortingColumns, columns])\n\n  return <TableHead>\n    <TableRow>\n      {withSelectionFeature && multiSelect && <TableCell padding=\"checkbox\" classes={{stickyHeader: classes.stickyHeader}}>\n        <Checkbox\n          indeterminate={selected.length > 0 && selected !== 'all'}\n          checked={selected === 'all'}\n          onChange={handleSelectAllChanged}\n        />\n      </TableCell>}\n      {columns.map(column => {\n        const label = column.label || capitalize(column.key)\n        const description = column.description || ''\n        const columnLabel = <Tooltip title={description} placement=\"top\">\n          <span>{label}</span>\n        </Tooltip>\n        return <TableCell\n          classes={{stickyHeader: classes.stickyHeader}}\n          key={column.key}\n          align={column.align || 'right'}\n          sortDirection={order_by === column.key ? order : false}\n        >\n          {withSorting && sortableColumns.includes(column.key) ? <TableSortLabel\n            active={order_by === column.key}\n            direction={order_by === column.key ? order : 'asc'}\n            onClick={createSortHandler(column)}\n            data-testid={`sortable_${column.key}`}\n          >\n            {columnLabel}\n            {order_by === column.key ? (\n              <span className={classes.visuallyHidden}>\n                {order === 'desc' ? 'sorted descending' : 'sorted ascending'}\n              </span>\n            ) : null}\n          </TableSortLabel> : columnLabel}\n        </TableCell>\n      })}\n      {actions && <TableCell classes={{stickyHeader: classes.stickyHeader}} />}\n    </TableRow>\n  </TableHead>\n})\nDatatableHeader.propTypes = {\n  actions: PropTypes.oneOfType([\n    PropTypes.elementType,\n    PropTypes.func\n  ])\n}\n\nconst useDatatableRowStyles = makeStyles(theme => ({\n  // The default transparent hover/selection colors are overridden here in order\n  // to make the last actions column work with a 'sticky' positioning.\n  row: {\n    backgroundColor: '#fff'\n  },\n  rowHover: {\n    '&:hover': {\n      backgroundColor: '#f5f5f5 !important'\n    }\n  },\n  rowSelected: {\n    backgroundColor: `${lighten(theme.palette.secondary.light, 0.85)} !important`,\n    '&:hover': {\n      backgroundColor: `${lighten(theme.palette.secondary.light, 0.85)} !important`\n    }\n  },\n  rowWithDetails: {\n    '& > *': {\n      borderBottom: 'unset'\n    }\n  },\n  rowWithUncollapsedDetails: {\n    backgroundColor: `${theme.palette.primary.main} !important`,\n    '&:hover': {\n      backgroundColor: `${theme.palette.primary.main} !important`\n    },\n    '& *': {\n      fontWeight: 'bold',\n      color: `${theme.palette.primary.contrastText} !important`\n    }\n  },\n  rowClickable: {\n    cursor: 'pointer'\n  },\n  rowActionsCell: {\n    textAlign: 'right',\n    width: 1,\n    whiteSpace: 'nowrap',\n    paddingTop: 0,\n    paddingBottom: 0,\n    position: 'sticky',\n    right: 0,\n    backgroundColor: 'inherit'\n  },\n  rowActionsList: {\n    display: 'flex'\n  },\n  detailsCell: {\n    padding: 0\n  }\n}))\n\nconst DatatableRow = React.memo(function DatatableRow({data, selected, uncollapsed, onRowUncollapsed, actions, details, progressIcon}) {\n  const classes = useDatatableRowStyles()\n  const {withSelectionFeature, multiSelect, getId, shownColumns, onSelectedChanged} = useStaticDatatableContext()\n  const columns = shownColumns\n  const row = data\n  const numberOfColumns = columns.length + (withSelectionFeature && multiSelect ? 1 : 0) + (actions ? 1 : 0)\n\n  const handleRowCollapseChange = (event) => {\n    onRowUncollapsed(uncollapsed ? null : row)\n  }\n\n  const handleSelect = onSelectedChanged ? (event) => {\n    event.stopPropagation()\n    onSelectedChanged(selected => {\n      if (multiSelect) {\n        if (selected === 'all') {\n          return new Set([getId(row)])\n        }\n        const isSelected = selected.has(getId(row))\n        if (isSelected) {\n          selected.delete(getId(row))\n          return new Set(selected)\n        } else {\n          selected.add(getId(row))\n          return new Set(selected)\n        }\n      } else {\n        return new Set([getId(row)])\n      }\n    })\n  } : null\n\n  return <>\n    <TableRow\n      classes={{\n        root: classes.row,\n        hover: classes.rowHover,\n        selected: classes.rowSelected\n      }}\n      className={clsx({\n        [classes.rowWithUncollapsedDetails]: uncollapsed,\n        [classes.rowWithDetails]: details,\n        [classes.rowClickable]: details || withSelectionFeature\n      })}\n      hover\n      onClick={details ? handleRowCollapseChange : handleSelect}\n      role=\"checkbox\"\n      tabIndex={-1}\n      selected={selected}\n      data-testid={'datatable-row'}\n    >\n      {withSelectionFeature && multiSelect && <TableCell padding=\"checkbox\">\n        {progressIcon || <Checkbox\n          checked={selected}\n          onClick={handleSelect}\n        />}\n      </TableCell>}\n      {columns.map(column => <TableCell key={column.key} align={column.align || 'right'} style={column.style}>\n        {(column?.render && column?.render(row)) || row[column.key] || ''}\n      </TableCell>)}\n      {actions && <TableCell\n        align=\"right\" size=\"small\" className={classes.rowActionsCell}\n        onClick={(event) => event.stopPropagation()}\n      >\n        <div className={classes.rowActionsList}>\n          {isFunction(actions)\n            ? actions(row)\n            : React.createElement(actions, {data: row})\n          }\n        </div>\n      </TableCell>}\n    </TableRow>\n    {details && <TableRow selected={selected} data-testid={uncollapsed && 'datatable-row'}>\n      <TableCell className={classes.detailsCell} colSpan={numberOfColumns}>\n        <Collapse in={uncollapsed} timeout=\"auto\" unmountOnExit>\n          {React.createElement(details, {data: row})}\n        </Collapse>\n      </TableCell>\n    </TableRow>}\n  </>\n})\nDatatableRow.propTypes = {\n  data: PropTypes.oneOfType([PropTypes.object, PropTypes.string]).isRequired,\n  selected: PropTypes.bool,\n  uncollapsed: PropTypes.bool,\n  onRowUncollapsed: PropTypes.func.isRequired,\n  actions: PropTypes.oneOfType([PropTypes.elementType, PropTypes.func]),\n  details: PropTypes.elementType,\n  progressIcon: PropTypes.node\n}\n\nconst useDatatableTableStyles = makeStyles(theme => ({\n  tableContainer: {\n    flexGrow: 1\n  }\n}))\n\n/** The actional table, including pagination. Must be child of a Datatable component. */\nexport const DatatableTable = React.memo(function DatatableTable({children, actions, details, noHeader, defaultUncollapsedRow}) {\n  const classes = useDatatableTableStyles()\n  const {withSelectionFeature, multiSelect, getId} = useStaticDatatableContext()\n  const {shownColumns, data, pagination, onPaginationChanged, selected} = useDatatableContext()\n  const {page_size} = pagination\n  const emptyRows = Math.max(0, page_size - data.length)\n  const columns = shownColumns\n  const numberOfColumns = columns.length + (withSelectionFeature && multiSelect ? 1 : 0) + (actions ? 1 : 0)\n  const isScrolling = children?.type === DatatableScrollPagination\n  const isExtending = children?.type === DatatableScrollPagination || children?.type === DatatableLoadMorePagination\n  const scrollParentRef = useRef(null)\n\n  const [uncollapsedRow, setUncollapsedRow] = useState(defaultUncollapsedRow || null)\n\n  const handleLoadMore = useCallback(() => {\n    onPaginationChanged(pagination => {\n      const {next_page_after_value, page_after_value} = pagination\n      if (next_page_after_value && page_after_value !== next_page_after_value) {\n        return {\n          ...pagination,\n          page_after_value: next_page_after_value\n        }\n      } else {\n        return pagination\n      }\n    })\n  }, [onPaginationChanged])\n\n  let dataToShow\n  if (isExtending) {\n    // If list extends, all data is rendered regardless of pagination.\n    dataToShow = data\n  } else {\n    // If used correctly, data should give given to Datatable already correctly sliced.\n    // We simply enforce that data is not longer than page_size, just in case.\n    dataToShow = data.slice(data.length < pagination.page_size ? 0 : data.length - pagination.page_size)\n  }\n\n  const table = <Table size=\"medium\" stickyHeader={isScrolling}>\n    {!noHeader && <DatatableHeader actions={actions}/>}\n    <TableBody data-testid='datatable-body'>\n      {dataToShow.map((row, index) => (\n        <DatatableRow\n          actions={actions}\n          details={details}\n          key={index}\n          selected={selected === 'all' || selected?.has(getId(row))}\n          uncollapsed={row === uncollapsedRow}\n          data={row}\n          onRowUncollapsed={setUncollapsedRow}\n          progressIcon={row?.current_process === 'delete_upload' && (row?.process_status === 'PENDING' || row?.process_status === 'RUNNING') && <CircularProgress/>}\n        />\n      ))}\n      {!isExtending && (emptyRows > 0) && (\n        <TableRow style={{ height: 53 * emptyRows }}>\n          <TableCell colSpan={numberOfColumns} />\n        </TableRow>\n      )}\n      <TableRow style={{ height: '1px' }}/>\n    </TableBody>\n  </Table>\n\n  return <TableContainer ref={scrollParentRef} className={classes.tableContainer}>\n    {isScrolling ? (\n      <InfiniteScroll\n        pageStart={0}\n        loadMore={handleLoadMore}\n        hasMore={!!pagination.next_page_after_value}\n        useWindow={false}\n        getScrollParent={() => scrollParentRef.current}\n      >\n        {table}\n      </InfiniteScroll>\n    ) : (\n      table\n    )}\n    {children}\n  </TableContainer>\n})\nDatatableTable.propTypes = {\n  /** Objectal render function or component for row details. Function and component\n   * get row object as \"data\" prop. */\n  details: PropTypes.elementType,\n  /** Objectal render function or component for row actions. Function and component\n   * get row object as \"data\" prop. */\n  actions: PropTypes.oneOfType([PropTypes.elementType, PropTypes.func]),\n  /** Do not show the table header */\n  noHeader: PropTypes.bool,\n  /** Optional pagination component, e.g. DatatablePagePagination. */\n  children: PropTypes.node,\n  /** Optional props to set a row be uncollapsed by default */\n  defaultUncollapsedRow: PropTypes.object\n}\n\n/** Actions displayed in a DatatableToolbar. Must be child of a DatatableToolbar. */\nexport const DatatableToolbarActions = React.memo(function DatatableToolbarActions({children, selection}) {\n  const {selected} = useDatatableContext()\n\n  const hasSelection = selected === 'all' || selected?.size > 0\n  if ((hasSelection && selection) || (!hasSelection && !selection)) {\n    return <React.Fragment>\n      {children}\n    </React.Fragment>\n  }\n\n  return null\n})\nDatatableToolbarActions.propTypes = {\n  /** If true, this component is only shown if the surrounding table as an active selection. */\n  selection: PropTypes.bool,\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ])\n}\n\nconst useDatatableToolbarStyles = makeStyles(theme => ({\n  root: {\n    paddingLeft: theme.spacing(2),\n    paddingRight: theme.spacing(1)\n  },\n  highlight: {\n    color: theme.palette.secondary.main,\n    backgroundColor: lighten(theme.palette.secondary.light, 0.85),\n    '& *': {\n      color: theme.palette.secondary.main\n    }\n  },\n  title: {\n    flex: '1 1 100%',\n    fontSize: '1.1rem'\n  }\n}))\n\n/** A toolbar shown on top of tables. It shows a title, general table actions, and actions\n * on selected rows. Must be child of a Datatable */\nexport const DatatableToolbar = React.memo(function DatatableToolbar({children, title, hideColumns}) {\n  const classes = useDatatableToolbarStyles()\n  const {multiSelect} = useStaticDatatableContext()\n  const {selected} = useDatatableContext()\n  return (\n    <Toolbar\n      className={clsx(classes.root, {\n        [classes.highlight]: selected?.length > 0 && multiSelect\n      })}\n    >\n      {selected?.length > 0 && multiSelect ? (\n        <Typography className={classes.title} color=\"inherit\" variant=\"subtitle1\" component=\"div\">\n          {selected === 'all' ? 'All' : selected.length} selected\n        </Typography>\n      ) : (\n        <Typography className={classes.title} variant=\"h6\" id=\"tableTitle\" component=\"div\">\n          {title || ''}\n        </Typography>\n      )}\n      {children}\n      {!hideColumns && !(selected?.length > 0) && <DatatableColumnSelector />}\n    </Toolbar>\n  )\n})\nDatatableToolbar.propTypes = {\n  /** Optional table title */\n  title: PropTypes.string,\n  hideColumns: PropTypes.bool,\n  /** Children, e.g. DatatableToolbarActions for general and selection actions. */\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ])\n}\n\nconst DatatableColumnSelector = React.memo(function DatatableColumnSelector({children}) {\n  const [anchorEl, setAnchorEl] = useState(null)\n  const {columns, shownColumns, onShownColumnsChanged} = useDatatableContext()\n\n  const handleToggle = (column) => {\n    const index = shownColumns.indexOf(column)\n    if (index > -1) {\n      onShownColumnsChanged([...shownColumns.slice(0, index), ...shownColumns.slice(index + 1)])\n    } else {\n      onShownColumnsChanged([...shownColumns, column])\n    }\n  }\n  return <React.Fragment>\n    <TooltipButton\n      title=\"Change the shown columns\"\n      component={IconButton}\n      onClick={(event) => setAnchorEl(anchorEl ? null : event.currentTarget)}\n    >\n      <EditColumnsIcon/>\n    </TooltipButton>\n    <Popover\n      open={anchorEl !== null}\n      anchorEl={anchorEl}\n      onClose={() => setAnchorEl(null)}\n      anchorOrigin={{\n        vertical: 'bottom',\n        horizontal: 'center'\n      }}\n      transformOrigin={{\n        vertical: 'top',\n        horizontal: 'center'\n      }}\n      data-testid={'column-select-menu'}\n    >\n      <List>\n        {columns.map(column => <ListItem\n          key={column.key} role={undefined} dense button onClick={() => handleToggle(column)}\n        >\n          <Checkbox\n            checked={shownColumns.includes(column)}\n            tabIndex={-1}\n            disableRipple\n          />\n          <ListItemText primary={column.label || column.key} />\n        </ListItem>)}\n      </List>\n    </Popover>\n  </React.Fragment>\n})\nDatatableColumnSelector.propTypes = {\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ])\n}\n\n/** A table with optional header, selectable rows, actions on table, selection, or rows,\n * foldable row details, sortable coluns, editable columns, and pagination.\n * Table is based on array data with row objects and matching speficiation of columns.\n */\nexport const Datatable = React.memo(function Datatable(props) {\n  const {children, multiSelect, getId, ...contextProps} = props\n  const {data, columns} = contextProps\n\n  const [shownColumns, setShownColumns] = useState(\n    props.shownColumns ? columns.filter(column => props.shownColumns.includes(column.key)) : columns\n  )\n  const withSelectionFeature = !!contextProps.selected\n  const shownColumnsObjects = useMemo(() => (\n    columns.filter(column => shownColumns.map(shownColumn => shownColumn.key).includes(column.key))\n  ), [columns, shownColumns])\n\n  const context = {\n    pagination: {\n      page: 1,\n      page_size: data.length,\n      total: data.length\n    },\n    ...contextProps,\n    shownColumns: shownColumnsObjects,\n    onShownColumnsChanged: setShownColumns\n  }\n\n  const staticContext = useMemo(() => ({\n    withSelectionFeature: withSelectionFeature,\n    multiSelect: multiSelect,\n    getId: getId,\n    shownColumns: shownColumnsObjects,\n    onSelectedChanged: props.onSelectedChanged\n  }), [\n    shownColumnsObjects,\n    withSelectionFeature,\n    getId,\n    multiSelect,\n    props.onSelectedChanged])\n\n  return <StaticDatatableContext.Provider value={staticContext}>\n    <DatatableContext.Provider value={context}>\n      <Box display=\"flex\" flexDirection=\"column\" height=\"100%\">\n        {children || <DatatableTable/>}\n      </Box>\n    </DatatableContext.Provider>\n  </StaticDatatableContext.Provider>\n})\nconst paginationBaseProps = {\n  page_size: PropTypes.number,\n  total: PropTypes.number,\n  order: PropTypes.oneOf(['asc', 'desc']),\n  order_by: PropTypes.string\n}\n\nconst selected = function(props, propName, componentName) {\n  const value = props[propName]\n  if ((typeof value === 'string' && (value === 'all' || value === 'All')) || value instanceof Set) {\n    if (value && !props['getId']) {\n      throw new Error(`${componentName} requires 'getId' property when using '${propName}' property.`)\n    }\n  } else if (!isNil(value)) {\n    throw new Error(`Invalid props passed to the ${componentName}. '${propName}' accepts 'all' or a Set() of string IDs.`)\n  }\n}\n\nDatatable.propTypes = {\n  /** Specification for all possible column. */\n  columns: PropTypes.arrayOf(PropTypes.shape({\n    /** Unique key for this column. Should be the row object key for this columns value.\n     * Also used as order_by value. */\n    key: PropTypes.string.isRequired,\n    /** Optional human readible label. Default is key. */\n    label: PropTypes.string,\n    /** Optional human readible description. */\n    description: PropTypes.string,\n    /** If this columns should be sortable. */\n    sortable: PropTypes.bool,\n    /** The alignment of header and values. Default is right. */\n    align: PropTypes.oneOf(['right', 'left', 'center']),\n    /** Optional value render function. Default will render value taken from row object by\n     * columns key. */\n    render: PropTypes.func\n  })),\n  /** Optional array of column keys. Only those columns will be visible. Default is to\n   * show all columns */\n  shownColumns: PropTypes.arrayOf(PropTypes.string),\n  sortingColumns: PropTypes.arrayOf(PropTypes.string),\n  /** Optional table data as array of objects. Default is empty table. */\n  data: PropTypes.arrayOf(PropTypes.oneOfType([PropTypes.object, PropTypes.string])),\n  /** Optional pagination object (e.g. from NOMAD API). Used to display current pagination\n   * and ordering information. Either based on page (if using DatatablePagePagination) or\n   * page_after_value (if using DatatableScrollPagination). */\n  pagination: PropTypes.oneOfType([\n    PropTypes.shape({\n      ...paginationBaseProps,\n      next_page_after_value: PropTypes.number,\n      page_after_value: PropTypes.number\n    }),\n    PropTypes.shape({\n      ...paginationBaseProps,\n      page: PropTypes.number\n    })\n  ]),\n  /** Optional callback to on pagination changes (page, page size, order, ...). Function\n   * that takes new pagination object as parameter. */\n  onPaginationChanged: PropTypes.func,\n  /** Optional value for selected rows to show. It is either the string \"all\" or\n   * an array of selected row objects. If same object, row is shown as\n   * selected. If no value is given, the table will not show any selection boxes. */\n  selected: selected,\n  /** A function to get a unique id or key from the provided rows. Required if selected is provided. */\n  getId: PropTypes.func,\n  multiSelect: PropTypes.bool,\n  /** Optional callback for selection changes. Takes either \"all\" or new array of\n   * selected row objects as parameter. */\n  onSelectedChanged: PropTypes.func,\n  /** Children, e.g. DatatableToolbar and DatatableTable */\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ])\n}\n\nDatatable.defaultProps = {\n  multiSelect: true\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { Tooltip } from '@material-ui/core'\nimport PublishedIcon from '@material-ui/icons/Public'\nimport PrivateIcon from '@material-ui/icons/AccountCircle'\nimport SharedIcon from '@material-ui/icons/SupervisedUserCircle'\nimport VisibleIcon from '@material-ui/icons/Visibility'\nimport NotVisibleIcon from '@material-ui/icons/VisibilityOff'\nimport { isUploadVisibleForAll } from '../../utils'\n\n/**\n * Used to display the status of an Upload. Can work both with upload data and\n * entry data which have different data models.\n */\nconst UploadStatusIcon = React.memo(({data, user, ...props}) => {\n  const coauthors = data?.coauthors || data?.authors?.map(user => user.user_id)\n  const reviewers = data?.reviewers || data?.viewers?.map(user => user.user_id)\n  const isVisibleForAll = isUploadVisibleForAll(data)\n  const shared = data?.coauthors?.length > 0 || data?.reviewers?.length > 0 || data?.viewers?.length > 1\n  const isMainAuthor = user && (data.main_author?.user_id === user.sub || data.main_author === user.sub)\n  const isReviewer = user && reviewers?.find(user_id => user_id === user.sub)\n  const isCoauthor = user && coauthors?.find(user_id => user_id === user.sub)\n  let Icon = isVisibleForAll ? VisibleIcon : shared ? SharedIcon : PrivateIcon\n\n  let tooltip, color, role\n  if (!data) {\n    tooltip = 'Upload status not available'\n    color = 'action'\n  } else if (data.published) {\n    if (data.with_embargo) {\n      color = 'error'\n      if (isMainAuthor) {\n        tooltip = \"Published with embargo by you and only accessible by you, coauthors and reviewers\"\n      } else if (isCoauthor) {\n        tooltip = \"Published with embargo and accessible by you as a coauthor\"\n      } else if (isReviewer) {\n        tooltip = \"Published with embargo and accessible by you as a reviewer\"\n      } else {\n        Icon = NotVisibleIcon\n        if (user) {\n          tooltip = \"Published with embargo and not accessible by you\"\n        } else {\n          tooltip = \"Published with embargo and might become accessible after login\"\n        }\n      }\n    } else {\n        role = 'published-upload-icon'\n        tooltip = \"Published and accessible by everyone\"\n        Icon = PublishedIcon\n        color = 'primary'\n    }\n  } else {\n      if (isVisibleForAll) {\n        tooltip = \"Unpublished but accessible by everyone\"\n      } else if (isMainAuthor) {\n        tooltip = \"Unpublished, accessible by you, coauthors and reviewers\"\n      } else if (isCoauthor) {\n        tooltip = \"Unpublished, accessible by you as a coauthor\"\n      } else if (isReviewer) {\n        tooltip = \"Unpublished, accessible by you as a reviewer\"\n      } else {\n        tooltip = \"Unpublished\"\n      }\n      color = 'error'\n  }\n\n  return <Tooltip title={tooltip}>\n      <Icon color={color} role={role} {...props} />\n  </Tooltip>\n})\nUploadStatusIcon.propTypes = {\n  data: PropTypes.object, // The upload/entry data\n  user: PropTypes.object // The user object from API\n}\n\nexport default UploadStatusIcon\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { isNil, isArray, isEmpty } from 'lodash'\nimport { searchQuantities } from '../../config'\nimport {\n  getDatatype,\n  getSerializer,\n  getDeserializer,\n  getDisplayLabel,\n  DType,\n  multiTypes\n} from '../../utils'\nimport { Unit } from '../units/Unit'\n\n/**\n * Filter is a wrapper for metainfo (quantity or section) that can be searched.\n * It contains information extracted from the metainfo together with additional\n * configuration that can e.g. be extracted from the NOMAD configuration file.\n */\nexport class Filter {\n  options\n  aggs\n  value\n  placeholder\n  multiple\n  exclusive\n  unit\n  dtype\n  customSerialization\n  serializerExact\n  serializerPretty\n  dimension\n  deserializer\n  label\n  nested\n  aggregatable\n  section\n  repeats\n  widget\n  parent\n  description\n  scale\n  /**\n  * @param {obj} def Metainfo definition. Optional as filters may not\n  *   correspond to metainfo items.\n  * @param {obj} params Contains configuration for the filter.\n  *  - dtype: The data type for this filter. If no value is given and the\n  *      name corresponds to a metainfo name the data type is read directly from\n  *      the metainfo.\n  *  - description: Description of the filter shown e.g. in the tooltips. If no\n  *      value is given and the name corresponnds to a metainfo, the metainfo\n  *      description is used.\n  *  - unit: The unit for this filter. If no value is given and the name\n  *      corresponds to a metainfo name the data type is read directly from the\n  *      metainfo.\n  *  - label: Short name displayed for this filter. If no value is given and the\n  *      name corresponds to a metainfo name the description is read directly\n  *      from the metainfo.\n  *  - quantity: The quantity that this filter targets in the metainfo.\n  *  - schema: The schema in which the filter quantity is defined in\n  *  - placeholder: Placeholder displayed for this filter in input fields.\n  *  - multiple: Whether the user can simultaneously provide multiple values for\n  *      this filter.\n  *  - exclusive: Whether this filter is exclusive: only one value is\n  *      associated with a single entry.\n  *  - queryMode: The default query mode (e.g. 'any', 'all) when multiple values\n  *      can specified for this filter. Defaults to 'any'.\n  *  - options: Object containing explicit options that this filter supports.\n  *  - default: A default value which is implicitly enforced in the API call.\n  *      This value will not be serialized in the search bar.\n  *  - scale: The default scaling to perform for filter statistics.\n  *  - value: Optional object containing a custom setter/getter for the filter value.\n  *      Used when transforming the value from GUI to API and vice versa. E.g.\n  *        value = {\n  *          get: (value) => value\n  *          set: (value) => value\n  *        }\n  *  - aggs: Object containing default values for specific aggregation types\n  *      that may be requested for this filter.\n  *      Also completely customized setter/getter methods are supported. E.g.\n  *        aggs = {\n  *          terms: {size: 5},\n  *          histogram: {buckets: 20},\n  *          min_max: {set: (config) => ({}), get: (agg) => ({})}\n  *        }\n  *  - requestQuantity: Optional name to use for this quantity in the final API call.\n  *  - nested: Provided for sections, determines whether they are configured as\n  *      nested field types in ES.\n  *  - repeats: Provided for sections, determines whether they can be repeated.\n  *  - global: Whether this is a 'global' filter. Global filters can affect the\n  *      behaviour of other filters without being serialized into the query\n  *      itself. E.g. toggling the exclusive search for elements is a global\n  *      filter that does not correspond to any metainfo and only affects how\n  *      the element search is performed.\n  *  - customSerialization:\n  *  - serializerExact: Function that serializes the value of the filter in an exact way.\n  *      Used to e.g. serialize the filter value for the URL.\n  *  - serializerPretty: Function that serializes the value for displaying it in the GUI.\n  *      May e.g. contain less decimals and not be serializable in the URL.\n  *  - deserializer: Function that deserializes the value from the URL and from\n  *      user input.\n  *  - aggregatable: Indicates whether this filter can be used in term aggregations.\n  *  - widget: Object that determines the default widget for this filter.\n  * @param {Filter} parent Optional parent filter\n  */\n  constructor(def, params, parent) {\n    this.def = def\n    this.name = params?.name || def?.name\n    this.quantity = params?.quantity || def?.quantity\n    this.schema = params?.schema || def?.schema\n\n    function getRepeatsSection(def) {\n      return isNil(def?.repeats)\n        ? false\n        : def.repeats\n    }\n    function getRepeatsQuantity(def) {\n      if (!isEmpty(def?.shape)) return true\n      return getRepeatsSection(def)\n    }\n\n    this.dtype = params?.dtype || getDatatype(def)\n    this.description = params?.description || def?.description\n    this.unit = params?.unit || def?.unit\n    this.dimension = def?.unit ? new Unit(def?.unit).dimension() : 'dimensionless'\n    this.label = params?.label || getDisplayLabel(def)\n    this.parent = parent\n    this.group = params.group\n    this.placeholder = params?.placeholder\n    this.multiple = params?.multiple === undefined\n      ? multiTypes.has(this.dtype)\n      : params?.multiple\n    this.exclusive = params?.exclusive === undefined ? true : params?.exclusive\n    this.queryMode = params?.queryMode || (this.multiple ? 'any' : undefined)\n    this.options = params?.options || getEnumOptions(def)\n    this.default = params?.default\n    this.suggestion = !isNil(params?.suggestion) ? params.suggestion : (!isNil(def?.suggestion) ? def.suggestion : false)\n    this.scale = params?.scale || 'linear'\n    this.value = params?.value\n    this.aggs = params?.aggs\n    this.requestQuantity = params?.requestQuantity\n    this.nested = params?.nested === undefined ? false : params?.nested\n    this.repeats = params?.repeats === undefined ? getRepeatsQuantity(def) : params?.repeats\n    this.repeats_section = getRepeatsSection(def)\n    this.scalar = isEmpty(def?.shape)\n    this.global = params?.global === undefined ? false : params?.global\n    this.section = !isNil(def?.nested)\n    this.customSerialization = !!params?.serializerExact\n    this.serializerExact = params?.serializerExact || getSerializer(this.dtype, false)\n    this.serializerPretty = params?.serializerPretty || getSerializer(this.dtype, true)\n    this.deserializer = params?.deserializer || getDeserializer(this.dtype, this.dimension)\n    this.aggregatable = params?.aggregatable === undefined ? false : params?.aggregatable\n    this.widget = params?.widget || getWidgetConfig(this.quantity, this.dtype, params?.aggregatable, this.scale)\n\n    if (this.default && !this.global) {\n      throw Error(`Error constructing filter for ${this.name}: only filters that do not correspond to a metainfo value may have default values set.`)\n    }\n    if (this.queryMode && !this.multiple) {\n      throw Error(`Error constructing filter for ${this.name}: only filters that accept multiple values may have a query mode.`)\n    }\n  }\n}\n\n/**\n * Used to gather a list of fixed filter options from the metainfo.\n * @param {string} quantity Metainfo name\n * @returns Dictionary containing the available options and their labels.\n */\nexport function getEnumOptions(quantity, exclude = ['not processed']) {\n  const metainfoOptions = searchQuantities?.[quantity]?.type?.type_data\n  if (isArray(metainfoOptions) && metainfoOptions.length > 0) {\n    const opt = {}\n    for (const name of metainfoOptions) {\n      opt[name] = {label: name}\n    }\n    exclude.forEach(value => delete opt[value])\n    return opt\n  }\n}\n\n/**\n * Tries to automatically create a default widget config for the given\n * quantity.\n *\n * @param {string} parent Parent quantity\n * @param {DType} dtype Datatype of the quantity\n * @param {bool} aggregatable Whether the quantity is aggregatable\n * @returns A widget config object.\n */\nexport const getWidgetConfig = (quantity, dtype, aggregatable, scale) => {\n  if (dtype === DType.Float || dtype === DType.Int || dtype === DType.Timestamp) {\n    return {\n      x: {quantity},\n      type: 'histogram',\n      scale,\n      showinput: false,\n      autorange: false,\n      nbins: 30,\n      layout: {\n        sm: {w: 8, h: 3, minW: 3, minH: 3},\n        md: {w: 8, h: 3, minW: 3, minH: 3},\n        lg: {w: 8, h: 3, minW: 3, minH: 3},\n        xl: {w: 8, h: 3, minW: 3, minH: 3},\n        xxl: {w: 8, h: 3, minW: 3, minH: 3}\n      }\n    }\n  } else if (aggregatable) {\n    return {\n      quantity,\n      type: 'terms',\n      scale: scale,\n      showinput: false,\n      layout: {\n        sm: {w: 6, h: 9, minW: 3, minH: 3},\n        md: {w: 6, h: 9, minW: 3, minH: 3},\n        lg: {w: 6, h: 9, minW: 3, minH: 3},\n        xl: {w: 6, h: 9, minW: 3, minH: 3},\n        xxl: {w: 6, h: 9, minW: 3, minH: 3}\n      }\n    }\n  }\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect, useState, useMemo } from 'react'\nimport PropTypes from 'prop-types'\nimport { useGlobalMetainfo, getQuantities } from '../archive/metainfo'\nimport { setToArray, DType, getSuggestions, getOptions, getDatatype, glob, parseQuantityName } from '../../utils'\nimport { searchQuantities, schemaSeparator, dtypeSeparator, yamlSchemaPrefix } from '../../config'\nimport { Filter, getEnumOptions } from './Filter'\nimport elementData from '../../elementData'\nimport { Typography, Box } from '@material-ui/core'\nimport { useErrors } from '../errors'\n\n// Containers for filter information\nexport const defaultFilterGroups = {} // Mapping from a group name -> set of filter names\nexport const defaultFilterData = {} // Stores data for each registered filter\nconst dtypeMap = {\n  [DType.Int]: 'int',\n  [DType.Float]: 'float',\n  [DType.Timestamp]: 'datetime',\n  [DType.String]: 'str',\n  [DType.Enum]: 'str',\n  [DType.Boolean]: 'bool'\n}\n\n// Ids for the filter menus: used to tie filter chips to a specific menu.\nconst idElements = 'elements'\nconst idStructure = 'structure'\nconst idMethod = 'method'\nconst idDFT = 'dft'\nconst idTB = 'tb'\nconst idGW = 'gw'\nconst idBSE = 'bse'\nconst idDMFT = 'dmft'\nconst idPrecision = 'precision'\nconst idProperties = 'properties'\nconst idElectronic = 'electronic'\nconst idSolarCell = 'solarcell'\nconst idCatalyst = 'heterogeneouscatalyst'\nconst idVibrational = 'vibrational'\nconst idMechanical = 'mechanical'\nconst idSpectroscopic = 'spectroscopic'\nconst idMolecularDynamics = 'molecular_dynamics'\nconst idGeometryOptimization = 'geometry_optimization'\nconst idELN = 'eln'\nconst idCustomQuantities = 'custom_quantities'\nconst idAuthor = 'author'\nconst idMetadata = 'metadata'\nconst idOptimade = 'optimade'\n\n/**\n * Associates the given quantity name with the given group name in the filter\n * group data.\n *\n * @param {object} groups The groups to work on.\n * @param {str} groupName\n * @param {str} quantityName\n */\nfunction addToGroup(groups, groupName, quantityName) {\n  groups[groupName]\n    ? groups[groupName].add(quantityName)\n    : groups[groupName] = new Set([quantityName])\n}\n\n/**\n * This function is used to register a new filter within the SearchContext.\n * Filters are entities that can be searched through the filter panel and the\n * search bar, and can be encoded in the URL. Notice that a filter in this\n * context does not necessarily have to correspond to a quantity in the\n * metainfo, altought typically this is preferrable.\n *\n * Only registered filters may be searched for. The registration must happen\n * before any components use the filters. This is because:\n *  - The initial aggregation results must be fetched before any components\n *  using the filter values are rendered.\n *  - Several components need to know the list of available filters (e.g. the\n *  search bar and the search panel). If filters are only registered during\n *  component initialization, it may already be too late to update other\n *  components.\n *\n * @param {string} name Name of the filter.\n * @param {string} group The group into which the filter belongs to. Groups\n * are used to e.g. in showing FilterSummaries about a group of filters.\n * @param {obj} config Data object containing options for the filter.\n */\nfunction saveFilter(name, group, config, parent) {\n  if (defaultFilterData[name]) {\n    throw Error(`Trying to register filter \"${name}\"\" multiple times.`)\n  }\n  const def = searchQuantities[name]\n  const {path: quantity, schema} = parseQuantityName(name)\n  const newConf = {...(config || {}), quantity, schema, name: config?.name || def?.name || name, aggregatable: def?.aggregatable, group: group}\n  const data = defaultFilterData[name] || new Filter(def, newConf, parent)\n  defaultFilterData[name] = data\n  return data\n}\n\n/**\n * Used to register a filter value for an individual metainfo quantity or\n * section.\n */\nfunction registerFilter(name, group, config, subQuantities) {\n  const parent = saveFilter(name, group, config)\n  if (subQuantities) {\n    for (const subConfig of subQuantities) {\n      const subname = `${name}.${subConfig.name}`\n      saveFilter(subname, group, subConfig, parent)\n    }\n  }\n}\n\n/**\n * Used to register a filter that is based on a subset of quantity values.\n */\nfunction registerFilterOptions(name, group, target, label, description, options) {\n  const keys = Object.keys(options)\n  registerFilter(\n    name,\n    group,\n    {\n      aggs: {\n        terms: {\n          set: ((target) => (config) => ({quantity: target, include: keys, ...config}))(target),\n          get: (() => (agg) => agg)(target)\n        }\n      },\n      value: {\n        set: (newQuery, oldQuery, value) => {\n          const data = newQuery[target] || new Set()\n          value.forEach((item) => { data.add(item) })\n          newQuery[`${target}:all`] = data\n        }\n      },\n      dtype: DType.Enum,\n      multiple: true,\n      repeats: true,\n      exclusive: false,\n      queryMode: 'all',\n      options: options,\n      label: label,\n      description: description\n    }\n  )\n}\n\n// Presets for different kind of quantities\nconst termQuantity = {aggs: {terms: {size: 5}}}\nconst termQuantityLarge = {aggs: {terms: {size: 10}}}\nconst termQuantityBool = {\n  aggs: {terms: {size: 2, include: ['false', 'true']}},\n  options: {\n    false: {label: 'false'},\n    true: {label: 'true'}\n  }\n}\nconst termQuantityNonExclusive = {aggs: {terms: {size: 5}}, exclusive: false}\nconst termQuantityAll = {aggs: {terms: {size: 5}}, exclusive: false, multiple: true, queryMode: 'all'}\nconst termQuantityAllNonExclusive = {...termQuantityNonExclusive, queryMode: 'all'}\nconst noAggQuantity = {}\nconst nestedQuantity = {}\nconst noQueryQuantity = {multiple: false, global: true}\nconst numberHistogramQuantity = {multiple: false, exclusive: false}\n\n// Filters that directly correspond to a metainfo value\nregisterFilter(\n  'results.material.structural_type',\n  idStructure,\n  {\n    ...termQuantity,\n    scale: 'log',\n    label: \"Dimensionality\",\n    options: getEnumOptions('results.material.structural_type', ['not processed', 'unavailable'])\n  }\n)\n\nregisterFilter('results.material.functional_type', idStructure, termQuantityNonExclusive)\nregisterFilter('results.material.compound_type', idStructure, termQuantityNonExclusive)\nregisterFilter('results.material.material_name', idStructure, termQuantity)\nregisterFilter('results.material.chemical_formula_hill', idElements, {...termQuantity, placeholder: \"E.g. H2O2, C2H5Br\"})\nregisterFilter('results.material.chemical_formula_iupac', idElements, {...termQuantity, placeholder: \"E.g. GaAs, SiC\", label: 'Chemical formula IUPAC'})\nregisterFilter('results.material.chemical_formula_reduced', idElements, {...termQuantity, placeholder: \"E.g. H2NaO, ClNa\"})\nregisterFilter('results.material.chemical_formula_anonymous', idElements, {...termQuantity, placeholder: \"E.g. A2B, A3B2C2\"})\nregisterFilter('results.material.n_elements', idElements, {...numberHistogramQuantity})\nregisterFilter('results.material.symmetry.bravais_lattice', idStructure, termQuantity)\nregisterFilter('results.material.symmetry.crystal_system', idStructure, termQuantity)\nregisterFilter(\n  'results.material.symmetry.structure_name',\n  idStructure,\n  {\n    ...termQuantity,\n    options: getEnumOptions('results.material.symmetry.structure_name', ['not processed', 'cubic perovskite'])\n  }\n)\nregisterFilter('results.material.symmetry.strukturbericht_designation', idStructure, termQuantity)\nregisterFilter('results.material.symmetry.space_group_symbol', idStructure, {...termQuantity, placeholder: \"E.g. Pnma, Fd-3m, P6_3mc\"})\nregisterFilter('results.material.symmetry.point_group', idStructure, {...termQuantity, placeholder: \"E.g. 6mm, m-3m, 6/mmm\"})\nregisterFilter('results.material.symmetry.hall_symbol', idStructure, {...termQuantity, placeholder: \"E.g. F 4d 2 3 -1d\"})\nregisterFilter('results.material.symmetry.prototype_aflow_id', idStructure, {...termQuantity, placeholder: \"E.g. A_cF8_227_a\"})\nregisterFilter(\n  'results.material.topology',\n  idStructure,\n  nestedQuantity,\n  [\n    {name: 'label', ...termQuantity},\n    {name: 'method', ...termQuantity},\n    {name: 'dimensionality', ...termQuantity},\n    {name: 'building_block', ...termQuantity},\n    {name: 'material_id', ...termQuantity},\n    {name: 'material_name', ...termQuantity},\n    {name: 'symmetry.prototype_name', ...termQuantity},\n    {name: 'symmetry.prototype_label_aflow', ...termQuantity},\n    {name: 'n_atoms', ...numberHistogramQuantity},\n    {name: 'atomic_fraction', ...numberHistogramQuantity},\n    {name: 'mass_fraction', ...numberHistogramQuantity},\n    {name: 'system_relation.type', ...termQuantity},\n    {name: 'cell.a', ...numberHistogramQuantity},\n    {name: 'cell.b', ...numberHistogramQuantity},\n    {name: 'cell.c', ...numberHistogramQuantity},\n    {name: 'cell.alpha', ...numberHistogramQuantity},\n    {name: 'cell.beta', ...numberHistogramQuantity},\n    {name: 'cell.gamma', ...numberHistogramQuantity},\n    {name: 'cell.atomic_density', ...numberHistogramQuantity},\n    {name: 'cell.mass_density', ...numberHistogramQuantity},\n    {name: 'cell.volume', ...numberHistogramQuantity},\n    {name: 'sbu_type', ...termQuantity},\n    {name: 'largest_cavity_diameter', ...numberHistogramQuantity},\n    {name: 'pore_limiting_diameter', ...numberHistogramQuantity},\n    {name: 'largest_included_sphere_along_free_sphere_path', ...numberHistogramQuantity},\n    {name: 'accessible_surface_area', ...numberHistogramQuantity},\n    {name: 'accessible_volume', ...numberHistogramQuantity},\n    {name: 'void_fraction', ...numberHistogramQuantity},\n    {name: 'n_channels', ...numberHistogramQuantity},\n    {name: 'sbu_coordination_number', ...numberHistogramQuantity}\n  ]\n)\nregisterFilter(\n  'results.material.elemental_composition',\n  idStructure,\n  nestedQuantity,\n  [\n    {name: 'element', ...termQuantity},\n    {name: 'atomic_fraction', ...numberHistogramQuantity},\n    {name: 'mass_fraction', ...numberHistogramQuantity}\n  ]\n)\nregisterFilter(\n  'results.material.topology.elemental_composition',\n  idStructure,\n  nestedQuantity,\n  [\n    {name: 'element', ...termQuantity},\n    {name: 'atomic_fraction', ...numberHistogramQuantity},\n    {name: 'mass_fraction', ...numberHistogramQuantity}\n  ]\n)\nregisterFilter(\n  'results.material.topology.active_orbitals',\n  idStructure,\n  nestedQuantity,\n  [\n    {name: 'n_quantum_number', ...termQuantity},\n    {name: 'l_quantum_number', ...termQuantity},\n    {name: 'l_quantum_symbol', ...termQuantity},\n    {name: 'ml_quantum_symbol', ...termQuantity},\n    {name: 'ms_quantum_symbol', ...termQuantity},\n    {name: 'j_quantum_number', ...termQuantity},\n    {name: 'mj_quantum_number', ...termQuantity},\n    {name: 'occupation', ...termQuantity},\n    {name: 'n_electrons_excited', ...termQuantity},\n    {name: 'degeneracy', ...termQuantity}\n  ]\n)\nregisterFilter('results.method.method_name', idMethod, {...termQuantity, scale: 'log'})\nregisterFilter('results.method.workflow_name', idMethod, {...termQuantity, scale: 'log'})\nregisterFilter('results.method.simulation.program_name', idMethod, {...termQuantity, scale: 'log'})\nregisterFilter('results.method.simulation.program_version', idMethod, termQuantity)\nregisterFilter('results.method.simulation.program_version_internal', idMethod, termQuantity)\nregisterFilter('results.method.simulation.precision.native_tier', idPrecision, {...termQuantity, placeholder: \"E.g. VASP - accurate\", label: 'Code-specific tier'})\nregisterFilter('results.method.simulation.precision.k_line_density', idPrecision, {...numberHistogramQuantity, scale: 'log', label: 'k-line density'})\nregisterFilter('results.method.simulation.precision.basis_set', idPrecision, {...termQuantity, scale: 'log'})\nregisterFilter('results.method.simulation.precision.planewave_cutoff', idPrecision, {...numberHistogramQuantity, label: 'Plane-wave cutoff', scale: 'log'})\nregisterFilter('results.method.simulation.precision.apw_cutoff', idPrecision, {...numberHistogramQuantity, label: 'APW cutoff', scale: 'log'})\nregisterFilter('results.method.simulation.dft.core_electron_treatment', idDFT, termQuantity)\nregisterFilter('results.method.simulation.dft.jacobs_ladder', idDFT, {...termQuantity, scale: 'log', label: 'Jacob\\'s ladder'})\nregisterFilter('results.method.simulation.dft.xc_functional_type', idDFT, {\n  ...termQuantity,\n  scale: 'log',\n  label: 'Jacob\\'s ladder',\n  options: {\n    'LDA': {label: 'LDA'},\n    'GGA': {label: 'GGA'},\n    'meta-GGA': {label: 'Meta-GGA'},\n    'hyper-GGA': {label: 'Hyper-GGA'},\n    'hybrid': {label: 'Hybrid'}\n  }\n})\nregisterFilter('results.method.simulation.dft.xc_functional_names', idDFT, {...termQuantityNonExclusive, scale: 'log', label: 'XC functional names'})\nregisterFilter('results.method.simulation.dft.exact_exchange_mixing_factor', idDFT, {...numberHistogramQuantity, scale: 'log'})\nregisterFilter('results.method.simulation.dft.hubbard_kanamori_model.u_effective', idDFT, {...numberHistogramQuantity, scale: 'log'})\nregisterFilter('results.method.simulation.dft.relativity_method', idDFT, termQuantity)\nregisterFilter('results.method.simulation.tb.type', idTB, {...termQuantity, scale: 'log'})\nregisterFilter('results.method.simulation.tb.localization_type', idTB, {...termQuantity, scale: 'log'})\nregisterFilter('results.method.simulation.gw.type', idGW, {...termQuantity, label: 'GW type'})\nregisterFilter('results.method.simulation.gw.starting_point_type', idGW, {\n  ...termQuantity,\n  scale: 'log',\n  options: {\n    'LDA': {label: 'LDA'},\n    'GGA': {label: 'GGA'},\n    'meta-GGA': {label: 'Meta-GGA'},\n    'hyper-GGA': {label: 'Hyper-GGA'},\n    'hybrid': {label: 'Hybrid'},\n    'HF': {label: 'HF'}\n  }\n})\nregisterFilter('results.method.simulation.gw.basis_set_type', idGW, {...termQuantity, scale: 'log'})\nregisterFilter('results.method.simulation.bse.type', idBSE, termQuantity)\nregisterFilter('results.method.simulation.bse.solver', idBSE, termQuantity)\nregisterFilter('results.method.simulation.bse.starting_point_type', idBSE, {\n  ...termQuantity,\n  scale: 'log',\n  options: {\n    'LDA': {label: 'LDA'},\n    'GGA': {label: 'GGA'},\n    'meta-GGA': {label: 'Meta-GGA'},\n    'hyper-GGA': {label: 'Hyper-GGA'},\n    'hybrid': {label: 'Hybrid'},\n    'HF': {label: 'HF'}\n  }\n})\nregisterFilter('results.method.simulation.bse.basis_set_type', idBSE, {...termQuantity, scale: 'log'})\nregisterFilter('results.method.simulation.bse.gw_type', idBSE, {...termQuantity, scale: 'log', label: `GW type`})\nregisterFilter('results.method.simulation.dmft.impurity_solver_type', idDMFT, {...termQuantity})\nregisterFilter('results.method.simulation.dmft.magnetic_state', idDMFT, {...termQuantity})\nregisterFilter('results.method.simulation.dmft.inverse_temperature', idDMFT, {...numberHistogramQuantity, scale: 'log'})\nregisterFilter('results.method.simulation.dmft.u', idDMFT, {...numberHistogramQuantity, scale: 'log'})\nregisterFilter('results.method.simulation.dmft.jh', idDMFT, {...numberHistogramQuantity, label: `JH`, scale: 'log'})\nregisterFilter('results.method.simulation.dmft.analytical_continuation', idDMFT, {...termQuantity})\nregisterFilter('results.eln.sections', idELN, termQuantity)\nregisterFilter('results.eln.tags', idELN, termQuantity)\nregisterFilter('results.eln.methods', idELN, termQuantity)\nregisterFilter('results.eln.instruments', idELN, termQuantity)\nregisterFilter('results.eln.lab_ids', idELN, {...termQuantity, label: 'Lab IDs'})\nregisterFilter('results.eln.names', idELN, noAggQuantity)\nregisterFilter('results.eln.descriptions', idELN, noAggQuantity)\nregisterFilter('external_db', idAuthor, {...termQuantity, label: 'External database', scale: 'log'})\nregisterFilter('authors.name', idAuthor, {...termQuantityNonExclusive, label: 'Author name'})\nregisterFilter('upload_create_time', idAuthor, {...numberHistogramQuantity, scale: 'log'})\nregisterFilter('entry_create_time', idAuthor, {...numberHistogramQuantity, scale: 'log'})\nregisterFilter('datasets.dataset_name', idAuthor, {...termQuantityLarge, label: 'Dataset name'})\nregisterFilter('datasets.doi', idAuthor, {...termQuantity, label: 'Dataset DOI'})\nregisterFilter('datasets.dataset_id', idAuthor, termQuantity)\nregisterFilter('domain', idMetadata, termQuantity)\nregisterFilter('entry_id', idMetadata, termQuantity)\nregisterFilter('entry_name', idMetadata, termQuantity)\nregisterFilter('mainfile', idMetadata, termQuantity)\nregisterFilter('upload_id', idMetadata, termQuantity)\nregisterFilter('upload_name', idMetadata, termQuantity)\nregisterFilter('published', idMetadata, termQuantity)\nregisterFilter('main_author.user_id', idMetadata, termQuantity)\nregisterFilter('quantities', idMetadata, {...noAggQuantity, label: 'Metainfo definition', queryMode: 'all'})\nregisterFilter('sections', idMetadata, {...noAggQuantity, label: 'Metainfo sections', queryMode: 'all'})\nregisterFilter('section_defs.definition_qualified_name', idMetadata, {...noAggQuantity, label: 'Section defs qualified name', queryMode: 'all'})\nregisterFilter('entry_references.target_entry_id', idMetadata, {...noAggQuantity, label: 'Entry references target entry id', queryMode: 'all'})\nregisterFilter('entry_type', idMetadata, {...noAggQuantity, label: 'Entry type', queryMode: 'all'})\nregisterFilter('entry_name.prefix', idMetadata, {...noAggQuantity, label: 'Entry name', queryMode: 'all'})\nregisterFilter('results.material.material_id', idMetadata, termQuantity)\nregisterFilter('optimade_filter', idOptimade, {multiple: true, queryMode: 'all'})\nregisterFilter('processed', idMetadata, {label: 'Processed', queryMode: 'all'})\nregisterFilter('text_search_contents', idMetadata, {multiple: true, queryMode: 'all'})\nregisterFilter('custom_quantities', idCustomQuantities, {\n  serializerExact: value => {\n    const jsonStr = JSON.stringify(value)\n    const result = encodeURIComponent(jsonStr)\n    return result\n  },\n  serializerPretty: value => {\n    if (!value) {\n      return null\n    }\n    return `${value.and.length} condition${value.and.length > 0 ? 's' : ''}`\n  },\n  deserializer: value => {\n    const jsonStr = decodeURIComponent(value)\n    const result = JSON.parse(jsonStr)\n    return result\n  },\n  multiple: false,\n  value: {\n    set: () => {\n      // TODO: We ignore the query here, it is later added to the final API query.\n      // We had to do this hack, because there is not way to add a logical query\n      // behind a prefix.\n    }\n  }\n})\nregisterFilter(\n  'results.properties.spectroscopic.spectra.provenance.eels',\n  idSpectroscopic,\n  {...nestedQuantity, label: 'Electron energy loss spectrum (EELS)'},\n  [\n    {name: 'detector_type', ...termQuantity},\n    {name: 'resolution', ...numberHistogramQuantity},\n    {name: 'min_energy', ...numberHistogramQuantity},\n    {name: 'max_energy', ...numberHistogramQuantity}\n  ]\n)\nregisterFilter(\n  'results.properties.electronic.band_structure_electronic',\n  idElectronic,\n  {...nestedQuantity, label: 'Band structure'},\n  [\n    {name: 'spin_polarized', label: 'Spin-polarized', ...termQuantityBool}\n  ]\n)\nregisterFilter(\n  'results.properties.electronic.dos_electronic',\n  idElectronic,\n  {...nestedQuantity, label: 'Density of states'},\n  [\n    {name: 'spin_polarized', label: 'Spin-polarized', ...termQuantityBool}\n  ]\n)\nregisterFilter(\n  'results.properties.electronic.band_structure_electronic.band_gap',\n  idElectronic,\n  nestedQuantity,\n  [\n    {name: 'type', ...termQuantity},\n    {name: 'value', ...numberHistogramQuantity, scale: 'log'}\n  ]\n)\nregisterFilter(\n  'results.properties.electronic.band_gap',\n  idElectronic,\n  nestedQuantity,\n  [\n    {name: 'type', ...termQuantity},\n    {name: 'value', ...numberHistogramQuantity, scale: 'log'}\n  ]\n)\nregisterFilter('results.properties.electronic.band_gap.provenance.label', idElectronic, termQuantity)\nregisterFilter(\n  'results.properties.optoelectronic.solar_cell',\n  idSolarCell,\n  nestedQuantity,\n  [\n    {name: 'efficiency', ...numberHistogramQuantity, scale: 'log'},\n    {name: 'fill_factor', ...numberHistogramQuantity, scale: 'log'},\n    {name: 'open_circuit_voltage', ...numberHistogramQuantity, scale: 'log'},\n    {name: 'short_circuit_current_density', ...numberHistogramQuantity, scale: 'log'},\n    {name: 'illumination_intensity', ...numberHistogramQuantity, scale: 'log'},\n    {name: 'device_area', ...numberHistogramQuantity, scale: 'log'},\n    {name: 'device_architecture', ...termQuantity},\n    {name: 'absorber_fabrication', ...termQuantity},\n    {name: 'device_stack', ...termQuantityAllNonExclusive},\n    {name: 'absorber', ...termQuantityAllNonExclusive},\n    {name: 'electron_transport_layer', ...termQuantityAllNonExclusive},\n    {name: 'hole_transport_layer', ...termQuantityAllNonExclusive},\n    {name: 'substrate', ...termQuantityAllNonExclusive},\n    {name: 'back_contact', ...termQuantityAllNonExclusive}\n  ]\n)\nregisterFilter(\n  'results.properties.catalytic.catalyst',\n  idCatalyst,\n  nestedQuantity,\n  [\n    {name: 'characterization_methods', ...termQuantity},\n    {name: 'surface_area', ...numberHistogramQuantity, scale: 'log'},\n    {name: 'catalyst_name', ...termQuantity},\n    {name: 'catalyst_type', ...termQuantity},\n    {name: 'preparation_method', ...termQuantity}\n  ]\n)\nregisterFilter(\n  'results.properties.catalytic.reaction',\n  idCatalyst,\n  nestedQuantity,\n  [\n    {name: 'name', ...termQuantity},\n    {name: 'type', ...termQuantity}\n  ]\n)\nregisterFilter(\n  'results.properties.catalytic.reaction.reaction_conditions',\n  idCatalyst,\n  nestedQuantity,\n  [\n    {name: 'temperature', ...numberHistogramQuantity, scale: 'log'},\n    {name: 'pressure', ...numberHistogramQuantity, scale: 'linear'},\n    {name: 'weight_hourly_space_velocity', ...numberHistogramQuantity, scale: 'log'}\n  ]\n)\nregisterFilter(\n  'results.properties.catalytic.reaction.products',\n  idCatalyst,\n  nestedQuantity,\n  [\n    {name: 'name', ...termQuantityAllNonExclusive},\n    {name: 'gas_concentration_out', ...numberHistogramQuantity, scale: 'linear'},\n    {name: 'selectivity', ...numberHistogramQuantity, scale: 'log'}\n  ]\n)\nregisterFilter(\n  'results.properties.catalytic.reaction.reactants',\n  idCatalyst,\n  nestedQuantity,\n  [\n    {name: 'name', ...termQuantityAllNonExclusive},\n    {name: 'gas_concentration_in', ...numberHistogramQuantity, scale: 'linear'},\n    {name: 'gas_concentration_out', ...numberHistogramQuantity, scale: 'linear'},\n    {name: 'conversion', ...numberHistogramQuantity, scale: 'linear'}\n  ]\n)\nregisterFilter(\n  'results.properties.catalytic.reaction.rates',\n  idCatalyst,\n  nestedQuantity,\n  [\n    {name: 'reaction_rate', ...numberHistogramQuantity, scale: 'linear'}\n  ]\n)\nregisterFilter(\n  'results.properties.mechanical.bulk_modulus',\n  idMechanical,\n  nestedQuantity,\n  [\n    {name: 'type', ...termQuantity},\n    {name: 'value', ...numberHistogramQuantity}\n  ]\n)\nregisterFilter(\n  'results.properties.mechanical.shear_modulus',\n  idMechanical,\n  nestedQuantity,\n  [\n    {name: 'type', ...termQuantity},\n    {name: 'value', ...numberHistogramQuantity}\n  ]\n)\nregisterFilter(\n  'results.properties.available_properties',\n  idProperties,\n  termQuantityAll\n)\nregisterFilter(\n  'results.properties.mechanical.energy_volume_curve',\n  idMechanical,\n  nestedQuantity,\n  [\n    {name: 'type', ...termQuantity}\n  ]\n)\nregisterFilter(\n  'results.properties.geometry_optimization',\n  idGeometryOptimization,\n  nestedQuantity,\n  [\n    {name: 'final_energy_difference', ...numberHistogramQuantity, scale: 'log'},\n    {name: 'final_displacement_maximum', ...numberHistogramQuantity, scale: 'log'},\n    {name: 'final_force_maximum', ...numberHistogramQuantity, scale: 'log'}\n  ]\n)\nregisterFilter(\n  'results.properties.thermodynamic.trajectory',\n  idMolecularDynamics,\n  nestedQuantity,\n  [\n    {name: 'available_properties', ...termQuantityAll},\n    {name: 'provenance.molecular_dynamics.ensemble_type', ...termQuantity},\n    {name: 'provenance.molecular_dynamics.time_step', ...numberHistogramQuantity}\n  ]\n)\n\n// Visibility: controls the 'owner'-parameter in the API query, not part of the\n// query itself.\nregisterFilter(\n  'visibility',\n  idMetadata,\n  {\n    ...noQueryQuantity,\n    default: 'visible',\n    description: 'The visibility of the entry.'\n  }\n)\n\n// Combine: controls whether materials search combines data from several\n// entries.\nregisterFilter(\n  'combine',\n  undefined,\n  {\n    ...noQueryQuantity,\n    default: true,\n    description: 'If selected, your filters may be matched from several entries that contain the same material. When unchecked, the material has to have a single entry that matches all your filters.'\n  }\n)\n\n// Exclusive: controls the way elements search is done.\nregisterFilter(\n  'exclusive',\n  undefined,\n  {\n    ...noQueryQuantity,\n    default: false,\n    description: \"Search for entries with compositions that only (exclusively) contain the selected atoms. The default is to return all entries that have at least (inclusively) the selected atoms.\"\n  }\n)\n\n// In exclusive element query the elements names are sorted and concatenated\n// into a single string.\nregisterFilter(\n  'results.material.elements',\n  idElements,\n  {\n    widget: {\n      quantity: 'results.material.elements',\n      type: 'periodictable',\n      scale: 'log',\n      layout: {\n        sm: {w: 12, h: 8, minW: 12, minH: 8},\n        md: {w: 12, h: 8, minW: 12, minH: 8},\n        lg: {w: 12, h: 8, minW: 12, minH: 8},\n        xl: {w: 12, h: 8, minW: 12, minH: 8},\n        xxl: {w: 12, h: 8, minW: 12, minH: 8}\n      }\n    },\n    aggs: {terms: {size: elementData.elements.length}},\n    value: {\n      set: (newQuery, oldQuery, value) => {\n        if (oldQuery.exclusive) {\n          if (value.size !== 0) {\n            newQuery['results.material.elements_exclusive'] = setToArray(value).sort().join(' ')\n          }\n        } else {\n          newQuery['results.material.elements'] = value\n        }\n      }\n    },\n    multiple: true,\n    exclusive: false,\n    queryMode: 'all'\n  }\n)\n\n// Electronic properties: subset of results.properties.available_properties\nregisterFilterOptions(\n  'electronic_properties',\n  idElectronic,\n  'results.properties.available_properties',\n  'Electronic properties',\n  'The electronic properties that are present in an entry.',\n  {\n    'electronic.band_structure_electronic.band_gap': {label: 'Band gap'},\n    band_structure_electronic: {label: 'Band structure'},\n    dos_electronic: {label: 'Density of states'},\n    greens_functions_electronic: {label: 'Green\\u0027s functions'},\n    eels: {label: 'Electron energy loss spectrum'}\n  }\n)\n\n// Vibrational properties: subset of results.properties.available_properties\nregisterFilterOptions(\n  'vibrational_properties',\n  idVibrational,\n  'results.properties.available_properties',\n  'Vibrational properties',\n  'The vibrational properties that are present in an entry.',\n  {\n    dos_phonon: {label: 'Phonon density of states'},\n    band_structure_phonon: {label: 'Phonon band structure'},\n    energy_free_helmholtz: {label: 'Helmholtz free energy'},\n    heat_capacity_constant_volume: {label: 'Heat capacity constant volume'}\n  }\n)\n\n// Mechanical properties: subset of results.properties.available_properties\nregisterFilterOptions(\n  'mechanical_properties',\n  idMechanical,\n  'results.properties.available_properties',\n  'Mechanical properties',\n  'The mechanical properties that are present in an entry.',\n  {\n    bulk_modulus: {label: 'Bulk modulus'},\n    shear_modulus: {label: 'Shear modulus'},\n    energy_volume_curve: {label: 'Energy-volume curve'}\n  }\n)\n\n// Spectroscopic properties: subset of results.properties.available_properties\nregisterFilterOptions(\n  'spectroscopic_properties',\n  idSpectroscopic,\n  'results.properties.available_properties',\n  'Spectroscopic properties',\n  'The spectroscopic properties that are present in an entry.',\n  {\n    eels: {label: 'Electron energy loss spectrum'}\n  }\n)\n\n// Thermodynamical properties: subset of results.properties.available_properties\nregisterFilterOptions(\n  'thermodynamic_properties',\n  idMolecularDynamics,\n  'results.properties.available_properties',\n  'Thermodynamic properties',\n  'The thermodynamic properties that are present.',\n  {\n    trajectory: {label: 'Trajectory'}\n  }\n)\n\n/**\n * Creates static suggestion for all metainfo quantities that have an enum\n * value. Also provides suggestions for quantity names.\n */\nexport const quantityNameSearch = 'quantity name'\nexport function getStaticSuggestions(quantities, filterData) {\n  const suggestions = {}\n  const filters = quantities\n    ? [...quantities]\n    : Object.keys(filterData)\n\n  // Add suggestions from metainfo\n  for (const quantity of filters) {\n    const data = searchQuantities[quantity]\n    const isEnum = data?.type?.type_kind?.toLowerCase() === 'enum'\n    if (isEnum) {\n      const options = data.type.type_data\n      const maxLength = Math.max(...options.map(option => option.length))\n      const minLength = maxLength <= 2 ? 1 : 2\n      suggestions[quantity] = getSuggestions(\n        options,\n        minLength\n      )\n    }\n  }\n\n  // Add suggestions for quantity names\n  if (quantities.has(quantityNameSearch)) {\n    suggestions[quantityNameSearch] = getSuggestions(\n      filters.filter(value => value !== quantityNameSearch && !filterData[value].section),\n      2\n    )\n  }\n  return suggestions\n}\n\n/**\n * HOC that is used to preload search filters from all required schemas. This\n * simplifies the rendering logic by first loading all schemas before rendering\n * any components that rely on them.\n */\nexport const withFilters = (WrappedComponent) => {\n  const WithFilters = ({initialFilters, ...rest}) => {\n    // Here we load the python schemas, and determine which YAML/Nexus schemas\n    // to load later.\n    const [yamlOptions, nexusOptions, initialFilterData, initialFilterGroups] = useMemo(() => {\n      const options = getOptions(initialFilters)\n      const yamlOptions = options.filter((name) => name.includes(`#${yamlSchemaPrefix}`))\n      const nexusOptions = options.filter((name) => name.startsWith('nexus.'))\n\n      // Perform glob filtering on default filters. Only exclude affects the\n      // default filters.\n      const defaultFilters = {}\n      for (const [key, value] of Object.entries(defaultFilterData)) {\n        if (glob(key, [key], initialFilters?.exclude)) {\n          defaultFilters[key] = value\n          if (value.group) {\n            addToGroup(defaultFilterGroups, value.group, key)\n          }\n        }\n      }\n\n      // Load the python filters from plugins\n      const pythonFilterData = {}\n      const mergedFilterGroups = {...defaultFilterGroups}\n      for (const [name, def] of Object.entries(searchQuantities)) {\n        if (def.dynamic && glob(name, initialFilters?.include, initialFilters?.exclude)) {\n          const {path, schema} = parseQuantityName(name)\n          const params = {\n            name: path,\n            quantity: path,\n            schema,\n            aggregatable: def.aggregatable\n          }\n          pythonFilterData[name] = new Filter(def, params)\n          addToGroup(mergedFilterGroups, idCustomQuantities, name)\n        }\n      }\n\n      return [\n        yamlOptions,\n        nexusOptions,\n        {...defaultFilters, ...pythonFilterData},\n        mergedFilterGroups\n      ]\n    }, [initialFilters])\n\n    const metainfo = useGlobalMetainfo()\n    const [loadingYaml, setLoadingYaml] = useState(yamlOptions.length)\n    const [loadingNexus, setLoadingNexus] = useState(nexusOptions.length)\n    const [filters, setFilters] = useState(initialFilterData)\n    const [filterGroups, setFilterGroups] = useState({...initialFilterGroups})\n    const { raiseError } = useErrors()\n\n    // Nexus metainfo is loaded here once metainfo is ready\n    useEffect(() => {\n      if (!nexusOptions.length || !metainfo) return\n      const pkg = metainfo._packageDefs['nexus']\n      const sections = pkg.section_definitions\n      const nexusFilters = {}\n      const nexusFilterGroups = {}\n      for (const section of sections) {\n        const sectionPath = `nexus.${section.name}`\n\n        // The NeXus section is skipped (it contains duplicate information)\n        if (sectionPath === 'nexus.NeXus') continue\n\n        // Only applications definitions are loaded\n        if (section?.more?.nx_category !== 'application') continue\n\n        // Sections from which no quantities are included are skipped\n        if (!glob(sectionPath, initialFilters?.include, initialFilters?.exclude) && !initialFilters?.include.some(x => x.includes(sectionPath))) {\n          continue\n        }\n\n        // Add all included quantities recursively\n        for (const [def, path, repeats] of getQuantities(section)) {\n          const filterPath = `${sectionPath}.${path}`\n          const included = glob(filterPath, initialFilters?.include, initialFilters?.exclude)\n          if (!included) continue\n          const dtype = dtypeMap[getDatatype(def)]\n          // TODO: For some Nexus quantities, the data types cannot be fetched.\n          if (!dtype) {\n            continue\n          }\n          const params = {\n            name: filterPath,\n            quantity: filterPath,\n            aggregatable: new Set([DType.String, DType.Enum, DType.Boolean]).has(getDatatype(def)),\n            repeats: repeats\n          }\n          nexusFilters[filterPath] = new Filter(def, params)\n          addToGroup(nexusFilterGroups, idCustomQuantities, filterPath)\n        }\n      }\n      setFilters((old) => ({...old, ...nexusFilters}))\n      setFilterGroups((old) => {\n        const newGroups = {...old}\n        for (const [groupName, names] of Object.entries(nexusFilterGroups)) {\n          for (const quantityName of [...names]) {\n            addToGroup(newGroups, groupName, quantityName)\n          }\n        }\n        return newGroups\n      })\n      setLoadingNexus(false)\n    }, [metainfo, nexusOptions, initialFilters])\n\n    // YAML schemas are loaded here asynchronously\n    useEffect(() => {\n      if (!yamlOptions.length || !metainfo) return\n      async function fetchSchemas(options) {\n        const yamlFilters = {}\n        const yamlFilterGroups = {}\n        for (const schemaPath of options) {\n          let schemaDefinition\n          try {\n            schemaDefinition = await metainfo.resolveDefinition(schemaPath)\n          } catch (e) {\n            raiseError(`\n              Unable to load the schema ${schemaPath} that is used in this app.\n              If the schema has not been published, please make sure that you\n              are logged in and have the correct access rights.\n            `)\n            throw e\n          }\n          for (const [def, path] of getQuantities(schemaDefinition)) {\n            const dtype = dtypeMap[getDatatype(def)]\n            if (!dtype) {\n              throw Error(`Unable to load the data type for ${path}.`)\n            }\n            const filterPath = `data.${path}${schemaSeparator}${schemaPath}`\n            const included = glob(filterPath, initialFilters?.include, initialFilters?.exclude)\n            if (!included) continue\n            const apiPath = `${filterPath}${dtypeSeparator}${dtype}`\n            const {path: quantity, schema} = parseQuantityName(filterPath)\n            yamlFilters[filterPath] = new Filter(def, {name: path, schema, quantity, requestQuantity: apiPath})\n            addToGroup(yamlFilterGroups, idCustomQuantities, filterPath)\n          }\n        }\n        setFilters((old) => ({...old, ...yamlFilters}))\n        setFilterGroups((old) => {\n          const newGroups = {...old}\n          for (const [groupName, names] of Object.entries(yamlFilterGroups)) {\n            for (const quantityName of [...names]) {\n              addToGroup(newGroups, groupName, quantityName)\n            }\n          }\n          return newGroups\n        })\n        setLoadingYaml(false)\n      }\n\n      // Get a list of all distinct YAML schemas. These are loaded one by one\n      // and the required filters are registered from each.\n      const yamlSchemas = new Set(yamlOptions.map(x => x.split('#').pop()))\n      fetchSchemas(yamlSchemas)\n    }, [yamlOptions, metainfo, raiseError, initialFilters])\n\n    return (loadingYaml || loadingNexus)\n      ? <Box margin={1}>\n          <Typography>Loading the required schemas...</Typography>\n        </Box>\n      : <WrappedComponent {...rest} initialFilterData={filters} initialFilterGroups={filterGroups}/>\n  }\n\n  WithFilters.displayName = `withFilter(${WrappedComponent.displayName || WrappedComponent.name})`\n  WithFilters.propTypes = {\n    initialFilters: PropTypes.object // Determines which filters are available\n  }\n\n  return WithFilters\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { useCallback, useEffect, useState, useRef, useMemo } from 'react'\nimport { debounce, isEmpty } from 'lodash'\nimport { useApi } from './components/api'\nimport { getStaticSuggestions } from './components/search/FilterRegistry'\n\n/**\n * Function for returning the current window size.\n *\n * @return {string} The number in approximated format.\n */\nfunction getWindowSize() {\n  return {windowWidth: window.innerWidth, windowHeight: window.innerHeight}\n}\n\n/**\n * Hook for returning the current window size.\n *\n * @return {string} The number in approximated format.\n */\nexport function useWindowSize() {\n  const [size, setSize] = useState(getWindowSize())\n\n  useEffect(() => {\n    function handleResize() {\n      setSize(getWindowSize())\n    }\n\n    window.addEventListener('resize', handleResize)\n    return () => window.removeEventListener('resize', handleResize)\n  }, [])\n\n  return size\n}\n\n/**\n * Convenience hook for a simple boolean state.\n *\n * @param {bool} initialvalue The initial boolean value.\n * @return {array} Array containing current value and functions for setting to\n * true or false.\n */\nexport function useBoolState(initialValue) {\n  const [value, setValue] = useState(initialValue)\n  const setTrue = useCallback(() => setValue(true), [])\n  const setFalse = useCallback(() => setValue(false), [])\n\n  return [value, setTrue, setFalse]\n}\n\n/**\n * Hook for fetching suggestions for metainfo quantities. Uses a mixture of\n * metainfo Enumeration values and dynamic suggestions fetched through the API.\n * The fetching is debounced and retrieval of only the latest results is\n * ensured. Notice that not all quantities support suggestions.\n *\n * @param {array} quantitiesSuggest List of quantity definitions for which\n  * suggestions are fetched for. Notice that the suggestions are returned in this\n  * order.\n * @param {set} quantitiesAll Set of all quantity names. Used to return\n *   suggestions for quantity names.\n * @param {str} input Text input used for the suggestions. Must be non-empty in\n * order to fetch any suggestions.\n * @param {object} filterData Contains the available filters\n * @param {number} minLength Minimum input length before any dynamic\n *   suggestions are fetched through the API.\n * @param {number} suggestionsStatic An object containing any fixed suggestion\n *   values that should be added. Names that match a metainfo quantity will\n *   override any dynamical values.\n * @param {number} debounceTime The debounce time for restricting the number of\n * API calls.\n * @return {object} Array of suggestions containing the suggested value and the\n * quantity name.\n */\nexport function useSuggestions(quantitiesSuggest, quantitiesAll, input, filterData, minLength = 2, debounceTime = 150) {\n  const {api} = useApi()\n  const [loading, setLoading] = useState(false)\n  const [suggestions, setSuggestions] = useState([])\n  const currentRequest = useRef()\n  const staticSuggestions = useMemo(() => getStaticSuggestions(quantitiesAll, filterData), [quantitiesAll, filterData])\n\n  // Used to retrieve suggestions for this field.\n  const fetchSuggestions = useCallback((quantities, input) => {\n    setLoading(true)\n\n    // Used to flatten suggestions into a list that is correctly ordered.\n    function flatten(value) {\n      let suggestionsList = []\n      quantities.forEach(q => {\n        const options = value[q.name]\n        if (!isEmpty(options)) {\n          suggestionsList = suggestionsList.concat(options)\n        }\n      })\n      return suggestionsList\n    }\n\n    // Split the requested quantities into static and dynamic\n    const quantitiesFixed = []\n    const quantitiesDynamic = []\n    for (const quantity of quantities) {\n      if (quantity.name in staticSuggestions) {\n        quantitiesFixed.push(quantity)\n      } else if (filterData[quantity.name].suggestion) {\n        quantitiesDynamic.push(quantity)\n      }\n    }\n\n    // Gather the fixed suggestions first. The fixed suggestion size is\n    // currently not limited.\n    const suggestionsTemp = {}\n    for (const quantity of quantitiesFixed) {\n      const fixed = staticSuggestions[quantity.name]\n      suggestionsTemp[quantity.name] = fixed.filter(input).map((value) => ({value, category: quantity.name}))\n    }\n\n    // Start loading the dynamic suggestions\n    if (input.length >= minLength && quantitiesDynamic.length > 0) {\n      const promise = api.suggestions(quantitiesDynamic, input)\n      currentRequest.current = promise\n      promise\n        .then(data => {\n          if (currentRequest.current === promise) {\n            for (const quantity of quantitiesDynamic) {\n              const esSuggestions = data[quantity.name]\n              if (esSuggestions) {\n                suggestionsTemp[quantity.name] = esSuggestions.map(suggestion => ({\n                  category: quantity.name,\n                  value: suggestion.value\n                }))\n              }\n            }\n            setSuggestions(flatten(suggestionsTemp))\n          }\n        })\n        .catch((error) => {\n          console.log(error)\n        })\n        .finally(() => {\n          if (currentRequest.current === promise) {\n            setLoading(false)\n          }\n        })\n    } else {\n      setSuggestions(flatten(suggestionsTemp))\n      setLoading(false)\n    }\n  }, [api, minLength, staticSuggestions, filterData])\n\n  // Debounced version. Notice that we specify a maxWait option in order to keep\n  // on suggesting while the user is typing.\n  const fetchSuggestionsDebounced = useMemo(() => (\n    debounce(fetchSuggestions, debounceTime, {maxWait: 300})\n  ), [fetchSuggestions, debounceTime])\n\n  // Whenever input or the targeted quantities change, fetch suggestions\n  useEffect(() => {\n    const trimmedInput = input?.trim()\n    if (trimmedInput && trimmedInput.length > 0) {\n      fetchSuggestionsDebounced(quantitiesSuggest, input)\n    } else {\n      setSuggestions(old => old.length > 0 ? [] : old)\n    }\n  }, [fetchSuggestionsDebounced, quantitiesSuggest, input])\n\n  const results = useMemo(() => [suggestions, loading], [suggestions, loading])\n  return results\n}\n\n/**\n * Custom hook that returns a function that can be used to propertly catch\n * errors within React ErrorBoundaries raised by asynchronous calls.\n */\nexport const useAsyncError = () => {\n  const setError = useState()[1]\n  return useCallback(\n    e => {\n      setError(() => {\n        throw e\n      })\n    },\n    [setError]\n  )\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { makeStyles } from '@material-ui/core/styles'\nimport {\n  Tooltip,\n  IconButton,\n  MenuItem,\n  Select,\n  Checkbox,\n  FormControlLabel\n} from '@material-ui/core'\nimport clsx from 'clsx'\nimport { isArray } from 'lodash'\nimport { useBoolState } from '../hooks'\n\nconst useActionsStyles = makeStyles((theme) => ({\n  root: {\n    display: 'flex',\n    width: '100%',\n    boxSizing: 'border-box',\n    alignItems: 'center'\n  }\n}))\nexport const Actions = React.memo(({\n  justifyContent,\n  className,\n  classes,\n  children\n}) => {\n  const useDynamicStyles = makeStyles((theme) => ({\n    root: {\n      justifyContent: justifyContent\n    }\n  }))\n  const styles = useActionsStyles({classes: classes})\n  const dynamicStyles = useDynamicStyles()\n\n  return <div className={clsx(className, styles.root, dynamicStyles.root)}>\n    {children}\n  </div>\n})\n\nActions.propTypes = {\n  justifyContent: PropTypes.string, // The flexbox justification of buttons\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  children: PropTypes.node\n}\n\nActions.defaultProps = {\n  justifyContent: 'flex-end'\n}\n\nconst useActionHeaderStyles = makeStyles((theme) => ({\n  root: {\n    flexGrow: 1,\n    height: '100%',\n    display: 'flex',\n    alignItems: 'center',\n    minWidth: 0,\n    marginRight: theme.spacing(0.5)\n  },\n  spacer: {\n    flexGrow: 1,\n    minWidth: 0\n  }\n}))\nexport const ActionHeader = React.memo(({\n  disableSpacer,\n  className,\n  classes,\n  children\n}) => {\n  const styles = useActionHeaderStyles({classes: classes})\n  return <div className={clsx(className, styles.root)}>\n    {children}\n    {!disableSpacer && <div className={styles.spacer}></div>}\n  </div>\n})\n\nActionHeader.propTypes = {\n  disableSpacer: PropTypes.bool, // Used to disable flexbox spacer\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  children: PropTypes.node\n}\n\nconst useActionStyles = makeStyles((theme) => ({\n  root: {\n    marginRight: theme.spacing(1),\n    '&:last-child': {\n      marginRight: 0\n    }\n  }\n}))\nexport const Action = React.memo(({\n  color,\n  size,\n  href,\n  disabled,\n  onClick,\n  onMouseDown,\n  onMouseUp,\n  tooltip,\n  TooltipProps,\n  className,\n  classes,\n  children,\n  ButtonComponent,\n  ButtonProps,\n  'data-testid': testID\n}) => {\n  const styles = useActionStyles({classes: classes})\n\n  return <Tooltip title={tooltip} {...TooltipProps}>\n    <span className={clsx(className, styles.root)}>\n      <ButtonComponent\n        {...ButtonProps}\n        color={color}\n        size={size}\n        onClick={onClick}\n        onMouseDown={onMouseDown}\n        onMouseUp={onMouseUp}\n        disabled={disabled}\n        href={href}\n        aria-label={tooltip}\n        data-testid={testID}\n      >\n        {children}\n      </ButtonComponent>\n    </span>\n  </Tooltip>\n})\n\nAction.propTypes = {\n  variant: PropTypes.string, // The variant of the MUI buttons\n  color: PropTypes.string, // The color of the MUI buttons\n  size: PropTypes.string, // Size of the MUI buttons\n  href: PropTypes.string,\n  disabled: PropTypes.bool,\n  onClick: PropTypes.func,\n  onMouseDown: PropTypes.func,\n  onMouseUp: PropTypes.func,\n  tooltip: PropTypes.string,\n  TooltipProps: PropTypes.object,\n  ButtonComponent: PropTypes.elementType,\n  ButtonProps: PropTypes.object,\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  children: PropTypes.node,\n  'data-testid': PropTypes.string\n}\n\nAction.defaultProps = {\n  size: 'small',\n  ButtonComponent: IconButton\n}\n\n/**\n * Dropdown menu action.\n */\nexport const ActionSelect = React.memo(({value, options, tooltip, onChange}) => {\n  const [isStatsTooltipOpen, openStatsTooltip, closeStatsTooltip] = useBoolState(false)\n  const items = isArray(options)\n    ? Object.fromEntries(options.map(x => [x, x]))\n    : options\n  return <Action\n    TooltipProps={{\n      title: tooltip || \"\",\n      open: isStatsTooltipOpen,\n      disableHoverListener: true\n  }}>\n    <Select\n      value={value}\n      onMouseEnter={openStatsTooltip}\n      onMouseLeave={closeStatsTooltip}\n      onOpen={closeStatsTooltip}\n      onChange={(event) => onChange && onChange(event.target.value)}\n    >\n      {Object.entries(items).map(([key, value]) =>\n        <MenuItem key={key} value={key}>{value}</MenuItem>\n      )}\n    </Select>\n  </Action>\n})\n\nActionSelect.propTypes = {\n  value: PropTypes.string,\n  options: PropTypes.oneOfType([PropTypes.object, PropTypes.arrayOf(PropTypes.string)]),\n  tooltip: PropTypes.string,\n  onChange: PropTypes.func\n}\n\n/**\n * Checkbox action.\n */\nexport const ActionCheckbox = React.memo(({value, label, tooltip, onChange}) => {\n  const styles = useActionStyles()\n  return <Tooltip title={tooltip}>\n      <FormControlLabel\n        control={<Checkbox\n          checked={value}\n          onChange={(event, value) => onChange && onChange(value)}\n          size=\"small\"\n        />}\n        className={styles.root}\n        label={label}\n      />\n    </Tooltip>\n})\n\nActionCheckbox.propTypes = {\n  value: PropTypes.bool,\n  label: PropTypes.string,\n  tooltip: PropTypes.string,\n  onChange: PropTypes.func\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { cloneDeep } from 'lodash'\nimport AddCircleIcon from '@material-ui/icons/AddCircle'\nimport CancelIcon from '@material-ui/icons/Cancel'\nimport { useSearchContext } from '../SearchContext'\nimport { Action } from '../../Actions'\n\n/**\n * Toggle for hiding/showing a particular widget.\n */\nconst WidgetToggle = React.memo(({quantity, disabled, 'data-testid': testID}) => {\n  const { useWidgetValue, useAddWidget, useRemoveWidget, filterData } = useSearchContext()\n  const widget = useWidgetValue(quantity)\n  const addWidget = useAddWidget()\n  const removeWidget = useRemoveWidget()\n  const hasWidget = !!widget\n  const widgetDefault = filterData[quantity]?.widget\n\n  // If there is no default widget configured, then do not show the toggle.\n  if (!widgetDefault) return null\n\n  return <Action\n    tooltip={hasWidget\n      ? 'Remove widget from the dashboard.'\n      : 'Add a default widget for this quantity in the dashboard.'\n    }\n    disabled={disabled}\n    data-testid={testID}\n    onClick={() => {\n      const config = {\n        id: quantity,\n        editing: false,\n        visible: true,\n        ...cloneDeep(widgetDefault)\n      }\n      if (hasWidget) {\n        removeWidget(quantity)\n      } else {\n        addWidget(quantity, config)\n      }\n    }}\n  >\n    {hasWidget\n      ? <CancelIcon fontSize=\"small\"/>\n      : <AddCircleIcon fontSize=\"small\"/>}\n  </Action>\n})\n\nWidgetToggle.propTypes = {\n  quantity: PropTypes.string.isRequired,\n  disabled: PropTypes.bool,\n  'data-testid': PropTypes.string\n}\n\nexport default WidgetToggle\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { range, size } from 'lodash'\nimport { scalePow, scaleLog } from 'd3-scale'\nimport {\n  format,\n  getTime,\n  fromUnixTime,\n  millisecondsToSeconds,\n  eachMinuteOfInterval,\n  eachHourOfInterval,\n  eachDayOfInterval,\n  eachWeekOfInterval,\n  eachMonthOfInterval,\n  eachYearOfInterval,\n  differenceInYears,\n  differenceInMonths,\n  differenceInWeeks,\n  differenceInDays,\n  differenceInHours,\n  differenceInMinutes,\n  differenceInSeconds,\n  isWithinInterval,\n  eachQuarterOfInterval\n} from 'date-fns'\nimport { scale as chromaScale } from 'chroma-js'\nimport { scale as scaleUtils, add, DType, formatNumber } from '../../utils.js'\n\nexport const scales = {\n  'linear': 'linear',\n  'log': 'log',\n  '1/2': '1/2',\n  '1/4': '1/4',\n  '1/8': '1/8'\n}\n\nexport const scalesLimited = {\n  'linear': 'linear',\n  'log': 'log'\n}\n\n/**\n * Creates a scaling function based on the provided type.\n *\n * @param {string} type - The type of scaling function ('linear', '1/2', '1/4', '1/8', 'log').\n * @param {number[]} [domain=[0, 1]] - The input domain for the scale.\n * @param {number[]} [range=[0, 1]] - The output range for the scale.\n * @returns {function} - The scaling function with added properties and methods.\n * @throws {Error} - Throws an error if the scaling type is invalid.\n */\nexport function getScaler(type, domain = [0, 1], range = [0, 1]) {\n  let scaler\n\n  const powScales = {\n    'linear': 1,\n    '1/2': 0.5,\n    '1/4': 0.25,\n    '1/8': 0.125\n  }\n\n  const powscale = powScales[type]\n\n  if (powscale !== undefined) {\n    scaler = scalePow()\n      .exponent(powscale)\n      .domain(domain)\n      .range(range)\n  } else if (type === 'log') {\n    const adjustedDomain = [Math.max(domain[0], 1), domain[1]]\n    scaler = scaleLog()\n      .base(10)\n      .domain(adjustedDomain)\n      .range(range)\n  } else {\n    throw new Error('Invalid scaling type.')\n  }\n\n  // Invalid values are mapped to zero. Important especially for log scales.\n  const func = (value) => scaler(value) || 0\n\n  // Copy all properties and methods from scaler to func\n  Object.assign(func, scaler)\n\n  return func\n}\n\n/**\n * Returns interval that can be used to split the given range into\n * human-readable, uniformly spaced steps.\n *\n * @param {number} range The range to divide\n * @param {number} steps The targeted number of steps.\n * @param {string} dtype Data type.\n * @param {bool} cap controls whether the final number of intervals can be\n * bigger than the requested amount.\n *\n * @returns The interval as a number\n */\nexport function getInterval(value, steps, dtype, cap = true) {\n  const interval = value / steps\n  const degree = Math.pow(10, (Math.round(Math.log10(interval))))\n  const multipliers = [0.1, 0.2, 0.25, 0.5, 1, 2, 2.5, 5, 10]\n  const intervals = scaleUtils(multipliers, degree).filter(x => {\n    const capped = cap ? (x >= interval) : true\n    const valid = dtype === DType.Int ? x % 1 === 0 : true\n    return capped && valid\n  })\n  const differences = add(intervals, -interval).map(x => Math.abs(x))\n  const indexMin = differences.reduce(argMin, 0)\n  return intervals[indexMin]\n}\n\nexport const argMin = (iMin, x, i, arr) => {\n  return x < arr[iMin] ? i : iMin\n}\n\n/**\n * Returns human-readable, (mostly) uniformly spaced ticks for the given\n * interval. Takes the data type into account when determinining the ticks their\n * formatting. If not valid ticks can be generated, returns an empty list.\n *\n * @param {number} min The minimum value\n * @param {number} max The maximum value\n * @param {number} n Targeted number of ticks. Notice that this typically does\n * not correspond to the final number of ticks.\n * @param {string} dtype Data type for the values\n * @param {number} decimals Number of decimals to show\n * @param {bool} scientific Whether to use scientific notation\n *\n * @returns Array of tick objects containing value and tick.\n */\nexport function getTicks(min, max, n, scale = 'linear', dtype, mode = 'scientific', decimals = 3) {\n  if (dtype === DType.Timestamp) {\n    const start = fromUnixTime(millisecondsToSeconds(min))\n    const end = fromUnixTime(millisecondsToSeconds(max))\n    const interval = {start, end}\n\n    // Function for splitting ranges using milliseconds\n    const splitMilliseconds = (step) => ({start, end}) => {\n      const startRound = Math.ceil(getTime(start) / step)\n      const endRound = Math.floor(getTime(end) / step)\n      return range(startRound, endRound + 1).map(x => x * step)\n    }\n\n    // Config for the available intervals\n    const intervals = {\n      fiveyears: {\n        difference: (end, start) => differenceInYears(end, start) / 5,\n        split: (interval) => eachYearOfInterval(interval).filter(x => {\n          return !(x.getFullYear() % 5)\n        }),\n        format: 'yyyy'\n      },\n      twoyears: {\n        difference: (end, start) => differenceInYears(end, start) / 2,\n        split: (interval) => eachYearOfInterval(interval).filter(x => {\n          return !(x.getFullYear() % 2)\n        }),\n        format: 'yyyy'\n      },\n      years: {\n        difference: differenceInYears,\n        split: eachYearOfInterval,\n        format: 'yyyy'\n      },\n      threemonths: {\n        difference: (end, start) => differenceInMonths(end, start) / 3,\n        split: eachQuarterOfInterval,\n        format: 'MMM yyyy'\n      },\n      months: {\n        difference: differenceInMonths,\n        split: eachMonthOfInterval,\n        format: 'MMM'\n      },\n      weeks: {\n        difference: differenceInWeeks,\n        split: eachWeekOfInterval,\n        format: 'MMM d'\n      },\n      days: {\n        difference: differenceInDays,\n        split: eachDayOfInterval,\n        format: 'MMM d'\n      },\n      twelvehours: {\n        difference: (end, start) => differenceInHours(end, start) / 12,\n        split: (interval) => eachHourOfInterval(interval).filter(x => {\n          const values = new Set(['12:00', '24:00'])\n          return values.has(format(x, 'k:mm'))\n        }),\n        format: 'k:mm'\n      },\n      sixhours: {\n        difference: (end, start) => differenceInHours(end, start) / 6,\n        split: (interval) => eachHourOfInterval(interval).filter(x => {\n          const values = new Set(['6:00', '12:00', '18:00', '24:00'])\n          return values.has(format(x, 'k:mm'))\n        }),\n        format: 'k:mm'\n      },\n      hours: {\n        difference: differenceInHours,\n        split: eachHourOfInterval,\n        format: 'k:mm'\n      },\n      thirtyminutes: {\n        difference: (end, start) => differenceInMinutes(end, start) / 30,\n        split: (interval) => eachMinuteOfInterval(interval, {step: 30}),\n        format: 'k:mm'\n      },\n      fifteenminutes: {\n        difference: (end, start) => differenceInMinutes(end, start) / 15,\n        split: (interval) => eachMinuteOfInterval(interval, {step: 15}),\n        format: 'k:mm'\n      },\n      minutes: {\n        difference: differenceInMinutes,\n        split: eachMinuteOfInterval,\n        format: 'k:mm'\n      },\n      thirtyseconds: {\n        difference: (end, start) => differenceInSeconds(end, start) / 30,\n        split: splitMilliseconds(30000),\n        format: 'k:mm:ss'\n      },\n      fifteensecond: {\n        difference: (end, start) => differenceInSeconds(end, start) / 15,\n        split: splitMilliseconds(15000),\n        format: 'k:mm:ss'\n      },\n      seconds: {\n        difference: differenceInSeconds,\n        split: splitMilliseconds(1000),\n        format: 'k:mm:ss'\n      }\n    }\n\n    // Calculate the minimum number of ticks that each option may produce. The\n    // actual number of ticks cannot be easily calculated without actually\n    // producing the ticks, which is not viable when there may be a very large\n    // number of them (e.g. milliseconds in a year.)\n    const differences = {}\n    Object.entries(intervals)\n      .forEach(([dur, setup]) => { differences[dur] = setup.difference(end, start) })\n\n    // For each sensible option, calculate the actual ticks and their amount.\n    const differencesValid = Object.entries(differences)\n      .filter(([dur, diff]) => diff <= n) // Filter out values where the minimum number of ticks is beyond the target.\n      .map(([dur, diff]) => [dur, intervals[dur].split(interval).filter(x => isWithinInterval(x, interval))]) // Calculate the actual ticks\n      .filter(([dur, ticks]) => ticks.length <= n) // Filter out options with more ticks than requested\n      .map(([dur, ticks]) => [dur, Math.abs(ticks.length - n), ticks]) // Calculate abs difference to n\n\n    // If no valid ticks can be determined, return an empty list.\n    if (!differencesValid.length) {\n      return []\n    }\n\n    // Determine the option that has the closest amount of ticks to the targeted\n    // amount.\n    const closestDuration = differencesValid\n      .reduce((prev, curr) => prev[1] < curr[1] ? prev : curr)\n    const ticks = closestDuration[2]\n    const setup = intervals[closestDuration[0]]\n\n    // Format the results and return both the formatted tick and the final\n    // value.\n    return ticks.map(x => ({value: getTime(x), tick: format(x, setup.format)}))\n  } else {\n    // Log scale ticks are divided into evenly spaced intervals in the log scale\n    if (scale === 'log') {\n      const tickRange = max - min\n      const degree = Math.floor(Math.log10(tickRange))\n      const reduction = Math.ceil(degree / n)\n      const degrees = range(1, degree + 1, degree > n ? reduction : 1)\n      return degrees.map(x => {\n        const value = Math.pow(10, x)\n        return {value, tick: formatNumber(value, dtype, mode, decimals)}\n      })\n    // Calculate reasonable ticks for other scales\n    } else {\n      const tickRange = max - min\n      const multipliers = [0.1, 0.2, 0.25, 0.5, 1, 2, 2.5, 5, 10]\n      const degree = Math.pow(10, (Math.round(Math.log10(tickRange))))\n      const closestDuration = scaleUtils(multipliers, degree)\n        .filter(x => dtype === DType.Int ? x % 1 === 0 : true) // Filter out invalid intervals\n        .map(x => [x, Math.floor(tickRange / x)]) // Calculate minimum number of ticks\n        .filter(([interval, nMin]) => nMin <= n) // Filter out values where the minimum number of ticks is beyond the target.\n        .map(([interval, nMin]) => { // Calculate actual ticks\n          const startRound = Math.ceil(min / interval)\n          const endRound = Math.floor(max / interval)\n          const ticks = range(startRound, endRound + 1).map(x => {\n            const value = (x * interval)\n            return {value, tick: formatNumber(value, dtype, mode, decimals)}\n          })\n          return ticks\n        })\n        .filter((ticks) => ticks.length <= n) // Filter out options with more ticks than requested\n        .map((ticks) => [ticks, Math.abs(ticks.length - n)]) // Calculate abs difference to n\n        .reduce((prev, curr) => prev[1] < curr[1] ? prev : curr) // Select best option\n      return closestDuration[0]\n    }\n  }\n}\n\n/**\n * Returns the default x-axis layout used in the plots.\n *\n * @param {object} theme The current app theme.\n * @returns An object containing a plotly configuration for an x-axis.\n */\nexport function getXAxisLayout(theme) {\n  return {\n    automargin: false,\n    autorange: true,\n    linecolor: '#333',\n    linewidth: 1,\n    mirror: true,\n    ticks: 'outside',\n    showline: true,\n    fixedrange: true,\n    title: {\n      standoff: 10,\n      font: {\n        family: theme.typography.fontFamily,\n        size: 16,\n        color: '#333'\n      },\n      tickfont: {\n        family: theme.typography.fontFamily,\n        size: 14,\n        color: '#333'\n      }\n    }\n  }\n}\n\n/**\n * Returns the default y-axis layout used in the plots.\n *\n * @param {object} theme The current app theme.\n * @returns An object containing a plotly configuration for a y-axis.\n */\nexport function getYAxisLayout(theme) {\n  return {\n    automargin: true,\n    autorange: true,\n    linecolor: '#333',\n    linewidth: 1,\n    mirror: true,\n    ticks: 'outside',\n    showline: true,\n    title: {\n      standoff: 10,\n      font: {\n        family: theme.typography.fontFamily,\n        size: 16,\n        color: '#333'\n      }\n    },\n    tickfont: {\n      family: 'Titillium Web,sans-serif',\n      size: 14,\n      color: '#333'\n    }\n  }\n}\n\n/**\n * Returns a list of linestyles.\n *\n * @param {number} nLines number of lines to plot\n */\nexport function getLineStyles(nLines, theme, nKinds) {\n  const styles = []\n  const lineStyles = ['solid', 'dot', 'dashdot']\n  const [startColor, endColor] = theme ? [theme.palette.primary.dark, theme.palette.secondary.light] : ['#005271', '#f57c00']\n  const colors = chromaScale([startColor, endColor])\n    .mode('lch').colors(nLines === 1 ? 2 : nLines)\n  for (let i = 0; i < nLines; ++i) {\n    const line = {\n      dash: nKinds ? lineStyles[(i % nKinds) % lineStyles.length] : nLines <= 5 ? 'solid' : lineStyles[i % lineStyles.length],\n      color: colors[Math.floor(i / nKinds) % colors.length],\n      width: 2\n    }\n    styles.push(line)\n  }\n  return styles\n}\n\n/**\n * Returns a layout for a plot with several vertically stacked plots with a\n * shared x-axis.\n *\n * @param {number} nLines number of lines to plot\n */\nexport function getPlotLayoutVertical(plots, xtitle, theme) {\n  // Static layout configuration\n  const layout = {\n    showlegend: false,\n    grid: {\n      ygap: 0.15,\n      columns: 1,\n      pattern: 'independent',\n      roworder: 'top to bottom'\n    }\n  }\n\n  // Create configuration for each axis that has valid data.\n  let iAxis = 0\n  for (const plot of plots) {\n    if (plot.data !== false) {\n      ++iAxis\n      const n = iAxis === 1 ? '' : iAxis\n      layout[`yaxis${n}`] = { ...getYAxisLayout(theme), title: plot.ytitle }\n      layout[`xaxis${n}`] = {\n        ...getXAxisLayout(theme),\n        showticks: true,\n        showticklabels: false\n      }\n    }\n  }\n\n  // The last available plot gets the shared x-axis label\n  const n = iAxis === 1 ? '' : iAxis\n  layout[`xaxis${n}`] = {\n    ...getXAxisLayout(theme),\n    showticklabels: true,\n    title: xtitle\n  }\n\n  // Add subplot layout based on the found valid data\n  layout.grid.subplots = range(1, iAxis + 1).map(i => {\n    const n = i === 1 ? '' : i\n    return `x${n}y${n}`\n  })\n  layout.grid.rows = iAxis\n\n  return layout\n}\n\n/**\n * Returns traces for a plot with several vertically stacked plots with a shared\n * x-axis.\n *\n * @param {number} nLines number of lines to plot\n */\nexport function getPlotTracesVertical(plots, theme) {\n  const traces = []\n  let iAxis = 0\n  for (const plot of plots) {\n    if (plot.data) {\n      ++iAxis\n      const n = iAxis === 1 ? '' : iAxis\n      traces.push(\n        {\n          x: plot.data.x,\n          y: plot.data.y,\n          yaxis: `y${n}`,\n          xaxis: `x${n}`,\n          type: 'scatter',\n          mode: 'lines',\n          line: {\n            color: theme.palette.primary.main,\n            width: 2\n          }\n        }\n      )\n    }\n  }\n  return size(traces) ? traces : undefined\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useEffect, useState } from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport PropTypes from 'prop-types'\nimport {\n  Menu,\n  MenuItem,\n  FormControl,\n  Tooltip,\n  InputLabel,\n  Select,\n  Button\n} from '@material-ui/core'\nimport { atom, atomFamily, useRecoilState, useRecoilCallback, useRecoilValue } from 'recoil'\n\nconst presets = {\n  new: {\n    icon: 'filled',\n    iconSize: 'small',\n    menu: 'visible',\n    inputVariant: 'filled',\n    inputSize: 'small',\n    aggIndicator: 'on',\n    aggCollapse: 'off'\n  },\n  old: {\n    icon: 'plain',\n    iconSize: 'medium',\n    menu: 'hidden',\n    inputVariant: 'outlined',\n    inputSize: 'medium',\n    aggIndicator: 'off',\n    aggCollapse: 'off'\n  }\n}\n\n/**\n * Item in the GUI menu.\n */\nconst usePrototypeMenuItemStyles = makeStyles(theme => ({\n  root: {},\n  form: {\n    width: '100%'\n  }\n}))\nconst GUIMenuItem = React.memo(({title, tooltip, value, onChange, options}) => {\n  const styles = usePrototypeMenuItemStyles()\n  return <MenuItem className={styles.root}>\n    <FormControl className={styles.form}>\n      <Tooltip title={tooltip || ''}>\n        <InputLabel>{title}</InputLabel>\n      </Tooltip>\n      <Select value={value} onChange={(event) => onChange(event.target.value)}>\n        {options.map((option) => <MenuItem key={value} value={option}>{option}</MenuItem>)}\n      </Select>\n    </FormControl>\n  </MenuItem>\n})\nGUIMenuItem.propTypes = {\n  title: PropTypes.string,\n  tooltip: PropTypes.string,\n  value: PropTypes.string,\n  onChange: PropTypes.func,\n  options: PropTypes.array\n}\n\n/**\n * GUI menu that can be used to dynamically control the GUI layout the menu is\n * hidden by default but can be shown by pressing Alt+G.\n */\nconst useStyles = makeStyles(theme => ({\n  root: {\n    position: 'fixed',\n    bottom: theme.spacing(2),\n    right: theme.spacing(2),\n    zIndex: 2\n  },\n  menu: {\n    width: theme.spacing(25)\n  }\n}))\nconst GUIMenu = React.memo(() => {\n  const styles = useStyles()\n  const [visible, setVisible] = useState(false)\n  const [icon, setIcon] = useRecoilState(guiState('icon'))\n  const [iconSize, setIconSize] = useRecoilState(guiState('iconSize'))\n  const [menu, setMenu] = useRecoilState(guiState('menu'))\n  const [inputVariant, setInputVariant] = useRecoilState(guiState('inputVariant'))\n  const [inputSize, setInputSize] = useRecoilState(guiState('inputSize'))\n  const [aggIndicator, setAggIndicator] = useRecoilState(guiState('aggIndicator'))\n  const [aggCollapse, setAggCollapse] = useRecoilState(guiState('aggCollapse'))\n  const preset = useRecoilValue(presetState)\n  const [anchorEl, setAnchorEl] = React.useState(null)\n  const open = Boolean(anchorEl)\n  const handleClick = (event) => {\n    setAnchorEl(event.currentTarget)\n  }\n  const handleClose = () => {\n    setAnchorEl(null)\n  }\n\n  // When the menu is mounted, add a global key listener that can be used to\n  // toggle the menu.\n  useEffect(() => {\n    function handleHotkey(event) {\n      if (event.altKey && event.key === 'g') {\n        setAnchorEl(old => old === null ? old : null)\n        setVisible(old => !old)\n      }\n    }\n    window.addEventListener('keydown', handleHotkey)\n    return () => window.removeEventListener('keydown', handleHotkey)\n  }, [])\n\n  const updatePreset = useRecoilCallback(({set}) => (preset) => {\n    const presetMap = presets[preset]\n    for (const [key, value] of Object.entries(presetMap)) {\n      set(guiState(key), value)\n    }\n    set(presetState, preset)\n  }, [])\n\n  return <div className={styles.root} style={{display: visible ? 'block' : 'none'}}>\n    <Button variant=\"contained\" color=\"primary\" onClick={handleClick}>\n      GUI options\n    </Button>\n    <Menu\n      anchorEl={anchorEl}\n      open={open}\n      onClose={handleClose}\n    >\n      <div className={styles.menu}>\n        <GUIMenuItem\n          title=\"Preset\"\n          value={preset}\n          onChange={updatePreset}\n          tooltip=\"Switch to a specific preset style.\"\n          options={['new', 'old']}\n        />\n        <GUIMenuItem\n          title=\"Text input variant\"\n          value={inputVariant}\n          onChange={setInputVariant}\n          tooltip=\"The MUI variant for text input fields.\"\n          options={['outlined', 'filled', 'standard']}\n        />\n        <GUIMenuItem\n          title=\"Text input size\"\n          value={inputSize}\n          onChange={setInputSize}\n          tooltip=\"The MUI size for text input fields.\"\n          options={['small', 'medium']}\n        />\n        <GUIMenuItem\n          title=\"Input options loading indicator\"\n          value={aggIndicator}\n          onChange={setAggIndicator}\n          tooltip=\"Whether to show a loading indicator when input field options are populated for the first time.\"\n          options={['on', 'off']}\n        />\n        <GUIMenuItem\n          title=\"Input options collapse\"\n          value={aggCollapse}\n          onChange={setAggCollapse}\n          tooltip=\"Controls if there is a fixed space reserved for input field options, or whether the space is determined by the amount of items that are shown.\"\n          options={['on', 'off']}\n        />\n        <GUIMenuItem\n          title=\"Filter settings display\"\n          value={menu}\n          onChange={setMenu}\n          tooltip=\"Controls the display style for filter settings that include e.g. statistics scaling.\"\n          options={['hidden', 'visible']}\n        />\n        <GUIMenuItem\n          title=\"Statistics icon style\"\n          value={icon}\n          onChange={setIcon}\n          tooltip=\"Controls the style of the icon that is used to add/remove a filter from the statistics grid.\"\n          options={['filled', 'outlined', 'plain']}\n        />\n        <GUIMenuItem\n          title=\"Statistics icon size\"\n          value={iconSize}\n          onChange={setIconSize}\n          tooltip=\"Controls the size of the icon that is used to add/remove a filter from the statistics grid.\"\n          options={['small', 'medium']}\n        />\n      </div>\n    </Menu>\n  </div>\n})\nconst presetDefault = 'new'\nexport const presetState = atom({\n  key: 'preset',\n  default: presetDefault\n})\nexport const guiState = atomFamily({\n  key: 'guiState',\n  default: (name) => presets[presetDefault][name]\n})\n\nexport default GUIMenu\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useMemo, useCallback } from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport {\n  Radio,\n  FormControl,\n  FormLabel,\n  FormControlLabel,\n  RadioGroup,\n  Menu\n} from '@material-ui/core'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\nimport { useRecoilValue } from 'recoil'\nimport MoreVertIcon from '@material-ui/icons/MoreVert'\nimport FilterTitle from '../FilterTitle'\nimport { Actions, ActionHeader, Action, ActionSelect } from '../../Actions'\nimport WidgetToggle from '../widgets/WidgetToggle'\nimport { scales } from '../../plotting/common'\nimport { guiState } from '../../GUIMenu'\nimport { useBoolState } from '../../../hooks'\n\n/**\n * The quantity label and actions shown by all filter components.\n */\nconst useStyles = makeStyles(theme => ({\n  root: {\n    marginBottom: theme.spacing(0.5),\n    height: '2.5rem',\n    width: '100%'\n  },\n  menuItem: {\n    width: '10rem',\n    margin: theme.spacing(2),\n    marginTop: theme.spacing(1),\n    marginBottom: theme.spacing(1)\n  },\n  row: {\n    display: 'flex',\n    height: '100%',\n    alignItems: 'center',\n    flexGrow: 1,\n    minWidth: 0\n  },\n  spacer: {\n    flexGrow: 1,\n    minWidth: 0\n  }\n}))\nconst InputHeader = React.memo(({\n  quantity,\n  label,\n  description,\n  disableWidget,\n  disableStatistics,\n  scale,\n  onChangeScale,\n  actions,\n  actionsAlign,\n  className,\n  classes\n}) => {\n  const styles = useStyles({classes: classes})\n  const [anchorEl, setAnchorEl] = React.useState(null)\n  const isSettingsOpen = Boolean(anchorEl)\n  const [isDragging, setDragging, setNotDragging] = useBoolState(false)\n  const [isTooltipOpen, openTooltip, closeTooltip] = useBoolState(false)\n  const menu = useRecoilValue(guiState('menu'))\n\n  const openMenu = useCallback((event) => {\n    setAnchorEl(event.currentTarget)\n  }, [])\n  const closeMenu = useCallback(() => {\n    setAnchorEl(null)\n  }, [])\n  const handleMouseDown = useCallback((event) => {\n    setDragging()\n    closeTooltip()\n  }, [closeTooltip, setDragging])\n  const handleMouseUp = useCallback(() => {\n    setNotDragging()\n  }, [setNotDragging])\n  const tooltipProps = useMemo(() => ({\n    open: isTooltipOpen,\n    onClose: closeTooltip,\n    onOpen: () => !isDragging && openTooltip()\n  }), [isTooltipOpen, closeTooltip, isDragging, openTooltip])\n\n  // Dedice the menu component. The tooltip of scale dropdown needs to be\n  // controlled, otherwise it won't close as we open the select menu.\n  const menuComp = menu === 'hidden'\n    ? <>\n      <Action\n        tooltip=\"Options\"\n        onClick={openMenu}\n      >\n        <MoreVertIcon/>\n      </Action>\n      <Menu\n        anchorEl={anchorEl}\n        open={isSettingsOpen}\n        onClose={closeMenu}\n        getContentAnchorEl={null}\n        anchorOrigin={{ vertical: 'bottom', horizontal: 'right' }}\n        transformOrigin={{ vertical: 'top', horizontal: 'right' }}\n        keepMounted\n      >\n        <FormControl\n          className={styles.menuItem}\n          component=\"fieldset\"\n        >\n          <FormLabel component=\"legend\">Statistics scaling</FormLabel>\n          <RadioGroup\n            value={scale}\n            onChange={onChangeScale ? (event, value) => onChangeScale(value) : undefined}\n          >\n            {Object.entries(scales).map(([key, value]) =>\n              <FormControlLabel key={key} value={key} label={value} control={<Radio/>} />\n            )}\n          </RadioGroup>\n        </FormControl>\n      </Menu>\n    </>\n    : <ActionSelect\n      value={scale}\n      options={scales}\n      tooltip=\"Statistics scaling\"\n      onChange={onChangeScale}\n    />\n\n  return <Actions className={clsx(styles.root, className)}>\n    <ActionHeader disableSpacer>\n      <div\n        className={clsx(styles.row)}\n        onMouseDown={handleMouseDown}\n        onMouseUp={handleMouseUp}\n      >\n        <FilterTitle\n          quantity={quantity}\n          label={label}\n          description={description}\n          TooltipProps={tooltipProps}\n        />\n        <div className={styles.spacer}/>\n      </div>\n    </ActionHeader>\n    {actionsAlign === 'left' && actions}\n    {!disableStatistics && menuComp}\n    {!disableWidget && <WidgetToggle quantity={quantity} disabled={disableWidget} />}\n    {actionsAlign === 'right' && actions}\n  </Actions>\n})\n\nInputHeader.propTypes = {\n  quantity: PropTypes.string.isRequired,\n  label: PropTypes.string,\n  description: PropTypes.string,\n  disableWidget: PropTypes.bool,\n  disableStatistics: PropTypes.bool,\n  scale: PropTypes.string,\n  onChangeScale: PropTypes.func,\n  variant: PropTypes.string,\n  actions: PropTypes.node,\n  actionsAlign: PropTypes.oneOf(['left', 'right']),\n  className: PropTypes.string,\n  classes: PropTypes.object\n}\n\nInputHeader.defaultProps = {\n  underscores: false,\n  disableWidget: false,\n  disableStatistics: false,\n  actionsAlign: 'left',\n  scale: 'linear'\n}\n\nexport default InputHeader\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport { Tooltip } from '@material-ui/core'\nimport PropTypes from 'prop-types'\n\n/**\n * The quantity label shown by all filter components.\n */\nconst InputTooltip = React.memo(({\n  unavailable,\n  ...rest\n}) => {\n  let title = rest?.title || ''\n  if (unavailable) title = 'No options available with current query.'\n\n  return <Tooltip\n    placement=\"bottom\"\n    {...rest}\n    title={title}\n  />\n})\n\nInputTooltip.propTypes = {\n  unavailable: PropTypes.bool,\n  children: PropTypes.node\n}\n\nexport default InputTooltip\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { createContext } from 'react'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\nimport InputHeader from './InputHeader'\nimport InputTooltip from './InputTooltip'\nimport { useSearchContext } from '../SearchContext'\n\nexport const inputSectionContext = createContext()\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    width: '100%',\n    height: '100%',\n    display: 'flex',\n    justifyContent: 'center',\n    flexDirection: 'column',\n    boxSizing: 'border-box'\n  },\n  label: {\n    marginBottom: `${theme.spacing(-0.5)}px !important`\n  }\n}))\nconst InputSection = React.memo(({\n  label,\n  section,\n  description,\n  className,\n  disableHeader,\n  classes,\n  children,\n  'data-testid': testID\n}) => {\n  const theme = useTheme()\n  const styles = useStyles({classes: classes, theme: theme})\n  const { filterData } = useSearchContext()\n\n  // Determine the description and units\n  const def = filterData[section]\n  const nested = def?.nested\n  const repeats = def?.repeats\n  const descFinal = description || def?.description || ''\n  const labelFinal = label || def?.label\n\n  return <InputTooltip>\n    <div className={clsx(className, styles.root)} data-testid={testID}>\n      {!disableHeader && <InputHeader\n        quantity={section}\n        label={labelFinal}\n        description={descFinal}\n        className={styles.label}\n        disableWidget\n        disableStatistics\n      />}\n      <inputSectionContext.Provider value={{\n        section: section,\n        nested: nested,\n        repeats: repeats\n      }}>\n        {children}\n      </inputSectionContext.Provider>\n    </div>\n  </InputTooltip>\n})\n\nInputSection.propTypes = {\n  label: PropTypes.string,\n  section: PropTypes.string.isRequired,\n  description: PropTypes.string,\n  disableHeader: PropTypes.bool,\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  children: PropTypes.node,\n  'data-testid': PropTypes.string\n}\n\nexport default InputSection\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useEffect, useState, useCallback } from 'react'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\nimport { makeStyles, Tooltip } from '@material-ui/core'\nimport { useResizeDetector } from 'react-resize-detector'\n\n/**\n * Component for displaying text that should be truncated with an Ellipsis\n * either in front of the text or after the text. Can lso show the full text on\n * hover as a tooltip.\n */\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: 'block',\n    whiteSpace: 'nowrap',\n    overflow: 'hidden',\n    textOverflow: 'ellipsis'\n  },\n  // This is a trick to make the ellipsis appear in front. Note the special sign\n  // injected in front that makes the content flow form left-to-right.\n  ellipsisFront: {\n    direction: 'rtl',\n    textAlign: 'left',\n    '&::before': {\n      content: '\"\"'\n    }\n  }\n}))\n\nconst Ellipsis = React.memo(({front, children, tooltip}) => {\n  const styles = useStyles()\n  const {width, ref} = useResizeDetector()\n  const [showTooltip, setShowTooltip] = useState(false)\n\n  // Used to determine whether to show the tooltip or not\n  const compareSize = useCallback(() => {\n    if (!ref?.current) return\n    const compare =\n      ref.current.scrollWidth > ref.current.clientWidth\n    setShowTooltip(compare)\n  }, [ref])\n\n  // Whenever the component width changes, check if tooltip should be shown\n  useEffect(() => { compareSize() }, [width, compareSize])\n\n  // Define state and function to update the value\n  return <Tooltip\n      title={showTooltip ? tooltip : ''}\n      disableHoverListener={!showTooltip}\n    >\n    <span ref={ref} className={clsx(styles.root, front && styles.ellipsisFront)}>{children}</span>\n  </Tooltip>\n})\n\nEllipsis.propTypes = {\n  children: PropTypes.node,\n  tooltip: PropTypes.string,\n  front: PropTypes.bool\n}\n\nEllipsis.defaultProps = {\n  tooltip: ''\n}\n\nexport default Ellipsis\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useMemo, useContext } from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { Typography, Tooltip } from '@material-ui/core'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\nimport { useSearchContext } from './SearchContext'\nimport { inputSectionContext } from './input/InputSection'\nimport { Unit } from '../units/Unit'\nimport { useUnitContext } from '../units/UnitContext'\nimport Ellipsis from '../visualization/Ellipsis'\n\n/**\n * Title for a metainfo quantity or section that is used in a search context.\n * By default the label, description and unit are automatically retrieved from\n * the filter config.\n */\nconst useStaticStyles = makeStyles(theme => ({\n  root: {\n  },\n  text: {\n  },\n  title: {\n    fontWeight: 600,\n    color: theme.palette.grey[800]\n  },\n  right: {\n    overflow: 'hidden'\n  },\n  down: {\n    overflow: 'hidden',\n    writingMode: 'vertical-rl',\n    textOrientation: 'mixed'\n  },\n  up: {\n    overflow: 'hidden',\n    writingMode: 'vertical-rl',\n    textOrientation: 'mixed',\n    transform: 'rotate(-180deg)'\n  }\n}))\nconst FilterTitle = React.memo(({\n  quantity,\n  label,\n  description,\n  unit,\n  variant,\n  TooltipProps,\n  onMouseDown,\n  onMouseUp,\n  className,\n  classes,\n  rotation,\n  disableUnit,\n  noWrap\n}) => {\n  const styles = useStaticStyles({classes})\n  const { filterData } = useSearchContext()\n  const sectionContext = useContext(inputSectionContext)\n  const {units} = useUnitContext()\n  const section = sectionContext?.section\n\n  // Create the final label\n  const finalLabel = useMemo(() => {\n    let finalLabel = label || filterData[quantity]?.label\n    if (!disableUnit) {\n      let finalUnit\n      if (unit) {\n        finalUnit = new Unit(unit).label()\n      } else if (filterData[quantity]?.unit) {\n        finalUnit = new Unit(filterData[quantity].unit).toSystem(units).label()\n      }\n      if (finalUnit) {\n        finalLabel = `${finalLabel} (${finalUnit})`\n      }\n    }\n    return finalLabel\n  }, [filterData, quantity, units, label, unit, disableUnit])\n\n  // Determine the final description\n  const finalDescription = description || filterData[quantity]?.description || ''\n  let tooltip = ''\n  if (finalDescription && quantity) {\n    tooltip = (\n      <>\n        <Typography>{finalLabel}</Typography>\n        <b>Description: </b>{finalDescription}<br/>\n        <b>Path: </b>{quantity}\n      </>\n    )\n  }\n\n  return <Tooltip title={tooltip} interactive enterDelay={400} enterNextDelay={400} {...(TooltipProps || {})}>\n    <div className={clsx(className, styles.root,\n      rotation === 'right' && styles.right,\n      rotation === 'down' && styles.down,\n      rotation === 'up' && styles.up\n    )}>\n      <Typography\n        noWrap={noWrap}\n        className={clsx(styles.text, (!section) && styles.title)}\n        variant={variant}\n        onMouseDown={onMouseDown}\n        onMouseUp={onMouseUp}\n      >\n        <Ellipsis>{finalLabel}</Ellipsis>\n      </Typography>\n    </div>\n  </Tooltip>\n})\n\nFilterTitle.propTypes = {\n  quantity: PropTypes.string,\n  label: PropTypes.string,\n  unit: PropTypes.oneOfType([PropTypes.string, PropTypes.object]),\n  description: PropTypes.string,\n  variant: PropTypes.string,\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  rotation: PropTypes.oneOf(['up', 'right', 'down']),\n  disableUnit: PropTypes.bool,\n  TooltipProps: PropTypes.object, // Properties forwarded to the Tooltip\n  onMouseDown: PropTypes.func,\n  onMouseUp: PropTypes.func,\n  placement: PropTypes.string,\n  noWrap: PropTypes.bool\n}\n\nFilterTitle.defaultProps = {\n  variant: 'body2',\n  rotation: 'right',\n  noWrap: true\n}\n\nexport default FilterTitle\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useMemo, useCallback } from 'react'\nimport { makeStyles } from '@material-ui/core'\nimport { Cancel } from '@material-ui/icons'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\nimport { useSearchContext } from '../SearchContext'\nimport FilterTitle from '../FilterTitle'\nimport { Actions, ActionHeader, Action } from '../../Actions'\nimport { useBoolState } from '../../../hooks'\n\n/**\n * The header displayed by all widgets.\n */\nconst useStyles = makeStyles(theme => ({\n  root: {\n    marginBottom: theme.spacing(0.5),\n    height: '2.5rem',\n    width: '100%'\n  },\n  handle: {\n    display: 'flex',\n    height: '100%',\n    alignItems: 'center',\n    flexGrow: 1,\n    minWidth: 0,\n    cursor: 'grabbing'\n  },\n  spacer: {\n    flexGrow: 1,\n    minWidth: 0\n  }\n}))\nconst WidgetHeader = React.memo(({\n  id,\n  quantity,\n  label,\n  description,\n  disableUnit,\n  actions,\n  className,\n  classes\n}) => {\n  const styles = useStyles({classes: classes})\n  const { useRemoveWidget } = useSearchContext()\n  const removeWidget = useRemoveWidget()\n  const [isDragging, setDragging, setNotDragging] = useBoolState(false)\n  const [isTooltipOpen, openTooltip, closeTooltip] = useBoolState(false)\n\n  const handleMouseDown = useCallback((event) => {\n    setDragging()\n    closeTooltip()\n  }, [closeTooltip, setDragging])\n\n  const handleMouseUp = useCallback(() => {\n    setNotDragging()\n  }, [setNotDragging])\n\n  const handleRemove = useCallback(() => {\n    removeWidget(id)\n  }, [removeWidget, id])\n\n  const tooltipProps = useMemo(() => ({\n    open: isTooltipOpen,\n    onClose: closeTooltip,\n    onOpen: () => !isDragging && openTooltip()\n  }), [isTooltipOpen, closeTooltip, isDragging, openTooltip])\n\n  return <Actions className={clsx(styles.root, className)}>\n    <ActionHeader disableSpacer>\n      <div\n        className={clsx(\"dragHandle\", styles.handle)}\n        onMouseDown={handleMouseDown}\n        onMouseUp={handleMouseUp}\n      >\n        <FilterTitle\n          quantity={quantity}\n          label={label}\n          description={description}\n          disableUnit={disableUnit}\n          TooltipProps={tooltipProps}\n          full\n        />\n        <div className={styles.spacer}/>\n      </div>\n    </ActionHeader>\n    {actions}\n    <Action tooltip='Remove' onClick={handleRemove} data-testid={`${id}-remove-widget`}>\n      <Cancel fontSize=\"small\"/>\n    </Action>\n  </Actions>\n})\n\nWidgetHeader.propTypes = {\n  id: PropTypes.string.isRequired,\n  quantity: PropTypes.string,\n  label: PropTypes.string,\n  description: PropTypes.string,\n  disableUnit: PropTypes.bool,\n  variant: PropTypes.string,\n  actions: PropTypes.node,\n  className: PropTypes.string,\n  classes: PropTypes.object\n}\n\nexport default WidgetHeader\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useCallback, useMemo } from 'react'\nimport clsx from 'clsx'\nimport PropTypes from 'prop-types'\nimport { cloneDeep, isNil } from 'lodash'\nimport { object, string, number } from 'yup'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { Edit } from '@material-ui/icons'\nimport { Action } from '../../Actions'\nimport WidgetHeader from './WidgetHeader'\n\n/**\n * A thin wrapper for displaying widgets.\n */\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex',\n    flexDirection: 'column'\n  }\n}))\nexport const Widget = React.memo(({\n  id,\n  quantity,\n  title,\n  description,\n  onEdit,\n  className,\n  children,\n  actions\n}) => {\n  const styles = useStyles()\n\n  const handleEdit = useCallback(() => {\n    onEdit && onEdit()\n  }, [onEdit])\n\n  const actionsFinal = useMemo(() => {\n    return <>\n      {!!actions && actions}\n      <Action tooltip='Edit' onClick={handleEdit}>\n        <Edit fontSize=\"small\"/>\n      </Action>\n    </>\n  }, [handleEdit, actions])\n\n  return <div className={clsx(styles.root, className)}>\n    <WidgetHeader\n      id={id}\n      quantity={quantity}\n      label={title}\n      description={description}\n      actions={actionsFinal}\n      anchored\n    />\n    {children}\n  </div>\n})\n\nWidget.propTypes = {\n  id: PropTypes.string.isRequired,\n  quantity: PropTypes.string,\n  title: PropTypes.string,\n  description: PropTypes.string,\n  onEdit: PropTypes.func,\n  className: PropTypes.string,\n  children: PropTypes.node,\n  actions: PropTypes.node\n}\n\nexport const schemaLayout = object({\n  x: number().test(\n    'is-integer-or-infinity',\n    // eslint-disable-next-line no-template-curly-in-string\n    '${path} is not a valid integer number',\n    (value, context) => Number.isInteger(value) || value === Infinity || isNil(value)\n  ),\n  y: number().integer(),\n  w: number().integer(),\n  h: number().integer(),\n  minW: number().integer(),\n  minH: number().integer()\n})\nexport const schemaWidget = object({\n  type: string().required(),\n  title: string(),\n  layout: object({\n    sm: schemaLayout,\n    md: schemaLayout,\n    lg: schemaLayout,\n    xl: schemaLayout,\n    xxl: schemaLayout\n  }),\n  id: string().strip(),\n  editing: string().strip(),\n  visible: string().strip()\n})\nexport const schemaAxisBase = object({\n  scale: string().nullable()\n})\nexport const schemaAxis = object({\n  quantity: string().required(),\n  unit: string().nullable(),\n  title: string().nullable(),\n  scale: string().nullable()\n})\nexport const schemaAxisOptional = object({\n  quantity: string().nullable(),\n  unit: string().nullable(),\n  title: string().nullable(),\n  scale: string().nullable()\n})\nexport const schemaMarkers = object({\n  color: schemaAxisOptional\n})\n\n/**\n * Transforms a list of widgets into the internal object representation.\n * @param {array} widgetList Array of widget configs.\n */\nexport function getWidgetsObject(widgetList) {\n  const widgets = cloneDeep(widgetList)\n  return widgets\n    ? Object.fromEntries(widgets.map((widget, index) => {\n      return [\n        index.toString(),\n        {...widget, id: index.toString(), editing: false, visible: true}\n      ]\n    }))\n    : {}\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Represents a suggestable option in the search bar. In TypeScript this would\n * be an interface.\n */\nexport class SearchSuggestion {\n  input\n  type\n  history\n\n  constructor(param) {\n    this.input = param.input\n    this.type = param.type\n    this.history = param.history\n    this.key = `${this.input}-${this.type}`\n  }\n}\n\n/**\n * Enum for types of suggestions. In TypeScript this would be an Enum.\n */\nexport const SuggestionType = {\n  Freetext: 'free_text',\n  Equality: 'equality',\n  RangeHalfBounded: 'range_half_bounded',\n  RangeBounded: 'range_bounded',\n  Existence: 'existence',\n  Name: 'name'\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useCallback, useEffect, useState, useRef, useMemo, useContext } from 'react'\nimport compose from 'compose-function'\nimport {\n  atom,\n  atomFamily,\n  selector,\n  selectorFamily,\n  useSetRecoilState,\n  useRecoilValue,\n  useRecoilState,\n  useRecoilCallback\n} from 'recoil'\nimport {\n  debounce,\n  isBoolean,\n  isEmpty,\n  isEqual,\n  isArray,\n  isPlainObject,\n  isNil,\n  isSet,\n  isObject,\n  isFunction,\n  size,\n  cloneDeep\n} from 'lodash'\nimport qs from 'qs'\nimport { useLocation, useHistory } from 'react-router-dom'\nimport { Box, Link, makeStyles } from '@material-ui/core'\nimport { v4 as uuidv4 } from 'uuid'\nimport PropTypes from 'prop-types'\nimport { useApi } from '../api'\nimport {\n  authorList,\n  entryName,\n  entryType,\n  formatTimestamp,\n  getDeep,\n  formatNumber,\n  parseQuantityName,\n  rsplit,\n  parseOperator,\n  getSuggestions,\n  DType\n} from '../../utils'\nimport { Quantity } from '../units/Quantity'\nimport { Unit } from '../units/Unit'\nimport { useErrors } from '../errors'\nimport { combinePagination, addColumnDefaults } from '../datatable/Datatable'\nimport UploadStatusIcon from '../uploads/UploadStatusIcon'\nimport { getWidgetsObject } from './widgets/Widget'\nimport { inputSectionContext } from './input/InputSection'\nimport { SearchSuggestion } from './SearchSuggestion'\nimport { withFilters } from './FilterRegistry'\nimport { useUnitContext } from '../units/UnitContext'\n\nconst useWidthConstrainedStyles = makeStyles(theme => ({\n  root: {\n    maxWidth: '500px',\n    textOverflow: 'ellipsis',\n    overflow: 'hidden'\n  }\n}))\n\nfunction WidthConstrained(props) {\n  const styles = useWidthConstrainedStyles()\n  return <Box className={styles.root}>\n    {props.children}\n  </Box>\n}\nWidthConstrained.propTypes = {\n  children: PropTypes.node\n}\n\nconst debounceTime = 450\n\nfunction parseQueryString(queryString) {\n  return queryString\n    ? qs.parse(queryString, {comma: true})\n    : undefined\n}\n\n/**\n * Removes keycloak-specific fragments from the given URL.\n*/\nfunction removeKeycloak(url) {\n  for (const pattern of ['#state=', '#iss=', '#error=']) {\n    url = url.split(pattern)[0]\n  }\n  return url\n}\n\nconst RouteListener = React.memo(() => {\n  const location = useLocation()\n  const history = useHistory()\n  const { useQueryString, useSetFilters, useParseQueries } = useSearchContext()\n  const queryString = useQueryString()()\n  const setFilters = useSetFilters()\n  const parseQueries = useParseQueries()\n  const oldQuery = useRef()\n\n  // When query changes, update history\n  useEffect(() => {\n    history.replace(history.location.pathname + '?' + queryString)\n    oldQuery.current = queryString\n  }, [history, queryString])\n\n  // When location changes, update SearchContext if query has changed.\n  useEffect(() => {\n    // The query string needs to contain everything in the hash as well, since\n    // the syntax for data within custom schemas uses a hashtag. TODO: Keycloak\n    // seems to use the hashtag for special purposes as well, which causes some\n    // clashes when loading the page from scratch.\n    const queryString = removeKeycloak(location.search.slice(1) + location.hash)\n    // Empty query string preserves the old filters, as this will enable people\n    // to preserve filters when changing apps. This causes minor\n    // inconsistencies, but might be better for the UX.\n    if (!isEmpty(queryString) && queryString !== oldQuery.current) {\n      setFilters(parseQueries(parseQueryString(queryString)))\n    }\n  }, [location, setFilters, parseQueries])\n\n  return null\n})\n\nRouteListener.propTypes = {\n}\n\n/**\n * HOC that handles the two-way syncing of URL query parameters and\n * SearchContext filter values.\n */\nexport const withQueryString = (WrappedComponent) => {\n  const WithQueryString = ({initialFilterValues, children, ...rest}) => {\n    const firstRender = useRef(true)\n    const valueRef = useRef()\n\n    // Extract URL query parameters, ignore keycloak authentication state\n    // parameters starting with '#iss='.\n    useMemo(() => {\n      if (firstRender.current) {\n        const split = window.location.href.split('?')\n        const search = (split.length > 1)\n          ? parseQueryString(removeKeycloak(split.slice(-1)[0]))\n          : {}\n        valueRef.current = {...(initialFilterValues || {}), ...search}\n        firstRender.current = false\n      }\n    }, [initialFilterValues])\n\n    return <WrappedComponent {...rest} initialFilterValues={valueRef.current}>\n      {children}\n      <RouteListener />\n    </WrappedComponent>\n  }\n\n  WithQueryString.displayName = `withQueryString(${WrappedComponent.displayName || WrappedComponent.name})`\n  WithQueryString.propTypes = {\n    initialFilterValues: PropTypes.object, // Determines which filters are available\n    children: PropTypes.node // Determines which filters are available\n  }\n\n  return WithQueryString\n}\n\n/**\n * React context that provides access to the search state implemented with\n * Recoil.js. The purpose of this context is to hide the Recoil.js\n * implementation details and provide a clean access to individual states.\n *\n * Each search filter, aggregation query and aggregation result is mapped into a\n * separate Recoil.js Atom. This allows components to hook into individual\n * search parameters (both for setting and reading their value). This performs\n * much better than having larger Atoms, as this would cause several components\n * to render even if they are not affected by some other search filter or\n * result.\n *\n * Access to the search state is typically made through functions that can be\n * accessed from the context. This way components can hook into individual\n * values of information and do not have to re-render. If we were to provide\n * e.g. the filter values directly within the search context, each component\n * depending on the context would re-render for each filter change regardless if\n * it actually changes the state of that component or not.\n */\nexport const searchContext = React.createContext()\nexport const SearchContextRaw = React.memo(({\n  resource,\n  initialFiltersLocked,\n  initialColumns,\n  initialRows,\n  initialFilterMenus,\n  initialPagination,\n  initialDashboard,\n  initialFilterData,\n  initialFilterGroups,\n  initialFilterValues,\n  initialSearchSyntaxes,\n  id,\n  suggestionHistorySize,\n  children\n}) => {\n  const {api, user} = useApi()\n  const {units} = useUnitContext()\n  const {raiseError} = useErrors()\n  const oldQuery = useRef(undefined)\n  const oldPagination = useRef(undefined)\n  const paginationResponse = useRef(undefined)\n  const updatedAggsMap = useRef({})\n  const apiQueue = useRef([])\n  const apiMap = useRef({})\n  const updatedFilters = useRef(new Set())\n  const firstLoad = useRef(true)\n  const disableUpdate = useRef(false)\n  const indexFilters = useRef(0)\n  const indexLocked = useRef(0)\n  const contextID = useMemo(() => uuidv4(), [])\n\n  // Initialize the set of filters that are available in this context\n  const {initialFilterPaths, initialFilterAbbreviations} = useMemo(() => {\n    return {\n      initialFilterPaths: new Set(Object.keys(initialFilterData)),\n      initialFilterAbbreviations: getAbbreviations(initialFilterData)\n    }\n  }, [initialFilterData])\n\n  // The final set of columns\n  const columns = useMemo(() => {\n    if (!initialColumns) return undefined\n\n    // Add unit information if one is defined. This unit is currently fixed and\n    // not affected by global unit system.\n    const config = cloneDeep(initialColumns)\n    let options = config?.options\n      ? Object.entries(config.options).map(([key, value]) => ({key, ...value}))\n      : []\n    options.forEach(option => {\n      const storageUnit = initialFilterData[option.quantity || option.key]?.unit\n      const displayUnit = option.unit\n      option.label = option.label || initialFilterData[option.quantity || option.key]?.label\n      if (storageUnit || displayUnit) {\n        const finalUnit = displayUnit\n          ? new Unit(displayUnit)\n          : new Unit(storageUnit).toSystem(units)\n        option.label = `${option.label} (${finalUnit.label()})`\n      }\n    })\n\n    // Automatically determine the render function based on metainfo.\n    options.forEach(option => {\n      option.render = (data) => {\n        const value = getDeep(data, parseQuantityName(option.key).path)\n        if (isNil(value)) return value\n\n        const transform = (value) => {\n          const key = option.key\n          const format = option.format\n          const dtype = initialFilterData[key]?.dtype\n\n          if (dtype === 'timestamp') {\n            return formatTimestamp(value, format?.mode)\n          }\n\n          const storageUnit = initialFilterData[option.quantity || option.key]?.unit\n          const displayUnit = option.unit\n          if (storageUnit || displayUnit) {\n            const finalUnit = displayUnit\n              ? new Unit(displayUnit)\n              : new Unit(storageUnit).toSystem(units)\n            value = new Quantity(value, storageUnit).to(finalUnit).value()\n          }\n          if (dtype === DType.Int || dtype === DType.Float) {\n            value = formatNumber(value, dtype, format?.mode, format?.decimals)\n          }\n          return value\n        }\n        return isArray(value)\n          ? value.map(transform).join(option?.format?.separator || ', ')\n          : transform(value)\n      }\n    })\n\n    // Custom render and other setting overrides are used for a subset of\n    // columns.\n    const overrides = {\n      entry_name: {\n        render: (entry) => <WidthConstrained>{entryName(entry)}</WidthConstrained>\n      },\n      entry_type: {\n        render: (entry) => <WidthConstrained>{entryType(entry)}</WidthConstrained>\n      },\n      upload_create_time: {\n        render: row => row?.upload_create_time\n          ? formatTimestamp(row.upload_create_time)\n          : <i>no upload time</i>\n      },\n      entry_create_time: {\n        render: row => row?.entry_create_time\n          ? formatTimestamp(row.entry_create_time)\n          : <i>no entry time</i>\n      },\n      authors: {\n        sortable: false,\n        render: row => authorList(row),\n        align: 'left'\n      },\n      references: {\n        sortable: false,\n        render: row => {\n          const refs = row.references || []\n          if (refs.length > 0) {\n            return (\n              <div style={{display: 'inline'}}>\n                {refs.map((ref, i) => <span key={ref}>\n                  <Link href={ref}>{ref}</Link>{(i + 1) < refs.length ? ', ' : <React.Fragment/>}\n                </span>)}\n              </div>\n            )\n          } else {\n            return <i>no references</i>\n          }\n        }\n      },\n      datasets: {\n        sortable: false,\n        render: entry => {\n          const datasets = entry.datasets || []\n          if (datasets.length > 0) {\n            return datasets.map(dataset => dataset.dataset_name).join(', ')\n          } else {\n            return <i>no datasets</i>\n          }\n        }\n      },\n      published: {\n        render: (entry) => <UploadStatusIcon data={entry} user={user} />\n      }\n    }\n\n    // Sort options by putting initially selected ones on top\n    if (config.selected) {\n      options = [\n        ...config.selected.map(key => options.find(opt => opt.key === key)).filter(opt => !!opt),\n        ...options.filter(opt => !config.selected.find(key => key === opt.key))\n      ]\n    }\n\n    // Add defaults and custom overrides to the options\n    addColumnDefaults(options, undefined, initialFilterData)\n    config.options = Object.fromEntries(options.map(option => {\n      return [option.key, {...option, ...(overrides[option.key] || {})}]\n    }))\n\n    return config\n  }, [initialFilterData, initialColumns, user, units])\n\n  // The final row configuration\n  const rows = useMemo(() => {\n    return initialRows || undefined\n  }, [initialRows])\n\n  // The final menu configuration\n  const filterMenus = useMemo(() => {\n    return initialFilterMenus || undefined\n  }, [initialFilterMenus])\n\n  // The final dashboard configuration\n  const dashboard = useMemo(() => {\n    return initialDashboard\n      ? {...initialDashboard, widgets: getWidgetsObject(initialDashboard?.widgets || [])}\n      : undefined\n  }, [initialDashboard])\n\n  // Initialize the search context state: any parameters in the URL are read and\n  // default values as specified in filter registry are loaded\n  const [initialQuery, initialAggs, filterDefaults] = useMemo(() => {\n    const filterDefaults = {}\n    for (const [key, value] of Object.entries(initialFilterData)) {\n      if (!isNil(value.default)) {\n        filterDefaults[key] = value.default\n      }\n    }\n    const initialAggs = {}\n    for (const key of initialFilterPaths) {\n      initialAggs[key] = {\n        default: {update: false}\n      }\n    }\n    return [\n      parseQueries(initialFilterValues, initialFilterData, initialFilterAbbreviations.filterFullnames),\n      initialAggs,\n      filterDefaults\n    ]\n  }, [initialFilterData, initialFilterAbbreviations, initialFilterValues, initialFilterPaths])\n\n  // Atoms + setters and getters are used instead of regular React states to\n  // avoid re-rendering components that are not depending on these values. The\n  // Recoil mechanisms are abstracted under hooks in order to make it easier to\n  // replace Recoil with some other state management library in the future.\n const {\n      useFilterLocked,\n      useFiltersLocked,\n      useFiltersLockedState,\n      useFilterValue,\n      useSetFilter,\n      useFilterState,\n      useFilters,\n      useFilterNames,\n      useFiltersData,\n      useFilterMaps,\n      useResetFilters,\n      useQueryString,\n      useDynamicQueryModes,\n      aggsFamily,\n      useWidgetValue,\n      useSetWidget,\n      useWidgetState,\n      useWidgetsValue,\n      useWidgetsState,\n      useAddWidget,\n      useRemoveWidget,\n      useResetWidgets,\n      useQuery,\n      useSearchSuggestionsValue,\n      useSetSearchSuggestions,\n      usePagination,\n      useSetPagination,\n      usePaginationState,\n      useAgg,\n      useAggs,\n      useSetAggsResponse,\n      useSetFilters,\n      useUpdateFilter,\n      useIsMenuOpen,\n      useSetIsMenuOpen,\n      useIsCollapsed,\n      useSetIsCollapsed,\n      useIsStatisticsEnabled,\n      useSetIsStatisticsEnabled,\n      useApiQuery,\n      useSetApiQuery,\n      useApiData,\n      useSetApiData,\n      useResults,\n      useSetResults,\n      useResultsUsed,\n      useRequired\n  } = useMemo(() => {\n    const isMenuOpenState = atom({\n      key: `isMenuOpen_${contextID}`,\n      default: false\n    })\n\n    const isCollapsedState = atom({\n      key: `isCollapsed_${contextID}`,\n      default: false\n    })\n\n    const isStatisticsEnabledState = atom({\n      key: `statisticsEnabled_${contextID}`,\n      default: true\n    })\n\n    const apiDataState = atom({\n      key: `apiData_${contextID}`,\n      default: null\n    })\n\n    const apiQueryState = atom({\n      key: `apiQuery_${contextID}`,\n      default: null\n    })\n\n    const resultsState = atom({\n      key: `results_${contextID}`,\n      default: {\n        pagination: {}\n      }\n    })\n\n    const resultsUsedState = atom({\n      key: `resultsUsed_${contextID}`,\n      default: false\n    })\n\n    let suggestions = []\n    const suggestionID = id && `nomad-searchcontext-${id}`\n    if (suggestionID) {\n      try {\n        suggestions = JSON\n          .parse(window.localStorage.getItem(suggestionID))\n          .map(item => new SearchSuggestion(item))\n          .slice(0, suggestionHistorySize)\n      } catch (e) {\n      }\n    }\n    const searchSuggestionsState = atom({\n      key: `searchSuggestions_${contextID}`,\n      default: suggestions,\n      effects: [\n        ({onSet}) => {\n          if (suggestionID) {\n            onSet((newValue, _, isReset) => {\n              isReset\n                ? window.localStorage.removeItem(suggestionID)\n                : window.localStorage.setItem(suggestionID, JSON.stringify(newValue))\n            })\n          }\n        }\n      ]\n    })\n\n    const requiredState = atom({\n      key: `required_${contextID}`,\n      default: {\n        exclude: resource === 'entries' ? ['quantities', 'sections', 'files'] : undefined\n      }\n    })\n\n    // Stores the available filters. Initialized with static filters, can be\n    // modified later.\n    const filtersDataState = atom({\n      key: `filtersData_${contextID}`,\n      default: initialFilterData\n    })\n\n    const filterNamesState = selector({\n      key: `filters${contextID}`,\n      get: ({get}) => new Set(Object.keys(get(filtersDataState)))\n    })\n\n    const queryFamily = atomFamily({\n      key: `queryFamily_${contextID}`,\n      default: (name) => initialQuery[name]\n    })\n\n    const dynamicQueryModesFamily = atomFamily({\n      key: `dynamicQueryModesFamily_${contextID}`,\n      default: (name) => undefined\n    })\n\n    // Used to get/set the state of all filters at once\n    const filtersState = selector({\n      key: `filtersState_${contextID}`,\n      get: ({get}) => {\n        const query = {}\n        for (const key of get(filterNamesState)) {\n          const filter = get(queryFamily(key))\n          query[key] = filter\n        }\n        return query\n      },\n      set: ({get, set}, values) => {\n        for (const key of get(filterNamesState)) {\n          set(queryFamily(key), values?.[key])\n        }\n      }\n    })\n\n    // Stores a mapping between filter abbreviations and their full names.\n    const filterMapsState = selector({\n      key: `filterAbbreviations_${contextID}`,\n      get: ({get}) => {\n        const filterData = get(filtersDataState)\n        return getAbbreviations(filterData)\n      }\n    })\n\n    const paginationState = atom({\n      key: `pagination_${contextID}`,\n      default: initialPagination\n    })\n\n    const guiLocked = parseQueries(initialFiltersLocked, initialFilterData, initialFilterAbbreviations.filterFullnames)\n    const lockedFamily = atomFamily({\n      key: `lockedFamily_${contextID}`,\n      default: (name) => guiLocked?.[name]\n    })\n\n    // Used to set the locked state of several filters at once\n    const lockedState = selector({\n      key: `lockedState_${contextID}`,\n      get: ({get}) => {\n        const locks = {}\n        for (const key of get(filterNamesState)) {\n          const filter = get(lockedFamily(key))\n          if (!isNil(filter)) locks[key] = filter\n        }\n        return locks\n      }\n    })\n\n    /**\n     * A Recoil.js selector that aggregates all the currently set filters into a\n     * single query object used by the API.\n     */\n    const queryState = selector({\n      key: `query_${contextID}`,\n      get: ({get}) => {\n        const query = {}\n        for (const key of get(filterNamesState)) {\n          const filter = get(queryFamily(key))\n          if (!isNil(filter) && (!isObject(filter) || !isEmpty(filter))) {\n            query[key] = filter\n          }\n        }\n        return query\n      },\n      set: ({ set, get }, data) => {\n        for (const filter of get(filterNamesState)) {\n          set(queryFamily(filter), undefined)\n        }\n        if (data) {\n          for (const [key, value] of Object.entries(data)) {\n            set(queryFamily(key), value)\n          }\n        }\n      }\n    })\n\n    /**\n     * A Recoil.js selector that return the dynamic query modes state\n     */\n    const dynamicQueryModesState = selector({\n      key: `dynamicQueryModes_${contextID}`,\n      get: ({get}) => {\n        const query = {}\n        for (const key of get(filterNamesState)) {\n          const filter = get(dynamicQueryModesFamily(key))\n          if (filter !== undefined) {\n            query[key] = filter\n          }\n        }\n        return query\n      },\n      set: ({ set, get }, data) => {\n        for (const filter of get(filterNamesState)) {\n          set(dynamicQueryModesFamily(filter), undefined)\n        }\n        if (data) {\n          for (const [key, value] of Object.entries(data)) {\n            set(dynamicQueryModesFamily(key), value)\n          }\n        }\n      }\n    })\n\n    function useDynamicQueryModes() {\n      return useRecoilValue(dynamicQueryModesState)\n    }\n\n    const widgetFamily = atomFamily({\n      key: `widgetFamily_${contextID}`,\n      default: (name) => dashboard?.widgets?.[name]\n    })\n\n    const widgetIds = atom({\n      key: `widgetIds_${contextID}`,\n      default: [...Object.keys(dashboard?.widgets || {})]\n    })\n\n    // Used to get/set the widgets configuration\n    const widgetsState = selector({\n      key: `widgetsState_${contextID}`,\n      set: ({set, reset}, value) => {\n        if (value) {\n          const ids = Object.keys(value)\n          Object.entries(value).forEach(([key, val]) => set(widgetFamily(key), val))\n          set(widgetIds, ids)\n        } else {\n          reset(widgetIds)\n          reset(widgetFamily)\n        }\n      },\n      get: ({get}) => {\n        const stats = {}\n        const ids = get(widgetIds)\n        for (const id of ids) {\n          const stat = get(widgetFamily(id))\n          if (stat) stats[id] = stat\n        }\n        return stats\n      }\n    })\n\n    function useQuery(name) {\n      return useRecoilValue(queryState)\n    }\n\n    /**\n     * This hook will expose a function for reading if widgets are shown\n     * on the search page. Use this hook if you intend to only view the value and\n     * are not interested in setting the value.\n     *\n     * @param {string} name Name of the filter.\n     * @returns Whether the widgets are shown.\n     */\n    function useWidgetValue(name) {\n      return useRecoilValue(widgetFamily(name))\n    }\n\n    /**\n     * This hook will expose a function for setting if widget are shown\n     * on the search page. Use this hook if you intend to only set the value and are\n     * not interested in reading it.\n     *\n     * @param {string} name Name of the quantity to set.\n     * @returns Function for setting the value\n     */\n    function useSetWidget(name) {\n      return useSetRecoilState(widgetFamily(name))\n    }\n\n    /**\n     * This hook will expose a function for getting and setting whether the\n     * widgets are shown. Use this hook if you intend to both read and write the\n     * filter value.\n     *\n     * @param {string} name Name of the filter.\n     * @returns Array containing the value and a function for setting it.\n     */\n    function useWidgetState(name) {\n      return useRecoilState(widgetFamily(name))\n    }\n\n    /**\n     * This hook will expose a function for reading a list of anchored quantities.\n     *\n     * @returns A list containing the anchored quantity names.\n     */\n    function useWidgetsValue() {\n      return useRecoilValue(widgetsState)\n    }\n\n    /**\n     * This hook will expose a function for reading and writing the object\n     * containing all the current widgets.\n     *\n     * @returns Array containing the value and a function for setting it.\n     */\n    function useWidgetsState() {\n      return useRecoilState(widgetsState)\n    }\n\n    /**\n     * Returns a function that can be used to add a new widget.\n     *\n     * @returns Function for setting a new widget value.\n     */\n    const useAddWidget = () => {\n      const add = useRecoilCallback(({set}) => (id, value) => {\n        set(widgetFamily(id), value)\n        set(widgetIds, (old) => [...old, id])\n      }, [])\n      return add\n    }\n\n    /**\n     * Returns a function that can be used to remove a widget.\n     *\n     * @returns Function for removing a widget by id.\n     */\n    const useRemoveWidget = () => {\n      const remove = useRecoilCallback(({set}) => (id) => {\n        set(widgetFamily(id), undefined)\n        set(widgetIds, (old) => [...old].filter(item => item !== id))\n      }, [])\n      return remove\n    }\n\n    /**\n     * This hook will expose a function for resetting widgets to the initial\n     * configuration.\n     *\n     * @param {string} name Name of the quantity to set.\n     * @returns Function for setting the value\n     */\n    const useResetWidgets = () => {\n      const ids = useRecoilValue(widgetIds)\n      const reset = useRecoilCallback(({reset}) => () => {\n        for (const id of ids) {\n          reset(widgetFamily(id))\n        }\n        reset(widgetIds)\n      }, [])\n      return reset\n    }\n\n    const aggsFamilyRaw = atomFamily({\n      key: `aggsFamilyRaw_${contextID}`,\n      default: (name) => initialAggs[name]\n    })\n\n    const aggKeys = atom({\n      key: `aggKeys_${contextID}`,\n      default: []\n    })\n\n    const aggsFamily = selectorFamily({\n      key: `aggsFamily_${contextID}`,\n      get: (id) => ({ get }) => {\n        return get(aggsFamilyRaw(id))\n      },\n      set: (id) => ({set}, value) => {\n        set(aggsFamilyRaw(id), value)\n        set(aggKeys, prev => [...prev, id])\n      }\n    })\n\n    /**\n     * A Recoil.js selector that aggregates all the currently set aggregation\n     * requests into a single query object used by the API.\n     */\n    const aggsState = selector({\n      key: `aggs_${contextID}`,\n      get: ({get}) => {\n        const aggs = {}\n        for (const key of get(aggKeys)) {\n          const agg = get(aggsFamily(key))\n          if (agg !== undefined) {\n            aggs[key] = agg\n          }\n        }\n        return aggs\n      }\n    })\n\n    // Atom for each aggregation response.\n    const aggsResponseFamily = atomFamily({\n      key: `aggsResponseFamily_${contextID}`,\n      default: undefined\n    })\n\n    // Recoil.js selector for updating the aggs response in one go.\n    const aggsResponseState = selector({\n      key: `aggsResponse_${contextID}`,\n      get: ({get}) => {\n        return undefined\n      },\n      set: ({ set }, data) => {\n        if (data) {\n          for (const [key, value] of Object.entries(data)) {\n            set(aggsResponseFamily(key), value)\n          }\n        }\n      }\n    })\n\n    /**\n     * This hook will expose a function for reading filter values. Use this hook if\n     * you intend to only view the filter values and are not interested in setting\n     * the filter.\n     *\n     * @param {string} name Name of the filter.\n     * @returns currently set filter value.\n     */\n    const useFilterValue = (name) => {\n      // See in which context this filter is being called. If defined within an\n      // inputSectionContext, we set the filter inside nested query.\n      const sectionContext = useContext(inputSectionContext)\n      const section = sectionContext?.section\n      const subname = useMemo(() => section ? name.slice(section.length + 1) : undefined, [name, section])\n\n      const value = useRecoilValue(queryFamily(section || name))\n\n      return section\n        ? value?.[subname]\n        : value\n    }\n    /**\n     * This hook will expose a function for setting a filter value. Use this hook if\n     * you intend to only set the filter value and are not interested in the query\n     * results.\n     *\n     * @param {string} name Name of the quantity to set.\n     * @returns function for setting the value for the given quantity\n     */\n    const useSetFilter = (name) => {\n      // See in which context this filter is being called. If defined within an\n      // inputSectionContext, we set the filter inside nested query.\n      const sectionContext = useContext(inputSectionContext)\n      const section = sectionContext?.section\n      const subname = useMemo(() => section ? name.slice(section.length + 1) : undefined, [name, section])\n      const setter = useSetRecoilState(queryFamily(section || name))\n      const dynamicQueryModeSetter = useSetRecoilState(dynamicQueryModesFamily(section || name))\n\n      return useCallback((value, config = undefined) => {\n        updatedFilters.current.add(name)\n        dynamicQueryModeSetter(config?.queryMode)\n        section\n          ? setter(old => {\n            const newValue = isNil(old) ? {} : {...old}\n            if (isFunction(value)) {\n              value = value(newValue[subname])\n            }\n            newValue[subname] = value\n            return clearEmpty(newValue)\n          })\n          : setter(isFunction(value)\n            ? (old) => clearEmpty(value(old))\n            : clearEmpty(value))\n      }, [name, dynamicQueryModeSetter, section, setter, subname])\n    }\n\n    /**\n     * This hook will expose a function for getting and setting filter values. Use\n     * this hook if you intend to both read and write the filter value.\n     *\n     * @param {string} name Name of the filter.\n     * @returns Array containing the filter value and setter function for it.\n     */\n    const useFilterState = (name) => {\n      const value = useFilterValue(name)\n      const setter = useSetFilter(name)\n      return useMemo(() => [value, setter], [value, setter])\n    }\n\n    /**\n     * Hook that returns a function that returns the current query as a query string\n     *\n     * @returns {function} A function that updates the query string to reflect the\n     * current search page state.\n     */\n    const useQueryString = () => {\n      const query = useRecoilValue(queryState)\n      const filtersData = useRecoilValue(filtersDataState)\n      const {filterAbbreviations} = useRecoilValue(filterMapsState)\n\n      return useCallback(() => {\n        return convertQueryGUIToQS(query, filtersData, filterAbbreviations)\n      }, [query, filtersData, filterAbbreviations])\n    }\n\n    /**\n     * Returns a function that can be called to reset all current filters.\n     *\n     * @returns Function for resetting all filters.\n     */\n    const useResetFilters = () => {\n      const filterNames = useRecoilValue(filterNamesState)\n      const reset = useRecoilCallback(({set}) => () => {\n        for (const filter of filterNames) {\n          set(queryFamily(filter), undefined)\n          set(dynamicQueryModesFamily(filter), undefined)\n        }\n      }, [])\n      return reset\n    }\n\n    /**\n     * This hook will expose a function for reading if the given filter is locked.\n     *\n     * @param {string} name Name of the filter.\n     * @returns Whether the filter is locked or not.\n     */\n    const useFilterLocked = (name) => {\n      return useRecoilValue(lockedFamily(name))\n    }\n\n    /**\n     * This hook will expose a function for reading the locked status of all\n     * filters.\n     *\n     * @returns An object containing a mapping from filter name to a boolean\n     * indicating whether it is locked or not.\n     */\n    const useFiltersLocked = () => {\n      return useRecoilValue(lockedState)\n    }\n\n    /**\n     * This hook will expose a function for reading if the given set of filters are\n     * locked.\n     *\n     * @param {string} names Names of the filters.\n     * @returns Array containing the filter values in a map and a setter function.\n     */\n    const useFiltersLockedState = (names) => {\n      // We dynamically create a Recoil.js selector that is subscribed to the\n      // filters specified in the input. This way only the specified filters will\n      // cause a render. Recoil.js requires that each selector/atom has an unique\n      // id. Because this hook can be called dynamically, we simply generate the ID\n      // sequentially.\n      const filterState = useMemo(() => {\n        const id = `locked_selector_${contextID}_${indexLocked.current}`\n        indexLocked.current += 1\n        return selector({\n          key: id,\n          get: ({get}) => {\n            const query = {}\n            for (const key of names) {\n              const filter = get(lockedFamily(key))\n              query[key] = filter\n            }\n            return query\n          }\n        })\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n      }, [])\n\n      return useRecoilValue(filterState)\n    }\n\n    /**\n     * This hook will expose a function for getting and setting filter values for\n     * the specified list of filters. Use this hook if you intend to both read and\n     * write the filter values.\n     *\n     * @param {string} names Names of the filters.\n     * @returns Array containing the filter values in a map and a setter function.\n     */\n    const useFilters = (names) => {\n      // We dynamically create a Recoil.js selector that is subscribed to the\n      // filters specified in the input. This way only the specified filters will\n      // cause a render. Recoil.js requires that each selector/atom has an unique\n      // id. Because this hook can be called dynamically, we simply generate the ID\n      // sequentially.\n      const filterState = useMemo(() => {\n        const id = `dynamic_selector_${contextID}_${indexFilters.current}`\n        indexFilters.current += 1\n        return selector({\n          key: id,\n          get: ({get}) => {\n            const query = {}\n            for (const key of names) {\n              const filter = get(queryFamily(key))\n              query[key] = filter\n            }\n            return query\n          }\n        })\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n      }, [])\n\n      return useRecoilValue(filterState)\n    }\n\n    /**\n     * Hook for returning an object containing the currently fetched results,\n     * pagination and a function for changing the pagination.\n     *\n     * @returns {object} {data, pagination, setPagination}\n    */\n    const useResults = () => {\n      const setResultsUsed = useSetRecoilState(resultsUsedState)\n\n      // When loading results for the first time, inform the context that\n      // results need to be fetched.\n      useEffect(() => {\n        setResultsUsed(true)\n      }, [setResultsUsed])\n\n      return useRecoilValue(resultsState)\n    }\n\n    /**\n     * Hook for modifying an aggregation request and fetching the latest values for\n     * this aggregation.\n     *\n     * @param {string} name The filter name\n     * @param {bool} update Whether the hook needs to react to changes in the\n     * current query context. E.g. if the component showing the data is not visible,\n     * this can be set to false.\n     * @param {string} id The aggregation identifier\n     * @param {object} config The aggregation configuration. Remember that the\n     * value should be a constant or be memoized to avoid a new object being\n     * created for each call.\n     *\n     * @returns {object} An object containing the aggregation results: the layout is\n     * specific for each aggregation type.\n     */\n    const useAgg = (name, update, id = 'default', config = undefined) => {\n      const key = useMemo(() => `${name}:${id}`, [name, id])\n      const setAgg = useSetRecoilState(aggsFamily(key))\n      const aggResponse = useRecoilValue(aggsResponseFamily(key))\n      const filtersData = useRecoilValue(filtersDataState)\n\n      // Whenever the aggregation requirements change, create the final\n      // aggregation config and set it in the search context: this will then\n      // trigger any required API calls that also return the aggregation\n      // response that is returned by this hook.\n      useEffect(() => {\n        const defaults = filtersData[name]?.aggs?.[config?.type]\n        const finalConfig = {\n          update: update,\n          ...defaults || {},\n          ...config\n        }\n        setAgg(finalConfig)\n      }, [name, update, setAgg, config, filtersData])\n\n      return aggResponse\n    }\n\n    /**\n     * This hook will expose a function for setting the values of all filters.\n     *\n     * @returns An object containing a mapping from filter name to a boolean\n     * indicating whether it is locked or not.\n     */\n    const useSetFilters = () => {\n      return useSetRecoilState(filtersState)\n    }\n\n    /**\n     * Used to update a single filter value with a dynamic name. Supports\n     * callback and optionally also setting the queryMode.\n     */\n    const useUpdateFilter = () => {\n      return useRecoilCallback(({set}) => ([key, value, queryMode]) => {\n        set(queryFamily(key), value)\n        if (queryMode) set(dynamicQueryModesFamily(key), queryMode)\n      }, [])\n    }\n\n    /**\n     * Used to retrieve the currently set search suggestions.\n     *\n     * @returns Array containing the value and a function for setting it.\n     */\n    function useSearchSuggestionsValue() {\n      return useRecoilValue(searchSuggestionsState)\n    }\n\n    /**\n     * Used to set the currently set search suggestions.\n     */\n    function useSetSearchSuggestions() {\n      return useSetRecoilState(searchSuggestionsState)\n    }\n\n    return {\n      useFilterLocked,\n      useFiltersLocked,\n      useFiltersLockedState,\n      useFilterValue,\n      useSetFilter,\n      useFilterState,\n      useFilters,\n      useResetFilters,\n      useQueryString,\n      useDynamicQueryModes,\n      aggsFamily,\n      useWidgetValue,\n      useSetWidget,\n      useWidgetState,\n      useWidgetsValue,\n      useWidgetsState,\n      useAddWidget,\n      useRemoveWidget,\n      useResetWidgets,\n      useAgg,\n      useSetFilters,\n      useUpdateFilter,\n      useQuery,\n      useSearchSuggestionsValue,\n      useSetSearchSuggestions,\n      useFilterNames: () => useRecoilValue(filterNamesState),\n      useFiltersData: () => useRecoilValue(filtersDataState),\n      useFilterMaps: () => useRecoilValue(filterMapsState),\n      useSetFiltersData: () => useSetRecoilState(filtersDataState),\n      useAggs: () => useRecoilValue(aggsState),\n      useSetAggsResponse: () => useSetRecoilState(aggsResponseState),\n      usePagination: () => useRecoilValue(paginationState),\n      useSetPagination: () => useSetRecoilState(paginationState),\n      usePaginationState: () => useRecoilState(paginationState),\n      useIsMenuOpen: () => useRecoilValue(isMenuOpenState),\n      useSetIsMenuOpen: () => useSetRecoilState(isMenuOpenState),\n      useIsCollapsed: () => useRecoilValue(isCollapsedState),\n      useSetIsCollapsed: () => useSetRecoilState(isCollapsedState),\n      useIsStatisticsEnabled: () => useRecoilValue(isStatisticsEnabledState),\n      useSetIsStatisticsEnabled: () => useSetRecoilState(isStatisticsEnabledState),\n      useApiQuery: () => useRecoilValue(apiQueryState),\n      useSetApiQuery: () => useSetRecoilState(apiQueryState),\n      useApiData: () => useRecoilValue(apiDataState),\n      useSetApiData: () => useSetRecoilState(apiDataState),\n      useResults,\n      useSetResults: () => useSetRecoilState(resultsState),\n      useResultsUsed: () => useRecoilValue(resultsUsedState),\n      useSetResultsUsed: () => useSetRecoilState(resultsUsedState),\n      useRequired: () => useRecoilValue(requiredState)\n  }\n  }, [\n    resource,\n    contextID,\n    initialQuery,\n    initialFilterData,\n    initialFilterAbbreviations,\n    initialFiltersLocked,\n    initialPagination,\n    dashboard,\n    initialAggs,\n    id,\n    suggestionHistorySize\n  ])\n\n  const setResults = useSetResults()\n  const setApiData = useSetApiData()\n  const setApiQuery = useSetApiQuery()\n  const filters = useFilterNames()\n  const filtersData = useFiltersData()\n  const { filterAbbreviations, filterFullnames } = useFilterMaps()\n  const [pagination, setPagination] = usePaginationState()\n  const updateAggsResponse = useSetAggsResponse()\n  const aggs = useAggs()\n  const query = useQuery()\n  const dynamicQueryModes = useDynamicQueryModes()\n  const filtersLocked = useFiltersLocked()\n  const required = useRequired()\n  const resultsUsed = useResultsUsed()\n\n  /**\n   * This function is used to sync up API calls so that they update the search\n   * context state in the same order as they were originally issued.\n   *\n   * As we cannot guarantee the order in which the API calls finish, we push all\n   * calls into a queue. The queue makes sure that API calls get resolved in the\n   * original order not matter how long the actual call takes.\n   */\n  const resolve = useCallback(prop => {\n    const {response, timestamp, queryChanged, paginationChanged, search, aggsToUpdate, resource, callbackAgg, callbackHits} = prop\n    const data = response.response\n    const next = apiQueue.current[0]\n    if (next !== timestamp) {\n      apiMap.current[timestamp] = prop\n      return\n    }\n    // Update the aggregations if new aggregation data is received. The old\n    // aggregation data is preserved and new information is updated.\n    if (!isEmpty(data.aggregations)) {\n      const newAggs = convertAggAPIToGUI(data.aggregations, aggsToUpdate, resource, filtersData)\n      callbackAgg && callbackAgg(newAggs, undefined, true)\n    } else {\n      callbackAgg && callbackAgg(undefined, undefined, false)\n    }\n    // Update the query results if new data is received.\n    if (queryChanged || paginationChanged) {\n      paginationResponse.current = data.pagination\n      const newResults = {\n        response: response,\n        pagination: combinePagination(search.pagination, data.pagination),\n        setPagination: setPagination\n      }\n      callbackHits && callbackHits(newResults, undefined, true, search)\n    } else {\n      callbackHits && callbackHits(undefined, undefined, false, search)\n    }\n    // Remove this query from queue and see if next can be resolved.\n    apiQueue.current.shift()\n    const nextTimestamp = apiQueue.current[0]\n    const nextResolve = apiMap.current[nextTimestamp]\n    if (nextResolve) {\n      resolve(nextResolve)\n    }\n  }, [setPagination, filtersData])\n\n  /**\n   * Function that preprocesses API call requests and finally performs the\n   * actual API call.\n   *\n   * All of the heavier pre-processing, checking, etc. should be done in this\n   * function, as it is the final one that gets called after the debounce\n   * interval.\n   *\n   * @param {bool} global Whether the api call is made in the global context\n   * that introduces a series of optimizations by keeping track of the previous\n   * queries. Should be false when making API calls that should not affect the\n   * global context, e.g. when just getting hits with a different pagination etc.\n   */\n  const apiCall = useCallback((query, aggs, pagination, required, resultsUsed, queryChanged, paginationChanged, updateAggs, callbackAgg = undefined, callbackHits = undefined, global = true) => {\n    // Gather aggregations that need to be updated (=require and API call), and\n    // the ones that have changed (have changed but do not require an API call).\n    const aggsToUpdate = []\n    const aggsChanged = []\n    for (const [key, agg] of Object.entries(aggs)) {\n      if (agg.update) {\n        aggsToUpdate.push(key)\n      }\n      if (agg.changed) {\n        aggsChanged.push(key)\n      }\n    }\n    const apiQuery = {...query}\n    if (filterDefaults) {\n      for (const [key, value] of Object.entries(filterDefaults)) {\n        if (isNil(query[key])) {\n          apiQuery[key] = value\n        }\n      }\n    }\n\n    // The locked filters are applied as a parallel AND query. This is the only\n    // way to consistently apply them. If we mix them inside 'regular' filters,\n    // they can be accidentally overwritten with an OR statement.\n    const customQuery = convertQueryGUIToAPI(apiQuery, resource, filtersData, dynamicQueryModes)\n    const lockedQuery = convertQueryGUIToAPI(filtersLocked, resource, filtersData, dynamicQueryModes)\n\n    let finalQuery = customQuery\n    if (!isEmpty(lockedQuery)) {\n      finalQuery = {\n        and: [finalQuery, lockedQuery]\n      }\n    }\n\n    // TODO: This is just a temp hack to somehow allow filter queries with ands/ors\n    if (query.custom_quantities) {\n      finalQuery = {\n        and: [finalQuery, query.custom_quantities]\n      }\n    }\n\n    const search = {\n      owner: filtersLocked?.visibility || apiQuery.visibility,\n      query: finalQuery,\n      aggregations: convertAggGUIToAPI(\n        aggs,\n        resource,\n        filtersData\n      ),\n      pagination: convertPaginationGUItoAPI(pagination, filtersData),\n      required: convertRequiredGUItoAPI(required, filtersData)\n    }\n\n    // When aggregations have changed but the query has not, we request only the\n    // aggregation data without any hits. Also if results are not needed, we\n    // don't return them.\n    if ((updateAggs && !queryChanged && !paginationChanged) || !resultsUsed) {\n      search.pagination = {page_size: 0}\n      search.required = { include: [] }\n    }\n\n    // If query changes or the pagination changes without page_after_value\n    // changing, we request the first page. This is a simple way ensure that\n    // results are consistent.\n    if (queryChanged || (paginationChanged && (pagination.page_after_value && pagination.page_after_value === paginationResponse.current.page_after_value))) {\n      search.pagination.page_after_value = undefined\n      search.pagination.next_page_after_value = undefined\n    }\n\n    if (global) {\n      // When the query changes, information about the most recent agg update (no\n      // matter if it causes an API call or not) gets stored. When the query has\n      // not changed, the last agg that caused an actual API call is added to the\n      // existing list. This way previous aggregation data can be re-used.\n      if (queryChanged) {\n        updatedAggsMap.current = Object.fromEntries(aggsChanged.map((key) => [key, aggs[key]]))\n      } else {\n        aggsToUpdate.forEach((key) => { updatedAggsMap.current[key] = aggs[key] })\n      }\n\n      // The list of updated filters are always reset.\n      updatedFilters.current = new Set()\n      firstLoad.current = false\n      oldQuery.current = query\n      oldPagination.current = pagination\n    }\n\n    const timestamp = Date.now()\n    apiQueue.current.push(timestamp)\n    setApiQuery(search?.query)\n    api.query(resource, search, {loadingIndicator: true, returnRequest: true})\n      .then((response) => {\n        return resolve({\n          response,\n          timestamp,\n          queryChanged,\n          paginationChanged,\n          search,\n          aggsToUpdate,\n          resource,\n          callbackAgg,\n          callbackHits\n        })\n      })\n      .catch((error) => {\n        raiseError(error)\n        callbackAgg && callbackAgg(undefined, error, true)\n        callbackHits && callbackHits(undefined, error, true, undefined)\n      })\n  }, [filtersData, filterDefaults, filtersLocked, resource, api, raiseError, resolve, dynamicQueryModes, setApiQuery])\n\n  // This is a debounced version of apiCall.\n  const apiCallDebounced = useMemo(() => debounce(apiCall, debounceTime), [apiCall])\n\n  /**\n   * Intermediate function that should primarily be used when trying to perform\n   * an API call. Ensures that ensures that:\n   * - Calls are debounced when necessary\n   * - API calls are made only if necessary\n   */\n  const apiCallInterMediate = useCallback((query, aggs, pagination, required, resultsUsed = true, callbackAgg = undefined, callbackHits = undefined, forceUpdate = false, global = true) => {\n    if (disableUpdate.current) {\n      disableUpdate.current = false\n      return\n    }\n\n    // Determine which parts need to be updated. Due to the queueing mechanism\n    // we can instantly update the reference to contain the latest information\n    // about what will be updated by this query. This ensures that the next query\n    // immediately knows the current state even before the API call is finished\n    // (or even if no API call is made).\n    const queryChanged = forceUpdate ? true : query !== oldQuery.current\n    const paginationChanged = pagination !== oldPagination.current\n    const [reducedAggs, updateAggs] = reduceAggs(\n      aggs,\n      updatedAggsMap.current,\n      queryChanged,\n      updatedFilters.current,\n      filtersData\n    )\n\n    // If results are needed and query and pagination have not changed and\n    // aggregations do not need to be updated, no update is necessary. The API\n    // calls is made immediately when requesting the first set of results, when\n    // the pagination changes or when only aggregations need to be updated.\n    // Otherwise it is debounced.\n    if ((resultsUsed && (paginationChanged || queryChanged)) || updateAggs) {\n      if (firstLoad.current || paginationChanged || !queryChanged) {\n        apiCall(query, reducedAggs, pagination, required, resultsUsed, queryChanged, paginationChanged, updateAggs, callbackAgg, callbackHits, global)\n      } else {\n        apiCallDebounced(query, reducedAggs, pagination, required, resultsUsed, queryChanged, paginationChanged, updateAggs, callbackAgg, callbackHits, global)\n      }\n    } else {\n      callbackAgg && callbackAgg(undefined, undefined, false)\n      callbackHits && callbackHits(undefined, undefined, false, undefined)\n    }\n  }, [apiCall, apiCallDebounced, filtersData])\n\n  // When query, aggregation or pagination changes, update the search context\n  useEffect(() => {\n    apiCallInterMediate(\n      query,\n      aggs,\n      pagination,\n      required,\n      resultsUsed,\n      (data, error, update) => (update && !error) && updateAggsResponse(data),\n      (results, error, update, search) => {\n        if (error || !update) return\n        setApiData(results.response)\n        const data = results.response.response\n        const extend = search?.pagination?.page_after_value\n        setResults(old => {\n          const newResults = old ? {...old} : {}\n          extend ? newResults.data = [...newResults.data, ...data.data] : newResults.data = data.data\n          newResults.pagination = combinePagination(search.pagination, data.pagination)\n          newResults.setPagination = setPagination\n          return newResults\n        })\n      },\n      false,\n      true\n    )\n  }, [query, aggs, pagination, required, resultsUsed, apiCallInterMediate, updateAggsResponse, setPagination, setResults, setApiData])\n\n  // The context contains a set of functions that can be used to hook into\n  // different data.\n  const values = useMemo(() => {\n    // Hook for refreshing the results.\n    const useRefresh = () => {\n      const query = useQuery()\n      const aggs = useAggs()\n      const pagination = usePagination()\n      const required = useRequired()\n      const resultsUsed = useResultsUsed()\n\n      const refresh = useCallback(() => {\n        apiCallInterMediate(\n          query,\n          aggs,\n          pagination,\n          required,\n          resultsUsed,\n          (data, error, update) => (update && !error) && updateAggsResponse(data),\n          (results, error, update, search) => {\n            if (error || !update) return\n            setApiData(results.response)\n            const data = results.response.response\n            const extend = search?.pagination?.page_after_value\n            setResults(old => {\n              const newResults = old ? {...old} : {}\n              extend ? newResults.data = [...newResults.data, ...data.data] : newResults.data = data.data\n              newResults.pagination = combinePagination(search.pagination, data.pagination)\n              newResults.setPagination = setPagination\n              return newResults\n            })\n          },\n          true,\n          true\n        )\n      }, [aggs, pagination, required, query, resultsUsed])\n      return refresh\n    }\n\n    // Hook for imperatively requesting aggregation data. By using this hook you\n    // can track the state of individual calls and perform callbacks.\n    const useAggCall = (name, id) => {\n      const key = useMemo(() => `${name}:${id}`, [name, id])\n      const query = useQuery()\n      const pagination = usePagination()\n      const required = useRequired()\n      const resultsUsed = useResultsUsed()\n      const setAgg = useSetRecoilState(aggsFamily(key))\n\n      /**\n       * @param {number} size The new aggregation size\n       * @param {string} id Identifier for this call\n       * @param {function} callback: Function that returns an array containing the\n       * new aggregation response and an error if one was encountered. Returns the\n       * special value 'undefined' for the response if no update was necessary.\n       */\n      const aggCall = useCallback((config, callback) => {\n        const aggs = {[key]: {...config, update: true}}\n        apiCallInterMediate(\n          query,\n          aggs,\n          pagination,\n          required,\n          resultsUsed,\n          (response, error, update) => {\n            if (update && !error) {\n              updateAggsResponse(response)\n            }\n            callback(response && response[key], error, update)\n          },\n          undefined,\n          false,\n          true\n        )\n\n        // We also need to update aggregation request state, otherwise the\n        // subsequent calls will not be able to know what was done by this call.\n        // To do this without triggering another API call, we disable API updates\n        // for one cycle.\n        disableUpdate.current = true\n        aggs[key].update = false\n        setAgg(aggs[key])\n      }, [key, query, pagination, required, resultsUsed, setAgg])\n\n      return aggCall\n    }\n\n    /**\n     * Hook for fetching an independent set of hits based on the currently set\n     * filters.\n     *\n     * @param {string} id Unique identified for this set of hits\n     * @param {object} required The required field of the API call\n     * @param {object} pagination The API pagination\n     *\n     * @returns {Array} Array of hit objects.\n     */\n    const useHits = (id = 'default', required, pagination, callback) => {\n      const [results, setResults] = useState()\n      const query = useQuery()\n      const apiCallDebounced = useMemo(() => debounce(apiCall, debounceTime), [])\n\n      // Update hits when query, includes, excludes or pagination change.\n      useEffect(() => {\n        apiCallDebounced(\n          query,\n          {},\n          convertPaginationGUItoAPI(pagination, filtersData),\n          convertRequiredGUItoAPI(required, filtersData),\n          true,\n          true,\n          true,\n          false,\n          undefined,\n          (results, error, update) => {\n            if (!error && update) {\n              const data = results.response.response\n              update && !error && setResults(data?.data)\n            }\n            callback(results, error, update)\n          },\n          false\n        )\n      }, [query, required, pagination, apiCallDebounced, callback])\n\n      return results\n    }\n\n    /**\n     * Hook that can be used to fetch search suggestions stored in the local\n     * device.\n     * */\n    const useSearchSuggestions = (input, size = 5) => {\n      const suggestions = useSearchSuggestionsValue()\n      const suggestionFilter = useMemo(() => {\n        const sugg = getSuggestions(suggestions, 0, suggestion => suggestion.input)\n        return sugg.filter\n      }, [suggestions])\n\n      return input.trim() === ''\n        ? suggestions.slice(0, size)\n        : suggestionFilter(input).slice(0, size)\n    }\n\n    /**\n     * Hook for pushing new suggestion values to the search context. New values\n     * are pushed to the top of the list, and if the suggestion already exists,\n     * it is simply pulled to the top.\n     * */\n    const usePushSearchSuggestion = () => {\n      const setSuggestions = useSetSearchSuggestions()\n      return useCallback((suggestion) => {\n        setSuggestions(old => {\n          let newSuggestions = old.filter(x => x.key !== suggestion.key)\n          const newSuggestion = new SearchSuggestion(suggestion)\n          newSuggestion.history = true\n          newSuggestions = [newSuggestion, ...old].slice(0, suggestionHistorySize)\n          return newSuggestions\n        })\n      }, [setSuggestions])\n    }\n\n    /**\n     * Hook for deleting specific suggestion values from the search context\n     * using the suggestion key.\n     * */\n    const useRemoveSearchSuggestion = () => {\n      const setSuggestions = useSetSearchSuggestions()\n      return useCallback((key) => {\n        setSuggestions(old => {\n          const newSuggestions = [...old].filter(x => x.key !== key)\n          return newSuggestions\n        })\n      }, [setSuggestions])\n    }\n\n    /**\n     * Hook that returns a function for parsing a single filter key, value pair\n     * into a form that is supported by the GUI. The parsing depends on the\n     * SearchContext as filters may define a custom deserialization function and\n     * only certain filters may be available.\n     * */\n    const useParseQuery = () => {\n      return useCallback(\n        (key, value, path, multiple) => parseQuery(key, value, filtersData, units, path, multiple),\n        []\n      )\n    }\n    /**\n     * Hook that returns a function for parsing an object containing filter\n     * values into a form that is supported by the GUI. The parsing depends on\n     * the SearchContext as filters may define a custom deserialization function\n     * and only certain filters may be available.\n     * */\n    const useParseQueries = () => {\n      return useCallback(\n        (values) => parseQueries(values, filtersData, filterFullnames),\n        []\n      )\n    }\n\n    return {\n      resource,\n      columns,\n      rows,\n      filterMenus,\n      filters,\n      filterData: filtersData,\n      filterGroups: initialFilterGroups,\n      filterFullnames,\n      filterAbbreviations,\n      searchSyntaxes: initialSearchSyntaxes,\n      useIsMenuOpen,\n      useSetIsMenuOpen,\n      useIsCollapsed,\n      useSetIsCollapsed,\n      useIsStatisticsEnabled,\n      useSetIsStatisticsEnabled,\n      useApiData,\n      useApiQuery,\n      useQuery,\n      useSetPagination,\n      useParseQuery,\n      useParseQueries,\n      useSearchSuggestions,\n      usePushSearchSuggestion,\n      useRemoveSearchSuggestion,\n      useFilterValue,\n      useSetFilter,\n      useFilterState,\n      useFilters,\n      useResetFilters,\n      useRefresh,\n      useFilterLocked,\n      useFiltersLocked,\n      useFiltersLockedState,\n      useWidgetValue,\n      useSetWidget,\n      useWidgetState,\n      useWidgetsValue,\n      useWidgetsState,\n      useAddWidget,\n      useRemoveWidget,\n      useResetWidgets,\n      useQueryString,\n      useResults,\n      useHits,\n      useAgg,\n      useAggCall,\n      useSetFilters,\n      useUpdateFilter\n    }\n  }, [\n    resource,\n    rows,\n    columns,\n    filterMenus,\n    filters,\n    filtersData,\n    initialFilterGroups,\n    filterFullnames,\n    filterAbbreviations,\n    initialSearchSyntaxes,\n    useIsMenuOpen,\n    useSetIsMenuOpen,\n    useIsCollapsed,\n    useSetIsCollapsed,\n    useIsStatisticsEnabled,\n    useSetIsStatisticsEnabled,\n    useFilterValue,\n    useSetFilter,\n    useFilterState,\n    useFilters,\n    useResetFilters,\n    useFilterLocked,\n    useFiltersLocked,\n    useFiltersLockedState,\n    useWidgetValue,\n    useSetWidget,\n    useWidgetState,\n    useWidgetsValue,\n    useWidgetsState,\n    useAddWidget,\n    useRemoveWidget,\n    useResetWidgets,\n    useQueryString,\n    usePagination,\n    useSetPagination,\n    useResults,\n    useResultsUsed,\n    useRequired,\n    useApiQuery,\n    useApiData,\n    useAgg,\n    useAggs,\n    useQuery,\n    useSetFilters,\n    useUpdateFilter,\n    apiCallInterMediate,\n    apiCall,\n    aggsFamily,\n    updateAggsResponse,\n    setPagination,\n    setResults,\n    setApiData,\n    units,\n    suggestionHistorySize,\n    useSearchSuggestionsValue,\n    useSetSearchSuggestions\n  ])\n\n  return <searchContext.Provider value={values}>\n    {children}\n  </searchContext.Provider>\n})\n\nSearchContextRaw.propTypes = {\n  resource: PropTypes.string,\n  initialFiltersLocked: PropTypes.object,\n  initialColumns: PropTypes.object,\n  initialRows: PropTypes.object,\n  initialFilterMenus: PropTypes.object,\n  initialPagination: PropTypes.object,\n  initialDashboard: PropTypes.object,\n  initialFilterData: PropTypes.object, // Determines which filters are available\n  initialFilterGroups: PropTypes.object, // Maps filter groups to a set of filter names\n  initialFilterValues: PropTypes.object, // Here one can provide default filter values\n  initialSearchSyntaxes: PropTypes.object, // Determines which syntaxes are supported\n  children: PropTypes.node,\n  id: PropTypes.string,\n  suggestionHistorySize: PropTypes.number\n}\n\nSearchContextRaw.defaultProps = {\n  suggestionHistorySize: 20\n}\n\nexport const FreeformSearchContext = withFilters(SearchContextRaw)\nexport const SearchContext = compose(withQueryString, withFilters)(SearchContextRaw)\n\n/**\n * Hook for accessing the current SearchContext.\n */\nexport function useSearchContext() {\n  return useContext(searchContext)\n}\n\n/**\n * Parses a single filter value into a form that is supported by the GUI. This includes:\n * - Arrays are are transformed into Sets\n * - If multiple values are supported, scalar values are stored inside sets.\n * - Numerical values with units are transformed into Quantities.\n * - Custom serialization defined for the filter will be used if defined.\n *\n * @param {string} key Name of the filter or an operator name.\n * @param {any} value Value of the filter or operator\n * @param {object} filtersData All of the filters that are available\n * @param {object} units Unit system for unit conversion\n * @param {string} path The full path for the filter without an operator name.\n *\n * @returns {any} The filter value in a format that is suitable for the GUI.\n */\nfunction parseQuery(key, value, filtersData, units = undefined, path = undefined, multiple = undefined) {\n  let newValue\n  const fullPath = path ? `${path}.${key}` : key\n  if (isPlainObject(value)) {\n    newValue = {}\n    for (const [keyInner, valueInner] of Object.entries(value)) {\n      const valueConverted = parseQuery(keyInner, valueInner, filtersData, units, fullPath)\n      if (!isNil(valueConverted)) {\n        newValue[keyInner] = valueConverted\n      }\n    }\n  } else {\n    // If the key is an operator, the filter name is read from the path.\n    const opKeys = new Set(['lte', 'lt', 'gte', 'gt'])\n    const isOperator = opKeys.has(key)\n    const filterPath = isOperator ? path : fullPath\n    multiple = multiple ?? filtersData[filterPath].multiple\n    const deserializer = filtersData[filterPath].deserializer\n    if (isArray(value) || isSet(value)) {\n      newValue = new Set(value.map((v) => deserializer(v, units)))\n    } else {\n      newValue = deserializer(value, units)\n      if (!isOperator && multiple) {\n        newValue = new Set([newValue])\n      }\n    }\n  }\n  return newValue\n}\n\n/**\n * Cleans an entire query object into a form that is supported by the GUI. This\n * includes:\n * - Arrays are are transformed into Sets\n * - If multiple values are supported, scalar values are stored inside sets.\n * - Numerical values with units are transformed into Quantities.\n *\n * @param {object} query Query object to transform.\n * @param {object} filtersData All of the filters that are available\n * @param {object} units The desired unit system used when reading quantities.\n *\n * @returns {any} The filter object in a format that is suitable for the GUI.\n */\nfunction parseQueries(query, filtersData, filterFullnames, units = undefined) {\n  const newQuery = {}\n  if (query) {\n    for (const [key, value] of Object.entries(query)) {\n      const newKey = filterFullnames[key] || key\n      const valueGUI = parseQuery(newKey, value, filtersData, units)\n      newQuery[newKey] = valueGUI\n    }\n  }\n  return newQuery\n}\n\n/**\n * Converts a query object into a valid query string.\n *\n * @param {object} query Query object representing the currently active\n * filters in a search context.\n * @param {object} filtersData All of the filters that are available\n * @returns URL querystring, not encoded to improve readability.\n */\nfunction convertQueryGUIToQS(query, filtersData, filterAbbreviations) {\n  // Used to recursively convert the query into a serializable format.\n  function convert(key, value, path) {\n    // If the key is an operator, the filter name is read from the path.\n    const opKeys = new Set(['lte', 'lt', 'gte', 'gt'])\n    const fullPath = path ? `${path}.${key}` : key\n    const filterPath = opKeys.has(key) ? path : fullPath\n    const filterData = filtersData[filterPath]\n    let newValue\n    if (isPlainObject(value) && !filterData.customSerialization) {\n      newValue = {}\n      for (const [keyInner, valueInner] of Object.entries(value)) {\n        const valueConverted = convert(\n          keyInner,\n          valueInner,\n          path ? fullPath : key\n        )\n        newValue[keyInner] = valueConverted\n      }\n    } else {\n      const serializer = filterData.serializerExact\n      if (isArray(value)) {\n        newValue = value.map(serializer)\n      } else if (value instanceof Set) {\n        newValue = [...value].map(serializer)\n      } else {\n        newValue = serializer(value)\n      }\n    }\n    return newValue\n  }\n\n  // The query is serialized first: locked items will not be displayed in the\n  // URL\n  const queryStringQuery = {}\n  if (query) {\n    for (const [key, value] of Object.entries(query)) {\n      const valueConverted = convert(key, value)\n      if (!isNil(valueConverted)) {\n        queryStringQuery[key] = valueConverted\n      }\n    }\n  }\n\n  return qs.stringify(queryStringQuery, {indices: false, encode: false})\n}\n\n/**\n * Converts the contents of a query into a format that is suitable for the API.\n *\n * Should only be called when making the final API call, as during the\n * construction of the query it is much more convenient to store filters within\n * e.g. Sets.\n *\n * @param {number} query The query object.\n * @param {string} resource The resource we are looking at: entries or materials.\n * @param {object} filtersData All of the filters that are available\n * @param {object} queryModes Query modes for filters\n *\n * @returns {object} A copy of the object with certain items cleaned into a\n * format that is supported by the API.\n */\nfunction convertQueryGUIToAPI(query, resource, filtersData, queryModes) {\n  const queryCustomized = {}\n  if (!query) {\n    return undefined\n  }\n\n  // Perform custom transformations. Note that these calls may add new keys to\n  // the query.\n  function customize(key, value, parent, subKey = undefined) {\n    const data = filtersData[key]\n\n    // Global filters are not serialized into the API call.\n    if (data?.global) return\n\n    // Sections need to be recursively handled. Notice that we can't directly\n    // write to an recoil Atom and create a new object for storing the values.\n    const section = data?.section\n    if (section) {\n      const sectionData = {}\n      for (const [keyNested, valueNested] of Object.entries(value)) {\n        customize(`${key}.${keyNested}`, valueNested, sectionData, keyNested)\n      }\n      parent[key] = sectionData\n    // Regular values are set directly to the parent. A custom setter may be\n    // used.\n    } else {\n      const setter = data?.value?.set\n      if (setter) {\n        setter(queryCustomized, query, value)\n      } else {\n        parent[subKey || key] = value\n      }\n    }\n  }\n  for (const [k, v] of Object.entries(query)) {\n    if (!isNil(v)) {\n      customize(k, v, queryCustomized)\n    }\n  }\n\n  // Create the API-compatible keys and values.\n  const queryNormalized = {}\n  for (const [k, v] of Object.entries(queryCustomized)) {\n    const {quantity: filterName, op: queryMode} = parseOperator(k)\n    let finalKey = filtersData[filterName]?.requestQuantity || filterName\n    const newValue = convertQuerySingleGUIToAPI(v, filterName, filtersData)\n    finalKey = resource === 'materials' ? getFilterMaterialPath(finalKey) : finalKey\n    let finalQueryMode = queryMode || queryModes?.[k]\n    if (isNil(finalQueryMode) && isArray(newValue)) {\n      finalQueryMode = filtersData[k]?.queryMode\n    }\n    finalKey = finalQueryMode ? `${finalKey}:${finalQueryMode}` : finalKey\n    queryNormalized[finalKey] = newValue\n  }\n\n  if (resource === 'materials') {\n    // When combining results, we split each filter and each filter value into\n    // it's own separate entries query. These queries are then joined with\n    // 'and'.\n    const combine = query.combine\n    if (combine) {\n      const entrySearch = []\n      for (const [k, v] of Object.entries(queryNormalized)) {\n        if (k.startsWith('entries.')) {\n          const {quantity: newKey, op: queryMode} = parseOperator(k)\n          // When the queryMode is 'all', each value can come from a separate\n          // entry.\n          if (isArray(v) && queryMode === 'all') {\n            for (const item of v) {\n              entrySearch.push({[newKey]: item})\n            }\n          } else {\n            entrySearch.push({[k]: v})\n          }\n          delete queryNormalized[k]\n        }\n      }\n      if (entrySearch.length > 0) {\n        queryNormalized.and = entrySearch\n      }\n    // When combining results is not allowed, we simply make a nested query by\n    // moving all method/properties filters inside a single entries-subsection.\n    } else {\n      const entrySearch = {}\n      for (const [k, v] of Object.entries(queryNormalized)) {\n        if (k.startsWith('entries.')) {\n          const name = k.split('entries.').pop()\n          entrySearch[name] = v\n          delete queryNormalized[k]\n        }\n      }\n      if (!isEmpty(entrySearch)) {\n        queryNormalized.entries = entrySearch\n      }\n    }\n  }\n\n  return queryNormalized\n}\n\n/**\n * Cleans a single filter value into a form that is supported by the API. This includes:\n * - Sets are transformed into Arrays\n * - Quantities are converted to storage unit values\n * - Empty containers are set to undefined\n *\n * @param {any} value Filter value\n * @param {Filter} filter Filter object\n *\n * @returns {any} The filter value in a format that is suitable for the API.\n */\nfunction convertQuerySingleGUIToAPI(value, name, filterData) {\n  const unit = filterData[name]?.unit || 'dimensionless'\n  const convertItem = (item) => item instanceof Quantity ? item.to(unit).value() : item\n\n  if (value instanceof Set) {\n    const newValue = Array.from(value).map(convertItem)\n    return newValue.length ? newValue : undefined\n  }\n\n  if (value instanceof Quantity) {\n    return value.to(unit).value()\n  }\n\n  if (isArray(value)) {\n    const newValue = value.map(convertItem)\n    return newValue.length ? newValue : undefined\n  }\n\n  if (isPlainObject(value)) {\n    const newValue = Object.entries(value).reduce((acc, [key, val]) => {\n      const filterName = isPlainObject(val) ? `${name}.${key}` : name\n      const apiValue = convertQuerySingleGUIToAPI(val, filterName, filterData)\n      if (!isNil(apiValue)) acc[key] = apiValue\n      return acc\n    }, {})\n\n    return isEmpty(newValue) ? undefined : newValue\n  }\n\n  return value\n}\n\n/**\n * Used to transform a GUI aggregation query into a form that is usable by the\n * API.\n *\n * @param {object} aggs The aggregation data as constructed by the GUI.\n * @param {object} updatedFilters Set of filters that were updated together with\n * this call.\n * @param {string} resource The resource we are looking at: entries or materials.\n * @param {object} filtersData All of the filters that are available\n *\n * @returns {object} Aggregation query that is usable by the API.\n */\nfunction convertAggGUIToAPI(aggs, resource, filtersData) {\n  const apiAggs = {}\n  for (const [key, agg] of Object.entries(aggs)) {\n    const filterName = rsplit(key, ':', 1)[0]\n    if (agg.update) {\n      const exclusive = filtersData[filterName].exclusive\n      const type = agg.type\n      const apiAgg = apiAggs[key] || {}\n      const aggSet = agg.set\n      const finalAgg = aggSet ? aggSet(agg) : agg\n      let finalQuantity = finalAgg.quantity || filterName\n\n      // If the targeted quantity has a special requestQuantity, it is used in\n      // the final API call.\n      finalQuantity = filtersData[finalQuantity]?.requestQuantity || finalQuantity\n\n      // The targeted quantity is decided based on the resource as materials\n      // search need to target slightly different fields.\n      finalQuantity = resource === 'materials'\n        ? getFilterMaterialPath(finalQuantity)\n        : finalQuantity\n\n      apiAgg[type] = {\n        // Exclusive quantities (quantities that have one value per entry) are\n        // always fetched with exclude_from_search\n        exclude_from_search: exclusive,\n        ...finalAgg,\n        quantity: finalQuantity\n      }\n      apiAggs[key] = apiAgg\n    }\n  }\n  return apiAggs\n}\n\n/**\n * Used to transform an API aggregation result into a form that is usable by the\n * GUI.\n *\n * @param {object} aggs The aggregation data as returned by the API.\n * @param {array} aggsToUpdate The set of targeted filters. Needed because the keys\n * in the aggs dictionary may be different due to custom aggregation set/get.\n * @param {object} filtersData All of the filters that are available\n *\n * @returns {object} Aggregation result that is usable by the GUI.\n */\nfunction convertAggAPIToGUI(aggs, aggsToUpdate, filtersData) {\n  if (isEmpty(aggs)) {\n    return {}\n  }\n\n  // Perform custom transformations\n  const aggsCustomized = {}\n  for (const key of aggsToUpdate) {\n    const filter_name = rsplit(key, ':', 1)[0]\n    const aggConfig = aggs[key]\n    if (!isNil(aggConfig)) {\n      for (const [type, agg] of Object.entries(aggConfig)) {\n        const aggGet = filtersData[filter_name]?.aggs?.[type]?.get\n        const aggFinal = aggGet ? aggGet(agg) : agg\n        // Add flag for if all terms have been returned, and the total number of\n        // items. TODO: Could this total be given by the API directly?\n        if (type === 'terms') {\n          aggFinal.exhausted = aggFinal.size > aggFinal.data.length\n          aggFinal.total = aggFinal.data.reduce((a, b) => a + b.count, 0)\n        }\n        aggsCustomized[key] = aggFinal\n      }\n    }\n  }\n  return aggsCustomized\n}\n\n/**\n * Used to transform a GUI pagination call result into a form that is usable by the\n * API.\n *\n * @param {object} pagination The aggregation data as returned by the API.\n * @param {object} filtersData All of the filters that are available\n *\n * @returns {object} Pagination object that is usable by the API.\n */\nfunction convertPaginationGUItoAPI(pagination, filtersData) {\n  if (!pagination) return {}\n  return {\n    ...pagination,\n    order_by: filtersData[pagination.order_by]?.requestQuantity || pagination.order_by\n  }\n}\n\n/**\n * Used to transform a GUI pagination call result into a form that is usable by the\n * API.\n *\n * @param {object} pagination The aggregation data as returned by the API.\n * @param {object} filtersData All of the filters that are available\n *\n * @returns {object} Pagination object that is usable by the API.\n */\nfunction convertRequiredGUItoAPI(required, filtersData) {\n  if (!required) return {}\n  return {\n    ...required,\n    include: required.include?.map(name => filtersData[name]?.requestQuantity || name),\n    exclude: required.exclude?.map(name => filtersData[name]?.requestQuantity || name)\n  }\n}\n\n/**\n * Goes through the given aggregations and compares then against the old results\n * and the current query to identify and return the aggregations that need to be\n * called.\n *\n * @param {object} aggs The current aggregation configuration.\n * @param {object} oldAggs Reduced aggregation config from latest finished query.\n * @param {bool} queryChanged Whether the query has changed.\n * @param {object} filtersData All of the filters that are available\n *\n * @returns {object} Reduced aggregation config.\n */\nfunction reduceAggs(aggs, oldAggs, queryChanged, updatedFilters, filtersData) {\n  // Loop through the different aggregations for each quantity and see if any\n  // of them need to be updated.\n  const reducedAggs = {}\n  let updateAggs = false\n  for (const [key, agg] of Object.entries(aggs)) {\n    const filter_name = rsplit(key, ':', 1)[0]\n    if (!isBoolean(agg.update)) {\n      throw Error(`It was not specified whether the aggregation ${key} should update or not.`)\n    }\n    let update = agg.update\n    let changed = agg.update\n\n    // If the old aggregation data is a superset of the newly queried\n    // aggregation data, and the query has not changed, there is no need to\n    // update.\n    const oldAgg = oldAggs?.[key]\n    if (update && !queryChanged && oldAgg) {\n      const aggParams = {...agg}\n      const aggParamsOld = {...oldAgg}\n      delete aggParams.changed\n      delete aggParams.update\n      delete aggParamsOld.changed\n      delete aggParamsOld.update\n      if (isEqual(aggParams, aggParamsOld)) {\n        update = false\n        changed = false\n      } else if (!isNil(agg.size)) {\n        delete aggParams.size\n        delete aggParamsOld.size\n        if (isEqual(aggParams, aggParamsOld) && oldAgg.size >= agg.size) {\n          update = false\n        }\n      }\n    }\n\n    // If the filter is exclusive, and ONLY it has been modified in this\n    // query, we do not update it's aggregation.\n    const exclude = isNil(agg.exclude_from_search)\n      ? filtersData[filter_name].exclusive\n      : agg.exclude_from_search\n    if (exclude && updatedFilters.has(filter_name) && updatedFilters.size === 1) {\n      update = false\n    }\n\n    // Create the new reduced version\n    const newAgg = {...agg, update, changed}\n    if (update) {\n      updateAggs = true\n    }\n    reducedAggs[key] = newAgg\n  }\n  return [reducedAggs, updateAggs]\n}\n\n/**\n * Returns the final value that should be shown for the given filter.\n *\n * @param {*} def The quantity definition\n * @param {*} filter The current filter value in the search context\n * @param {*} filterLocked The current locked filter value in the search context\n * @param {*} initialValue Initial value that overrides any default specified in\n *   the FilterRegistry\n *\n * @returns The final value for the filter.\n */\nexport function getValue(def, filter, filterLocked, initialValue) {\n  const defaultValue = isNil(initialValue) ? def.default : initialValue\n  const val = (def.global && !isNil(filterLocked)) ? filterLocked : filter\n  return isNil(val) ? defaultValue : val\n}\n\n/**\n * Used to turn empty containers into undefined which is used to indicate that a\n * search filter has not been specified.\n */\nfunction clearEmpty(value) {\n  function isEmpty(value) {\n    if (isPlainObject(value)) {\n      return Object.values(value).every(isEmpty)\n    } else if ((isSet(value) || isArray(value)) && size(value) === 0) {\n      return true\n    }\n    return false\n  }\n  return isEmpty(value) ? undefined : value\n}\n\n/**\n * Returns a mapping from full filter names to their abbreviations\n * and vice-versa.\n*/\nfunction getAbbreviations(filterData) {\n  const abbreviations = {}\n  const filterAbbreviations = {}\n  const filterFullnames = {}\n  const nameAbbreviationPairs = Object.keys(filterData).map(\n    fullname => {\n      const {path, schema} = parseQuantityName(fullname)\n      return [fullname, schema ? path : path.split('.').pop()]\n    }\n  )\n  for (const [fullname, abbreviation] of nameAbbreviationPairs) {\n    const old = abbreviations[abbreviation]\n    if (old === undefined) {\n      abbreviations[abbreviation] = 1\n    } else {\n      abbreviations[abbreviation] += 1\n    }\n    filterAbbreviations[fullname] = fullname\n    filterFullnames[fullname] = fullname\n  }\n  for (const [fullname, abbreviation] of nameAbbreviationPairs) {\n    if (abbreviations[abbreviation] === 1) {\n      filterAbbreviations[fullname] = abbreviation\n      filterFullnames[abbreviation] = fullname\n    }\n  }\n  return {filterAbbreviations, filterFullnames}\n}\n\n/**\n * Function that is used to automatically convert paths that target the correct\n * property in the materials index.\n * @param {string} path Path in the entry index\n * @returns The correct path in the materials index\n */\nfunction getFilterMaterialPath(path) {\n  const prefix = 'results.material.'\n  let materialPath\n  if (path.startsWith(prefix)) {\n    materialPath = path.substring(prefix.length)\n  } else {\n    materialPath = `entries.${path}`\n  }\n  return materialPath\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useMemo } from 'react'\nimport { isArray } from 'lodash'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\nimport { Skeleton } from '@material-ui/lab'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\n\n/**\n * Component that is used as a placeholder while loading data. Implemented as a\n * simple wrapper around the MUI Skeleton component.\n *\n * Override the 'placeholder' CSS-class to control the size of the placeholder\n * with respect to the root component.\n */\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    width: '100%',\n    height: '100%',\n    position: 'relative'\n  },\n  skeleton: {\n    width: '100%',\n    height: '100%'\n  }\n}))\nconst Placeholder = React.memo(({\n  className,\n  classes,\n  'data-testid':\n  testID,\n  margin\n}) => {\n  const styles = useStyles({classes: classes})\n  const theme = useTheme()\n  const margins = useMemo(() => {\n    let marginTop, marginRight, marginBottom, marginLeft\n    if (isArray(margin)) {\n      marginTop = margin[0]\n      marginRight = margin[1]\n      marginBottom = margin[2]\n      marginLeft = margin[3]\n    } else {\n      marginTop = margin\n      marginRight = margin\n      marginBottom = margin\n      marginLeft = margin\n    }\n    return {\n      position: 'absolute',\n      top: theme.spacing(marginTop),\n      left: theme.spacing(marginLeft),\n      right: theme.spacing(marginRight),\n      bottom: theme.spacing(marginBottom)\n    }\n  }, [theme, margin])\n\n  return <div className={clsx(className, styles.root)} data-testid={testID}>\n    <div style={margins}>\n      <Skeleton variant='rect' className={styles.skeleton}/>\n    </div>\n  </div>\n})\n\nPlaceholder.propTypes = {\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  /**\n   * Margin with respect to the parent in theme spacing units.\n   */\n  margin: PropTypes.oneOfType([PropTypes.number, PropTypes.arrayOf(PropTypes.number)]),\n  'data-testid': PropTypes.string\n}\n\nPlaceholder.defaultProps = {\n  margin: [0, 1, 0, 1]\n}\n\nexport default Placeholder\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useCallback, useState, useMemo, useRef, useEffect } from 'react'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\nimport { CircularProgress, Tooltip, IconButton, TextField } from '@material-ui/core'\nimport Autocomplete from '@material-ui/lab/Autocomplete'\nimport ArrowDropDownIcon from '@material-ui/icons/ArrowDropDown'\nimport CloseIcon from '@material-ui/icons/Close'\nimport { isNil } from 'lodash'\nimport { useSearchContext } from '../SearchContext'\nimport { useSuggestions } from '../../../hooks'\nimport { searchQuantities } from '../../../config'\nimport Placeholder from '../../visualization/Placeholder'\n\n/*\n * Low-level representational component for all text fields used in the search.\n */\nconst useInputTextFieldStyles = makeStyles(theme => ({\n  root: {\n    height: '3rem'\n  }\n}))\nexport const InputTextField = React.memo((props) => {\n  const initialLabel = useState(props.label)[0]\n  const styles = useInputTextFieldStyles({classes: props.classes})\n\n  return props.loading\n    ? <Placeholder className={clsx(props.className, styles.root)} />\n    : <TextField size=\"small\" variant=\"filled\" {...props} hiddenLabel={!initialLabel}/>\n})\n\nInputTextField.propTypes = {\n  label: PropTypes.string,\n  loading: PropTypes.bool,\n  className: PropTypes.string,\n  classes: PropTypes.object\n}\n\n/*\n * Customized version of Autocomplete with custom NOMAD styling and behaviour.\n *\n * Defines default behaviour for user input such as clearing inputs when\n * pressing esc and submitting values when pressing enter. Can also display\n * customizable list of suggestions.\n */\nconst useInputTextStyles = makeStyles(theme => ({\n  root: {\n    width: '100%',\n    display: 'flex',\n    alignItems: 'flex-start',\n    justifyContent: 'center',\n    flexDirection: 'column',\n    boxSizing: 'border-box'\n  },\n  popupIndicatorOpen: {\n    transform: 'rotate(180deg)'\n  },\n  adornmentList: {\n    display: 'flex',\n    alignItems: 'center'\n  },\n  adornment: {\n    padding: '3px'\n  },\n  listbox: {\n    boxSizing: 'border-box',\n    '& ul': {\n      padding: 0,\n      margin: 0\n    }\n  },\n  option: {\n    paddingTop: 0,\n    paddingBottom: 0\n  }\n}))\nexport const InputText = React.memo(({\n  value,\n  error,\n  shrink,\n  suggestions,\n  loading,\n  onChange,\n  onAccept,\n  onSelect,\n  onHighlight,\n  onBlur,\n  onFocus,\n  onError,\n  getOptionLabel,\n  groupBy,\n  renderOption,\n  renderGroup,\n  suggestAllOnFocus,\n  showOpenSuggestions,\n  autoHighlight,\n  ListboxComponent,\n  filterOptions,\n  className,\n  classes,\n  TextFieldProps,\n  InputProps,\n  PaperComponent,\n  disableClearable,\n  disableAcceptOnBlur,\n  validate,\n  disableValidateOnSelect\n}) => {\n  const theme = useTheme()\n  const styles = useInputTextStyles({classes: classes, theme: theme})\n  const [open, setOpen] = useState(false)\n  const [suggestAll, setSuggestAll] = useState(false)\n  const disabled = TextFieldProps?.disabled\n  // The highlighted item is stored in a ref to keep the component more\n  // responsive during browsing the suggestions\n  const highlightRef = useRef(null)\n\n  // Clears the input value and closes suggestions list\n  const clearInputValue = useCallback(() => {\n    onError?.(undefined)\n    onChange?.(\"\")\n    setOpen(false)\n  }, [onChange, onError])\n\n  const handleAccept = useCallback((value) => {\n    const {valid, error, data} = validate ? validate(value) : {valid: true, error: undefined, data: undefined}\n    if (valid) {\n      onAccept?.(value && value.trim(), data)\n    } else {\n      onError?.(error)\n    }\n  }, [onAccept, validate, onError])\n\n  // Validate the initial value if it is non-empty.\n  useEffect(() => {\n    if (!(isNil(value) || value?.trim?.() === '')) {\n      handleAccept(value)\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [])\n\n  const handleSelect = useCallback((value) => {\n    if (disableValidateOnSelect) {\n      onSelect?.(value && value.trim())\n    } else {\n      const {valid, error, data} = validate ? validate(value) : {valid: true, error: undefined, data: undefined}\n      if (valid) {\n        onSelect?.(value && value.trim(), data)\n      } else {\n        onError?.(error)\n      }\n    }\n  }, [onSelect, disableValidateOnSelect, validate, onError])\n\n  // Handle item highlighting: items can he highlighted with mouse or keyboard.\n  const handleHighlight = useCallback((event, value, reason) => {\n    onHighlight?.(value, reason)\n    highlightRef.current = value\n  }, [highlightRef, onHighlight])\n\n  // Handle blur\n  const handleBlur = useCallback(() => {\n    onBlur?.()\n    !disableAcceptOnBlur && handleAccept(value)\n  }, [onBlur, handleAccept, value, disableAcceptOnBlur])\n\n  // Handles special key presses\n  const handleKeyDown = useCallback((event) => {\n    // When escape is pressed, close the menu if it is visible and showing some\n    // items. Otherwise clear the current text input.\n    if (event.key === 'Escape') {\n      if (open && suggestions?.length > 0) {\n        setOpen(false)\n      } else {\n        clearInputValue()\n      }\n      event.stopPropagation()\n      event.preventDefault()\n    }\n    // When enter is pressed, select currently highlighted value and close menu,\n    // or if menu is not open submit the value.\n    if (event.key === 'Enter') {\n      if (open && highlightRef.current) {\n        handleSelect?.(getOptionLabel(highlightRef.current).trim())\n      } else {\n        handleAccept(value && value.trim())\n      }\n      event.stopPropagation()\n      event.preventDefault()\n      setOpen(false)\n    }\n  }, [open, suggestions, handleSelect, handleAccept, value, getOptionLabel, clearInputValue, highlightRef])\n\n  // Handle input events. Errors are cleaned in input change, regular typing\n  // emits onChange, selection with mouse emits onSelect.\n  const handleInputChange = useCallback((event, value, reason) => {\n    setSuggestAll(false)\n    onError && onError(undefined)\n    if (event) {\n      if (reason === 'reset') {\n        handleSelect?.(value)\n      } else {\n        onChange?.(value)\n      }\n    }\n  }, [onChange, handleSelect, onError])\n\n  return <div className={clsx(className, styles.root)}>\n    <Autocomplete\n      freeSolo\n      disabled={disabled}\n      clearOnBlur={false}\n      inputValue={value || ''}\n      value={null}\n      open={open}\n      onOpen={() => setOpen(true)}\n      onClose={() => setOpen(false)}\n      onBlur={handleBlur}\n      fullWidth\n      disableClearable\n      autoHighlight={autoHighlight}\n      classes={{\n        listbox: styles.listbox,\n        option: styles.option\n      }}\n      ListboxComponent={ListboxComponent}\n      PaperComponent={PaperComponent}\n      options={suggestions}\n      onInputChange={handleInputChange}\n      onHighlightChange={handleHighlight}\n      getOptionLabel={getOptionLabel}\n      getOptionSelected={(option, value) => false}\n      groupBy={groupBy}\n      renderGroup={renderGroup}\n      filterOptions={suggestAll\n          ? (opt) => opt\n          : filterOptions\n      }\n      renderOption={renderOption}\n      selectOnFocus={true}\n      renderInput={(params) => {\n        // We need to strip out the styling of the input field that is imposed\n        // by Autocomplete. Otherwise the styles enabled by the\n        // hiddenLabel-property will be overridden.\n        params.InputProps.className = undefined\n        return <InputTextField\n          {...params}\n          size=\"small\"\n          helperText={error || undefined}\n          error={!!error}\n          onFocus={() => { suggestAllOnFocus && setSuggestAll(true); onFocus?.() } }\n          onKeyDown={handleKeyDown}\n          InputLabelProps={{shrink}}\n          InputProps={{\n            ...params.InputProps,\n            ...InputProps,\n            endAdornment: (<div className={styles.adornmentList}>\n              {loading ? <CircularProgress color=\"inherit\" size={20} className={styles.adornment} /> : null}\n              {(value?.length && !disableClearable)\n                ? <Tooltip title=\"Clear\">\n                    <IconButton\n                      size=\"small\"\n                      disabled={disabled}\n                      onClick={clearInputValue}\n                      className={styles.iconButton}\n                      aria-label=\"clear\"\n                    >\n                      <CloseIcon/>\n                    </IconButton>\n                  </Tooltip>\n                : null\n              }\n              {(showOpenSuggestions)\n                ? <IconButton\n                    size=\"small\"\n                    disabled={disabled}\n                    onClick={() => setOpen(old => !old)}\n                    className={clsx(styles.popupIndicator, {\n                      [styles.popupIndicatorOpen]: open\n                    })}\n                  >\n                    <ArrowDropDownIcon />\n                </IconButton>\n                : null\n              }\n              {InputProps?.endAdornment || null}\n            </div>)\n          }}\n          {...TextFieldProps}\n        />\n      }}\n    />\n  </div>\n})\n\nInputText.propTypes = {\n  value: PropTypes.string,\n  error: PropTypes.string, // Error shown underneath the text\n  shrink: PropTypes.bool, // Whether the label should automatically \"shrink\" on input\n  suggestions: PropTypes.array, // Array of suggested values\n  loading: PropTypes.bool, // Whether loading icon should be shown\n  onChange: PropTypes.func, // Triggered whenever the input text changes\n  onSelect: PropTypes.func, // Triggered when an option is selected from suggestions\n  onAccept: PropTypes.func, // Triggered when value should be accepted\n  onBlur: PropTypes.func, // Triggered when text goes out of focus\n  onFocus: PropTypes.func, // Triggered when text is focused\n  onHighlight: PropTypes.func, // Triggered when selection is highlighted\n  onError: PropTypes.func, // Triggered when any errors should be cleared\n  getOptionLabel: PropTypes.func,\n  groupBy: PropTypes.func,\n  renderOption: PropTypes.func,\n  renderGroup: PropTypes.func,\n  ListboxComponent: PropTypes.any,\n  PaperComponent: PropTypes.any,\n  TextFieldProps: PropTypes.object,\n  InputProps: PropTypes.object,\n  filterOptions: PropTypes.func,\n  disableClearable: PropTypes.bool,\n  autoHighlight: PropTypes.bool,\n  disableAcceptOnBlur: PropTypes.bool,\n  validate: PropTypes.func, // Function that can be used to validate the input\n  disableValidateOnSelect: PropTypes.bool, // Whether validation on selecting autocompletion value should be disabled\n  suggestAllOnFocus: PropTypes.bool, // Whether to provide all suggestion values when input is focused\n  showOpenSuggestions: PropTypes.bool, // Whether to show button for opening suggestions\n  className: PropTypes.string,\n  classes: PropTypes.object\n}\n\nInputText.defaultProps = {\n  getOptionLabel: (option) => option.value,\n  showOpenSuggestions: false,\n  autoHighlight: false\n}\n\n/*\n * Text field that can be used to submit filter values that target a specific\n * quantity. Can also suggest values.\n */\nconst useStyles = makeStyles(theme => ({\n  root: {\n    width: '100%',\n    display: 'flex',\n    alignItems: 'flex-start',\n    justifyContent: 'center',\n    flexDirection: 'column',\n    boxSizing: 'border-box'\n  }\n}))\nexport const InputTextQuantity = React.memo(({\n  quantity,\n  suggestions,\n  loading,\n  onChange,\n  disableSuggestions,\n  className,\n  classes,\n  ...TextFieldProps\n}) => {\n  const theme = useTheme()\n  const { filterData, useSetFilter } = useSearchContext()\n  const styles = useStyles({classes: classes, theme: theme})\n  const [inputValue, setInputValue] = useState('')\n  const [suggestionInput, setSuggestionInput] = useState('')\n  const [highlighted, setHighlighted] = useState({value: ''})\n  const [open, setOpen] = useState(false)\n  const [error, setError] = useState(false)\n  const [quantitiesSuggestion, quantitiesAll] = useMemo(() => [\n    [{name: quantity, size: 5}],\n    new Set([quantity])\n  ], [quantity])\n  const [suggestionsAuto, loadingAuto] = useSuggestions(quantitiesSuggestion, quantitiesAll, suggestionInput, filterData)\n  const finalSuggestions = suggestions || suggestionsAuto\n  const finalLoading = loading || loadingAuto\n  const disableSuggestionsFinal = suggestions\n    ? true\n    : isNil(disableSuggestions)\n      ? !searchQuantities[quantity]?.suggestion\n      : disableSuggestions\n\n  // Attach the filter hook\n  const setFilter = useSetFilter(quantity)\n  const disabled = TextFieldProps.disabled\n\n  // Sets the input value and calls the callback if given\n  const handleChange = useCallback((input) => {\n    setInputValue(input)\n    onChange && onChange(input)\n  }, [onChange])\n\n  // Clears the input and suggestions\n  const clearInputValue = useCallback(() => {\n    handleChange('')\n    setSuggestionInput('')\n    setOpen(false)\n  }, [handleChange])\n\n  // Triggered when a value is submitted by pressing enter or clicking the\n  // search icon.\n  const handleSubmit = useCallback((value) => {\n    if (value.trim().length === 0) {\n      return\n    }\n    const valid = true\n    if (valid) {\n      // Submit to search context on successful validation.\n      setFilter(old => {\n        const multiple = filterData[quantity].multiple\n        return (isNil(old) || !multiple) ? new Set([value]) : new Set([...old, value])\n      })\n      clearInputValue()\n    } else {\n      setError(`Invalid query`)\n    }\n  }, [filterData, quantity, setFilter, clearInputValue])\n\n  const handleHighlight = useCallback((event, value, reason) => {\n    setHighlighted(value)\n  }, [])\n\n  // Handles special key presses\n  const handleKeyDown = useCallback((event) => {\n    // When escape is pressed, close the menu if it is visible and showing some\n    // items. Otherwise clear the current text input.\n    if (event.key === 'Escape') {\n      if (open && suggestions?.length > 0) {\n        setOpen(false)\n      } else {\n        clearInputValue()\n      }\n      event.stopPropagation()\n      event.preventDefault()\n    }\n    // When enter is pressed, select currently highlighted value and close menu,\n    // or if menu is not open submit the value.\n    if (event.key === 'Enter') {\n      if (open && highlighted?.value) {\n        handleSubmit(highlighted.value)\n      } else {\n        handleSubmit(inputValue)\n      }\n      event.stopPropagation()\n      event.preventDefault()\n    }\n  }, [open, suggestions, highlighted, handleSubmit, inputValue, clearInputValue])\n\n  // Handle typing events.\n  const handleInputChange = useCallback((event, value, reason) => {\n    setError(error => error ? undefined : null)\n\n    // When an option is selected (mouse or keyboard), the filter is immediately\n    // submitted and the field value cleared.\n    if (reason === 'reset') {\n      handleSubmit(value)\n    } else {\n      handleChange(value)\n    }\n\n    // Suggestions are only retrieved on user input, or when the value has been\n    // cleared (this clears the suggestions)\n    if (!disableSuggestionsFinal && (value.trim() === '' || reason === 'input')) {\n      setSuggestionInput(value)\n    }\n  }, [disableSuggestionsFinal, handleSubmit, handleChange])\n\n  return <div className={clsx(className, styles.root)}>\n    <Autocomplete\n      freeSolo\n      disabled={disabled}\n      clearOnBlur={false}\n      inputValue={inputValue}\n      value={null}\n      open={open}\n      onOpen={() => setOpen(true)}\n      onClose={() => setOpen(false)}\n      fullWidth\n      disableClearable\n      classes={{endAdornment: styles.endAdornment}}\n      options={finalSuggestions}\n      onInputChange={handleInputChange}\n      onHighlightChange={handleHighlight}\n      getOptionLabel={option => option.value}\n      getOptionSelected={(option, value) => false}\n      renderInput={(params) => {\n        // We need to strip out the styling of the input field that is imposed\n        // by Autocomplete. Otherwise the styles enabled by the\n        // hiddenLabel-property will be overridden.\n        params.InputProps.className = undefined\n        return <InputTextField\n          {...params}\n          size=\"small\"\n          placeholder=\"Type here\"\n          label={error || undefined}\n          error={!!error}\n          onKeyDown={handleKeyDown}\n          InputLabelProps={{ shrink: true }}\n          InputProps={{\n            ...params.InputProps,\n            endAdornment: (<>\n              {finalLoading ? <CircularProgress color=\"inherit\" size={20} /> : null}\n              {(inputValue?.length || null) && <>\n                <Tooltip title=\"Clear\">\n                  <IconButton\n                    size=\"small\"\n                    onClick={clearInputValue}\n                    className={styles.iconButton}\n                    aria-label=\"clear\"\n                  >\n                    <CloseIcon/>\n                  </IconButton>\n                </Tooltip>\n              </>}\n            </>)\n          }}\n          {...TextFieldProps}\n        />\n      }}\n    />\n  </div>\n})\n\nInputTextQuantity.propTypes = {\n  /*\n   * The quantity targeted by the text field target.\n   */\n  quantity: PropTypes.string,\n  /*\n   * A manual array of suggestions.\n   */\n  suggestions: PropTypes.array,\n  /*\n   * Whether suggestions are being loaded.\n   */\n  loading: PropTypes.bool,\n  /*\n   * Callback for when the input changes.\n   */\n  onChange: PropTypes.bool,\n  /*\n   * Whether to enable or disable automatic suggestions. Will be forcefully set\n   * to true if manual list of suggestions are provided. If no value is given\n   * the suggestions are turned on if they are available for the quantity.\n   */\n  disableSuggestions: PropTypes.bool,\n  className: PropTypes.string,\n  classes: PropTypes.object\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {useCallback, useEffect, useMemo, useRef, useContext, createContext} from 'react'\nimport PropTypes from 'prop-types'\nimport {isNil} from 'lodash'\nimport {getSuggestions} from '../../utils'\nimport {unitMap} from './UnitContext'\nimport {parse} from './common'\nimport {List, ListItemText, ListSubheader, makeStyles} from '@material-ui/core'\nimport {VariableSizeList} from 'react-window'\nimport {InputText} from '../search/input/InputText'\n\n/**\n * Wrapper around InputText that is specialized in showing unit options.\n */\nexport const useInputStyles = makeStyles(theme => ({\n  optionText: {\n    flexGrow: 1,\n    overflowX: 'scroll',\n    '&::-webkit-scrollbar': {\n      display: 'none'\n    },\n    '-ms-overflow-style': 'none',\n    scrollbarWidth: 'none'\n  },\n  noWrap: {\n    whiteSpace: 'nowrap'\n  },\n  option: {\n    width: '100%',\n    display: 'flex',\n    alignItems: 'stretch'\n  }\n}))\nexport const UnitInput = React.memo(({value, error, onChange, onAccept, onSelect, onError, dimension, options, disabled, label, disableGroup, optional}) => {\n  const styles = useInputStyles()\n\n  // Predefine all option objects, all option paths and also pre-tokenize the\n  // options for faster matching.\n  const {keys, filter, finalOptions} = useMemo(() => {\n    const finalOptions = {}\n    Object.entries(unitMap)\n      .filter(([key, unit]) => dimension ? unit.dimension === dimension : true)\n      .forEach(([key, unit]) => {\n        const unitAbbreviation = unit.abbreviation ? ` (${unit.abbreviation})` : ''\n        finalOptions[key] = {\n          key: key,\n          primary: `${unit.label}${unitAbbreviation}`,\n          secondary: unit.aliases?.splice(1).join(', '),\n          dimension: unit.dimension,\n          unit: unit\n        }\n      })\n    const keys = Object.keys(finalOptions)\n    const {filter} = getSuggestions(keys, 0)\n    return {keys, filter, finalOptions}\n  }, [dimension])\n\n  const validate = useCallback((value) => {\n    if (isNil(value) || value?.trim?.() === '') {\n      if (optional) {\n        return {valid: true}\n      } else {\n        return {valid: false, error: 'Please specify a value'}\n      }\n    }\n    const {error, unit} = parse(value, {dimension, requireUnit: true})\n    return {valid: !error, error, data: unit}\n  }, [optional, dimension])\n\n  // Revalidate input when dimension changes\n  useEffect(() => {\n    if (!value) return\n    const {error} = validate(value)\n    if (error) {\n      onError?.(error)\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [dimension])\n\n  // Used to filter the shown options based on input\n  const filterOptions = useCallback((opt, { inputValue }) => {\n    let filtered = filter(inputValue)\n    if (!disableGroup) filtered = filtered.sort((a, b) => options[a].group > options[b].group ? 1 : -1)\n    return filtered\n  }, [disableGroup, filter, options])\n\n  return <InputText\n    value={value}\n    TextFieldProps={{label, disabled}}\n    error={error}\n    onChange={onChange}\n    onSelect={onSelect}\n    onAccept={onAccept}\n    onError={onError}\n    validate={validate}\n    disableClearable\n    suggestAllOnFocus\n    showOpenSuggestions\n    suggestions={keys}\n    ListboxComponent={ListboxUnit}\n    groupBy={disableGroup ? undefined : (key) => finalOptions?.[key]?.dimension}\n    renderGroup={disableGroup ? undefined : renderGroup}\n    getOptionLabel={option => option}\n    filterOptions={filterOptions}\n    renderOption={(key) => {\n      const option = finalOptions[key]\n      return <div className={styles.option}>\n        <ListItemText\n          primary={option.primary || option.key}\n          secondary={option.secondary}\n          className={styles.optionText}\n          primaryTypographyProps={{className: styles.noWrap}}\n          secondaryTypographyProps={{className: styles.noWrap}}\n        />\n      </div>\n    }}\n  />\n})\nUnitInput.propTypes = {\n  value: PropTypes.string,\n  error: PropTypes.string,\n  label: PropTypes.string,\n  dimension: PropTypes.string,\n  options: PropTypes.object,\n  onChange: PropTypes.func,\n  onAccept: PropTypes.func,\n  onSelect: PropTypes.func,\n  onBlur: PropTypes.func,\n  onError: PropTypes.func,\n  disabled: PropTypes.bool,\n  disableGroup: PropTypes.bool,\n  optional: PropTypes.bool\n}\n\nexport default UnitInput\n\n/**\n * Custom virtualized list component for displaying unit values.\n */\nconst ListboxUnit = React.forwardRef((props, ref) => {\n  const { children, ...other } = props\n  const itemSize = 64\n  const headerSize = 40\n  const itemData = React.Children.toArray(children)\n  const itemCount = itemData.length\n\n  // Calculate size of child element.\n  const getChildSize = (child) => {\n    return React.isValidElement(child) && child.type === ListSubheader\n      ? headerSize\n      : itemSize\n  }\n\n  // Calculates the height of the suggestion box\n  const getHeight = () => {\n    return itemCount > 8\n      ? 8 * itemSize\n      : itemData.map(getChildSize).reduce((a, b) => a + b, 0)\n  }\n\n  const gridRef = useResetCache(itemCount)\n\n  return <div ref={ref}>\n    <OuterElementContext.Provider value={other}>\n      <List disablePadding>\n        <VariableSizeList\n          itemData={itemData}\n          height={getHeight() + 2 * LISTBOX_PADDING}\n          width=\"100%\"\n          ref={gridRef}\n          outerElementType={OuterElementType}\n          innerElementType=\"ul\"\n          itemSize={(index) => getChildSize(itemData[index])}\n          overscanCount={5}\n          itemCount={itemCount}\n        >\n          {renderRow}\n        </VariableSizeList>\n      </List>\n    </OuterElementContext.Provider>\n  </div>\n})\n\nListboxUnit.propTypes = {\n  children: PropTypes.node\n}\n\nconst LISTBOX_PADDING = 8\nconst OuterElementContext = createContext({})\n\nconst OuterElementType = React.forwardRef((props, ref) => {\n  const outerProps = useContext(OuterElementContext)\n  return <div ref={ref} {...props} {...outerProps} />\n})\n\nconst renderGroup = (params) => [\n  <ListSubheader key={params.key} component=\"div\">\n    {params.group}\n  </ListSubheader>,\n  params.children\n]\n\nfunction useResetCache(data) {\n  const ref = useRef(null)\n  useEffect(() => {\n    if (ref.current != null) {\n      ref.current.resetAfterIndex(0, true)\n    }\n  }, [data])\n  return ref\n}\n\nfunction renderRow({ data, index, style }) {\n  return React.cloneElement(data[index], {\n    style: {\n      ...style,\n      top: style.top + LISTBOX_PADDING\n    }\n  })\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useState, useEffect, useCallback, useRef } from 'react'\nimport PropTypes from 'prop-types'\nimport {useUnitContext} from './UnitContext'\nimport UnitInput from './UnitInput'\n\n/**\n * Controls the unit for the specified dimension in the current unit context.\n */\nconst UnitDimensionSelect = React.memo(({label, dimension, onChange, disabled}) => {\n  const {units, setUnits} = useUnitContext()\n  const [error, setError] = useState()\n  const unit = units?.[dimension]\n  const disabledFinal = disabled || unit?.locked\n  const labelFinal = label || dimension\n  const oldValue = useRef(unit?.definition)\n  const [inputValue, setInputValue] = useState(unit?.definition)\n\n  // React to changes in units\n  useEffect(() => {\n    setError(undefined)\n    setInputValue(unit?.definition)\n  }, [unit, dimension])\n\n  const handleAccept = useCallback((unitString, unit) => {\n    setUnits(old => {\n      const newUnits = {\n        ...old,\n        [dimension]: {...old[dimension], definition: unitString}\n      }\n      return newUnits\n    })\n    onChange?.(unit)\n    oldValue.current = unitString\n  }, [dimension, onChange, setUnits])\n\n  const handleSelect = useCallback((unitString, unit) => {\n    handleAccept(unit.label(), unit)\n  }, [handleAccept])\n\n  const handleChange = useCallback((value) => {\n    oldValue.current = value\n    setInputValue(value)\n  }, [])\n\n  return (unit && dimension !== 'dimensionless')\n    ? <UnitInput\n      value={inputValue}\n      label={labelFinal}\n      onChange={handleChange}\n      onAccept={handleAccept}\n      onSelect={handleSelect}\n      onError={setError}\n      dimension={dimension}\n      error={error}\n      disabled={disabledFinal}\n      disableGroup\n    />\n    : null\n})\nUnitDimensionSelect.propTypes = {\n  value: PropTypes.string,\n  label: PropTypes.string,\n  dimension: PropTypes.string,\n  onChange: PropTypes.func,\n  disabled: PropTypes.bool\n}\n\nexport default UnitDimensionSelect\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useCallback } from 'react'\nimport {FormControlLabel, RadioGroup, Radio} from '@material-ui/core'\nimport PropTypes from 'prop-types'\nimport {useUnitContext} from './UnitContext'\n\n/**\n * Controls the unit system in the current unit context.\n */\nconst UnitSystemSelect = React.memo(({onChange}) => {\n  const {unitSystems, selected, setSelected} = useUnitContext()\n\n  const handleSystemChange = useCallback((event) => {\n    setSelected(event.target.value)\n    onChange && onChange(event)\n  }, [onChange, setSelected])\n\n  return <RadioGroup value={selected} onChange={handleSystemChange}>\n    {Object.entries(unitSystems).map(([key, system]) =>\n      <FormControlLabel key={key} value={key} control={<Radio />} label={system.label} />\n    )}\n  </RadioGroup>\n})\nUnitSystemSelect.propTypes = {\n  onChange: PropTypes.func,\n  disabled: PropTypes.bool\n}\n\nexport default UnitSystemSelect\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useCallback, useState, useMemo } from 'react'\nimport {\n  Box, Button, Menu, FormLabel, makeStyles, Typography\n} from '@material-ui/core'\nimport SettingsIcon from '@material-ui/icons/Settings'\nimport ReplayIcon from '@material-ui/icons/Replay'\nimport PropTypes from 'prop-types'\nimport { HelpButton } from '../Help'\nimport { InputText } from '../search/input/InputText'\nimport UnitDimensionSelect from './UnitDimensionSelect'\nimport UnitSystemSelect from './UnitSystemSelect'\nimport { useUnitContext } from './UnitContext'\nimport { Action, ActionHeader, Actions } from '../Actions'\n\n/**\n * Menu for controlling all units in the current unit context.\n */\nconst useStyles = makeStyles(theme => ({\n  // MUI will automatically add a padding whe scroll bar is visible. This is\n  // disabled here because the contents already have a sufficient margin.\n  list: {\n    paddingRight: '0 !important',\n    width: '100% !important'\n  },\n  option: {\n    paddingTop: '6px',\n    paddingBottom: '6px'\n  }\n}))\nconst UnitMenu = React.memo(({\n  className,\n  onUnitChange,\n  onSystemChange\n}) => {\n  const {units, dimensionMap, reset} = useUnitContext()\n  const [anchorEl, setAnchorEl] = useState(null)\n  const open = Boolean(anchorEl)\n  const styles = useStyles()\n\n  const dimensionOptions = useMemo(() => {\n    return Object.keys(units)\n      .filter((name) => name !== 'dimensionless')\n      .sort()\n  }, [units])\n  const [dimension, setDimension] = useState(dimensionOptions[0])\n  const [dimensionInput, setDimensionInput] = useState(dimensionMap[dimensionOptions[0]].label)\n\n  const openMenu = useCallback((event) => {\n    setAnchorEl(event.currentTarget)\n  }, [])\n  const closeMenu = useCallback(() => {\n    setAnchorEl(null)\n  }, [])\n\n  const handleChange = useCallback((value) => {\n    setDimensionInput(value)\n  }, [])\n\n  const handleBlur = useCallback(() => {\n    const cleanValue = dimensionInput.trim().toLowerCase()\n    const dim = dimensionMap[cleanValue]\n    if (dim) {\n      setDimensionInput(dim.label)\n      setDimension(cleanValue)\n    } else {\n      setDimensionInput(dimensionMap[dimension].label)\n    }\n  }, [dimension, dimensionInput, dimensionMap])\n\n  const handleSelect = useCallback((value) => {\n    setDimension(value)\n    setDimensionInput(dimensionMap[value].label)\n  }, [dimensionMap])\n\n  return <>\n    <Button\n      aria-controls=\"customized-menu\"\n      aria-haspopup=\"true\"\n      variant=\"text\"\n      color=\"primary\"\n      onClick={openMenu}\n      className={className}\n      startIcon={<SettingsIcon/>}\n    >\n      Units\n    </Button>\n    <Menu\n      variant=\"menu\"\n      anchorEl={anchorEl}\n      getContentAnchorEl={null}\n      anchorOrigin={{ vertical: 'bottom', horizontal: 'right' }}\n      transformOrigin={{ vertical: 'top', horizontal: 'right' }}\n      keepMounted\n      open={open}\n      onClose={closeMenu}\n      classes={{list: styles.list}}\n    >\n      <Box px={2.5} py={1} width=\"20rem\">\n        <Actions>\n          <ActionHeader>\n            <Typography variant='h6' fontSize='0.9rem'>\n              Unit Settings\n            </Typography>\n          </ActionHeader>\n          <Action\n            tooltip=\"About units\"\n            ButtonComponent={HelpButton}\n            ButtonProps={{\n              title: \"About units\",\n              IconProps: {fontSize: 'small'},\n              content: `\n                With these settings you can change in which units numerical data\n                is **displayed** in the browser. This display unit can be\n                different from the unit that is used when the data is stored.\n                Note that it is possible to define a fixed display unit in the\n                metainfo which will overrule the settings made through this\n                menu.\n\n                Each NOMAD installation comes with a default set of unit\n                systems, which can be modified in the \\`nomad.yaml\\`\n                configuration file. You can here choose which of these unit\n                systems to use.\n\n                Each unit system contains information about the exact unit that\n                should be used for each dimension. Many of the commonly used\n                units are available for selection, and you may use the SI\n                prefixes on any of them. Note that in some unit systems certain\n                dimensions are locked, which means that you cannot change them.\n                `\n            }}\n          >\n          </Action>\n          <Action tooltip=\"Reset unit settings\" onClick={reset}>\n            <ReplayIcon fontSize=\"small\"/>\n          </Action>\n        </Actions>\n        <Box mt={1} />\n        {/* <FormControl variant=\"filled\" fullWidth disabled={!scope}>\n          <InputLabel>Scope</InputLabel>\n          <Select\n            value={scope || 'Global'}\n            onChange={(event) => setScope(event.target.value)}\n          >\n            <MenuItem value={'Global'}>Global</MenuItem>\n            <MenuItem value={'Schema'}>Schema</MenuItem>\n          </Select>\n        </FormControl> */}\n        <Box mt={1} />\n        <FormLabel component=\"legend\">Select unit system</FormLabel>\n        <UnitSystemSelect onChange={onSystemChange}/>\n        <Box mt={1} />\n        <FormLabel component=\"legend\">Select dimension and unit</FormLabel>\n        <Box mt={1} />\n        <InputText\n          value={dimensionInput}\n          suggestions={dimensionOptions}\n          disableClearable\n          suggestAllOnFocus\n          showOpenSuggestions\n          onChange={handleChange}\n          onSelect={handleSelect}\n          onBlur={handleBlur}\n          renderOption={(option) => <Typography className={styles.option}>\n            {dimensionMap[option].label}\n          </Typography>}\n          getOptionLabel={(option) => option}\n          TextFieldProps={{label: 'Dimension'}}\n        />\n        <Box mt={1} />\n        <UnitDimensionSelect\n          onChange={onUnitChange}\n          dimension={dimension}\n          label=\"Unit\"\n        />\n      </Box>\n    </Menu>\n  </>\n})\n\nUnitMenu.propTypes = {\n  onUnitChange: PropTypes.func,\n  onSystemChange: PropTypes.func,\n  className: PropTypes.string\n}\n\nexport default UnitMenu\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useState } from 'react'\nimport PropTypes from 'prop-types'\nimport {\n  Button,\n  Box,\n  makeStyles,\n  MenuList,\n  MenuItem,\n  Menu,\n  ListItemText,\n  Typography, Tooltip, IconButton\n} from '@material-ui/core'\nimport KeyboardArrowDownIcon from '@material-ui/icons/KeyboardArrowDown'\nimport { matchPath, useHistory, useLocation } from 'react-router-dom'\n\nconst useMenuBarStyles = makeStyles(theme => ({\n  root: {\n    width: '100%',\n    display: 'flex',\n    flexDirection: 'row',\n    flexWrap: 'nowrap',\n    justifyContent: 'left',\n    boxSizing: 'border-box'\n  }\n}))\n\n/**\n * Reusable menubar e.g. for navigation.\n*/\nexport function MenuBar({children}) {\n  const classes = useMenuBarStyles()\n\n  return <div className={classes.root}>\n    {children}\n  </div>\n}\nMenuBar.propTypes = {\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ])\n}\n\nexport const MenuBarList = React.memo(({header, children}) => {\n  return <MenuList\n      subheader={\n        <Box marginLeft={1.5}>\n          <Typography variant=\"button\">{header}</Typography>\n        </Box>\n      }\n    >\n      {children}\n    </MenuList>\n})\nMenuBarList.propTypes = {\n  header: PropTypes.string,\n  children: PropTypes.node\n}\n\nconst useMenuBarItemStyles = makeStyles(theme => ({\n  selected: {\n    color: theme.palette.primary.main\n  }\n}))\n\nexport const MenuBarItem = React.forwardRef(({label, tooltip, route, href}, ref) => {\n  const classes = useMenuBarItemStyles()\n  const {pathname} = useLocation()\n  const selected = matchPath(pathname, route) && true\n\n  const history = useHistory()\n\n  const handleClick = () => {\n    if (route) {\n      history.push(route)\n    }\n  }\n\n  return <MenuItem\n    data-testid={label}\n    ref={ref}\n    component={href ? 'a' : 'li'}\n    href={href}\n    dense\n    classes={{root: selected ? classes.selected : undefined}}\n    onClick={handleClick}\n  >\n    <ListItemText primary={label} secondary={tooltip} />\n  </MenuItem>\n})\nMenuBarItem.propTypes = {\n  label: PropTypes.string.isRequired,\n  tooltip: PropTypes.string,\n  icon: PropTypes.node,\n  route: PropTypes.string,\n  href: PropTypes.string\n}\n\nconst useMenuBarMenuStyles = makeStyles(theme => ({\n  root: {\n    marginLeft: theme.spacing(1),\n    '&:first-child': {\n      marginLeft: theme.spacing(0)\n    }\n  },\n  menuPopover: {\n    pointerEvents: 'none'\n  },\n  menuPaper: {\n    pointerEvents: 'all'\n  }\n}))\n\nexport function MenuBarMenu({label, children, route, icon}) {\n  const classes = useMenuBarMenuStyles()\n  const {pathname} = useLocation()\n  const [anchorEl, setAnchorEl] = useState(null)\n  const selected = matchPath(pathname, route) && true\n\n  const handleOpen = (event) => {\n    setAnchorEl(event.currentTarget)\n  }\n\n  const handleClose = () => {\n    setAnchorEl(null)\n  }\n\n  return <div onMouseLeave={handleClose}>\n    {icon && <IconButton onMouseEnter={handleOpen}>\n      <Tooltip title={label}>\n        {icon}\n      </Tooltip>\n    </IconButton>}\n    {!icon && <Button\n      className={classes.root}\n      onMouseEnter={handleOpen}\n      disableElevation\n      size=\"small\"\n      color={selected ? 'primary' : undefined}\n      endIcon={icon || <KeyboardArrowDownIcon />}\n    >\n      {label}\n    </Button>}\n    <Menu\n      data-testid={label}\n      PopoverClasses={{root: classes.menuPopover, paper: classes.menuPaper}}\n      elevation={2}\n      anchorEl={anchorEl}\n      getContentAnchorEl={null}\n      anchorOrigin={{vertical: 'bottom', horizontal: 'left'}}\n      keepMounted\n      open={Boolean(anchorEl)}\n      onClose={handleClose}\n      onClick={handleClose}\n    >\n      {children}\n    </Menu>\n  </div>\n}\nMenuBarMenu.propTypes = {\n  label: PropTypes.string.isRequired,\n  route: PropTypes.string.isRequired,\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ]),\n  icon: PropTypes.node\n}\n","var _clipPath, _g, _g2, _g3, _g4, _g5, _tspan, _tspan2, _tspan3, _tspan4;\n\nfunction _extends() { _extends = Object.assign ? Object.assign.bind() : function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport * as React from \"react\";\n\nfunction SvgAbout(_ref, svgRef) {\n  let {\n    title,\n    titleId,\n    ...props\n  } = _ref;\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: \"100%\",\n    height: \"100%\",\n    viewBox: \"0 0 1130 643\",\n    style: {\n      fillRule: \"evenodd\",\n      clipRule: \"evenodd\",\n      strokeLinecap: \"round\",\n      strokeLinejoin: \"round\",\n      strokeMiterlimit: 1.5\n    },\n    ref: svgRef,\n    \"aria-labelledby\": titleId\n  }, props), title ? /*#__PURE__*/React.createElement(\"title\", {\n    id: titleId\n  }, title) : null, /*#__PURE__*/React.createElement(\"g\", {\n    id: \"Artboard1\",\n    transform: \"matrix(1.10933,0,0,1.0562,-2.94,0)\"\n  }, /*#__PURE__*/React.createElement(\"rect\", {\n    x: 2.65,\n    y: 0,\n    width: 1018.16,\n    height: 608.36,\n    style: {\n      fill: \"none\"\n    }\n  }), _clipPath || (_clipPath = /*#__PURE__*/React.createElement(\"clipPath\", {\n    id: \"_clip1\"\n  }, /*#__PURE__*/React.createElement(\"rect\", {\n    x: 2.65,\n    y: 0,\n    width: 1018.16,\n    height: 608.36\n  }))), /*#__PURE__*/React.createElement(\"g\", {\n    clipPath: \"url(#_clip1)\"\n  }, _g || (_g = /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(0.901444,0,0,0.946793,4.80392,8.02979)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M729.794,14.858L475.275,161.805L472.775,157.475L729.794,9.085L823.721,63.313L821.221,67.644L729.794,14.858Z\"\n  }))), _g2 || (_g2 = /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(0.901444,0,0,0.946793,2.65025,10.1583)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M727.514,161.143L866.967,241.657L861.984,244.534L717.514,161.143L834.28,93.728L836.78,98.058L727.514,161.143Z\"\n  }))), _g3 || (_g3 = /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(0.901444,0,0,0.946793,2.64456,9.81211)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M927.126,246.844L960.764,227.423L958.264,223.092L922.126,243.957L927.126,246.844Z\"\n  }))), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(0.907222,0,0,0.948123,0.245885,22.4155)\"\n  }, /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(0.993631,0,0,1.02527,2.65025,-10.5415)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M30.051,395.2L9,382.85L9,-9.946\",\n    style: {\n      fill: \"none\",\n      stroke: \"black\",\n      strokeWidth: \"0.49px\"\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(1.25077,0,0,1.2906,-102.959,-7.90252)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M570.5,154.635L570.5,-9.946\",\n    style: {\n      fill: \"none\",\n      stroke: \"black\",\n      strokeWidth: \"0.39px\"\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(0.993631,0,0,0.998598,2.65025,0)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M173.761,518.483L173.761,615.873\",\n    style: {\n      fill: \"none\",\n      stroke: \"black\",\n      strokeWidth: \"0.5px\"\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(0.993631,0,0,0.998598,2.65025,0)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M476.136,344.02L551.24,386.958L551.24,615.873\",\n    style: {\n      fill: \"none\",\n      stroke: \"black\",\n      strokeWidth: \"0.5px\"\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(0.993631,0,0,0.998598,2.65025,0)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M884.281,286.732L855.686,302.319L855.686,615.873\",\n    style: {\n      fill: \"none\",\n      stroke: \"black\",\n      strokeWidth: \"0.5px\"\n    }\n  }))), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(2.18207,0,0,2.29185,-379.833,-86.4269)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M247.871,178.885L278.855,196.774\",\n    style: {\n      fill: \"none\",\n      stroke: \"black\",\n      strokeWidth: \"2.07px\"\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(2.18207,0,0,2.29185,-379.833,-86.4269)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M247.871,214.663L309.839,250.44L371.806,214.663L371.806,207.187L309.839,171.41L247.871,207.187L247.871,214.663Z\",\n    style: {\n      fill: \"rgb(123,31,162)\"\n    }\n  })), _g4 || (_g4 = /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(0.901444,0,0,0.946793,2.65025,10.1583)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M33.307,410.333L475.711,154.911L554.127,200.185L551.627,204.515L475.711,160.685L38.307,413.22L33.307,410.333Z\"\n  }))), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(2.18207,0,0,2.29185,-364.035,-76.847)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M334.92,182.002L350.44,190.782L386.918,169.722L390.144,158.425L371.63,160.807L334.92,182.002Z\",\n    style: {\n      stroke: \"white\",\n      strokeWidth: \"0.83px\",\n      strokeLinecap: \"square\",\n      strokeLinejoin: \"miter\"\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(2.18207,0,0,2.29185,-634.471,87.1444)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M332.901,183.168L348.421,191.948L386.918,169.722L390.144,158.425L371.63,160.807L332.901,183.168Z\",\n    style: {\n      stroke: \"white\",\n      strokeWidth: \"0.83px\",\n      strokeLinecap: \"square\",\n      strokeLinejoin: \"miter\"\n    }\n  })), _g5 || (_g5 = /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(0.901444,0,0,0.946793,2.65025,10.1583)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M858.552,280.292L863.552,283.179L475.711,507.099L397.295,461.826L399.795,457.496L475.711,501.326L858.552,280.292Z\"\n  }))), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(2.18207,0,0,2.29185,-379.833,-86.4269)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M453.475,154.483L495.742,178.885\",\n    style: {\n      fill: \"none\",\n      stroke: \"black\",\n      strokeWidth: \"2.07px\",\n      strokeLinecap: \"butt\",\n      strokeLinejoin: \"miter\"\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(2.18207,0,0,2.29185,-379.833,-86.4269)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M371.806,143.108L433.774,178.885L495.742,143.108L495.742,135.633L433.774,99.856L371.806,135.633L371.806,143.108Z\",\n    style: {\n      fill: \"rgb(0,121,107)\"\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(2.18207,0,0,2.29185,-161.861,-218.406)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M371.806,143.108L420.589,171.187L482.557,135.409L482.557,127.934L433.774,99.856L371.806,135.633L371.806,143.108Z\",\n    style: {\n      fill: \"rgb(255,179,0)\"\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(2.18207,0,0,2.29185,-32.4192,-139.913)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M371.806,143.108L420.589,171.187L482.557,135.409L482.557,127.934L433.774,99.856L371.806,135.633L371.806,143.108Z\",\n    style: {\n      fill: \"rgb(124,179,66)\"\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(1.31481,-0.797294,1.51821,0.920636,-596.364,363.645)\"\n  }, /*#__PURE__*/React.createElement(\"text\", {\n    x: \"280px\",\n    y: \"344.745px\",\n    style: {\n      fontFamily: \"'TitilliumWeb-Bold', 'Titillium Web'\",\n      fontWeight: 700,\n      fontSize: \"14.25px\",\n      fill: \"rgb(235,235,235)\"\n    }\n  }, \"repository\")), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(1.31481,-0.797294,1.51821,0.920636,-667.812,320.32)\"\n  }, /*#__PURE__*/React.createElement(\"text\", {\n    id: \"repositoryStats\",\n    x: \"280px\",\n    y: \"322.821px\",\n    style: {\n      fontFamily: \"'TitilliumWeb-Regular', 'Titillium Web'\",\n      fontSize: \"9.5px\",\n      fill: \"rgb(235,235,235)\"\n    }\n  }, \"repository stats\")), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(1.31481,-0.797294,1.51821,0.920636,-396.817,155.989)\"\n  }, /*#__PURE__*/React.createElement(\"text\", {\n    id: \"archiveStats\",\n    x: \"280px\",\n    y: \"322.821px\",\n    style: {\n      fontFamily: \"'TitilliumWeb-Regular', 'Titillium Web'\",\n      fontSize: \"9.5px\",\n      fill: \"rgb(235,235,235)\"\n    }\n  }, \"archiv\", _tspan || (_tspan = /*#__PURE__*/React.createElement(\"tspan\", {\n    x: \"303.76px \",\n    y: \"322.821px \"\n  }, \"e\")), \" stats\")), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(1.31481,-0.797294,1.51821,0.920636,-177.867,23.2191)\"\n  }, /*#__PURE__*/React.createElement(\"text\", {\n    id: \"encStats\",\n    x: \"280px\",\n    y: \"322.821px\",\n    style: {\n      fontFamily: \"'TitilliumWeb-Regular', 'Titillium Web'\",\n      fontSize: \"9.5px\",\n      fill: \"rgb(235,235,235)\"\n    }\n  }, \"encyclopedia stats\")), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(1.31481,-0.797294,1.51821,0.920636,-48.2806,101.8)\"\n  }, /*#__PURE__*/React.createElement(\"text\", {\n    id: \"toolkitStats\",\n    x: \"280px\",\n    y: \"322.821px\",\n    style: {\n      fontFamily: \"'TitilliumWeb-Regular', 'Titillium Web'\",\n      fontSize: \"9.5px\",\n      fill: \"rgb(235,235,235)\"\n    }\n  }, \"ai toolkit stats\")), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(1.31481,-0.797294,1.51821,0.920636,-468.236,273.281)\"\n  }, /*#__PURE__*/React.createElement(\"text\", {\n    x: \"280px\",\n    y: \"324.526px\",\n    style: {\n      fontFamily: \"'TitilliumWeb-Regular', 'Titillium Web'\",\n      fontSize: \"11.875px\",\n      fill: \"white\"\n    }\n  }, \"pr\", _tspan2 || (_tspan2 = /*#__PURE__*/React.createElement(\"tspan\", {\n    x: \"290.248px \",\n    y: \"324.526px \"\n  }, \"o\")), \"cessing\")), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(1.31481,-0.797294,1.51821,0.920636,-739.332,437.673)\"\n  }, /*#__PURE__*/React.createElement(\"text\", {\n    x: \"280px\",\n    y: \"324.526px\",\n    style: {\n      fontFamily: \"'TitilliumWeb-Regular', 'Titillium Web'\",\n      fontSize: \"11.875px\",\n      fill: \"white\"\n    }\n  }, \"upload\")), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(1.31481,-0.797294,1.51821,0.920636,-832.377,317.37)\"\n  }, /*#__PURE__*/React.createElement(\"text\", {\n    x: \"280px\",\n    y: \"324.526px\",\n    style: {\n      fontFamily: \"'TitilliumWeb-Regular', 'Titillium Web'\",\n      fontSize: \"11.875px\"\n    }\n  }, \"explor\", _tspan3 || (_tspan3 = /*#__PURE__*/React.createElement(\"tspan\", {\n    x: \"310.578px \",\n    y: \"324.526px \"\n  }, \"e\")))), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(1.31481,-0.797294,1.51821,0.920636,-137.471,258.922)\"\n  }, /*#__PURE__*/React.createElement(\"text\", {\n    x: \"320.14px\",\n    y: \"325.332px\",\n    style: {\n      fontFamily: \"'TitilliumWeb-Regular', 'Titillium Web'\",\n      fontSize: \"11.875px\"\n    }\n  }, \"API\")), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(1.31481,-0.797294,1.51821,0.920636,-325.553,199.427)\"\n  }, /*#__PURE__*/React.createElement(\"text\", {\n    x: \"280px\",\n    y: \"344.745px\",\n    style: {\n      fontFamily: \"'TitilliumWeb-Bold', 'Titillium Web'\",\n      fontWeight: 700,\n      fontSize: \"14.25px\",\n      fill: \"rgb(235,235,235)\"\n    }\n  }, \"archive\")), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(1.31481,-0.797294,1.51821,0.920636,-135.371,48.9883)\"\n  }, /*#__PURE__*/React.createElement(\"text\", {\n    x: \"280px\",\n    y: \"344.745px\",\n    style: {\n      fontFamily: \"'TitilliumWeb-Bold', 'Titillium Web'\",\n      fontWeight: 700,\n      fontSize: \"14.25px\",\n      fill: \"white\"\n    }\n  }, \"ency\", _tspan4 || (_tspan4 = /*#__PURE__*/React.createElement(\"tspan\", {\n    x: \"308.514px \",\n    y: \"344.745px \"\n  }, \"c\")), \"lopedia\")), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(1.31481,-0.797294,1.51821,0.920636,-36.3098,109.059)\"\n  }, /*#__PURE__*/React.createElement(\"text\", {\n    x: \"280px\",\n    y: \"336.589px\",\n    style: {\n      fontFamily: \"'TitilliumWeb-Bold', 'Titillium Web'\",\n      fontWeight: 700,\n      fontSize: \"14.25px\",\n      fill: \"white\"\n    }\n  }, \"artificial\"), /*#__PURE__*/React.createElement(\"text\", {\n    x: \"280px\",\n    y: \"350.839px\",\n    style: {\n      fontFamily: \"'TitilliumWeb-Bold', 'Titillium Web'\",\n      fontWeight: 700,\n      fontSize: \"14.25px\",\n      fill: \"white\"\n    }\n  }, \"intelligence\"), /*#__PURE__*/React.createElement(\"text\", {\n    x: \"280px\",\n    y: \"365.089px\",\n    style: {\n      fontFamily: \"'TitilliumWeb-Bold', 'Titillium Web'\",\n      fontWeight: 700,\n      fontSize: \"14.25px\",\n      fill: \"white\"\n    }\n  }, \"toolkit\")), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(35.0386,0,0,36.8013,112.044,587.742)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M0.232,-0.65C0.249,-0.633 0.269,-0.625 0.291,-0.625C0.313,-0.625 0.333,-0.633 0.35,-0.65C0.367,-0.667 0.375,-0.687 0.375,-0.709C0.375,-0.731 0.367,-0.75 0.35,-0.767C0.333,-0.783 0.313,-0.791 0.291,-0.791C0.269,-0.791 0.25,-0.783 0.233,-0.767C0.217,-0.75 0.209,-0.731 0.209,-0.709C0.209,-0.687 0.217,-0.667 0.232,-0.65ZM0.834,-0.875C0.846,-0.875 0.855,-0.871 0.863,-0.863C0.871,-0.855 0.875,-0.846 0.875,-0.834L0.875,-0.584C0.875,-0.572 0.871,-0.562 0.863,-0.554C0.855,-0.545 0.846,-0.541 0.834,-0.541L0.166,-0.541C0.154,-0.541 0.145,-0.545 0.137,-0.554C0.129,-0.562 0.125,-0.572 0.125,-0.584L0.125,-0.834C0.125,-0.846 0.129,-0.855 0.137,-0.863C0.145,-0.871 0.154,-0.875 0.166,-0.875L0.834,-0.875ZM0.232,-0.232C0.249,-0.217 0.269,-0.209 0.291,-0.209C0.313,-0.209 0.333,-0.217 0.35,-0.233C0.367,-0.25 0.375,-0.269 0.375,-0.291C0.375,-0.313 0.367,-0.333 0.35,-0.35C0.333,-0.367 0.313,-0.375 0.291,-0.375C0.269,-0.375 0.25,-0.367 0.233,-0.35C0.217,-0.333 0.209,-0.313 0.209,-0.291C0.209,-0.269 0.217,-0.249 0.232,-0.232ZM0.834,-0.459C0.846,-0.459 0.855,-0.455 0.863,-0.446C0.871,-0.438 0.875,-0.428 0.875,-0.416L0.875,-0.166C0.875,-0.154 0.871,-0.145 0.863,-0.137C0.855,-0.129 0.846,-0.125 0.834,-0.125L0.166,-0.125C0.154,-0.125 0.145,-0.129 0.137,-0.137C0.129,-0.145 0.125,-0.154 0.125,-0.166L0.125,-0.416C0.125,-0.428 0.129,-0.438 0.137,-0.446C0.145,-0.455 0.154,-0.459 0.166,-0.459L0.834,-0.459Z\",\n    style: {\n      fillRule: \"nonzero\"\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(38.6852,0,0,40.6314,-1.17035,438.333)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M0.264,-0.471C0.3,-0.434 0.344,-0.416 0.396,-0.416C0.449,-0.416 0.493,-0.434 0.529,-0.471C0.566,-0.507 0.584,-0.551 0.584,-0.604C0.584,-0.656 0.566,-0.7 0.529,-0.736C0.493,-0.773 0.449,-0.791 0.396,-0.791C0.344,-0.791 0.3,-0.773 0.264,-0.736C0.227,-0.7 0.209,-0.656 0.209,-0.604C0.209,-0.551 0.227,-0.507 0.264,-0.471ZM0.646,-0.416L0.854,-0.209L0.791,-0.146L0.584,-0.354L0.584,-0.387L0.572,-0.398C0.523,-0.355 0.464,-0.334 0.396,-0.334C0.321,-0.334 0.257,-0.36 0.204,-0.412C0.151,-0.464 0.125,-0.528 0.125,-0.604C0.125,-0.679 0.151,-0.743 0.204,-0.796C0.257,-0.849 0.321,-0.875 0.396,-0.875C0.472,-0.875 0.536,-0.849 0.588,-0.796C0.64,-0.743 0.666,-0.679 0.666,-0.604C0.666,-0.536 0.645,-0.477 0.602,-0.428L0.613,-0.416L0.646,-0.416Z\",\n    style: {\n      fillRule: \"nonzero\"\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(0.907222,0,0,0.983302,0.245885,10.1583)\"\n  }, /*#__PURE__*/React.createElement(\"g\", {\n    id: \"search\",\n    transform: \"matrix(0.993631,0,0,0.962871,2.65025,0)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M0,412.944L17.195,395.308L76.244,360.184L96.747,377.857L34.39,413.859L34.39,448.142L0,448.142L0,412.944Z\",\n    style: {\n      fill: \"white\",\n      fillOpacity: 0\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    id: \"upload\",\n    transform: \"matrix(2.40523,0,0,2.33077,-698.41,78.9745)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M325.331,178.885L356.547,196.64L395.044,174.413L390.948,158.89L364.06,156.525L325.331,178.885Z\",\n    style: {\n      fill: \"white\",\n      fillOpacity: 0\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    id: \"encyclopedia\",\n    transform: \"matrix(2.40523,0,0,2.33077,-178.719,-250.269)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M371.806,143.108L420.769,171.377L482.737,135.6L433.774,107.331L371.806,143.108Z\",\n    style: {\n      fill: \"white\",\n      fillOpacity: 0\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    id: \"toolkit\",\n    transform: \"matrix(2.40523,0,0,2.33077,-20.7432,-162.081)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M365.21,139.3L414.822,167.943L476.79,132.166L427.178,103.523L365.21,139.3Z\",\n    style: {\n      fill: \"white\",\n      fillOpacity: 0\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    id: \"api\",\n    transform: \"matrix(0.993631,0,0,0.962871,2.65025,0)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M858.874,315.909L833.39,301.196L869.409,280.401L869.409,242.554L922.903,242.554L922.903,276.811L887.712,297.128L858.874,315.909Z\",\n    style: {\n      fill: \"white\",\n      fillOpacity: 0\n    }\n  }))), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(35.0386,0,0,36.8013,69.3381,560.079)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M0.834,-0.375L0.834,-0.791L0.166,-0.791L0.166,-0.375L0.834,-0.375ZM0.584,-0.25L0.584,-0.291L0.416,-0.291L0.416,-0.25L0.584,-0.25ZM0.916,-0.25L1,-0.25L1,-0.166L0,-0.166L0,-0.25L0.084,-0.25L0.084,-0.875L0.916,-0.875L0.916,-0.25Z\",\n    style: {\n      fillRule: \"nonzero\"\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(35.0386,0,0,36.8013,792.965,275.883)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M0.834,-0.375L0.834,-0.791L0.166,-0.791L0.166,-0.375L0.834,-0.375ZM0.584,-0.25L0.584,-0.291L0.416,-0.291L0.416,-0.25L0.584,-0.25ZM0.916,-0.25L1,-0.25L1,-0.166L0,-0.166L0,-0.25L0.084,-0.25L0.084,-0.875L0.916,-0.875L0.916,-0.25Z\",\n    style: {\n      fillRule: \"nonzero\"\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(35.0386,0,0,36.8013,29.7411,529.218)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M0.279,-0.369C0.356,-0.4 0.43,-0.416 0.5,-0.416C0.57,-0.416 0.644,-0.401 0.72,-0.37C0.796,-0.34 0.834,-0.299 0.834,-0.25L0.834,-0.166L0.166,-0.166L0.166,-0.25C0.166,-0.299 0.204,-0.339 0.279,-0.369ZM0.617,-0.549C0.585,-0.516 0.546,-0.5 0.5,-0.5C0.454,-0.5 0.415,-0.516 0.383,-0.549C0.35,-0.581 0.334,-0.62 0.334,-0.666C0.334,-0.712 0.35,-0.751 0.383,-0.784C0.415,-0.817 0.454,-0.834 0.5,-0.834C0.546,-0.834 0.585,-0.817 0.617,-0.784C0.65,-0.751 0.666,-0.712 0.666,-0.666C0.666,-0.62 0.65,-0.581 0.617,-0.549Z\",\n    style: {\n      fillRule: \"nonzero\"\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(1.51821,0,0,1.59459,-137.43,-420.642)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M552.85,404.535L552.85,415.278L463.786,466.7L463.786,455.956L552.85,404.535Z\",\n    style: {\n      fill: \"rgb(0,76,64)\"\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(1.51821,0,0,1.59459,51.77,-570.266)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M552.85,404.535L552.85,415.278L463.786,466.7L463.786,455.956L552.85,404.535Z\",\n    style: {\n      fill: \"rgb(255,111,0)\"\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(1.51821,0,0,1.59459,181.468,-491.618)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M552.85,404.535L552.85,415.278L463.786,466.7L463.786,455.956L552.85,404.535Z\",\n    style: {\n      fill: \"rgb(51,105,30)\"\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(1.51821,0,0,1.59459,-407.531,-256.447)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M552.629,404.407L552.629,415.151L463.786,466.7L463.786,455.956L552.629,404.407Z\",\n    style: {\n      fill: \"rgb(74,0,114)\"\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(1.51821,0,0,1.59459,-137.43,-420.642)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M463.786,466.7L374.722,415.278L374.722,404.535L463.786,455.956L463.786,466.7Z\",\n    style: {\n      fill: \"rgb(72,169,153)\"\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(1.51821,0,0,1.59459,80.5414,-552.819)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M444.835,455.758L374.722,415.278L374.722,404.535L444.835,445.015L444.835,455.758Z\",\n    style: {\n      fill: \"rgb(255,213,79)\"\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(1.51821,0,0,1.59459,210.076,-474.072)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M444.835,455.758L374.722,415.278L374.722,404.535L444.835,445.015L444.835,455.758Z\",\n    style: {\n      fill: \"rgb(174,213,129)\"\n    }\n  })), /*#__PURE__*/React.createElement(\"g\", {\n    transform: \"matrix(1.51821,0,0,1.59459,-407.531,-256.447)\"\n  }, /*#__PURE__*/React.createElement(\"path\", {\n    d: \"M463.786,466.7L374.501,415.151L374.501,404.407L463.786,455.956L463.786,466.7Z\",\n    style: {\n      fill: \"rgb(174,82,212)\"\n    }\n  })))));\n}\n\nconst ForwardRef = /*#__PURE__*/React.forwardRef(SvgAbout);\nexport default __webpack_public_path__ + \"static/media/about.a4d06242.svg\";\nexport { ForwardRef as ReactComponent };","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useCallback, useEffect, useRef, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { TextField } from '@material-ui/core'\nimport { isNil, isEmpty } from 'lodash'\nimport YAML from 'yaml'\n\n/**\n * Form used for editing a YAML or JSON config.\n */\nconst InputConfig = React.memo(({data, format, maxRows, minRows, onChange, error, onError, readOnly}) => {\n  const controlledError = useRef(error !== undefined)\n  const [serialized, setSerialized] = useState()\n  const [errorInternal, setErrorInternal] = useState()\n  const errorFinal = error || errorInternal\n  const formatLib = {\n    'JSON': JSON,\n    'YAML': YAML\n  }[format]\n\n  useEffect(() => {\n    setSerialized(isEmpty(data)\n      ? ''\n      : formatLib.stringify(\n        data,\n        (k, v) => { return v === Infinity ? \"Infinity\" : v },\n        2)\n    )\n  }, [data, formatLib])\n\n  const handleError = useCallback((e) => {\n    if (!controlledError.current) {\n      setErrorInternal(e)\n      onError && onError(e)\n    } else {\n      if (!isNil(e)) onError && onError(e)\n    }\n  }, [onError])\n\n  const handleChange = useCallback((event) => {\n    const value = event.target.value\n    setSerialized(value)\n    try {\n      const data = formatLib.parse(value)\n      onChange && onChange(data)\n      handleError(null)\n    } catch (e) {\n      handleError(`This is not ${format}: ` + e)\n    }\n  }, [onChange, handleError, formatLib, format])\n\n  return (\n    <TextField\n      fullWidth\n      label={format}\n      error={!!errorFinal}\n      helperText={errorFinal}\n      variant=\"filled\"\n      multiline\n      maxRows={maxRows}\n      minRows={minRows}\n      value={serialized}\n      onChange={handleChange}\n      InputProps={{\n        readOnly: readOnly\n      }}\n    />\n  )\n})\nInputConfig.propTypes = {\n  data: PropTypes.oneOfType([PropTypes.object, PropTypes.array]),\n  format: PropTypes.oneOf(['JSON', 'YAML']),\n  maxRows: PropTypes.number,\n  minRows: PropTypes.number,\n  onChange: PropTypes.func,\n  error: PropTypes.string,\n  onError: PropTypes.func,\n  readOnly: PropTypes.bool\n}\n\nInputConfig.defaultProps = {\n  format: 'JSON',\n  maxRows: 20\n}\n\nexport default InputConfig\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useLayoutEffect, useRef, useCallback, useEffect, useState, useMemo } from 'react'\nimport { ReactComponent as AboutSvg } from '../images/about.svg'\nimport PropTypes from 'prop-types'\nimport Markdown from './Markdown'\nimport { isNil } from 'lodash'\nimport { appBase, debug, encyclopediaBase, parserMetadata, toolkitMetadata as tutorials } from '../config'\nimport {\n  Button,\n  Card,\n  CardContent,\n  Dialog,\n  DialogTitle,\n  DialogContent,\n  DialogActions,\n  Grid,\n  Link,\n  makeStyles,\n  Typography\n} from '@material-ui/core'\nimport { Link as RouterLink, useHistory } from 'react-router-dom'\nimport InputConfig from './search/input/InputConfig'\nimport { useInfo } from './api'\nimport { pluralize } from '../utils'\n\n/**\n * Displays an info dialog.\n */\nfunction InfoDialog({title, data, DialogProps, onClose}) {\n  if (!data) return null\n\n  return <Dialog maxWidth='md' fullWidth open={true} {...DialogProps}>\n    <DialogTitle>{title}</DialogTitle>\n    <DialogContent>\n      <InputConfig data={data} format=\"YAML\" readOnly/>\n    </DialogContent>\n    <DialogActions>\n      <Button onClick={() => onClose?.()} color=\"primary\">\n        close\n      </Button>\n    </DialogActions>\n  </Dialog>\n}\nInfoDialog.propTypes = {\n  title: PropTypes.string,\n  data: PropTypes.object,\n  DialogProps: PropTypes.object,\n  onClose: PropTypes.func\n}\n\n/**\n * Displays a list of information about the version, plugin package and plugin\n * entry points.\n */\nexport const DistributionInfo = React.memo(({data}) => {\n  const [selected, setSelected] = useState()\n  const [title, setTitle] = useState()\n\n  const categories = useMemo(() => {\n    if (!data) return {}\n\n    const categories = {}\n    data.plugin_entry_points\n      .forEach((entryPoint) => {\n        let category = entryPoint.entry_point_type || entryPoint.plugin_type\n        // TODO: Schema plugins are recategorized as package plugins. This can be\n        // removed once all plugins have been migrated and we remove the old plugin\n        // models.\n        if (category === 'schema') {\n          category = 'schema_package'\n        }\n        category = category.replace('_', ' ')\n        if (categories[category]) {\n          categories[category].push(entryPoint)\n        } else {\n          categories[category] = [entryPoint]\n        }\n      })\n\n    Object.keys(categories).forEach(category => {\n      categories[category] = categories[category].sort((a, b) => {\n        const nameA = a.name\n        const nameB = b.name\n        return (nameA > nameB) ? 1 : -1\n      })\n    })\n\n    return categories\n  }, [data])\n\n  return data\n    ? <ul>\n        <li>version: {data.version}</li>\n        {data?.plugin_packages?.length\n          ? <li>{\"plugin packages: \"}\n            {data.plugin_packages.map((pluginPackage, i) => <>\n              <Link key={pluginPackage.name} href=\"#\" onClick={() => {\n                setSelected(pluginPackage)\n                setTitle('Plugin package')\n              }}>{pluginPackage.name}</Link>\n              {i !== data.plugin_packages.length - 1 ? \", \" : null}\n            </>)}\n          </li>\n          : null\n        }\n      {Object.keys(categories)\n        .sort()\n        .map((category) => {\n          const entryPoints = categories[category]\n          return <li key={category}>\n            {`${pluralize(category, 2)}: `}\n            {entryPoints\n            .sort((a, b) => (a.id > b.id) ? 1 : ((b.id > a.id) ? -1 : 0))\n            .map((entryPoint, i) => <>\n              <Link key={entryPoint.id} href=\"#\" onClick={() => {\n                setSelected(entryPoint)\n                setTitle('Plugin entry point')\n              }}>{entryPoint.id}</Link>\n              {i !== entryPoints.length - 1 ? \", \" : null}\n            </>)}\n          </li>\n      })}\n      <InfoDialog title={title} data={selected} onClose={() => setSelected(null)} />\n    </ul>\n    : 'Loading...'\n})\n\nDistributionInfo.propTypes = {\n  data: PropTypes.object\n}\n\nfunction CodeInfo({code, ...props}) {\n  if (!code) {\n    return null\n  }\n\n  const metadata = parserMetadata[code]\n\n  let introduction = `\n    For [${metadata.codeLabel || code}](${metadata.codeUrl}) please provide\n    all input and output files and any other relevant files you may have produced.\n  `\n  if (metadata.tableOfFiles && metadata.tableOfFiles !== '') {\n    introduction = `\n      For [${metadata.codeLabel || code}](${metadata.codeUrl}) please provide at least\n      the files from the following table (if applicable). We recommend to upload\n      all input and output files and any other relevant files you may have produced.\n      `\n  }\n\n  return <Dialog open={true} {...props}>\n    <DialogTitle>{metadata.codeLabel || code}</DialogTitle>\n    <DialogContent>\n      <Markdown>{`\n        ${introduction} All files located in the same directory as a *mainfile* (i.e. a parseable\n        file which defines an entry) are considered to be associated with the entry.\n        You should therefore put all files related to the same entry in the same directory.\n        However, try to avoid putting multiple *mainfiles* in the same directory, to avoid\n        confusion. For CMS calculations, we recommend a separate directory for each code run.\n\n        ${metadata.tableOfFiles}\n\n        ${(metadata.parserSpecific && metadata.parserSpecific !== '' &&\n        `Please note specifically for ${metadata.codeLabel || code}: ${metadata.parserSpecific}`) || ''}\n\n        You can find further information on [the project page for NOMAD's ${metadata.codeLabel || code} parser](${metadata.parserGitUrl}).\n      `}</Markdown>\n    </DialogContent>\n    <DialogActions>\n      <Button onClick={() => props.onClose && props.onClose()} color=\"primary\">\n        close\n      </Button>\n    </DialogActions>\n  </Dialog>\n}\nCodeInfo.propTypes = {\n  code: PropTypes.string,\n  onClose: PropTypes.func\n}\n\nexport const CodeList = React.memo(({withUploadInstructions}) => {\n  const [selected, setSelected] = useState(null)\n\n  // Create lists containing code name and category\n  const categorySizes = {}\n  const codes = Object.entries(parserMetadata)\n    .filter(([code, metadata]) => metadata && code !== 'example')\n    .map(([code, metadata], index) => {\n      const name = metadata.codeLabel || code\n      const category = metadata.codeCategory\n      if (categorySizes[category]) {\n        categorySizes[category] += 1\n      } else {\n        categorySizes[category] = 1\n      }\n\n      if (withUploadInstructions) {\n        return [code, category, <Link key={index} href=\"#\" onClick={() => setSelected(code)}>{name}</Link>]\n      } else if (metadata.codeUrl) {\n        return [code, category, <Link key={index} href={metadata.codeUrl} target=\"code\">{name}</Link>]\n      } else {\n        return [code, category, name]\n      }\n    })\n\n  // Sort by category size, then by program name. Codes without category go to\n  // the end.\n  codes.sort((a, b) => {\n    const nameA = a[0]\n    const nameB = b[0]\n    const categoryA = a[1]\n    const categoryB = b[1]\n    const sizeA = categorySizes[categoryA]\n    const sizeB = categorySizes[categoryB]\n    if (isNil(categoryA) && !isNil(categoryB)) return 1\n    if (isNil(categoryB) && !isNil(categoryA)) return -1\n    if (sizeA > sizeB) return -1\n    if (sizeA < sizeB) return 1\n    if (nameA > nameB) return 1\n    if (nameA < nameB) return -1\n    return 0\n  })\n\n  // Create a renderable version\n  let currentCategory = null\n  let categoryIndex = 0\n  const codeshtml = codes.reduce((list, value) => {\n    let index = -1\n    const categoryTmp = value[1]\n    const html = value[2]\n    const category = categoryTmp ? pluralize(categoryTmp) : 'Miscellaneous'\n\n    if (currentCategory !== category) {\n      index = 0\n      if (categoryIndex !== 0) {\n        list.push(', ')\n      }\n      list.push(<b> {category}: </b>)\n      categoryIndex += 1\n      currentCategory = category\n    }\n\n    if (html) {\n      if (index !== 0) {\n        list.push(', ')\n      }\n      list.push(html)\n    }\n    return list\n  }, [])\n\n  return <span data-testid=\"code-list\">\n    {codeshtml.map((html, index) => <React.Fragment key={`codeListFragment${index}`}>{html}</React.Fragment>)}\n    <CodeInfo code={selected} onClose={() => setSelected(null)} />\n  </span>\n})\nCodeList.propTypes = {\n  withUploadInstructions: PropTypes.bool\n}\n\nconst useCardStyles = makeStyles(theme => ({\n  title: {\n    marginBottom: theme.spacing(1)\n  }\n}))\n\nfunction InfoCard({title, children, xs, top, bottom}) {\n  const classes = useCardStyles()\n  const style = {}\n  if (top) {\n    style['paddingBottom'] = 0\n  }\n  if (bottom) {\n    style['paddingTop'] = 0\n  }\n  return <Grid item xs={xs} style={style}>\n    <Card>\n      <CardContent>\n        <Typography variant=\"h6\" className={classes.title}>{title}</Typography>\n        <Typography component=\"div\">{children}</Typography>\n      </CardContent>\n    </Card>\n  </Grid>\n}\nInfoCard.propTypes = {\n  title: PropTypes.string.isRequired,\n  children: PropTypes.node,\n  xs: PropTypes.number,\n  top: PropTypes.bool,\n  bottom: PropTypes.bool\n}\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    padding: theme.spacing(3)\n  },\n  container: {\n    maxWidth: 1024,\n    margin: 'auto',\n    width: '100%'\n  },\n  header: {\n    margin: '24px 0px'\n  }\n}))\n\nexport default function About() {\n  const classes = useStyles()\n  const info = useInfo()\n  const svg = useRef()\n  const history = useHistory()\n\n  const makeClickable = useCallback((id, onClick) => {\n    const element = svg.current.querySelector('#' + id)\n    element.style.cursor = 'pointer'\n    element.firstChild.onclick = () => {\n      onClick()\n    }\n  }, [svg])\n\n  const setText = useCallback((id, lines) => {\n    const element = svg.current.querySelector('#' + id)\n    const x = element.getAttribute('x')\n    element.innerHTML = lines.map((line, i) => `<tspan x=\"${x}\" dy=\"${i === 0 ? '0' : '1.2em'}\">${line}</tspan>`).join('')\n  }, [svg])\n\n  useLayoutEffect(() => {\n    makeClickable('upload', () => {\n      history.push('/upload')\n    })\n    if (encyclopediaBase) {\n      makeClickable('encyclopedia', () => {\n        window.location.href = encyclopediaBase\n      })\n    }\n    makeClickable('search', () => {\n      history.push('/search')\n    })\n  }, [svg, makeClickable, setText, history])\n\n  useEffect(() => {\n    const statistics = (info && {...info.statistics}) || {}\n    statistics.n_tutorials = tutorials?.tutorials?.length || 25\n    const value = (key, unit) => {\n      const nominal = statistics[key]\n      let stringValue = null\n      if (nominal) {\n        if (nominal >= 1.0e+9) {\n          stringValue = (nominal / 1.0e+9).toFixed(1) + ' billion'\n        } else if (nominal >= 1.0e+6) {\n          stringValue = (nominal / 1.0e+6).toFixed(1) + ' million'\n        } else if (nominal >= 1.0e+3) {\n          stringValue = (nominal / 1.0e+3).toFixed(1) + ' thousand'\n        } else {\n          stringValue = nominal.toString()\n        }\n        return `${stringValue || '...'} ${unit}`\n      } else {\n        return '...'\n      }\n    }\n    setText('repositoryStats', [\n      value('n_entries', 'entries')\n      // value('n_uploads', 'uploads')\n    ])\n    setText('archiveStats', [\n      value('n_calculations', 'results'),\n      value('n_quantities', 'quantities')\n    ])\n    setText('encStats', [\n      value('n_materials', 'materials')\n    ])\n    setText('toolkitStats', [\n      `${statistics.n_tutorials} notebooks`\n    ])\n  }, [svg, info, setText])\n\n  return <div className={classes.root}>\n    <Grid className={classes.container} container spacing={2}>\n      <Grid item xs={12}>\n        <Markdown>{`\n        # **NOMAD** &ndash; Manage and Publish Materials Data\n\n        This is the *graphical user interface* (GUI) of NOMAD. It allows you to **search,\n        access, and download all NOMAD data** in its\n        *raw files* and *processed data* form. You can **upload and manage your own\n        raw materials science data**. You can access all published data without an account.\n        If you want to provide your own data, please login or register for an account.\n\n        You can learn more about NOMAD on its\n        [homepage](https://nomad-lab.eu/repo-arch), our\n        [documentation](${appBase}/docs/index.html).\n        There is also an [FAQ](https://nomad-lab.eu/repository-archive-faqs)\n        and the more detailed [uploader documentation](${appBase}/docs/web.html).\n        `}</Markdown>\n      </Grid>\n      <InfoCard xs={6} title=\"Interactive Search\" top>\n        NOMAD extracts <b>rich metadata</b> from uploaded raw-data. <Link component={RouterLink} to={'/search'}>\n        Explore NOMAD&apos;s data</Link> by creating complex queries from interactive data visualizations of key\n        properties, including the simulated composition/system, used method, upload metadata,\n        as well as material classifications and available quantities. Or use\n        the <b>Optimade</b> filter language to add arbitrarily nested queries.\n      </InfoCard>\n      <InfoCard xs={6} title=\"A common data format\" top>\n        NOMAD provides data in <i>processed</i> and <i>normalized</i> form in a machine processable and common hierarchical format.\n        This <i>processed data</i>, i.e. the <b>NOMAD Archive</b>, is organized into nested sections of quantities with well defined units,\n        data types, shapes, and descriptions. These definitions are called the <b>NOMAD Metainfo</b> and they\n        can be <Link component={RouterLink} to={'/analyze/metainfo'}>browsed here</Link>.\n      </InfoCard>\n      <Grid item xs={12} style={{paddingTop: 0, paddingBottom: 0}}>\n        <AboutSvg ref={svg}></AboutSvg>\n      </Grid>\n      <InfoCard xs={4} title=\"Uploading is simple\" bottom>\n        <p>\n        You provide your own data <i>as is</i>. Just zip your files as they are,\n        including nested directory structures and potential auxiliary files, and upload\n        up to 32GB in a single .zip or .tar(.gz) file. NOMAD will automatically discover\n        and process the relevant files.\n        </p>\n        <p>\n        You can <b>privately</b> inspect, curate, or delete your data before publishing.\n        Data can be published with an <b>embargo (up to 3 years)</b> to only share data with\n        selected users.\n        </p>\n        <p>\n        Add additional metadata like <b>comments</b>, <b>references</b> to websites or papers, and\n        your <b>co-authors</b>. Organize the uploaded entries into <b>datasets</b> and\n        cite your data with a <b>DOI</b> that we provide on request.\n        </p>\n        <p>\n          You can provide via GUI or shell command or manage already uploaded\n          data <Link component={RouterLink} to={'/user'}>here</Link>.\n        </p>\n      </InfoCard>\n      <InfoCard xs={4} title=\"Processing\" bottom>\n        <p>\n        Uploaded data is automatically processed and made available\n        in the uploaded <b>raw files</b> or in its unified <b>processed data</b> form.\n        NOMAD parsers convert raw files into NOMAD&apos;s common data format.\n        You can inspect the processed data and extracted metadata before\n        publishing your data.\n        </p>\n        <p>NOMAD supports most community codes and file formats: <CodeList/></p>\n        <p>\n        To use NOMAD&apos;s parsers and normalizers outside of NOMAD read <Link href={`${appBase}/docs/local_parsers.html`}>here</Link>.\n        Read <Link href={`${appBase}/docs/pythonlib.html`}>here</Link> on how to install\n        our software and how to use NOMAD processing in your Python environment.\n        </p>\n      </InfoCard>\n      <InfoCard xs={4} title=\"APIs\" bottom><Markdown>{`\n      The NOMAD can also be accessed programmatically via ReST APIs.\n      There is the proprietary NOMAD API,an implementation of the\n      standardized [OPTiMaDe API](https://github.com/Materials-Consortia/OPTiMaDe/tree/master)\n      materials science database API, and more.\n\n      We offer a [tutorial on how to use the API with plain Python](${appBase}/docs/api.html).\n      Another [tutorial covers how to install and use NOMAD's Python client library](${appBase}/docs/archive.html).\n      The [NOMAD Analytics Toolkit](https://nomad-lab.eu/AIToolkit) allows to use\n      this without installation and directly on NOMAD servers.\n\n      Visit our [API page](/analyze/apis).\n      `}</Markdown></InfoCard>\n      <Grid item xs={12}>\n        <Markdown>{`\n        ### Getting Help\n        If you encounter any difficulties, please write to\n        support@nomad-lab.eu . If you think\n        that this web-page is not working as expected, or if you want to start a discussion\n        about possible features, feel free to open an issue on our\n        [github project](https://github.com/nomad-coe/nomad/issues).\n\n        ### Developer Documentation\n        The [in-depth documentation](${appBase}/docs/index.html)\n        contains a general introduction to NOMAD and its underlying architecture,\n        more information and tutorials, how to prepare uploads, how\n        to use the API, developer information, how to operate your own NOMAD (a so called\n        Oasis), how to contribute parsers, and much more.\n\n        ### Source code\n        The source-code for NOMAD is maintained\n        at the MPCDF's [gitlab](https://gitlab.mpcdf.mpg.de/nomad-lab/nomad-FAIR).\n        To push code, you need an MPCDF account and you can apply\n        [here](https://www.mpcdf.mpg.de/userspace/new-users).\n\n        ${debug ? `\n        ### Material science data and domains\n        Originally NOMAD was build for DFT calculations and data from the respective\n        community codes. But NOMAD is now extended to support multiple materials science domains,\n        such as experiments, synthesis, and computational methods at different scales.` : ''}\n\n        ${debug ? `\n        ### Log management with Elastic stack\n        We use a central logging system based on the *elastic*-stack\n        (previously called *Elastic Logstash Kibana* (ELK)-stack).\n        This system pushes logs, events, monitoring data,\n        and other application metrics to a central database where it\n        can be analysed visually by us.\n\n        ### Test user\n        During development this GUI might not be connected to the actual NOMAD\n        repository. Therefore, you cannot create a user or login with an existing\n        user. You might use the test user \\`leonard.hofstadter@nomad-fairdi.tests.de\\`\n        with password \\`password\\`. The user \\`sheldon.cooper@nomad-fairdi.tests.de\\` is\n        used for data that has no provenance with the original NOMAD CoE database.\n        ` : ''}\n        `}</Markdown>\n      </Grid>\n      <Grid item xs={12}>\n        <Typography variant='h5' className={classes.header}>About this distribution</Typography>\n        <DistributionInfo data={info} />\n      </Grid>\n    </Grid>\n  </div>\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useState } from 'react'\nimport PropTypes from 'prop-types'\nimport Alert from '@material-ui/lab/Alert'\nimport { hasWebGLSupport } from '../utils'\n\nexport class ErrorHandler extends React.Component {\n  state = {\n    hasError: false\n  }\n\n  static getDerivedStateFromError(error) {\n    return {\n      hasError: true,\n      error: error\n    }\n  }\n\n  componentDidCatch(error, errorInfo) {\n    console.log(error, errorInfo)\n  }\n\n  render() {\n    if (this.state.hasError) {\n      const msg = typeof this.props.message === 'string' ? this.props.message : this.props.message(this.state.error)\n      return <Alert\n        severity=\"error\"\n        className={this.props.className}\n        classes={this.props.classes}\n      >\n        {msg}\n      </Alert>\n    }\n    return this.props.children\n  }\n}\nErrorHandler.propTypes = ({\n  children: PropTypes.node,\n  message: PropTypes.oneOfType([PropTypes.string, PropTypes.func]), // Provide either a fixed error message or a callback that will receive the error details.\n  classes: PropTypes.object,\n  className: PropTypes.string\n})\n\nexport const withErrorHandler = (message) => (WrappedComponent) => props => {\n  return <ErrorHandler message={message}>\n    <WrappedComponent {...props}></WrappedComponent>\n  </ErrorHandler>\n}\nwithErrorHandler.propTypes = ({\n  message: PropTypes.oneOfType([PropTypes.string, PropTypes.func]) // Provide either a fixed error message or a callback that will receive the error details.\n})\n\nexport const webGlError = 'Could not display the visualization as your browser does not support WebGL content.'\nexport const withWebGLErrorHandler = WrappedComponent => props => {\n  const hasWebGL = useState(hasWebGLSupport())[0]\n\n  // If WebGL is not available, the content cannot be shown.\n  if (hasWebGL) {\n    return WrappedComponent({...props})\n  } else {\n    return <Alert\n      severity=\"info\"\n    >\n      {webGlError}\n    </Alert>\n  }\n}\n\nwithErrorHandler.propTypes = ({\n  message: PropTypes.oneOfType([PropTypes.string, PropTypes.func]) // Provide either a fixed error message or a callback that will receive the error details.\n})\n","import React, { useEffect, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { appBase } from '../../config'\nimport { H5GroveProvider, App } from '@h5web/app'\nimport { useApi } from '../api'\nimport { useErrors } from '../errors'\nimport axios from 'axios'\n\nimport '@h5web/lib/dist/styles.css'\nimport '@h5web/app/dist/styles.css'\nimport './H5Web.css'\n\nconst H5Web = ({upload_id, filename, initialPath, sidebarOpen, source}) => {\n  const {api} = useApi()\n  const {raiseError} = useErrors()\n  const [filepath, setFilepath] = useState(false)\n\n  if (!source) source = 'raw'\n\n  useEffect(() => {\n    if (filename && upload_id) {\n      if (filename.includes('.yaml') || filename.includes('.yml')) {\n        api.get(`/uploads/${upload_id}/raw/${filename}`)\n          .then(data => {\n            const fname = data.match(/output:[ \\t]*(.*nxs)/i)?.[1]\n            setFilepath(fname)\n          })\n          .catch(raiseError)\n      } else {\n        setFilepath(filename)\n      }\n    }\n  }, [filepath, api, filename, upload_id, raiseError])\n\n  if (filepath) {\n    return (\n      <H5GroveProvider\n        url={appBase + '/h5grove/'}\n        filepath={filepath}\n        getExportURL={(format, dataset, selection) => async () => {\n          const response = await axios.get(appBase + '/h5grove/data/', {\n            params: {\n              file: filepath, upload_id: upload_id, format, path: dataset.path, source: source\n            },\n            headers: {Authorization: \"Bearer \" + api?.keycloak?.token}\n          })\n          return new File([response.data], \"test.\" + format)\n        }}\n        axiosConfig={{params: {file: filepath, upload_id: upload_id, source: source}, headers: {Authorization: \"Bearer \" + api?.keycloak?.token}}}\n      >\n        <App disableDarkMode initialPath={initialPath} sidebarOpen={sidebarOpen}/>\n\n      </H5GroveProvider>\n    )\n  }\n  return 'Loading...'\n}\nH5Web.propTypes = {\n  upload_id: PropTypes.string.isRequired,\n  filename: PropTypes.string.isRequired,\n  initialPath: PropTypes.string.isRequired,\n  sidebarOpen: PropTypes.bool,\n  source: PropTypes.string\n}\n\nexport default H5Web\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {useCallback, useContext, useEffect, useLayoutEffect, useMemo, useRef, useState} from 'react'\nimport PropTypes from 'prop-types'\nimport { makeStyles, Card, CardContent, Box, Typography, Grid, Chip, Tooltip, IconButton } from '@material-ui/core'\nimport grey from '@material-ui/core/colors/grey'\nimport classNames from 'classnames'\nimport { useLocation, useRouteMatch, Link } from 'react-router-dom'\nimport { ErrorHandler } from '../ErrorHandler'\nimport { useDataStore } from '../DataStore'\nimport { useApi } from '../api'\nimport NavigateIcon from '@material-ui/icons/ArrowRight'\nimport H5Web from '../visualization/H5Web'\nimport {CopyToClipboard} from \"react-copy-to-clipboard\"\nimport ClipboardIcon from \"@material-ui/icons/Assignment\"\n\nfunction escapeBadPathChars(s) {\n  return s.replace(/!/g, '!0').replace(/\\?/g, '!1').replace(/#/g, '!2').replace(/%/g, '!3').replace(/\\\\/g, '!4')\n}\n\nfunction unescapeBadPathChars(s) {\n  return s.replace(/!4/g, '\\\\').replace(/!3/g, '%').replace(/!2/g, '#').replace(/!1/g, '?').replace(/!0/g, '!')\n}\n\n/**\n * Browsers are made out of lanes. Each lane uses an adaptor that determines how to render\n * the lane contents and what adaptor is used for the next lane (depending on what is\n * selected in this lane).\n */\nexport class Adaptor {\n  constructor() {\n    if (new.target === Adaptor) {\n      throw new TypeError('Cannot construct Abstract instances directly')\n    }\n  }\n\n  /**\n   * A potentially asynchronous method called to initialize an adaptor, before any\n   * calls are made to the itemAdaptor or render methods.\n   */\n  initialize(api, dataStore) {\n  }\n\n  /**\n   * A potentially asynchronous method called when the adaptor is cleaned up due to user navigation\n   */\n  cleanup() {\n  }\n\n  /**\n   * Optional additional methods:\n   *   onScrollToEnd: called when the user scrolls to the bottom of the lane. Useful to load more info.\n   *   onRendered: called in a useEffect after the adaptor has been rendered.\n   */\n\n  /**\n   * A potentially asynchronous method that is used to determine the adaptor for the\n   * next lane depending on the given key/url segment.\n   * @returns An adaptor that is used to render the next lane.\n   */\n  itemAdaptor(key) {\n    return null\n  }\n\n  /**\n   * Optionally returns a set of strings defining this lanes dependencies. These dependencies\n   * are used to determine if an adaptor is to be invalidated when calling invalidateLanesWithDependency\n   */\n  depends() {\n    return null\n  }\n\n  /**\n   * Renders the contents of the current lane (the lane that this adaptor represents).\n   */\n  render() {\n    return null\n  }\n}\n\nexport const browserContext = React.createContext()\n\nconst useBrowserStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex',\n    flexFlow: 'column',\n    margin: `-${theme.spacing(2)}px`,\n    marginBottom: `-${theme.spacing(3)}px`\n  },\n  lanesContainer: {\n    flex: '1 1 auto',\n    height: '100%',\n    overflowX: 'auto',\n    overflowY: 'hidden',\n    scrollBehavior: 'smooth'\n  },\n  lanes: {\n    display: 'flex',\n    overflow: 'hidden',\n    height: '100%',\n    overflowY: 'hidden',\n    width: 'fit-content'\n  },\n  sideLane: {\n    display: 'flex',\n    height: '100%'\n  }\n}))\nexport const Browser = React.memo(function Browser({adaptor, form}) {\n  const classes = useBrowserStyles()\n  const dataStore = useDataStore()\n  const rootRef = useRef()\n  const outerRef = useRef()\n  const innerRef = useRef()\n  const { pathname } = useLocation()\n  const { url } = useRouteMatch()\n\n  const { api } = useApi()\n\n  const [hdf5Path, setHdf5Path] = useState(null)\n  const [hdf5Filename, setHdf5Filename] = useState(null)\n\n  const checkHdf5Path = (m_nx_data_path) => {\n    if (typeof m_nx_data_path !== 'undefined') {\n      setHdf5Path(m_nx_data_path)\n    } else {\n      setHdf5Path(null)\n    }\n  }\n\n  const checkHdf5File = (m_nx_data_file) => {\n    if (typeof m_nx_data_file !== 'undefined') {\n      setHdf5Filename(m_nx_data_file)\n    }\n  }\n\n  useLayoutEffect(() => {\n    function update() {\n      const height = window.innerHeight - outerRef.current.getBoundingClientRect().top - 24\n      rootRef.current.style.height = `${height}px`\n      const scrollAmmount = innerRef.current.clientWidth - outerRef.current.clientWidth\n      outerRef.current.scrollLeft = Math.max(scrollAmmount, 0)\n    }\n    if (url !== undefined) {\n      update()\n      window.addEventListener('resize', update)\n      return () => window.removeEventListener('resize', update)\n    }\n  })\n\n  const [, setInternalRender] = useState(0)\n  const internalUpdate = useCallback(() => {\n    setInternalRender(current => current + 1)\n  }, [setInternalRender])\n  const lanes = useRef([])\n  const computingForUrl = useRef(null)\n  const computeLanes = useCallback(async () => {\n    if (!url || computingForUrl.current === url) {\n      // We have no url (happens if we navigate to a different tab), or we're already in the\n      // midst of computing lanes for this url\n      return\n    }\n    computingForUrl.current = url\n    const rootPath = url.endsWith('/') ? url.substring(0, url.length - 1) : url\n    const path = pathname?.replace(/\\/(-?\\d*)(\\/|$)/g, \":$1/\").replace(/\\/$/, \"\")\n    const segments = ['root'].concat(path.substring(url.length).split('/').filter(segment => segment))\n    const oldLanes = lanes.current\n    const newLanes = []\n\n    for (let index = 0; index < segments.length; index++) {\n      const segment = unescapeBadPathChars(segments[index])\n      const prev = index === 0 ? null : newLanes[index - 1]\n      let lane\n      let newLaneCreated = false\n\n      if (oldLanes[index]?.key === segment && !newLaneCreated) {\n        // reuse the existing lane (incl. its adaptor and data)\n        lane = oldLanes[index]\n        lane.next = null\n      } else {\n        // create new lane\n        lane = {\n          index: index,\n          key: segment,\n          path: prev ? prev.path + '/' + encodeURI(escapeBadPathChars(segment)) : rootPath,\n          next: null,\n          prev: prev,\n          initialized: false\n        }\n        if (!newLaneCreated) {\n          // First newly created lane. Cleanup all adaptors that are being discarded\n          oldLanes.slice(index).forEach(oldLane => oldLane.adaptor?.cleanup())\n        }\n        newLaneCreated = true\n\n        if (typeof adaptor?.obj?.metadata?.mainfile !== 'undefined') {\n          setHdf5Filename(adaptor?.obj?.metadata?.mainfile)\n        }\n\n        // Set or create the lane adaptor\n        if (!prev) {\n          // The root lane - use provided adaptor\n          lane.adaptor = adaptor\n        } else {\n          // Non-root lane - create adaptor\n          try {\n            lane.adaptor = await prev.adaptor.itemAdaptor(segment)\n            checkHdf5Path(lane.adaptor?.obj?.m_attributes?.m_nx_data_path)\n            checkHdf5File(lane.adaptor?.obj?.m_attributes?.m_nx_data_file)\n          } catch (error) {\n            console.log(error)\n            lane.error = `The item \"${segment}\" could not be found.`\n          }\n        }\n\n        // initialize the adaptor\n        if (lane.adaptor) {\n          try {\n            await lane.adaptor.initialize(api, dataStore)\n            lane.initialized = true\n          } catch (error) {\n            console.log(error)\n            lane.error = 'Could not initialize view' + (lane.index > 0 ? `: item \"${segment}\" not found.` : '.')\n          }\n        }\n      }\n\n      if (prev) {\n        prev.next = lane\n        checkHdf5Path(lane.adaptor?.obj?.m_attributes?.m_nx_data_path)\n        checkHdf5File(lane.adaptor?.obj?.m_attributes?.m_nx_data_file)\n      }\n      newLanes.push(lane)\n      if (lane.error) {\n        break // Ignore subsequent segments/lanes\n      }\n    }\n    lanes.current = newLanes\n    computingForUrl.current = null\n    internalUpdate()\n  }, [adaptor, api, dataStore, internalUpdate, url, pathname])\n\n  // Method used to invalidate and refresh lanes from the provided lane index and forward.\n  const invalidateLanesFromIndex = useCallback((index) => {\n    index = index || 0\n    const droppedLanes = lanes.current.splice(index)\n    droppedLanes.forEach(droppedLane => droppedLane.adaptor?.cleanup())\n    computeLanes()\n  }, [computeLanes])\n\n  // Method used to invalidate all lanes that have a certain dependency. The first lane which\n  // has this dependency, and all subsequent lanes, are invalidated.\n  const invalidateLanesWithDependency = useCallback((dependency) => {\n    for (const lane of lanes.current) {\n      const dependencies = lane.adaptor && lane.adaptor.depends()\n      if (dependencies && dependencies.has(dependency)) {\n        invalidateLanesFromIndex(lane.index)\n        return\n      }\n    }\n  }, [invalidateLanesFromIndex])\n\n  useEffect(() => {\n    return () => {\n      // Cleanup method, will run when the root adaptor changes or the Browser component is dismounted\n      // We should then cleanup all existing adaptors and not reuse any lanes.\n      lanes.current.forEach(lane => lane.adaptor?.cleanup())\n      lanes.current = []\n    }\n  }, [adaptor])\n\n  useEffect(() => {\n    computeLanes()\n  }, [computeLanes])\n\n  const contextValue = useMemo(() => {\n    return {\n      lanes,\n      invalidateLanesFromIndex,\n      invalidateLanesWithDependency\n    }\n  }, [lanes, invalidateLanesFromIndex, invalidateLanesWithDependency])\n\n  if (url === undefined) {\n    // Can happen when navigating to another tab, possibly with the browser's back/forward buttons\n    // We want to keep the cached lanes, in case the user goes back to this tab, so return immediately.\n    return null\n  }\n\n  return <browserContext.Provider value={contextValue}>\n    {form}\n      <Grid container direction=\"row\" spacing={2}>\n        <Grid item md={((hdf5Path && hdf5Filename) ? 8 : 12)}>\n        <Card>\n          <CardContent>\n        <div className={classes.root} ref={rootRef}>\n          <div className={classes.lanesContainer} ref={outerRef}>\n            <div className={classes.lanes} ref={innerRef}>\n              {lanes.current && lanes.current.map((lane, index) => (\n                <Lane key={`lane${index}`} lane={lane} />\n              ))}\n            </div>\n          </div>\n        </div>\n        </CardContent>\n        </Card>\n        </Grid>\n        {hdf5Path && hdf5Filename && adaptor?.obj?.metadata?.upload_id && <Grid item md={4} style={{visibility: (hdf5Path == null ? \"hidden\" : \"visible\")}}>\n          <Card className={classes.sideLane}>\n            {/* We use the key prop in the H5Web component here to force re-render on path changes while browsing with the browser. The prop, initialPath, does not re-render the component. */}\n            <H5Web key={hdf5Path} upload_id={adaptor?.obj?.metadata?.upload_id} filename={hdf5Filename} initialPath={hdf5Path} sidebarOpen={false}/>\n          </Card>\n        </Grid>}\n      </Grid>\n  </browserContext.Provider>\n})\nBrowser.propTypes = ({\n  adaptor: PropTypes.object.isRequired,\n  form: PropTypes.node\n})\nexport default Browser\n\nexport const laneContext = React.createContext()\n\nexport const useLane = () => {\n  return useContext(laneContext)\n}\n\nexport const laneErrorBoundryMessage = 'This section could not be rendered, due to an unexpected error'\n\nconst useLaneStyles = makeStyles(theme => ({\n  root: {\n    width: 'min-content',\n    borderRight: `solid 1px ${grey[500]}`,\n    display: 'inline-block'\n  },\n  container: {\n    display: 'inline-block',\n    height: '100%',\n    overflowX: 'clip',\n    overflowY: 'scroll'\n  },\n  error: {\n    margin: theme.spacing(1),\n    minWidth: 300\n  }\n}))\nfunction Lane({lane}) {\n  const classes = useLaneStyles()\n  const containerRef = useRef(null)\n  const { key, adaptor, next, initialized, error } = lane\n  const oldScrollValue = useRef(0)\n  lane.containerRef = containerRef\n  const [internalUpdate, setInternalRender] = useState(0)\n  const updateLane = useCallback(() => {\n    setInternalRender(current => current + 1)\n  }, [setInternalRender])\n\n  const handleScroll = useCallback((e) => {\n    if (adaptor.onScrollToEnd) {\n      const threshold = (e.target.scrollHeight - e.target.clientHeight) * 95 / 100\n      if (e.target.scrollTop >= threshold && oldScrollValue.current < threshold) {\n        adaptor.onScrollToEnd(e, updateLane)\n      }\n      oldScrollValue.current = e.target.scrollTop\n    }\n  }, [adaptor, updateLane])\n\n  const content = useMemo(() => {\n    if (error) {\n      return <div className={classes.error}>\n        <Typography variant=\"h6\" color=\"error\">ERROR</Typography>\n        <Typography color=\"error\">{error}</Typography>\n      </div>\n    }\n    if (!adaptor || !initialized) {\n      return null\n    }\n    return <div className={classes.root} key={`lane:${lane.path}`} data-testid={`lane${lane.index}:${lane.key}`}>\n      <div className={classes.container} ref={containerRef} onScroll={handleScroll}>\n        <laneContext.Provider value={lane}>\n          <ErrorHandler message={laneErrorBoundryMessage} className={classes.error}>\n            {adaptor.render()}\n          </ErrorHandler>\n        </laneContext.Provider>\n      </div>\n    </div>\n    // We deliberetly break the React rules here. The goal is to only update if the\n    // lanes contents change and not the lane object.\n    // eslint-disable-next-line\n  }, [lane, key, adaptor, initialized, next?.key, classes, error, internalUpdate])\n\n  useEffect(() => {\n    if (adaptor && initialized && containerRef.current && adaptor.onRendered) {\n      adaptor.onRendered({target: containerRef.current}, updateLane)\n    }\n    // eslint-disable-next-line\n  }, [key, adaptor, internalUpdate, updateLane])\n\n  return content\n}\nLane.propTypes = ({\n  lane: PropTypes.object.isRequired\n})\n\nconst useItemStyles = makeStyles(theme => ({\n  root: {\n    color: theme.palette.text.primary,\n    textDecoration: 'none',\n    margin: `0 -${theme.spacing(1)}px`,\n    padding: `0 0 0 ${theme.spacing(1)}px`,\n    whiteSpace: 'nowrap',\n    display: 'flex',\n    '& $icon': {\n      color: theme.palette.grey[700]\n    }\n  },\n  rootSelected: {\n    backgroundColor: theme.palette.primary.main,\n    color: theme.palette.primary.contrastText,\n    whiteSpace: 'nowrap',\n    '& $icon': {\n      color: theme.palette.primary.contrastText\n    }\n  },\n  rootUnSelected: {\n    '&:hover': {\n      backgroundColor: grey[300]\n    }\n  },\n  rootUnSelectedHighlighted: {\n    color: theme.palette.primary.main,\n    '& $icon': {\n      color: theme.palette.primary.main\n    },\n    '&:hover': {\n      backgroundColor: grey[300]\n    }\n  },\n  disabled: {\n    color: 'grey'\n  },\n  rightPaddedItem: {\n    padding: `0 ${theme.spacing(1)}px 0 0`\n  },\n  childContainer: {\n    flexGrow: 1,\n    overflow: 'hidden',\n    textOverflow: 'ellipsis',\n    whiteSpace: 'nowrap'\n  },\n  icon: {\n    fontSize: 16,\n    marginTop: 4\n  }\n}))\n\nconst ItemLink = React.forwardRef(function ItemLink({itemKey, ...props}, ref) {\n  const lane = useContext(laneContext)\n  if (lane && itemKey) {\n    return <Link\n      {...props}\n      data-testid={`item:${itemKey}`}\n      to={`${lane.path}/${encodeURI(escapeBadPathChars(itemKey))}`}\n    />\n  } else {\n    // If this is used in a non Browser context\n    return <div\n      {...props}\n      data-testid={`item:${itemKey}`}\n    />\n  }\n})\nItemLink.propTypes = {\n  itemKey: PropTypes.string.isRequired\n}\n\nexport function ItemButton({itemKey, itemLink, icon, ...props}) {\n  // ItemButtons are often used in clickable context and we should stop the propagation\n  // of click events to prevent unwanted behavior.\n  const handleClick = useCallback((event) => {\n    event.stopPropagation()\n  }, [])\n  return (\n      <IconButton {...props} component={itemLink || ItemLink} itemKey={itemKey} onClick={handleClick}>\n        {icon || <NavigateIcon/>}\n      </IconButton>\n  )\n}\nItemButton.propTypes = {\n  itemKey: PropTypes.string.isRequired,\n  itemLink: PropTypes.element,\n  icon: PropTypes.node\n}\n\nexport function Item({children, itemKey, length, disabled, highlighted, icon, actions, chip}) {\n  const classes = useItemStyles()\n  const lane = useLane()\n  let selected = lane?.next && lane?.next.key\n  let [label, index] = selected ? selected.split(':') : []\n  if (index && length) {\n    index = parseInt(index)\n    if (index < 0) index = index + length\n    selected = `${label}:${index}`\n  }\n  const isSelected = itemKey && (selected === itemKey || selected?.replace(':', '/') === itemKey)\n  if (disabled) {\n    return <Grid\n      container spacing={0} alignItems=\"center\" wrap=\"nowrap\"\n      style={{padding: 0, margin: 0}}\n    >\n      {icon && <Grid item className={classes.rightPaddedItem}>\n        {React.createElement(icon, {fontSize: 'small', className: classes.icon})}\n      </Grid>}\n      <Grid item className={classNames(classes.childContainer, classes.disabled, classes.rightPaddedItem)}>\n        <Typography noWrap>{children}</Typography>\n      </Grid>\n      {actions && <Grid item>\n        {actions}\n      </Grid>}\n    </Grid>\n  }\n\n  return <ItemLink\n    className={classNames(\n      classes.root,\n      isSelected ? classes.rootSelected : highlighted ? classes.rootUnSelectedHighlighted : classes.rootUnSelected\n    )}\n    itemKey={itemKey}\n  >\n    <Grid\n      container spacing={0} alignItems=\"center\" wrap=\"nowrap\"\n      style={{padding: 0, margin: 0}}\n    >\n      {icon && <Grid item className={classes.rightPaddedItem}>\n        {React.createElement(icon, {fontSize: 'small', className: classes.icon})}\n      </Grid>}\n      <Grid item className={classNames(classes.childContainer, classes.rightPaddedItem)}>\n        {children}\n      </Grid>\n      {chip && (\n        <Grid item className={classes.rightPaddedItem}>\n          <Chip size=\"small\" color={isSelected ? 'primary' : 'default'} label={chip} />\n        </Grid>\n      )}\n      {actions && <Grid item className={classes.rightPaddedItem}>\n        {actions}\n      </Grid>}\n      {itemKey && <Grid item style={{padding: 0}}>\n        <NavigateIcon padding=\"0\"/>\n      </Grid>}\n    </Grid>\n  </ItemLink>\n}\nItem.propTypes = ({\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ]).isRequired,\n  itemKey: PropTypes.string,\n  length: PropTypes.number,\n  disabled: PropTypes.bool,\n  highlighted: PropTypes.bool,\n  icon: PropTypes.elementType,\n  chip: PropTypes.string,\n  actions: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ]),\n  open: PropTypes.bool,\n  onClick: PropTypes.func\n})\n\nexport function Content(props) {\n  return <Box minWidth={300} maxWidth={600} padding={1} {...props} />\n}\n\nexport function Compartment({title, children, color, startCollapsed, onUnfold}) {\n  const [collapsed, setCollapsed] = useState(startCollapsed)\n  const handleClick = useCallback(() => {\n    setCollapsed(value => !value)\n    onUnfold && onUnfold()\n  }, [setCollapsed, onUnfold])\n  if (!React.Children.count(children)) {\n    return null\n  }\n\n  return <React.Fragment>\n    <Box paddingTop={1} whiteSpace=\"nowrap\" onClick={(handleClick)} style={{cursor: 'pointer'}} data-testid={'compartment'}>\n      {title && <Typography color={color} variant=\"overline\">{title}</Typography>}\n      {collapsed && <ItemChip label=\"closed\" color=\"primary\" data-testid={`collapsed:${title}`}/>}\n    </Box>\n    {(!collapsed) && children}\n  </React.Fragment>\n}\nCompartment.propTypes = ({\n  title: PropTypes.string,\n  color: PropTypes.string,\n  startCollapsed: PropTypes.bool,\n  onUnfold: PropTypes.func,\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ]).isRequired\n})\n\nconst useTitleStyles = makeStyles(theme => ({\n  titleGridItem: {\n    flexGrow: 1,\n    overflow: 'hidden',\n    textOverflow: 'ellipsis'\n  },\n  sectionLabel: {\n    whiteSpace: 'nowrap'\n  },\n  sectionValue: {\n    whiteSpace: 'nowrap',\n    overflow: 'hidden',\n    display: 'flex',\n    marginLeft: 3\n  },\n  sectionName: {\n    overflow: 'hidden',\n    whiteSpace: 'nowrap',\n    textOverflow: 'ellipsis',\n    flexShrink: 1\n  }\n}))\n\nfunction LinkWithCopyToClipboard(props) {\n  const classes = useTitleStyles()\n  const {label, name, itemKey, ...moreProps} = props\n  const lane = useLane()\n  const selected = lane?.next && lane?.next.key\n  const isSelected = itemKey && (selected === itemKey)\n\n  return <Box display={'flex'} alignItems={'center'} marginBottom={1}>\n    {label && (\n      <Typography className={classes.sectionLabel} color={moreProps.color}>\n        {label}\n      </Typography>\n    )}\n    {name && (\n      <Box className={classes.sectionValue}>\n        <ItemLink itemKey={itemKey} className={classes.sectionValue} style={{ textDecoration: 'none' }}>\n          {isSelected\n            ? <Chip\n              classes={{label: classes.sectionName}}\n              style={{maxWidth: '100%'}}\n              label={name}\n              color=\"primary\"\n              size=\"small\"\n            />\n            : <Typography className={classes.sectionName} color={'primary'}>\n              {name}\n            </Typography>}\n        </ItemLink>\n        <CopyToClipboard\n          text={name}\n          onCopy={() => null}\n        >\n          <Tooltip title={`Copy \"${name}\" to clipboard`}>\n            <IconButton style={{ padding: 0, marginLeft: 3 }}>\n              <ClipboardIcon fontSize=\"small\"/>\n            </IconButton>\n          </Tooltip>\n        </CopyToClipboard>\n      </Box>\n    )}\n  </Box>\n}\nLinkWithCopyToClipboard.propTypes = ({\n  label: PropTypes.string,\n  name: PropTypes.string,\n  itemKey: PropTypes.string\n})\n\nexport function Title({title, label, definitionName, subSectionName, tooltip, actions, ...moreProps}) {\n  const classes = useTitleStyles()\n  return <Compartment>\n    <Grid container justifyContent=\"space-between\" wrap=\"nowrap\" spacing={1}>\n      <Grid item className={classes.titleGridItem}>\n        {tooltip ? (\n          <Tooltip title={tooltip}>\n            <Typography variant=\"h6\" noWrap {...moreProps}>{title || <i>unnamed</i>}</Typography>\n          </Tooltip>\n        ) : (\n          <Typography variant=\"h6\" noWrap {...moreProps}>{title || <i>unnamed</i>}</Typography>\n        )}\n      </Grid>\n      {actions && (\n        <Grid item>\n          {actions}\n        </Grid>\n      )}\n    </Grid>\n    <Box display={'block'} flexDirection={'column'} width={'100%'}>\n      {definitionName ? <LinkWithCopyToClipboard label={label} name={definitionName} itemKey={'_metainfo'} {...moreProps}/> : <LinkWithCopyToClipboard label={label} {...moreProps}/>}\n      {subSectionName && <LinkWithCopyToClipboard label={'sub section'} name={subSectionName} itemKey={'_subsectionmetainfo'} {...moreProps}/>}\n    </Box>\n  </Compartment>\n}\nTitle.propTypes = ({\n  title: PropTypes.string,\n  label: PropTypes.string,\n  definitionName: PropTypes.string,\n  subSectionName: PropTypes.string,\n  tooltip: PropTypes.string,\n  actions: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ])\n})\n\nexport function ItemChip(props) {\n  return <Chip style={{marginLeft: 8, marginBottom: 3, height: 18}} size=\"small\" {...props} />\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { apiBase } from '../../config'\nimport { makeStyles, Tooltip } from '@material-ui/core'\n\nconst useStyles = makeStyles(theme => ({\n  root: {}\n}))\n\nexport const Download = React.memo(function Download(props) {\n  const classes = useStyles(props)\n  const {url, component, children, disabled, color, size, tooltip} = props\n\n  const handleClick = () => {\n    window.location.assign(`${apiBase}/v1/${url}`)\n  }\n\n  const Component = component\n\n  const button = (\n    <Component\n      className={classes.root}\n      disabled={disabled} color={color} size={size}\n      onClick={handleClick}\n      data-testid={props['data-testid']}\n    >\n      {children}\n    </Component>\n  )\n\n  if (tooltip && !disabled) {\n    return <Tooltip title={tooltip}>{button}</Tooltip>\n  } else {\n    return button\n  }\n})\nDownload.propTypes = {\n  url: PropTypes.string,\n  component: PropTypes.any,\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ]).isRequired,\n  disabled: PropTypes.bool,\n  tooltip: PropTypes.string,\n  color: PropTypes.string,\n  size: PropTypes.string,\n  'data-testid': PropTypes.string\n}\n\nexport default Download\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { withStyles, IconButton, Tooltip, Link } from '@material-ui/core'\nimport ClipboardIcon from '@material-ui/icons/Assignment'\nimport { CopyToClipboard } from 'react-copy-to-clipboard'\n\nclass DOIUnstyled extends React.Component {\n  static propTypes = {\n    classes: PropTypes.object.isRequired,\n    doi: PropTypes.string.isRequired,\n    parentheses: PropTypes.bool\n  }\n\n  static defaultProps = {\n    parentheses: false\n  }\n\n  static styles = theme => ({\n    root: {\n      display: 'inline-flex',\n      alignItems: 'center',\n      flexDirection: 'row',\n      flexWrap: 'nowrap'\n    }\n  })\n\n  render() {\n    const {classes, doi, parentheses} = this.props\n    const url = `https://dx.doi.org/${doi}`\n    return <span className={classes.root}>\n      {parentheses && <div style={{marginRight: 0}}>(</div>}\n      <Link href={url}>{doi}</Link>\n      <CopyToClipboard\n        text={url} onCopy={() => null}\n      >\n        <Tooltip title={`Copy DOI to clipboard`}>\n          <IconButton style={{margin: 3, marginRight: 0, padding: 4}}>\n            <ClipboardIcon style={{fontSize: 16}} />\n          </IconButton>\n        </Tooltip>\n      </CopyToClipboard>\n      {parentheses && <div style={{marginRight: 0}}>)</div>}\n    </span>\n  }\n}\n\nexport const DOI = withStyles(DOIUnstyled.styles)(DOIUnstyled)\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useMemo } from 'react'\nimport { isArray } from 'lodash'\nimport { Typography, makeStyles, useTheme } from '@material-ui/core'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\n\n/**\n * Component that is used as a replacement for data that is not available.\n * Notice that this is different from invalid data (this should display an\n * ErrorCard) or from a placeholder!\n */\n\n// These styles do not depend on any props: they can be created once and are\n// shared by each instance.\nconst useStyles = makeStyles(theme => ({\n  root: {\n    width: '100%',\n    height: '100%',\n    position: 'relative'\n  },\n  placeholder: {\n    width: '100%',\n    height: '100%',\n    backgroundColor: theme.palette.grey[100],\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center'\n  },\n  message: {\n    color: theme.palette.primary.main,\n    fontStyle: 'italic',\n    opacity: 0.5,\n    userSelect: 'none'\n  }\n}))\nexport default function NoData({\n  className,\n  margin,\n  'data-testid': testID\n}) {\n  const styles = useStyles()\n  const theme = useTheme()\n  const margins = useMemo(() => {\n    let marginTop, marginRight, marginBottom, marginLeft\n    if (isArray(margin)) {\n      marginTop = margin[0]\n      marginRight = margin[1]\n      marginBottom = margin[2]\n      marginLeft = margin[3]\n    } else {\n      marginTop = margin\n      marginRight = margin\n      marginBottom = margin\n      marginLeft = margin\n    }\n    return {\n      position: 'absolute',\n      top: theme.spacing(marginTop),\n      left: theme.spacing(marginLeft),\n      right: theme.spacing(marginRight),\n      bottom: theme.spacing(marginBottom)\n    }\n  }, [theme, margin])\n\n  return <div className={clsx(className, styles.root)} data-testid={testID}>\n    <div style={margins}>\n      <div className={styles.placeholder}>\n        <Typography className={styles.message}>no data</Typography>\n      </div>\n    </div>\n  </div>\n}\n\nNoData.propTypes = {\n  className: PropTypes.string,\n  /**\n   * Margin with respect to the parent in theme spacing units.\n   */\n  margin: PropTypes.oneOfType([PropTypes.number, PropTypes.arrayOf(PropTypes.number)]),\n  'data-testid': PropTypes.string\n}\n\nNoData.defaultProps = {\n  margin: [0, 1, 0, 1]\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useMemo, useContext, useCallback} from 'react'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\nimport {\n  makeStyles,\n  Typography,\n  Tooltip,\n  IconButton,\n  TableBody,\n  TableContainer,\n  TableHead,\n  Table,\n  TableRow,\n  TableCell,\n  Link,\n  Box\n} from '@material-ui/core'\nimport { DOI } from './dataset/DOI'\nimport ClipboardIcon from '@material-ui/icons/Assignment'\nimport { CopyToClipboard } from 'react-copy-to-clipboard'\nimport { get, isNil, isString, isNumber } from 'lodash'\nimport { searchQuantities } from '../config'\nimport Placeholder from './visualization/Placeholder'\nimport Ellipsis from './visualization/Ellipsis'\nimport NoData from './visualization/NoData'\nimport {formatNumber, formatTimestamp, authorList, serializeMetainfo, getDisplayLabel} from '../utils'\nimport { Quantity as Q } from './units/Quantity'\nimport { Unit } from './units/Unit'\nimport { useUnitContext } from './units/UnitContext'\nimport { defaultFilterData } from './search/FilterRegistry'\nimport { MaterialLink, RouteLink } from './nav/Routes'\n\n/**\n * Component for showing a metainfo quantity value together with a name and\n * description.\n*/\nconst useQuantityStyles = makeStyles(theme => ({\n  root: {\n    width: '100%'\n  },\n  valueContainer: {\n    display: 'flex',\n    alignItems: 'center',\n    flexDirection: 'row',\n    maxWidth: '100%'\n  },\n  value: {\n    flexGrow: 1\n  },\n  valueAction: {},\n  valueActionButton: {\n    padding: 4\n  },\n  valueActionIcon: {\n    fontSize: 16\n  },\n  row: {\n    display: 'flex',\n    flexWrap: 'wrap',\n    flexDirection: 'row',\n    '& > :not(:last-child)': {\n      marginRight: theme.spacing(3)\n    }\n  },\n  column: {\n    display: 'flex',\n    flexDirection: 'column',\n    '& > :not(:first-child)': {\n      marginTop: theme.spacing(1)\n    }\n  },\n  flex: {\n    display: 'flex',\n    flexDirection: 'row',\n    flexWrap: 'wrap',\n    alignContent: 'flex-start',\n    '& div': {\n      marginRight: theme.spacing(1)\n    }\n  },\n  label: {\n    color: 'rgba(0, 0, 0, 0.54)',\n    fontSize: '0.75rem',\n    fontWeight: 500\n  },\n  quantityList: {\n    display: 'flex',\n    flexDirection: 'column'\n  }\n}))\n\nconst Quantity = React.memo((props) => {\n  const styles = useQuantityStyles()\n  const presets = quantityPresets[props.quantity] || {}\n  const {\n    quantity,\n    label,\n    description,\n    value,\n    loading,\n    placeholder,\n    typography,\n    noWrap,\n    noLabel,\n    row,\n    column,\n    flex,\n    data,\n    withClipboard,\n    ellipsisFront,\n    hideIfUnavailable,\n    maxWidth,\n    format\n  } = {...presets, ...props}\n\n  const getRenderFromType = useCallback((quantity, data) => {\n    const type = quantity.type\n    const value = data[quantity.name]\n    if (type.type_data === 'str') {\n      return <Typography noWrap>\n        {value}\n      </Typography>\n    } else if (typeof value === 'boolean') {\n      return <Typography noWrap>\n        {value.toString()}\n      </Typography>\n    } else if (type.type_data === 'nomad.metainfo.metainfo._Datetime' || type.type_data === 'nomad.metainfo.data_type.Datetime') {\n      return <Typography noWrap>\n        {formatTimestamp(value)}\n      </Typography>\n    } else if (type.type_data === 'nomad.metainfo.metainfo._JSON' || type.type_data === 'nomad.metainfo.data_type.JSON') {\n      return <Typography noWrap>\n        JSON Formatted Data\n      </Typography>\n    }\n    return <Typography noWrap>\n      {value}\n    </Typography>\n  }, [])\n\n  // Determine the rendered children. They may have been given explicitly, or\n  // this quantity may have a default rendering function for a value, or this\n  // quantity may have a default rendering function for data, or the data type\n  // may be associated with a particular rendering function.\n  const children = props.children ||\n    ((presets.render && !isNil(data)) && presets.render(data)) ||\n    ((presets.renderValue && !isNil(value)) && presets.renderValue(value)) ||\n    ((quantity?.name && !isNil(quantity.type)) && getRenderFromType(quantity, data))\n\n  const {units} = useUnitContext()\n  let content = null\n  let clipboardContent = null\n\n  const isQuantityString = isString(quantity)\n  const def = isQuantityString\n    ? (searchQuantities[quantity])\n    : quantity?.name && quantity.type && quantity\n\n  // Determine the final label to show\n  const useLabel = useMemo(() => {\n    let useLabel = label\n    if (!useLabel) {\n      // Primarily use a lowercase 'pretty' label if one is defined in FilterRegistry\n      if (isQuantityString && defaultFilterData?.[quantity]?.label) {\n        useLabel = defaultFilterData?.[quantity]?.label\n      // Alternatively use the original name in metainfo, underscores replaced by spaces\n      } else if (def?.name) {\n        useLabel = getDisplayLabel(def)\n      } else if (isQuantityString) {\n        useLabel = quantity\n      } else {\n        useLabel = 'MISSING LABEL'\n      }\n    }\n    return useLabel\n  }, [quantity, label, def, isQuantityString])\n\n  const tooltip = description || def?.description || ''\n\n  // Determine the final value to show.\n  if (!loading) {\n    let finalValue = value\n    if (isNil(value)) {\n      if (typeof quantity === 'string') {\n        finalValue = data && quantity && get(data, quantity)\n      } else if (children) {\n      } else {\n        try {\n          finalValue = quantity(data)\n        } catch {\n          finalValue = undefined\n        }\n      }\n    }\n\n    if (finalValue === 'not processed') {\n      finalValue = 'unavailable'\n    }\n\n    if (finalValue === 'unavailable') {\n      finalValue = ''\n    }\n\n    if (format) {\n      finalValue = serializeMetainfo(quantity, finalValue, units)\n    }\n\n    if ((!finalValue && !children) && hideIfUnavailable) {\n      return null\n    }\n\n    if (finalValue && Array.isArray(finalValue)) {\n      finalValue = finalValue.join(', ')\n    }\n    clipboardContent = clipboardContent || finalValue\n\n    if (children && children.length !== 0) {\n      content = children\n    } else if (finalValue || finalValue === 0) {\n      content = <Typography noWrap={noWrap} variant={typography} className={styles.value}>\n        {(noWrap && ellipsisFront)\n          ? <Ellipsis front={ellipsisFront}>{finalValue}</Ellipsis>\n          : finalValue\n        }\n      </Typography>\n    } else {\n      content = <Typography noWrap={noWrap} variant={typography} className={styles.value}>\n        <i>{placeholder || 'unavailable'}</i>\n      </Typography>\n    }\n  }\n\n  if (row || column || flex) {\n    return <div className={row ? styles.row : (column ? styles.column : styles.flex)} data-testid={`quantity-${def?.name}`}>{children}</div>\n  } else {\n    return (\n      <div className={styles.root} style={{maxWidth: maxWidth}} data-testid={noLabel ? undefined : `quantity-${def?.name}`}>\n        {!noLabel ? <Typography\n          noWrap\n          classes={{root: styles.label}}\n          variant=\"caption\"\n        >{useLabel}</Typography> : ''}\n        <div className={styles.valueContainer}>\n          {loading\n            ? <Typography noWrap={noWrap} variant={typography} className={styles.value}>\n              <i>loading ...</i>\n            </Typography>\n            // The tooltip portal is disabled for custom contents that may\n            // contain links. Pressing a link while the tooltip is shown will\n            // cause a navigation that leaves the popup opened (the Tooltip\n            // state does not get updated since the page may be cached and a new\n            // page is shown immediately).\n            : <Tooltip title={tooltip} PopperProps={children ? {disablePortal: true} : undefined}>\n              {content}\n            </Tooltip>\n          }\n          {withClipboard\n            ? <CopyToClipboard\n              className={styles.valueAction}\n              text={clipboardContent}\n              onCopy={() => null}\n            >\n              <Tooltip title={`Copy ${useLabel} to clipboard`}>\n                <div>\n                  <IconButton\n                    disabled={!clipboardContent}\n                    classes={{root: styles.valueActionButton}}\n                  >\n                    <ClipboardIcon classes={{root: styles.valueActionIcon}}/>\n                  </IconButton>\n                </div>\n              </Tooltip>\n            </CopyToClipboard>\n            : ''\n          }\n        </div>\n      </div>\n    )\n  }\n})\n\nQuantity.propTypes = {\n  children: PropTypes.node,\n  label: PropTypes.string,\n  typography: PropTypes.string,\n  loading: PropTypes.bool,\n  placeholder: PropTypes.string,\n  noWrap: PropTypes.bool,\n  noLabel: PropTypes.bool,\n  row: PropTypes.bool,\n  column: PropTypes.bool,\n  flex: PropTypes.bool,\n  data: PropTypes.object,\n  value: PropTypes.any,\n  quantity: PropTypes.oneOfType([\n    PropTypes.string,\n    PropTypes.func,\n    PropTypes.object\n  ]),\n  withClipboard: PropTypes.bool,\n  ellipsisFront: PropTypes.bool,\n  hideIfUnavailable: PropTypes.bool,\n  description: PropTypes.string,\n  format: PropTypes.bool,\n  maxWidth: PropTypes.string\n}\n\nQuantity.defaultProps = {\n  maxWidth: '280px'\n}\n\nexport default Quantity\n\n// Preset configuration for quantities\nconst nElementMap = {\n  1: 'unary',\n  2: 'binary',\n  3: 'ternary',\n  4: 'quaternary',\n  5: 'quinary',\n  6: 'sexinary',\n  7: 'septenary',\n  8: 'octanary',\n  9: 'nonary',\n  10: 'decimary'\n}\nconst quantityPresets = {\n  datasets: {\n    label: 'Datasets',\n    placeholder: 'no datasets',\n    render: (data) => (data.datasets && data.datasets.length !== 0) &&\n      <div>\n        {data.datasets.map(ds => (\n          <Typography key={ds.dataset_id}>\n            <RouteLink path={`dataset/id/${ds.dataset_id}`}>{ds.dataset_name}</RouteLink>\n            {ds.doi ? <span>&nbsp;<DOI style={{display: 'inline'}} parentheses doi={ds.doi}/></span> : ''}\n          </Typography>))}\n      </div>\n  },\n  authors: {\n    label: 'Authors',\n    placeholder: 'no authors',\n    render: (data) => <Typography>\n      {authorList(data || [], true)}\n    </Typography>\n  },\n  references: {\n    label: 'References',\n    placeholder: 'no references',\n    render: (data) => (data?.references && <div style={{display: 'inline-grid'}}>\n      {data.references.map(ref => <Typography key={ref} noWrap>\n        <Link href={ref}>{ref}</Link>\n      </Typography>)}\n    </div>)\n  },\n  comment: {\n    label: 'Comment',\n    placeholder: 'no comment'\n  },\n  upload_id: {\n    noWrap: true,\n    withClipboard: true,\n    render: (data) => (\n      <Box flexGrow={1}>\n        <Typography noWrap>\n          <RouteLink path={`upload/id/${data.upload_id}`}>{data.upload_id}</RouteLink>\n        </Typography>\n      </Box>\n    )\n  },\n  last_processing_time: {\n    noWrap: true,\n    placeholder: 'not processed',\n    render: (data) => <Typography noWrap>\n      {formatTimestamp(data.last_processing_time)}\n    </Typography>\n  },\n  last_processing_version: {\n    description: 'Version used in the last processing',\n    label: 'Processing version',\n    noWrap: true,\n    placeholder: 'not processed',\n    render: (data) => <Typography noWrap>\n      {data.nomad_version}/{data.nomad_commit}\n    </Typography>\n  },\n  upload_create_time: {\n    noWrap: true,\n    render: (data) => <Typography noWrap>\n      {formatTimestamp(data.upload_create_time)}\n    </Typography>\n  },\n  entry_id: {\n    noWrap: true,\n    withClipboard: true,\n    render: (data) => (\n      <Box flexGrow={1}>\n        <Typography noWrap>\n          <RouteLink path={`entry/id/${data.entry_id}`}>{data.entry_id}</RouteLink>\n        </Typography>\n      </Box>\n    )\n  },\n  'results.material.material_id': {\n    noWrap: true,\n    hideIfUnavailable: true,\n    placeholder: 'unavailable',\n    withClipboard: true,\n    render: (data) => {\n      return data?.results?.material?.material_id\n        ? <Box flexGrow={1} minWidth={0}>\n          <Typography noWrap>\n            <MaterialLink materialId={data.results.material.material_id}>{data.results.material.material_id}</MaterialLink>\n          </Typography>\n        </Box>\n        : null\n    }\n  },\n  'results.material.topology.material_id': {\n    noWrap: true,\n    hideIfUnavailable: true,\n    placeholder: 'unavailable',\n    withClipboard: true,\n    renderValue: (value) => {\n      return value\n        ? <Box flexGrow={1} minWidth={0}>\n          <Typography noWrap>\n            <MaterialLink materialId={value}>{value}</MaterialLink>\n          </Typography>\n        </Box>\n        : null\n    }\n  },\n  'results.material.n_elements': {\n    noWrap: true,\n    label: \"Number of elements\",\n    render: (data) => {\n      const n = get(data, 'results.material.n_elements')\n      const label = nElementMap[n]\n      return <Typography noWrap>{`${n}${label ? ` (${label})` : ''}`}</Typography>\n    }\n  },\n  mainfile: {\n    noWrap: true,\n    ellipsisFront: true,\n    withClipboard: true\n  },\n  raw_id: {\n    noWrap: true,\n    withClipboard: true,\n    hideIfUnavailable: true\n  },\n  external_id: {\n    noWrap: true,\n    withClipboard: true,\n    hideIfUnavailable: true\n  }\n}\n/**\n * Representational component for tables containing metainfo data.\n */\nconst useMetaInfoTableStyles = makeStyles(theme => ({\n  root: {\n    border: `1px solid ${theme.palette.grey[300]}`\n  },\n  wrap: {\n    borderBottom: `none`\n  },\n  fixed: {\n    tableLayout: 'fixed'\n  }\n}))\nexport const MetaInfoTable = React.memo(({fixed, wrap, className, classes, children}) => {\n  const styles = useMetaInfoTableStyles(classes)\n  return <TableContainer className={clsx(className, styles.root, wrap && styles.wrap)}>\n    <Table size=\"small\" className={clsx(fixed && styles.fixed)}>\n      {children}\n    </Table>\n  </TableContainer>\n})\nMetaInfoTable.propTypes = {\n  fixed: PropTypes.bool, // Whether the table cells should have equal sizes\n  wrap: PropTypes.bool, // Whether the table rows should wrap\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  children: PropTypes.node\n}\n\n/**\n * Used to organize individual quantities in a table.\n */\nconst quantityTableContext = React.createContext()\nexport const QuantityTable = React.memo(({data, fixed, wrap, className, children}) => {\n  return <quantityTableContext.Provider value={{data, wrap}}>\n    <MetaInfoTable wrap={wrap} fixed={fixed} className={className}>\n      <TableBody>\n        {children}\n      </TableBody>\n    </MetaInfoTable>\n  </quantityTableContext.Provider>\n})\nQuantityTable.propTypes = {\n  data: PropTypes.object,\n  fixed: PropTypes.bool,\n  wrap: PropTypes.bool,\n  className: PropTypes.string,\n  children: PropTypes.node\n}\n\n/**\n * Used to organize Quantities in a table row.\n */\nconst useRowStyles = makeStyles(theme => ({\n  root: {},\n  separator: {\n    borderBottom: `1px solid ${theme.palette.grey[300]}`\n  },\n  wrap: {\n    display: 'inline-flex',\n    flexWrap: 'wrap',\n    overflow: 'hidden'\n  }\n}))\nexport const QuantityRow = React.memo(({className, classes, separator, children}) => {\n  const styles = useRowStyles()\n  const wrap = useContext(quantityTableContext)?.wrap\n  return <TableRow className={clsx(className, styles.root, separator && styles.separator, wrap && styles.wrap)}>\n    {children}\n  </TableRow>\n})\n\nQuantityRow.propTypes = {\n  className: PropTypes.string,\n  separator: PropTypes.bool, // Whether to show a bottom border for the row\n  wrap: PropTypes.bool, // Whether to wrap the cells once they overflow\n  classes: PropTypes.object,\n  children: PropTypes.node\n}\n\n/**\n * Used to display a quantity in a table cell.\n */\nconst useCellStyles = makeStyles(theme => ({\n  wrap: {\n    borderBottom: `1px solid ${theme.palette.grey[300]} !important`,\n    flexGrow: 1\n  }\n}))\nexport const QuantityCell = React.memo(({\n  quantity,\n  value,\n  data,\n  label,\n  description,\n  classes,\n  className,\n  hideIfUnavailable,\n  format,\n  children,\n  maxWidth,\n  ...other\n}) => {\n  const context = useContext(quantityTableContext)\n  const wrap = context?.wrap\n  const contextData = context?.data\n  const finalData = data || contextData\n  const styles = useCellStyles()\n\n  return (hideIfUnavailable && isNil(value))\n    ? null\n    : <TableCell align=\"left\" {...other} className={clsx(wrap && styles.wrap)}>\n      {children || <Quantity\n        quantity={quantity}\n        value={value}\n        label={label}\n        description={description}\n        hideIfUnavailable={hideIfUnavailable}\n        format={format}\n        noWrap\n        data={finalData}\n        maxWidth={maxWidth}\n      />}\n    </TableCell>\n})\n\nQuantityCell.propTypes = {\n  quantity: PropTypes.oneOfType([PropTypes.string, PropTypes.func]),\n  value: PropTypes.any,\n  data: PropTypes.object,\n  label: PropTypes.string,\n  description: PropTypes.string,\n  options: PropTypes.object,\n  maxWidth: PropTypes.string,\n  className: PropTypes.string,\n  hideIfUnavailable: PropTypes.bool,\n  format: PropTypes.bool,\n  classes: PropTypes.object,\n  children: PropTypes.node\n}\n\nQuantityCell.defaultProps = {\n  format: true\n}\n\n/**\n * Used to display data from one or many sections in a table.\n */\nconst useStyles = makeStyles(theme => ({\n  root: {\n    width: '100%',\n    height: '100%'\n  },\n  table: {\n    marginBottom: theme.spacing(1)\n  }\n}))\nexport const SectionTable = React.memo(({\n  data,\n  section,\n  quantities,\n  horizontal,\n  showIndex,\n  classes,\n  className,\n  units,\n  'data-testid': testID\n}) => {\n  const styles = useStyles({classes: classes})\n  if (showIndex && !horizontal) {\n    throw Error('Showing index in a vertically displayed table is not currently supported.')\n  }\n\n  // If data is set explicitly to False, we show the NoData component.\n  let content\n  if (data === false) {\n    content = <NoData data-testid={`${testID}-nodata`}/>\n  } else if (!data) {\n    content = <Placeholder variant=\"rect\" data-testid={`${testID}-placeholder`}/>\n  } else {\n    content = <MetaInfoTable className={styles.table}>\n      <TableHead>\n        {horizontal\n          ? <TableRow>\n            {showIndex && <TableCell align=\"left\">\n              <Tooltip title=\"Item index\">\n                <span>Index</span>\n              </Tooltip>\n            </TableCell>}\n            {Object.keys(quantities).map((key, index) => {\n              const defCustom = quantities[key]\n              const def = defaultFilterData[`${section}.${key}`]\n              const unitName = defCustom.unit || def?.unit\n              const unit = unitName && new Unit(unitName)\n              const unitLabel = unit && unit.toSystem(units).label()\n              const label = defCustom.label || def?.label\n              const description = defCustom.description || def?.description || ''\n              const content = unit ? `${label} (${unitLabel})` : defCustom.label\n              const align = defCustom.align || 'right'\n              return <TableCell key={index} align={align}>\n                <Tooltip title={description}>\n                  <span>\n                    {content}\n                  </span>\n                </Tooltip>\n              </TableCell>\n            })}\n          </TableRow>\n          : null\n        }\n      </TableHead>\n      <TableBody>\n        {horizontal\n          ? <>{data.data.map((row, i) => (\n            <TableRow key={i}>\n              {showIndex && <TableCell align=\"left\">{i}</TableCell>}\n              {Object.keys(quantities).map((key, j) => {\n                const defCustom = quantities[key]\n                const def = searchQuantities[`${section}.${key}`]\n                const unit = defCustom.unit || def?.unit\n                const dtype = defCustom?.type?.type_data || def?.type?.type_data\n                const align = defCustom.align || 'right'\n                let value = row[key]\n                if (value !== undefined) {\n                  if (!isNaN(value)) {\n                    value = formatNumber(\n                      unit ? new Q(value, unit).toSystem(units).value() : value,\n                      dtype\n                    )\n                  }\n                } else {\n                  value = defCustom.placeholder || 'unavailable'\n                }\n                return <TableCell key={j} align={align}>{value}</TableCell>\n              })}\n            </TableRow>\n          ))}</>\n          : <>{Object.keys(quantities).map((key, i) => (\n            <TableRow key={i}>\n              {data.data.map((row, j) => {\n                const defCustom = quantities[key]\n                const def = defaultFilterData[`${section}.${key}`]\n                const unitName = defCustom.unit || def?.unit\n                const unit = unitName && new Unit(unitName)\n                const unitLabel = unit ? ` ${unit.toSystem(units).label()}` : ''\n                const description = defCustom.description || def?.description || ''\n                const dtype = defCustom?.type?.type_data || def?.type?.type_data\n                const align = defCustom.align || 'right'\n                const label = defCustom.label || def?.label\n                let value = row[key]\n                if (value !== undefined) {\n                  if (!isNaN(value)) {\n                    value = `${formatNumber(\n                      unit ? new Q(value, unit).toSystem(units).value() : value,\n                      dtype\n                    )}${unitLabel}`\n                  }\n                } else {\n                  value = defCustom.placeholder || 'unavailable'\n                }\n                return <>\n                  <TableCell key={j} align={align}>\n                    <Tooltip title={description}>\n                      <span>\n                        {label}\n                      </span>\n                    </Tooltip>\n                  </TableCell>\n                  <TableCell key={j} align={align}>{value}</TableCell>\n                </>\n              })}\n            </TableRow>\n          ))}</>\n        }\n      </TableBody>\n    </MetaInfoTable>\n  }\n\n  return <div className={clsx(className, styles.root)} data-testid={testID}>\n    {content}\n  </div>\n})\n\nSectionTable.propTypes = {\n  data: PropTypes.oneOfType([\n    PropTypes.bool, // Set to False to show NoData component\n    PropTypes.shape({\n      data: PropTypes.arrayOf(PropTypes.object).isRequired\n    })\n  ]),\n  section: PropTypes.string,\n  quantities: PropTypes.any,\n  horizontal: PropTypes.bool,\n  showIndex: PropTypes.bool, // Whether to display the item index\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  units: PropTypes.object,\n  'data-testid': PropTypes.string\n}\n\n/**\n * Recursively displays all of the quantities that are present within the given\n * section.\n */\nexport const SectionTableAutomatic = React.memo(({data, prefix, columns}) => {\n  // Figure out a flat list of quantities to display\n  const quantities = []\n  const addMethodQuantities = (obj, parentKey) => {\n    const children = {}\n    Object.keys(obj).forEach(key => {\n      const value = obj[key]\n      if (Array.isArray(value) || isString(value) || isNumber(value)) {\n        const metainfoPath = `${prefix}.${parentKey === '' ? '' : `${parentKey}.`}${key}`\n        quantities.push({\n          label: key.replace(/_/g, ' '),\n          quantity: metainfoPath,\n          value: value\n        })\n      } else if (value instanceof Object) {\n        children[key] = value\n      }\n    })\n    Object.keys(children).forEach(key => addMethodQuantities(children[key], `${parentKey === '' ? '' : `${parentKey}.`}${key}`))\n  }\n  addMethodQuantities(data, '')\n\n  // Create rows that each have a fixed number of items\n  const rows = []\n  quantities.forEach((quantity, index) => {\n    if (index % columns === 0) {\n      rows.push([])\n    }\n    const row = rows[Math.floor(index / columns)]\n    row.push(quantity)\n  })\n\n  return <QuantityTable>\n    {rows.map((row, i) => <QuantityRow key={i}>\n      {row.map((cell) => <QuantityCell\n        key={cell.label}\n        {...cell}\n      />)}\n    </QuantityRow>)}\n  </QuantityTable>\n})\n\nSectionTableAutomatic.propTypes = {\n  data: PropTypes.object,\n  prefix: PropTypes.string, // Possible prefix that is needed to resolve the quantity metainfo\n  columns: PropTypes.number // The number of columns to display\n}\n\nSectionTableAutomatic.defaultProps = {\n  columns: 3\n}\n","import * as THREE from 'three';\n/**\n * @author Eberhard Graether / http://egraether.com/\n * @author Mark Lundin \t/ http://mark-lundin.com\n * @author Simone Manini / http://daron1337.github.io\n * @author Luca Antiga \t/ http://lantiga.github.io\n * @author Lauri Himanen\n */\nconst changeEvent = new CustomEvent('change');\nconst startEvent = new CustomEvent('start');\nconst endEvent = new CustomEvent('end');\nconst STATE = { NONE: -1, ROTATE: 0, ZOOM: 1, PAN: 2, TOUCH_ROTATE: 3, TOUCH_ZOOM_PAN: 4 };\nconst EPS = 0.0001;\nexport class OrthographicControls {\n    constructor(object, domElement) {\n        this._state = STATE.NONE;\n        this.object = object;\n        this.domElement = (domElement !== undefined) ? domElement : document;\n        // Public\n        this.enabled = true;\n        this.screen = { left: 0, top: 0, width: 0, height: 0 };\n        this.rotateSpeed = 1.0;\n        this.zoomSpeed = 0.2;\n        this.panSpeed = 0.3;\n        this.enableRotate = true;\n        this.enableZoom = true;\n        this.enablePan = true;\n        this.staticMoving = false;\n        this.dynamicDampingFactor = 0.2;\n        this.minDistance = 0;\n        this.maxDistance = Infinity;\n        // Private\n        this.rotationCenter = new THREE.Vector3();\n        this.target = new THREE.Vector3();\n        this._prevState = STATE.NONE,\n            this._eye = new THREE.Vector3(),\n            this._movePrev = new THREE.Vector2(),\n            this._moveCurr = new THREE.Vector2(),\n            this._lastAxis = new THREE.Vector3(),\n            this._lastAngle = 0,\n            this._lastPosition = new THREE.Vector3();\n        this._zoomStart = new THREE.Vector2(),\n            this._zoomEnd = new THREE.Vector2(),\n            this._touchZoomDistanceStart = 0,\n            this._touchZoomDistanceEnd = 0,\n            this._panStart = new THREE.Vector2(),\n            this._panEnd = new THREE.Vector2();\n        this._zoomed = false;\n        // For reset\n        this.rotationCenter0 = this.rotationCenter.clone();\n        this.target0 = this.target.clone();\n        this.position0 = this.object.position.clone();\n        this.up0 = this.object.up.clone();\n        this.zoom0 = this.object.zoom;\n        this.domElement.addEventListener('contextmenu', this.contextmenu.bind(this), false);\n        this.domElement.addEventListener('mousedown', this.mousedown.bind(this), false);\n        this.domElement.addEventListener('mousewheel', this.mousewheel.bind(this), false);\n        this.domElement.addEventListener('MozMousePixelScroll', this.mousewheel.bind(this), false); // firefox\n        this.domElement.addEventListener('touchstart', this.touchstart.bind(this), false);\n        this.domElement.addEventListener('touchend', this.touchend.bind(this), false);\n        this.domElement.addEventListener('touchmove', this.touchmove.bind(this), false);\n        this.domElement.addEventListener('mousemove', this.mousemove.bind(this), false);\n        this.domElement.addEventListener('mouseup', this.mouseup.bind(this), false);\n        this.domElement.addEventListener('dblclick', this.dblclick.bind(this), false);\n        this.handleResize();\n        // force an update at start\n        this.update();\n    }\n    handleResize() {\n        if (this.domElement === document) {\n            this.screen.left = 0;\n            this.screen.top = 0;\n            this.screen.width = window.innerWidth;\n            this.screen.height = window.innerHeight;\n        }\n        else {\n            const box = this.domElement.getBoundingClientRect();\n            // adjustments come from similar code in the jquery offset() function\n            const d = this.domElement.ownerDocument.documentElement;\n            this.screen.left = box.left + window.pageXOffset - d.clientLeft;\n            this.screen.top = box.top + window.pageYOffset - d.clientTop;\n            this.screen.width = box.width;\n            this.screen.height = box.height;\n        }\n    }\n    handleEvent(event) {\n        if (typeof this[event.type] == 'function') {\n            this[event.type](event);\n        }\n    }\n    getMouseOnScreen(pageX, pageY) {\n        const vector = new THREE.Vector2();\n        vector.set((pageX - this.screen.left) / this.screen.width, (pageY - this.screen.top) / this.screen.width);\n        return vector;\n    }\n    getMouseOnCircle(pageX, pageY) {\n        const vector = new THREE.Vector2();\n        vector.set(((pageX - this.screen.width * 0.5 - this.screen.left) / (this.screen.width * 0.5)), ((this.screen.height + 2 * (this.screen.top - pageY)) / this.screen.width) // screen.width intentional\n        );\n        return vector;\n    }\n    /**\n      * Used to trigger rotation after a move has been detected and stored in\n      * this.movePrev and this.moveCurr.\n      */\n    rotateCamera() {\n        const axis = new THREE.Vector3();\n        const quaternion = new THREE.Quaternion();\n        const eyeDirection = new THREE.Vector3();\n        const objectUpDirection = new THREE.Vector3();\n        const objectSidewaysDirection = new THREE.Vector3();\n        const moveDirection = new THREE.Vector3();\n        moveDirection.set(this._moveCurr.x - this._movePrev.x, this._moveCurr.y - this._movePrev.y, 0);\n        let angle = moveDirection.length();\n        if (angle) {\n            this._eye.copy(this.object.position).sub(this.rotationCenter);\n            eyeDirection.copy(this._eye).normalize();\n            objectUpDirection.copy(this.object.up).normalize();\n            objectSidewaysDirection.crossVectors(objectUpDirection, eyeDirection).normalize();\n            objectUpDirection.setLength(this._moveCurr.y - this._movePrev.y);\n            objectSidewaysDirection.setLength(this._moveCurr.x - this._movePrev.x);\n            moveDirection.copy(objectUpDirection.add(objectSidewaysDirection));\n            axis.crossVectors(moveDirection, this._eye).normalize();\n            const zoomFactor = this.object.zoom;\n            angle *= this.rotateSpeed;\n            angle /= zoomFactor;\n            quaternion.setFromAxisAngle(axis, angle);\n            this._eye.applyQuaternion(quaternion);\n            this.object.up.applyQuaternion(quaternion);\n            this._lastAxis.copy(axis);\n            this._lastAngle = angle;\n        }\n        else if (!this.staticMoving && this._lastAngle) {\n            this._lastAngle *= Math.sqrt(1.0 - this.dynamicDampingFactor);\n            this._eye.copy(this.object.position).sub(this.rotationCenter);\n            quaternion.setFromAxisAngle(this._lastAxis, this._lastAngle);\n            this._eye.applyQuaternion(quaternion);\n            this.object.up.applyQuaternion(quaternion);\n        }\n        this._movePrev.copy(this._moveCurr);\n    }\n    zoomCamera() {\n        let factor;\n        if (this._state === STATE.TOUCH_ZOOM_PAN) {\n            factor = this._touchZoomDistanceStart / this._touchZoomDistanceEnd;\n            this._touchZoomDistanceStart = this._touchZoomDistanceEnd;\n            this.object.zoom /= factor;\n            this.object.updateProjectionMatrix();\n            this._zoomed = true;\n        }\n        else {\n            factor = 1.0 + (this._zoomEnd.y - this._zoomStart.y);\n            if (factor !== 1.0 && factor > 0.0) {\n                this.object.zoom /= factor;\n                this.object.updateProjectionMatrix();\n                this._zoomed = true;\n                if (this.staticMoving) {\n                    this._zoomStart.copy(this._zoomEnd);\n                }\n                else {\n                    this._zoomStart.y += (this._zoomEnd.y - this._zoomStart.y) * this.dynamicDampingFactor;\n                }\n            }\n        }\n    }\n    panCamera() {\n        const mouseChange = new THREE.Vector2(), objectUp = new THREE.Vector3(), pan = new THREE.Vector3();\n        mouseChange.copy(this._panEnd).sub(this._panStart);\n        if (mouseChange.lengthSq()) {\n            const zoomFactor = this.object.zoom;\n            mouseChange.multiplyScalar(this.panSpeed / zoomFactor);\n            pan.copy(this._eye).cross(this.object.up).setLength(mouseChange.x);\n            pan.add(objectUp.copy(this.object.up).setLength(mouseChange.y));\n            this.object.position.add(pan);\n            this.rotationCenter.add(pan);\n            if (this.staticMoving) {\n                this._panStart.copy(this._panEnd);\n            }\n            else {\n                this._panStart.add(mouseChange.subVectors(this._panEnd, this._panStart).multiplyScalar(this.dynamicDampingFactor));\n            }\n        }\n    }\n    checkDistances() {\n        if (this.enableZoom || this.enablePan) {\n            if (this._eye.lengthSq() > this.maxDistance * this.maxDistance) {\n                this.object.position.addVectors(this.rotationCenter, this._eye.setLength(this.maxDistance));\n                this._zoomStart.copy(this._zoomEnd);\n            }\n            if (this._eye.lengthSq() < this.minDistance * this.minDistance) {\n                this.object.position.addVectors(this.rotationCenter, this._eye.setLength(this.minDistance));\n                this._zoomStart.copy(this._zoomEnd);\n            }\n        }\n    }\n    /**\n      * Used to update the controlled object after the user has manipulated the\n      * scene. Will also request a new render if the manipulation has changed\n      * the scene.\n      */\n    update() {\n        this._eye.subVectors(this.object.position, this.rotationCenter);\n        if (this.enableRotate) {\n            this.rotateCamera();\n        }\n        if (this.enableZoom) {\n            this.zoomCamera();\n        }\n        if (this.enablePan) {\n            this.panCamera();\n        }\n        this.object.position.addVectors(this.rotationCenter, this._eye);\n        this.checkDistances();\n        this.object.lookAt(this.rotationCenter);\n        const delta = this._lastPosition.distanceToSquared(this.object.position);\n        if (delta > EPS || this._zoomed) {\n            this.dispatchEvent(changeEvent);\n            this._lastPosition.copy(this.object.position);\n            this._zoomed = false;\n        }\n    }\n    /**\n     * Saves the current configuration as the reset configuration.\n     */\n    saveReset() {\n        this.rotationCenter0.copy(this.rotationCenter);\n        this.position0.copy(this.object.position);\n        this.up0.copy(this.object.up);\n        this.zoom0 = this.object.zoom;\n    }\n    /**\n     * Loads the last saved reset state.\n     */\n    reset() {\n        this._state = STATE.NONE;\n        this._prevState = STATE.NONE;\n        this.rotationCenter.copy(this.rotationCenter0);\n        this.object.position.copy(this.position0);\n        this.object.up.copy(this.up0);\n        this._eye.subVectors(this.object.position, this.rotationCenter);\n        this.object.lookAt(this.rotationCenter);\n        this.object.zoom = this.zoom0;\n        this.object.updateProjectionMatrix();\n        this._lastPosition.copy(this.object.position);\n    }\n    dispose() {\n        this.domElement.removeEventListener('contextmenu', this.contextmenu.bind(this), false);\n        this.domElement.removeEventListener('mousedown', this.mousedown.bind(this), false);\n        this.domElement.removeEventListener('mousewheel', this.mousewheel.bind(this), false);\n        this.domElement.removeEventListener('MozMousePixelScroll', this.mousewheel.bind(this), false); // firefox\n        this.domElement.removeEventListener('touchstart', this.touchstart.bind(this), false);\n        this.domElement.removeEventListener('touchend', this.touchend.bind(this), false);\n        this.domElement.removeEventListener('touchmove', this.touchmove.bind(this), false);\n        this.domElement.removeEventListener('mousemove', this.mousemove.bind(this), false);\n        this.domElement.removeEventListener('mouseup', this.mouseup.bind(this), false);\n        this.domElement.removeEventListener('dblclick', this.dblclick.bind(this), false);\n    }\n    mousedown(event) {\n        if (this.enabled === false)\n            return;\n        event.preventDefault();\n        event.stopPropagation();\n        if (this._state === STATE.NONE) {\n            this._state = event.button;\n        }\n        if (this._state === STATE.ROTATE && this.enableRotate) {\n            this._moveCurr.copy(this.getMouseOnCircle(event.pageX, event.pageY));\n            this._movePrev.copy(this._moveCurr);\n        }\n        else if (this._state === STATE.ZOOM && this.enableZoom) {\n            this._zoomStart.copy(this.getMouseOnScreen(event.pageX, event.pageY));\n            this._zoomEnd.copy(this._zoomStart);\n        }\n        else if (this._state === STATE.PAN && this.enablePan) {\n            this._panStart.copy(this.getMouseOnScreen(event.pageX, event.pageY));\n            this._panEnd.copy(this._panStart);\n        }\n        this.dispatchEvent(startEvent);\n    }\n    mousemove(event) {\n        if (this.enabled === false)\n            return;\n        if (this._state !== STATE.NONE) {\n            event.preventDefault();\n            event.stopPropagation();\n        }\n        if (this._state === STATE.ROTATE && this.enableRotate) {\n            this._movePrev.copy(this._moveCurr);\n            this._moveCurr.copy(this.getMouseOnCircle(event.pageX, event.pageY));\n        }\n        else if (this._state === STATE.ZOOM && this.enableZoom) {\n            this._zoomEnd.copy(this.getMouseOnScreen(event.pageX, event.pageY));\n        }\n        else if (this._state === STATE.PAN && this.enablePan) {\n            this._panEnd.copy(this.getMouseOnScreen(event.pageX, event.pageY));\n        }\n        // Trigger update after moving mouse\n        this.update();\n    }\n    mouseup(event) {\n        if (this.enabled === false)\n            return;\n        event.preventDefault();\n        event.stopPropagation();\n        this._state = STATE.NONE;\n        document.removeEventListener('mousemove', this.mousemove.bind(this));\n        document.removeEventListener('mouseup', this.mouseup.bind(this));\n        this.dispatchEvent(endEvent);\n    }\n    dblclick(event) {\n        if (this.enabled === false || !this.resetOnDoubleClick)\n            return;\n        event.preventDefault();\n        event.stopPropagation();\n        this.reset();\n        this.dispatchEvent(changeEvent);\n    }\n    mousewheel(event) {\n        if (this.enabled === false)\n            return;\n        event.preventDefault();\n        event.stopPropagation();\n        let delta = 0;\n        // WebKit / Opera / Explorer 9\n        if (event.wheelDelta) {\n            delta = event.wheelDelta;\n            // Firefox\n        }\n        else if (event.detail) {\n            delta = -event.detail;\n        }\n        // Normalization due to inconsistent scroll speeds across browsers.\n        delta /= Math.abs(delta);\n        this._zoomStart.y += delta * this.zoomSpeed;\n        this.dispatchEvent(startEvent);\n        this.dispatchEvent(endEvent);\n        // Trigger update after wheel scroll\n        this.update();\n    }\n    touchstart(event) {\n        if (this.enabled === false)\n            return;\n        switch (event.touches.length) {\n            case 1:\n                this._state = STATE.TOUCH_ROTATE;\n                this._moveCurr.copy(this.getMouseOnCircle(event.touches[0].pageX, event.touches[0].pageY));\n                this._movePrev.copy(this._moveCurr);\n                break;\n            default: // 2 or more\n                this._state = STATE.TOUCH_ZOOM_PAN;\n                const dx = event.touches[0].pageX - event.touches[1].pageX;\n                const dy = event.touches[0].pageY - event.touches[1].pageY;\n                this._touchZoomDistanceEnd = this._touchZoomDistanceStart = Math.sqrt(dx * dx + dy * dy);\n                const x = (event.touches[0].pageX + event.touches[1].pageX) / 2;\n                const y = (event.touches[0].pageY + event.touches[1].pageY) / 2;\n                this._panStart.copy(this.getMouseOnScreen(x, y));\n                this._panEnd.copy(this._panStart);\n                break;\n        }\n        this.dispatchEvent(startEvent);\n    }\n    touchmove(event) {\n        if (this.enabled === false)\n            return;\n        event.preventDefault();\n        event.stopPropagation();\n        switch (event.touches.length) {\n            case 1:\n                this._movePrev.copy(this._moveCurr);\n                this._moveCurr.copy(this.getMouseOnCircle(event.touches[0].pageX, event.touches[0].pageY));\n                break;\n            default: // 2 or more\n                const dx = event.touches[0].pageX - event.touches[1].pageX;\n                const dy = event.touches[0].pageY - event.touches[1].pageY;\n                this._touchZoomDistanceEnd = Math.sqrt(dx * dx + dy * dy);\n                const x = (event.touches[0].pageX + event.touches[1].pageX) / 2;\n                const y = (event.touches[0].pageY + event.touches[1].pageY) / 2;\n                this._panEnd.copy(this.getMouseOnScreen(x, y));\n                break;\n        }\n        // Trigger update after touch move\n        this.update();\n    }\n    touchend(event) {\n        if (this.enabled === false)\n            return;\n        switch (event.touches.length) {\n            case 0:\n                this._state = STATE.NONE;\n                break;\n            case 1:\n                this._state = STATE.TOUCH_ROTATE;\n                this._moveCurr.copy(this.getMouseOnCircle(event.touches[0].pageX, event.touches[0].pageY));\n                this._movePrev.copy(this._moveCurr);\n                break;\n        }\n        this.dispatchEvent(endEvent);\n    }\n    contextmenu(event) {\n        event.preventDefault();\n    }\n    addEventListener(type, listener) {\n        if (this._listeners === undefined)\n            this._listeners = {};\n        const listeners = this._listeners;\n        if (listeners[type] === undefined) {\n            listeners[type] = [];\n        }\n        if (listeners[type].indexOf(listener) === -1) {\n            listeners[type].push(listener);\n        }\n    }\n    hasEventListener(type, listener) {\n        if (this._listeners === undefined)\n            return false;\n        const listeners = this._listeners;\n        return listeners[type] !== undefined && listeners[type].indexOf(listener) !== -1;\n    }\n    removeEventListener(type, listener) {\n        if (this._listeners === undefined)\n            return;\n        const listeners = this._listeners;\n        const listenerArray = listeners[type];\n        if (listenerArray !== undefined) {\n            const index = listenerArray.indexOf(listener);\n            if (index !== -1) {\n                listenerArray.splice(index, 1);\n            }\n        }\n    }\n    dispatchEvent(event) {\n        if (this._listeners === undefined)\n            return;\n        const listeners = this._listeners;\n        const listenerArray = listeners[event.type];\n        if (listenerArray !== undefined) {\n            const array = listenerArray.slice(0);\n            for (let i = 0, l = array.length; i < l; i++) {\n                array[i].call(this, event);\n            }\n        }\n    }\n}\n","import { OrthographicControls } from \"./orthographiccontrols\";\nimport { merge, isNil, cloneDeep } from \"lodash\";\nimport * as THREE from \"three\";\n/**\n * Abstract base class for visualizing 3D scenes with three.js.\n */\nexport class Viewer {\n    /**\n     * @param {any} hostElement is the html element where the visualization\n     *   canvas will be appended.\n     * @param {Object} options An object that can hold custom settings for the viewer.\n     * @param {string} options.renderer.pixelRatioScale Scaling factor for the pixel ratio. Defaults to 1.\n     * @param {string} options.renderer.antialias.enabled Whether antialiasing is enabled. Defaults to true.\n     * @param {string} options.renderer.background.color Color of the background. Defaults to \"#fff\".\n     * @param {number} options.renderer.background.opacity Opacity of the background. Defaults to 0.\n     * @param {boolean} options.renderer.shadows.enabled Whether shows are cast\n     * by atoms onto others. Note that enabling this increases the computational\n     * cost for doing the visualization. Defaults to false\n     */\n    constructor(hostElement, options = {}) {\n        this.hostElement = hostElement;\n        this.scenes = []; // A list of scenes that are rendered\n        this.objects = []; // A list of objects that are affected by rotations, translations etc.\n        this.cameraWidth = 10.0; // The default \"width\" of the camera\n        this.options = {}; // Options for the viewer. Can be e.g. used to control which settings are enabled\n        this.translation = new THREE.Vector3(); // Translation vector that has been applied to shift the view\n        // Check that OpenGL is available, otherwise throw an exception\n        if (!this.webglAvailable()) {\n            throw Error(\"WebGL is not supported on this browser, cannot display viewer.\");\n        }\n        // Save default settings\n        const controlDefaults = {\n            zoom: {\n                enabled: true,\n                speed: 0.2\n            },\n            rotation: {\n                enabled: true,\n                speed: 2.5\n            },\n            pan: {\n                enabled: true,\n                speed: 10\n            },\n            resetOnDoubleClick: true\n        };\n        const rendererDefaults = {\n            pixelRatioScale: 1,\n            antialias: {\n                enabled: true,\n            },\n            background: {\n                color: \"#fff\",\n                opacity: 0,\n            },\n            shadows: {\n                enabled: false,\n            }\n        };\n        this.rendererDefaults = merge(cloneDeep(rendererDefaults), cloneDeep(options === null || options === void 0 ? void 0 : options.renderer));\n        this.controlDefaults = merge(cloneDeep(controlDefaults), cloneDeep(options === null || options === void 0 ? void 0 : options.controls));\n        this.setOptions(options);\n        this.setupRootElement();\n        this.setupRenderer();\n        this.setupScenes();\n        this.setupLights();\n        this.setupCamera();\n        this.changeHostElement(hostElement);\n    }\n    /**\n     * Can be used to download the current visualization as a jpg-image to the\n     * browser's download location.\n     */\n    takeScreenShot(filename) {\n        let imgData;\n        try {\n            // Create headers and actual image contents\n            const strMime = \"image/png\";\n            const strDownloadMime = \"image/octet-stream\";\n            this.render();\n            imgData = this.renderer.domElement.toDataURL(strMime);\n            const strData = imgData.replace(strMime, strDownloadMime);\n            // Create link element for the data. Firefox requires the link to\n            // be in the body\n            filename = filename + \".png\";\n            const link = document.createElement('a');\n            link.style.display = \"none\";\n            document.body.appendChild(link);\n            link.download = filename;\n            link.href = strData;\n            // Force click the link and remove it afterwards.\n            link.click();\n            document.body.removeChild(link);\n        }\n        catch (e) {\n            console.log(e);\n            return;\n        }\n    }\n    /**\n     * This will check if WegGL is available on the current browser.\n     */\n    webglAvailable() {\n        const w = window;\n        try {\n            const canvas = document.createElement('canvas');\n            return !!(w.WebGLRenderingContext && (canvas.getContext('webgl') ||\n                canvas.getContext('experimental-webgl')));\n        }\n        catch (e) {\n            return false;\n        }\n    }\n    /**\n     * This will setup the three.js renderer object. Uses WebGL by default, can\n     * use a canvas fallback is WegGL is not available.\n     */\n    setupRenderer() {\n        // Create the renderer. The \"alpha: true\" enables to set a background color.\n        this.renderer = new THREE.WebGLRenderer({\n            // Alpha channel is disabled whenever a non-opaque background is in\n            // use. Performance optimization.\n            alpha: this.rendererDefaults.background.opacity !== 1,\n            // Antialiasing incurs a small performance penalty.\n            antialias: this.rendererDefaults.antialias.enabled,\n            preserveDrawingBuffer: false,\n            powerPreference: 'high-performance'\n        });\n        // pixelRatio directly affects the number of pixels that the canvas is\n        // rendering.\n        this.renderer.setPixelRatio(window.devicePixelRatio * this.rendererDefaults.pixelRatioScale);\n        this.renderer.shadowMap.enabled = false;\n        this.renderer.shadowMap.type = THREE.PCFSoftShadowMap;\n        this.renderer.setSize(this.rootElement.clientWidth, this.rootElement.clientHeight);\n        this.renderer.setClearColor(this.rendererDefaults.background.color, this.rendererDefaults.background.opacity);\n        this.rootElement.appendChild(this.renderer.domElement);\n        // This is set so that multiple scenes can be used, see\n        // http://stackoverflow.com/questions/12666570/how-to-change-the-zorder-of-object-with-threejs/12666937#12666937\n        this.renderer.autoClear = false;\n    }\n    /**\n     * This will setup the three.js renderer object. Uses WebGL by default, can\n     * use a canvas fallback is WegGL is not available.\n     */\n    setBackgroundColor(color, opacity) {\n        // Create the renderer. The \"alpha: true\" enables to set a background color.\n        this.renderer.setClearColor(color, opacity);\n    }\n    /*\n     * Used to setup and position the camera.\n     */\n    setupCamera() {\n        const aspectRatio = this.rootElement.clientWidth / this.rootElement.clientHeight;\n        const width = this.cameraWidth;\n        const height = width / aspectRatio;\n        this.camera = new THREE.OrthographicCamera(width / -2, width / 2, height / 2, height / -2, -100, 1000);\n        this.camera.name = \"camera\";\n        this.camera.position.z = 20;\n    }\n    /**\n     * Used to setup a root DIV element that will contain the whole\n     * visualization, and which will be placed inside the given target element.\n     *\n     * The root element should always fill the whole host element, and we try\n     * to ensure this by setting width and height to 100%. The position is set\n     * to relative, so that the child divs can be set relative to this root div\n     * with absolute positioning.\n     */\n    setupRootElement() {\n        this.rootElement = document.createElement(\"div\");\n        this.rootElement.style.width = \"100%\";\n        this.rootElement.style.height = \"100%\";\n        this.rootElement.style.position = \"relative\";\n    }\n    /**\n     * Used to setup the DOM element where the viewer will be displayed.\n     *\n     * @param {any} hostElement The HTML element into which this viewer is loaded.\n     * @param {boolean} resize Whether to resize the canvas to fit the new host.\n     */\n    changeHostElement(hostElement, resize = true) {\n        // If no host element currently specified, don't do anything\n        if (isNil(hostElement)) {\n            return;\n        }\n        // If a previous target element is set, remove it\n        if (this.hostElement) {\n            while (this.hostElement.firstChild) {\n                this.hostElement.removeChild(this.hostElement.firstChild);\n            }\n        }\n        // Setup the new targetElement\n        hostElement.appendChild(this.rootElement);\n        if (resize) {\n            this.fitCanvas();\n        }\n    }\n    /**\n     * Rotates the scenes.\n     *\n     * @param {number[][]} rotations The rotations as a list. Each rotation\n     * should be an array containing four numbers: [x, y, z, angle]. E.g. [[1,\n     * 0, 0, 90]] would apply a 90 degree rotation with respect to the\n     * x-coordinate. If multiple rotations are specified, they will be applied\n     * in the given order. Notice that these rotations are applied with respect\n     * to a global coordinate system, not the coordinate system of the\n     * structure. In this global coordinate system [1, 0, 0] points to the\n     * right, [0, 1, 0] points upwards and [0, 0, 1] points away from the\n     * screen. The rotations are applied in the given order.\n     */\n    rotate(rotations) {\n        if (rotations === undefined) {\n            return;\n        }\n        for (const r of rotations) {\n            const basis = new THREE.Vector3(r[0], r[1], r[2]);\n            basis.normalize();\n            const angle = r[3] / 180 * Math.PI;\n            for (const obj of this.objects) {\n                this.rotateAroundWorldAxis(obj, basis, angle);\n            }\n        }\n    }\n    /**\n     * Sets the rotation of all the scenes.\n     *\n     * @param {number[]} rotation The rotation as a list. Rotation should be an\n     * array containing four numbers: [x, y, z, angle]. E.g. [1, 0, 0, 90] would\n     * set a 90 degree rotation with respect to the x-coordinate.\n     */\n    setRotation(rotation) {\n        const basis = new THREE.Vector3(rotation[0], rotation[1], rotation[2]);\n        basis.normalize();\n        const angle = rotation[3] / 180 * Math.PI;\n        for (const obj of this.objects) {\n            obj.setRotationFromAxisAngle(basis, angle);\n        }\n    }\n    /**\n     * Translates the objects.\n     *\n     * @param {number[][]} rotations The rotations as a list. Each rotation\n     * should be an array containing four numbers: [x, y, z, angle]. E.g. [[1,\n     * 0, 0, 90]] would apply a 90 degree rotation with respect to the\n     * x-coordinate. If multiple rotations are specified, they will be applied\n     * in the given order. Notice that these rotations are applied with respect\n     * to a global coordinate system, not the coordinate system of the\n     * structure. In this global coordinate system [1, 0, 0] points to the\n     * right, [0, 1, 0] points upwards and [0, 0, 1] points away from the\n     * screen. The rotations are applied in the given order.\n     */\n    setTranslation(translation) {\n        this.translation = translation;\n        for (const obj of this.objects) {\n            obj.position.copy(translation);\n        }\n    }\n    /**\n     * Translates the objects.\n     *\n     * @param {number[][]} rotations The rotations as a list. Each rotation\n     * should be an array containing four numbers: [x, y, z, angle]. E.g. [[1,\n     * 0, 0, 90]] would apply a 90 degree rotation with respect to the\n     * x-coordinate. If multiple rotations are specified, they will be applied\n     * in the given order. Notice that these rotations are applied with respect\n     * to a global coordinate system, not the coordinate system of the\n     * structure. In this global coordinate system [1, 0, 0] points to the\n     * right, [0, 1, 0] points upwards and [0, 0, 1] points away from the\n     * screen. The rotations are applied in the given order.\n     */\n    translate(translation) {\n        this.translation.add(translation);\n        for (const obj of this.objects) {\n            obj.position.add(translation);\n        }\n    }\n    /**\n     * Used to reset the original view.\n     */\n    saveCameraReset() {\n        if (isNil(this.controlsObject)) {\n            throw Error(\"Could not save camera reset as controls are not set. Please call the controls()-method first.\");\n        }\n        this.controlsObject.saveReset();\n    }\n    /**\n     * Used to reset the original view.\n     */\n    resetCamera() {\n        if (isNil(this.controlsObject)) {\n            throw Error(\"Could not reset as controls are not set. Please call the controls()-method first.\");\n        }\n        this.controlsObject.reset();\n        // For some reason a render is required here...\n        this.render();\n    }\n    /**\n     * Used to setup the controls that allow interacting with the visualization\n     * with mouse.\n     *\n     * @param {Object} options An object containing the control options. See\n     *   below for the subparameters.\n     * @param {string} options.zoom.enabled Is zoom enabled\n     * @param {string} options.zoom.speed Zoom speed\n     * @param {string} options.rotation.enabled Is rotation enabled\n     * @param {string} options.rotation.speed Rotation speed\n     * @param {string} options.pan.enabled Is panning enabled\n     * @param {string} options.pan.speed Pan speed\n     * @param {string} options.resetOnDoubleClick Whether to reset the camera on double click.\n     */\n    controls(options) {\n        // Merge with default options\n        const optionsFinal = merge(cloneDeep(this.controlDefaults), cloneDeep(options));\n        // Setup new controls object\n        const controls = new OrthographicControls(this.camera, this.rootElement);\n        controls.rotateSpeed = optionsFinal.rotation.speed;\n        controls.rotationCenter = new THREE.Vector3();\n        controls.zoomSpeed = optionsFinal.zoom.speed;\n        controls.panSpeed = optionsFinal.pan.speed;\n        controls.enableZoom = optionsFinal.zoom.enabled;\n        controls.enablePan = optionsFinal.pan.enabled;\n        controls.enableRotate = optionsFinal.rotation.enabled;\n        controls.resetOnDoubleClick = optionsFinal.resetOnDoubleClick;\n        controls.staticMoving = true;\n        controls.dynamicDampingFactor = 0.25;\n        controls.keys = [65, 83, 68];\n        controls.addEventListener('change', this.render.bind(this));\n        this.controlsObject = controls;\n    }\n    /**\n     * Creates 8 corner points for the given cuboid.\n     *\n     * @param origin - The origin of the cuboid.\n     * @param basis - The vectors that define the cuboid.\n     */\n    createCornerPoints(origin, basis) {\n        const opposite = origin.clone().add(basis[0]).add(basis[1]).add(basis[2]);\n        const vertices = [origin, opposite];\n        for (let len = basis.length, i = 0; i < len; ++i) {\n            // Corners close to origin\n            vertices.push(origin.clone().add(basis[i].clone()));\n            // Corners close to opposite point of origin\n            vertices.push(opposite.clone().sub(basis[i].clone()));\n        }\n        const geometry = new THREE.BufferGeometry().setFromPoints(vertices);\n        return geometry;\n    }\n    /**\n     * Center the camera so that the the given points fit the view with the\n     * given margin.\n     */\n    fitViewToPoints(points, margin) {\n        // Make sure that all transforms are updated\n        this.scenes.forEach((scene) => scene.updateMatrixWorld());\n        // Project all 8 corners of the normalized cell into screen space and\n        // see how the system should be scaled to fit into screen\n        const canvas = this.rootElement;\n        const canvasWidth = canvas.clientWidth;\n        const canvasHeight = canvas.clientHeight;\n        const cornerPos = [];\n        const nPos = points.length;\n        // Default the zoom to 1 for the projection\n        this.camera.zoom = 1;\n        this.camera.updateProjectionMatrix();\n        // Calculate margin size in screen space\n        const screenOrigin = new THREE.Vector3(0, 0, 0);\n        screenOrigin.project(this.camera);\n        screenOrigin.x = Math.round((screenOrigin.x + 1) * canvasWidth / 2);\n        screenOrigin.y = Math.round((-screenOrigin.y + 1) * canvasHeight / 2);\n        screenOrigin.z = 0;\n        const screenMargin = new THREE.Vector3(margin, margin, 0);\n        screenMargin.project(this.camera);\n        screenMargin.x = Math.round((screenMargin.x + 1) * canvasWidth / 2);\n        screenMargin.y = Math.round((-screenMargin.y + 1) * canvasHeight / 2);\n        screenMargin.sub(screenOrigin);\n        screenMargin.x = Math.abs(screenMargin.x);\n        screenMargin.y = Math.abs(screenMargin.y);\n        screenMargin.z = 0;\n        // Calculate the boundary positions in screen space\n        for (let i = 0; i < nPos; ++i) {\n            const screenPos = points[i].clone();\n            screenPos.project(this.camera);\n            screenPos.x = Math.round((screenPos.x + 1) * canvasWidth / 2);\n            screenPos.y = Math.round((-screenPos.y + 1) * canvasHeight / 2);\n            screenPos.z = 0;\n            cornerPos.push(screenPos);\n        }\n        // Find the minimum and maximum in both screen dimensions\n        let minX = cornerPos[0].x;\n        let maxX = cornerPos[0].x;\n        let minY = cornerPos[0].y;\n        let maxY = cornerPos[0].y;\n        for (let len = cornerPos.length, i = 0; i < len; ++i) {\n            const pos = cornerPos[i];\n            const x = pos.x;\n            const y = pos.y;\n            if (x > maxX) {\n                maxX = x;\n            }\n            else if (x < minX) {\n                minX = x;\n            }\n            if (y > maxY) {\n                maxY = y;\n            }\n            else if (y < minY) {\n                minY = y;\n            }\n        }\n        minX -= screenMargin.x;\n        maxX += screenMargin.x;\n        minY -= screenMargin.y;\n        maxY += screenMargin.y;\n        // Determine new zoom that will ensure that all cornerpositions are\n        // visible on screen, assuming that the zoom center is set to view\n        // center.\n        const centerX = (canvasWidth / 2);\n        const centerY = (canvasHeight / 2);\n        const zoomRight = centerX / Math.abs(maxX - centerX);\n        const zoomLeft = centerX / Math.abs(minX - centerX);\n        const zoomUp = centerY / Math.abs(minY - centerY);\n        const zoomDown = centerY / Math.abs(maxY - centerY);\n        const newZoom = Math.min(zoomRight, zoomLeft, zoomUp, zoomDown);\n        this.camera.zoom = newZoom;\n        this.camera.updateProjectionMatrix();\n    }\n    /*\n     * Get the current zoom level for the visualization.\n     */\n    getZoom() {\n        return this.camera.zoom;\n    }\n    /**\n     * Sets the zoom level for the visualization.\n     *\n     * @param zoom - The wanted zoom level as a floating point number.\n     */\n    zoom(zoom) {\n        this.camera.zoom = zoom;\n        this.camera.updateProjectionMatrix();\n    }\n    /**\n     * Resizes the WebGL canvas to the host element.\n     */\n    fitCanvas() {\n        const aspectRatio = this.rootElement.clientWidth / this.rootElement.clientHeight;\n        const width = this.cameraWidth;\n        const height = width / aspectRatio;\n        this.camera.left = -width / 2;\n        this.camera.right = width / 2;\n        this.camera.top = height / 2;\n        this.camera.bottom = -height / 2;\n        this.camera.updateProjectionMatrix();\n        this.renderer.setSize(this.rootElement.clientWidth, this.rootElement.clientHeight);\n        if (!isNil(this.controlsObject)) {\n            this.controlsObject.handleResize();\n        }\n    }\n    /**\n     * Used to render all the scenes that are present. The scenes will be\n     * rendered on top of each other, so make sure that they are in the right\n     * order.\n     *\n     * This approach is copied from\n     * http://stackoverflow.com/questions/12666570/how-to-change-the-zorder-of-object-with-threejs/12666937#12666937\n     */\n    render() {\n        this.renderer.clear();\n        for (let iScene = 0; iScene < this.scenes.length; ++iScene) {\n            const scene = this.scenes[iScene];\n            this.renderer.render(scene, this.camera);\n            if (iScene !== this.scenes.length - 1) {\n                this.renderer.clearDepth();\n            }\n        }\n    }\n    /**\n     * Helper function for creating a cylinder mesh.\n     *\n     * @param pos1 - Start position\n     * @param pos2 - End position\n     * @param radius - Cylinder radius\n     * @param material - Cylinder material\n     */\n    createCylinder(pos1, pos2, radius, nSegments, material) {\n        const direction = new THREE.Vector3().subVectors(pos2, pos1);\n        const dirLen = direction.length();\n        const dirNorm = direction.clone().divideScalar(dirLen);\n        const arrow = new THREE.ArrowHelper(dirNorm, pos1);\n        const edgeGeometry = new THREE.CylinderGeometry(radius, radius, dirLen, nSegments);\n        const edge = new THREE.Mesh(edgeGeometry, material);\n        edge.rotation.copy(arrow.rotation.clone());\n        edge.position.copy(new THREE.Vector3().addVectors(pos1, direction.multiplyScalar(0.5)));\n        return edge;\n    }\n    /**\n     * Helper function for creating a text sprite that lives in 3D space.\n     *\n     * @param pos1 - Start position\n     * @param pos2 - End position\n     * @param radius - Cylinder radius\n     * @param material - Cylinder material\n     */\n    createLabel(position, label, color, fontFamily, fontSize, offset = undefined, strokeWidth = 0, strokeColor = \"#000\") {\n        // Configure canvas\n        const canvas = document.createElement('canvas');\n        const size = 256;\n        canvas.width = size;\n        canvas.height = size;\n        const ctx = canvas.getContext('2d');\n        // Draw label\n        const fontFactor = 0.90;\n        ctx.fillStyle = color;\n        ctx.font = `${fontFactor * size}px ${fontFamily}`;\n        ctx.textAlign = \"center\";\n        ctx.textBaseline = \"middle\";\n        if (strokeWidth > 0) {\n            ctx.lineWidth = strokeWidth * size;\n            ctx.strokeStyle = strokeColor;\n            ctx.strokeText(label, size / 2, size / 2);\n        }\n        ctx.fillText(label, size / 2, size / 2);\n        const texture = new THREE.Texture(canvas);\n        texture.needsUpdate = true;\n        const material = new THREE.SpriteMaterial({ map: texture });\n        const sprite = new THREE.Sprite(material);\n        sprite.scale.set(fontSize, fontSize, 1);\n        // Apply offset\n        if (offset === undefined) {\n            offset = new THREE.Vector2(0, 0);\n        }\n        const trueOffset = new THREE.Vector2();\n        trueOffset.addVectors(offset, new THREE.Vector2(0.5, 0.5));\n        sprite.center.copy(trueOffset);\n        const labelRoot = new THREE.Object3D();\n        labelRoot.position.copy(position);\n        labelRoot.add(sprite);\n        return labelRoot;\n    }\n    /**\n     * Rotate an object around an arbitrary axis in world space\n     * @param obj - The Object3D to rotate\n     * @param axis - The axis in world space\n     * @param radians - The angle in radians\n     */\n    rotateAroundWorldAxis(obj, axis, radians) {\n        const rotWorldMatrix = new THREE.Matrix4();\n        rotWorldMatrix.makeRotationAxis(axis.normalize(), radians);\n        rotWorldMatrix.multiply(obj.matrix); // pre-multiply\n        obj.matrix = rotWorldMatrix;\n        obj.rotation.setFromRotationMatrix(obj.matrix);\n    }\n    /**\n     * Performs a coordinate transform:\n     *\n     * B*b = A*a\n     * b = Bi*A*a\n     *\n     * @param A - The original basis matrix\n     * @param a - Vector in original basis\n     * @param Bi - Inverse of target basis matrix\n     *\n     * @return b - The original vector a in the target basis\n     */\n    coordinateTransform(A, Bi, a, copy = true) {\n        const result = copy ? a.clone() : a;\n        return result.applyMatrix3(A).applyMatrix3(Bi);\n    }\n    alignView(alignments, directions) {\n        // Check alignment validity\n        if (alignments === undefined) {\n            return;\n        }\n        if (alignments.length > 2) {\n            throw \"At most two alignments can be performed.\";\n        }\n        const alignedDirections = [];\n        const rotate = (alignment) => {\n            const direction = alignment[0];\n            const target = alignment[1];\n            let targetVector;\n            switch (direction) {\n                case \"up\":\n                    targetVector = new THREE.Vector3(0, 1, 0);\n                    break;\n                case \"down\":\n                    targetVector = new THREE.Vector3(0, -1, 0);\n                    break;\n                case \"right\":\n                    targetVector = new THREE.Vector3(1, 0, 0);\n                    break;\n                case \"left\":\n                    targetVector = new THREE.Vector3(-1, 0, 0);\n                    break;\n                case \"front\":\n                    targetVector = new THREE.Vector3(0, 0, 1);\n                    break;\n                case \"back\":\n                    targetVector = new THREE.Vector3(0, 0, -1);\n                    break;\n            }\n            // Determine the top direction\n            const finalVector = directions[target];\n            for (const alignedDirection of alignedDirections) {\n                finalVector[alignedDirection] = 0;\n            }\n            // Rotate the scene according to the selected top direction\n            if (finalVector.length() > 1e-8) {\n                const quaternion = new THREE.Quaternion().setFromUnitVectors(finalVector.clone().normalize(), targetVector);\n                // Rotate the given directions so that their direction will be\n                // correct for the next aligment\n                for (const direction in directions) {\n                    directions[direction].applyQuaternion(quaternion);\n                }\n                // Rotate the objects\n                for (const obj of this.objects) {\n                    obj.applyQuaternion(quaternion);\n                    obj.updateMatrixWorld();\n                }\n                if (direction == \"right\" || direction == \"left\") {\n                    alignedDirections.push(\"x\");\n                }\n                else if (direction == \"up\" || direction == \"down\") {\n                    alignedDirections.push(\"y\");\n                }\n                else if (direction == \"front\" || direction == \"back\") {\n                    alignedDirections.push(\"z\");\n                }\n            }\n        };\n        for (const alignment of alignments) {\n            rotate(alignment);\n        }\n    }\n}\n","import { Viewer } from \"./viewer\";\nimport objectHash from '../js/object_hash.js';\nimport { isNumber, isArray, isPlainObject, isNil, range, merge, cloneDeep } from \"lodash\";\nimport * as THREE from \"three\";\n/**\n * Class for visualizing an atomic structure.\n */\nexport class StructureViewer extends Viewer {\n    /**\n     * @param {any} hostElement is the html element where the visualization\n     *   canvas will be appended.\n     * @param {Object} options An object that can hold custom settings for the viewer.\n     * @param {string} options.renderer.pixelRatioScale Scaling factor for the pixel ratio. Defaults to 1.\n     * @param {string} options.renderer.antialias.enabled Whether antialiasing is enabled. Defaults to true.\n     * @param {string} options.renderer.background.color Color of the background. Defaults to \"#fff\".\n     * @param {number} options.renderer.background.opacity Opacity of the background. Defaults to 0.\n     * @param {boolean} options.renderer.shadows.enabled Whether shows are cast\n     *   by atoms onto others. Note that enabling this increases the computational\n     *   cost for doing the visualization. Defaults to false\n     * @param {Object} options.controls Default options for the controls-function. See\n     *   the function for more information.\n     * @param {Object} options.atoms Default options for the atoms-function. See\n     *   the function for more information.\n     * @param {Object} options.bonds Default options for the bonds-function. See\n     *   the function for more information.\n     * @param {Object} options.cell Default options for the cell-function. See\n     *   the function for more information.\n     * @param {Object} options.latticeConstants Default options for the\n     *   latticeConstants-function. See the function for more information.\n     */\n    constructor(hostElement, options = {}) {\n        super(hostElement, options);\n        this.hostElement = hostElement;\n        this.atomicRadii = []; // Contains the atomic radii\n        this.elementColors = []; // Contains the element colors\n        this.meshMap = {}; // Contains mappings from hashes to THREE.js meshes.\n        this.atomConfigMap = {}; // Contains mappings from atom indices to config hashes\n        this.configMap = {}; // Contains mappings from config hashes to configs\n        this.lights = []; // Contains the lights in the scene\n        this.bondFills = []; // Contains the bulk of the bonds\n        this.atomFills = []; // Contains the bulk of the atoms\n        this.atomOutlines = []; // Contains the outlines of the atoms\n        this.axisLabels = []; // List of all labels in the view.\n        this.label_missing = 'X';\n        this.elementNames = [\n            this.label_missing, 'H', 'He', 'Li', 'Be', 'B', 'C', 'N', 'O', 'F', 'Ne', 'Na', 'Mg', 'Al', 'Si',\n            'P', 'S', 'Cl', 'Ar', 'K', 'Ca', 'Sc', 'Ti', 'V', 'Cr', 'Mn', 'Fe', 'Co', 'Ni',\n            'Cu', 'Zn', 'Ga', 'Ge', 'As', 'Se', 'Br', 'Kr', 'Rb', 'Sr', 'Y', 'Zr', 'Nb',\n            'Mo', 'Tc', 'Ru', 'Rh', 'Pd', 'Ag', 'Cd', 'In', 'Sn', 'Sb', 'Te', 'I', 'Xe',\n            'Cs', 'Ba', 'La', 'Ce', 'Pr', 'Nd', 'Pm', 'Sm', 'Eu', 'Gd', 'Tb', 'Dy', 'Ho',\n            'Er', 'Tm', 'Yb', 'Lu', 'Hf', 'Ta', 'W', 'Re', 'Os', 'Ir', 'Pt', 'Au', 'Hg',\n            'Tl', 'Pb', 'Bi', 'Po', 'At', 'Rn', 'Fr', 'Ra', 'Ac', 'Th', 'Pa', 'U', 'Np',\n            'Pu', 'Am', 'Cm', 'Bk', 'Cf', 'Es', 'Fm', 'Md', 'No', 'Lr', 'Rf', 'Db', 'Sg',\n            'Bh', 'Hs', 'Mt', 'Ds', 'Rg', 'Cn', 'Nh', 'Fl', 'Mc', 'Lv', 'Ts', 'Og' // Og = 118\n        ];\n        this.elementNumbers = {\n            [this.label_missing]: 0, 'H': 1, 'He': 2, 'Li': 3, 'Be': 4,\n            'B': 5, 'C': 6, 'N': 7, 'O': 8, 'F': 9,\n            'Ne': 10, 'Na': 11, 'Mg': 12, 'Al': 13, 'Si': 14,\n            'P': 15, 'S': 16, 'Cl': 17, 'Ar': 18, 'K': 19,\n            'Ca': 20, 'Sc': 21, 'Ti': 22, 'V': 23, 'Cr': 24,\n            'Mn': 25, 'Fe': 26, 'Co': 27, 'Ni': 28, 'Cu': 29,\n            'Zn': 30, 'Ga': 31, 'Ge': 32, 'As': 33, 'Se': 34,\n            'Br': 35, 'Kr': 36, 'Rb': 37, 'Sr': 38, 'Y': 39,\n            'Zr': 40, 'Nb': 41, 'Mo': 42, 'Tc': 43, 'Ru': 44,\n            'Rh': 45, 'Pd': 46, 'Ag': 47, 'Cd': 48, 'In': 49,\n            'Sn': 50, 'Sb': 51, 'Te': 52, 'I': 53, 'Xe': 54,\n            'Cs': 55, 'Ba': 56, 'La': 57, 'Ce': 58, 'Pr': 59,\n            'Nd': 60, 'Pm': 61, 'Sm': 62, 'Eu': 63, 'Gd': 64,\n            'Tb': 65, 'Dy': 66, 'Ho': 67, 'Er': 68, 'Tm': 69,\n            'Yb': 70, 'Lu': 71, 'Hf': 72, 'Ta': 73, 'W': 74,\n            'Re': 75, 'Os': 76, 'Ir': 77, 'Pt': 78, 'Au': 79,\n            'Hg': 80, 'Tl': 81, 'Pb': 82, 'Bi': 83, 'Po': 84,\n            'At': 85, 'Rn': 86, 'Fr': 87, 'Ra': 88, 'Ac': 89,\n            'Th': 90, 'Pa': 91, 'U': 92, 'Np': 93, 'Pu': 94,\n            'Am': 95, 'Cm': 96, 'Bk': 97, 'Cf': 98, 'Es': 99,\n            'Fm': 100, 'Md': 101, 'No': 102, 'Lr': 103, 'Rf': 104,\n            'Db': 105, 'Sg': 106, 'Bh': 107, 'Hs': 108, 'Mt': 109,\n            'Ds': 110, 'Rg': 111, 'Cn': 112, 'Nh': 113, 'Fl': 114,\n            'Mc': 115, 'Lv': 116, 'Ts': 117, 'Og': 118,\n        };\n        //  Covalent radii revisited,\n        //  Beatriz Cordero, Vernica Gmez, Ana E. Platero-Prats, Marc Revs,\n        //  Jorge Echeverra, Eduard Cremades, Flavia Barragn and Santiago Alvarez,\n        //  Dalton Trans., 2008, 2832-2838 DOI:10.1039/B801115J\n        this.radii_unknown = 0.1;\n        this.covalentRadii = [\n            this.radii_unknown,\n            0.31,\n            0.28,\n            1.28,\n            0.96,\n            0.84,\n            0.76,\n            0.71,\n            0.66,\n            0.57,\n            0.58,\n            1.66,\n            1.41,\n            1.21,\n            1.11,\n            1.07,\n            1.05,\n            1.02,\n            1.06,\n            2.03,\n            1.76,\n            1.7,\n            1.6,\n            1.53,\n            1.39,\n            1.39,\n            1.32,\n            1.26,\n            1.24,\n            1.32,\n            1.22,\n            1.22,\n            1.2,\n            1.19,\n            1.2,\n            1.2,\n            1.16,\n            2.2,\n            1.95,\n            1.9,\n            1.75,\n            1.64,\n            1.54,\n            1.47,\n            1.46,\n            1.42,\n            1.39,\n            1.45,\n            1.44,\n            1.42,\n            1.39,\n            1.39,\n            1.38,\n            1.39,\n            1.4,\n            2.44,\n            2.15,\n            2.07,\n            2.04,\n            2.03,\n            2.01,\n            1.99,\n            1.98,\n            1.98,\n            1.96,\n            1.94,\n            1.92,\n            1.92,\n            1.89,\n            1.9,\n            1.87,\n            1.87,\n            1.75,\n            1.7,\n            1.62,\n            1.51,\n            1.44,\n            1.41,\n            1.36,\n            1.36,\n            1.32,\n            1.45,\n            1.46,\n            1.48,\n            1.4,\n            1.5,\n            1.5,\n            2.6,\n            2.21,\n            2.15,\n            2.06,\n            2.0,\n            1.96,\n            1.9,\n            1.87,\n            1.8,\n            1.69,\n            this.radii_unknown,\n            this.radii_unknown,\n            this.radii_unknown,\n            this.radii_unknown,\n            this.radii_unknown,\n            this.radii_unknown,\n            this.radii_unknown,\n        ];\n        // Jmol colors. See: http://jmol.sourceforge.net/jscolors/#color_U\n        this.color_unknown = \"#ff1493\";\n        this.jmolColors = [\n            this.color_unknown,\n            \"#ffffff\",\n            \"#d9ffff\",\n            \"#cc80ff\",\n            \"#c2ff00\",\n            \"#ffb5b5\",\n            \"#909090\",\n            \"#3050f8\",\n            \"#ff0d0d\",\n            \"#90e050\",\n            \"#b3e3f5\",\n            \"#ab5cf2\",\n            \"#8aff00\",\n            \"#bfa6a6\",\n            \"#f0c8a0\",\n            \"#ff8000\",\n            \"#ffff30\",\n            \"#1ff01f\",\n            \"#80d1e3\",\n            \"#8f40d4\",\n            \"#3dff00\",\n            \"#e6e6e6\",\n            \"#bfc2c7\",\n            \"#a6a6ab\",\n            \"#8a99c7\",\n            \"#9c7ac7\",\n            \"#e06633\",\n            \"#f090a0\",\n            \"#50d050\",\n            \"#c88033\",\n            \"#7d80b0\",\n            \"#c28f8f\",\n            \"#668f8f\",\n            \"#bd80e3\",\n            \"#ffa100\",\n            \"#a62929\",\n            \"#5cb8d1\",\n            \"#702eb0\",\n            \"#00ff00\",\n            \"#94ffff\",\n            \"#94e0e0\",\n            \"#73c2c9\",\n            \"#54b5b5\",\n            \"#3b9e9e\",\n            \"#248f8f\",\n            \"#0a7d8c\",\n            \"#006985\",\n            \"#c0c0c0\",\n            \"#ffd98f\",\n            \"#a67573\",\n            \"#668080\",\n            \"#9e63b5\",\n            \"#d47a00\",\n            \"#940094\",\n            \"#429eb0\",\n            \"#57178f\",\n            \"#00c900\",\n            \"#70d4ff\",\n            \"#ffffc7\",\n            \"#d9ffc7\",\n            \"#c7ffc7\",\n            \"#a3ffc7\",\n            \"#8fffc7\",\n            \"#61ffc7\",\n            \"#45ffc7\",\n            \"#30ffc7\",\n            \"#1fffc7\",\n            \"#00ff9c\",\n            \"#00e675\",\n            \"#00d452\",\n            \"#00bf38\",\n            \"#00ab24\",\n            \"#4dc2ff\",\n            \"#4da6ff\",\n            \"#2194d6\",\n            \"#267dab\",\n            \"#266696\",\n            \"#175487\",\n            \"#d0d0e0\",\n            \"#ffd123\",\n            \"#b8b8d0\",\n            \"#a6544d\",\n            \"#575961\",\n            \"#9e4fb5\",\n            \"#ab5c00\",\n            \"#754f45\",\n            \"#428296\",\n            \"#420066\",\n            \"#007d00\",\n            \"#70abfa\",\n            \"#00baff\",\n            \"#00a1ff\",\n            \"#008fff\",\n            \"#0080ff\",\n            \"#006bff\",\n            \"#545cf2\",\n            \"#785ce3\",\n            \"#8a4fe3\",\n            \"#a136d4\",\n            \"#b31fd4\",\n            \"#b31fba\",\n            \"#b30da6\",\n            \"#bd0d87\",\n            \"#c70066\",\n            \"#cc0059\",\n            \"#d1004f\",\n            \"#d90045\",\n            \"#e00038\",\n            \"#e6002e\",\n            \"#eb0026\",\n        ];\n    }\n    /**\n     * Saves the default options.\n    */\n    setOptions(options) {\n        // Save default settings\n        const atomDefaults = {\n            material: {\n                phong: {\n                    shininess: 30,\n                }\n            },\n            outline: {\n                enabled: true,\n                color: \"#000000\",\n                size: 0.025,\n            },\n            opacity: 1,\n            color: \"Jmol\",\n            radius: \"covalent\",\n            scale: 1,\n            smoothness: 165,\n        };\n        const bondDefaults = {\n            enabled: true,\n            material: {\n                phong: {\n                    shininess: 30,\n                }\n            },\n            outline: {\n                enabled: true,\n                color: \"#000000\",\n                size: 0.025,\n            },\n            color: \"#ffffff\",\n            radius: 0.08,\n            threshold: 1,\n            smoothness: 145\n        };\n        const cellDefaults = {\n            enabled: true,\n            color: \"#000000\",\n            linewidth: 1.5,\n            dashSize: 0,\n            gapSize: 0,\n            periodicity: [true, true, true],\n        };\n        const latticeConstantDefaults = {\n            enabled: true,\n            periodicity: [true, true, true],\n            font: \"Arial\",\n            size: 0.7,\n            stroke: {\n                width: 0.06,\n                color: \"#000\",\n            },\n            a: {\n                enabled: true,\n                color: \"#C52929\",\n                label: \"a\",\n            },\n            b: {\n                enabled: true,\n                color: \"#47A823\",\n                label: \"b\",\n            },\n            c: {\n                enabled: true,\n                color: \"#3B5796\",\n                label: \"c\",\n            },\n            alpha: {\n                enabled: true,\n                color: \"#ffffff\",\n                label: \"\",\n            },\n            beta: {\n                enabled: true,\n                color: \"#ffffff\",\n                label: \"\",\n            },\n            gamma: {\n                enabled: true,\n                color: \"#ffffff\",\n                label: \"\",\n            }\n        };\n        this.atomDefaults = merge(cloneDeep(atomDefaults), cloneDeep(options === null || options === void 0 ? void 0 : options.atoms));\n        this.bondDefaults = merge(cloneDeep(bondDefaults), cloneDeep(options === null || options === void 0 ? void 0 : options.bonds));\n        this.cellDefaults = merge(cloneDeep(cellDefaults), cloneDeep(options === null || options === void 0 ? void 0 : options.cell));\n        this.latticeConstantDefaults = merge(cloneDeep(latticeConstantDefaults), cloneDeep(options === null || options === void 0 ? void 0 : options.latticeConstants));\n    }\n    /*\n     * Overrides the implementation from the base class, as we need two scenes:\n     * one for the structure and another for the information that is laid on\n     * top.\n     */\n    setupScenes() {\n        // Setup the scenes in rendering order\n        this.scenes = [];\n        this.sceneStructure = new THREE.Scene();\n        this.scenes.push(this.sceneStructure);\n        this.sceneInfo = new THREE.Scene();\n        this.scenes.push(this.sceneInfo);\n        this.root = new THREE.Object3D();\n        this.container = new THREE.Object3D();\n        this.info = new THREE.Object3D();\n        this.atomsObject = new THREE.Object3D();\n        this.bondsObject = new THREE.Object3D();\n        this.container.add(this.atomsObject);\n        this.container.add(this.bondsObject);\n        this.angleArcs = new THREE.Object3D();\n        this.root.add(this.container);\n        this.sceneStructure.add(this.root);\n        this.sceneInfo.add(this.info);\n        this.latticeConstantsGroup = new THREE.Object3D();\n        this.container.add(this.latticeConstantsGroup);\n        // Setup the objects that are affected by rotations etc.\n        this.objects = [this.root, this.info];\n    }\n    /**\n     * Returns information about the elements included in the structure.\n     * @returns {Object} The current options.\n     */\n    getElementInfo() {\n        return this.elements;\n    }\n    /**\n     * Hides or shows the shadows.\n     */\n    toggleShadows(value) {\n        this.renderer.shadowMap.enabled = value;\n        for (let i = 0; i < this.lights.length; ++i) {\n            const light = this.lights[i];\n            light.castShadow = value;\n        }\n        for (let i = 0; i < this.atomFills.length; ++i) {\n            const atom = this.atomFills[i];\n            atom.receiveShadow = value;\n            atom.castShadow = value;\n            atom.material.needsUpdate = true;\n        }\n        for (let i = 0; i < this.bondFills.length; ++i) {\n            const bond = this.bondFills[i];\n            bond.receiveShadow = value;\n            bond.castShadow = value;\n            bond.material.needsUpdate = true;\n        }\n        // For some reason double rendering is required... Maybe delay()?\n        // this.render();\n        // this.render();\n    }\n    /**\n     * Visualizes the given atomic structure.\n     *\n     * @param {object} structure A Javascript object containing the structure. See\n     *   below for the subparameters.\n     * @param {number[][]} structure.positions Atomic positions. Default\n     *   interpretation is as cartesian positions, but you can specify whether they\n     *   are cartesial or fractional with the \"fractional\" attribute.\n     * @param {boolean} structure.fractional Whether the given positions are\n     *   fractional or not. Defaults to false if not specified.\n     * @param {string[]|number[]} structure.species Atomic numbers or chemical symbols of the atoms.\n     * @param {number[]} structure.cell The lattice vectors of the unit cell as\n     *   rows of a 3x3 array.\n     * @param {boolean[]} structure.pbc The periodic boundary conditions for\n     *   the structure as a list of three boolean values for each lattice\n     *   vector direction. Defaults to [false, false, false].\n     * @param {number[][]} structure.bonds Optional manually set bonds. Provide a\n     *   list of atomic index pairs, each pair specifying a bond between atoms.\n     *   If these bonds are not specified, the visualizer will by default use an\n     *   automated detection of bonds. This can be disabled through\n     *   options.bonds.enabled.\n     * @param {string} structure.wrap.type How atomic positions are\n     * wrapped in periodic systems. Available options are:\n     *    - \"none\": Visualized as is.\n     *    - \"boundary\": Positions that are on the cell boundaries are repeated.\n     *    - [a, b, c]: Positions are repeated along each lattice vector the\n     *      given amount of times.\n     *   Defaults to 'none'\n     * @param {number} structure.wrap.tolerance The wrapping\n     *   tolerance in angstroms. Defaults to 1e-8.\n     */\n    load(structure) {\n        // Save the structure for reloading\n        this.structure = structure;\n        // Determine the radii to be used\n        this.atomicRadii = this.covalentRadii;\n        // Determine the atom colors to be used\n        this.elementColors = this.jmolColors;\n        // Check that the received data is OK.\n        const isFractional = structure[\"fractional\"] === undefined ? false : structure[\"fractional\"];\n        const positions = structure[\"positions\"];\n        const species = structure[\"species\"];\n        const cell = structure[\"cell\"];\n        const wrap = merge({ type: 'none', tolerance: 1e-8 }, cloneDeep(structure[\"wrap\"]));\n        const periodicity = structure[\"pbc\"] || [false, false, false];\n        let bonds = structure[\"bonds\"];\n        if (!positions) {\n            console.log(\"No atom positions given to the structure viewer\");\n            return false;\n        }\n        if (!species) {\n            console.log(\"No species given to the structure viewer.\");\n            return false;\n        }\n        // Determine the atomicNumbers if not given\n        const atomicNumbers = typeof species[0] === \"number\"\n            ? species.map(Z => (Z < 0 || Z >= this.elementNames.length) ? 0 : Z)\n            : species.map(symb => this.elementNumbers[symb] || 0);\n        this.maxRadii = Math.max(...atomicNumbers.map(Z => this.getRadii(Z)));\n        // If bonds are not explicitly stated, determine them automatically.\n        if (!bonds) {\n            bonds = \"auto\";\n        }\n        else {\n            if (!Array.isArray(bonds)) {\n                console.log(\"Invalid value for 'bonds'. Provide a list of index pairs.\");\n                return false;\n            }\n        }\n        if (positions.length != atomicNumbers.length) {\n            console.log(\"The number of positions does not match the number of labels.\");\n            return false;\n        }\n        // Create a set of fractional and cartesian positions\n        this.createBasisVectors(cell);\n        let fracPos = [];\n        let cartPos = [];\n        // Create a set of fractional and cartesian positions\n        if (isFractional === true) {\n            fracPos = this.toVectors(positions);\n            cartPos = this.toCartesian(fracPos, true);\n        }\n        else if (isFractional === false) {\n            cartPos = this.toVectors(positions);\n            if (this.B !== undefined) {\n                fracPos = this.toScaled(cartPos, true);\n            }\n        }\n        // Valid cell basis\n        if (this.B !== undefined) {\n            this.createAtoms(fracPos, atomicNumbers, periodicity, true, wrap);\n            // Cell with non-valid basis\n        }\n        else if (this.basisVectors !== undefined) {\n            this.createAtoms(cartPos, atomicNumbers, periodicity, false, wrap);\n            // No cell at all\n        }\n        else {\n            this.createAtoms(cartPos, atomicNumbers, periodicity, false, wrap);\n        }\n        this.toggleShadows(this.rendererDefaults.shadows.enabled);\n        return true;\n    }\n    /**\n     * Calculates the center of points.\n     */\n    calculateCOP(positions) {\n        const nPos = positions.length;\n        const sum = new THREE.Vector3();\n        for (let i = 0; i < nPos; ++i) {\n            const pos = positions[i];\n            sum.add(pos);\n        }\n        sum.divideScalar(nPos);\n        return sum;\n    }\n    /**\n     * Centers the visualization around a specific point.\n     * @param position - The position to center on. Can be one of:\n     *   - 'COP': Center of all atom positions.\n     *   - 'COC': Center of the cell.\n     *   - Array<Number>: An array of atomic indices, the COP will be used.\n     *   - Array<Array<Number>>: An array of positions, the COP will be used.\n     */\n    center(positions) {\n        let centerPos;\n        if (positions === \"COP\") {\n            const atomPos = this.getPositionsGlobal();\n            centerPos = this.calculateCOP(atomPos);\n        }\n        else if (positions == 'COC') {\n            centerPos = this.getCOCGlobal();\n        }\n        else if (isArray(positions)) {\n            if (isNumber(positions[0])) {\n                const atomPos = this.getPositionsGlobal();\n                const points = positions.map(i => atomPos[i]);\n                centerPos = this.calculateCOP(points);\n            }\n            else {\n                const points = this.toVectors(positions);\n                centerPos = this.calculateCOP(points);\n            }\n        }\n        else {\n            throw Error(\"Invalid center positions.\");\n        }\n        this.translate(centerPos.multiplyScalar(-1));\n    }\n    /**\n     * Adjust the zoom so that the contents fit on the screen. Notice that is is\n     * typically useful to center around a point of interest first.\n     *\n     * @param position - The positions to take into account when fitting. Can be\n     *   one of:\n     *   - 'full': Fit the full view\n     *   - Array<Number>: An array of atomic indices, the COP will be used.\n     *   - Array<Array<Number>>: An array of positions, the COP will be used.\n     * @param {number}margin - Margin to apply, given in angstroms.\n     */\n    fit(positions, margin = 0) {\n        let points;\n        let addedMargin = 0;\n        if (positions === 'full') {\n            points = this.getPositionsGlobal();\n            addedMargin = this.maxRadii;\n        }\n        else if (isArray(positions)) {\n            if (isNumber(positions[0])) {\n                const atomGlobalPos = this.getPositionsGlobal();\n                points = positions.map(i => atomGlobalPos[i]);\n                addedMargin = Math.max(...positions.map(i => this.getRadii(this.atomicNumbers[i])));\n            }\n            else {\n                points = this.toVectors(positions);\n                points = points.map(p => p.clone().add(this.translation));\n            }\n        }\n        else {\n            throw Error(\"Invalid fit positions.\");\n        }\n        this.fitViewToPoints(points, margin + addedMargin);\n    }\n    /**\n     * Used to rotate the structure based of the alignment of the basis cell\n     * vectors with respect to the cartesian axes.\n     *\n     * @param alignments List of  up to two alignments for any two axis vectors.\n     * E.g. [[\"up\", \"c\"], [\"right\", \"b\"]] will force the third basis vector to\n     * point exactly up, and the second basis vector to as close to right as\n     * possible. The alignments are applied in the given order.\n     */\n    align(alignments) {\n        // Define available directions\n        const directions = {\n            \"a\": this.basisVectors[0].clone(),\n            \"-a\": this.basisVectors[0].clone().negate(),\n            \"b\": this.basisVectors[1].clone(),\n            \"-b\": this.basisVectors[1].clone().negate(),\n            \"c\": this.basisVectors[2].clone(),\n            \"-c\": this.basisVectors[2].clone().negate(),\n        };\n        // Align\n        super.alignView(alignments, directions);\n    }\n    /**\n     * Creates/updates representation for the atoms based on the given list of\n     * options. Notice that you can select the targeted atoms using the\n     * include/exclude options and also provide several configurations at once\n     * using a list.\n     *\n     * @param {object} options A Javascript object, or array of\n     *   objects containing the visualizaiton options. See below for the\n     *   subparameters.\n     * @param {number} options.include List of atomic indices to target with\n     * these options.\n     * @param {number} options.exclude List of atomic indices to exclude from\n     * these options.\n     * @param {number} options.smoothness A value between 0-180 that\n     *   controls the number of polygons. Used as the angle between adjacent\n     *   cylinder/sphere sectors that indirectly controls the number of\n     *   polygons.\n     * @param {number} options.opacity The opacity of the atom\n     * @param {number} options.material.phong.shininess Shininess of the\n     * atom material (for phong material)\n     * @param {number} options.material.toon.tones Tone-steps for toon\n     * material\n     * @param {string|number[]} options.radii The radius to use for the\n     * atom.  Defaults to covalent radii. Available options are:\n     *\n     *   - \"covalent\": Covalent radius from DOI:10.1039/B801115J.\n     *   - Radius in angstrom.\n     *\n     * @param {string|string[]} options.color The color to use. Available\n     * options are:\n     *\n     *   - \"Jmol\" (default): Jmol color.\n     *   - Hexadecimal color, e.g. '#ffffff'\n     *\n     * @param {number} options.scale Scaling factor for the atomic radii.\n     * Used to scale the given radius.\n     * @param {boolean} options.outline.enabled Used to enable or disable a\n     *   fixed color outline around the atom. Notice that enabling the\n     *   outline incurs a performance penalty.\n     * @param {string} options.outline.color Outline color.\n     * @param {number} options.outline.size Outline size.\n     */\n    atoms(options) {\n        // Update configs sequentially\n        if (isNil(options)) {\n            options = [{}];\n        }\n        else if (isPlainObject(options)) {\n            options = [options];\n        }\n        for (let config of options) {\n            config = merge(cloneDeep(this.atomDefaults), cloneDeep(config));\n            const include = config.include;\n            const exclude = config.exclude;\n            const hasInclude = !isNil(include);\n            const hasExclude = !isNil(exclude);\n            let indices;\n            const nAtoms = this.atomicNumbers.length;\n            if (hasInclude && hasExclude) {\n                throw Error(\"Only provide include or exclude, not both.\");\n            }\n            else if (hasInclude) {\n                indices = include;\n            }\n            else if (hasExclude) {\n                const excludeSet = new Set(exclude);\n                indices = range(nAtoms).filter(x => !excludeSet.has(x));\n            }\n            else {\n                indices = range(nAtoms);\n            }\n            // A hash is create for each configuration. This way we can store\n            // the config for each atom and easily see if e.g. meshes can be\n            // reused between atom instances.\n            delete config.include;\n            delete config.exclude;\n            const configHash = objectHash(config, { algorithm: 'md5' });\n            this.configMap[configHash] = config;\n            // Create/update visuals representations of the 3D atoms\n            for (const i of indices) {\n                this.atomConfigMap[i] = configHash;\n                this.updateAtom(i, config, configHash);\n            }\n        }\n    }\n    /**\n     * Creates/updates bond representation based on the given config.\n     *\n     * @param {boolean} options A Javascript object containing the options. See\n     *   below for the subparameters.\n     * @param {boolean} options.enabled Show bonds. Defaults to true.\n     * @param {any} options.include The atom indices to take into account when\n     *   creating bonds. Either provide a array or leave undefined to include\n     *   all. Defaults to undefined.\n     * @param {string} options.color Color of bonds. Defaults to \"#ffffff\".\n     * @param {number} options.radius Bond radius. Defaults to 0.08.\n     * @param {number} options.smoothness A value between 0-180 that\n     *   controls the number of polygons. Used as the angle between adjacent\n     *   cylinder/sphere sectors that indirectly controls the number of\n     *   polygons. Defaults to 145.\n     * @param {number} options.material.phong.shininess Shininess of the bond\n     *   material. Defaults to 30.\n     * @param {number} options.threshold Controls the automatic\n     *   detection of bonds between atoms. If custom bonds have not been\n     *   specified for the structure, bonds will be detected automatically with\n     *   the following criteria: distance <= options.threshold * 1.1 * (radius1\n     *   + radius2)\n     * @param {boolean} options.outline.enabled Used to enable or disable a\n     *   fixed color outline around the bond. Notice that enabling the\n     *   outline incurs a performance penalty. Defaults to true.\n     * @param {string} options.outline.color Outline color. Defaults to\n     *   \"#000000\".\n     * @param {number} options.outline.size Outline size. Defaults to 0.025.\n     */\n    bonds(options) {\n        // Remove old bonds\n        if (!isNil(this.bondsObject)) {\n            this.bondFills = [];\n            this.bondsObject.clear();\n        }\n        // Define final options\n        const optionsFinal = merge(cloneDeep(this.bondDefaults), cloneDeep(options || {}));\n        // Do not create new ones if disabled\n        if (!optionsFinal.enabled) {\n            return;\n        }\n        // Create the list of final indices\n        const include = optionsFinal.include;\n        const exclude = optionsFinal.exclude;\n        const hasInclude = !isNil(include);\n        const hasExclude = !isNil(exclude);\n        let indices;\n        const nAtoms = this.atomicNumbers.length;\n        if (hasInclude && hasExclude) {\n            throw Error(\"Only provide include or exclude, not both.\");\n        }\n        else if (hasInclude) {\n            indices = include;\n        }\n        else if (hasExclude) {\n            const excludeSet = new Set(exclude);\n            indices = range(nAtoms).filter(x => !excludeSet.has(x));\n        }\n        else {\n            indices = range(nAtoms);\n        }\n        // Create material once\n        let bondMaterial;\n        if (optionsFinal.material.toon) {\n            const nTones = optionsFinal.material.toon.tones;\n            const colors = new Uint8Array(nTones);\n            for (let c = 0; c <= nTones; c++) {\n                colors[c] = (c / nTones) * 256;\n            }\n            const gradientMap = new THREE.DataTexture(colors, colors.length, 1, THREE.LuminanceFormat);\n            gradientMap.minFilter = THREE.NearestFilter;\n            gradientMap.magFilter = THREE.NearestFilter;\n            gradientMap.generateMipmaps = false;\n            bondMaterial = new THREE.MeshToonMaterial({\n                color: optionsFinal.color,\n                gradientMap: gradientMap\n            });\n        }\n        else {\n            bondMaterial = new THREE.MeshPhongMaterial({\n                color: optionsFinal.color,\n                shininess: optionsFinal.material.phong.shininess\n            });\n        }\n        // Create bonds for all specified pairs\n        const atomPos = this.getPositionsLocal();\n        for (const i of indices) {\n            for (const j of indices) {\n                if (j > i) {\n                    const pos1 = atomPos[i];\n                    const pos2 = atomPos[j];\n                    const num1 = this.atomicNumbers[i];\n                    const num2 = this.atomicNumbers[j];\n                    const distance = pos2.clone().sub(pos1).length();\n                    const configHashI = this.atomConfigMap[i];\n                    const configHashJ = this.atomConfigMap[j];\n                    const configI = this.configMap[configHashI];\n                    const configJ = this.configMap[configHashJ];\n                    const radii1 = configI.scale * this.getRadii(num1);\n                    const radii2 = configJ.scale * this.getRadii(num2);\n                    if (distance <= optionsFinal.threshold * 1.1 * (radii1 + radii2)) {\n                        this.addBond(i, j, pos1, pos2, bondMaterial, optionsFinal);\n                    }\n                }\n            }\n        }\n    }\n    /**\n     * Returns the color for the given atomic number.\n     * @param {boolean} options.enabled Show unit cell wireframe. Defaults to true.\n     * @param {boolean} options.color Unit cell wireframe color. Defaults to \"#000000\".\n     * @param {boolean} options.linewidth Unit cell wireframe line width. Defaults to 1.5.\n     * @param {boolean} options.dashSize Unit cell wireframe dash size. Defaults to 0.\n     * Provide a value > 0 for a dashed line.\n     * @param {boolean} options.gapSize Unit cell wireframe dash size. Defaults to 0.\n     * Provide a value > 0 for a dashed line.\n     * @param {boolean} options.periodicity Periodicity of the cell. The\n     * non-periodic directions will be flattened. Defaults to [true, true, true].\n     *\n     */\n    cell(options) {\n        // Check that cell was defined for the structure\n        if (isNil(this.basisVectors)) {\n            throw Error(\"The loaded structure does not have any cell information.\");\n        }\n        // Delete old instance\n        if (!isNil(this.convCell)) {\n            this.container.remove(this.convCell);\n        }\n        // Define final options\n        const optionsFinal = merge(cloneDeep(this.cellDefaults), cloneDeep(options || {}));\n        // Create new instance\n        if (optionsFinal.enabled) {\n            const cell = this.createCell(new THREE.Vector3(), this.basisVectors, this.basisVectorCollapsed, optionsFinal.periodicity, optionsFinal.color, optionsFinal.linewidth, optionsFinal.dashSize, optionsFinal.gapSize);\n            this.convCell = cell;\n            this.container.add(this.convCell);\n        }\n    }\n    /**\n     * Visualizes the lattice constants using the given visualization options.\n     *\n     * @param {boolean} options.enabled Show lattice parameters. Defaults to true.\n     * @param {boolean} options.periodicity Periodicity of the lattice. Defaults\n     *   to [true, true, true]:\n     * @param {string} options.font Font size for lattice constants. Defaults to 0.7.\n     * constants. Applied as default to all labels, can be overridden\n     * individually for each lattice constant.\n     * @param {string} options.color Font color for lattice constants. Applied\n     * as default to all labels, can be overridden individually for each lattice\n     * constant. Defaults to\n     * @param {string} options.stroke.color Font stroke color\n     *   for lattice constants. Defaults to \"#000\". Applied as default to all\n     *   labels, can be overridden individually for each lattice constant.\n     * @param {string} options.stroke.width Font stroke width\n     *   for lattice constants. Defaults to \"#000\". Applied as default to all\n     *   labels, can be overridden individually for each lattice constant.\n     * @param {string} options.a.enabled Whether to display this lattice\n     *   contant. Defaults to true.\n     * @param {string} options.a.color Font color. Defaults to \"#C52929\".\n     * @param {string} options.a.font Font family. Defaults to \"Arial\".\n     * @param {number} options.a.size Font size. Defaults to 0.7.\n     * @param {number} options.a.label The label to display. Defaults to \"a\".\n     * @param {number} options.a.stroke.width Font stroke width. Defaults to 0.06.\n     * @param {string} options.a.stroke.color Font stroke color. Defaults to \"#000\".\n     * @param {string} options.b.enabled Whether to display this lattice\n     *   contant. Defaults to true.\n     * @param {string} options.b.color Font color. Defaults to \"#47A823\".\n     * @param {string} options.b.font Font family. Defaults to \"Arial\".\n     * @param {number} options.b.size Font size. Defaults to 0.7.\n     * @param {number} options.b.label The label to display. Defaults to \"b\".\n     * @param {number} options.b.stroke.width Font stroke width. Defaults to 0.06.\n     * @param {string} options.b.stroke.color Font stroke color. Defaults to \"#000\".\n     * @param {string} options.c.enabled Whether to display this lattice\n     *   contant. Defaults to true.\n     * @param {string} options.c.color Font color. Defaults to \"#3B5796\".\n     * @param {string} options.c.font Font family. Defaults to \"Arial\".\n     * @param {number} options.c.size Font size. Defaults to 0.7.\n     * @param {number} options.c.label The label to display. Defaults to \"c\".\n     * @param {number} options.c.stroke.width Font stroke width. Defaults to 0.06.\n     * @param {string} options.c.stroke.color Font stroke color. Defaults to \"#000\".\n     * @param {string} options.alpha.enabled Whether to display this lattice\n     *   contant. Defaults to true.\n     * @param {string} options.alpha.color Font color. Defaults to \"#ffffff\".\n     * @param {string} options.alpha.font Font family. Defaults to \"Arial\".\n     * @param {number} options.alpha.size Font size. Defaults to 0.7.\n     * @param {number} options.alpha.label The label to display. Defaults to \"\".\n     * @param {number} options.alpha.stroke.width Font stroke width. Defaults to 0.06.\n     * @param {string} options.alpha.stroke.color Font stroke color. Defaults to \"#000\".\n     * @param {string} options.beta.enabled Whether to display this lattice\n     *   contant. Defaults to true.\n     * @param {string} options.beta.color Font color. Defaults to \"#ffffff\".\n     * @param {string} options.beta.font Font family. Defaults to \"Arial\".\n     * @param {number} options.beta.size Font size. Defaults to 0.7.\n     * @param {number} options.beta.label The label to display. Defaults to \"\".\n     * @param {number} options.beta.stroke.width Font stroke width. Defaults to 0.06.\n     * @param {string} options.beta.stroke.color Font stroke color. Defaults to \"#000\".\n     * @param {string} options.gamma.enabled Whether to display this lattice\n     *   contant. Defaults to true.\n     * @param {string} options.gamma.color Font color. Defaults to \"#ffffff\".\n     * @param {string} options.gamma.font Font family. Defaults to \"Arial\".\n     * @param {number} options.gamma.size Font size. Defaults to 0.7.\n     * @param {number} options.gamma.label The label to display. Defaults to \"\".\n     * @param {number} options.gamma.stroke.width Font stroke width. Defaults to 0.06.\n     * @param {string} options.gamma.stroke.color Font stroke color. Defaults to \"#000\".\n     */\n    latticeConstants(options) {\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w, _x, _y, _z;\n        // Check that cell was defined for the structure\n        if (isNil(this.basisVectors)) {\n            throw Error(\"The loaded structure does not have any cell information.\");\n        }\n        // Delete old instance\n        this.latticeConstantsGroup.clear();\n        this.axisLabels = [];\n        this.angleArcs.clear();\n        // Define final options\n        const optionsFinal = merge(cloneDeep(this.latticeConstantDefaults), cloneDeep(options || {}));\n        if (!optionsFinal.enabled) {\n            return;\n        }\n        // Determine the periodicity and setup the vizualization accordingly\n        const periodicIndices = [];\n        for (let dim = 0; dim < 3; ++dim) {\n            const p1 = optionsFinal.periodicity[dim];\n            const p2 = optionsFinal.periodicity[(dim + 1) % 3];\n            const p3 = optionsFinal.periodicity[(dim + 2) % 3];\n            if (p1 && !p2 && !p3) {\n                periodicIndices.push(dim);\n                break;\n            }\n            else if (p1 && p2 && !p3) {\n                periodicIndices.push(dim);\n                periodicIndices.push((dim + 1) % 3);\n                break;\n            }\n        }\n        // Create new instances\n        const basis = this.basisVectors;\n        this.axisLabels = [];\n        this.info.add(this.latticeConstantsGroup);\n        this.info.add(this.angleArcs);\n        const infoColor = 0x000000;\n        const axisOffset = 1.3;\n        let iBasis = -1;\n        const cellBasisColors = [];\n        cellBasisColors.push(optionsFinal.a.color);\n        cellBasisColors.push(optionsFinal.b.color);\n        cellBasisColors.push(optionsFinal.c.color);\n        const angleColors = [];\n        angleColors.push(optionsFinal.alpha.color);\n        angleColors.push(optionsFinal.beta.color);\n        angleColors.push(optionsFinal.gamma.color);\n        const angleStrokeColors = [];\n        angleStrokeColors.push(((_b = (_a = optionsFinal.alpha) === null || _a === void 0 ? void 0 : _a.stroke) === null || _b === void 0 ? void 0 : _b.color) === undefined ? optionsFinal.stroke.color : optionsFinal.alpha.stroke.color);\n        angleStrokeColors.push(((_d = (_c = optionsFinal.beta) === null || _c === void 0 ? void 0 : _c.stroke) === null || _d === void 0 ? void 0 : _d.color) === undefined ? optionsFinal.stroke.color : optionsFinal.beta.stroke.color);\n        angleStrokeColors.push(((_f = (_e = optionsFinal.gamma) === null || _e === void 0 ? void 0 : _e.stroke) === null || _f === void 0 ? void 0 : _f.color) === undefined ? optionsFinal.stroke.color : optionsFinal.gamma.stroke.color);\n        const angleStrokeWidths = [];\n        angleStrokeWidths.push(((_h = (_g = optionsFinal.alpha) === null || _g === void 0 ? void 0 : _g.stroke) === null || _h === void 0 ? void 0 : _h.width) === undefined ? optionsFinal.stroke.width : optionsFinal.alpha.stroke.width);\n        angleStrokeWidths.push(((_k = (_j = optionsFinal.beta) === null || _j === void 0 ? void 0 : _j.stroke) === null || _k === void 0 ? void 0 : _k.width) === undefined ? optionsFinal.stroke.width : optionsFinal.beta.stroke.width);\n        angleStrokeWidths.push(((_m = (_l = optionsFinal.gamma) === null || _l === void 0 ? void 0 : _l.stroke) === null || _m === void 0 ? void 0 : _m.width) === undefined ? optionsFinal.stroke.width : optionsFinal.gamma.stroke.width);\n        const angleLabels = [optionsFinal.gamma.label, optionsFinal.alpha.label, optionsFinal.beta.label];\n        const axisLabels = [optionsFinal.a.label, optionsFinal.b.label, optionsFinal.c.label];\n        const angleEnableds = [optionsFinal.gamma.enabled, optionsFinal.alpha.enabled, optionsFinal.beta.enabled];\n        const axisEnableds = [optionsFinal.a.enabled, optionsFinal.b.enabled, optionsFinal.c.enabled];\n        const axisFonts = [];\n        axisFonts.push(optionsFinal.a.font === undefined ? optionsFinal.font : optionsFinal.a.font);\n        axisFonts.push(optionsFinal.b.font === undefined ? optionsFinal.font : optionsFinal.b.font);\n        axisFonts.push(optionsFinal.c.font === undefined ? optionsFinal.font : optionsFinal.c.font);\n        const axisFontSizes = [];\n        axisFontSizes.push(optionsFinal.a.size === undefined ? optionsFinal.size : optionsFinal.a.size);\n        axisFontSizes.push(optionsFinal.b.size === undefined ? optionsFinal.size : optionsFinal.b.size);\n        axisFontSizes.push(optionsFinal.c.size === undefined ? optionsFinal.size : optionsFinal.c.size);\n        const strokeColors = [];\n        strokeColors.push(((_p = (_o = optionsFinal.a) === null || _o === void 0 ? void 0 : _o.stroke) === null || _p === void 0 ? void 0 : _p.color) === undefined ? optionsFinal.stroke.color : optionsFinal.a.stroke.color);\n        strokeColors.push(((_r = (_q = optionsFinal.b) === null || _q === void 0 ? void 0 : _q.stroke) === null || _r === void 0 ? void 0 : _r.color) === undefined ? optionsFinal.stroke.color : optionsFinal.b.stroke.color);\n        strokeColors.push(((_t = (_s = optionsFinal.c) === null || _s === void 0 ? void 0 : _s.stroke) === null || _t === void 0 ? void 0 : _t.color) === undefined ? optionsFinal.stroke.color : optionsFinal.c.stroke.color);\n        const strokeWidths = [];\n        strokeWidths.push(((_v = (_u = optionsFinal.a) === null || _u === void 0 ? void 0 : _u.stroke) === null || _v === void 0 ? void 0 : _v.width) === undefined ? optionsFinal.stroke.width : optionsFinal.a.stroke.width);\n        strokeWidths.push(((_x = (_w = optionsFinal.b) === null || _w === void 0 ? void 0 : _w.stroke) === null || _x === void 0 ? void 0 : _x.width) === undefined ? optionsFinal.stroke.width : optionsFinal.b.stroke.width);\n        strokeWidths.push(((_z = (_y = optionsFinal.c) === null || _y === void 0 ? void 0 : _y.stroke) === null || _z === void 0 ? void 0 : _z.width) === undefined ? optionsFinal.stroke.width : optionsFinal.c.stroke.width);\n        const angleFonts = [];\n        angleFonts.push(optionsFinal.alpha.font === undefined ? optionsFinal.font : optionsFinal.alpha.font);\n        angleFonts.push(optionsFinal.beta.font === undefined ? optionsFinal.font : optionsFinal.beta.font);\n        angleFonts.push(optionsFinal.gamma.font === undefined ? optionsFinal.font : optionsFinal.gamma.font);\n        const angleFontSizes = [];\n        angleFontSizes.push(optionsFinal.alpha.size === undefined ? optionsFinal.size : optionsFinal.alpha.size);\n        angleFontSizes.push(optionsFinal.beta.size === undefined ? optionsFinal.size : optionsFinal.beta.size);\n        angleFontSizes.push(optionsFinal.gamma.size === undefined ? optionsFinal.size : optionsFinal.gamma.size);\n        // If 2D periodic, we save the periodic indices, and ensure a right\n        // handed coordinate system.\n        for (let iTrueBasis = 0; iTrueBasis < 3; ++iTrueBasis) {\n            iBasis += 1;\n            const axisLabel = axisLabels[iBasis];\n            const axisColor = cellBasisColors[iBasis];\n            const axisFont = axisFonts[iBasis];\n            const axisFontSize = axisFontSizes[iBasis];\n            const angleFontSize = angleFontSizes[iBasis];\n            const strokeWidth = strokeWidths[iBasis];\n            const strokeColor = strokeColors[iBasis];\n            const angleFont = angleFonts[iBasis];\n            const angleColor = angleColors[iBasis];\n            const angleLabel = angleLabels[iBasis];\n            const angleStrokeColor = angleStrokeColors[iBasis];\n            const angleStrokeWidth = angleStrokeWidths[iBasis];\n            const axisEnabled = axisEnableds[iBasis];\n            const angleEnabled = angleEnableds[iBasis];\n            const collapsed1 = this.basisVectorCollapsed[iTrueBasis];\n            const collapsed2 = this.basisVectorCollapsed[(iTrueBasis + 1) % 3];\n            const collapsed3 = this.basisVectorCollapsed[(iTrueBasis + 2) % 3];\n            const basisVec1 = basis[iTrueBasis];\n            const basisVec2 = basis[(iTrueBasis + 1) % 3].clone();\n            const basisVec3 = basis[(iTrueBasis + 2) % 3].clone();\n            if (axisEnabled && !collapsed1) {\n                // Basis and angle label selection, same for all systems\n                const origin = new THREE.Vector3(0, 0, 0);\n                const dir = basisVec1.clone();\n                // Add an axis label\n                const textPos = dir.clone()\n                    .multiplyScalar(0.5);\n                let labelOffset;\n                let newBasis;\n                if (collapsed2 && collapsed3) {\n                    newBasis = new THREE.Vector3(0, 0, 1);\n                    labelOffset = new THREE.Vector3().crossVectors(basisVec1, newBasis);\n                }\n                else if (collapsed2) {\n                    newBasis = new THREE.Vector3().crossVectors(basisVec1, basisVec3);\n                    labelOffset = new THREE.Vector3().crossVectors(basisVec1, newBasis);\n                }\n                else if (collapsed3) {\n                    newBasis = new THREE.Vector3().crossVectors(basisVec1, basisVec2);\n                    labelOffset = new THREE.Vector3().crossVectors(basisVec1, newBasis);\n                }\n                else {\n                    const labelOffset1 = new THREE.Vector3().crossVectors(basisVec1, basisVec2);\n                    const labelOffset2 = new THREE.Vector3().crossVectors(basisVec1, basisVec3);\n                    labelOffset = new THREE.Vector3().sub(labelOffset1).add(labelOffset2);\n                }\n                labelOffset.normalize();\n                labelOffset.multiplyScalar(0.8);\n                textPos.add(labelOffset);\n                const axisLabelSprite = this.createLabel(textPos, axisLabel, axisColor, axisFont, axisFontSize, new THREE.Vector2(0.0, 0.0), strokeWidth, strokeColor);\n                this.latticeConstantsGroup.add(axisLabelSprite);\n                this.axisLabels.push(axisLabelSprite);\n                // Add basis vector colored line\n                const cellVectorMaterial = new THREE.MeshBasicMaterial({\n                    color: axisColor,\n                    transparent: true,\n                    opacity: 0.75\n                });\n                const cellVector = basisVec1.clone();\n                const cellVectorLine = this.createCylinder(origin.clone(), cellVector.clone().add(origin), 0.09, 10, cellVectorMaterial);\n                this.latticeConstantsGroup.add(cellVectorLine);\n                // Add basis vector axis line\n                const cellAxisMaterial = new THREE.MeshBasicMaterial({\n                    color: \"#000000\",\n                });\n                const axisStart = this.basisVectors[iTrueBasis].clone();\n                const axisEnd = axisStart.clone().multiplyScalar(1 + axisOffset / axisStart.length());\n                const cellAxisVectorLine = this.createCylinder(origin.clone(), axisEnd, 0.02, 10, cellAxisMaterial);\n                this.latticeConstantsGroup.add(cellAxisVectorLine);\n                // Add axis arrow\n                const arrowGeometry = new THREE.CylinderGeometry(0, 0.10, 0.5, 12);\n                const arrowMaterial = new THREE.MeshBasicMaterial({\n                    color: infoColor,\n                });\n                const arrow = new THREE.Mesh(arrowGeometry, arrowMaterial);\n                arrow.position.copy(dir)\n                    .multiplyScalar(1 + axisOffset / dir.length());\n                arrow.lookAt(new THREE.Vector3());\n                arrow.rotateX(-Math.PI / 2);\n                this.latticeConstantsGroup.add(arrow);\n            }\n            if (angleEnabled && !collapsed1 && !collapsed2) {\n                // Add angle label and curve\n                const arcMaterial = new THREE.LineDashedMaterial({\n                    color: infoColor,\n                    linewidth: 2,\n                    dashSize: 0.2,\n                    gapSize: 0.1\n                });\n                const normal = new THREE.Vector3().crossVectors(basisVec1, basisVec2);\n                const angle = basisVec1.angleTo(basisVec2);\n                const radius = Math.max(Math.min(1 / 4 * basisVec1.length(), 1 / 4 * basisVec2.length()), 1);\n                const curve = new THREE.EllipseCurve(0, 0, // ax, aY\n                radius, radius, // xRadius, yRadius\n                0, angle, // aStartAngle, aEndAngle\n                false, // aClockwise\n                0 // aRotation\n                );\n                const nArcPoints = 20;\n                const points = curve.getSpacedPoints(nArcPoints);\n                const arcGeometry = new THREE.BufferGeometry().setFromPoints(points);\n                const arc = new THREE.Line(arcGeometry, arcMaterial);\n                arc.computeLineDistances();\n                // First rotate the arc so that it's x-axis points towards the\n                // first basis vector that defines the arc\n                const xAxis = new THREE.Vector3(1, 0, 0);\n                const quaternion = new THREE.Quaternion().setFromUnitVectors(xAxis, basisVec1.clone().normalize());\n                arc.quaternion.copy(quaternion);\n                // Then rotate the arc along it's x axis so that the xy-plane\n                // coincides with the plane defined by the the two basis vectors\n                // that define the plane.\n                const verticesArray = arcGeometry.attributes.position.array;\n                const nVertices = verticesArray.length / 3;\n                const lastArcPointLocal = new THREE.Vector3().fromArray(verticesArray, (nVertices - 1) * 3);\n                arc.updateMatrixWorld(); // The positions are not otherwise updated properly\n                const lastArcPointWorld = arc.localToWorld(lastArcPointLocal.clone());\n                // The angle direction is defined by the first basis vector\n                const axis = basisVec1;\n                const arcNormal = new THREE.Vector3()\n                    .crossVectors(axis, lastArcPointWorld);\n                let planeAngle = normal.angleTo(arcNormal);\n                const planeCross = new THREE.Vector3()\n                    .crossVectors(basisVec2, lastArcPointWorld);\n                const directionValue = planeCross.dot(axis);\n                if (directionValue > 0) {\n                    planeAngle = -planeAngle;\n                }\n                arc.rotateX(planeAngle);\n                // Add label for the angle\n                arc.updateMatrixWorld(); // The positions are not otherwise updated properly\n                arc.updateMatrix(); // The positions are not otherwise updated properly\n                const angleLabelPos = arc.localToWorld(new THREE.Vector3().fromArray(verticesArray, (nArcPoints / 2 - 1) * 3));\n                const angleLabelLen = angleLabelPos.length();\n                angleLabelPos.multiplyScalar(1 + 0.3 / angleLabelLen);\n                const angleLabelObj = this.createLabel(angleLabelPos, angleLabel.toString(), angleColor, angleFont, angleFontSize, new THREE.Vector2(0.0, 0.0), angleStrokeWidth, angleStrokeColor);\n                this.latticeConstantsGroup.add(angleLabelObj);\n                this.axisLabels.push(angleLabelObj);\n                this.angleArcs.add(arc);\n            }\n        }\n    }\n    /**\n     * Gets the local positions of the atoms.\n     */\n    getPositionsLocal() {\n        return this.positions;\n    }\n    /**\n     * Get the positions of atoms in the global coordinate system.\n     */\n    getPositionsGlobal() {\n        const nAtoms = this.positions.length;\n        const worldPos = [];\n        this.atomsObject.updateMatrixWorld(); // This update is required\n        for (let i = 0; i < nAtoms; ++i) {\n            const atom = this.atomsObject.getObjectByName(`atom${i}`);\n            const wPos = new THREE.Vector3();\n            atom.getWorldPosition(wPos);\n            worldPos.push(wPos);\n        }\n        return worldPos;\n    }\n    /**\n     * Get the positions of the center of cell in the global coordinate system.\n     */\n    getCOCGlobal() {\n        let COC = new THREE.Vector3()\n            .add(this.basisVectors[0])\n            .add(this.basisVectors[1])\n            .add(this.basisVectors[2])\n            .multiplyScalar(0.5);\n        this.root.updateMatrixWorld(); // This update is required\n        COC = this.root.localToWorld(COC);\n        return COC;\n    }\n    /**\n     * Converts a list of list of numbers into vectors.\n     *\n     * @param positions\n     * @returns {THREE.Vector3[]} The positions as an array of THREE.Vector3.\n     */\n    toVectors(positions) {\n        const vecPos = [];\n        for (let i = 0, size = positions.length; i < size; ++i) {\n            vecPos.push(new THREE.Vector3().fromArray(positions[i]));\n        }\n        return vecPos;\n    }\n    toCartesian(positions, copy = true) {\n        if (copy) {\n            const newPos = [];\n            for (let i = 0, size = positions.length; i < size; ++i) {\n                newPos.push(positions[i].clone().applyMatrix3(this.B));\n            }\n            return newPos;\n        }\n        else {\n            for (let i = 0, size = positions.length; i < size; ++i) {\n                positions[i].applyMatrix3(this.B);\n            }\n        }\n    }\n    toScaled(positions, copy = true) {\n        if (copy) {\n            const newPos = [];\n            for (let i = 0, size = positions.length; i < size; ++i) {\n                newPos.push(positions[i].clone().applyMatrix3(this.Bi));\n            }\n            return newPos;\n        }\n        else {\n            for (let i = 0, size = positions.length; i < size; ++i) {\n                positions[i].applyMatrix3(this.Bi);\n            }\n        }\n    }\n    /**\n     * Get a specific atom as defined by a js Group.\n     *\n     * @param index - Index of the atom.\n     * @return THREE.js Group containing the visuals for the atom. The position\n     * of the atom is determined by the position of the group.\n     */\n    getAtom(index) {\n        return this.atomsObject.getObjectByName(`atom${index}`);\n    }\n    setupLights() {\n        this.lights = [];\n        const shadowMapWidth = 2048;\n        const shadowBias = -0.001;\n        const shadowCutoff = 50;\n        // Key light\n        const keyLight = new THREE.DirectionalLight(0xffffff, 0.45);\n        keyLight.shadow.mapSize.width = shadowMapWidth;\n        keyLight.shadow.mapSize.height = shadowMapWidth;\n        keyLight.shadow.bias = shadowBias; //fixes self-shadowing artifacts\n        // Fixes an issue with some shadows being cutoff. Is there a more robust solution?\n        keyLight.shadow.camera.left = -shadowCutoff;\n        keyLight.shadow.camera.right = shadowCutoff;\n        keyLight.shadow.camera.top = shadowCutoff;\n        keyLight.shadow.camera.bottom = -shadowCutoff;\n        keyLight.position.set(0, 0, 20);\n        this.sceneStructure.add(keyLight);\n        this.lights.push(keyLight);\n        // Fill light\n        const fillLight = new THREE.DirectionalLight(0xffffff, 0.3);\n        fillLight.shadow.mapSize.width = shadowMapWidth;\n        fillLight.shadow.mapSize.height = shadowMapWidth;\n        fillLight.shadow.bias = shadowBias;\n        fillLight.position.set(-20, 0, -20);\n        // Back light\n        const backLight = new THREE.DirectionalLight(0xffffff, 0.25);\n        backLight.shadow.mapSize.width = shadowMapWidth;\n        backLight.shadow.mapSize.height = shadowMapWidth;\n        backLight.shadow.bias = shadowBias;\n        backLight.position.set(20, 0, -20);\n        // White ambient light.\n        const ambientLight = new THREE.AmbientLight(0x404040, 1.7); // soft white light\n        this.sceneStructure.add(ambientLight);\n    }\n    /**\n     * Creates a list of THREE.Vector3s from the given list of arrays.\n     *\n     * @param vectors - The positions from which to create vectors.\n     */\n    createBasisVectors(basis) {\n        // No cell specified\n        if (basis === undefined) {\n            this.basisVectors = undefined;\n            this.B = undefined;\n            this.Bi = undefined;\n            return;\n        }\n        // Create basis transformation matrices\n        const a = new THREE.Vector3().fromArray(basis[0]);\n        const b = new THREE.Vector3().fromArray(basis[1]);\n        const c = new THREE.Vector3().fromArray(basis[2]);\n        this.basisVectors = [a, b, c];\n        const B = new THREE.Matrix3();\n        B.set(a.x, b.x, c.x, a.y, b.y, c.y, a.z, b.z, c.z);\n        // Check for collapsed dimensions\n        this.basisVectorCollapsed = [];\n        for (let i = 0; i < 3; ++i) {\n            const length = this.basisVectors[i].length();\n            this.basisVectorCollapsed.push(length < 1E-6);\n        }\n        if (this.basisVectorCollapsed.some(element => element)) {\n            this.B = undefined;\n            this.Bi = undefined;\n        }\n        else {\n            this.B = B;\n            this.Bi = new THREE.Matrix3().copy(B).invert();\n        }\n    }\n    /**\n     * Returns the atomic radii for the given atomic number.\n     *\n     * @param atomicNumber - The atomic number for which radii is requested.\n     */\n    getRadii(atomicNumber) {\n        return this.atomicRadii[atomicNumber] || this.radii_unknown;\n    }\n    /**\n     * Returns the color for the given atomic number.\n     *\n     * @param atomicNumber - The atomic number for which color is requested.\n     */\n    getColor(config, atomicNumber) {\n        return config.color === 'Jmol'\n            ? this.elementColors[atomicNumber] || this.color_unknown\n            : config.color;\n    }\n    /**\n     * Creates outlines for a cell specified by the given basis vectors.\n     * @param origin - The origin for the cell\n     * @param basisVectors - The cell basis vectors\n     * @param basisVectorCollapsed - Whether a basis vector is collapsed (length = 0)\n     * @param periodicity - The periodicity of the cell\n     * @param color - Color fo the cell wireframe\n     * @param linewidth - Line width fo the wireframe\n     * @param dashed - Is wireframe dashed\n     */\n    createCell(origin, basisVectors, basisVectorCollapsed, periodicity, color, linewidth, dashSize, gapSize) {\n        let nonPeriodic;\n        const cell = new THREE.Object3D();\n        let lineMaterial;\n        if (!(dashSize === 0 && gapSize === 0)) {\n            lineMaterial = new THREE.LineDashedMaterial({\n                color: color,\n                linewidth: linewidth,\n                dashSize: dashSize,\n                gapSize: gapSize\n            });\n        }\n        else {\n            lineMaterial = new THREE.LineBasicMaterial({\n                color: color,\n                linewidth: linewidth\n            });\n        }\n        for (let len = basisVectors.length, i = 0; i < len; ++i) {\n            const basisVector = basisVectors[i].clone();\n            const collapsed = basisVectorCollapsed[i];\n            // First line\n            const line1Mat = lineMaterial.clone();\n            const isDim1 = !periodicity[i];\n            if (!(isDim1 && collapsed)) {\n                const points = [];\n                points.push(origin.clone());\n                points.push(basisVector.clone().add(origin));\n                const lineGeometry = new THREE.BufferGeometry().setFromPoints(points);\n                const line = new THREE.Line(lineGeometry, line1Mat);\n                cell.add(line);\n                line.computeLineDistances();\n            }\n            // Second line\n            const secondIndex = (i + 1) % len;\n            const secondAddition = basisVectors[secondIndex].clone();\n            const isDim2 = !periodicity[i] || !periodicity[(i + 1) % 3];\n            if (!(isDim2 && collapsed)) {\n                const line2Mat = lineMaterial.clone();\n                const points = [];\n                points.push(secondAddition.clone().add(origin));\n                points.push(basisVector.clone().add(secondAddition).add(origin));\n                const line2Geometry = new THREE.BufferGeometry().setFromPoints(points);\n                const line2 = new THREE.Line(line2Geometry, line2Mat);\n                cell.add(line2);\n                line2.computeLineDistances();\n            }\n            // Third line\n            const thirdIndex = (i + 2) % len;\n            const thirdAddition = basisVectors[thirdIndex].clone();\n            const isDim3 = !periodicity[i] || !periodicity[(i + 2) % 3];\n            if (!(isDim3 && collapsed)) {\n                const line3Mat = lineMaterial.clone();\n                const points = [];\n                points.push(thirdAddition.clone().add(origin));\n                points.push(basisVector.clone().add(thirdAddition).add(origin));\n                const line3Geometry = new THREE.BufferGeometry().setFromPoints(points);\n                const line3 = new THREE.Line(line3Geometry, line3Mat);\n                cell.add(line3);\n                line3.computeLineDistances();\n            }\n            // Fourth line\n            const isDim4 = !periodicity[i] || !periodicity[(i + 2) % 3] || !periodicity[(i + 1) % 3];\n            if (!(isDim4 && collapsed)) {\n                const line4Mat = lineMaterial.clone();\n                const points = [];\n                points.push(secondAddition.clone().add(thirdAddition).add(origin));\n                points.push(basisVector.clone().add(secondAddition).add(thirdAddition).add(origin));\n                const line4Geometry = new THREE.BufferGeometry().setFromPoints(points);\n                const line4 = new THREE.Line(line4Geometry, line4Mat);\n                cell.add(line4);\n                line4.computeLineDistances();\n            }\n        }\n        return cell;\n    }\n    /**\n     * Used to add periodic repetitions of atoms.\n     */\n    repeat(multipliers, fracPos, labels) {\n        const a = new THREE.Vector3(1, 0, 0);\n        const b = new THREE.Vector3(0, 1, 0);\n        const c = new THREE.Vector3(0, 0, 1);\n        const newPos = [];\n        const newLabels = [];\n        for (let i = 0; i < multipliers[0]; ++i) {\n            for (let j = 0; j < multipliers[1]; ++j) {\n                for (let k = 0; k < multipliers[2]; ++k) {\n                    if (!(i == 0 && j == 0 && k == 0)) {\n                        // Add clone to the current coordinate\n                        const aTranslation = a.clone().multiplyScalar(i);\n                        const bTranslation = b.clone().multiplyScalar(j);\n                        const cTranslation = c.clone().multiplyScalar(k);\n                        // Add in front\n                        for (let l = 0, size = fracPos.length; l < size; ++l) {\n                            const iPos = new THREE.Vector3().copy(fracPos[l]);\n                            iPos.add(aTranslation);\n                            iPos.add(bTranslation);\n                            iPos.add(cTranslation);\n                            const iLabel = labels[l];\n                            newPos.push(iPos);\n                            newLabels.push(iLabel);\n                        }\n                    }\n                }\n            }\n        }\n        for (let i = 0; i < newPos.length; ++i) {\n            fracPos.push(newPos[i]);\n            labels.push(newLabels[i]);\n        }\n    }\n    /**\n     * Controls the wrapping of atoms. Notice that only cell directions with\n     * periodic boundaries will be wrapped.\n     *\n     * @param {boolean} wrap - Whether to wrap or not.\n     */\n    wrap(wrap = true) {\n        const pbc = this.structure[\"pbc\"];\n        if (!pbc.some(a => a)) {\n            return;\n        }\n        // Check that cell is valid\n        if (isNil(this.B)) {\n            throw Error(\"Could not wrap as cell is not set.\");\n        }\n        // Get scaled positions, wrap to be within cell, revert back to\n        // cartesian and save.\n        if (wrap) {\n            const pos = this.toScaled(this.positions, true);\n            for (let len = pos.length, i = 0; i < len; ++i) {\n                const iFracPos = pos[i];\n                if (pbc[0])\n                    iFracPos.x = iFracPos.x < 0 ? 1 + (iFracPos.x % 1) : iFracPos.x % 1;\n                if (pbc[1])\n                    iFracPos.y = iFracPos.y < 0 ? 1 + (iFracPos.y % 1) : iFracPos.y % 1;\n                if (pbc[2])\n                    iFracPos.z = iFracPos.z < 0 ? 1 + (iFracPos.z % 1) : iFracPos.z % 1;\n            }\n            this.setPositions(pos, true);\n        }\n        else {\n            this.setPositions(this.positionsOriginal, false);\n        }\n    }\n    /**\n     * Set the position for atoms in the currently loaded structure.\n     */\n    setPositions(positions, fractional = false) {\n        if (fractional) {\n            this.toCartesian(positions, false);\n        }\n        for (let i = 0, size = positions.length; i < size; ++i) {\n            const position = positions[i];\n            const atom = this.getAtom(i);\n            atom.position.copy(position);\n        }\n        this.positions = positions;\n    }\n    /**\n     * Used to add periodic repetitions of atoms at the unit cell boundary.\n     */\n    addBoundaryAtoms(fracPos, labels, tolerance) {\n        for (let len = fracPos.length, i = 0; i < len; ++i) {\n            const iFracPos = fracPos[i];\n            const atomicNumber = labels[i];\n            // If the atom sits on the cell surface, add the periodic images if\n            // requested.\n            const x = iFracPos.x;\n            const y = iFracPos.y;\n            const z = iFracPos.z;\n            const xZero = this.almostEqual(0, x, this.basisVectors[0], tolerance);\n            const yZero = this.almostEqual(0, y, this.basisVectors[1], tolerance);\n            const zZero = this.almostEqual(0, z, this.basisVectors[2], tolerance);\n            if (xZero && yZero && zZero) {\n                fracPos.push(new THREE.Vector3(1, 0, 0).add(iFracPos));\n                labels.push(atomicNumber);\n                fracPos.push(new THREE.Vector3(0, 1, 0).add(iFracPos));\n                labels.push(atomicNumber);\n                fracPos.push(new THREE.Vector3(0, 0, 1).add(iFracPos));\n                labels.push(atomicNumber);\n                fracPos.push(new THREE.Vector3(1, 1, 0).add(iFracPos));\n                labels.push(atomicNumber);\n                fracPos.push(new THREE.Vector3(0, 1, 1).add(iFracPos));\n                labels.push(atomicNumber);\n                fracPos.push(new THREE.Vector3(1, 0, 1).add(iFracPos));\n                labels.push(atomicNumber);\n                fracPos.push(new THREE.Vector3(1, 1, 1).add(iFracPos));\n                labels.push(atomicNumber);\n            }\n            else if (xZero && yZero && !zZero) {\n                fracPos.push(new THREE.Vector3(1, 0, 0).add(iFracPos));\n                labels.push(atomicNumber);\n                fracPos.push(new THREE.Vector3(0, 1, 0).add(iFracPos));\n                labels.push(atomicNumber);\n                fracPos.push(new THREE.Vector3(1, 1, 0).add(iFracPos));\n                labels.push(atomicNumber);\n            }\n            else if (!xZero && yZero && zZero) {\n                fracPos.push(new THREE.Vector3(0, 1, 0).add(iFracPos));\n                labels.push(atomicNumber);\n                fracPos.push(new THREE.Vector3(0, 0, 1).add(iFracPos));\n                labels.push(atomicNumber);\n                fracPos.push(new THREE.Vector3(0, 1, 1).add(iFracPos));\n                labels.push(atomicNumber);\n            }\n            else if (xZero && !yZero && zZero) {\n                fracPos.push(new THREE.Vector3(1, 0, 0).add(iFracPos));\n                labels.push(atomicNumber);\n                fracPos.push(new THREE.Vector3(0, 0, 1).add(iFracPos));\n                labels.push(atomicNumber);\n                fracPos.push(new THREE.Vector3(1, 0, 1).add(iFracPos));\n                labels.push(atomicNumber);\n            }\n            else if (xZero && !yZero && !zZero) {\n                fracPos.push(new THREE.Vector3(1, 0, 0).add(iFracPos));\n                labels.push(atomicNumber);\n            }\n            else if (!xZero && yZero && !zZero) {\n                fracPos.push(new THREE.Vector3(0, 1, 0).add(iFracPos));\n                labels.push(atomicNumber);\n            }\n            else if (!xZero && !yZero && zZero) {\n                fracPos.push(new THREE.Vector3(0, 0, 1).add(iFracPos));\n                labels.push(atomicNumber);\n            }\n        }\n    }\n    /**\n     * Creates representation for all the given atoms.\n     *\n     * @param positions - Positions of the atoms\n     * @param labels - The element numbers for the atoms\n     */\n    createAtoms(positions, labels, pbc, fractional = true, wrap) {\n        // Delete old atoms\n        this.atomsObject.remove(...this.atomsObject.children);\n        this.elements = {};\n        this.atomFills = [];\n        this.atomOutlines = [];\n        // Determine the periodicity handling\n        if (pbc.some(a => { return a === true; })) {\n            if (fractional && wrap.type === \"boundary\") {\n                this.addBoundaryAtoms(positions, labels, wrap.tolerance);\n            }\n            else if (fractional && Array.isArray(wrap)) {\n                this.repeat(wrap, positions, labels);\n            }\n        }\n        // Convert fractional to cartesian\n        const cartPositions = [];\n        for (const pos of positions) {\n            const posVector = new THREE.Vector3();\n            if (fractional) {\n                posVector.add(this.basisVectors[0].clone().multiplyScalar(pos.x));\n                posVector.add(this.basisVectors[1].clone().multiplyScalar(pos.y));\n                posVector.add(this.basisVectors[2].clone().multiplyScalar(pos.z));\n            }\n            else {\n                posVector.copy(pos);\n            }\n            cartPositions.push(posVector);\n        }\n        // Save the atom positions for later instantiation according to the given styles.\n        this.positions = cartPositions;\n        this.positionsOriginal = cartPositions.map(x => x.clone());\n        this.atomicNumbers = labels;\n        // Gather element legend data\n        for (const atomicNumber of labels) {\n            const elementName = this.elementNames[atomicNumber];\n            this.elements[elementName] = [this.jmolColors[atomicNumber], this.covalentRadii[atomicNumber]];\n        }\n    }\n    /**\n     * Used to check if the given fractional position component is almost the\n     * given target value with a tolerance given in cartesian corodinates.\n     */\n    almostEqual(target, coordinate, basisVector, tolerance) {\n        const relDistance = (coordinate - target);\n        const absDistance = Math.abs(basisVector.clone().multiplyScalar(relDistance).length());\n        if (absDistance < tolerance) {\n            return true;\n        }\n        else {\n            return false;\n        }\n    }\n    /**\n     * Creates atom to the scene.\n     *\n     * @param position - Position of the atom\n     * @param atomicNumber - The atomic number for the added atom\n     */\n    addBond(i, j, pos1, pos2, bondMaterial, options) {\n        // Bond\n        const radius = options.radius;\n        const targetAngle = options.smoothness;\n        const nSegments = Math.ceil(360 / (180 - targetAngle));\n        const cylinder = this.createCylinder(pos1, pos2, radius, nSegments, bondMaterial);\n        cylinder.name = \"fill\";\n        this.bondFills.push(cylinder);\n        // Put all bonds visuals inside a named group\n        const group = new THREE.Group();\n        group.name = \"bond\" + i + \"-\" + j;\n        group.add(cylinder);\n        // Bond outline\n        if (options.outline.enabled) {\n            const addition = options.outline.size;\n            const scale = addition / radius + 1;\n            const outlineMaterial = new THREE.MeshBasicMaterial({ color: options.outline.color, side: THREE.BackSide });\n            const outline = this.createCylinder(pos1, pos2, scale * radius, 10, outlineMaterial);\n            outline.name = \"outline\";\n            group.add(outline);\n        }\n        this.bondsObject.add(group);\n    }\n    /**\n     * Creates atoms and directly adds them to the scene.\n     *\n     * @param position - Position of the atom\n     * @param atomicNumber - The atomic number for the added atom\n     */\n    updateAtom(index, config, configHash) {\n        var _a, _b;\n        // See if a mesh for this atom already exists. If not create it,\n        // otherwise reuse an existing mesh. Reusing meshes speeds up the\n        // creation significantly.\n        const atomicNumber = this.atomicNumbers[index];\n        const position = this.positions[index];\n        const hash = `${configHash}_${atomicNumber}`;\n        const mesh = this.meshMap[hash];\n        if (isNil(mesh)) {\n            this.meshMap[hash] = {};\n            // Atom \n            const atomGeometry = this.createAtomGeometry(config, atomicNumber);\n            const atomMaterial = this.createAtomMaterial(config, atomicNumber);\n            const atom = new THREE.Mesh(atomGeometry, atomMaterial);\n            this.meshMap[hash].atom = atom;\n            // Atom outline\n            if ((_a = config === null || config === void 0 ? void 0 : config.outline) === null || _a === void 0 ? void 0 : _a.enabled) {\n                const outlineGeometry = this.createAtomOutlineGeometry(config, atomicNumber);\n                const outlineMaterial = this.createAtomOutlineMaterial(config);\n                const outline = new THREE.Mesh(outlineGeometry, outlineMaterial);\n                this.meshMap[hash].outline = outline;\n            }\n        }\n        // Remove old representation if one exists\n        const atomGroup = this.atomsObject.getObjectByName(`atom${index}`);\n        if (!isNil(atomGroup)) {\n            atomGroup.removeFromParent();\n        }\n        // Add the new representation\n        const imesh = this.meshMap[hash];\n        const true_pos = new THREE.Vector3();\n        true_pos.copy(position);\n        // Put all atoms visuals inside a named group\n        const group = new THREE.Group();\n        group.name = \"atom\" + index;\n        const atom = imesh[\"atom\"].clone();\n        atom.name = \"fill\";\n        group.add(atom);\n        if ((_b = config === null || config === void 0 ? void 0 : config.outline) === null || _b === void 0 ? void 0 : _b.enabled) {\n            const outline = imesh[\"outline\"].clone();\n            this.atomOutlines.push(outline);\n            outline.name = \"outline\";\n            group.add(outline);\n        }\n        group.position.copy(true_pos);\n        this.atomsObject.add(group);\n        this.atomFills.push(atom);\n    }\n    createAtomGeometry(config, atomicNumber) {\n        // Calculate the amount of segments that are needed to reach a\n        // certain angle for the ball surface segments\n        const radius = config.radius === 'covalent'\n            ? this.getRadii(atomicNumber)\n            : config.radius;\n        const scaledRadius = config.scale * radius;\n        const targetAngle = config.smoothness;\n        const nSegments = Math.ceil(360 / (180 - targetAngle));\n        const atomGeometry = new THREE.SphereGeometry(scaledRadius, nSegments, nSegments);\n        return atomGeometry;\n    }\n    createAtomMaterial(config, atomicNumber) {\n        var _a, _b, _c;\n        let atomMaterial;\n        const color = this.getColor(config, atomicNumber);\n        if (((_a = config === null || config === void 0 ? void 0 : config.material) === null || _a === void 0 ? void 0 : _a.toon) !== undefined) {\n            const nTones = (_c = (_b = config === null || config === void 0 ? void 0 : config.material) === null || _b === void 0 ? void 0 : _b.toon) === null || _c === void 0 ? void 0 : _c.tones;\n            const colors = new Uint8Array(nTones);\n            for (let c = 0; c <= nTones; c++) {\n                colors[c] = (c / nTones) * 256;\n            }\n            const gradientMap = new THREE.DataTexture(colors, colors.length, 1, THREE.LuminanceFormat);\n            gradientMap.minFilter = THREE.NearestFilter;\n            gradientMap.magFilter = THREE.NearestFilter;\n            gradientMap.generateMipmaps = false;\n            atomMaterial = new THREE.MeshToonMaterial({\n                color: color,\n                gradientMap: gradientMap\n            });\n        }\n        else {\n            atomMaterial = new THREE.MeshPhongMaterial({\n                color: color,\n                shininess: config.material.phong.shininess,\n                opacity: config.opacity,\n                transparent: config.opacity !== 1,\n            });\n        }\n        return atomMaterial;\n    }\n    createAtomOutlineGeometry(config, atomicNumber) {\n        var _a;\n        const radius = config.radius === 'covalent'\n            ? this.getRadii(atomicNumber)\n            : config.radius;\n        const scaledRadius = config.scale * radius;\n        const addition = (_a = config === null || config === void 0 ? void 0 : config.outline) === null || _a === void 0 ? void 0 : _a.size;\n        const scale = addition / scaledRadius + 1;\n        const targetAngle = config.smoothness;\n        const nSegments = Math.ceil(360 / (180 - targetAngle));\n        return new THREE.SphereGeometry(scaledRadius * scale, nSegments, nSegments);\n    }\n    createAtomOutlineMaterial(config) {\n        var _a;\n        return new THREE.MeshBasicMaterial({\n            color: (_a = config === null || config === void 0 ? void 0 : config.outline) === null || _a === void 0 ? void 0 : _a.color,\n            side: THREE.BackSide,\n            opacity: config.opacity,\n            transparent: config.opacity !== 1,\n        });\n    }\n    /*\n     * A modified render-function that scales the labels according to the zoom\n     * level.\n     */\n    render() {\n        const canvas = this.rootElement;\n        const canvasWidth = canvas.clientWidth;\n        const canvasHeight = canvas.clientHeight;\n        // Project a [1,0,0] vector in the camera space to the world space, and\n        // then to the screen space. The length of this vector is then used to\n        // scale the labels.\n        const x = new THREE.Vector3(1, 0, 0);\n        const origin = new THREE.Vector3(0, 0, 0);\n        const vectors = [x, origin];\n        for (let i = 0; i < vectors.length; ++i) {\n            const vec = vectors[i];\n            this.camera.localToWorld(vec);\n            vec.project(this.camera);\n            vec.x = Math.round((vec.x + 1) * canvasWidth / 2);\n            vec.y = Math.round((-vec.y + 1) * canvasHeight / 2);\n        }\n        const displacement = new THREE.Vector3().subVectors(origin, x);\n        const distance = displacement.length();\n        const scale = 8 * 1 / Math.pow(distance, 0.5); // The sqrt makes the scaling behave nicer...\n        if (this.axisLabels !== undefined) {\n            for (let i = 0; i < this.axisLabels.length; ++i) {\n                const label = this.axisLabels[i];\n                label.scale.set(scale, scale, 1);\n            }\n        }\n        super.render();\n    }\n    /**\n     * Used to get a number of repetitions that are needed for the given\n     * latticevector to reach the target size.\n     *\n     * @param latticeVector - The vector that is to be extended.\n     * @param targetSize - The targeted size.\n     */\n    getRepetitions(latticeVector, targetSize) {\n        const vectorLen = latticeVector.length();\n        const multiplier = Math.max(Math.floor(targetSize / vectorLen) - 1, 1);\n        return multiplier;\n    }\n}\n","import * as THREE from \"three\";\nconst Visible = 0;\n// Entity for a Doubly-Connected Edge List (DCEL).\nclass HalfEdge {\n    constructor(vertex, face) {\n        this.vertex = null;\n        this.prev = null;\n        this.next = null;\n        this.twin = null;\n        this.face = null;\n        this.vertex = vertex;\n        this.face = face;\n    }\n    head() {\n        return this.vertex;\n    }\n    tail() {\n        return this.prev ? this.prev.vertex : null;\n    }\n    length() {\n        const head = this.head();\n        const tail = this.tail();\n        if (tail !== null) {\n            return tail.point.distanceTo(head.point);\n        }\n        return -1;\n    }\n    lengthSquared() {\n        const head = this.head();\n        const tail = this.tail();\n        if (tail !== null) {\n            return tail.point.distanceToSquared(head.point);\n        }\n        return -1;\n    }\n    setTwin(edge) {\n        this.twin = edge;\n        edge.twin = this;\n        return this;\n    }\n}\nclass Face {\n    constructor(a, b, c) {\n        this.normal = new THREE.Vector3();\n        this.midpoint = new THREE.Vector3();\n        this.area = 0;\n        this.constant = 0; // signed distance from face to the origin\n        this.outside = null; // reference to a vertex in a vertex list this face can see\n        this.mark = Visible;\n        this.edge = null;\n        var e0 = new HalfEdge(a, this);\n        var e1 = new HalfEdge(b, this);\n        var e2 = new HalfEdge(c, this);\n        // join edges\n        e0.next = e2.prev = e1;\n        e1.next = e0.prev = e2;\n        e2.next = e1.prev = e0;\n        // main half edge reference\n        this.edge = e0;\n        this.compute();\n    }\n    getEdge(i) {\n        var edge = this.edge;\n        while (i > 0) {\n            edge = edge.next;\n            i--;\n        }\n        while (i < 0) {\n            edge = edge.prev;\n            i++;\n        }\n        return edge;\n    }\n    compute() {\n        var triangle;\n        if (triangle === undefined)\n            triangle = new THREE.Triangle();\n        var a = this.edge.tail();\n        var b = this.edge.head();\n        var c = this.edge.next.head();\n        triangle.set(a.point, b.point, c.point);\n        triangle.getNormal(this.normal);\n        triangle.getMidpoint(this.midpoint);\n        this.area = triangle.getArea();\n        this.constant = this.normal.dot(this.midpoint);\n        return this;\n    }\n    distanceToPoint(point) {\n        return this.normal.dot(point) - this.constant;\n    }\n}\nexport const ConvexHull = (function () {\n    var Deleted = 1;\n    var v1 = new THREE.Vector3();\n    function ConvexHull() {\n        this.tolerance = -1;\n        this.faces = []; // the generated faces of the convex hull\n        this.newFaces = []; // this array holds the faces that are generated within a single iteration\n        // the vertex lists work as follows:\n        //\n        // let 'a' and 'b' be 'Face' instances\n        // let 'v' be points wrapped as instance of 'Vertex'\n        //\n        //     [v, v, ..., v, v, v, ...]\n        //      ^             ^\n        //      |             |\n        //  a.outside     b.outside\n        //\n        this.assigned = new VertexList();\n        this.unassigned = new VertexList();\n        this.vertices = []; // vertices of the hull (internal representation of given geometry data)\n    }\n    Object.assign(ConvexHull.prototype, {\n        setFromPoints: function (points) {\n            if (Array.isArray(points) !== true) {\n                console.error('THREE.ConvexHull: Points parameter is not an array.');\n            }\n            if (points.length < 4) {\n                console.error('THREE.ConvexHull: The algorithm needs at least four points.');\n            }\n            this.makeEmpty();\n            for (var i = 0, l = points.length; i < l; i++) {\n                this.vertices.push(new VertexNode(points[i]));\n            }\n            this.compute();\n            return this;\n        },\n        setFromObject: function (object) {\n            var points = [];\n            object.updateMatrixWorld(true);\n            object.traverse(function (node) {\n                var i, l, point;\n                var geometry = node.geometry;\n                if (geometry !== undefined) {\n                    if (geometry.isGeometry) {\n                        var vertices = geometry.vertices;\n                        for (i = 0, l = vertices.length; i < l; i++) {\n                            point = vertices[i].clone();\n                            point.applyMatrix4(node.matrixWorld);\n                            points.push(point);\n                        }\n                    }\n                    else if (geometry.isBufferGeometry) {\n                        var attribute = geometry.attributes.position;\n                        if (attribute !== undefined) {\n                            for (i = 0, l = attribute.count; i < l; i++) {\n                                point = new THREE.Vector3();\n                                point.fromBufferAttribute(attribute, i).applyMatrix4(node.matrixWorld);\n                                points.push(point);\n                            }\n                        }\n                    }\n                }\n            });\n            return this.setFromPoints(points);\n        },\n        containsPoint: function (point) {\n            var faces = this.faces;\n            for (var i = 0, l = faces.length; i < l; i++) {\n                var face = faces[i];\n                // compute signed distance and check on what half space the point lies\n                if (face.distanceToPoint(point) > this.tolerance)\n                    return false;\n            }\n            return true;\n        },\n        intersectRay: function (ray, target) {\n            // based on \"Fast Ray-Convex Polyhedron Intersection\"  by Eric Haines, GRAPHICS GEMS II\n            var faces = this.faces;\n            var tNear = -Infinity;\n            var tFar = Infinity;\n            for (var i = 0, l = faces.length; i < l; i++) {\n                var face = faces[i];\n                // interpret faces as planes for the further computation\n                var vN = face.distanceToPoint(ray.origin);\n                var vD = face.normal.dot(ray.direction);\n                // if the origin is on the positive side of a plane (so the plane can \"see\" the origin) and\n                // the ray is turned away or parallel to the plane, there is no intersection\n                if (vN > 0 && vD >= 0)\n                    return null;\n                // compute the distance from the rays origin to the intersection with the plane\n                var t = (vD !== 0) ? (-vN / vD) : 0;\n                // only proceed if the distance is positive. a negative distance means the intersection point\n                // lies \"behind\" the origin\n                if (t <= 0)\n                    continue;\n                // now categorized plane as front-facing or back-facing\n                if (vD > 0) {\n                    //  plane faces away from the ray, so this plane is a back-face\n                    tFar = Math.min(t, tFar);\n                }\n                else {\n                    // front-face\n                    tNear = Math.max(t, tNear);\n                }\n                if (tNear > tFar) {\n                    // if tNear ever is greater than tFar, the ray must miss the convex hull\n                    return null;\n                }\n            }\n            // evaluate intersection point\n            // always try tNear first since its the closer intersection point\n            if (tNear !== -Infinity) {\n                ray.at(tNear, target);\n            }\n            else {\n                ray.at(tFar, target);\n            }\n            return target;\n        },\n        intersectsRay: function (ray) {\n            return this.intersectRay(ray, v1) !== null;\n        },\n        makeEmpty: function () {\n            this.faces = [];\n            this.vertices = [];\n            return this;\n        },\n        // Adds a vertex to the 'assigned' list of vertices and assigns it to the given face\n        addVertexToFace: function (vertex, face) {\n            vertex.face = face;\n            if (face.outside === null) {\n                this.assigned.append(vertex);\n            }\n            else {\n                this.assigned.insertBefore(face.outside, vertex);\n            }\n            face.outside = vertex;\n            return this;\n        },\n        // Removes a vertex from the 'assigned' list of vertices and from the given face\n        removeVertexFromFace: function (vertex, face) {\n            if (vertex === face.outside) {\n                // fix face.outside link\n                if (vertex.next !== null && vertex.next.face === face) {\n                    // face has at least 2 outside vertices, move the 'outside' reference\n                    face.outside = vertex.next;\n                }\n                else {\n                    // vertex was the only outside vertex that face had\n                    face.outside = null;\n                }\n            }\n            this.assigned.remove(vertex);\n            return this;\n        },\n        // Removes all the visible vertices that a given face is able to see which are stored in the 'assigned' vertext list\n        removeAllVerticesFromFace: function (face) {\n            if (face.outside !== null) {\n                // reference to the first and last vertex of this face\n                var start = face.outside;\n                var end = face.outside;\n                while (end.next !== null && end.next.face === face) {\n                    end = end.next;\n                }\n                this.assigned.removeSubList(start, end);\n                // fix references\n                start.prev = end.next = null;\n                face.outside = null;\n                return start;\n            }\n        },\n        // Removes all the visible vertices that 'face' is able to see\n        deleteFaceVertices: function (face, absorbingFace) {\n            var faceVertices = this.removeAllVerticesFromFace(face);\n            if (faceVertices !== undefined) {\n                if (absorbingFace === undefined) {\n                    // mark the vertices to be reassigned to some other face\n                    this.unassigned.appendChain(faceVertices);\n                }\n                else {\n                    // if there's an absorbing face try to assign as many vertices as possible to it\n                    var vertex = faceVertices;\n                    do {\n                        // we need to buffer the subsequent vertex at this point because the 'vertex.next' reference\n                        // will be changed by upcoming method calls\n                        var nextVertex = vertex.next;\n                        var distance = absorbingFace.distanceToPoint(vertex.point);\n                        // check if 'vertex' is able to see 'absorbingFace'\n                        if (distance > this.tolerance) {\n                            this.addVertexToFace(vertex, absorbingFace);\n                        }\n                        else {\n                            this.unassigned.append(vertex);\n                        }\n                        // now assign next vertex\n                        vertex = nextVertex;\n                    } while (vertex !== null);\n                }\n            }\n            return this;\n        },\n        // Reassigns as many vertices as possible from the unassigned list to the new faces\n        resolveUnassignedPoints: function (newFaces) {\n            if (this.unassigned.isEmpty() === false) {\n                var vertex = this.unassigned.first();\n                do {\n                    // buffer 'next' reference, see .deleteFaceVertices()\n                    var nextVertex = vertex.next;\n                    var maxDistance = this.tolerance;\n                    var maxFace = null;\n                    for (var i = 0; i < newFaces.length; i++) {\n                        var face = newFaces[i];\n                        if (face.mark === Visible) {\n                            var distance = face.distanceToPoint(vertex.point);\n                            if (distance > maxDistance) {\n                                maxDistance = distance;\n                                maxFace = face;\n                            }\n                            if (maxDistance > 1000 * this.tolerance)\n                                break;\n                        }\n                    }\n                    // 'maxFace' can be null e.g. if there are identical vertices\n                    if (maxFace !== null) {\n                        this.addVertexToFace(vertex, maxFace);\n                    }\n                    vertex = nextVertex;\n                } while (vertex !== null);\n            }\n            return this;\n        },\n        // Computes the extremes of a simplex which will be the initial hull\n        computeExtremes: function () {\n            var min = new THREE.Vector3();\n            var max = new THREE.Vector3();\n            var minVertices = [];\n            var maxVertices = [];\n            var i, l, j;\n            // initially assume that the first vertex is the min/max\n            for (i = 0; i < 3; i++) {\n                minVertices[i] = maxVertices[i] = this.vertices[0];\n            }\n            min.copy(this.vertices[0].point);\n            max.copy(this.vertices[0].point);\n            // compute the min/max vertex on all six directions\n            for (i = 0, l = this.vertices.length; i < l; i++) {\n                var vertex = this.vertices[i];\n                var point = vertex.point;\n                // update the min coordinates\n                for (j = 0; j < 3; j++) {\n                    if (point.getComponent(j) < min.getComponent(j)) {\n                        min.setComponent(j, point.getComponent(j));\n                        minVertices[j] = vertex;\n                    }\n                }\n                // update the max coordinates\n                for (j = 0; j < 3; j++) {\n                    if (point.getComponent(j) > max.getComponent(j)) {\n                        max.setComponent(j, point.getComponent(j));\n                        maxVertices[j] = vertex;\n                    }\n                }\n            }\n            // use min/max vectors to compute an optimal epsilon\n            this.tolerance = 3 * Number.EPSILON * (Math.max(Math.abs(min.x), Math.abs(max.x)) +\n                Math.max(Math.abs(min.y), Math.abs(max.y)) +\n                Math.max(Math.abs(min.z), Math.abs(max.z)));\n            return { min: minVertices, max: maxVertices };\n        },\n        // Computes the initial simplex assigning to its faces all the points\n        // that are candidates to form part of the hull\n        computeInitialHull: function () {\n            var line3, plane, closestPoint;\n            return function computeInitialHull() {\n                if (line3 === undefined) {\n                    line3 = new THREE.Line3();\n                    plane = new THREE.Plane();\n                    closestPoint = new THREE.Vector3();\n                }\n                var vertex, vertices = this.vertices;\n                var extremes = this.computeExtremes();\n                var min = extremes.min;\n                var max = extremes.max;\n                var v0, v1, v2, v3;\n                var i, l, j;\n                // 1. Find the two vertices 'v0' and 'v1' with the greatest 1d separation\n                // (max.x - min.x)\n                // (max.y - min.y)\n                // (max.z - min.z)\n                var distance, maxDistance = 0;\n                var index = 0;\n                for (i = 0; i < 3; i++) {\n                    distance = max[i].point.getComponent(i) - min[i].point.getComponent(i);\n                    if (distance > maxDistance) {\n                        maxDistance = distance;\n                        index = i;\n                    }\n                }\n                v0 = min[index];\n                v1 = max[index];\n                // 2. The next vertex 'v2' is the one farthest to the line formed by 'v0' and 'v1'\n                maxDistance = 0;\n                line3.set(v0.point, v1.point);\n                for (i = 0, l = this.vertices.length; i < l; i++) {\n                    vertex = vertices[i];\n                    if (vertex !== v0 && vertex !== v1) {\n                        line3.closestPointToPoint(vertex.point, true, closestPoint);\n                        distance = closestPoint.distanceToSquared(vertex.point);\n                        if (distance > maxDistance) {\n                            maxDistance = distance;\n                            v2 = vertex;\n                        }\n                    }\n                }\n                // 3. The next vertex 'v3' is the one farthest to the plane 'v0', 'v1', 'v2'\n                maxDistance = -1;\n                plane.setFromCoplanarPoints(v0.point, v1.point, v2.point);\n                for (i = 0, l = this.vertices.length; i < l; i++) {\n                    vertex = vertices[i];\n                    if (vertex !== v0 && vertex !== v1 && vertex !== v2) {\n                        distance = Math.abs(plane.distanceToPoint(vertex.point));\n                        if (distance > maxDistance) {\n                            maxDistance = distance;\n                            v3 = vertex;\n                        }\n                    }\n                }\n                var faces = [];\n                if (plane.distanceToPoint(v3.point) < 0) {\n                    // the face is not able to see the point so 'plane.normal' is pointing outside the tetrahedron\n                    faces.push(new Face(v0, v1, v2), new Face(v3, v1, v0), new Face(v3, v2, v1), new Face(v3, v0, v2));\n                    // set the twin edge\n                    for (i = 0; i < 3; i++) {\n                        j = (i + 1) % 3;\n                        // join face[ i ] i > 0, with the first face\n                        faces[i + 1].getEdge(2).setTwin(faces[0].getEdge(j));\n                        // join face[ i ] with face[ i + 1 ], 1 <= i <= 3\n                        faces[i + 1].getEdge(1).setTwin(faces[j + 1].getEdge(0));\n                    }\n                }\n                else {\n                    // the face is able to see the point so 'plane.normal' is pointing inside the tetrahedron\n                    faces.push(new Face(v0, v2, v1), new Face(v3, v0, v1), new Face(v3, v1, v2), new Face(v3, v2, v0));\n                    // set the twin edge\n                    for (i = 0; i < 3; i++) {\n                        j = (i + 1) % 3;\n                        // join face[ i ] i > 0, with the first face\n                        faces[i + 1].getEdge(2).setTwin(faces[0].getEdge((3 - i) % 3));\n                        // join face[ i ] with face[ i + 1 ]\n                        faces[i + 1].getEdge(0).setTwin(faces[j + 1].getEdge(1));\n                    }\n                }\n                // the initial hull is the tetrahedron\n                for (i = 0; i < 4; i++) {\n                    this.faces.push(faces[i]);\n                }\n                // initial assignment of vertices to the faces of the tetrahedron\n                for (i = 0, l = vertices.length; i < l; i++) {\n                    vertex = vertices[i];\n                    if (vertex !== v0 && vertex !== v1 && vertex !== v2 && vertex !== v3) {\n                        maxDistance = this.tolerance;\n                        var maxFace = null;\n                        for (j = 0; j < 4; j++) {\n                            distance = this.faces[j].distanceToPoint(vertex.point);\n                            if (distance > maxDistance) {\n                                maxDistance = distance;\n                                maxFace = this.faces[j];\n                            }\n                        }\n                        if (maxFace !== null) {\n                            this.addVertexToFace(vertex, maxFace);\n                        }\n                    }\n                }\n                return this;\n            };\n        }(),\n        // Removes inactive faces\n        reindexFaces: function () {\n            var activeFaces = [];\n            for (var i = 0; i < this.faces.length; i++) {\n                var face = this.faces[i];\n                if (face.mark === Visible) {\n                    activeFaces.push(face);\n                }\n            }\n            this.faces = activeFaces;\n            return this;\n        },\n        // Finds the next vertex to create faces with the current hull\n        nextVertexToAdd: function () {\n            // if the 'assigned' list of vertices is empty, no vertices are left. return with 'undefined'\n            if (this.assigned.isEmpty() === false) {\n                var eyeVertex, maxDistance = 0;\n                // grap the first available face and start with the first visible vertex of that face\n                var eyeFace = this.assigned.first().face;\n                var vertex = eyeFace.outside;\n                // now calculate the farthest vertex that face can see\n                do {\n                    var distance = eyeFace.distanceToPoint(vertex.point);\n                    if (distance > maxDistance) {\n                        maxDistance = distance;\n                        eyeVertex = vertex;\n                    }\n                    vertex = vertex.next;\n                } while (vertex !== null && vertex.face === eyeFace);\n                return eyeVertex;\n            }\n        },\n        // Computes a chain of half edges in CCW order called the 'horizon'.\n        // For an edge to be part of the horizon it must join a face that can see\n        // 'eyePoint' and a face that cannot see 'eyePoint'.\n        computeHorizon: function (eyePoint, crossEdge, face, horizon) {\n            // moves face's vertices to the 'unassigned' vertex list\n            this.deleteFaceVertices(face);\n            face.mark = Deleted;\n            var edge;\n            if (crossEdge === null) {\n                edge = crossEdge = face.getEdge(0);\n            }\n            else {\n                // start from the next edge since 'crossEdge' was already analyzed\n                // (actually 'crossEdge.twin' was the edge who called this method recursively)\n                edge = crossEdge.next;\n            }\n            do {\n                var twinEdge = edge.twin;\n                var oppositeFace = twinEdge.face;\n                if (oppositeFace.mark === Visible) {\n                    if (oppositeFace.distanceToPoint(eyePoint) > this.tolerance) {\n                        // the opposite face can see the vertex, so proceed with next edge\n                        this.computeHorizon(eyePoint, twinEdge, oppositeFace, horizon);\n                    }\n                    else {\n                        // the opposite face can't see the vertex, so this edge is part of the horizon\n                        horizon.push(edge);\n                    }\n                }\n                edge = edge.next;\n            } while (edge !== crossEdge);\n            return this;\n        },\n        // Creates a face with the vertices 'eyeVertex.point', 'horizonEdge.tail' and 'horizonEdge.head' in CCW order\n        addAdjoiningFace: function (eyeVertex, horizonEdge) {\n            // all the half edges are created in ccw order thus the face is always pointing outside the hull\n            var face = new Face(eyeVertex, horizonEdge.tail(), horizonEdge.head());\n            this.faces.push(face);\n            // join face.getEdge( - 1 ) with the horizon's opposite edge face.getEdge( - 1 ) = face.getEdge( 2 )\n            face.getEdge(-1).setTwin(horizonEdge.twin);\n            return face.getEdge(0); // the half edge whose vertex is the eyeVertex\n        },\n        //  Adds 'horizon.length' faces to the hull, each face will be linked with the\n        //  horizon opposite face and the face on the left/right\n        addNewFaces: function (eyeVertex, horizon) {\n            this.newFaces = [];\n            var firstSideEdge = null;\n            var previousSideEdge = null;\n            for (var i = 0; i < horizon.length; i++) {\n                var horizonEdge = horizon[i];\n                // returns the right side edge\n                var sideEdge = this.addAdjoiningFace(eyeVertex, horizonEdge);\n                if (firstSideEdge === null) {\n                    firstSideEdge = sideEdge;\n                }\n                else {\n                    // joins face.getEdge( 1 ) with previousFace.getEdge( 0 )\n                    sideEdge.next.setTwin(previousSideEdge);\n                }\n                this.newFaces.push(sideEdge.face);\n                previousSideEdge = sideEdge;\n            }\n            // perform final join of new faces\n            firstSideEdge.next.setTwin(previousSideEdge);\n            return this;\n        },\n        // Adds a vertex to the hull\n        addVertexToHull: function (eyeVertex) {\n            var horizon = [];\n            this.unassigned.clear();\n            // remove 'eyeVertex' from 'eyeVertex.face' so that it can't be added to the 'unassigned' vertex list\n            this.removeVertexFromFace(eyeVertex, eyeVertex.face);\n            this.computeHorizon(eyeVertex.point, null, eyeVertex.face, horizon);\n            this.addNewFaces(eyeVertex, horizon);\n            // reassign 'unassigned' vertices to the new faces\n            this.resolveUnassignedPoints(this.newFaces);\n            return this;\n        },\n        cleanup: function () {\n            this.assigned.clear();\n            this.unassigned.clear();\n            this.newFaces = [];\n            return this;\n        },\n        compute: function () {\n            var vertex;\n            this.computeInitialHull();\n            // add all available vertices gradually to the hull\n            while ((vertex = this.nextVertexToAdd()) !== undefined) {\n                this.addVertexToHull(vertex);\n            }\n            this.reindexFaces();\n            this.cleanup();\n            return this;\n        }\n    });\n    // A vertex as a double linked list node.\n    function VertexNode(point) {\n        this.point = point;\n        this.prev = null;\n        this.next = null;\n        this.face = null; // the face that is able to see this vertex\n    }\n    // A double linked list that contains vertex nodes.\n    function VertexList() {\n        this.head = null;\n        this.tail = null;\n    }\n    Object.assign(VertexList.prototype, {\n        first: function () {\n            return this.head;\n        },\n        last: function () {\n            return this.tail;\n        },\n        clear: function () {\n            this.head = this.tail = null;\n            return this;\n        },\n        // Inserts a vertex before the target vertex\n        insertBefore: function (target, vertex) {\n            vertex.prev = target.prev;\n            vertex.next = target;\n            if (vertex.prev === null) {\n                this.head = vertex;\n            }\n            else {\n                vertex.prev.next = vertex;\n            }\n            target.prev = vertex;\n            return this;\n        },\n        // Inserts a vertex after the target vertex\n        insertAfter: function (target, vertex) {\n            vertex.prev = target;\n            vertex.next = target.next;\n            if (vertex.next === null) {\n                this.tail = vertex;\n            }\n            else {\n                vertex.next.prev = vertex;\n            }\n            target.next = vertex;\n            return this;\n        },\n        // Appends a vertex to the end of the linked list\n        append: function (vertex) {\n            if (this.head === null) {\n                this.head = vertex;\n            }\n            else {\n                this.tail.next = vertex;\n            }\n            vertex.prev = this.tail;\n            vertex.next = null; // the tail has no subsequent vertex\n            this.tail = vertex;\n            return this;\n        },\n        // Appends a chain of vertices where 'vertex' is the head.\n        appendChain: function (vertex) {\n            if (this.head === null) {\n                this.head = vertex;\n            }\n            else {\n                this.tail.next = vertex;\n            }\n            vertex.prev = this.tail;\n            // ensure that the 'tail' reference points to the last vertex of the chain\n            while (vertex.next !== null) {\n                vertex = vertex.next;\n            }\n            this.tail = vertex;\n            return this;\n        },\n        // Removes a vertex from the linked list\n        remove: function (vertex) {\n            if (vertex.prev === null) {\n                this.head = vertex.next;\n            }\n            else {\n                vertex.prev.next = vertex.next;\n            }\n            if (vertex.next === null) {\n                this.tail = vertex.prev;\n            }\n            else {\n                vertex.next.prev = vertex.prev;\n            }\n            return this;\n        },\n        // Removes a list of vertices whose 'head' is 'a' and whose 'tail' is b\n        removeSubList: function (a, b) {\n            if (a.prev === null) {\n                this.head = b.next;\n            }\n            else {\n                a.prev.next = b.next;\n            }\n            if (b.next === null) {\n                this.tail = a.prev;\n            }\n            else {\n                b.next.prev = a.prev;\n            }\n            return this;\n        },\n        isEmpty: function () {\n            return this.head === null;\n        }\n    });\n    return ConvexHull;\n})();\n","import { Viewer } from \"./viewer\";\nimport * as THREE from \"three\";\nimport { getConvexGeometry } from './convexgeometry';\nimport { MeshLine, MeshLineMaterial } from 'three.meshline';\nimport { isNil, merge, cloneDeep } from \"lodash\";\nimport voronoi from 'voronoi-diagram';\n/*\n * A 3D visualizer for the Brillouin Zone and the k-point path within it.\n */\nexport class BrillouinZoneViewer extends Viewer {\n    /**\n     * @param {any} hostElement is the html element where the visualization\n     *   canvas will be appended.\n     * @param {Object} options An object that can hold custom settings for the viewer.\n     * @param {string} options.renderer.pixelRatioScale Scaling factor for the pixel ratio. Defaults to 1.\n     * @param {string} options.renderer.antialias.enabled Whether antialiasing is enabled. Defaults to true.\n     * @param {string} options.renderer.background.color Color of the background. Defaults to \"#fff\".\n     * @param {number} options.renderer.background.opacity Opacity of the background. Defaults to 0.\n     * @param {boolean} options.renderer.shadows.enabled Whether shows are cast\n     *   by atoms onto others. Note that enabling this increases the computational\n     *   cost for doing the visualization. Defaults to false\n     * @param {Object} options.controls Default options for the controls-function. See\n     *   the function for more information.\n     */\n    constructor(hostElement, options = {}) {\n        super(hostElement, options);\n        this.hostElement = hostElement;\n    }\n    /**\n     * Saves the default options.\n    */\n    setOptions(options) {\n        const controlDefaults = {\n            zoom: {\n                enabled: true,\n                speed: 0.2\n            },\n            rotation: {\n                enabled: true,\n                speed: 40\n            },\n            pan: {\n                enabled: true,\n                speed: 10\n            },\n            resetOnDoubleClick: true\n        };\n        this.controlDefaults = merge(cloneDeep(controlDefaults), cloneDeep(options === null || options === void 0 ? void 0 : options.controls));\n    }\n    /*\n     * Overrides the implementation from the base class, as we need two scenes:\n     * one for the BZ mesh and another for the information that is laid on top.\n     */\n    setupScenes() {\n        // Setup the scenes in rendering order\n        this.scenes = [];\n        this.sceneRoot = new THREE.Scene();\n        this.scenes.push(this.sceneRoot);\n        this.sceneInfo = new THREE.Scene();\n        this.scenes.push(this.sceneInfo);\n        this.root = new THREE.Object3D();\n        this.sceneRoot.add(this.root);\n        this.info = new THREE.Object3D();\n        this.sceneInfo.add(this.info);\n        // Setup the objects that are affected by rotations etc.\n        this.objects = [this.root, this.info];\n    }\n    setupLights() {\n        // Key light\n        const keyLight = new THREE.DirectionalLight(0xffffff, 0.45);\n        keyLight.position.set(0, 0, 20);\n        this.sceneRoot.add(keyLight);\n        // Fill light\n        const fillLight = new THREE.DirectionalLight(0xffffff, 0.3);\n        fillLight.position.set(-20, 0, -20);\n        this.sceneRoot.add(fillLight);\n        // Back light\n        const backLight = new THREE.DirectionalLight(0xffffff, 0.25);\n        backLight.position.set(20, 0, -20);\n        this.sceneRoot.add(backLight);\n        // White ambient light.\n        const ambientLight = new THREE.AmbientLight(0x404040, 3.7); // soft white light\n        this.sceneRoot.add(ambientLight);\n    }\n    /**\n     * Used to create a visualization for the first Brillouin Zone together with\n     * kpath and segment information.\n     *\n     * @param {object} data A Javascript object containing the visualized\n     * structure. See below for the subparameters.\n     * @param {number[][]} data.basis The basis vectors of the reciprocal cell as\n     *   rows of a 3x3 array.\n     * @param {number[][]} data.segments List containing lists of k-points,\n     * each sublist indicating a continuous segment within the Brillouin zone.\n     * @param {*} data.kpoints List of pairs of labels and reciprocal\n     * lattice coordinates for specific k-points that should be shown.\n     *\n     * @param {object} options A Javascript object containing the options. See\n     *   below for the subparameters.\n     *\n     * @param {string} options.segments.color Segment color\n     * @param {number} options.segments.linewidth Segment linewidth\n     *\n     * @param {string} options.faces.color Face color\n     * @param {number} options.faces.opacity Face opacity\n     * @param {string} options.faces.outline.color Face outline color\n     * @param {number} options.faces.outline.width Face outline width\n     *\n     * @param {string} options.kpoints.label.color Label color\n     * @param {number} options.kpoints.label.size Label size\n     * @param {string} options.kpoints.label.font Label font\n     * @param {boolean} options.kpoints.label.offset2D Offset of the labels in\n     * the sprite's 2D coordinate system. The offset is relative to the font\n     * size and the default [0, 0] corresponds to centered labels.\n     * @param {string} options.kpoints.point.color Point color\n     * @param {number} options.kpoints.point.size Point size\n     * @param {string} options.kpoints.stroke.width Label outline stroke width\n     * @param {string} options.kpoints.stroke.color Label outline stroke color\n     *\n     * @param {string} options.basis.color Font colour for basis labels. Applied as\n     * default to all labels, can be overridden individually for each basis.\n     * @param {number} options.basis.font Font size for basis labels. Applied as\n     * default to all labels, can be overridden individually for each basis.\n     * @param {number} options.basis.offset Offset for basis labels.\n     * @param {number} options.basis.stroke.width Label outline stroke width\n     * @param {string} options.basis.stroke.color Label outline stroke color\n     *\n     * @param {string} options.basis.a.color Color applied to the\n     *   label of the first reciprocal lattice vector.\n     * @param {string} options.basis.a.font Font family applied to the\n     *   label of the first reciprocal lattice vector.\n     * @param {number} options.basis.a.size Font size applied to the\n     *   label of the first reciprocal lattice vector.\n     * @param {number} options.basis.a.stroke.width Outline stroke width\n     * applied to the label of the first reciprocal lattice vector.\n     * @param {string} options.basis.a.stroke.color Outline stroke color\n     * applied to the label of the first reciprocal lattice vector.\n     *\n     * @param {string} options.basis.b.color Color applied to the\n     *   label of the second reciprocal lattice vector.\n     * @param {string} options.basis.b.font Font family applied to the\n     *   label of the second reciprocal lattice vector.\n     * @param {number} options.basis.b.size Font size applied to the\n     *   label of the second reciprocal lattice vector.\n     * @param {number} options.basis.b.stroke.width Outline stroke width\n     * applied to the label of the second reciprocal lattice vector.\n     * @param {string} options.basis.b.stroke.color Outline stroke color\n     * applied to the label of the second reciprocal lattice vector.\n     *\n     * @param {string} options.basis.c.color Color applied to the\n     *   label of the third reciprocal lattice vector.\n     * @param {string} options.basis.c.font Font family applied to the\n     *   label of the third reciprocal lattice vector.\n     * @param {number} options.basis.c.size Font size applied to the\n     *   label of the third reciprocal lattice vector.\n     * @param {number} options.basis.c.stroke.width Outline stroke width\n     * applied to the label of the third reciprocal lattice vector.\n     * @param {string} options.basis.c.stroke.color Outline stroke color\n     * applied to the label of the third reciprocal lattice vector.\n     */\n    load(data, options) {\n        var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t, _u, _v, _w;\n        // Read the Brillouin zone and the k-point path\n        this.basis = data[\"basis\"];\n        this.segments = data[\"segments\"];\n        this.kpoints = data[\"kpoints\"];\n        if (!this.basis || !this.segments) {\n            throw Error(\"The data given for the Brillouin zone viewer is incomplete.\");\n        }\n        // Remove old viz\n        if (!isNil(this.info)) {\n            this.info.clear();\n        }\n        if (!isNil(this.root)) {\n            this.root.clear();\n        }\n        // Define final options\n        const def = {\n            basis: {\n                offset: 0.02,\n                font: \"Arial\",\n                size: 0.03,\n                stroke: {\n                    width: 0.06,\n                    color: \"#000\",\n                },\n                a: {\n                    label: \"a\",\n                },\n                b: {\n                    label: \"b\",\n                },\n                c: {\n                    label: \"c\",\n                },\n            },\n            segments: {\n                color: \"#E56400\",\n                linewidth: 0.0025,\n            },\n            kpoints: {\n                point: {\n                    enabled: true,\n                    size: 0.01,\n                    color: \"#E56400\",\n                },\n                label: {\n                    enabled: true,\n                    font: \"Arial\",\n                    size: 0.025,\n                    color: \"#E56400\",\n                    offset2D: [0, -0.75],\n                    stroke: {\n                        width: 0.06,\n                        color: \"#000\",\n                    },\n                }\n            },\n            faces: {\n                color: \"#ddd\",\n                opacity: 0.7,\n                outline: {\n                    width: 0.002,\n                    color: \"#999\",\n                },\n            },\n        };\n        const optionsFinal = merge(cloneDeep(def), cloneDeep(options || {}));\n        // Create list of reciprocal lattice points\n        const basis = this.basis;\n        const segments = this.segments;\n        const kpoints = this.kpoints;\n        const B = new THREE.Matrix3();\n        const a = new THREE.Vector3().fromArray(basis[0]);\n        const b = new THREE.Vector3().fromArray(basis[1]);\n        const c = new THREE.Vector3().fromArray(basis[2]);\n        B.set(a.x, b.x, c.x, a.y, b.y, c.y, a.z, b.z, c.z);\n        this.basisVectors = [a, b, c];\n        this.B = B;\n        const I = new THREE.Matrix3().identity();\n        const points = [];\n        const limit = 1;\n        for (let i = -limit; i <= limit; ++i) {\n            for (let j = -limit; j <= limit; ++j) {\n                for (let k = -limit; k <= limit; ++k) {\n                    const multiplier = new THREE.Vector3(i, j, k);\n                    const point = this.coordinateTransform(this.B, I, multiplier, false);\n                    points.push(point.toArray());\n                }\n            }\n        }\n        // Create voronoi cells\n        const res = voronoi(points);\n        // Find the finite cell with center at origin, i.e. the first Brillouin\n        // Zone\n        let bzVertices;\n        for (const cell of res.cells) {\n            // Check if cell is finite\n            const vpoints = [];\n            let finite = true;\n            let finite2 = true;\n            for (const index of cell) {\n                if (index === -1) {\n                    finite = false;\n                    break;\n                }\n                const vpoint = res.positions[index];\n                for (let j = 0; j < 3; ++j) {\n                    if (Number.isNaN(vpoint[j])) {\n                        finite2 = false;\n                        break;\n                    }\n                }\n                vpoints.push(vpoint);\n            }\n            if (!finite || !finite2) {\n                continue;\n            }\n            // Find cell that is centered on origin \n            const center = new THREE.Vector3(0, 0, 0);\n            const vertices = [];\n            for (let i = 0; i < vpoints.length; ++i) {\n                const vertex = new THREE.Vector3().fromArray(vpoints[i]);\n                vertices.push(vertex);\n                center.add(vertex);\n            }\n            center.divideScalar(vertices.length);\n            if (center.length() < 1e-7) {\n                bzVertices = vertices;\n                break;\n            }\n        }\n        // A customised THREE.BufferGeometry object that will create the face\n        // geometry and information about the face edges\n        const { geometry, faces } = getConvexGeometry(bzVertices);\n        // Weird hack for achieving translucent surfaces. Setting\n        // side=DoubleSide on a single mesh will not do.\n        const group = new THREE.Group();\n        group.name = \"group\";\n        const meshMaterial = new THREE.MeshPhongMaterial({\n            color: optionsFinal.faces.color,\n            opacity: optionsFinal.faces.opacity,\n            transparent: true\n        });\n        const mesh = new THREE.Mesh(geometry, meshMaterial);\n        mesh.name = \"innermesh\";\n        mesh.material.side = THREE.BackSide; // back faces\n        mesh.renderOrder = 0;\n        group.add(mesh);\n        const mesh2 = new THREE.Mesh(geometry, meshMaterial.clone());\n        mesh2.name = \"outermesh\";\n        mesh2.material.side = THREE.FrontSide; // front faces\n        mesh2.renderOrder = 1;\n        group.add(mesh2);\n        this.root.add(group);\n        // Create edges as closed loops around each face\n        const edgeWidth = optionsFinal.faces.outline.width;\n        const edgeMaterial = new MeshLineMaterial({\n            color: optionsFinal.faces.outline.color,\n            lineWidth: edgeWidth,\n            sizeAttenuation: true,\n        });\n        for (const face of faces) {\n            const edgeVertices = [];\n            for (const vertex of face) {\n                let scaledVertex = vertex.clone();\n                const length = scaledVertex.length();\n                scaledVertex = scaledVertex.multiplyScalar(1 + 0.5 * edgeWidth / length);\n                edgeVertices.push(scaledVertex);\n            }\n            //const edgeGeometry = new THREE.BufferGeometry().setFromPoints(edgeVertices);\n            const edgeLine = new MeshLine();\n            edgeLine.setPoints(edgeVertices);\n            const edgeMesh = new THREE.Mesh(edgeLine, edgeMaterial);\n            this.root.add(edgeMesh);\n        }\n        // Create the reciprocal space axes\n        const basisLabels = [optionsFinal.basis.a.label, optionsFinal.basis.b.label, optionsFinal.basis.c.label];\n        const basisFonts = [];\n        basisFonts.push(((_a = optionsFinal.basis.a) === null || _a === void 0 ? void 0 : _a.font) === undefined ? optionsFinal.basis.font : optionsFinal.basis.a.font);\n        basisFonts.push(((_b = optionsFinal.basis.b) === null || _b === void 0 ? void 0 : _b.font) === undefined ? optionsFinal.basis.font : optionsFinal.basis.b.font);\n        basisFonts.push(((_c = optionsFinal.basis.c) === null || _c === void 0 ? void 0 : _c.font) === undefined ? optionsFinal.basis.font : optionsFinal.basis.c.font);\n        const basisFontSizes = [];\n        basisFontSizes.push(((_d = optionsFinal.basis.a) === null || _d === void 0 ? void 0 : _d.size) === undefined ? optionsFinal.basis.size : optionsFinal.basis.a.size);\n        basisFontSizes.push(((_e = optionsFinal.basis.b) === null || _e === void 0 ? void 0 : _e.size) === undefined ? optionsFinal.basis.size : optionsFinal.basis.b.size);\n        basisFontSizes.push(((_f = optionsFinal.basis.c) === null || _f === void 0 ? void 0 : _f.size) === undefined ? optionsFinal.basis.size : optionsFinal.basis.c.size);\n        const cellBasisColors = [];\n        cellBasisColors.push(((_g = optionsFinal.basis.a) === null || _g === void 0 ? void 0 : _g.color) === undefined ? optionsFinal.basis.color : optionsFinal.basis.a.color);\n        cellBasisColors.push(((_h = optionsFinal.basis.b) === null || _h === void 0 ? void 0 : _h.color) === undefined ? optionsFinal.basis.color : optionsFinal.basis.b.color);\n        cellBasisColors.push(((_j = optionsFinal.basis.c) === null || _j === void 0 ? void 0 : _j.color) === undefined ? optionsFinal.basis.color : optionsFinal.basis.c.color);\n        const strokeColors = [];\n        strokeColors.push(((_l = (_k = optionsFinal.basis.a) === null || _k === void 0 ? void 0 : _k.stroke) === null || _l === void 0 ? void 0 : _l.color) === undefined ? optionsFinal.basis.stroke.color : optionsFinal.basis.a.stroke.color);\n        strokeColors.push(((_o = (_m = optionsFinal.basis.b) === null || _m === void 0 ? void 0 : _m.stroke) === null || _o === void 0 ? void 0 : _o.color) === undefined ? optionsFinal.basis.stroke.color : optionsFinal.basis.b.stroke.color);\n        strokeColors.push(((_q = (_p = optionsFinal.basis.c) === null || _p === void 0 ? void 0 : _p.stroke) === null || _q === void 0 ? void 0 : _q.color) === undefined ? optionsFinal.basis.stroke.color : optionsFinal.basis.c.stroke.color);\n        const strokeWidths = [];\n        strokeWidths.push(((_s = (_r = optionsFinal.basis.a) === null || _r === void 0 ? void 0 : _r.stroke) === null || _s === void 0 ? void 0 : _s.width) === undefined ? optionsFinal.basis.stroke.width : optionsFinal.basis.a.stroke.width);\n        strokeWidths.push(((_u = (_t = optionsFinal.basis.b) === null || _t === void 0 ? void 0 : _t.stroke) === null || _u === void 0 ? void 0 : _u.width) === undefined ? optionsFinal.basis.stroke.width : optionsFinal.basis.b.stroke.width);\n        strokeWidths.push(((_w = (_v = optionsFinal.basis.c) === null || _v === void 0 ? void 0 : _v.stroke) === null || _w === void 0 ? void 0 : _w.width) === undefined ? optionsFinal.basis.stroke.width : optionsFinal.basis.c.stroke.width);\n        for (let iBasis = 0; iBasis < 3; ++iBasis) {\n            const length = 0.7;\n            const basisVector = basis[iBasis];\n            const origin = new THREE.Vector3(0, 0, 0);\n            const dir = new THREE.Vector3()\n                .fromArray(basisVector)\n                .multiplyScalar(length);\n            // Add a dashed line\n            const lineVertices = [origin, dir];\n            const lineMaterial = new MeshLineMaterial({\n                color: \"#000\",\n                lineWidth: 0.00075,\n                sizeAttenuation: true,\n                dashArray: 0.05,\n                transparent: true,\n                depthTest: false,\n            });\n            const kpathLine = new MeshLine();\n            kpathLine.setPoints(lineVertices);\n            const line = new THREE.Mesh(kpathLine, lineMaterial);\n            this.info.add(line);\n            // Add an axis label\n            const textPos = new THREE.Vector3()\n                .copy(dir)\n                .multiplyScalar(1 + optionsFinal.basis.offset / dir.length());\n            const basisLabel = basisLabels[iBasis];\n            const basisColor = cellBasisColors[iBasis];\n            const basisFont = basisFonts[iBasis];\n            const basisFontSize = basisFontSizes[iBasis];\n            const strokeWidth = strokeWidths[iBasis];\n            const strokeColor = strokeColors[iBasis];\n            const basisSprite = this.createLabel(textPos, basisLabel, basisColor, basisFont, basisFontSize, new THREE.Vector2(0.0, 0.0), strokeWidth, strokeColor);\n            this.info.add(basisSprite);\n            // Add axis arrow\n            const arrowGeometry = new THREE.CylinderGeometry(0, 0.003, 0.012, 12);\n            const arrowMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 });\n            const arrow = new THREE.Mesh(arrowGeometry, arrowMaterial);\n            arrow.position.copy(dir);\n            arrow.lookAt(new THREE.Vector3());\n            arrow.rotateX(-Math.PI / 2);\n            this.info.add(arrow);\n        }\n        // Create the k-point path from the given segments. Currently assumes\n        // that the segments are linear and the segment path is determined by\n        // the start and end point.\n        const kpathMaterial = new MeshLineMaterial({\n            color: optionsFinal.segments.color,\n            lineWidth: optionsFinal.segments.linewidth,\n            sizeAttenuation: true,\n        });\n        //let kpathGeometry;\n        const labelPoints = [];\n        for (let iSegment = 0; iSegment < segments.length; ++iSegment) {\n            //kpathGeometry = new THREE.BufferGeometry();\n            const kpathVertices = [];\n            const segment = segments[iSegment];\n            for (const kpoint of segment) {\n                const kpointScaled = new THREE.Vector3().fromArray(kpoint);\n                const kpointCart = this.coordinateTransform(this.B, I, kpointScaled, false);\n                kpathVertices.push(kpointCart); // The point is pushed twice because it looks nicer that way for some reason...\n                kpathVertices.push(kpointCart);\n                labelPoints.push(kpointCart);\n            }\n            const kpathLine = new MeshLine();\n            kpathLine.setPoints(kpathVertices);\n            const kpath = new THREE.Mesh(kpathLine, kpathMaterial);\n            this.info.add(kpath);\n        }\n        // Create dummy geometry that is used to orient the view to show the\n        // segments nicely\n        this.labelPoints = new THREE.Object3D();\n        for (const point of labelPoints) {\n            const labelObject = new THREE.Object3D();\n            labelObject.position.copy(point);\n            this.labelPoints.add(labelObject);\n        }\n        this.info.add(this.labelPoints);\n        // Add k-point labels. Duplicate points are ignored.\n        if (kpoints) {\n            for (const kpoint of kpoints) {\n                const label = kpoint[0];\n                const kpointScaled = new THREE.Vector3().fromArray(kpoint[1]);\n                const kpointCartesian = this.coordinateTransform(this.B, I, kpointScaled, false);\n                if (optionsFinal.kpoints.point.enabled) {\n                    const kpointCircle = this.createCircle(kpointCartesian, optionsFinal.kpoints.point.size, optionsFinal.kpoints.point.color);\n                    this.info.add(kpointCircle);\n                }\n                if (optionsFinal.kpoints.label.enabled) {\n                    const kpointLabel = this.createLabel(kpointCartesian, label, optionsFinal.kpoints.label.color, optionsFinal.kpoints.label.font, optionsFinal.kpoints.label.size, new THREE.Vector2().fromArray(optionsFinal.kpoints.label.offset2D), optionsFinal.kpoints.label.stroke.width, optionsFinal.kpoints.label.stroke.width);\n                    this.info.add(kpointLabel);\n                }\n            }\n        }\n    }\n    /**\n     * Adjust the zoom so that the contents fit on the screen. Notice that is is\n     * typically useful to center around a point of interest first.\n     *\n     * @param {number}margin - Margin to apply.\n     */\n    fit(margin = 0) {\n        // The corners of the BZ will be used as visualization boundaries\n        const mesh = this.root.getObjectByName(\"group\").getObjectByName(\"outermesh\");\n        this.root.updateMatrixWorld(); // This update is required\n        const vertices = [];\n        const verticesArray = mesh.geometry.attributes.position.array;\n        const nVertices = verticesArray.length / 3;\n        for (let i = 0; i < nVertices; ++i) {\n            vertices.push(new THREE.Vector3().fromArray(verticesArray, i * 3));\n        }\n        // Transform positions to world coordinates\n        const worldPos = [];\n        for (let i = 0; i < nVertices; ++i) {\n            const pos = vertices[i];\n            worldPos.push(mesh.localToWorld(pos));\n        }\n        this.fitViewToPoints(worldPos, margin);\n    }\n    /**\n     * Used to rotate the contents based of the alignment of the basis cell\n     * vectors or the segments with respect to the cartesian axes.\n     *\n     * @param alignments List of up to two alignments for any two axis vectors.\n     * E.g. [[\"up\", \"c\"], [\"right\", \"segments\"]] will force the third basis\n     * vector to point exactly up, and the segments to as close to right as\n     * possible. The alignments are applied in the given order.\n     */\n    align(alignments) {\n        // Determine segment direction\n        const segmentVector = new THREE.Vector3();\n        const nPoints = this.labelPoints.children.length;\n        for (let i = 0; i < nPoints; ++i) {\n            const segmentPoint = this.labelPoints.children[i];\n            segmentVector.add(segmentPoint.getWorldPosition(new THREE.Vector3()));\n        }\n        // Define available directions\n        const directions = {\n            \"a\": this.basisVectors[0].clone(),\n            \"-a\": this.basisVectors[0].clone().negate(),\n            \"b\": this.basisVectors[1].clone(),\n            \"-b\": this.basisVectors[1].clone().negate(),\n            \"c\": this.basisVectors[2].clone(),\n            \"-c\": this.basisVectors[2].clone().negate(),\n            \"segments\": segmentVector,\n        };\n        // Align\n        super.alignView(alignments, directions);\n    }\n    createCircle(position, diameter, color) {\n        // Configure canvas\n        const canvas = document.createElement('canvas');\n        const size = 256;\n        canvas.width = size;\n        canvas.height = size;\n        const ctx = canvas.getContext('2d');\n        // Draw circle\n        ctx.beginPath();\n        ctx.arc(size / 2, size / 2, size / 2, 0, 2 * Math.PI);\n        ctx.fillStyle = color;\n        ctx.fill();\n        const texture = new THREE.Texture(canvas);\n        texture.needsUpdate = true;\n        const material = new THREE.SpriteMaterial({ map: texture });\n        const sprite = new THREE.Sprite(material);\n        sprite.scale.set(diameter, diameter, 1);\n        const labelRoot = new THREE.Object3D();\n        labelRoot.position.copy(position);\n        labelRoot.add(sprite);\n        return labelRoot;\n    }\n}\n","import * as THREE from \"three\";\nimport { ConvexHull } from './convexhull';\n/**\n * Customized version of the three.js ConvexBufferGeometry that additionally\n * identifies and stores the face edges.\n */\nconst getConvexGeometry = function (points) {\n    const bufferGeometry = new THREE.BufferGeometry();\n    // Calculate convex hull from given points\n    const convexHull = new ConvexHull().setFromPoints(points);\n    // Generate vertices and normals\n    const vertices = [];\n    const normals = [];\n    const faces = convexHull.faces;\n    for (let i = 0; i < faces.length; i++) {\n        const face = faces[i];\n        let edge = face.edge;\n        // we move along a doubly-connected edge list to access all face points (see HalfEdge docs)\n        do {\n            const point = edge.head().point;\n            vertices.push(point.x, point.y, point.z);\n            normals.push(face.normal.x, face.normal.y, face.normal.z);\n            edge = edge.next;\n        } while (edge !== face.edge);\n    }\n    bufferGeometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));\n    bufferGeometry.setAttribute('normal', new THREE.Float32BufferAttribute(normals, 3));\n    // Identify the edges: loop through the triangle edges, add points that are\n    // on the edge by checking if the 'twin' edge is coplanar.\n    const faceEdges = [];\n    const faceIndices = new Set(faces);\n    for (let currentTriangle of faceIndices) {\n        const faceEdge = [];\n        const startEdge = currentTriangle[\"edge\"];\n        let currentEdge = currentTriangle[\"edge\"];\n        faceEdge.push(startEdge.tail().point);\n        do {\n            const currentNormal = currentTriangle[\"normal\"];\n            const neighbour = currentEdge.twin.face;\n            const neighbourNormal = neighbour.normal;\n            const coplanar = Math.abs(currentNormal.dot(neighbourNormal) - 1) <= 1E-8;\n            if (coplanar) {\n                currentTriangle = neighbour;\n                currentEdge = currentEdge.twin.next;\n            }\n            else {\n                faceEdge.push(currentEdge.head().point);\n                currentEdge = currentEdge.next;\n            }\n            faceIndices.delete(currentTriangle);\n        } while (currentEdge !== startEdge);\n        faceEdges.push(faceEdge);\n    }\n    return { geometry: bufferGeometry, faces: faceEdges };\n};\nexport { getConvexGeometry };\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { Button } from '@material-ui/core'\n\n/**\n * Button that has a loading status and cannot be used while loading.\n */\nexport default function LoadingButton({loading, children, ...buttonProps}) {\n  buttonProps.disabled = buttonProps.disabled || loading\n  return <Button {...buttonProps}>\n    {children}\n  </Button>\n}\n\nLoadingButton.propTypes = {\n  loading: PropTypes.bool,\n  children: PropTypes.node\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nt* See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useState, useCallback } from 'react'\nimport PropTypes from 'prop-types'\nimport {\n  Menu,\n  MenuItem,\n  FormControl,\n  FormLabel,\n  FormControlLabel,\n  IconButton,\n  TextField,\n  Typography,\n  DialogActions,\n  Box,\n  Tooltip,\n  Radio,\n  RadioGroup\n} from '@material-ui/core'\nimport LoadingButton from './LoadingButton'\nimport { download } from '../../utils'\nimport { useErrors } from '../errors'\nimport { useApi } from '../api'\n\n// TODO: The available options could be passed down to the GUI via pydantic\n// model serialization.\nconst formats = {\n  cif: {\n    label: 'CIF'\n  },\n  xyz: {\n    label: 'XYZ'\n  },\n  pdb: {\n    label: 'PDB'\n  }\n}\nexport const wrapModes = {\n  original: {\n    key: 'original',\n    label: 'Original',\n    description: 'Original positions'\n  },\n  wrap: {\n    key: 'wrap',\n    label: 'Wrap',\n    description: 'Positions are wrapped to be inside the cell respecting periodic boundary conditions'\n  },\n  unwrap: {\n    key: 'unwrap',\n    label: 'Unwrap',\n    description: `Positions are reconstructed so that the structure is not split\n    by periodic cell boundaries. Note that this produces meaningful results only\n    if the system dimensions are smaller than the unit cell.`\n  }\n}\n\nexport const WrapModeRadio = ({value, onChange, disabled, className}) => {\n  return <FormControl key='wrap' component=\"fieldset\" className={className}>\n    <FormLabel component=\"legend\">Wrap mode</FormLabel>\n    <RadioGroup\n      value={value}\n      onChange={onChange}\n      >\n      {Object.entries(wrapModes).map(([key, data]) =>\n        <FormControlLabel\n          key={key}\n          value={key}\n          control={<Radio color=\"primary\" disabled={disabled}/>}\n          label={<Tooltip\n            title={wrapModes[key].description}>\n              <span>{data.label}</span>\n          </Tooltip>}\n        />\n      )}\n    </RadioGroup>\n  </FormControl>\n}\n\nWrapModeRadio.propTypes = {\n  value: PropTypes.string,\n  onChange: PropTypes.func,\n  disabled: PropTypes.bool,\n  className: PropTypes.string\n}\n\n/*\n * Menu for downloading a specific system.\n */\nexport const DownloadSystemMenu = React.memo(React.forwardRef(({entryId, path, anchorEl, onClose, ...rest}, ref) => {\n  const {api} = useApi()\n  const {raiseError} = useErrors()\n  const [format, setFormat] = useState('cif')\n  const [wrapMode, setWrapMode] = useState('original')\n  const [loading, setLoading] = useState(false)\n  const open = Boolean(anchorEl)\n\n  const handleChangeFormat = useCallback((event) => {\n    setFormat(event.target.value)\n  }, [])\n\n  const handleChangeWrapMode = useCallback((event) => {\n    setWrapMode(event.target.value)\n  }, [])\n\n  const handleClickDownload = useCallback(() => {\n    setLoading(true)\n    api.get(\n      `systems/${entryId}?path=${path}&format=${format}&wrap_mode=${wrapMode}`,\n      undefined,\n      {responseType: 'blob', fullResponse: true}\n    )\n      .then((response) => {\n        const contentDisposition = response.headers['content-disposition']\n        const fileName = contentDisposition?.split('\"')[1] || `system.${format}`\n        download(fileName, response.data)\n      })\n      .finally(() => setLoading(false))\n      .catch(raiseError)\n  }, [entryId, path, format, wrapMode, api, raiseError])\n\n  return <Menu\n      anchorEl={anchorEl}\n      getContentAnchorEl={null}\n      anchorOrigin={{ vertical: 'bottom', horizontal: 'right' }}\n      transformOrigin={{ vertical: 'top', horizontal: 'right' }}\n      keepMounted\n      open={open}\n      onClose={onClose}\n    >\n      <Box minWidth=\"13rem\" paddingLeft={2} paddingRight={2} paddingTop={1}>\n        <Typography variant='h6' fontSize='0.9rem'>\n          Download system\n        </Typography>\n        <Box mt={1} />\n        <TextField select value={format} onChange={handleChangeFormat} size='small' variant=\"filled\" label=\"Format\" fullWidth>\n          {Object.entries(formats).map(([key, value]) => {\n            return <MenuItem key={key} value={key}>{value.label}</MenuItem>\n          })}\n        </TextField>\n        <Box mt={2} />\n        <WrapModeRadio value={wrapMode} onChange={handleChangeWrapMode} />\n        <Box marginRight={-1} marginBottom={-1}>\n          <DialogActions>\n            <LoadingButton onClick={handleClickDownload} color=\"primary\" loading={loading}>\n              Download\n            </LoadingButton>\n          </DialogActions>\n        </Box>\n      </Box>\n    </Menu>\n}))\n\nDownloadSystemMenu.propTypes = {\n  entryId: PropTypes.string,\n  path: PropTypes.string,\n  anchorEl: PropTypes.object,\n  onClose: PropTypes.func\n}\n\n/*\n * Button for downloading a specific system.\n */\nexport const DownloadSystemButton = React.memo(React.forwardRef(({entryId, path, ...rest}, ref) => {\n  const [anchorEl, setAnchorEl] = useState(null)\n  const openMenu = useCallback((event) => {\n    setAnchorEl(event.currentTarget)\n  }, [])\n  return <>\n    <IconButton size=\"small\" onClick={openMenu} {...rest} ref={ref}/>\n    <DownloadSystemMenu entryId={entryId} path={path} anchorEl={anchorEl} onClose={() => setAnchorEl(null)}/>\n  </>\n}))\n\nDownloadSystemButton.propTypes = {\n  entryId: PropTypes.string,\n  path: PropTypes.string,\n  onClose: PropTypes.func\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useEffect, useCallback, useMemo, useRef } from 'react'\nimport { useResizeDetector } from 'react-resize-detector'\nimport { makeStyles } from '@material-ui/core/styles'\nimport {\n  Button,\n  Dialog,\n  DialogContent,\n  DialogActions,\n  Box,\n  Paper,\n  Backdrop\n} from '@material-ui/core'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\nimport { isNil } from 'lodash'\nimport { useWindowSize } from '../../hooks'\n\n/**\n * Component that wraps it's children in a container that can be 'floated',\n * i.e. displayed on an html element that is positioned relative to the\n * viewport and is above all other elements.\n */\nconst useStyles = makeStyles((theme) => {\n  const actionsHeight = 52.5 // Size of the actions element that is shown when floating\n  const padding = 20 // Padding arount the floating object\n  return {\n    root: {\n      width: '100%',\n      height: '100%'\n    },\n    dialogContent: {\n      boxSizing: 'border-box',\n      padding: padding\n    },\n    'dialogContent:first-child': {\n      paddingTop: `${padding} !important`\n    },\n    dialogActions: {\n      height: actionsHeight,\n      boxSizing: 'border-box'\n    }\n  }\n})\nexport default function Floatable({\n  className,\n  classes,\n  style,\n  float,\n  children,\n  onFloat,\n  onResize\n}) {\n  // The ratio is calculated dynamically from the final size\n  const { height, width, ref } = useResizeDetector()\n  const dim = useRef({width: 800, height: 600})\n\n  // When the figure is floated, fix the width/height.\n  useEffect(() => {\n    if (!float) {\n      dim.current = {\n        width: width,\n        height: height\n      }\n    }\n    if (onResize && !isNil(width) && !isNil(height)) {\n      onResize(width, height)\n    }\n  }, [float, width, height, onResize])\n\n  // Dynamic styles\n  const useDynamicStyles = makeStyles((theme) => {\n    // Calculate the fullscreen size\n    const actionsHeight = 52.5 // Size of the actions element that is shown when floating\n    const padding = 20 // Padding arount the floating object\n    const maxWidth = 1280 // Maximum width for the floating window\n    const margin = 0.1 * (window.innerHeight) + actionsHeight\n    const windowHeight = window.innerHeight - margin\n    const windowWidth = Math.min(window.innerWidth, maxWidth) - margin\n    const windowRatio = windowWidth / windowHeight\n    const ratio = dim.current.width / dim.current.height\n    let width\n    let height\n    if (windowRatio > ratio) {\n      width = (windowHeight) * ratio + 2 * padding + 'px'\n      height = windowHeight + actionsHeight + 2 * padding\n    } else {\n      width = windowWidth + 2 * padding\n      height = (windowWidth) / ratio + actionsHeight + 2 * padding + 'px'\n    }\n\n    return {\n      dialogRoot: {\n        width: width,\n        height: height,\n        margin: 0,\n        padding: 0,\n        maxWidth: 'none',\n        maxHeight: 'none',\n        boxSizing: 'border-box'\n      }\n    }\n  })\n  const styles = useStyles({classes: classes})\n  const dynamicStyles = useDynamicStyles({classes: classes})\n\n  return <div ref={ref} className={clsx(styles.root, className)} style={style}>\n    {float\n      ? <div style={{width: dim.current.width, height: dim.current.height}} />\n      : children\n    }\n    <Dialog fullWidth={false} maxWidth={false} open={float}\n      classes={{paper: dynamicStyles.dialogRoot}}\n    >\n      <DialogContent className={[styles.dialogContent, styles['dialogContent:first-child']].join('_')}>\n        {float ? children : ''}\n      </DialogContent>\n      <DialogActions className={styles.dialogActions}>\n        <Button onClick={() => onFloat(float)}>\n          Close\n        </Button>\n      </DialogActions>\n    </Dialog>\n  </div>\n}\n\nFloatable.propTypes = {\n  /**\n   * Whether this component should be in floating mode or not.\n   */\n  float: PropTypes.bool.isRequired,\n  /**\n   * Callback that is called whenever this component requests a change in the\n   * float property. The callback accepts one parameter: 'float' that is a\n   * boolean indicating the current float status.\n   */\n  onFloat: PropTypes.func,\n  onResize: PropTypes.func,\n  children: PropTypes.node,\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  style: PropTypes.object\n}\nFloatable.defaultProps = {\n  float: false\n}\n\n/**\n * Component that wraps it's children in a container that can be 'floated', i.e.\n * is positioned relative to the viewport and is above all other elements.\n */\nconst actionsHeight = 52.5 // Size of the actions element that is shown when floating\nconst useNoReparentStyles = makeStyles((theme) => {\n  return {\n    root: {\n      top: '50%',\n      left: '50%',\n      margin: 0,\n      padding: 0,\n      maxWidth: 'none',\n      maxHeight: 'none',\n      boxSizing: 'border-box'\n    },\n    paper: {\n      display: 'flex',\n      flexDirection: 'column',\n      width: '100%',\n      height: '100%',\n      boxSizing: 'border-box'\n    },\n    full: {\n      width: '100%',\n      height: '100%',\n      boxSizing: 'border-box'\n    },\n    dialogActions: {\n      height: actionsHeight,\n      boxSizing: 'border-box'\n    }\n  }\n})\nexport const FloatableNoReparent = React.memo(({\n  className,\n  float,\n  children,\n  onFloat,\n  onResize,\n  maxWidth,\n  margin\n}) => {\n  // The ratio is calculated dynamically from the final size\n  const styles = useNoReparentStyles()\n  const { height, width, ref } = useResizeDetector()\n  const dim = useRef({width: 800, height: 600})\n  const windowSize = useWindowSize()\n\n  // This fixes the aspect ratio of the component based on the non-floating\n  // size.\n  useEffect(() => {\n    if (!float) {\n      dim.current = {\n        width: width,\n        height: height\n      }\n    }\n    if (onResize && !isNil(width) && !isNil(height)) {\n      onResize(width, height)\n    }\n  }, [float, width, height, onResize])\n\n  const handleFloat = useCallback(() => {\n    onFloat && onFloat()\n  }, [onFloat])\n\n  // Calculate the final floated size\n  const size = useMemo(() => {\n    // Calculate the fullscreen size\n    const marginAbsolute = margin * (windowSize.windowHeight)\n    const windowHeight = windowSize.windowHeight - marginAbsolute\n    const windowWidth = Math.min(windowSize.windowWidth, maxWidth) - marginAbsolute\n    const windowRatio = windowWidth / windowHeight\n    const ratio = dim.current.width / dim.current.height\n    let width\n    let height\n    if (windowRatio > ratio) {\n      width = (windowHeight) * ratio\n      height = windowHeight + actionsHeight\n    } else {\n      width = windowWidth\n      height = (windowWidth) / ratio + actionsHeight\n    }\n    return {width, height}\n  }, [windowSize, maxWidth, margin])\n\n  return <div\n    ref={ref}\n    className={clsx(styles.root, className)}\n    style={{\n      position: float ? 'fixed' : 'static',\n      zIndex: float ? 10000 : 1,\n      width: float ? size.width : '100%',\n      height: float ? size.height : '100%',\n      marginTop: float ? -0.5 * size.height : 'unset',\n      marginLeft: float ? -0.5 * size.width : 'unset'\n    }}\n  >\n    <Paper elevation={float ? 1 : 0} className={styles.paper}>\n      <Box padding={float ? 3 : 0} paddingBottom={float ? 1 : 0} className={styles.full}>\n        <div></div>\n        {children}\n      </Box>\n      {float &&\n        <DialogActions className={styles.dialogActions}>\n          <Button onClick={handleFloat}>\n            Close\n          </Button>\n        </DialogActions>\n      }\n    </Paper>\n    <Backdrop className={styles.backdrop} open={float} onClick={handleFloat} />\n  </div>\n})\n\nFloatableNoReparent.propTypes = {\n  float: PropTypes.bool,\n  onFloat: PropTypes.func,\n  onResize: PropTypes.func,\n  children: PropTypes.node,\n  className: PropTypes.string,\n  maxWidth: PropTypes.number,\n  margin: PropTypes.number\n}\n\nFloatableNoReparent.defaultProps = {\n  float: false,\n  maxWidth: 1920,\n  margin: 0.1\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nt* See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useCallback, useMemo } from 'react'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { useHistory } from 'react-router-dom'\nimport {\n  Checkbox,\n  Button,\n  Menu,\n  MenuItem,\n  Typography,\n  FormControlLabel\n} from '@material-ui/core'\nimport { Alert } from '@material-ui/lab'\nimport {\n  MoreVert,\n  Fullscreen,\n  FullscreenExit,\n  CameraAlt,\n  Replay,\n  ViewList,\n  GetApp\n} from '@material-ui/icons'\nimport { DownloadSystemMenu, WrapModeRadio } from '../buttons/DownloadSystemButton'\nimport Floatable from './Floatable'\nimport NoData from './NoData'\nimport Placeholder from './Placeholder'\nimport { Actions, Action } from '../Actions'\nimport { withErrorHandler, withWebGLErrorHandler } from '../ErrorHandler'\nimport { isNil } from 'lodash'\nimport { Quantity } from '../units/Quantity'\n\n/**\n * Used to control a 3D system visualization that is implemented in the\n * 'children' prop. This allows for an easier change of visualization\n * implementation without changing the control layout.\n */\nconst useStyles = makeStyles((theme) => {\n  return {\n    root: {},\n    container: {\n      position: 'relative',\n      width: '100%',\n      height: '100%'\n    },\n    content: {\n      position: 'absolute',\n      left: 0,\n      right: 0,\n      top: 0,\n      bottom: 0,\n      display: 'flex',\n      flexDirection: 'column'\n    },\n    header: {\n      display: 'flex',\n      flexDirection: 'row',\n      zIndex: 1\n    },\n    legend: {\n      zIndex: 10,\n      position: 'absolute',\n      left: 0,\n      top: 0,\n      bottom: 0\n    },\n    title: {\n      marginBottom: theme.spacing(1)\n    },\n    menuItem: {\n      margin: theme.spacing(2),\n      marginTop: theme.spacing(1),\n      marginBottom: theme.spacing(1)\n    },\n    canvas: {\n      position: 'relative',\n      flex: 1,\n      zIndex: 0,\n      minHeight: 0, // added min-height: 0 to allow the item to shrink to fit inside the container.\n      marginBottom: theme.spacing(1)\n    }\n  }\n})\nconst StructureBase = React.memo(({\n  wrapMode,\n  onWrapModeChange,\n  disableWrapMode,\n  showLatticeConstants,\n  onShowLatticeConstants,\n  disableShowLatticeConstants,\n  showBonds,\n  onShowBonds,\n  disableShowBonds,\n  showCell,\n  onShowCell,\n  disableShowCell,\n  onAccept,\n  onReset,\n  onTakeScreenshot,\n  onFullscreen,\n  float,\n  species,\n  loading,\n  prompt,\n  noData,\n  className,\n  classes,\n  captureName,\n  disableLegend,\n  disableFileDownload,\n  entryId,\n  path,\n  m_path,\n  'data-testid': testID,\n  children}\n) => {\n  const [anchorEl, setAnchorEl] = React.useState(null)\n  const [systemAnchorEl, setSystemAnchorEl] = React.useState(null)\n  const history = useHistory()\n  const open = Boolean(anchorEl)\n  const styles = useStyles(classes)\n  const downloadDisabled = isNil(entryId) || isNil(path) || disableFileDownload\n\n  const setShowBonds = useCallback((value, render = false) => {\n    onShowBonds && onShowBonds(value, render)\n  }, [onShowBonds])\n\n  const handleWrapModeChange = useCallback((value, showBonds, render = false) => {\n    onWrapModeChange && onWrapModeChange(value, showBonds, render)\n  }, [onWrapModeChange])\n\n  const handleShowLatticeConstants = useCallback((value, render = false) => {\n    onShowLatticeConstants && onShowLatticeConstants(value, render)\n  }, [onShowLatticeConstants])\n\n  const setShowCell = useCallback((value, render = false) => {\n    onShowCell && onShowCell(value, render)\n  }, [onShowCell])\n\n  const handleFullscreen = useCallback(() => {\n    onFullscreen && onFullscreen()\n  }, [onFullscreen])\n\n  const handleReset = useCallback(() => {\n    onReset && onReset()\n  }, [onReset])\n\n  const openMenu = useCallback((event) => {\n    setAnchorEl(event.currentTarget)\n  }, [])\n\n  const openSystemMenu = useCallback((event) => {\n    setSystemAnchorEl(event.currentTarget)\n  }, [])\n\n  const closeMenu = useCallback(() => {\n    setAnchorEl(null)\n  }, [])\n\n  const takeScreencapture = useCallback(() => {\n    onTakeScreenshot && onTakeScreenshot(captureName)\n  }, [onTakeScreenshot, captureName])\n\n  // Decides the possible overlay to display\n  const overlay = useMemo(() => {\n    if (prompt) {\n      return <Alert\n        severity=\"info\"\n        action={\n          <Button color=\"inherit\" size=\"small\" onClick={() => onAccept()}>\n              YES\n          </Button>\n        }\n      >\n        {prompt}\n      </Alert>\n    } else if (loading) {\n      return <Placeholder margin={0}/>\n    } else if (noData) {\n      return <NoData margin={0}/>\n    }\n  }, [loading, prompt, noData, onAccept])\n\n  return <Floatable\n    data-testid={testID}\n    className={clsx(styles.root, className)}\n    float={float}\n  >\n    <div className={styles.container}>\n      <div className={styles.content}>\n        {overlay}\n      </div>\n      {/* This contains the actual visualization. Needs to be always in the DOM so we can\n      load the structure into it properly. */}\n      <div\n        className={styles.content}\n        style={{visibility: overlay ? 'hidden' : 'visible'}}\n      >\n        {float && <Typography className={styles.title} variant=\"h6\">Structure</Typography>}\n        <div className={styles.canvas}>\n          {children}\n          {!disableLegend &&\n            <Species species={species} className={styles.legend}/>\n          }\n        </div>\n        <div className={styles.header}>\n          <Actions>\n            <Action tooltip='Reset view' onClick={handleReset}>\n              <Replay/>\n            </Action>\n            <Action tooltip='Toggle fullscreen' onClick={handleFullscreen}>\n              {float ? <FullscreenExit/> : <Fullscreen/>}\n            </Action>\n            <Action\n              tooltip={downloadDisabled\n                ? 'File download not available for this system'\n                : 'Download system geometry as a file'\n              }\n              onClick={openSystemMenu}\n              disabled={downloadDisabled}\n            >\n              <GetApp/>\n            </Action>\n            <Action tooltip='Capture image' onClick={takeScreencapture}>\n              <CameraAlt/>\n            </Action>\n            {m_path &&\n              <Action tooltip='View data in the archive' onClick={() => { history.push(m_path) }}>\n                <ViewList/>\n              </Action>\n            }\n            <Action tooltip='Options' onClick={openMenu}>\n              <MoreVert/>\n            </Action>\n          </Actions>\n          <DownloadSystemMenu\n            entryId={entryId}\n            path={path}\n            anchorEl={systemAnchorEl}\n            onClose={() => setSystemAnchorEl(null)}\n          />\n          <Menu\n            id='settings-menu'\n            anchorEl={anchorEl}\n            getContentAnchorEl={null}\n            anchorOrigin={{ vertical: 'bottom', horizontal: 'right' }}\n            transformOrigin={{ vertical: 'top', horizontal: 'right' }}\n            keepMounted\n            open={open}\n            onClose={closeMenu}\n          >\n            <MenuItem key='show-bonds'>\n              <FormControlLabel\n                control={\n                  <Checkbox\n                    checked={showBonds}\n                    disabled={disableShowBonds}\n                    onChange={(event) => { setShowBonds(!showBonds, true) }}\n                    color='primary'\n                  />\n                }\n                label='Show bonds'\n              />\n            </MenuItem>\n            <MenuItem key='show-axis'>\n              <FormControlLabel\n                control={\n                  <Checkbox\n                    checked={showLatticeConstants}\n                    disabled={disableShowLatticeConstants}\n                    onChange={(event) => { handleShowLatticeConstants(!showLatticeConstants, true) }}\n                    color='primary'\n                  />\n                }\n                label='Show lattice constants'\n              />\n            </MenuItem>\n            <MenuItem key='show-cell'>\n              <FormControlLabel\n                control={\n                  <Checkbox\n                    checked={showCell}\n                    disabled={disableShowCell}\n                    onChange={(event) => { setShowCell(!showCell, true) }}\n                    color='primary'\n                  />\n                }\n                label='Show simulation cell'\n              />\n            </MenuItem>\n            <WrapModeRadio value={wrapMode} onChange={handleWrapModeChange} disabled={disableWrapMode} className={styles.menuItem}/>\n          </Menu>\n        </div>\n      </div>\n    </div>\n  </Floatable>\n})\n\nStructureBase.propTypes = {\n  wrapMode: PropTypes.bool,\n  onWrapModeChange: PropTypes.func,\n  disableWrapMode: PropTypes.bool,\n  showLatticeConstants: PropTypes.bool,\n  onShowLatticeConstants: PropTypes.func,\n  disableShowLatticeConstants: PropTypes.bool,\n  showBonds: PropTypes.bool,\n  onShowBonds: PropTypes.func,\n  disableShowBonds: PropTypes.bool,\n  showCell: PropTypes.bool,\n  onShowCell: PropTypes.func,\n  disableShowCell: PropTypes.bool,\n  prompt: PropTypes.string, // Prompt shown before showing the visualization\n  onAccept: PropTypes.func, // Callback for answering yes to the prompt\n  onReset: PropTypes.func,\n  onTakeScreenshot: PropTypes.func,\n  onFullscreen: PropTypes.func,\n  species: PropTypes.array,\n  loading: PropTypes.bool,\n  float: PropTypes.bool,\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  noData: PropTypes.bool,\n  canvasID: PropTypes.string,\n  disableFileDownload: PropTypes.bool, // Used to disable the file download button\n  entryId: PropTypes.string,\n  path: PropTypes.string,\n  m_path: PropTypes.string, // Path of the structure data in the metainfo\n  captureName: PropTypes.string, // Name of the file that the user can download\n  disableLegend: PropTypes.bool, // Disable the legend showing the species list\n  'data-testid': PropTypes.string,\n  children: PropTypes.node\n}\nStructureBase.defaultProps = {\n  captureName: 'system'\n}\n\nexport default withWebGLErrorHandler(withErrorHandler('Could not load structure.')(StructureBase))\n\nfunction getRadius(radius) {\n  return `${Math.sqrt(radius) * 12}px`\n}\n\n/**\n * Shows a list of atomic species.\n */\nconst useSpeciesStyles = makeStyles((theme) => {\n  return {\n    root: {\n      padding: theme.spacing(0.5),\n      overflowY: 'auto',\n      overflowX: 'hidden',\n      direction: 'rtl'\n    },\n    grid: {\n      display: 'grid',\n      gridTemplateColumns: 'min-content auto',\n      gridGap: `${theme.spacing(0.1)}px ${theme.spacing(0.5)}px`,\n      direction: 'ltr'\n    },\n    label: {\n      justifySelf: 'start',\n      alignSelf: 'center',\n      textShadow: '0px 0px 5px #ffffff'\n    },\n    circle: {\n      borderRadius: '100%',\n      border: '1px solid #555',\n      justifySelf: 'center',\n      alignSelf: 'center'\n    }\n  }\n})\nexport const Species = React.memo(({species, className}) => {\n  const styles = useSpeciesStyles()\n  const normalized = useMemo(() => {\n    let normalized\n    try {\n      normalized = species\n        .map(x => ({...x, radius: (x.radius)}))\n        .sort((a, b) => (a.atomicNumber - b.atomicNumber))\n    } catch {}\n    return normalized\n  }, [species])\n\n  return normalized\n    ? <div className={clsx(styles.root, className)}>\n      <div className={styles.grid}>\n        {species && normalized.map(item => {\n          const radius = getRadius(item.radius)\n          return <React.Fragment key={item.label}>\n            <div\n              className={styles.circle}\n              style={{\n                backgroundColor: item.color,\n                height: radius,\n                width: radius\n              }}\n            />\n            <Typography className={styles.label}>{item.label}</Typography>\n          </React.Fragment>\n        })}\n      </div>\n    </div>\n    : null\n})\n\nSpecies.propTypes = {\n  species: PropTypes.arrayOf(PropTypes.shape({\n    label: PropTypes.string.isRequired, // The label to show\n    radius: PropTypes.number.isRequired, // Radius in ngstrom\n    color: PropTypes.string.isRequired, // CSS color\n    atomicNumber: PropTypes.number.isRequired // Atomic number for sorting\n  })),\n  className: PropTypes.string,\n  'data-testid': PropTypes.string\n}\n\n/**\n * Converts the given structure in the format used by 'results' into the format\n * used by the materia-library.\n *\n * @param {object} structure.\n *\n * @return {undefined|object} If the given structure cannot be converted,\n * returns an empty object.\n */\nexport function toMateriaStructure(structure) {\n  if (!structure) {\n    return undefined\n  }\n\n  try {\n    // Resolve atomic species using the labels and their mapping to chemical\n    // elements.\n    const speciesMap = new Map(structure.species.map(s => [s.name, s.chemical_symbols[0]]))\n\n    const structMateria = {\n      species: structure.species_at_sites.map(x => speciesMap.get(x)),\n      cell: structure.lattice_vectors\n        ? new Quantity(structure.lattice_vectors, 'meter').to('angstrom').value()\n        : undefined,\n      positions: new Quantity(structure.cartesian_site_positions, 'meter').to('angstrom').value(),\n      fractional: false,\n      pbc: structure.dimension_types ? structure.dimension_types.map((x) => !!x) : undefined\n    }\n    return structMateria\n  } catch (error) {\n    return {}\n  }\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useState, useMemo, useEffect, useRef, useCallback } from 'react'\nimport PropTypes from 'prop-types'\nimport { makeStyles, alpha } from '@material-ui/core/styles'\nimport {\n  Checkbox,\n  Button,\n  Menu,\n  MenuItem,\n  Typography,\n  FormControlLabel\n} from '@material-ui/core'\nimport { Alert } from '@material-ui/lab'\nimport {\n  MoreVert,\n  Fullscreen,\n  FullscreenExit,\n  CameraAlt,\n  Replay,\n  ViewList\n} from '@material-ui/icons'\nimport { StructureViewer } from '@lauri-codes/materia'\nimport { Species } from './StructureBase'\nimport Floatable from './Floatable'\nimport NoData from './NoData'\nimport Placeholder from '../visualization/Placeholder'\nimport { Actions, Action } from '../Actions'\nimport { withErrorHandler, withWebGLErrorHandler } from '../ErrorHandler'\nimport { useHistory } from 'react-router-dom'\nimport { isEmpty, flattenDeep } from 'lodash'\nimport { Quantity } from '../units/Quantity'\nimport { delay } from '../../utils'\nimport { useAsyncError } from '../../hooks'\nimport clsx from 'clsx'\n\n/**\n * Used to show atomistic systems in an interactive 3D viewer based on the\n * 'materia'-library.\n */\nconst fitMargin = 0.5\nconst useStyles = makeStyles((theme) => {\n  return {\n    root: {},\n    container: {\n      position: 'relative',\n      width: '100%',\n      height: '100%'\n    },\n    content: {\n      position: 'absolute',\n      left: 0,\n      right: 0,\n      top: 0,\n      bottom: 0,\n      display: 'flex',\n      flexDirection: 'column'\n    },\n    header: {\n      display: 'flex',\n      flexDirection: 'row',\n      zIndex: 1\n    },\n    legend: {\n      zIndex: 10,\n      position: 'absolute',\n      left: 0,\n      top: 0,\n      bottom: 0\n    },\n    selected: {\n      '&$selected': {\n        color: alpha(theme.palette.action.active, 0.87)\n      }\n    },\n    title: {\n      marginBottom: theme.spacing(1)\n    },\n    canvas: {\n      position: 'relative',\n      flex: 1,\n      zIndex: 0,\n      minHeight: 0, // added min-height: 0 to allow the item to shrink to fit inside the container.\n      marginBottom: theme.spacing(1)\n    }\n  }\n})\nconst Structure = React.memo(({\n  className,\n  classes,\n  data,\n  structuralType,\n  cellType,\n  m_path,\n  captureName,\n  sizeLimit,\n  bondLimit,\n  disableLegend,\n  selection,\n  'data-testid': testID\n}) => {\n  // States\n  const [anchorEl, setAnchorEl] = React.useState(null)\n  const [fullscreen, setFullscreen] = useState(false)\n  const [showLatticeConstants, setShowLatticeConstantsState] = useState(true)\n  const [showCell, setShowCellState] = useState(true)\n  const [center, setCenter] = useState('COP')\n  const [fit, setFit] = useState('full')\n  const [wrap, setWrapState] = useState(true)\n  const [showPrompt, setShowPrompt] = useState(false)\n  const [accepted, setAccepted] = useState(false)\n  const [showBonds, setShowBondsState] = useState(true)\n  const [species, setSpecies] = useState()\n  const [loading, setLoading] = useState(true)\n  const [ready, setReady] = useState(false)\n  const throwError = useAsyncError()\n  const noData = data === false\n\n  const setShowBonds = useCallback((value, render = false) => {\n    setShowBondsState(value)\n    if (refViewer?.current) {\n      try {\n        refViewer.current.bonds({enabled: value})\n        if (render) refViewer.current.render()\n      } catch (e) {\n      }\n    }\n  }, [])\n\n  const setWrap = useCallback((value, showBonds, render = false) => {\n    setWrapState(value)\n    if (refViewer?.current) {\n      try {\n          refViewer.current.wrap(value)\n          refViewer.current.bonds({enabled: showBonds})\n        if (render) refViewer.current.render()\n      } catch (e) {\n      }\n    }\n  }, [])\n\n  const setShowLatticeConstants = useCallback((value, render = false) => {\n    setShowLatticeConstantsState(value)\n    if (refViewer?.current) {\n      try {\n          refViewer.current.latticeConstants({enabled: value})\n        if (render) refViewer.current.render()\n      } catch (e) {\n      }\n    }\n  }, [])\n\n  const setShowCell = useCallback((value, render = false) => {\n    setShowCellState(value)\n    if (refViewer?.current) {\n      try {\n          refViewer.current.cell({enabled: value})\n        if (render) refViewer.current.render()\n      } catch (e) {\n      }\n    }\n  }, [])\n\n  // Variables\n  const history = useHistory()\n  const open = Boolean(anchorEl)\n  const readyRef = useRef(true)\n  const refViewer = useRef(null)\n  const refCanvasDiv = useRef(null)\n  const styles = useStyles(classes)\n  const hasSelection = !isEmpty(selection?.selection)\n  const nAtoms = useMemo(() => data?.positions?.length, [data])\n  const hasCell = useMemo(() => {\n    const hasCell = !data?.cell\n      ? false\n      : !flattenDeep(data.cell).every(v => v === 0)\n    // If there is no valid cell, the property is set as undefined\n    if (!hasCell && data) {\n      data.cell = undefined\n    }\n    return hasCell\n  }, [data])\n\n  // In order to properly detect changes in a reference, a reference callback is\n  // used. This is the recommended way to monitor reference changes as a simple\n  // useRef is not guaranteed to update:\n  // https://reactjs.org/docs/hooks-faq.html#how-can-i-measure-a-dom-node\n  const refCanvas = useCallback(node => {\n    // Dependency on 'fit' will make this function run every time it changes\n    // (useCallback should not really run the function when the dependency\n    // changes, but something weird is going on here.). An extra check is made\n    // to check for node change before setting up the canvas to the new div.\n    if (node !== null && refViewer.current !== null && node !== refCanvasDiv.current) {\n      refViewer.current.changeHostElement(node, true)\n      refViewer.current.fit(fit, fitMargin)\n      refViewer.current.render()\n    }\n    refCanvasDiv.current = node\n  }, [fit])\n\n  /**\n   * Used to asynchronously load a new viewer and system. Since loading the\n   * structure is a long-taking operation, running this function later in the\n   * event queue allows the component to perform state updates (e.g. loading\n   * placeholder) while the viewer is loading.\n   */\n  const loadSystem = useCallback(async (system, refViewer) => {\n    await delay(() => {\n      // Initialize the viewer. A new viewer is used for each system as the\n      // render settings may differ.\n      const nAtoms = system?.positions?.length\n      const isHighQuality = nAtoms <= 3000\n      const options = {\n        renderer: {\n          backgroundColor: ['#ffffff', 1],\n          antialias: {enabled: isHighQuality},\n          pixelRatioScale: 1,\n          shadows: {enabled: false}\n        },\n        atoms: {\n          smoothness: isHighQuality ? 165 : 150,\n          outline: {enabled: isHighQuality}\n        },\n        bonds: {\n          enabled: false,\n          smoothness: isHighQuality ? 145 : 130,\n          outline: {enabled: isHighQuality}\n        }\n      }\n      refViewer.current = new StructureViewer(refCanvasDiv.current, options)\n      refViewer.current.load(system)\n      refViewer.current.controls({resetOnDoubleClick: false})\n\n      // Get a list of all species ordered by atomic number\n      const species = Object.entries(refViewer.current.elements)\n        .map(([label, info]) => ({\n          label: label,\n          color: info[0],\n          radius: info[1],\n          atomicNumber: refViewer.current.elementNumbers[label]\n        }))\n      setSpecies(species)\n    })\n  }, [])\n\n  // Called whenever the system changes. Loads the structure asynchronously.\n  useEffect(() => {\n    if (!data) return\n    readyRef.current = false\n    setReady(false)\n    setLoading(true)\n\n    // If the system is very large, ask the user first for permission to attempt\n    // to visualize it.\n    if (!accepted) {\n      if (nAtoms > sizeLimit) {\n        setShowPrompt(true)\n        return\n      }\n    }\n\n    // Remember to catch since react error boundaries do not automatically catch\n    // from async calls.\n    loadSystem(data, refViewer)\n      .catch(throwError)\n      .finally(() => {\n        setReady(true)\n        readyRef.current = true\n      })\n  }, [data, nAtoms, accepted, sizeLimit, throwError, loadSystem])\n\n  // Once the system is loaded, this effect will determine the final visual\n  // layout. By monitoring the ready-state, the selections are updated correctly\n  // once the system is loaded. By also monitoring the readyRef-reference, this\n  // effect can know the status within the same render cycle as well.\n  useEffect(() => {\n    if (!ready || !readyRef.current) {\n      return\n    }\n\n    // Reset camera and system rotations\n    refViewer.current.resetCamera()\n    refViewer.current.setRotation([1, 0, 0, 0])\n\n    // Determine the orientation and view centering based on material type and\n    // the structure type.\n    let center = 'COP'\n    let fit = 'full'\n    let showBondsValue = nAtoms < bondLimit\n    let rotations = [\n      [0, 1, 0, 60],\n      [1, 0, 0, 30]\n    ]\n    let alignments = hasCell\n      ? [\n        ['up', 'c'],\n        ['right', 'b']\n      ]\n      : undefined\n    if (cellType === 'conventional' || cellType === 'primitive') {\n      if (structuralType === 'bulk') {\n        center = 'COC'\n        alignments = [\n          ['up', 'c'],\n          ['right', 'b']\n        ]\n      } else if (structuralType === '2D') {\n        center = 'COC'\n        alignments = [\n          ['right', 'a'],\n          ['up', 'b']\n        ]\n        rotations = [\n          [1, 0, 0, -60]\n        ]\n      } else if (structuralType === '1D') {\n        center = 'COC'\n        alignments = [\n          ['right', 'a']\n        ]\n        rotations = [\n          [1, 0, 0, -60],\n          [0, 1, 0, 30],\n          [1, 0, 0, 30]\n        ]\n      }\n    }\n\n    // No selection: show all\n    if (isEmpty(selection?.selection)) {\n      refViewer.current.atoms()\n      showBondsValue = nAtoms < bondLimit\n      setShowBonds(showBondsValue, false)\n      if (hasCell) {\n        setShowCell(true)\n        setShowLatticeConstants(true)\n      }\n    // Focused selection: show only selected atoms\n    } else {\n      center = selection.isSubsystem ? selection.focus : center\n      fit = selection.isSubsystem ? selection.focus : 'full'\n      refViewer.current.atoms([\n        {opacity: 0},\n        {opacity: 0.1, include: selection.transparent},\n        {opacity: 1, include: selection.selection}\n      ])\n      // Bonds are not shown for selections\n      if (!selection.isSubsystem) {\n        showBondsValue = false\n        setShowBonds(showBondsValue, false)\n      }\n      if (hasCell) {\n        setShowCell(!selection.isSubsystem)\n        setShowLatticeConstants(!selection.isSubsystem)\n      }\n    }\n    if (hasCell) {\n      setWrap(true, showBondsValue, false)\n      refViewer.current.align(alignments)\n    }\n    refViewer.current.rotate(rotations)\n    refViewer.current.center(center)\n    refViewer.current.fit(fit, fitMargin)\n    refViewer.current.render()\n    refViewer.current.saveCameraReset()\n    setFit(fit)\n    setCenter(center)\n    setLoading(false)\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [selection, ready])\n\n  // Memoized callbacks\n  const openMenu = useCallback((event) => {\n    setAnchorEl(event.currentTarget)\n  }, [])\n\n  const closeMenu = useCallback(() => {\n    setAnchorEl(null)\n  }, [])\n\n  const toggleFullscreen = useCallback(() => {\n    setFullscreen(!fullscreen)\n  }, [fullscreen])\n\n  const takeScreencapture = useCallback(() => {\n    refViewer.current.takeScreenShot(captureName)\n  }, [captureName])\n\n  const handleReset = useCallback(() => {\n    refViewer.current.resetCamera()\n    refViewer.current.center(center)\n    refViewer.current.fit(fit, fitMargin)\n    refViewer.current.render()\n  }, [center, fit])\n\n  // Decides the possible overlay to display\n  const overlay = useMemo(() => {\n    if (showPrompt) {\n      return <Alert\n        severity=\"info\"\n        action={\n          <Button color=\"inherit\" size=\"small\" onClick={() => {\n            setShowPrompt(false)\n            setAccepted(true)\n          }}>\n              YES\n          </Button>\n        }\n      >\n        {`Visualization is by default disabled for systems with more than ${sizeLimit} atoms. Do you wish to enable visualization for this system with ${nAtoms} atoms?`}\n      </Alert>\n    } else if (loading) {\n      return <Placeholder margin={0}/>\n    } else if (noData) {\n      return <NoData margin={0}/>\n    }\n    return null\n  }, [loading, nAtoms, noData, showPrompt, sizeLimit])\n\n  return <Floatable\n    data-testid={testID}\n    className={clsx(styles.root, className)}\n    float={fullscreen}\n    onFloat={toggleFullscreen}\n  >\n    <div className={styles.container}>\n      {/* Overlay that is displayed on top of the viewer */}\n      <div className={styles.content}>\n        {overlay}\n      </div>\n      {/* This contains the actual visualization. Needs to be always in the DOM so we can\n      load the structure into it properly. */}\n      <div\n        className={styles.content}\n        style={{visibility: overlay ? 'hidden' : 'visible'}}\n      >\n        {fullscreen && <Typography className={styles.title} variant=\"h6\">Structure</Typography>}\n        <div className={styles.canvas} ref={refCanvas}>\n          {!disableLegend &&\n            <Species species={species} className={styles.legend}/>\n          }\n        </div>\n        <div className={styles.header}>\n          <Actions>\n            <Action tooltip='Reset view' onClick={handleReset}>\n              <Replay/>\n            </Action>\n            <Action tooltip='Toggle fullscreen' onClick={toggleFullscreen}>\n              {fullscreen ? <FullscreenExit/> : <Fullscreen/>}\n            </Action>\n            <Action tooltip='Capture image' onClick={takeScreencapture}>\n              <CameraAlt/>\n            </Action>\n            {m_path &&\n              <Action tooltip='View data in the archive' onClick={() => { history.push(m_path) }}>\n                <ViewList/>\n              </Action>\n            }\n            <Action tooltip='Options' onClick={openMenu}>\n              <MoreVert/>\n            </Action>\n          </Actions>\n          <Menu\n            id='settings-menu'\n            anchorEl={anchorEl}\n            getContentAnchorEl={null}\n            anchorOrigin={{ vertical: 'bottom', horizontal: 'right' }}\n            transformOrigin={{ vertical: 'top', horizontal: 'right' }}\n            keepMounted\n            open={open}\n            onClose={closeMenu}\n          >\n          <MenuItem key='show-bonds'>\n            <FormControlLabel\n              control={\n                <Checkbox\n                  checked={hasSelection ? false : showBonds}\n                  disabled={hasSelection}\n                  onChange={(event) => { setShowBonds(!showBonds, true) }}\n                  color='primary'\n                />\n              }\n              label='Show bonds'\n            />\n          </MenuItem>\n          <MenuItem key='show-axis'>\n            <FormControlLabel\n              control={\n                <Checkbox\n                  checked={!hasCell ? false : (hasSelection ? !selection.isSubsystem : showLatticeConstants)}\n                  disabled={!hasCell ? true : hasSelection}\n                  onChange={(event) => { setShowLatticeConstants(!showLatticeConstants, true) }}\n                  color='primary'\n                />\n              }\n              label='Show lattice constants'\n            />\n          </MenuItem>\n          <MenuItem key='show-cell'>\n            <FormControlLabel\n              control={\n                <Checkbox\n                  checked={!hasCell ? false : (hasSelection ? !selection.isSubsystem : showCell)}\n                  disabled={!hasCell ? true : hasSelection}\n                  onChange={(event) => { setShowCell(!showCell, true) }}\n                  color='primary'\n                />\n              }\n              label='Show simulation cell'\n            />\n          </MenuItem>\n          <MenuItem key='wrap'>\n            <FormControlLabel\n              control={\n                <Checkbox\n                  checked={!hasCell ? false : wrap}\n                  disabled={!hasCell ? true : hasSelection}\n                  onChange={(event) => { setWrap(!wrap, showBonds, true) }}\n                  color='primary'\n                />\n              }\n              label='Wrap positions'\n            />\n          </MenuItem>\n          </Menu>\n        </div>\n      </div>\n    </div>\n  </Floatable>\n})\n\nStructure.propTypes = {\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  data: PropTypes.oneOfType([\n    PropTypes.bool,\n    PropTypes.object\n  ]),\n  structuralType: PropTypes.oneOf(['bulk', 'surface', '2D', '1D', 'molecule / cluster', 'unavailable']),\n  cellType: PropTypes.oneOf(['original', 'conventional', 'primitive']),\n  m_path: PropTypes.string, // Path of the structure data in the metainfo\n  captureName: PropTypes.string, // Name of the file that the user can download\n  sizeLimit: PropTypes.number, // Maximum system size before a prompt is shown\n  bondLimit: PropTypes.number, // The size at which bonds are turned off\n  disableLegend: PropTypes.bool, // Disable the legend showing the species list\n  selection: PropTypes.shape({\n    /**\n     * The atom indices to show.\n     */\n    selection: PropTypes.arrayOf(PropTypes.number),\n    /**\n     * The atom indices to which the view is focused on.\n     */\n    focus: PropTypes.arrayOf(PropTypes.number),\n    /**\n     * The atom indices to display transparently.\n     */\n    transparent: PropTypes.arrayOf(PropTypes.number),\n    /**\n     * Is the selection visualizing a subsystem, e.g. a single molecule?\n     */\n    isSubsystem: PropTypes.bool\n  }),\n  'data-testid': PropTypes.string\n}\nStructure.defaultProps = {\n  captureName: 'structure',\n  sizeLimit: 500,\n  bondLimit: 50\n}\n\nexport default withWebGLErrorHandler(withErrorHandler('Could not load structure.')(Structure))\n\n/**\n * Converts the given structure in the format used by 'results' into the format\n * used by the materia-library.\n *\n * @param {object} structure.\n *\n * @return {undefined|object} If the given structure cannot be converted,\n * returns an empty object.\n */\nexport function toMateriaStructure(structure) {\n  if (!structure) {\n    return undefined\n  }\n\n  try {\n    // Resolve atomic species using the labels and their mapping to chemical\n    // elements.\n    const speciesMap = new Map(structure.species.map(s => [s.name, s.chemical_symbols[0]]))\n\n    const structMateria = {\n      species: structure.species_at_sites.map(x => speciesMap.get(x)),\n      cell: structure.lattice_vectors\n        ? new Quantity(structure.lattice_vectors, 'meter').to('angstrom').value()\n        : undefined,\n      positions: new Quantity(structure.cartesian_site_positions, 'meter').to('angstrom').value(),\n      fractional: false,\n      pbc: structure.dimension_types ? structure.dimension_types.map((x) => !!x) : undefined\n    }\n    return structMateria\n  } catch (error) {\n    return {}\n  }\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useState, useRef, useCallback, useEffect, useLayoutEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport { Typography, makeStyles, Button, Box } from '@material-ui/core'\nimport { useErrors } from '../errors'\nimport ReactJson from 'react-json-view'\nimport { Document, Page, pdfjs } from 'react-pdf'\nimport InfiniteScroll from 'react-infinite-scroller'\nimport { useApi } from '../api'\nimport { apiBase } from '../../config'\nimport { parseCifStructures } from 'crystcif-parse'\nimport H5Web from '../visualization/H5Web'\nimport Structure from '../visualization/Structure'\nimport { isWaitingForUpdateTestId } from '../../utils'\nimport { useLane } from './Browser'\n\npdfjs.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/${pdfjs.version}/pdf.worker.js`\n\nconst useFilePreviewStyles = makeStyles(theme => ({\n  scrollableContainer: {\n    width: '100%',\n    height: '100%',\n    display: 'inline-block',\n    overflow: 'auto'\n  },\n  img: {\n    maxHeight: '100%',\n    maxWidth: '100%'\n  }\n}))\n\n/* Viewer definitions */\nconst viewerText = {\n  name: 'text',\n  fileExtensions: ['txt', 'yaml', 'yml', 'csv', 'xml', 'dat'],\n  maxSizePreview: 1e10, // Effectively infinite\n  maxSizeAutoPreview: 1e10, // Effectively infinite\n  width: 700,\n  render: ({ uploadId, path }) => {\n    return <FilePreviewText uploadId={uploadId} path={path} />\n  }\n}\nconst viewerImg = {\n  name: 'image',\n  fileExtensions: ['png', 'jpg', 'jpeg', 'gif', 'bmp', 'svg'],\n  maxSizeAutoPreview: 10e6,\n  render: ({ classes, url, setFailedToPreview }) => {\n    return <img\n      src={url} className={classes.img}\n      alt=\"Loading...\" onError={() => setFailedToPreview(true)}\n    />\n  }\n}\nconst viewerJSON = {\n  name: 'json',\n  fileExtensions: ['json'],\n  maxSizeAutoPreview: 10e6,\n  requiresLoadedData: true,\n  width: 'fit-content',\n  render: ({ classes, data }) => {\n    if (typeof data.current === 'string') {\n      data.current = JSON.parse(data.current)\n    }\n    return (\n      <Box className={classes.scrollableContainer}>\n        <ReactJson src={data.current} enableClipboard={false} collapsed={1} displayObjectSize={false} />\n      </Box>\n    )\n  }\n}\nconst viewerPDF = {\n  name: 'pdf',\n  fileExtensions: ['pdf'],\n  maxSizeAutoPreview: 10e6,\n  width: 700,\n  render: ({ url, setFailedToPreview }) => {\n    return <FilePreviewPdf\n      file={{ url: url, withCredentials: true }}\n      error={(error) => {\n        console.log(error)\n        setFailedToPreview(true)\n      }}\n    />\n  }\n}\n\nconst viewerHdfFive = {\n  name: 'hdf5',\n  fileExtensions: ['h4', 'hd4', 'hdf4', 'hdf', 'h5', 'hd5', 'hdf5', 'hd5', 'nxs', 'h5oina', 'edaxh5', 'emd', 'dream3d'],\n  maxSizeAutoPreview: 10e6,\n  width: 'fit-content',\n  render: ({ uploadId, path }) => <H5Web upload_id={uploadId} filename={path} />\n}\nconst viewerCif = {\n  name: 'cif',\n  fileExtensions: ['cif'],\n  maxSizeAutoPreview: 1e5,\n  requiresLoadedData: true,\n  width: 500,\n  render: ({ data }) => {\n    if (typeof data.current === 'string') {\n      const cifData = parseCifStructures(data.current)\n      const cifStructure = cifData[Object.keys(cifData)[0]]\n      const structureData = {\n        cell: cifStructure.get_cell(),\n        pbc: cifStructure.get_pbc(),\n        positions: cifStructure.get_positions(),\n        species: cifStructure.get_chemical_symbols()\n      }\n      data.current = structureData\n    }\n    return (\n      <div style={{ height: 500, width: 500 }}>\n        <Structure data={data.current} />\n      </div>\n    )\n  }\n}\n\nexport const viewers = [viewerText, viewerImg, viewerJSON, viewerPDF, viewerHdfFive, viewerCif]\n\nconst FilePreview = React.memo(({ uploadId, path, size }) => {\n  const classes = useFilePreviewStyles()\n  const { api, user } = useApi()\n  const { raiseError } = useErrors()\n\n  // Determine viewer to use and if we should preview automatically, based on extension and size\n  const fileExtension = path.split('.').pop().toLowerCase()\n  let autoPreview = true\n  let selectedViewer = viewerText\n  for (const viewer of viewers) {\n    if (viewer.fileExtensions.includes(fileExtension)) {\n      if (size < (selectedViewer.maxSizePreview || 50e6)) {\n        selectedViewer = viewer\n        autoPreview = size < viewer.maxSizeAutoPreview\n        break\n      }\n    }\n  }\n\n  const [preview, setPreview] = useState(autoPreview)\n  const [failedToPreview, setFailedToPreview] = useState(false)\n  const [useFallbackViewer, setUseFallbackViewer] = useState(false)\n\n  const data = useRef()\n  const [dataLoaded, setDataLoaded] = useState(false)\n\n  const encodedPath = path.split('/').map(segment => encodeURIComponent(segment)).join('/')\n  let url = `${apiBase}/v1/uploads/${uploadId}/raw/${encodedPath}`\n  if (url.startsWith('/')) {\n    url = `${window.location.origin}${url}`\n  }\n\n  useEffect(() => {\n    if (preview && !failedToPreview && selectedViewer.requiresLoadedData && data.current === undefined) {\n      // Need to load the file data content for the viewer\n      data.current = null\n      api.get(url)\n        .then(response => {\n          data.current = response\n          setDataLoaded(true)\n        })\n        .catch(error => {\n          setFailedToPreview(true)\n          raiseError(error)\n        })\n    }\n  }, [preview, failedToPreview, selectedViewer, user, url, data, dataLoaded, setDataLoaded, api, raiseError])\n\n  if (!preview) {\n    return (\n      <Box margin={2} textAlign=\"center\">\n        <Button onClick={() => setPreview(true)} variant=\"contained\" size=\"small\" color=\"primary\">\n          Preview with {selectedViewer.name} viewer\n        </Button>\n      </Box>\n    )\n  }\n\n  let content\n  if (selectedViewer.requiresLoadedData && !dataLoaded) {\n    // Not ready to invoke the viewer yet\n    content = <Typography>Loading...</Typography>\n  } else if (!failedToPreview) {\n    try {\n      content = selectedViewer.render({ uploadId, path, url, data, setFailedToPreview, classes })\n    } catch (error) {\n      // TODO\n    }\n  } else if (!useFallbackViewer) {\n    // Selected viewer failed\n    content = (\n      <Box textAlign=\"center\">\n        <Typography color=\"error\">Failed to open with {selectedViewer.name} viewer. Bad file format?</Typography>\n        <Button onClick={() => setUseFallbackViewer(true)} variant=\"contained\" size=\"small\" color=\"primary\">\n          Open with text viewer\n        </Button>\n      </Box>\n    )\n  } else {\n    // Use the text viewer as last resort\n    content = viewerText.render({ uploadId, path, url, data, setFailedToPreview, classes })\n  }\n  return <Box marginBottom={1} flexGrow={1} width={`${selectedViewer.width || 500}px`} overflow=\"hidden\">\n    {content}\n  </Box>\n})\nFilePreview.propTypes = {\n  uploadId: PropTypes.string.isRequired,\n  path: PropTypes.string.isRequired,\n  size: PropTypes.number.isRequired\n}\nexport default FilePreview\n\nconst useFilePreviewTextStyles = makeStyles(theme => ({\n  containerDiv: {\n    height: '100%',\n    overflowX: 'auto',\n    backgroundColor: theme.palette.primary.dark\n  },\n  fileContents: {\n    margin: theme.spacing(1),\n    padding: 0,\n    display: 'inline-block',\n    color: theme.palette.primary.contrastText,\n    fontFamily: 'Consolas, \"Liberation Mono\", Menlo, Courier, monospace',\n    fontSize: 12,\n    minWidth: '100%'\n  }\n}))\nfunction FilePreviewText({ uploadId, path }) {\n  const classes = useFilePreviewTextStyles()\n  const { api } = useApi()\n  const { raiseError } = useErrors()\n  const [contents, setContents] = useState(null)\n  const [hasMore, setHasMore] = useState(true)\n  const loading = useRef(false)\n  const [loadFailed, setLoadFailed] = useState(false)\n  const lane = useLane()\n\n  const encodedPath = path.split('/').map(segment => encodeURIComponent(segment)).join('/')\n\n  const loadMore = useCallback(async () => {\n    // The infinite scroll component normally calls the loadMore hook whenever it\n    // gets updates, therefore calling this infinitely before it gets any chances of\n    // receiving the results (https://github.com/CassetteRocks/react-infinite-scroller/issues/163).\n    // Therefore, we use `loading` to keep track of if we are already running a load request.\n    if (hasMore && !loading.current && !loadFailed) {\n      loading.current = true\n      api.get(\n        `/uploads/${uploadId}/raw/${encodedPath}`,\n        {\n          offset: contents?.length || 0,\n          length: 16 * 1024,\n          decompress: true,\n          ignore_mime_type: true\n        },\n        {\n          transformResponse: [],\n          responseType: 'blob'\n        })\n        .then(content => {\n          // Note that the length of the string is not necessarily the number of\n          // bytes that were transferred. This is why we need to request a blob,\n          // get it's size, and then in a second step decode it as string for\n          // displaying.\n          const nBytes = content.size\n          setHasMore(nBytes === 16 * 1024)\n          return content.text()\n        })\n        .then(text => {\n          setContents(old => (old || '') + (text || ''))\n        })\n        .catch(error => {\n          setLoadFailed(true)\n          setContents(old => (old || '') + '\\n\\nERROR - COULD NOT READ FILE!')\n          raiseError(error)\n        })\n        .finally(() => { loading.current = false })\n    }\n  }, [uploadId, encodedPath, loading, loadFailed, setLoadFailed, hasMore, setHasMore, setContents, api, raiseError, contents])\n\n  useEffect(() => {\n    // Trigger loading the first chunk\n    if (contents === null && !loading.current) {\n      loadMore()\n    }\n  }, [contents, loading, loadMore])\n\n  return (\n    <div className={classes.containerDiv}>\n      <InfiniteScroll\n        pageStart={0}\n        loadMore={loadMore}\n        hasMore={hasMore}\n        useWindow={false}\n        getScrollParent={() => lane.containerRef.current}\n        {...(contents === null ? { 'data-testid': isWaitingForUpdateTestId } : {})}\n      >\n        <pre className={classes.fileContents}>\n          {contents || ''}\n          &nbsp;\n        </pre>\n      </InfiniteScroll>\n    </div>\n  )\n}\nFilePreviewText.propTypes = {\n  uploadId: PropTypes.string.isRequired,\n  path: PropTypes.string.isRequired\n}\n\nconst useFilePreviewPdfStyles = makeStyles(theme => ({\n  containerDiv: {\n    height: '100%',\n    overflowX: 'hidden',\n    overflowY: 'scroll',\n    border: '1px solid rgba(0, 0, 0, 0.42)',\n    boxSizing: 'border-box'\n  },\n  pageDiv: {\n    border: '5px solid gray'\n  }\n}))\nconst FilePreviewPdf = React.memo(props => {\n  const classes = useFilePreviewPdfStyles()\n  const containerRef = useRef()\n  const [numPages, setNumPages] = useState(null)\n  const [pageWidth, setPageWidth] = useState()\n\n  useLayoutEffect(() => {\n    if (containerRef.current) {\n      setPageWidth(containerRef.current.clientWidth - 10) // The -10 is because of the borders\n    }\n  }, [])\n\n  function onDocumentLoadSuccess({ numPages }) {\n    setNumPages(numPages)\n  }\n\n  return (\n    <div className={classes.containerDiv} ref={containerRef}>\n      <Document onLoadSuccess={onDocumentLoadSuccess} renderMode=\"svg\" {...props}>\n        {numPages && pageWidth &&\n          Array(numPages).fill().map((_, i) =>\n            <div className={classes.pageDiv} key={`pdfPageDiv${i + 1}`}>\n              <Page pageNumber={i + 1} key={`pdfPage${i + 1}`} width={pageWidth} />\n            </div>)\n        }\n      </Document>\n    </div>)\n})\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useState, useMemo, useEffect, useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { useApi } from '../api'\nimport { useDataStore, useEntryStoreObj } from '../DataStore'\nimport { ui, apiBase} from '../../config'\n\n/**\n * Hook for retrieving read-only archive information for the entry present in\n * the active EntryContext.\n */\nexport const useArchive = (required) => {\n  const { entryId } = useEntryContext()\n  const { api } = useApi()\n  const [response, setResponse] = useState({})\n\n  // When entryId changes, resets the currently held response and updates it\n  // once new data arrives\n  useEffect(() => {\n    setResponse({})\n    if (!entryId) return\n    api\n      .post(`entries/${entryId}/archive/query`, {required}, {returnRequest: true})\n      .then(response => setResponse({data: response?.response?.data?.archive, response: response}))\n  }, [api, required, entryId])\n\n  return response\n}\n\n/**\n * Hook for retrieving read-only index information for the entry present in the\n * active EntryContext.\n */\nexport const useIndex = () => {\n  const { entryId } = useEntryContext()\n  const { api } = useApi()\n  const [response, setResponse] = useState({})\n\n  // When entryId changes, resets the currently held response and updates it\n  // once new data arrives\n  useEffect(() => {\n    setResponse({})\n    api\n      .get(`entries/${entryId}`, null, {returnRequest: true})\n      .then(response => setResponse({data: response?.response?.data, response: response}))\n  }, [api, entryId])\n\n  return response\n}\n\n/**\n * Hook for fetching the \"full\" entry data. If the entry is editable, the user\n * can also mutate the archive through this hook.\n *\n * @param {*} requireArchive Optional query filter\n */\nexport const useEntryStore = (requireArchive) => {\n  const {entryId} = useContext(entryContext) || {}\n  const entryStoreObj = useEntryStoreObj(apiBase, entryId, true, requireArchive)\n  return entryStoreObj\n}\n\n/**\n * Hook for fetching the current entry context.\n */\nexport const useEntryContext = () => {\n  return useContext(entryContext)\n}\n\n/**\n * Context that manages information about a specific entry that will be targeted\n * by different components.\n */\nconst entryContext = React.createContext()\nexport const EntryContext = React.memo(({entryId, cards, children}) => {\n  const dataStore = useDataStore()\n  dataStore.resetIfNeeded(entryId)\n\n  // Inform the Store of the selected entry\n  useEffect(() => {\n    dataStore.selectedEntry.current = `${apiBase}:${entryId}`\n    return () => { dataStore.selectedEntry.current = undefined }\n  }, [dataStore, entryId])\n\n  // Get the overview config\n  const finalCards = useMemo(() => {\n    const finalCards = cards || ui?.entry?.cards\n    return finalCards || undefined\n  }, [cards])\n\n  const value = useMemo(() => ({entryId, cards: finalCards}), [entryId, finalCards])\n  return <entryContext.Provider value={value}>\n    {children}\n  </entryContext.Provider>\n})\nEntryContext.propTypes = {\n  entryId: PropTypes.string,\n  cards: PropTypes.object,\n  children: PropTypes.node\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useCallback, useContext, useEffect, useMemo, useState} from 'react'\nimport PropTypes from 'prop-types'\nimport { makeStyles } from '@material-ui/core/styles'\nimport {\n  Box,\n  Typography,\n  Button\n} from '@material-ui/core'\nimport AssessmentIcon from '@material-ui/icons/Assessment'\nimport Icon from '@material-ui/core/Icon'\nimport {useApi} from '../api.js'\nimport { useErrors } from '../errors'\nimport { northBase } from '../../config'\n\nconst northToolContext = React.createContext()\n\nexport function useNorthTool() {\n  return useContext(northToolContext)\n}\n\nconst launchButtonLabels = {\n  'stopped': 'Launch',\n  'starting': 'Launching...',\n  'running': 'Open',\n  'stopping': 'Launch'\n}\n\nconst stoppButtonLabels = {\n  'stopping': 'Stopping...',\n  'running': 'Stop'\n}\n\nconst LaunchButton = React.memo(function LaunchButton(props) {\n  return <Button color=\"primary\" variant=\"contained\" size=\"small\" {...props} />\n})\n\nexport const NorthToolButtons = React.memo(function NorthToolButton() {\n  const {name, launch, stop, state} = useNorthTool()\n  return (\n    <Box display=\"flex\" flexDirection=\"row\">\n      <LaunchButton fullWidth name={name} onClick={launch} disabled={state === 'stopping' || state === 'starting' || !state}>\n        {launchButtonLabels[state] || 'not available'}\n      </LaunchButton>\n      {(state === 'running' || state === 'stopping') && (\n        <Box marginLeft={1}>\n          <LaunchButton color=\"default\" fullWidth onClick={stop} disabled={state === 'stopping'}>\n            {stoppButtonLabels[state]}\n          </LaunchButton>\n        </Box>\n      )}\n    </Box>\n  )\n})\n\n/**\n * Remote tool item. Can be shown within a list or as a standalone component.\n */\nconst useStyles = makeStyles(theme => ({\n  root: {},\n  imageIcon: {\n    height: '100%'\n  },\n  iconRoot: {\n    textAlign: 'center',\n    height: '3rem',\n    width: '3rem',\n    marginRight: theme.spacing(2)\n  },\n  action: {\n    marginTop: 0,\n    marginRight: 0\n  }\n}))\n\nconst NorthTool = React.memo(function NorthTool({tool, uploadId, path, children}) {\n  const {name, title, version, description, short_description, icon, path_prefix, with_path} = tool\n  const styles = useStyles()\n  const {api} = useApi()\n  const {raiseError} = useErrors()\n\n  const [state, setState] = useState('stopped')\n\n  const getToolStatus = useCallback(() => {\n    return api.get(`north/${name}`)\n      .then(response => {\n        return response.data.state\n      }).catch(raiseError)\n  }, [api, raiseError, name])\n\n  useEffect(() => {\n    const toolStatus = getToolStatus()\n    if (toolStatus) {\n      toolStatus.then((toolStatus) => {\n        setState(toolStatus)\n      })\n    }\n  }, [setState, getToolStatus])\n\n  const launch = useCallback(() => {\n    // We get the current actual tools status and do not use the one used to display the status!\n    setState('starting')\n    api.post(`north/${name}?upload_id=${uploadId}`)\n      .then((response) => {\n        console.log(response)\n        let toolUrl = `${northBase}/user/${response.username}/${response.tool}`\n        if (with_path && response.upload_mount_dir && path) {\n          if (path_prefix) {\n            toolUrl = `${toolUrl}/${path_prefix}`\n          }\n          toolUrl = `${toolUrl}/${response.upload_mount_dir}/${path}`\n        }\n        console.log(toolUrl)\n        window.open(toolUrl, name)\n        setState(response.data.state)\n      })\n      .catch(errors => {\n        raiseError(errors)\n        setState('stopped')\n      })\n  }, [setState, api, raiseError, name, with_path, uploadId, path, path_prefix])\n\n  const stop = useCallback(() => {\n    setState('stopping')\n    api.delete(`north/${name}`)\n      .then((response) => {\n        console.log(response)\n        setState('stopped')\n      })\n      .catch(raiseError)\n  }, [api, raiseError, setState, name])\n\n  const value = useMemo(() => ({\n    state: state,\n    launch: launch,\n    stop: stop,\n    ...tool\n  }), [tool, state, launch, stop])\n\n  if (children) {\n    return (\n      <northToolContext.Provider value={value}>\n        {children}\n      </northToolContext.Provider>\n    )\n  }\n\n  return (\n    <northToolContext.Provider value={value}>\n      <Box marginY={1}>\n        <Box display=\"flex\" flexDirection=\"row\" marginBottom={1}>\n          {icon ? (\n            <Icon classes={{root: styles.iconRoot}}>\n              <img className={styles.imageIcon} src={`${process.env.PUBLIC_URL}/${icon}`} alt=\"icon\"/>\n            </Icon>\n          ) : (\n            <AssessmentIcon classes={{root: styles.iconRoot}}/>\n          )}\n          <Box flexGrow={1}>\n            <Typography><b>{title || name}{version && <span> ({version})</span>}</b>: {short_description || description}</Typography>\n          </Box>\n        </Box>\n        <NorthToolButtons />\n      </Box>\n    </northToolContext.Provider>\n  )\n})\n\nNorthTool.propTypes = {\n  tool: PropTypes.object.isRequired,\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ]),\n  uploadId: PropTypes.string, // the upload id with the path in it\n  path: PropTypes.string // path to a file within the upload\n}\n\nexport default NorthTool\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\nimport { makeStyles, Typography, useTheme } from '@material-ui/core'\nimport AutoSizer from 'react-virtualized-auto-sizer'\n\nexport const limitedWidthWidth = 1024\n\nconst useStyles = makeStyles(theme => ({\n  fullWidth: {\n    marginLeft: theme.spacing(2),\n    marginRight: theme.spacing(2)\n  },\n  limitedWidth: {\n    width: '100%',\n    maxWidth: limitedWidthWidth + theme.spacing(2),\n    paddingLeft: theme.spacing(2),\n    paddingRight: theme.spacing(2),\n    marginLeft: 'auto',\n    marginRight: 'auto'\n  },\n  limitedHeight: {\n    height: '100%'\n  },\n  fullHeight: {\n    marginTop: theme.spacing(2),\n    marginBottom: theme.spacing(2)\n  }\n}))\n\nexport default function Page({limitedWidth, limitedHeight, loading, children, ...moreProps}) {\n  const classes = useStyles()\n  const theme = useTheme()\n\n  const pageWithWidth = <div\n    className={clsx({\n      [classes.fullWidth]: !limitedWidth,\n      [classes.limitedWidth]: limitedWidth,\n      [classes.limitedHeight]: limitedHeight\n    })}\n    {...moreProps}\n  >\n    {loading && <Typography>loading ...</Typography>}\n    {!loading && children}\n  </div>\n\n  if (limitedHeight) {\n    return <div {...moreProps} className={classes.limitedHeight}>\n      <AutoSizer disableWidth>\n        {({height}) => <div style={{height: height}}>\n          <div style={{height: theme.spacing(2)}}/>\n          <div style={{height: height - theme.spacing(4)}}>\n            {pageWithWidth}\n          </div>\n        </div>}\n      </AutoSizer>\n    </div>\n  } else {\n    return <div className={classes.fullHeight} {...moreProps}>\n      {pageWithWidth}\n    </div>\n  }\n}\n\nPage.propTypes = {\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ]),\n  /** Limits the width of the page content to a standard width. */\n  limitedWidth: PropTypes.bool,\n  /** Limits the height of the page content to fit into the current view port. */\n  limitedHeight: PropTypes.bool,\n  loading: PropTypes.bool\n}\n","/* eslint-disable quotes */\n/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useCallback, useState } from 'react'\nimport {\n  Grid,\n  makeStyles,\n  Box,\n  Accordion,\n  Typography,\n  AccordionSummary,\n  AccordionDetails,\n  Link,\n  Chip\n} from '@material-ui/core'\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore'\nimport Page from '../Page'\nimport { withLoginRequired } from '../api'\nimport Markdown from '../Markdown'\nimport DefaultIcon from '@material-ui/icons/Assessment'\nimport Icon from '@material-ui/core/Icon'\nimport NorthTool, { NorthToolButtons, useNorthTool } from './NorthTool'\nimport { ui, northTools as _tools } from '../../config'\n\nexport const help = `\nThe NOMAD Remote Tools Hub (NORTH) provides access to tools which you can use to\nwork remotely on unpublished data stored within NOMAD.\n`\n\nconst useNorthToolStyles = makeStyles(theme => ({\n  description: {\n    '& > :first-child': {\n      marginTop: '0 !important'\n    }\n  },\n  iconImg: {\n    height: '100%'\n  },\n  screenShotImg: {\n    width: '100%'\n  }\n}))\n\nconst NorthToolAccordion = React.memo(function NorthToolAccordion({...props}) {\n  const {\n    state,\n    title,\n    icon,\n    file_extensions,\n    maintainer,\n    short_description,\n    description} = useNorthTool()\n  const classes = useNorthToolStyles()\n\n  return (\n    <Accordion {...props}>\n      <AccordionSummary\n        expandIcon={<ExpandMoreIcon />}\n      >\n        <Grid container direction=\"row\" spacing={2}>\n          <Grid item>\n            {icon ? (\n              <Icon>\n                <img\n                  className={classes.iconImg}\n                  src={`${process.env.PUBLIC_URL}/${icon}`}\n                  alt=\"icon\"\n                />\n              </Icon>\n            ) : (\n              <DefaultIcon />\n            )}\n          </Grid>\n          <Grid item xs={2}>\n            <Typography><b>{title}</b></Typography>\n          </Grid>\n          {short_description && (\n            <Grid item >\n              <Typography>\n                {short_description}\n              </Typography>\n            </Grid>\n          )}\n          <Grid item>\n            {state === 'running' && (\n              <Chip size=\"small\" color=\"primary\" label=\"running\" />\n            )}\n          </Grid>\n        </Grid>\n      </AccordionSummary>\n      <AccordionDetails>\n        <Grid container spacing={2}>\n          <Grid item xs={8}>\n            <Typography>\n              <Markdown className={classes.description}>\n                {description || '*Missing tool description*'}\n              </Markdown>\n            </Typography>\n          </Grid>\n          <Grid item xs={4}>\n            <Box display=\"flex\" flexDirection=\"column\">\n              {maintainer && (\n                <Typography>\n                  <b>Maintainer: </b>{maintainer\n                    .map((maintainer, index) => (\n                      <Link\n                        key={index}\n                        href={`mailto:${maintainer.email}`}\n                      >\n                        {maintainer.name}\n                      </Link>\n                    )).reduce((prev, curr) => [prev, ', ', curr])\n                  }\n                </Typography>\n              )}\n              {file_extensions && file_extensions.length > 0 && (\n                <Typography>\n                  <b>File extensions: </b>{file_extensions\n                    .map((extension, index) => <span key={index}>{extension}</span>)\n                    .reduce((prev, curr) => [prev, ', ', curr])\n                  }\n                </Typography>\n              )}\n              <Box flexGrow={1}>&nbsp;</Box>\n              <NorthToolButtons/>\n            </Box>\n          </Grid>\n        </Grid>\n      </AccordionDetails>\n    </Accordion>\n  )\n})\nNorthToolAccordion.propTypes = {}\n\n/**\n * Landing page for the NOMAD Remote Tools Hub.\n */\nconst NorthPage = React.memo(() => {\n  const tools = useTools()\n  const [expanded, setExpanded] = useState('jupyter')\n\n  const handleChange = useCallback(tool => {\n    setExpanded(value => value === tool.name ? null : tool.name)\n  }, [setExpanded])\n\n  return (\n    <Page limitedWidth>\n      <Box marginTop={3}>\n        <Typography variant=\"h4\" color=\"primary\">\n          Welcome to <b>NORTH</b> (NOMAD Remote Tools Hub)\n        </Typography>\n      </Box>\n      <Box marginY={1}>\n        <Typography>\n          NORTH allows you to run pre-configured applications directly on the server. With\n          NORTH you can access, analyze, and create data directly in your uploads, using\n          your favorite tools, no setup required.\n        </Typography>\n      </Box>\n      <Box marginY={1}>\n        <Typography>\n          This page shows all available tools. It also show which tools are already running\n          for you. For each tool each user can only run one instance at a time. Some\n          tools can also be launched from the file browser in your uploads, depending on\n          file types.\n        </Typography>\n      </Box>\n      <Box marginY={2}>\n        {Object\n          .keys(tools)\n          .map(key => ({name: key, title: key, ...tools[key]}))\n          .map((tool, index) => (\n            <NorthTool key={index} tool={tool}>\n              <NorthToolAccordion\n                expanded={tool.name === expanded}\n                onChange={() => handleChange(tool)}\n              />\n            </NorthTool>\n          ))\n        }\n      </Box>\n    </Page>\n  )\n})\n\nexport default withLoginRequired(NorthPage)\n\n/**\n * Hook for loading the list of available tools from the NORTH API.\n*/\nexport function useTools() {\n  if (!ui?.north?.enabled) {\n    return {}\n  }\n  return _tools\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { List, Divider } from '@material-ui/core'\nimport NorthTool from './NorthTool'\nimport { useTools } from './NorthPage'\n\nconst NorthLaunchButton = React.memo(function NorthLaunchButton({tools, ...props}) {\n  tools = tools || []\n  const northTools = useTools()\n  const toolsData = Object.keys(northTools)\n    .filter(tool => tools.includes(tool))\n    .map(key => ({name: key, title: key, ...northTools[key]}))\n\n  if (toolsData.length === 0) {\n    return null\n  }\n\n  return (\n    <List>\n      {toolsData\n        .map((tool, index) => (\n          <div key={tool.name}>\n            <NorthTool tool={tool} {...props} />\n            {index !== Object.keys(toolsData).length - 1 && <Divider/>}\n          </div>\n        ))}\n    </List>\n  )\n})\nNorthLaunchButton.propTypes = {\n  tools: PropTypes.arrayOf(PropTypes.string)\n}\n\nexport default NorthLaunchButton\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useContext, useMemo, useCallback, useState, useRef, useEffect } from 'react'\nimport { useHistory } from 'react-router-dom'\nimport PropTypes from 'prop-types'\nimport { makeStyles, Typography, IconButton, Box, Grid, Button, Tooltip, TextField,\n  Dialog, DialogContent, DialogContentText } from '@material-ui/core'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport { useDataStore, useEntryStoreObj } from '../DataStore'\nimport Browser, { Item, Content, Adaptor, browserContext, laneContext, Title, Compartment } from './Browser'\nimport { useApi } from '../api'\nimport UploadIcon from '@material-ui/icons/CloudUpload'\nimport DownloadIcon from '@material-ui/icons/CloudDownload'\nimport FileCopyIcon from '@material-ui/icons/FileCopy'\nimport CreateNewFolderIcon from '@material-ui/icons/CreateNewFolder'\nimport DeleteIcon from '@material-ui/icons/Delete'\nimport NavigateIcon from '@material-ui/icons/ArrowForward'\nimport FolderIcon from '@material-ui/icons/FolderOutlined'\nimport FileIcon from '@material-ui/icons/InsertDriveFileOutlined'\nimport ReloadIcon from '@material-ui/icons/Replay'\nimport RecognizedFileIcon from '@material-ui/icons/InsertChartOutlinedTwoTone'\nimport { useDropzone } from 'react-dropzone'\nimport { fromEvent } from 'file-selector'\nimport Download from '../entry/Download'\nimport Quantity from '../Quantity'\nimport FilePreview from './FilePreview'\nimport { useEntryStore } from '../entry/EntryContext'\nimport { archiveAdaptorFactory } from './ArchiveBrowser'\nimport NorthLaunchButton from '../north/NorthLaunchButton'\nimport { useTools } from '../north/NorthPage'\nimport { EntryButton } from '../nav/Routes'\nimport { useErrors } from '../errors'\nimport { apiBase } from '../../config'\nimport { parseNomadUrl, refType, urlJoin, urlEncodePath, systemMetainfoUrl, createEntryUrl } from '../../utils'\n\nconst FileBrowser = React.memo(({uploadUrl, rootTitle, highlightedItem = null}) => {\n  const adaptor = useMemo(() => {\n    return new RawDirectoryAdaptor(uploadUrl, rootTitle, highlightedItem)\n  }, [uploadUrl, rootTitle, highlightedItem])\n\n  return <Browser adaptor={adaptor} />\n})\nFileBrowser.propTypes = {\n  uploadUrl: PropTypes.string.isRequired,\n  rootTitle: PropTypes.string.isRequired,\n  highlightedItem: PropTypes.string\n}\nexport default FileBrowser\n\nclass RawDirectoryAdaptor extends Adaptor {\n  constructor(uploadUrl, title, highlightedItem) {\n    super()\n    const parsedUrl = parseNomadUrl(uploadUrl)\n    if (parsedUrl.type !== refType.upload) throw new Error(`Expected an upload url, got ${uploadUrl}`)\n    if (!parsedUrl.isResolved) throw new Error(`Absolute url required, got ${uploadUrl}`)\n    this.deploymentUrl = parsedUrl.deploymentUrl\n    this.uploadUrl = uploadUrl\n    this.uploadId = parsedUrl.uploadId\n    this.path = parsedUrl.path\n    this.title = title\n    this.highlightedItem = highlightedItem\n    this.editable = undefined\n    this.data = undefined\n    this.timestamp = undefined\n    this.initialized = false\n    this.dependencies = new Set([this.uploadId])\n    this.api = undefined\n    this.page_size = 40\n    this.lastPage = undefined\n  }\n  depends() {\n    return this.dependencies\n  }\n  async initialize(api, dataStore) {\n    this.api = api\n    this.lastPage = 1\n    const uploadStoreObj = await dataStore.getUploadAsync(this.deploymentUrl, this.uploadId, true, false)\n    this.timestamp = uploadStoreObj.upload?.complete_time\n    this.editable = uploadStoreObj.isEditable\n    await this.fetchData()\n  }\n  cleanup() {\n    delete this.data\n  }\n  async fetchData() {\n    const encodedPath = urlEncodePath(this.path)\n    if (this.deploymentUrl !== apiBase) throw new Error('Fetching directory data from external source is not yet supported')\n    const response = await this.api.get(`/uploads/${this.uploadId}/rawdir/${encodedPath}?include_entry_info=true&page_size=${this.page_size}&page=${this.lastPage}`)\n    const elementsByName = this.data?.elementsByName || {}\n    response.directory_metadata.content.forEach(element => { elementsByName[element.name] = element })\n    const directory_metadata = this.data?.directory_metadata\n      ? this?.data?.directory_metadata.concat(response.directory_metadata.content)\n      : response.directory_metadata.content\n    const total = response.pagination.total\n    this.data = {directory_metadata, elementsByName, total}\n  }\n  async itemAdaptor(key) {\n    if (key === '_mainfile') {\n      key = this.highlightedItem\n    }\n    const extendedUrl = urlJoin(this.uploadUrl, encodeURIComponent(key))\n    let element = this.data?.elementsByName[key]\n    while (!element && this.lastPage * this.page_size < this.data.total) {\n      const data = await this.scrollToNextPage()\n      element = data?.elementsByName[key]\n    }\n    if (element) {\n      if (element.is_file) {\n        return new RawFileAdaptor(extendedUrl, element, this.editable)\n      } else {\n        return new RawDirectoryAdaptor(extendedUrl, key, null)\n      }\n    }\n    throw new Error('Bad path: ' + key)\n  }\n\n  async scrollToNextPage() {\n    if (this.data?.total && this.lastPage * this.page_size < this.data.total) {\n      this.lastPage = this.lastPage + 1\n      await this.fetchData()\n      return this.data\n    }\n  }\n\n  async onScrollToEnd(event, updateLane) {\n    const data = await this.scrollToNextPage()\n    if (data) {\n      updateLane()\n    }\n  }\n\n  async onRendered(event, updateLane) {\n    if (event.target.scrollHeight * 95 / 100 <= event.target.clientHeight) {\n      const data = await this.scrollToNextPage()\n      if (data) {\n        updateLane()\n      }\n    }\n  }\n\n  render() {\n    return <RawDirectoryContent\n      deploymentUrl={this.deploymentUrl} uploadId={this.uploadId} path={this.path}\n      title={this.title} highlightedItem={this.highlightedItem}\n      editable={this.editable}/>\n  }\n}\n\nexport const CustomDropZone = React.memo((props) => {\n  const {children, onDrop, classNameNormal, classNameActive, ...otherProps} = props\n  const [active, setActive] = useState(false)\n  const dragTargetsRef = useRef([])\n\n  const onDragEnter = useCallback(e => {\n    e.preventDefault()\n    e.stopPropagation()\n    dragTargetsRef.current.push(e.target)\n    setActive(true)\n  }, [setActive])\n\n  const onDragLeave = useCallback(e => {\n    e.preventDefault()\n    e.stopPropagation()\n    const targets = dragTargetsRef.current\n    const targetIdx = targets.indexOf(e.target)\n    if (targetIdx !== -1) {\n      targets.splice(targetIdx, 1)\n      dragTargetsRef.current = targets\n    }\n    if (!targets.length) {\n      setActive(false)\n    }\n  }, [setActive])\n\n  const onDragOver = useCallback(e => {\n    e.preventDefault()\n    e.stopPropagation()\n  }, [])\n\n  const onDropped = useCallback(e => {\n    e.preventDefault()\n    e.stopPropagation()\n    setActive(false)\n    dragTargetsRef.current = []\n    onDrop(e)\n  }, [onDrop, setActive])\n\n  return <div\n    className={active ? classNameActive : classNameNormal}\n    onDragEnter={onDragEnter}\n    onDragLeave={onDragLeave}\n    onDragOver={onDragOver}\n    onDrop={onDropped}\n    {...otherProps}\n  >\n    {children}\n  </div>\n})\nCustomDropZone.propTypes = {\n  children: PropTypes.any,\n  onDrop: PropTypes.func,\n  classNameNormal: PropTypes.string.isRequired,\n  classNameActive: PropTypes.string.isRequired\n}\n\nconst useRawDirectoryContentStyles = makeStyles(theme => ({\n  dropzoneLane: {\n    width: '100%',\n    minHeight: '100%'\n  },\n  dropzoneTop: {\n    width: '100%',\n    margin: 0,\n    padding: 0\n  },\n  dropzoneActive: {\n    width: '100%',\n    minHeight: '100%',\n    backgroundColor: theme.palette.grey[300]\n  }\n}))\nfunction RawDirectoryContent({deploymentUrl, uploadId, path, title, highlightedItem, editable}) {\n  const classes = useRawDirectoryContentStyles()\n  const dataStore = useDataStore()\n  const entryPageMainFile = useEntryStore()?.metadata?.mainfile // Will be set if we're on an entry page\n  const browser = useContext(browserContext)\n  const lane = useContext(laneContext)\n  const history = useHistory()\n  const encodedPath = urlEncodePath(path)\n  const { api } = useApi()\n  const [openConfirmDeleteDirDialog, setOpenConfirmDeleteDirDialog] = useState(false)\n  const [openCreateDirDialog, setOpenCreateDirDialog] = useState(false)\n  const [openCopyMoveDialog, setOpenCopyMoveDialog] = useState(false)\n  const [openDuplicateDialog, setOpenDuplicateDialog] = useState(false)\n  const [fileName, setFileName] = useState('')\n  const copyFileName = useRef()\n  const createDirName = useRef()\n  const { raiseError } = useErrors()\n\n  const refreshIfNeeded = useCallback(async (oldStoreObj, newStoreObj) => {\n    // Called when a store update occurs. Note, adaptors can be cached while the browser & lanes\n    // components are unmounted.\n    if (newStoreObj.hasUpload) {\n      const oldTimestamp = lane.adaptor.timestamp // Timestamp from the store the last time we called initialize\n      const newTimestamp = newStoreObj.upload?.complete_time // Current timestamp from the store\n      if (!lane.adaptor.initialized) {\n        // No need to initiate a new refresh, just update the adaptor timestamp\n        lane.adaptor.timestamp = newTimestamp\n        lane.adaptor.initialized = true\n      } else if (newTimestamp !== oldTimestamp && !newStoreObj.isProcessing) {\n        // Reprocessed\n        browser.invalidateLanesWithDependency(uploadId)\n      }\n    }\n  }, [browser, lane, uploadId])\n\n  useEffect(() => {\n    refreshIfNeeded(undefined, dataStore.getUpload(deploymentUrl, uploadId))\n    return dataStore.subscribeToUpload(deploymentUrl, uploadId, refreshIfNeeded, true, false)\n  }, [dataStore, deploymentUrl, uploadId, refreshIfNeeded])\n\n  const handleDropFiles = useCallback((files) => {\n    // Handles dropping files (not links)\n    const formData = new FormData() // eslint-disable-line no-undef\n    for (const file of files) {\n      formData.append('file', file)\n    }\n    api.put(`/uploads/${uploadId}/raw/${encodedPath}`, formData)\n      .then(response => dataStore.updateUpload(deploymentUrl, uploadId, {upload: response.data}))\n      .catch(error => raiseError(error))\n  }, [deploymentUrl, uploadId, encodedPath, raiseError, api, dataStore])\n\n  const handleDrop = useCallback(async (e) => {\n    // Handles dropping files and links\n    const files = await fromEvent(e)\n    const _filePath = e.dataTransfer?.getData('URL')\n    if (files.length) { // files are being transferred\n      handleDropFiles(files)\n    } else if (_filePath) {\n      if (_filePath.includes('/files/') &&\n      _filePath.includes(history.location.pathname.split('files')[0])) {\n        setFileName(_filePath.slice(_filePath.indexOf('files')).split('/').slice(1).join('/'))\n        setOpenCopyMoveDialog(true)\n      }\n    }\n  }, [history.location.pathname, handleDropFiles, setFileName, setOpenCopyMoveDialog])\n\n  const handleCopyMoveFile = (e) => {\n    setOpenCopyMoveDialog(false)\n    setOpenDuplicateDialog(false)\n    api.put(`/uploads/${uploadId}/raw/${encodedPath}?copy_or_move=${e.moveFile}&copy_or_move_source_path=${fileName}&file_name=${copyFileName.current.value}`)\n      .then(response => dataStore.updateUpload(deploymentUrl, uploadId, {upload: response.data}))\n      .catch(error => raiseError(error))\n  }\n\n  const handleCreateDir = () => {\n    setOpenCreateDirDialog(false)\n    const dirName = createDirName.current.value\n    if (dirName) {\n      const fullPath = urlJoin(encodedPath, encodeURIComponent(dirName))\n      api.post(`/uploads/${uploadId}/raw-create-dir/${fullPath}`)\n        .then(response => dataStore.updateUpload(deploymentUrl, uploadId, {upload: response.data}))\n        .catch(raiseError)\n    }\n  }\n\n  const handleDeleteDir = () => {\n    setOpenConfirmDeleteDirDialog(false)\n    api.delete(`/uploads/${uploadId}/raw/${encodedPath}`)\n      .then(response => {\n        if (typeof mainfile === 'string' && (path === '' || entryPageMainFile === path || entryPageMainFile.startsWith(path + '/'))) {\n          // This will delete the current entry - go to upload overview page\n          history.push(`/user/uploads/upload/id/${uploadId}`)\n        } else {\n          const gotoLane = lane.index > 0 ? lane.index - 1 : 0\n          history.push(browser.lanes.current[gotoLane].path)\n        }\n        dataStore.updateUpload(deploymentUrl, uploadId, {upload: response.data})\n      })\n      .catch(raiseError)\n  }\n\n  const { getRootProps, getInputProps } = useDropzone({onDrop: handleDropFiles})\n\n  if (!lane.adaptor.data) {\n    return <Content key={path}><Typography>loading ...</Typography></Content>\n  } else {\n    // Data loaded\n    const downloadUrl = `uploads/${uploadId}/raw/${encodedPath}?compress=true` // TODO: deploymentUrl need to be considered for external uploads\n    return (\n      <CustomDropZone onDrop={handleDrop} classNameNormal={classes.dropzoneLane} classNameActive={classes.dropzoneActive}>\n        <Content key={path}>\n          <Title\n            title={title}\n            label=\"folder\"\n            tooltip={path}\n            actions={\n              <Grid container justifyContent=\"space-between\" wrap=\"nowrap\" spacing={1}>\n                <Grid item>\n                  <IconButton size=\"small\" onClick={() => setOpenDuplicateDialog(true)} disabled={!editable || fileName === \"\"}>\n                    <Tooltip title=\"duplicate file\">\n                      <FileCopyIcon />\n                    </Tooltip>\n                  </IconButton>\n                  <Dialog\n                      open={openDuplicateDialog}\n                      onClose={() => setOpenDuplicateDialog(false)}\n                    >\n                      <DialogContent>\n                        <DialogContentText>Duplicate <b>{fileName}</b>:</DialogContentText>\n                        <TextField\n                          fullWidth\n                          placeholder='Provide a name'\n                          autoFocus\n                          inputRef={copyFileName}\n                          defaultValue={`(Copy) ${fileName.split('/').splice(-1)}`}\n                        />\n                      </DialogContent>\n                      <DialogActions>\n                        <Button onClick={() => setOpenDuplicateDialog(false)}>Cancel</Button>\n                        <Button onClick={(e) => handleCopyMoveFile({...e, moveFile: 'copy'})}>Duplicate</Button>\n                      </DialogActions>\n                    </Dialog>\n                </Grid>\n                <Grid item>\n                  <IconButton size=\"small\" onClick={() => browser.invalidateLanesFromIndex(lane.index)}>\n                    <Tooltip title=\"reload directory contents\">\n                      <ReloadIcon/>\n                    </Tooltip>\n                  </IconButton>\n                </Grid>\n                <Grid item>\n                  <Download\n                    component={IconButton} disabled={false} size=\"small\"\n                    tooltip=\"download this folder\"\n                    url={downloadUrl}\n                  >\n                    <DownloadIcon />\n                  </Download>\n                </Grid>\n                {\n                  editable &&\n                    <Grid item>\n                      <div {...getRootProps()}>\n                        <input {...getInputProps()} />\n                        <IconButton size=\"small\">\n                          <Tooltip title=\"upload to this folder (click or drop files)\">\n                            <UploadIcon/>\n                          </Tooltip>\n                        </IconButton>\n                      </div>\n                    </Grid>\n                }\n                {\n                  editable &&\n                    <Grid item>\n                      <IconButton size=\"small\" onClick={() => setOpenCreateDirDialog(true)}>\n                        <Tooltip title=\"create new folder\">\n                          <CreateNewFolderIcon />\n                        </Tooltip>\n                      </IconButton>\n                      <Dialog\n                        open={openCreateDirDialog}\n                        onClose={() => setOpenCreateDirDialog(false)}\n                      >\n                        <DialogContent>\n                          <DialogContentText>Name of new directory:</DialogContentText>\n                          <TextField\n                            autoFocus\n                            inputRef={createDirName}\n                            onKeyDown={(event) => {\n                              if (event.key === 'Enter') {\n                                handleCreateDir()\n                              }\n                            }}/>\n                        </DialogContent>\n                        <DialogActions>\n                          <Button onClick={() => setOpenCreateDirDialog(false)}>Cancel</Button>\n                          <Button onClick={() => handleCreateDir()}>OK</Button>\n                        </DialogActions>\n                      </Dialog>\n                    </Grid>\n                }\n                {\n                  editable &&\n                    <Dialog\n                      open={openCopyMoveDialog}\n                      onClose={() => setOpenCopyMoveDialog(false)}\n                    >\n                      <DialogContent>\n                        <DialogContentText>Copy/move <b>{fileName}</b>:</DialogContentText>\n                        <TextField\n                          fullWidth\n                          placeholder='Provide a name'\n                          autoFocus\n                          inputRef={copyFileName}\n                          defaultValue={fileName.split('/').splice(-1)}\n                        />\n                      </DialogContent>\n                      <DialogActions>\n                        <Button onClick={() => setOpenCopyMoveDialog(false)}>Cancel</Button>\n                        <Button onClick={(e) => handleCopyMoveFile({...e, moveFile: 'copy'})}>Copy</Button>\n                        <Button onClick={(e) => handleCopyMoveFile({...e, moveFile: 'move'})}>Move</Button>\n                      </DialogActions>\n                    </Dialog>\n                }\n                {\n                  editable &&\n                    <Grid item>\n                      <IconButton size=\"small\" onClick={() => setOpenConfirmDeleteDirDialog(true)}>\n                        <Tooltip title=\"delete this folder\">\n                          <DeleteIcon />\n                        </Tooltip>\n                      </IconButton>\n                      <Dialog\n                        open={openConfirmDeleteDirDialog}\n                        onClose={() => setOpenConfirmDeleteDirDialog(false)}\n                      >\n                        <DialogContent>\n                          <DialogContentText>Really delete the directory <b>{path}</b>?</DialogContentText>\n                        </DialogContent>\n                        <DialogActions>\n                          <Button onClick={() => setOpenConfirmDeleteDirDialog(false)} autoFocus>Cancel</Button>\n                          <Button onClick={handleDeleteDir}>OK</Button>\n                        </DialogActions>\n                      </Dialog>\n                    </Grid>\n                }\n              </Grid>\n            }\n          />\n          <Compartment>\n            {\n              lane.adaptor.data.directory_metadata.map(element => (\n                <span key={element.name} onClick={() => setFileName(element.name)}>\n                  <Item\n                    icon={element.is_file ? (element.parser_name ? RecognizedFileIcon : FileIcon) : FolderIcon}\n                    itemKey={element.name} key={urlJoin(path, element.name)}\n                    highlighted={element.name === highlightedItem}\n                    chip={element.parser_name && element.parser_name.replace('parsers/', '').replace('archive', 'nomad')}\n                  >\n                    {element.name}\n                  </Item>\n                </span>\n              ))\n            }\n          </Compartment>\n        </Content>\n      </CustomDropZone>\n    )\n  }\n}\nRawDirectoryContent.propTypes = {\n  deploymentUrl: PropTypes.string.isRequired,\n  uploadId: PropTypes.string.isRequired,\n  path: PropTypes.string.isRequired,\n  title: PropTypes.string.isRequired,\n  highlightedItem: PropTypes.string,\n  editable: PropTypes.bool.isRequired\n}\n\nexport class RawFileAdaptor extends Adaptor {\n  /**\n   * Constructs an adaptor for a file lane. Note, data is optional, if not provided it will\n   * be fetched in initialize.\n   */\n  constructor(uploadUrl, data, editable) {\n    super()\n    const parsedUrl = parseNomadUrl(uploadUrl)\n    if (parsedUrl.type !== refType.upload) throw new Error(`Expected an upload url, got ${uploadUrl}`)\n    if (!parsedUrl.isResolved) throw new Error(`Absolute url required, got ${uploadUrl}`)\n    this.deploymentUrl = parsedUrl.deploymentUrl\n    this.uploadId = parsedUrl.uploadId\n    this.path = parsedUrl.path\n    this.data = data\n    this.editable = editable\n    this.dependencies = new Set([this.uploadId])\n  }\n  depends() {\n    return this.dependencies\n  }\n  async initialize(api, dataStore) {\n    this.dataStore = dataStore\n    if (!this.data) {\n      const response = await api.get(`uploads/${this.uploadId}/rawdir/${this.path}`)\n      this.data = response.file_metadata\n    }\n  }\n  async itemAdaptor(key) {\n    if (key === 'archive') {\n      const archiveUrl = createEntryUrl(this.deploymentUrl, this.uploadId, this.data.entry_id)\n      const {archive} = await this.dataStore.getEntryAsync(this.deploymentUrl, this.data.entry_id, false, '*')\n      const metainfo = await this.dataStore.getMetainfoAsync(systemMetainfoUrl)\n      const rootSectionDef = metainfo.getEntryArchiveDefinition()\n      return archiveAdaptorFactory(archiveUrl, archive, rootSectionDef)\n    } else if (key === 'preview') {\n      return new FilePreviewAdaptor(this.uploadId, this.path, this.data)\n    }\n  }\n  render() {\n    return <RawFileContent\n      deploymentUrl={this.deploymentUrl} uploadId={this.uploadId} path={this.path}\n      data={this.data} editable={this.editable} key={this.path}/>\n  }\n}\n\nclass FilePreviewAdaptor extends Adaptor {\n  constructor(uploadId, path, data) {\n    super()\n    this.uploadId = uploadId\n    this.path = path\n    this.data = data\n  }\n  render() {\n    return <Box minWidth={'300px'} maxWidth={'1200px'} width=\"100%\">\n      <FilePreview uploadId={this.uploadId} path={this.path} size={this.data?.size}/>\n    </Box>\n  }\n}\n\nfunction RawFileContent({deploymentUrl, uploadId, path, data, editable}) {\n  const entryPageMainFile = useEntryStore()?.metadata?.mainfile // Will be set if we're on an entry page\n  const browser = useContext(browserContext)\n  const lane = useContext(laneContext)\n  const history = useHistory()\n  const dataStore = useDataStore()\n  const { api } = useApi()\n  const { raiseError } = useErrors()\n  const [openConfirmDeleteFileDialog, setOpenConfirmDeleteFileDialog] = useState(false)\n  const encodedPath = urlEncodePath(path)\n  const downloadUrl = `uploads/${uploadId}/raw/${encodedPath}?ignore_mime_type=true` // TODO: deploymentUrl need to be considered for external uploads\n  const allNorthTools = useTools()\n  const applicableNorthTools = useMemo(() => {\n    if (!allNorthTools || typeof allNorthTools !== 'object' || Object.keys(allNorthTools).length < 1) {\n      return []\n    }\n    const fileExtension = path.split('.').pop().toLowerCase()\n    return Object.keys(allNorthTools)\n      .filter(key => {\n        const tool = allNorthTools[key]\n        return tool?.file_extensions && tool.file_extensions.includes(fileExtension)\n      })\n  }, [allNorthTools, path])\n\n  // If we are stepping into an archive, subscribe to the store for updates on this archive\n  const archiveSelected = data.entry_id && lane.next?.key === 'archive'\n  const entryStoreObj = useEntryStoreObj(archiveSelected ? deploymentUrl : null, data.entry_id, false, '*')\n\n  // Invalidate subsequent lanes if the archive is updated\n  useEffect(() => {\n    if (entryStoreObj?.archive && lane.next?.adaptor?.obj) {\n      if (entryStoreObj.archive !== lane.next.adaptor?.obj) {\n        browser.invalidateLanesFromIndex(lane.index)\n      }\n    }\n  }, [browser, lane, entryStoreObj])\n\n  const handleDeleteFile = () => {\n    setOpenConfirmDeleteFileDialog(false)\n    api.delete(`/uploads/${uploadId}/raw/${encodedPath}`)\n      .then(response => {\n        if (path === entryPageMainFile) {\n          // Deleting the main entry - go to upload overview page\n          history.push(`/user/uploads/upload/id/${uploadId}`)\n        } else {\n          const gotoLane = lane.index > 0 ? lane.index - 1 : 0\n          history.push(browser.lanes.current[gotoLane].path)\n        }\n        dataStore.updateUpload(deploymentUrl, uploadId, {upload: response.data})\n      })\n      .catch(raiseError)\n  }\n\n  // A nicer, human-readable size string\n  let niceSize, unit, factor\n  if (data.size > 1e9) {\n    [unit, factor] = ['GB', 1e9]\n  } else if (data.size > 1e6) {\n    [unit, factor] = ['MB', 1e6]\n  } else if (data.size > 1e3) {\n    [unit, factor] = ['kB', 1e3]\n  }\n  if (unit) {\n    if (data.size / factor > 100) {\n      // No decimals\n      niceSize = `${Math.round(data.size / factor)} ${unit} (${data.size} bytes)`\n    } else {\n      // One decimal\n      niceSize = `${Math.round(data.size * 10 / factor) / 10} ${unit} (${data.size} bytes)`\n    }\n  } else {\n    // Unit = bytes\n    niceSize = `${data.size} bytes`\n  }\n\n  return (\n    <Content\n      key={path}\n      display=\"flex\" flexDirection=\"column\" height=\"100%\"\n      paddingBottom={0} maxWidth=\"initial\"\n    >\n      <Title\n        title={data.name}\n        label=\"file\"\n        tooltip={path}\n        actions={\n          <Grid container justifyContent=\"space-between\" wrap=\"nowrap\" spacing={1}>\n            {data.entry_id && (\n              <Grid item>\n                <EntryButton entryId={data.entry_id} component={IconButton} size=\"small\">\n                  <NavigateIcon />\n                </EntryButton>\n              </Grid>\n            )}\n            <Grid item>\n              <Download\n                component={IconButton} disabled={false} size=\"small\"\n                tooltip=\"download this file\"\n                url={downloadUrl}\n              >\n                <DownloadIcon />\n              </Download>\n            </Grid>\n            {\n              editable &&\n                <Grid item>\n                  <IconButton size=\"small\" onClick={() => setOpenConfirmDeleteFileDialog(true)}>\n                    <Tooltip title=\"delete this file\">\n                      <DeleteIcon />\n                    </Tooltip>\n                  </IconButton>\n                  <Dialog\n                    open={openConfirmDeleteFileDialog}\n                    onClose={() => setOpenConfirmDeleteFileDialog(false)}\n                  >\n                    <DialogContent>\n                      <DialogContentText>Really delete the file <b>{data.name}</b>?</DialogContentText>\n                    </DialogContent>\n                    <DialogActions>\n                      <Button onClick={() => setOpenConfirmDeleteFileDialog(false)} autoFocus>Cancel</Button>\n                      <Button onClick={handleDeleteFile}>OK</Button>\n                    </DialogActions>\n                  </Dialog>\n                </Grid>\n            }\n          </Grid>\n        }\n      />\n      <Compartment>\n        <Quantity quantity=\"filesize\" data={{filesize: niceSize}} label=\"file size\" />\n        {data.parser_name && (\n          <Quantity quantity=\"parser\" data={{parser: data.parser_name}} />\n        )}\n        {data.entry_id && (\n          <Quantity quantity=\"entryId\" data={{entryId: data.entry_id}} noWrap withClipboard />\n        )}\n      </Compartment>\n      <Compartment>\n        {data.entry_id && (\n          <Item itemKey=\"archive\">\n            <Typography>processed data</Typography>\n          </Item>\n        )}\n        <Item itemKey=\"preview\">\n          <Typography>preview</Typography>\n        </Item>\n        {applicableNorthTools.length > 0 && (\n          <NorthLaunchButton uploadId={uploadId} path={path} tools={applicableNorthTools} />\n        )}\n      </Compartment>\n    </Content>)\n}\nRawFileContent.propTypes = {\n  deploymentUrl: PropTypes.string.isRequired,\n  uploadId: PropTypes.string.isRequired,\n  path: PropTypes.string.isRequired,\n  data: PropTypes.object.isRequired,\n  editable: PropTypes.bool.isRequired\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useRef, useLayoutEffect, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { FixedSizeGrid as Grid } from 'react-window'\nimport { Typography, makeStyles, Button, Grid as MuiGrid, Box } from '@material-ui/core'\nimport AutoSizer from 'react-virtualized-auto-sizer'\n\nexport function Number({value, exp, variant, unit, ...props}) {\n  variant = variant || 'body2'\n  exp = exp || 2\n  const fixed = 5\n  let html = '-'\n  if (value !== undefined && value !== null) {\n    if (typeof value === 'number') {\n      const str = value.toExponential(exp)\n      const [f, e] = str.split('e')\n      if (e <= fixed && e >= -fixed) {\n        html = value.toFixed(fixed).replace(/[.,]0*$/, '')\n      } else {\n        html = <span>{f.toString().replace(/0*$/, '')}&middot;10<sup>{e}</sup></span>\n      }\n    } else {\n      html = value.toString()\n    }\n  }\n  return <Typography {...props} variant={variant} data-testid=\"scientific-number-with-unit\">{html}{unit && <span>&nbsp;{unit}</span>}</Typography>\n}\nNumber.propTypes = ({\n  value: PropTypes.any,\n  variant: PropTypes.string,\n  exp: PropTypes.number,\n  unit: PropTypes.string\n})\n\nfunction MatrixPagination({length, page, onChange}) {\n  return <MuiGrid\n    spacing={2}\n    container\n    direction=\"row\"\n    justifyContent=\"center\"\n    alignItems=\"center\"\n  >\n    <MuiGrid item>\n      <Button disabled={page === 0} size=\"small\" onClick={() => onChange(page - 1)}>\n        prev\n      </Button>\n    </MuiGrid>\n    <MuiGrid item>\n      <Typography>{page}</Typography>\n    </MuiGrid>\n    <MuiGrid item>\n      <Button size=\"small\" disabled={page + 1 === length} onClick={() => onChange(page + 1)}>\n      next\n      </Button>\n    </MuiGrid>\n  </MuiGrid>\n}\nMatrixPagination.propTypes = ({\n  length: PropTypes.number.isRequired,\n  page: PropTypes.number.isRequired,\n  onChange: PropTypes.func.isRequired\n})\n\nconst useMatrixStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex',\n    flexDirection: 'row',\n    alignItems: 'stretch',\n    minWidth: 300,\n    justifyContent: 'center'\n  },\n  leftBracket: {\n    width: theme.spacing(1),\n    border: 'solid 2px black',\n    borderRight: 'none',\n    marginRight: -theme.spacing(1)\n  },\n  matrix: {\n    width: '100%'\n  },\n  rightBracket: {\n    width: theme.spacing(1),\n    border: 'solid 2px black',\n    borderLeft: 'none',\n    marginLeft: -theme.spacing(1)\n  }\n}))\nexport function Matrix({values, shape, invert, type}) {\n  const rootRef = useRef()\n  const matrixRef = useRef()\n  const [pages, setPages] = useState(new Array(Math.max(0, shape.length - 2)).fill(0))\n  const pageLengths = []\n  const classes = useMatrixStyles()\n\n  let ii = 0\n  for (let i = shape.length; i > 2; i--) {\n    pageLengths.push(values.length)\n    values = values[pages[ii++]]\n  }\n\n  const columnWidth = useRef(92)\n  const rowHeight = 24\n  const rowCount = invert ? values.length : shape.length > 1 ? values[0].length : 1\n  const columnCount = invert ? shape.length > 1 ? values[0].length : 1 : values.length\n  const height = Math.min(300, (rowCount - 1) * rowHeight + 24)\n\n  useLayoutEffect(() => {\n    if (type === 'str') {\n      matrixRef.current.style.width = '100%'\n    } else {\n      matrixRef.current.style.width = `${rootRef.current.clientWidth - 4}px`\n    }\n    columnWidth.current = Math.max(92, (rootRef.current.clientWidth - 4) / columnCount)\n  })\n\n  let value = shape.length > 1 ? ({rowIndex, columnIndex}) => values[columnIndex][rowIndex] : ({columnIndex}) => values[columnIndex]\n  if (invert) {\n    value = shape.length > 1 ? ({rowIndex, columnIndex}) => values[rowIndex][columnIndex] : ({rowIndex}) => values[rowIndex]\n  }\n\n  return <React.Fragment>\n    <div ref={rootRef} className={classes.root}>\n      <div className={classes.leftBracket} style={{height: height}}>&nbsp;</div>\n      <div ref={matrixRef} className={classes.matrix}>\n        <AutoSizer>\n          {({width}) => (\n            <Grid\n              columnCount={columnCount}\n              columnWidth={columnWidth.current}\n              height={height}\n              rowCount={rowCount}\n              rowHeight={rowHeight}\n              width={width}\n            >\n              {({style, ...props}) => <Number style={{whiteSpace: 'nowrap', ...style}} value={value(props)} />}\n            </Grid>\n          )}\n        </AutoSizer>\n      </div>\n      <div className={classes.rightBracket} style={{height: height}}>&nbsp;</div>\n    </div>\n    {pages.map((page, index) => <Box margin={1} key={index}>\n      <MatrixPagination\n        length={pageLengths[index]} page={page}\n        onChange={(page) => setPages([...pages.slice(0, index), page, ...pages.slice(index + 1)])}\n      />\n    </Box>)}\n  </React.Fragment>\n}\nMatrix.propTypes = ({\n  values: PropTypes.array.isRequired,\n  shape: PropTypes.arrayOf(PropTypes.any).isRequired,\n  invert: PropTypes.bool,\n  type: PropTypes.string\n})\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useState, useEffect, useRef, useCallback } from 'react'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\nimport { Typography } from '@material-ui/core'\nimport {\n  Fullscreen,\n  FullscreenExit,\n  CameraAlt,\n  Replay\n} from '@material-ui/icons'\nimport { BrillouinZoneViewer } from '@lauri-codes/materia'\nimport Floatable from './Floatable'\nimport NoData from './NoData'\nimport Placeholder from '../visualization/Placeholder'\nimport { scale, distance } from '../../utils'\nimport { withErrorHandler, withWebGLErrorHandler } from '../ErrorHandler'\nimport { Actions, Action } from '../Actions'\n\n/**\n * Interactive 3D Brillouin zone viewer based on the 'materia'-library.\n */\nexport const bzError = 'Could not load Brillouin zone.'\nconst fitMargin = 0.06\nconst useStyles = makeStyles((theme) => {\n  return {\n    root: {},\n    column: {\n      display: 'flex',\n      width: '100%',\n      height: '100%',\n      flexDirection: 'column'\n    },\n    header: {\n      paddingRight: theme.spacing(1),\n      display: 'flex',\n      flexDirection: 'row',\n      zIndex: 1\n    },\n    canvas: {\n      flex: 1,\n      zIndex: 0,\n      minHeight: 0, // added min-height: 0 to allow the item to shrink to fit inside the container.\n      marginBottom: theme.spacing(2)\n    }\n  }\n})\nconst BrillouinZone = React.memo(({\n  className,\n  classes,\n  data,\n  captureName,\n  'data-testid': testID\n}) => {\n  const [fullscreen, setFullscreen] = useState(false)\n  const [loading, setLoading] = useState(true)\n  const refViewer = useRef(null)\n  const styles = useStyles(classes)\n\n  // In order to properly detect changes in a reference, a reference callback is\n  // used. This is the recommended way to monitor reference changes as a simple\n  // useRef is not guaranteed to update:\n  // https://reactjs.org/docs/hooks-faq.html#how-can-i-measure-a-dom-node\n  const refCanvas = useCallback(node => {\n    if (node === null) {\n      return\n    }\n    if (refViewer.current === null) {\n      return\n    }\n    refViewer.current.changeHostElement(node)\n    refViewer.current.fit(fitMargin)\n    refViewer.current.render()\n  }, [])\n\n  // Run only on first render to initialize the viewer.\n  const theme = useTheme()\n  useEffect(() => {\n    if (!data || refViewer.current) {\n      return\n    }\n    refViewer.current = new BrillouinZoneViewer(undefined)\n  }, [data])\n\n  // Called only on first render to load the given structure.\n  useEffect(() => {\n    if (!data) {\n      return\n    }\n\n    // Format data from section_k_band into the form used by the viewer\n    const basis = scale(data.reciprocal_cell, 1E-10)\n    const kpoints = []\n    const segments = []\n    const finalData = {\n      basis: basis,\n      kpoints: kpoints,\n      segments: segments\n    }\n    let previousPoint\n    let segment = []\n    for (const seg of data.segment) {\n      const labels = seg.endpoints_labels\n      const start = seg.kpoints[0]\n      const end = seg.kpoints.slice(-1)[0]\n      if (!previousPoint || (previousPoint && distance(start, previousPoint) >= 1e-8)) {\n        // Push old segment\n        if (segment.length > 0) {\n          segments.push(segment)\n        }\n        // Start new segment\n        segment = []\n        segment.push(start)\n        if (labels !== undefined) {\n          kpoints.push([labels[0], start])\n        }\n      }\n      segment.push(end)\n      if (labels !== undefined) {\n        kpoints.push([labels[1], end])\n      }\n      previousPoint = end\n    }\n    // Push last segment\n    segments.push(segment)\n\n    const options = {\n      basis: {\n        font: 'Titillium Web,sans-serif',\n        offset: 0.025,\n        size: 0.04,\n        a: { color: '#f44336' },\n        b: { color: '#4caf50' },\n        c: { color: '#5c6bc0' }\n      },\n      segments: {\n        color: theme.palette.primary.main\n      },\n      faces: {\n        outline: {\n          width: 0.002\n        }\n      },\n      kpoints: {\n        label: {\n          color: theme.palette.primary.main,\n          font: 'Titillium Web,sans-serif',\n          size: 0.035\n        },\n        point: {\n          color: theme.palette.primary.main,\n          size: 0.01\n        }\n      }\n    }\n\n    // Load data into viewer\n    refViewer.current.load(finalData, options)\n    refViewer.current.setRotation([1, 0, 0, 0])\n    refViewer.current.align([\n      ['up', 'a'],\n      ['front', 'segments']\n    ])\n    refViewer.current.rotate([\n      [0, 1, 0, 45],\n      [1, 0, 0, 25]\n    ])\n    refViewer.current.controls({resetOnDoubleClick: false, pan: {enabled: false}})\n    refViewer.current.fit(fitMargin)\n    refViewer.current.render()\n    refViewer.current.saveCameraReset()\n    setLoading(false)\n  }, [data, theme])\n\n  const toggleFullscreen = useCallback(() => {\n    setFullscreen(!fullscreen)\n  }, [fullscreen])\n\n  const takeScreencapture = useCallback(() => {\n    refViewer.current.takeScreenShot(captureName)\n  }, [captureName])\n\n  const handleReset = useCallback(() => {\n    refViewer.current.resetCamera()\n    refViewer.current.fit(fitMargin)\n    refViewer.current.render()\n  }, [])\n\n  // If data is set explicitly to false, we show the NoData component.\n  if (data === false) {\n    return <NoData className={clsx(className, styles.root)}/>\n  }\n\n  if (loading) {\n    return <Placeholder\n      variant=\"rect\"\n      className={clsx(className, styles.root)}\n      data-testid={`${testID}-placeholder`}\n    />\n  }\n\n  return <Floatable\n    data-testid={testID}\n    className={clsx(styles.root, className)}\n    float={fullscreen}\n    onFloat={toggleFullscreen}\n  >\n    <div className={styles.column}>\n      {fullscreen && <Typography variant=\"h6\">Brillouin zone</Typography>}\n      <div className={styles.canvas} ref={refCanvas}/>\n      <div className={styles.header}>\n        <Actions>\n          <Action tooltip='Reset view' onClick={handleReset}>\n            <Replay/>\n          </Action>\n          <Action tooltip='Toggle fullscreen' onClick={toggleFullscreen}>\n            {fullscreen ? <FullscreenExit/> : <Fullscreen/>}\n          </Action>\n          <Action tooltip='Capture image' onClick={takeScreencapture}>\n            <CameraAlt/>\n          </Action>\n        </Actions>\n      </div>\n    </div>\n  </Floatable>\n})\n\nBrillouinZone.propTypes = {\n  data: PropTypes.oneOfType([\n    PropTypes.shape({\n      reciprocal_cell: PropTypes.array.isRequired, // Reciprocal cell in SI units\n      segment: PropTypes.array.isRequired // Array of section_k_band_segments in SI units\n    }),\n    PropTypes.oneOf([false, undefined]) // False for NoData, undefined for Placeholder\n  ]),\n  captureName: PropTypes.string, // Name of the file that the user can download\n  classes: PropTypes.object,\n  className: PropTypes.string,\n  'data-testid': PropTypes.string\n}\nBrillouinZone.defaultProps = {\n  captureName: 'brillouin_zone'\n}\n\nexport default withWebGLErrorHandler(withErrorHandler(bzError)(BrillouinZone))\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useState, useLayoutEffect, useMemo, useRef, useCallback, forwardRef, useImperativeHandle, useEffect} from 'react'\nimport PropTypes from 'prop-types'\nimport { useResizeDetector } from 'react-resize-detector'\nimport { isNil, isEmpty, cloneDeep } from 'lodash'\nimport { useHistory } from 'react-router-dom'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\nimport {\n  Typography,\n  Box,\n  Tooltip\n} from '@material-ui/core'\nimport {\n  CameraAlt,\n  Fullscreen,\n  FullscreenExit,\n  Replay,\n  ViewList,\n  Warning\n} from '@material-ui/icons'\nimport Floatable from '../visualization/Floatable'\nimport Placeholder from '../visualization/Placeholder'\nimport NoData from '../visualization/NoData'\nimport { Actions, Action } from '../Actions'\nimport Plotly from 'plotly.js-dist-min'\nimport clsx from 'clsx'\nimport { mergeObjects } from '../../utils'\n\n/**\n * Component that produces a highly customized Plotly.js graph. We are using the\n * vanilla JS Plotly library to achieve the most customizability.\n */\nconst useStyles = makeStyles((theme) => {\n  return {\n    root: {\n      width: '100%',\n      height: '100%',\n      position: 'relative'\n    },\n    footer: {\n      paddingRight: theme.spacing(1),\n      display: 'flex',\n      flexDirection: 'row',\n      zIndex: 1\n    },\n    container: {\n      position: 'relative',\n      width: '100%',\n      height: '100%'\n    },\n    content: {\n      position: 'absolute',\n      left: 0,\n      right: 0,\n      top: 0,\n      bottom: 0,\n      display: 'flex',\n      flexDirection: 'column'\n    },\n    canvasContainer: {\n      flex: 1,\n      minHeight: 0 // added min-height: 0 to allow the item to shrink to fit inside the container.\n    },\n    placeholderRoot: {\n      left: 0,\n      right: 0,\n      position: 'absolute'\n    },\n    floatable: {\n      width: '100%',\n      height: '100%'\n    },\n    spacer: {\n      flex: 1\n    },\n    warning: {\n      color: theme.palette.warning.main,\n      position: 'absolute',\n      zIndex: 1,\n      left: '2px',\n      top: '20px'\n    }\n  }\n})\nconst Plot = React.memo(forwardRef(({\n  data,\n  layout,\n  config,\n  floatTitle,\n  metaInfoLink,\n  capture,\n  fixedMargins,\n  className,\n  classes,\n  placeHolderStyle,\n  noDataStyle,\n  warning,\n  onRelayout,\n  onRedraw,\n  onRelayouting,\n  onHover,\n  onReset,\n  onSelected,\n  onSelecting,\n  onDeselect,\n  onClick,\n  onWebglContextLost,\n  layoutSubject,\n  disableDefaultActions,\n  actions,\n  throttleResize,\n  'data-testid': testID\n}, canvas) => {\n  const [float, setFloat] = useState(false)\n  const theme = useTheme()\n  const firstRender = useRef(true)\n  const [ratio, setRatio] = useState(1)\n  const [canvasNode, setCanvasNode] = useState()\n  const attach = useRef()\n  const [sizeReady, setSizeReady] = useState(false)\n  const [loading, setLoading] = useState(true)\n  const margins = useRef()\n  const history = useHistory()\n  const { height, width, ref } = useResizeDetector()\n  const canvasSize = useRef({})\n  const layoutRecoverRef = useRef()\n  const resetInfo = useRef()\n\n  // The image capture settings\n  const captureSettings = useMemo(() => {\n    const maxSize = 1280\n    let width, height\n    if (ratio > 1) {\n      width = maxSize\n      height = maxSize / ratio\n    } else {\n      width = maxSize * ratio\n      height = maxSize\n    }\n    const defaultCapture = {\n      format: 'png',\n      width: width,\n      height: height,\n      filename: 'plot'\n    }\n    const settings = mergeObjects(capture, defaultCapture)\n    return settings\n  }, [capture, ratio])\n\n  const styles = useStyles({classes: classes})\n  if (noDataStyle) {\n    styles.nodata = noDataStyle\n  }\n  if (placeHolderStyle) {\n    styles.placeholder = placeHolderStyle\n  }\n\n  // This callback redraws the plot whenever the canvas element changes. In\n  // order to properly detect changes in a reference, a reference callback is\n  // used. This is the recommended way to monitor reference changes as a simple\n  // useRef is not guaranteed to update:\n  // https://reactjs.org/docs/hooks-faq.html#how-can-i-measure-a-dom-node\n  const canvasRef = useCallback(node => {\n    if (node) {\n      if (!firstRender.current) {\n        attach.current = true\n        // We use a dummy state to request a redraw on the new canvas\n        setCanvasNode(node)\n      }\n      // We add a NATIVE wheel event handler that prevents the wheel events sent\n      // by Plotly from bubbling up. Notice that the SyntheticEvents added by\n      // React cannot be used, since they do not play well with the original\n      // native events created by Plotly (in particular: SyntheticEvents are all\n      // passive, so calling preventDefault on them will cause problems on\n      // browsers that support passive events.)\n      node.addEventListener('wheel', (e) => {\n        e.preventDefault()\n        e.stopPropagation()\n      })\n    }\n    canvasRef.current = node\n  }, [])\n\n  // Set the final layout. It is a combination of a default layout, the layout\n  // set by the user and some properties of the curretly used layout.\n  const finalLayout = useMemo(() => {\n    const withTitle = layout?.title?.text || layout?.template?.title?.text || layout?.annotations?.some(item => item?.text)\n    const defaultLayout = {\n      dragmode: 'pan',\n      hovermode: false,\n      showlegend: false,\n      autosize: false,\n      template: 'plotly_white',\n      // There is extra space reserved for the top and bottom margins so that\n      // automargin does not make the plot jump around too much.\n      margin: {\n        l: theme.spacing(4),\n        r: theme.spacing(1.5),\n        t: theme.spacing(withTitle ? 5 : 1),\n        b: theme.spacing(6)\n      },\n      title: {\n        font: {\n          family: theme.typography.fontFamily\n        },\n        yanchor: 'middle'\n      },\n      legend: {\n        bgcolor: 'rgba(255, 255, 255, 0.9)',\n        font: {\n          family: theme.typography.fontFamily,\n          size: 14\n        }\n      },\n      xaxis: {\n        automargin: false,\n        autorange: true,\n        linecolor: '#333',\n        linewidth: 1,\n        mirror: true,\n        ticks: 'outside',\n        showline: true,\n        fixedrange: true,\n        title: {\n          standoff: 10,\n          font: {\n            family: theme.typography.fontFamily,\n            size: 16,\n            color: '#333'\n          },\n          tickfont: {\n            family: theme.typography.fontFamily,\n            size: 14,\n            color: '#333'\n          }\n        }\n      },\n      yaxis: {\n        automargin: true,\n        autorange: true,\n        linecolor: '#333',\n        linewidth: 1,\n        mirror: true,\n        ticks: 'outside',\n        showline: true,\n        title: {\n          standoff: 10,\n          font: {\n            family: theme.typography.fontFamily,\n            size: 16,\n            color: '#333'\n          }\n        },\n        tickfont: {\n          family: 'Titillium Web,sans-serif',\n          size: 14,\n          color: '#333'\n        }\n      },\n      yaxis2: {\n        automargin: true,\n        autorange: true,\n        linecolor: '#333',\n        linewidth: 1,\n        mirror: true,\n        ticks: 'outside',\n        showline: true,\n        title: {\n          standoff: 8,\n          font: {\n            family: 'Titillium Web,sans-serif',\n            size: 16,\n            color: '#333'\n          }\n        },\n        tickfont: {\n          family: 'Titillium Web,sans-serif',\n          size: 14,\n          color: '#333'\n        }\n      }\n    }\n    const newLayout = mergeObjects(layout, defaultLayout)\n    return newLayout\n  }, [layout, theme])\n\n  // Set the final config\n  const finalConfig = useMemo(() => {\n    const defaultConfig = {\n      scrollZoom: true,\n      displayModeBar: false,\n      showTips: false,\n      responsive: true\n    }\n    return mergeObjects(config, defaultConfig)\n  }, [config])\n\n  // Saves reset options according to the given layout.\n  useEffect(() => {\n    resetInfo.current = {\n        rangeX: finalLayout?.xaxis?.range,\n        rangeY: finalLayout?.yaxis?.range,\n        rangeY2: finalLayout?.yaxis2?.range,\n        margin: finalLayout?.margin\n    }\n  }, [finalLayout])\n\n  // Used to get the currently active layout. Because of Floatable, the plot\n  // layout is lost upon the plot being put on another div. This is why we need\n  // a backup that is stored when the final plot config is ready. Notice that we\n  // have to keep parts of the old layout, as it stores e.g. range etc. that\n  // need to be persistent.\n  const getLayout = useCallback((update) => {\n      const oldLayout = cloneDeep(canvasRef.current.layout || layoutRecoverRef.current || {})\n      if (!oldLayout.xaxis) oldLayout.xaxis = {}\n      if (!oldLayout.yaxis) oldLayout.yaxis = {}\n      if (!oldLayout.yaxis2) oldLayout.yaxis2 = {}\n      const newLayout = mergeObjects(update, oldLayout)\n      // When fixed margins are set, the margins should be automatically set and\n      // then fixed in a secondary update.\n      if (fixedMargins) {\n        newLayout.xaxis.automargin = true\n        newLayout.yaxis.automargin = true\n        newLayout.yaxis2.automargin = true\n        newLayout.margin = resetInfo.current.margin\n      }\n      // The current size overrides any size that is set\n      newLayout.width = canvasSize.current?.width || newLayout.width\n      newLayout.height = canvasSize.current?.height || newLayout.height\n      // The range from updated layout should be used if it's set, otherwise use\n      // old range.\n      if (isEmpty(newLayout.xaxis.range)) newLayout.xaxis.range = oldLayout.xaxis.range\n      if (isEmpty(newLayout.yaxis.range)) newLayout.yaxis.range = oldLayout.yaxis.range\n      if (isEmpty(newLayout.yaxis2.range)) newLayout.yaxis2.range = oldLayout.yaxis2.range\n      return newLayout\n  }, [canvasRef, fixedMargins])\n\n  // If fixedMargins = true, captures the automatically set margin value from\n  // the plot and performs a layout update that fixes them.\n  const fixMargins = useCallback(() => {\n    if (fixedMargins && canvasRef.current) {\n      try {\n        // Get the element which explicitly stores the computed margin and\n        // perform a relayout with these values.\n        const currentLayout = cloneDeep(canvasRef.current.layout)\n        currentLayout.xaxis.automargin = false\n        currentLayout.yaxis.automargin = false\n        currentLayout.yaxis2.automargin = false\n        if (!currentLayout.margin) currentLayout.margin = {}\n        const subPlots = canvasRef.current.children[0].children[0].children[0].children[2].children\n        let [xMin, xMax] = [undefined, undefined]\n        for (const subPlot of subPlots) {\n          const canvas = subPlot.children[0]\n          const left = parseInt(canvas.getAttribute('x'))\n          const right = left + parseInt(canvas.getAttribute('width'))\n          xMin = !xMin || left < xMin ? left : xMin\n          xMax = !xMax || right > xMax ? right : xMax\n        }\n        const totalWidth = canvasRef.current.clientWidth\n        currentLayout.margin.l = xMin\n        currentLayout.margin.r = totalWidth - xMax\n        margins.current = cloneDeep(currentLayout.margin)\n        Plotly.relayout(canvasRef.current, currentLayout)\n      } catch (e) {\n        console.log('Could not determine the margin values.', e)\n      }\n    }\n  }, [canvasRef, fixedMargins])\n\n  // Handle canvas resize\n  useLayoutEffect(() => {\n    if (width && height) {\n      setRatio(width / height)\n      canvasSize.current = {width, height}\n      if (firstRender.current) {\n        setSizeReady(true)\n      } else {\n        // The updates are throttled by using requestAnimationFrame: there is no\n        // sense in trying to update beyond what the browser can render TODO:\n        // Ideally we would not need to call fixMargins here, as a simple resize\n        // should not trigger any change in the margins. The call is curently\n        // necesary due to the way the plot updates when going fullscreen:\n        // without fixmargins the view is jumbled.\n        const layout = getLayout()\n        if (throttleResize) {\n          window.requestAnimationFrame(() => {\n            // Notice that fixMargins has to be done within this callback\n            // together with the relayout\n            Plotly.relayout(canvasRef.current, layout)\n            fixMargins()\n          })\n        } else {\n          Plotly.relayout(canvasRef.current, layout)\n          fixMargins()\n        }\n      }\n    }\n  }, [canvasRef, width, height, throttleResize, fixMargins, getLayout])\n\n  // Update plots when data, config or rendering canvas is updated.\n  // useLayoutEffect is used so that React rendering and Plotly rendering are\n  // synced.\n  useLayoutEffect(() => {\n    if (!data || !sizeReady) {\n      if (data === false) setLoading(false)\n      return\n    }\n    // The plot is created on the first render\n    const layout = getLayout(finalLayout)\n    if (firstRender.current) {\n      Plotly.newPlot(canvasRef.current, data, layout, finalConfig)\n      attach.current = true\n      firstRender.current = false\n\n      // Subscribe to the layout change publisher if one is given\n      if (layoutSubject) {\n        layoutSubject.subscribe(layout => {\n          // The updates are throttled by using requestAnimationFrame: there is\n          // no sense in trying to update beyond what the browser can render\n          const newLayout = mergeObjects(layout, canvasRef.current.layout)\n          window.requestAnimationFrame(() => {\n            Plotly.relayout(canvasRef.current, newLayout)\n          })\n        })\n      }\n      setLoading(false)\n    // On subsequent updates to data or layout, we call Plotly.react to update\n    // the plot.\n    } else {\n      Plotly.react(canvasRef.current, data, layout, finalConfig)\n    }\n\n    fixMargins()\n\n    // Upon first render or changing the plot DOM element the events are (re-)attached.\n    if (attach.current === true) {\n      if (onRelayouting) {\n        canvasRef.current.on('plotly_relayouting', onRelayouting)\n      }\n      if (onRedraw) {\n        canvasRef.current.on('plotly_redraw', onRedraw)\n      }\n      if (onRelayout) {\n        canvasRef.current.on('plotly_relayout', onRelayout)\n      }\n      if (onHover) {\n        canvasRef.current.on('plotly_hover', onHover)\n      }\n      if (onSelected) {\n        canvasRef.current.on('plotly_selected', onSelected)\n      }\n      if (onSelecting) {\n        canvasRef.current.on('plotly_selecting', onSelecting)\n      }\n      if (onDeselect) {\n        canvasRef.current.on('plotly_deselect', onDeselect)\n      }\n      if (onClick) {\n        canvasRef.current.on('plotly_click', onClick)\n      }\n      if (onWebglContextLost) {\n        canvasRef.current.on('plotly_webglcontextlost', onWebglContextLost)\n      }\n      attach.current = false\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [layoutSubject, fixedMargins, canvasNode, firstRender, data, finalConfig, finalLayout, sizeReady, canvasRef, onRelayout, onRelayouting, fixMargins, getLayout])\n\n  // If the callbacks change, we need to update them in the canvas as well.\n  // TODO: Do this for other callbacks as well.\n  useEffect(() => {\n    if (onSelected && canvasRef?.current?.on) {\n      canvasRef.current.on('plotly_selected', onSelected)\n    }\n  }, [onSelected, canvasRef])\n\n  // For resetting the view.\n  const handleReset = useCallback(() => {\n    if (canvasRef?.current) {\n      // If a fixed range was set in the original layout, use it. Otherwise\n      // autorange the view.\n      const hasX = !isNil(resetInfo.current.rangeX)\n      const hasY = !isNil(resetInfo.current.rangeY)\n      const hasY2 = !isNil(resetInfo.current.rangeY2)\n      const oldLayout = getLayout()\n      const layout = {\n        ...oldLayout,\n        xaxis: {...oldLayout.xaxis, autorange: !hasX, range: hasX ? [...resetInfo.current.rangeX] : oldLayout.xaxis.range},\n        yaxis: {...oldLayout.yaxis, autorange: !hasY, range: hasY ? [...resetInfo.current.rangeY] : oldLayout.yaxis.range},\n        yaxis2: {...oldLayout.yaxis2, autorange: !hasY2, range: hasY2 ? [...resetInfo.current.rangeY2] : oldLayout.yaxis2.range}\n      }\n      Plotly.relayout(canvasRef.current, layout)\n      fixMargins()\n      onReset && onReset()\n    }\n  }, [canvasRef, onReset, fixMargins, getLayout])\n\n  // Saves the current layout for recovering the plot\n  const saveLayout = useCallback(() => {\n    layoutRecoverRef.current = cloneDeep(canvasRef?.current?.layout)\n  }, [canvasRef])\n\n  // Handles float change\n  const handleFloat = useCallback(() => {\n    saveLayout()\n    setFloat(!float)\n  }, [float, saveLayout])\n\n  // Handles plot capturing\n  const handleCapture = useCallback(() => {\n    Plotly.downloadImage(canvasRef.current, captureSettings)\n  }, [canvasRef, captureSettings])\n\n  // Listen to keyboard events to deselect.\n  useEffect(() => {\n    function handleDeselect(event) {\n      if (['Escape', 'Delete'].includes(event.key)) {\n        const layout = canvasRef.current.layout\n        delete layout.selections\n        const data = canvasRef.current.data\n        data.forEach(element => {\n          delete element.selectedpoints\n        })\n        Plotly.react(canvasRef.current, data, layout)\n        onDeselect && onDeselect()\n      }\n    }\n    window.addEventListener('keydown', handleDeselect)\n    return () => window.removeEventListener('keydown', handleDeselect)\n  }, [canvasRef, onDeselect])\n\n  useImperativeHandle(canvas, () => ({\n    reset() {\n      handleReset()\n    },\n    toggleFullscreen() {\n      handleFloat()\n    },\n    capture() {\n      handleCapture()\n    },\n    saveLayout() {\n      saveLayout()\n    },\n    relayout(callback) {\n      if (canvasRef.current?.layout) {\n        const newLayout = callback(canvasRef.current.layout)\n        Plotly.relayout(canvasRef.current, newLayout)\n      }\n    }\n  }))\n\n  // Decides the possible overlay to display\n  const overlay = useMemo(() => {\n    if (loading) {\n      return <Placeholder\n        margin={0}\n        className={styles.placeholderRoot}\n        classes={{skeleton: placeHolderStyle}}\n        variant=\"rect\"\n        data-testid={`${testID}-placeholder`}\n      />\n    } else if (data === false) {\n      return <NoData classes={{placeholder: styles.nodata}} data-testid={`${testID}-nodata`}/>\n    }\n    return null\n  }, [loading, data, styles, placeHolderStyle, testID])\n\n  // Determine the final list of actions to show\n  const allActions = useMemo(() => {\n    const defaultActions = disableDefaultActions\n      ? null\n      : <>\n      <Action key=\"reset\" tooltip='Reset view' onClick={handleReset}>\n        <Replay/>\n      </Action>\n      <Action key=\"fullscreen\" tooltip='Toggle fullscreen' onClick={handleFloat}>\n        {float ? <FullscreenExit/> : <Fullscreen/>}\n      </Action>\n      <Action key=\"capture\" tooltip='Capture image' onClick={handleCapture}>\n        <CameraAlt/>\n      </Action>\n      {metaInfoLink && <Action key=\"archive\" tooltip='View data in the archive' onClick={() => { history.push(metaInfoLink) }}>\n        <ViewList/>\n      </Action>}\n    </>\n    return (defaultActions || actions)\n      ? <div className={styles.footer}>\n          <Actions>{defaultActions}{actions}</Actions>\n        </div>\n      : null\n  }, [actions, disableDefaultActions, float, handleCapture, handleFloat, handleReset, history, metaInfoLink, styles])\n\n  // Even if the plots are still loading, all the html elements need to be\n  // placed in the DOM. During loading, they are placed underneath the\n  // placeholder with visibility=hidden. This way Plotly still has access to\n  // these HTML nodes and their sizes when the plots are loading.\n  return <Box\n    className={clsx(styles.root, className)}\n    data-testid={testID}\n  >\n    <Floatable\n      className={styles.floatable}\n      float={float}\n      onFloat={handleFloat}\n    >\n      <div className={styles.container}>\n        {/* Overlay that is displayed on top of the viewer */}\n        <div className={styles.content}>\n          {overlay}\n        </div>\n        {/* This contains the actual visualization. Needs to be always in the DOM so we can\n        load the structure into it properly. */}\n        <div\n          className={styles.content}\n          style={{visibility: overlay ? 'hidden' : 'visible'}}\n        >\n          {float && <Typography variant=\"h6\">{floatTitle}</Typography>}\n          <div className={styles.canvasContainer} ref={ref}>\n            {/* Note that we need to apply \"style\" to the canvas instead of \"className\" */}\n            <div ref={canvasRef} style={{width: '100%', height: '100%', position: 'relative'}}>\n              {warning && <Tooltip title={warning}>\n                <Warning className={styles.warning}></Warning>\n              </Tooltip>}\n            </div>\n          </div>\n          {allActions}\n        </div>\n      </div>\n    </Floatable>\n  </Box>\n}))\n\nPlot.propTypes = {\n  data: PropTypes.any, // Plotly.js data object: Set to null to show Placeholder, set to false to show NoData.\n  layout: PropTypes.object, // Plotly.js layout object. Notice that all the fields that are set in this object will be updated.\n  config: PropTypes.object, // Plotly.js config object\n  capture: PropTypes.object, // Capture settings\n  fixedMargins: PropTypes.bool, // When enabled, the margins are not updated upon pan/scroll. This makes the interaction smoother.\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  placeHolderStyle: PropTypes.string, // The CSS class to apply for the Placeholder component.\n  noDataStyle: PropTypes.string, // The CSS class to apply for the NoData component.\n  floatTitle: PropTypes.string, // The title of the plot shown in floating mode\n  metaInfoLink: PropTypes.string, // A link to the metainfo definition\n  warning: PropTypes.string, // Optional message displayed under a warning icon on the top-left corner of the element.\n  onRelayout: PropTypes.func,\n  onRedraw: PropTypes.func,\n  onRelayouting: PropTypes.func,\n  onHover: PropTypes.func,\n  onReset: PropTypes.func,\n  onSelected: PropTypes.func,\n  onSelecting: PropTypes.func,\n  onDeselect: PropTypes.func,\n  onClick: PropTypes.func,\n  disableDefaultActions: PropTypes.bool, // Whether to show the default plot actions.\n  actions: PropTypes.node, // Additional actions.\n  onWebglContextLost: PropTypes.func,\n  throttleResize: PropTypes.bool, // Whether to throttle resize using requestAnimationFrame\n  /**\n   * A RxJS Subject for efficient, non-persistent, layout changes that bypass\n   * rendering of the component. Should send messages that contain the new\n   * layout object.\n  */\n  layoutSubject: PropTypes.any,\n  'data-testid': PropTypes.string,\n  showOptions: PropTypes.bool,\n  onClickOptions: PropTypes.func\n}\nPlot.defaultProps = {\n  floatTitle: '',\n  fixedMargins: true, // If set to true, the margins will be fixed after first render.\n  throttleResize: false\n}\n\nexport default Plot\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useState, useEffect, useMemo} from 'react'\nimport PropTypes from 'prop-types'\nimport { isFinite } from 'lodash'\nimport { useTheme } from '@material-ui/core/styles'\nimport Plot from '../plotting/Plot'\nimport { add, distance, mergeObjects } from '../../utils'\nimport { Quantity } from '../units/Quantity'\nimport { Unit } from '../units/Unit'\nimport { withErrorHandler } from '../ErrorHandler'\nimport { msgNormalizationWarning } from '../../config'\nimport { getLineStyles } from '../plotting/common'\n\nconst BandStructure = React.memo(({\n  data,\n  layout,\n  className,\n  units,\n  type,\n  ...other\n}) => {\n  const [finalData, setFinalData] = useState(!data ? data : undefined)\n  const [pathSegments, setPathSegments] = useState(undefined)\n  const energyUnit = useMemo(() => new Unit('joule'), [])\n  const theme = useTheme()\n\n  // Determine the energy reference and normalization\n  const energyHighestOccupiedNormalized = useMemo(() => {\n    if (!data) {\n      return [[undefined, undefined]]\n    }\n    if (type === 'vibrational') {\n      return [[0, true]]\n    } else {\n      return data.map(d => {\n        if (!isFinite(d.energy_highest_occupied)) {\n          return [0, false]\n        } else {\n          return [new Quantity(d.energy_highest_occupied, energyUnit).toSystem(units).value(), true]\n        }\n      })\n    }\n  }, [data, energyUnit, units, type])\n\n  // Side effect that runs when the data that is displayed should change. By\n  // running all this heavy stuff as a side effect, the first render containing\n  // the placeholders etc. can be done as fast as possible.\n  useEffect(() => {\n    if (!data) {\n      setFinalData(data)\n      return\n    }\n\n    const energyName = 'energies'\n    const kpointName = 'kpoints'\n    const plotData = []\n    const channels = data.map(d => d.segment[0][energyName].length)\n    const lines = getLineStyles(channels.reduce((a, b) => a + b, 0), null, channels.length > 0 ? channels[0] : null).values()\n    data.forEach((d, n) => {\n      const nChannels = d.segment[0][energyName].length\n      const nBands = d.segment[0][energyName][0][0].length\n\n      // Calculate distances in k-space if missing. These distances in k-space\n      // define the plot x-axis spacing.\n      const tempSegments = []\n      if (d.segment[0].k_path_distances === undefined) {\n        let length = 0\n        for (const segment of d.segment) {\n          const k_path_distances = []\n          const nKPoints = segment[energyName][0].length\n          const start = segment[kpointName][0]\n          const end = segment[kpointName].slice(-1)[0]\n          const segmentLength = distance(start, end)\n          for (let iKPoint = 0; iKPoint < nKPoints; ++iKPoint) {\n            const kPoint = segment[kpointName][iKPoint]\n            const dist = distance(start, kPoint)\n            k_path_distances.push(length + dist)\n          }\n          length += segmentLength\n          segment.k_path_distances = k_path_distances\n          tempSegments.push(k_path_distances)\n        }\n      } else {\n        for (const segment of d.segment) {\n          tempSegments.push(segment.k_path_distances)\n        }\n      }\n      setPathSegments(tempSegments)\n\n      // Path\n      let path = []\n      for (const segment of d.segment) {\n        path = path.concat(segment.k_path_distances)\n        tempSegments.push(segment.k_path_distances)\n      }\n\n      //  we assign first for spin up\n      const lineUp = lines.next().value\n      // Second spin channel\n      if (nChannels === 2) {\n        const line = lines.next().value\n        const bands = []\n        for (let iBand = 0; iBand < nBands; ++iBand) {\n          bands.push([])\n        }\n        for (const segment of d.segment) {\n          for (let iBand = 0; iBand < nBands; ++iBand) {\n            const nKPoints = segment[energyName][1].length\n            for (let iKPoint = 0; iKPoint < nKPoints; ++iKPoint) {\n              bands[iBand].push(segment[energyName][1][iKPoint][iBand])\n            }\n          }\n        }\n\n        // Create plot data entry for each band\n        for (let band of bands) {\n          band = new Quantity(band, energyUnit).toSystem(units).value()\n          if (energyHighestOccupiedNormalized[n][0] !== 0) {\n            band = add(band, -energyHighestOccupiedNormalized[n][0])\n          }\n          plotData.push(\n            {\n              x: path,\n              y: band,\n              type: 'scatter',\n              mode: 'lines',\n              showlegend: false,\n              legendgroup: d.name,\n              line: line\n            }\n          )\n        }\n      }\n\n      // First spin channel\n      const bands = []\n      for (let iBand = 0; iBand < nBands; ++iBand) {\n        bands.push([])\n      }\n      for (const segment of d.segment) {\n        for (let iBand = 0; iBand < nBands; ++iBand) {\n          const nKPoints = segment[energyName][0].length\n          for (let iKPoint = 0; iKPoint < nKPoints; ++iKPoint) {\n            bands[iBand].push(segment[energyName][0][iKPoint][iBand])\n          }\n        }\n        path = path.concat(segment.k_path_distances)\n      }\n\n      // Create plot data entry for each band\n      for (let [nBand, band] of bands.entries()) {\n        band = new Quantity(band, energyUnit).toSystem(units).value()\n        if (energyHighestOccupiedNormalized[n][0] !== 0) {\n          band = add(band, -energyHighestOccupiedNormalized[n][0])\n        }\n        plotData.push(\n          {\n            x: path,\n            y: band,\n            name: d.name,\n            type: 'scatter',\n            mode: 'lines',\n            showlegend: nBand === 0 && d.name !== undefined,\n            legendgroup: d.name,\n            line: lineUp\n          }\n        )\n      }\n\n      // Normalization line\n      if (type !== 'vibrational' && energyHighestOccupiedNormalized[0][1] && n === data.length - 1) {\n        plotData.push({\n          x: [path[0], path[path.length - 1]],\n          y: [0, 0],\n          name: 'Highest occupied',\n          showlegend: true,\n          type: 'line',\n          mode: 'lines',\n          line: {\n            color: '#000',\n            width: 1\n          }\n        })\n      }\n    })\n\n    setFinalData(plotData)\n  }, [data, theme, units, energyUnit, type, energyHighestOccupiedNormalized])\n\n  // Merge custom layout with default layout\n  const tmpLayout = useMemo(() => {\n    const defaultLayout = {\n      xaxis: {\n        tickangle: 0,\n        tickfont: {\n          size: 14\n        },\n        zeroline: false\n      },\n      yaxis: {\n        title: {\n          text: `Energy (${energyUnit.toSystem(units).label()})`\n        },\n        zeroline: type === 'vibrational'\n      },\n      title: {\n        text: {\n          text: 'Band structure'\n        }\n      },\n      showlegend: true,\n      legend: {\n        x: 1,\n        y: 0,\n        xanchor: 'right',\n        yanchor: 'bottom',\n        font: {\n          size: 13\n        }\n      }\n    }\n    return mergeObjects(layout, defaultLayout)\n  }, [layout, type, energyUnit, units])\n\n  // Compute layout that depends on data.\n  const computedLayout = useMemo(() => {\n    if (data === undefined || data === false || pathSegments === undefined) {\n      return {}\n    }\n    // Set new layout that contains the segment labels\n    const labels = []\n    const labelKPoints = []\n    for (let iSegment = 0; iSegment < data[0].segment.length; ++iSegment) {\n      const segment = data[0].segment[iSegment]\n      const startLabel = segment.endpoints_labels\n        ? segment.endpoints_labels[0]\n        : ''\n      if (iSegment === 0) {\n        labels.push(startLabel)\n        labelKPoints.push(pathSegments[iSegment][0])\n      } else {\n        const prevLabel = labels[labels.length - 1]\n        if (prevLabel !== startLabel) {\n          labels[labels.length - 1] = `${prevLabel}|${startLabel}`\n        }\n      }\n      const endLabel = segment.endpoints_labels\n        ? segment.endpoints_labels[1]\n        : ''\n      labels.push(endLabel)\n      labelKPoints.push(pathSegments[iSegment].slice(-1)[0])\n    }\n\n    const shapes = []\n    for (let iShape = 1; iShape < labelKPoints.length - 1; ++iShape) {\n      const labelKPoint = labelKPoints[iShape]\n      shapes.push({\n        type: 'line',\n        x0: labelKPoint,\n        y0: 0,\n        x1: labelKPoint,\n        y1: 1,\n        yref: 'paper',\n        line: {\n          color: '#999',\n          width: 1,\n          dash: '10px,10px'\n        }\n      })\n    }\n    const ticks = {\n      shapes: shapes,\n      xaxis: {\n        tickmode: 'array',\n        tickvals: labelKPoints,\n        ticktext: labels\n      }\n    }\n    return ticks\n  }, [data, pathSegments])\n\n  // Merge the given layout and layout computed from data\n  const finalLayout = useMemo(() => {\n    return mergeObjects(computedLayout, tmpLayout)\n  }, [computedLayout, tmpLayout])\n\n  return <Plot\n    data={finalData}\n    layout={finalLayout}\n    floatTitle={'Band structure'}\n    warning={energyHighestOccupiedNormalized[0][1] ? null : msgNormalizationWarning}\n    metaInfoLink={data ? data[0]?.m_path : null}\n    className={className}\n    {...other}\n  >\n  </Plot>\n})\n\nBandStructure.propTypes = {\n  data: PropTypes.oneOfType([\n    PropTypes.bool, // Set to False to show NoData component\n    PropTypes.arrayOf(PropTypes.shape({\n      segment: PropTypes.array.isRequired, // Array of segments in SI units\n      energy_highest_occupied: PropTypes.number, // Highest occupied energy.\n      m_path: PropTypes.string // Path of the section containing the data in the Archive\n    }))\n  ]),\n  layout: PropTypes.object,\n  className: PropTypes.string,\n  units: PropTypes.object, // Contains the unit configuration\n  type: PropTypes.string // Type of band structure: electronic or vibrational\n}\nBandStructure.defaultProps = {\n  type: 'electronic'\n}\n\nexport default withErrorHandler('Could not load band structure.')(BandStructure)\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useState, useEffect, useMemo, useCallback} from 'react'\nimport PropTypes from 'prop-types'\nimport { useTheme } from '@material-ui/core/styles'\nimport { Box, Checkbox, Menu, MenuItem, FormControlLabel } from '@material-ui/core'\nimport { MoreVert } from '@material-ui/icons'\nimport Plot from '../plotting/Plot'\nimport { mergeObjects } from '../../utils'\nimport { getLineStyles } from '../plotting/common'\nimport { Quantity } from '../units/Quantity'\nimport { Unit } from '../units/Unit'\nimport { useUnitContext } from '../units/UnitContext'\nimport { withErrorHandler } from '../ErrorHandler'\nimport { Action } from '../Actions'\n\nconst energyUnit = new Unit('joule')\n\n/**\n * Graph for Spectra data.\n */\nexport const spectraError = 'Could not load Spectra.'\nconst Spectra = React.memo(({\n  data,\n  layout,\n  className,\n  'data-testid': testID,\n  ...other\n}) => {\n  const [finalData, setFinalData] = useState(!data ? data : undefined)\n  const theme = useTheme()\n  const {units} = useUnitContext()\n  const [anchorEl, setAnchorEl] = React.useState(null)\n  const [spectraNormalize, setSpectraNormalize] = useState(true)\n\n  // Merge custom layout with default layout\n  const tmpLayout = useMemo(() => {\n    if (data === undefined) {\n      return\n    }\n    const defaultLayout = {\n      showlegend: true,\n      legend: {\n        x: 1,\n        y: 1,\n        xanchor: 'right',\n        yanchor: 'top'\n      },\n      yaxis: {\n        title: {\n          text: 'Intensities (a.u.)'\n        }\n      },\n      xaxis: {\n        title: {\n          text: `Excitation energies (${energyUnit.toSystem(units).label()})`\n        }\n      }\n    }\n    return mergeObjects(layout, defaultLayout)\n  }, [layout, units, data])\n\n  // Get the maximum intensity to normalize in the checkbox\n  const maximumIntensity = useMemo(() => {\n    if (!data) return undefined\n    const maxes = data.map(trace => Math.max(...trace.intensities))\n    return Math.max(...maxes)\n  }, [data])\n\n  // The plotted data is loaded only after the first render as a side effect to\n  // avoid freezing the UI\n  useEffect(() => {\n    if (!data) {\n      setFinalData(data)\n      return\n    }\n\n    // Normalizing spectra\n    const plotData = []\n    const lineStyles = getLineStyles(data.length, theme)\n    if (maximumIntensity !== undefined) {\n      for (let i = 0; i < data.length; ++i) {\n        const trace = data[i]\n        const energies = new Quantity(trace.energies, energyUnit).toSystem(units).value()\n        const intensities = spectraNormalize\n          ? trace.intensities.map((intensity) => intensity / maximumIntensity)\n          : trace.intensities\n        plotData.push(\n          {\n            x: energies,\n            y: intensities,\n            name: `${data[i].label} ${i}`,\n            type: 'scatter',\n            mode: 'lines',\n            line: lineStyles[i]\n          }\n        )\n      }\n    }\n    setFinalData(plotData)\n  }, [data, theme, units, spectraNormalize, maximumIntensity])\n\n  const open = Boolean(anchorEl)\n  const openMenu = useCallback((event) => {\n    setAnchorEl(event.currentTarget)\n  }, [])\n  const closeMenu = useCallback(() => {\n    setAnchorEl(null)\n  }, [])\n\n  return <Box display=\"flex\" flexDirection=\"column\" height=\"100%\" width=\"100%\">\n    <Box flex=\"1 1 auto\">\n      <Plot\n      data={finalData}\n      layout={tmpLayout}\n      floatTitle={\"Spectra\"}\n      className={className}\n      data-testid={`${testID}`}\n      actions={\n        <Action tooltip='Options' onClick={openMenu}>\n          <MoreVert/>\n        </Action>\n      }\n      {...other}\n      >\n      </Plot>\n      <Menu\n        id='settings-menu'\n        anchorEl={anchorEl}\n        getContentAnchorEl={null}\n        anchorOrigin={{ vertical: 'bottom', horizontal: 'right' }}\n        transformOrigin={{ vertical: 'top', horizontal: 'right' }}\n        keepMounted\n          open={open}\n          onClose={closeMenu}\n      >\n      <MenuItem key='normalization'>\n        <FormControlLabel control={\n          <Checkbox\n            onChange={() => {\n              setSpectraNormalize(!spectraNormalize)\n            }}\n            color=\"primary\"\n            checked={spectraNormalize}\n          />\n          }\n          label='Normalize intensities'\n        />\n      </MenuItem>\n      </Menu>\n    </Box>\n  </Box>\n})\n\nSpectra.propTypes = {\n  data: PropTypes.arrayOf(PropTypes.shape({\n    type: PropTypes.string,\n    label: PropTypes.string,\n    intensities: PropTypes.arrayOf(PropTypes.number),\n    energies: PropTypes.arrayOf(PropTypes.number)\n  })),\n  layout: PropTypes.object,\n  className: PropTypes.string,\n  'data-testid': PropTypes.string\n}\nSpectra.defaultProps = {\n  'data-testid': 'spectra'\n}\n\nexport default withErrorHandler(spectraError)(Spectra)\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useEffect, useState, useMemo, useCallback} from 'react'\nimport PropTypes from 'prop-types'\nimport { useTheme } from '@material-ui/core/styles'\nimport { MoreVert } from '@material-ui/icons'\nimport Plot from '../plotting/Plot'\nimport { add, mergeObjects, resolveInternalRef } from '../../utils'\nimport { Quantity } from '../units/Quantity'\nimport { Unit } from '../units/Unit'\nimport { useUnitContext } from '../units/UnitContext'\nimport { withErrorHandler } from '../ErrorHandler'\nimport { Action } from '../Actions'\nimport { msgNormalizationWarning } from '../../config'\nimport { getLineStyles } from '../plotting/common'\nimport { Checkbox, Menu, MenuItem, FormControlLabel } from '@material-ui/core'\n\nconst energyUnit = new Unit('joule')\nconst valueUnit = new Unit('1/joule')\n\nconst DOS = React.memo(({\n  data,\n  layout,\n  className,\n  type,\n  'data-testid': testID,\n  ...other\n}) => {\n  const {units} = useUnitContext()\n\n  // Merge custom layout with default layout\n  const initialLayout = useMemo(() => {\n    const defaultLayout = {\n      xaxis: {\n        showexponent: 'first',\n        autorange: false,\n        zeroline: type === 'vibrational'\n      },\n      showlegend: true,\n      legend: {\n        x: 1,\n        xanchor: 'right',\n        yanchor: 'bottom',\n        y: 0\n      }\n    }\n    return mergeObjects(layout, defaultLayout)\n  }, [layout, type])\n\n  const [finalData, setFinalData] = useState(!data ? data : undefined)\n  const [finalLayout, setFinalLayout] = useState(initialLayout)\n  const [normalizedToHOE, setNormalizedToHOE] = useState(true)\n  const theme = useTheme()\n  const [dosNormalize, setDosNormalize] = useState(false)\n  const [anchorEl, setAnchorEl] = React.useState(null)\n\n  // Side effect that runs when the data that is displayed should change. By\n  // running all this heavy stuff within useEffect (instead of e.g. useMemo),\n  // the first render containing the placeholders etc. can be done as fast as\n  // possible.\n  useEffect(() => {\n    if (!data) {\n      setFinalData(data)\n      return\n    }\n\n    // Create the final data that will be plotted.\n    const version = data.length > 0 ? data[0].version : undefined\n    const processedData = version === 'new'\n      ? processNewDosData(data, units, initialLayout, normalizedToHOE, theme, type, dosNormalize)\n      : processOldDosData(data, units, initialLayout, normalizedToHOE, theme, type, dosNormalize)\n\n    if (processedData) {\n      setFinalData(processedData.finalData)\n      setFinalLayout(processedData.finalLayout)\n      setNormalizedToHOE(processedData.normalized)\n    }\n  }, [data, units, initialLayout, normalizedToHOE, theme, type, dosNormalize])\n\n  const open = Boolean(anchorEl)\n  const openMenu = useCallback((event) => {\n    setAnchorEl(event.currentTarget)\n  }, [])\n  const closeMenu = useCallback(() => {\n    setAnchorEl(null)\n  }, [])\n\n  return <>\n    <Plot\n      data={finalData}\n      layout={finalLayout}\n      floatTitle=\"Density of states\"\n      warning={normalizedToHOE === false ? msgNormalizationWarning : null}\n      metaInfoLink={data ? data[0]?.m_path : null}\n      data-testid={testID}\n      className={className}\n      actions={\n        <Action tooltip='Options' onClick={openMenu} data-testid=\"dos-options-menu\">\n          <MoreVert/>\n        </Action>\n      }\n      {...other}\n    >\n    </Plot>\n    <Menu\n      anchorEl={anchorEl}\n      getContentAnchorEl={null}\n      anchorOrigin={{ vertical: 'bottom', horizontal: 'right' }}\n      transformOrigin={{ vertical: 'top', horizontal: 'right' }}\n      keepMounted\n      open={open}\n      onClose={closeMenu}\n    >\n      <MenuItem key='normalization'>\n        <FormControlLabel\n          control={\n            <Checkbox\n              onChange={() => {\n                setDosNormalize(data[0].normalization_factors ? (dosNormalize) => !dosNormalize : false)\n              }}\n              color=\"primary\"\n              checked={dosNormalize}\n              disabled={!data?.[0]?.normalization_factors || data[0].normalization_factors.every(value => value === undefined)}\n            />\n          }\n          label='Normalize intensities'\n        />\n      </MenuItem>\n    </Menu>\n  </>\n})\n\nDOS.propTypes = {\n  data: PropTypes.oneOfType([\n    PropTypes.bool, // Set to False to show NoData component\n    PropTypes.arrayOf(PropTypes.shape({\n      energies: PropTypes.array.isRequired, // DOS energies array\n      densities: PropTypes.array.isRequired, // DOS values array\n      energy_highest_occupied: PropTypes.number, // Highest occupied energy.\n      m_path: PropTypes.string, // Path of the section containing the data in the Archive\n      label: PropTypes.string // Label of the data\n    }))\n  ]),\n  layout: PropTypes.object,\n  className: PropTypes.string,\n  type: PropTypes.string, // Type of band structure: electronic or vibrational\n  'data-testid': PropTypes.string\n}\n\nDOS.defaultProps = {\n  type: 'electronic'\n}\n\nexport default withErrorHandler('Could not load density of states.')(DOS)\n\n/**\n * Given index and archive, resolves the data for plotting the DOS.\n */\nexport function resolveDosNew(properties, archive, pattern) {\n  // Return undefined if property not available\n  if (!properties.has('dos_electronic_new')) return false\n\n  // Resolve the final data once archive is here\n  let dosReferences = archive?.results?.properties?.electronic?.dos_electronic_new || []\n  if (!Array.isArray(dosReferences)) dosReferences = [dosReferences]\n  const dos = []\n  for (const reference of dosReferences) {\n    if (reference.spin_polarized && reference.data.length !== 2) break\n    const d = {\n      energies: [],\n      densities: [],\n      normalization_factors: [],\n      energy_highest_occupied: [],\n      version: 'new'\n    }\n    d.name = reference.label\n    d.spin_polarized = reference.spin_polarized\n    for (const data of reference.data) {\n      const match = data.energies.match(pattern)\n      const path = match ? match[2] : data.energies\n      const totalMatch = data.total.match(pattern)\n      const totalPath = match ? totalMatch[2] : data.total\n      const sourceArchive = match ? (archive.m_ref_archives[match[1]] || archive.m_ref_archives[data.energies.split('#')[0]]) : archive\n      if (sourceArchive) {\n        d.energies.push(resolveInternalRef(path, sourceArchive))\n        const internalRef = resolveInternalRef(totalPath, sourceArchive)\n        d.densities.push(internalRef.value)\n        d.normalization_factors.push(internalRef.normalization_factor)\n      }\n      if (data.energy_ref) {\n        d.energy_highest_occupied.push(data.energy_ref)\n      }\n      d.m_path = `${archive?.metadata?.entry_id}/data/results/properties/electronic/dos_electronic_new`\n    }\n    if (d.energies && d.densities) dos.push(d)\n  }\n  return dos.length === 0 ? false : dos\n}\n\n/**\n * Given index and archive, resolves the data for plotting the old DOS. This will eventually\n * be deprecated and fully replaced with resolveDosNew().\n */\nexport function resolveDosOld(properties, archive, pattern) {\n  // Return undefined if property not available\n  if (!properties.has('dos_electronic')) return false\n\n  // Resolve the final data once archive is here\n  let dosReferences = archive?.results?.properties?.electronic?.dos_electronic || []\n  if (!Array.isArray(dosReferences)) dosReferences = [dosReferences]\n  const dos = []\n  for (const reference of dosReferences) {\n    const d = {version: 'old'}\n    const match = reference.energies.match(pattern)\n    const path = match ? match[2] : reference.energies\n    const totalPath = match ? reference.total.map(ref => ref.match(pattern)[2]) : reference.total\n    const sourceArchive = match ? (archive.m_ref_archives[match[1]] || archive.m_ref_archives[reference.energies.split('#')[0]]) : archive\n    if (sourceArchive) {\n      d.energies = resolveInternalRef(path, sourceArchive)\n      const internalRef = resolveInternalRef(totalPath, sourceArchive)\n      d.densities = internalRef.map(dos => dos.value)\n      d.normalization_factors = internalRef.map(dos => dos.normalization_factor)\n    }\n    d.name = reference.label\n    if (reference.band_gap) {\n      d.energy_highest_occupied = Math.max(...reference.band_gap.map(x => x.energy_highest_occupied))\n    }\n    d.m_path = `${archive?.metadata?.entry_id}/data/results/properties/electronic/dos_electronic`\n    if (d.energies && d.densities) dos.push(d)\n  }\n  return dos.length === 0 ? false : dos\n}\n\n/**\n * Processed the old DOS data plotting.\n */\nfunction processOldDosData(data, units, initialLayout, normalizedToHOE, theme, type, dosNormalize) {\n  const plotData = []\n  let normalized\n  const mins = []\n  const maxes = []\n  const dosRenormalized = data.map(d => {\n    const densities = dosNormalize\n    ? d.densities.map((density, index) => {\n      return density.map(density_intensity => density_intensity * d.normalization_factors[index])\n    })\n    : d.densities\n    return {...d, densities: densities}\n  })\n  const channels = dosRenormalized.map(d => d.densities.length)\n  const lines = getLineStyles(channels.reduce((a, b) => a + b, 0), null, channels.length > 0 ? channels[0] : null).values()\n  dosRenormalized.forEach(d => {\n    // Determine the energy reference.\n    let energyHighestOccupied\n    if (type === 'vibrational') {\n      energyHighestOccupied = 0\n      normalized = true\n    } else {\n      if (d.energy_highest_occupied === undefined) {\n        energyHighestOccupied = 0\n        normalized = false\n      } else {\n        energyHighestOccupied = new Quantity(d.energy_highest_occupied, energyUnit).toSystem(units).value()\n        normalized = true\n      }\n    }\n\n    // Convert units and determine range\n    const nChannels = d.densities.length\n    let energies = new Quantity(d.energies, energyUnit).toSystem(units).value()\n    const values1 = new Quantity(d.densities[0], valueUnit).toSystem(units).value()\n    let values2\n    mins.push(Math.min(...values1))\n    maxes.push(Math.max(...values1))\n    if (nChannels === 2) {\n      values2 = new Quantity(d.densities[1], valueUnit).toSystem(units).value()\n      mins.push(Math.min(...values2))\n      maxes.push(Math.max(...values2))\n    }\n    if (energyHighestOccupied !== 0) {\n      energies = add(energies, -energyHighestOccupied)\n    }\n\n    const line = lines.next().value\n    if (nChannels === 2) {\n      plotData.push(\n        {\n          x: values2,\n          y: energies,\n          type: 'scatter',\n          mode: 'lines',\n          showlegend: false,\n          line: lines.next().value\n        }\n      )\n    }\n    plotData.push(\n      {\n        x: values1,\n        y: energies,\n        name: d.name,\n        type: 'scatter',\n        mode: 'lines',\n        showlegend: d.name !== undefined,\n        line: line\n      }\n    )\n  })\n\n  const range = [Math.min(...mins), Math.max(...maxes)]\n  // Normalization line\n  if (type !== 'vibrational' && normalizedToHOE) {\n    plotData.push({\n      x: range,\n      y: [0, 0],\n      name: 'Highest occupied',\n      showlegend: true,\n      type: 'line',\n      mode: 'lines',\n      line: {\n        color: '#000',\n        width: 1\n      }\n    })\n  }\n\n  // Compute the final layout\n  const computedLayout = mergeObjects(\n    {\n      yaxis: {\n        title: {\n          text: `Energy (${energyUnit.toSystem(units).label()})`\n        }\n      },\n      xaxis: {\n        title: {\n          text: dosNormalize ? `${valueUnit.toSystem(units).label()}` : `states ${valueUnit.toSystem(units).label()}`\n        },\n        range: range,\n        zeroline: true\n      },\n      legend: {\n        font: {\n          size: 13\n        }\n      }\n    },\n    initialLayout\n  )\n\n  return {\n    finalData: plotData,\n    finalLayout: computedLayout,\n    normalized: normalized\n  }\n}\n/*\n * Processed the new DOS data plotting.\n */\nfunction processNewDosData(data, units, initialLayout, normalizedToHOE, theme, type, dosNormalize) {\n  // Plotting styles: lineStyles differentiates spin channels, while lineColors changes\n  // for different methodologies\n  // @TODO use getLineStyles instead\n  const lineStyles = ['solid', 'dot']\n  const lineColors = ['#005271', '#f57c00']\n\n  const plotData = []\n  let normalized\n  const isSpinPolarized = []\n  const mins = []\n  const maxes = []\n  for (const [iMethod, dos_method] of data.entries()) {\n    const methodName = dos_method.name ? dos_method.name : ''\n    const spinChannels = dos_method.spin_polarized ? 2 : 1\n    isSpinPolarized.push(spinChannels === 2)\n    const spinName = spinChannels === 2 ? ['+', '-'] : ['']\n    // Looping over different spin channels\n    for (let iSpin = 0; iSpin < spinChannels; iSpin++) {\n      // Setting state for renormalizing densities by the normalization factor\n      const densities = dos_method.densities[iSpin]\n      const normalization_factor = dos_method.normalization_factors[iSpin]\n      let dosRenormalized\n      if (normalization_factor !== undefined && dosNormalize) {\n        dosRenormalized = densities.map(d => d * normalization_factor)\n      } else {\n        dosRenormalized = densities\n      }\n\n      // Setting the energy reference using the energy_highest_occupied\n      let energyHighestOccupied\n      if (type === 'vibrational') {\n        energyHighestOccupied = 0\n        normalized = true\n      } else {\n        if (dos_method.energy_highest_occupied[iSpin] === undefined) {\n          energyHighestOccupied = 0\n          normalized = false\n        } else {\n          energyHighestOccupied = new Quantity(dos_method.energy_highest_occupied[iSpin], energyUnit).toSystem(units).value()\n          normalized = true\n        }\n      }\n\n      // Convert units and determine range\n      let energies = new Quantity(dos_method.energies[iSpin], energyUnit).toSystem(units).value()\n      if (energyHighestOccupied !== 0) {\n        energies = add(energies, -energyHighestOccupied)\n      }\n      const densitiesUnits = new Quantity(dosRenormalized, valueUnit).toSystem(units).value()\n      mins.push(Math.min(...densitiesUnits))\n      maxes.push(Math.max(...densitiesUnits))\n      const line = {\n        width: 2,\n        dash: lineStyles[iSpin],\n        color: lineColors[iMethod]\n      }\n      plotData.push(\n        {\n          x: densitiesUnits,\n          y: energies,\n          name: `${methodName}${spinName[iSpin]}`,\n          type: 'scatter',\n          mode: 'lines',\n          showlegend: (methodName !== '' || spinChannels === 2),\n          line: line\n        }\n      )\n    }\n  }\n\n  // Zero energy line in case Fermi energy (EF) is stored\n  const range = [Math.min(...mins), Math.max(...maxes)]\n  let referencedLayout\n  if (normalized) {\n    referencedLayout = {\n      yaxis: {\n        title: {\n          text: `Energy - E<sub>F</sub> (${energyUnit.toSystem(units).label()})`\n        },\n        zeroline: true\n      }\n    }\n  } else {\n    referencedLayout = {\n      yaxis: {\n        title: {\n          text: `Energy (${energyUnit.toSystem(units).label()})`\n        }\n      }\n    }\n  }\n  const zeroEnergyRefLayout = mergeObjects(initialLayout, referencedLayout)\n\n  // Compute the final layout\n  const computedLayout = mergeObjects(\n    {\n      xaxis: {\n        title: {\n          text: dosNormalize ? `${valueUnit.toSystem(units).label()}` : `states ${valueUnit.toSystem(units).label()}`\n        },\n        range: range\n      },\n      legend: {\n        font: {\n          size: 13\n        }\n      }\n    },\n    zeroEnergyRefLayout\n  )\n\n  return {\n    finalData: plotData,\n    finalLayout: computedLayout,\n    normalized: normalized\n  }\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useState, useMemo, useEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport { useTheme } from '@material-ui/core/styles'\nimport Plot from '../plotting/Plot'\nimport { withErrorHandler } from '../ErrorHandler'\nimport { Quantity } from '../units/Quantity'\nimport { Unit } from '../units/Unit'\nimport { getLineStyles } from '../plotting/common'\n\n/**\n * A thin wrapper for the Plot-component that is used for plotting energy-volume\n * curves.\n */\nconst energyUnit = new Unit('joule')\nconst volumeUnit = new Unit('meter**3')\n\nconst EnergyVolumeCurve = React.memo(({\n  data,\n  className,\n  units,\n  'data-testid': testID\n}) => {\n  const [finalData, setFinalData] = useState(!data ? data : undefined)\n  const theme = useTheme()\n\n  // Calculate indices that sort the data\n  const indices = useMemo(() => {\n    if (!data) {\n      return [undefined, undefined, undefined]\n    }\n\n    // Get indices that sort the data by volume\n    const volumes = data.data[0].volumes\n    const nPoints = data.data[0].volumes.length\n    const indices = new Array(nPoints)\n    for (let i = 0; i < nPoints; ++i) indices[i] = i\n    indices.sort((a, b) => {\n      return volumes[a] < volumes[b] ? -1 : volumes[a] > volumes[b] ? 1 : 0\n    })\n    return indices\n  }, [data])\n\n  // Side effect that runs when the data that is displayed should change. By\n  // running all this heavy stuff within useEffect (instead of e.g. useMemo),\n  // the first render containing the placeholders etc. can be done as fast as\n  // possible.\n  useEffect(() => {\n    if (!data) {\n      setFinalData(data)\n      return\n    }\n\n    const traces = []\n    let i = 0\n    const lineStyles = getLineStyles(data.data.length, theme)\n    for (const curve of data.data) {\n      const trace = {\n        x: new Quantity(indices.map(i => curve.volumes[i]), volumeUnit).toSystem(units).value(),\n        y: new Quantity(indices.map(i => curve.energies[i]), energyUnit).toSystem(units).value(),\n        name: curve.name,\n        visible: i === 0 || 'legendonly',\n        type: 'scatter',\n        line: lineStyles[i]\n      }\n      traces.push(trace)\n      ++i\n    }\n    setFinalData(traces)\n  }, [data, units, theme, indices])\n\n  const plotLayout = useMemo(() => {\n    if (!data) {\n      return null\n    }\n\n    return {\n      showlegend: true,\n      legend: {\n        x: 0.5,\n        y: 1,\n        xanchor: 'center'\n      },\n      xaxis: {\n        title: {\n          text: `Volume/atom (${volumeUnit.toSystem(units).label()})`\n        },\n        zeroline: false\n      },\n      yaxis: {\n        title: {\n          text: `Energy (${energyUnit.toSystem(units).label()})`\n        },\n        zeroline: false\n      }\n    }\n  }, [data, units])\n\n  return <Plot\n    data={finalData}\n    layout={plotLayout}\n    floatTitle=\"Energy volume curve\"\n    metaInfoLink={data?.m_path}\n    className={className}\n    data-testid={testID}\n  />\n})\n\nEnergyVolumeCurve.propTypes = {\n  data: PropTypes.oneOfType([\n    PropTypes.bool, // Set to False to show NoData component\n    PropTypes.shape({\n      data: PropTypes.arrayOf(PropTypes.shape({\n        volumes: PropTypes.arrayOf(PropTypes.number).isRequired,\n        energies: PropTypes.arrayOf(PropTypes.number).isRequired,\n        name: PropTypes.string.isRequired\n      })).isRequired,\n      m_path: PropTypes.string // Path of the section containing the data in the Archive\n    })\n  ]),\n  className: PropTypes.string,\n  units: PropTypes.object, // Contains the unit configuration\n  'data-testid': PropTypes.string\n}\n\nexport default withErrorHandler('Could not load energy volume curve.')(EnergyVolumeCurve)\n","import React, { useState, useCallback, useMemo } from 'react'\nimport PropTypes from 'prop-types'\nimport {\n  FormControlLabel,\n  FormControl,\n  RadioGroup,\n  Radio\n} from '@material-ui/core'\nimport { makeStyles } from '@material-ui/core/styles'\nimport Structure from '../visualization/Structure'\nimport BrillouinZone from '../visualization/BrillouinZone'\nimport BandStructure from '../visualization/BandStructure'\nimport Spectra from '../visualization/Spectra'\nimport DOS from '../visualization/DOS'\nimport { Quantity } from '../units/Quantity'\nimport { useUnitContext } from '../units/UnitContext'\nimport { electronicRange } from '../../config'\nimport EnergyVolumeCurve from '../visualization/EnergyVolumeCurve'\n\nconst useOverviewAtomsStyles = makeStyles({\n  root: {\n    width: '30rem',\n    height: '20rem',\n    margin: 'auto'\n  }\n})\nexport const OverviewAtoms = React.memo(({def, section}) => {\n  const style = useOverviewAtomsStyles()\n  const system = useMemo(() => ({\n    'species': section.species,\n    'cell': section.lattice_vectors\n      ? new Quantity(section.lattice_vectors, 'meter').to('angstrom').value()\n      : undefined,\n    'positions': new Quantity(section.positions, 'meter').to('angstrom').value(),\n    'pbc': section.periodic\n  }), [section])\n\n  return <Structure\n    className={style.root}\n    data={system}\n  ></Structure>\n})\nOverviewAtoms.propTypes = ({\n  def: PropTypes.object,\n  section: PropTypes.object,\n  units: PropTypes.object\n})\n\nconst useOverviewDOSStyles = makeStyles({\n  root: {\n    width: '20rem',\n    height: '40rem',\n    margin: 'auto'\n  }\n})\nexport const OverviewDOSElectronic = React.memo(({def, section, units}) => {\n  const style = useOverviewDOSStyles()\n  const data = useMemo(() => ([{\n    version: 'old',\n    energies: section.energies,\n    densities: section.total.map(dos => dos.value),\n    energy_highest_occupied: section.band_gap\n      ? Math.max(...section.band_gap.map(x => x.energy_highest_occupied))\n      : undefined\n  }]), [section])\n\n  return <DOS\n    className={style.root}\n    data={data}\n    units={units}\n    type=\"electronic\"\n  />\n})\nOverviewDOSElectronic.propTypes = ({\n  def: PropTypes.object,\n  section: PropTypes.object,\n  units: PropTypes.object\n})\n\nexport const OverviewDOSPhonon = React.memo(({def, section, units}) => {\n  const style = useOverviewDOSStyles()\n  const data = useMemo(() => ([{\n    energies: section.energies,\n    densities: section.total.map(dos => dos.value)\n  }]), [section])\n\n  return <DOS\n    className={style.root}\n    data={data}\n    units={units}\n    type=\"vibrational\"\n  />\n})\nOverviewDOSPhonon.propTypes = ({\n  def: PropTypes.object,\n  section: PropTypes.object,\n  units: PropTypes.object\n})\n\nconst useOverviewBandstructurePhononStyles = makeStyles({\n  root: {\n    width: '30rem',\n    height: '30rem',\n    margin: 'auto'\n  }\n})\nexport const OverviewBandstructurePhonon = React.memo(({def, section, units}) => {\n  const style = useOverviewBandstructurePhononStyles()\n  const data = useMemo(() => ([{\n    segment: section.segment,\n    reciprocal_cell: section.reciprocal_cell\n  }]), [section])\n\n  return <BandStructure\n    className={style.root}\n    data={data}\n    units={units}\n    type='vibrational'\n  />\n})\nOverviewBandstructurePhonon.propTypes = ({\n  def: PropTypes.object,\n  section: PropTypes.object,\n  units: PropTypes.object\n})\n\nconst useOverviewBandstructureElectronicStyles = makeStyles({\n  root: {\n    width: '30rem',\n    height: '30rem',\n    margin: 'auto'\n  },\n  radio: {\n    display: 'flex',\n    justifyContent: 'center'\n  }\n})\nexport const OverviewBandstructureElectronic = React.memo(({def, section, units}) => {\n  const [mode, setMode] = useState('bs')\n  const toggleMode = useCallback((event) => {\n    setMode(event.target.value)\n  }, [setMode])\n\n  const style = useOverviewBandstructureElectronicStyles()\n  const data = useMemo(() => ([{\n    segment: section.segment,\n    reciprocal_cell: section.reciprocal_cell,\n    energy_highest_occupied: section.band_gap\n      ? Math.max(...section.band_gap.map(x => x.energy_highest_occupied))\n      : undefined\n  }]), [section])\n  const layout = useMemo(() => ({\n    yaxis: {\n      autorange: false,\n      range: new Quantity(electronicRange, 'electron_volt').toSystem(units).value()\n    }\n  }), [units])\n\n  const bs = <BandStructure\n    className={style.root}\n    data={data}\n    layout={layout}\n    units={units}\n  />\n\n  return data[0].reciprocal_cell\n    ? <>\n      {mode === 'bs'\n        ? bs\n        : <BrillouinZone\n          className={style.root}\n          data={section}\n        />\n      }\n      <FormControl component=\"fieldset\" className={style.radio}>\n        <RadioGroup\n          row\n          aria-label=\"position\"\n          name=\"position\"\n          defaultValue=\"bs\"\n          onChange={toggleMode}\n          className={style.radio}\n        >\n          <FormControlLabel\n            value=\"bs\"\n            control={<Radio color=\"primary\" />}\n            label=\"Band structure\"\n            labelPlacement=\"end\"\n          />\n          <FormControlLabel\n            value=\"bz\"\n            control={<Radio color=\"primary\" />}\n            label=\"Brillouin zone\"\n            labelPlacement=\"end\"\n          />\n        </RadioGroup>\n      </FormControl>\n    </>\n    : bs\n})\nOverviewBandstructureElectronic.propTypes = ({\n  def: PropTypes.object,\n  section: PropTypes.object,\n  units: PropTypes.object\n})\n\nconst useOverviewSpectraStyles = makeStyles({\n  root: {\n    width: '30rem',\n    height: '15rem',\n    margin: 'auto'\n  }\n})\nexport const OverviewSpectra = React.memo(({def, section, units}) => {\n  const style = useOverviewSpectraStyles()\n\n  return <Spectra\n    className={style.root}\n    data={[section]}\n    layout={{yaxis: {autorange: true}}}\n    units={units}\n  />\n})\nOverviewSpectra.propTypes = ({\n  def: PropTypes.object,\n  section: PropTypes.object,\n  units: PropTypes.object\n})\n\nconst useOverviewEquationOfStateStyles = makeStyles({\n  root: {\n    width: '30rem',\n    height: '25rem',\n    margin: 'auto'\n  }\n})\nexport const OverviewEquationOfState = React.memo(({def, section, units}) => {\n  const style = useOverviewEquationOfStateStyles()\n  const data = [{\n    volumes: section.volumes,\n    energies: section.energies,\n    name: 'raw'\n  }]\n  section.eos_fit.forEach(fit => {\n    data.push({\n      volumes: section.volumes,\n      energies: fit.fitted_energies,\n      name: fit.function_name\n    })\n  })\n\n  return <EnergyVolumeCurve\n    className={style.root}\n    data={{data: data}}\n    units={units}\n  />\n})\nOverviewEquationOfState.propTypes = ({\n  def: PropTypes.object,\n  section: PropTypes.object,\n  units: PropTypes.object\n})\n\nexport const Overview = React.memo((props) => {\n  const {def} = props\n  const {units} = useUnitContext()\n  const path = window.location.href.split('/').pop().split(':')[0]\n\n  if (def.name === 'BandStructure' && path === 'band_structure_electronic') {\n    return <OverviewBandstructureElectronic {...props} units={units}/>\n  } else if (def.name === 'BandStructure' && path === 'band_structure_phonon') {\n    return <OverviewBandstructurePhonon {...props} units={units}/>\n  } else if (def.name === 'Atoms' && path === 'atoms') {\n    return <OverviewAtoms {...props} units={units} />\n  } else if (def.name === 'Dos' && path === 'dos_electronic') {\n    return <OverviewDOSElectronic {...props} units={units} />\n  } else if (def.name === 'Dos' && path === 'dos_phonon') {\n    return <OverviewDOSPhonon {...props} units={units}/>\n  } else if (def.name === 'Spectrum') {\n    return <OverviewSpectra {...props} units={units}/>\n  } else if (def.name === 'EquationOfState') {\n    return <OverviewEquationOfState {...props} units={units}/>\n  }\n  return null\n})\nOverview.propTypes = ({\n  def: PropTypes.object,\n  section: PropTypes.object\n})\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useMemo, useState, useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { Box, Button, Dialog, DialogActions, DialogContent, DialogTitle, Divider, IconButton, makeStyles, Tooltip, Typography } from '@material-ui/core'\nimport CodeIcon from '@material-ui/icons/Code'\nimport ReactJson from 'react-json-view'\nimport { CopyToClipboard } from 'react-copy-to-clipboard'\nimport ClipboardIcon from '@material-ui/icons/Assignment'\nimport Markdown from '../Markdown'\nimport { apiBase, appBase } from '../../config'\n\nexport const ApiDataContext = React.createContext()\n\nconst useCodeStyles = makeStyles(theme => ({\n  codeContainer: {\n    display: 'flex',\n    flexDirection: 'row',\n    alignItems: 'flex-start'\n  },\n  code: {\n    flexGrow: 1,\n    overflow: 'auto',\n    padding: '12px 18px',\n    borderRadius: 4,\n    backgroundColor: theme.palette.primary.veryLight,\n    fontSize: 16,\n    fontFamily: 'monospace',\n    whiteSpace: 'pre'\n  },\n  codeActions: {\n    marginTop: theme.spacing(3)\n  }\n}))\nexport const Code = React.memo(function Code({code}) {\n  const classes = useCodeStyles()\n  return <React.Fragment>\n    <div className={classes.codeContainer}>\n      <div className={classes.code}>\n        {code}\n      </div>\n      <div className={classes.codeActions}>\n        <CopyToClipboard text={code} onCopy={() => null}>\n          <Tooltip title=\"Copy to clipboard\">\n            <IconButton>\n              <ClipboardIcon />\n            </IconButton>\n          </Tooltip>\n        </CopyToClipboard>\n      </div>\n    </div>\n  </React.Fragment>\n})\nCode.propTypes = {\n  code: PropTypes.string\n}\n\n/**\n * Button that can display content outside the button DOM. This is important to\n * not trigger any button hover/click events on the child component.\n */\nexport const ContentButton = React.memo(function ContentButton(props) {\n  const {tooltip, children, buttonContent, ButtonComponent, ButtonProps} = props\n\n  const button = useMemo(() => {\n    return React.createElement(\n      ButtonComponent,\n      {...ButtonProps},\n      buttonContent\n    )\n  }, [ButtonComponent, buttonContent, ButtonProps])\n\n  return <React.Fragment>\n    {children}\n    {tooltip\n      ? <Tooltip title={tooltip}>{button}</Tooltip>\n      : button\n    }\n  </React.Fragment>\n})\nContentButton.propTypes = {\n  tooltip: PropTypes.string,\n  buttonContent: PropTypes.node,\n  ButtonComponent: PropTypes.elementType,\n  ButtonProps: PropTypes.object,\n  children: PropTypes.node\n}\n\nContentButton.defaultProps = {\n  ButtonComponent: IconButton\n}\n\n/**\n * Button that displays a simple dialog.\n */\nexport const DialogButton = React.memo(function DialogButton(props) {\n  const {tooltip, buttonComponent, icon, label, title, children, buttonProps, ...DialogProps} = props\n  const [open, setOpen] = useState(false)\n\n  return <ContentButton\n    tooltip={tooltip}\n    ButtonComponent={buttonComponent || (label ? Button : IconButton)}\n    ButtonProps={{...buttonProps, onClick: () => setOpen(true)}}\n    buttonContent={label || icon || <CodeIcon/>}\n  >\n    <Dialog {...DialogProps} open={open}>\n      {title && <DialogTitle>{title}</DialogTitle>}\n      <DialogContent>\n        {children}\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => setOpen(false)}>\n          Close\n        </Button>\n      </DialogActions>\n    </Dialog>\n  </ContentButton>\n})\nDialogButton.propTypes = {\n  tooltip: PropTypes.string,\n  icon: PropTypes.node,\n  title: PropTypes.string,\n  label: PropTypes.string,\n  buttonComponent: PropTypes.elementType,\n  buttonProps: PropTypes.object,\n  children: PropTypes.node\n}\n\nexport const SourceApiDialogButton = React.memo(function SourceApiDialogButton({description, children, buttonProps, ...props}) {\n  const help = `The information on this page was loaded from the NOMAD API. You can also use\n    the API to retrieve this information. Visit also our [API documentation](${appBase}/docs/api.html)\n    or [API dashboard](${apiBase}).`\n\n  return <DialogButton title=\"API\" tooltip=\"API\" buttonProps={buttonProps} {...props}>\n    <Markdown text={description || help} />\n    <SourceDialogDivider />\n    {children}\n  </DialogButton>\n})\nSourceApiDialogButton.propTypes = {\n  description: PropTypes.string,\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ]),\n  buttonProps: PropTypes.object\n}\n\nconst CopyToClipboardButton = React.memo(function CopyToClipboardButton({code}) {\n  return <CopyToClipboard text={code || ''} onCopy={() => null}>\n    <Tooltip title=\"Copy to clipboard\">\n      <IconButton>\n        <ClipboardIcon />\n      </IconButton>\n    </Tooltip>\n  </CopyToClipboard>\n})\nCopyToClipboardButton.propTypes = {\n  code: PropTypes.string\n}\n\nconst useSourceApiCallStyles = makeStyles(theme => ({\n  root: {},\n  request: {\n    width: '100%',\n    display: 'flex',\n    flexDirection: 'row',\n    fontSize: 16,\n    fontFamily: 'monospace',\n    alignItems: 'center'\n  },\n  method: {\n    minWidth: 60,\n    fontWeight: 'bold'\n  },\n  code: {\n    flexGrow: 1,\n    padding: '12px 18px',\n    overflow: 'auto',\n    borderRadius: 4,\n    backgroundColor: theme.palette.primary.veryLight,\n    whiteSpace: 'pre'\n  },\n  heading: {\n    marginTop: theme.spacing(2),\n    marginBottom: theme.spacing(1),\n    display: 'block'\n  }\n}))\nexport const SourceApiCall = React.memo(function ApiCall(props) {\n  const apiData = useContext(ApiDataContext)\n  const {method, url, description, body, response} = {...apiData, ...props}\n  const classes = useSourceApiCallStyles()\n  let formatedBody\n  if (body) {\n    // serialized json has \"private\" values that might contain circles removed\n    formatedBody = JSON.stringify(\n      body,\n      (name, value) => name.startsWith('_') ? undefined : value,\n      2\n    )\n  }\n\n  return <div className={classes.root}>\n    <Markdown text={description} />\n    <Typography className={classes.heading} variant=\"body1\"><b>Request</b></Typography>\n    <div className={classes.request}>\n      <span className={classes.method}>{method}</span>\n      <span className={classes.code}>{url}</span>\n      <CopyToClipboardButton code={url} />\n    </div>\n    {formatedBody && <div className={classes.request} style={{alignItems: 'start'}}>\n      <span className={classes.method}>&nbsp;</span>\n      <span className={classes.code}>{formatedBody}</span>\n      <CopyToClipboardButton code={formatedBody} />\n    </div>}\n    <Typography className={classes.heading} variant=\"body1\"><b>Response</b></Typography>\n    <SourceJson data={response} />\n  </div>\n})\nSourceApiCall.propTypes = {\n  description: PropTypes.string,\n  method: PropTypes.string,\n  url: PropTypes.string,\n  body: PropTypes.any,\n  response: PropTypes.any\n}\n\nexport const SourceJsonDialogButton = React.memo(function SourceJsonDialogButton({description, data, ...props}) {\n  return <DialogButton title=\"Json\" tooltip=\"Json data\" {...props}>\n    {description && <React.Fragment>\n      <Markdown text={description} />\n      <SourceDialogDivider />\n    </React.Fragment>}\n    <SourceJson data={data} />\n  </DialogButton>\n})\nSourceJsonDialogButton.propTypes = {\n  description: PropTypes.string,\n  data: PropTypes.any\n}\n\nconst useSourceJsonStyles = makeStyles(theme => ({\n  stickyContainer: {\n    zIndex: 1,\n    width: '100%',\n    height: 0,\n    position: 'sticky',\n    left: 0\n  },\n  actionContainer: {\n    position: 'relative'\n  },\n  action: {\n    position: 'absolute',\n    right: 0,\n    top: \"1rem\",\n    transform: 'translate(0, -50%)'\n  }\n}))\nexport const SourceJson = React.memo(({data, ...props}) => {\n  const styles = useSourceJsonStyles()\n  const dataToRender = typeof data === 'object' ? data : {data: data}\n  // serialized json has \"private\" values that might contain circles removed\n  // might still have circles and fail\n  let code = null\n  try {\n    code = JSON.stringify(data, (name, value) => name.startsWith('_') ? undefined : value, 2)\n  } catch {}\n\n  return <>\n    {code && <div className={styles.stickyContainer}>\n      <div className={styles.actionContainer}>\n        <div className={styles.action}>\n          <CopyToClipboardButton code={code} />\n        </div>\n      </div>\n    </div>}\n    <Box minHeight=\"2rem\" display=\"flex\" alignItems=\"center\">\n      <ReactJson\n        src={dataToRender}\n        enableClipboard={false}\n        collapsed={2}\n        displayObjectSize={false}\n        {...props}\n      />\n    </Box>\n  </>\n})\nSourceJson.propTypes = {\n  data: PropTypes.any\n}\n\nexport const SourceJsonCode = React.memo(function SourceJsonCode({data}) {\n  // serialized json has \"private\" values that might contain circles removed\n  const code = JSON.stringify(data, (name, value) => name.startsWith('_') ? undefined : value, 2)\n  return <Code code={code} />\n})\nSourceJsonCode.propTypes = {\n  data: PropTypes.object\n}\n\nexport const SourceDialogDivider = (props) => <Box marginY={2}><Divider/></Box>\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { Box, Button, Tooltip } from '@material-ui/core'\nimport ArrowDownIcon from '@material-ui/icons/ArrowDropDown'\nimport ArrowUpIcon from '@material-ui/icons/ArrowDropUp'\nimport LoadingButton from '../buttons/LoadingButton'\n\n/**\n * Displays simple pagination controls.\n */\nconst Pagination = React.memo(({\n  showMore,\n  showLess,\n  disableMore,\n  disableLess,\n  loadingMore,\n  onMore,\n  onLess,\n  variant,\n  'data-testid': testID,\n  ...rest\n}) => {\n  const moreIcon = {\n    'standard': null,\n    'down': <ArrowDownIcon />,\n    'up': <ArrowUpIcon />\n  }[variant]\n  const lessIcon = {\n    'standard': null,\n    'down': <ArrowUpIcon />,\n    'up': <ArrowDownIcon />\n  }[variant]\n  return <Box display=\"flex\" {...rest} data-testid={testID}>\n    {showMore && <Tooltip title={loadingMore ? 'Loading...' : disableMore ? 'No more values available' : ''}>\n      <span>\n        <LoadingButton\n          size=\"small\"\n          onClick={onMore}\n          loading={loadingMore}\n          disabled={disableMore}\n        >{moreIcon}Show more\n        </LoadingButton>\n      </span>\n    </Tooltip>}\n    {showLess && <Button size=\"small\" disabled={disableLess}\n      onClick={onLess}\n    >{lessIcon}Show less\n    </Button>}\n  </Box>\n})\n\nPagination.propTypes = {\n  showMore: PropTypes.bool, // Show 'More' button\n  showLess: PropTypes.bool, // Show 'Less' button\n  disableMore: PropTypes.bool, // Disable more button\n  disableLess: PropTypes.bool, // Disable less button\n  loadingMore: PropTypes.bool, // Show loading indicator in 'More' button\n  onMore: PropTypes.func, // 'More' button handler\n  onLess: PropTypes.func, // 'Less' button handler\n  /*\n   * Visualization variant. 'standard' means no directional hints, 'up' and\n   * 'down' will display directional hint icons in the buttons.\n   */\n  variant: PropTypes.oneOf(['standard', 'up', 'down']),\n  'data-testid': PropTypes.string\n}\n\nPagination.defaultProps = {\n  variant: 'standard'\n}\n\nexport default Pagination\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useCallback, useState} from 'react'\nimport PropTypes from 'prop-types'\nimport {Box, makeStyles} from '@material-ui/core'\nimport {configState, FoldableList} from '../archive/ArchiveBrowser'\nimport grey from \"@material-ui/core/colors/grey\"\nimport {getDisplayLabel} from \"../../utils\"\nimport {useRecoilValue} from \"recoil\"\n\nconst useListEditQuantityStyles = makeStyles(theme => ({\n  root: {\n    margin: `0 -${theme.spacing(1)}px`,\n    padding: `0 ${theme.spacing(1)}px`,\n    width: '100%',\n    display: 'flex',\n    flexDirection: 'row',\n    wrap: 'nowrap',\n    alignItems: 'center'\n  },\n  title: {\n    flexGrow: 1,\n    color: grey[600],\n    textDecoration: 'none',\n    margin: `0 -${theme.spacing(1)}px`,\n    whiteSpace: 'nowrap',\n    display: 'flex',\n    fontWeight: 'bold'\n  },\n  selected: {\n    whiteSpace: 'nowrap'\n  },\n  unSelected: {\n    '&:hover': {\n      backgroundColor: grey[300]\n    }\n  },\n  actions: {}\n}))\n\nconst ListEditQuantity = React.memo(function ListEditQuantity({value, onChange, component, quantityDef, ...props}) {\n  const classes = useListEditQuantityStyles()\n  const [open, setOpen] = useState(true)\n  const fixedLength = Number(quantityDef.shape?.[0])\n  const hasFixedLength = !isNaN(fixedLength)\n  const config = useRecoilValue(configState)\n  const label = getDisplayLabel(quantityDef, true, config?.showMeta)\n\n  let renderValue\n  if (hasFixedLength) {\n    renderValue = (value && [...value]) || Array(fixedLength).fill(undefined)\n  } else {\n    renderValue = (value && [...value]) || []\n    renderValue.push(undefined)\n  }\n\n  const handleChange = useCallback((item, index) => {\n    if (onChange) {\n      let newValue = Array.isArray(item) ? [\n        ...(renderValue.slice(0, index)),\n        ...item,\n        ...(renderValue.slice(index + 1))\n      ] : [\n        ...(renderValue.slice(0, index)),\n        item,\n        ...(renderValue.slice(index + 1))\n      ]\n\n      if (!hasFixedLength) {\n        newValue = newValue.filter(value => value !== undefined && value !== null && value !== '')\n      } else {\n        for (let i = newValue.length - 1; i >= fixedLength; i--) {\n          newValue = newValue.slice(0, i)\n        }\n      }\n      onChange(newValue)\n    }\n  }, [onChange, renderValue, fixedLength, hasFixedLength])\n\n  const handleClick = useCallback(() => {\n    setOpen(open => !open)\n  }, [])\n\n  return <Box marginTop={1} marginBottom={1}>\n    <FoldableList\n      label={label}\n      className={classes}\n      open={open}\n      onClick={handleClick}\n      nTop={10}\n      nBottom={0}\n      pageSize={10}\n    >\n      {renderValue.map((item, index) => (\n        <Box marginTop={1} marginLeft={2} marginRight={2} key={index}>{React.createElement(component, {\n          value: item,\n          onChange: value => handleChange(value, index),\n          quantityDef: quantityDef,\n          index: index,\n          ...props\n        })}</Box>\n      ))}\n    </FoldableList>\n  </Box>\n})\nListEditQuantity.propTypes = {\n  quantityDef: PropTypes.object.isRequired,\n  value: PropTypes.array,\n  onChange: PropTypes.func,\n  component: PropTypes.elementType.isRequired\n}\n\nexport default ListEditQuantity\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useCallback, useEffect, useState} from 'react'\nimport PropTypes from 'prop-types'\nimport {dateFormat} from '../../config'\nimport {KeyboardDatePicker, KeyboardTimePicker} from '@material-ui/pickers'\nimport AccessTimeIcon from '@material-ui/icons/AccessTime'\nimport {getDisplayLabel} from \"../../utils\"\nimport {useRecoilValue} from \"recoil\"\nimport {configState} from \"../archive/ArchiveBrowser\"\n\nexport const DateTimeEditQuantity = React.memo((props) => {\n  const {quantityDef, value, onChange, format, time, ...otherProps} = props\n  const [dateValue, setDateValue] = useState(value || null)\n  const config = useRecoilValue(configState)\n  const label = getDisplayLabel(quantityDef, true, config?.showMeta)\n\n  useEffect(() => {\n    setDateValue(date => value\n      ? (date?.toJSON?.() || date) === value ? date : value\n      : null\n    )\n  }, [value])\n\n  const handleChange = useCallback((date) => {\n    setDateValue(date)\n    if (onChange) {\n      if (date === null) {\n        onChange(undefined)\n      } else {\n        const jsonValue = date?.toJSON()\n        if (jsonValue) {\n          onChange(jsonValue)\n        }\n      }\n    }\n  }, [onChange, setDateValue])\n\n  const renderProps = {\n    size: 'small',\n    variant: 'inline',\n    inputVariant: 'filled',\n    fullWidth: true,\n    label: label,\n    value: dateValue,\n    onChange: handleChange,\n    ...otherProps\n  }\n\n  if (time) {\n    return <KeyboardTimePicker\n      {...renderProps}\n      format={format || `HH:mm`}\n      keyboardIcon={<AccessTimeIcon />}\n    />\n  } else {\n    return <KeyboardDatePicker\n      {...renderProps}\n      format={format || `${dateFormat} HH:mm`}\n    />\n  }\n})\nDateTimeEditQuantity.propTypes = {\n  quantityDef: PropTypes.object.isRequired,\n  value: PropTypes.string,\n  onChange: PropTypes.func,\n  format: PropTypes.string,\n  time: PropTypes.bool\n}\n\nexport const DateEditQuantity = React.memo((props) => {\n  return <DateTimeEditQuantity {...props} format={dateFormat}/>\n})\nDateEditQuantity.propTypes = {\n  quantityDef: PropTypes.object.isRequired,\n  value: PropTypes.string,\n  onChange: PropTypes.func\n}\n\nexport const TimeEditQuantity = React.memo((props) => {\n  return <DateTimeEditQuantity time {...props}/>\n})\nTimeEditQuantity.propTypes = {\n  quantityDef: PropTypes.object.isRequired,\n  value: PropTypes.string,\n  onChange: PropTypes.func\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useCallback, useState} from 'react'\nimport {\n  Box,\n  Dialog,\n  DialogContent,\n  DialogTitle,\n  IconButton,\n  InputAdornment,\n  makeStyles,\n  TextField\n} from '@material-ui/core'\nimport PropTypes from 'prop-types'\nimport HelpOutlineIcon from '@material-ui/icons/HelpOutline'\nimport Markdown from '../Markdown'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport Button from '@material-ui/core/Button'\nimport LaunchIcon from '@material-ui/icons/Launch'\nimport {getDisplayLabel} from \"../../utils\"\nimport {useRecoilValue} from \"recoil\"\nimport {configState} from \"../archive/ArchiveBrowser\"\n\nconst HelpDialog = React.memo(({title, description}) => {\n  const [open, setOpen] = useState(false)\n\n  return <React.Fragment>\n    {description && <IconButton size=\"small\" onClick={() => setOpen(true)}>\n      {<HelpOutlineIcon fontSize='small'/>}\n    </IconButton>}\n    {open && <Dialog open={open}>\n      <DialogTitle>\n        {title}\n      </DialogTitle>\n      <DialogContent>\n        <Markdown>{description}</Markdown>\n      </DialogContent>\n      <DialogActions>\n        <span style={{flexGrow: 1}} />\n        <Button onClick={() => setOpen(false)} color=\"secondary\">\n          Close\n        </Button>\n      </DialogActions>\n\n    </Dialog>}\n  </React.Fragment>\n})\nHelpDialog.propTypes = {\n  title: PropTypes.string,\n  description: PropTypes.string\n}\n\nconst useHelpAdornmentStyles = makeStyles(theme => ({\n  root: {},\n  withOtherAdornment: {\n    marginRight: theme.spacing(3)\n  }\n}))\n\nexport const HelpAdornment = React.memo(({title, description, withOtherAdornment}) => {\n  const classes = useHelpAdornmentStyles()\n  return <InputAdornment\n    position=\"end\"\n    className={withOtherAdornment ? classes.withOtherAdornment : classes.root}\n  >\n    <HelpDialog title={title} description={description}/>\n  </InputAdornment>\n})\nHelpAdornment.propTypes = {\n  withOtherAdornment: PropTypes.bool,\n  title: PropTypes.string,\n  description: PropTypes.string\n}\n\nconst useWithHelpStyles = makeStyles(theme => ({\n  root: {\n    width: '100%',\n    '&:not(:hover)': {\n      '& #help': {\n        display: 'none'\n      }\n    }\n  }\n}))\n\nexport const WithHelp = React.memo((props) => {\n  const {label, helpDescription, ...otherProps} = props\n  const classes = useWithHelpStyles()\n  return <Box display=\"flex\" alignItems=\"center\" className={classes.root}>\n    <Box flexGrow={1} {...otherProps}/>\n    {helpDescription && (\n      <Box>\n        <div id=\"help\">\n          <HelpDialog title={label} description={helpDescription} />\n        </div>\n      </Box>\n    )}\n  </Box>\n})\nWithHelp.propTypes = {\n  label: PropTypes.string,\n  helpDescription: PropTypes.string\n}\n\nexport function getFieldProps(quantityDef) {\n  const eln = quantityDef?.m_annotations?.eln\n  const {component, ...elnProps} = eln?.[0] || {}\n  elnProps.unit = elnProps.unit || quantityDef.unit\n  return {\n    helpDescription: quantityDef.description,\n    ...elnProps\n  }\n}\n\nexport const TextFieldWithHelp = React.memo(React.forwardRef((props, ref) => {\n  const {withOtherAdornment, label, helpDescription, 'data-testid': TestId, ...otherProps} = props\n  const classes = useWithHelpStyles()\n  return <TextField\n    inputRef={ref}\n    className={classes.root}\n    InputProps={(helpDescription && {endAdornment: (\n      <div id=\"help\">\n        <HelpAdornment title={label} description={helpDescription} withOtherAdornment={withOtherAdornment}/>\n      </div>\n    )})}\n    label={label}\n    data-testid={TestId}\n    {...otherProps}\n    value={otherProps.value || ''}\n  />\n}))\nTextFieldWithHelp.propTypes = {\n  withOtherAdornment: PropTypes.bool,\n  label: PropTypes.string,\n  value: PropTypes.string,\n  helpDescription: PropTypes.string,\n  'data-testid': PropTypes.string\n}\n\nexport const StringEditQuantity = React.memo((props) => {\n  const {quantityDef, onChange, ...otherProps} = props\n  const config = useRecoilValue(configState)\n  const label = getDisplayLabel(quantityDef, true, config?.showMeta)\n\n  const handleChange = useCallback((value) => {\n    if (onChange) {\n      onChange(value === '' ? undefined : value)\n    }\n  }, [onChange])\n  return <TextFieldWithHelp\n    fullWidth variant='filled' size='small'\n    onChange={event => handleChange(event.target.value)}\n    {...getFieldProps(quantityDef)}\n    {...otherProps}\n    label={label}\n  />\n})\nStringEditQuantity.propTypes = {\n  quantityDef: PropTypes.object.isRequired,\n  value: PropTypes.string,\n  onChange: PropTypes.func\n}\n\nexport const StringField = React.memo((props) => {\n  const {onChange, ...otherProps} = props\n\n  const handleChange = useCallback(event => {\n    const value = event.target.value\n    if (onChange) {\n      onChange(value === '' ? undefined : value)\n    }\n  }, [onChange])\n\n  return <TextFieldWithHelp\n    fullWidth variant='filled' size='small'\n    onChange={handleChange}\n    {...otherProps}\n  />\n})\nStringField.propTypes = {\n  onChange: PropTypes.func\n}\n\nexport const TextFieldWithLinkButton = React.memo(React.forwardRef((props, ref) => {\n  const {withOtherAdornment, label, value, helpDescription, 'data-testid': TestId, ...otherProps} = props\n  const classes = useWithHelpStyles()\n\n  const validateURL = useCallback((value) => {\n    try {\n      return Boolean(new URL(value))\n    } catch (e) {\n      return false\n    }\n  }, [])\n\n  return <TextField\n    defaultValue={value}\n    error={value !== undefined && !validateURL(value)}\n    helperText={value === undefined || validateURL(value) ? '' : 'Invalid URL string!'}\n    inputRef={ref}\n    className={classes.root}\n    InputProps={{endAdornment:\n      <>\n        { helpDescription &&\n        <div id=\"help\">\n          <HelpAdornment title={label} description={helpDescription} withOtherAdornment={withOtherAdornment}/>\n        </div>\n        }\n        {\n          validateURL(value) &&\n          <IconButton aria-label=\"open_link\" onClick={() => window.open(value, '_blank')}>\n            <LaunchIcon />\n          </IconButton>\n        }\n      </>\n    }}\n    label={label}\n    data-testid={'URLEditQuantity'}\n    {...otherProps}\n  />\n}))\nTextFieldWithLinkButton.propTypes = {\n  withOtherAdornment: PropTypes.bool,\n  label: PropTypes.string,\n  value: PropTypes.string,\n  helpDescription: PropTypes.string,\n  'data-testid': PropTypes.string\n}\n\nexport const URLEditQuantity = React.memo((props) => {\n  const {quantityDef, onChange, ...otherProps} = props\n  const config = useRecoilValue(configState)\n  const label = getDisplayLabel(quantityDef, true, config?.showMeta)\n\n  const handleChange = useCallback((value) => {\n    if (onChange) {\n      onChange(value === '' ? undefined : value)\n    }\n  }, [onChange])\n\n  return <TextFieldWithLinkButton\n    fullWidth variant='filled' size='small'\n    onChange={event => handleChange(event.target.value)}\n    {...getFieldProps(quantityDef)}\n    {...otherProps}\n    label={label}\n  />\n})\nURLEditQuantity.propTypes = {\n  quantityDef: PropTypes.object.isRequired,\n  value: PropTypes.string,\n  onChange: PropTypes.func\n}\n","import {useErrors} from \"../errors\"\nimport {useMemo} from \"react\"\nimport {Unit} from \"./Unit\"\nimport {useUnitContext} from \"./UnitContext\"\nimport {getFieldProps} from \"../editQuantity/StringEditQuantity\"\n\nexport function useDisplayUnit(quantityDef) {\n  const {units} = useUnitContext()\n  const {raiseError} = useErrors()\n  const defaultUnit = useMemo(() => quantityDef.unit && new Unit(quantityDef.unit), [quantityDef])\n  const dimension = defaultUnit && defaultUnit.dimension(false)\n  const {defaultDisplayUnit: deprecatedDefaultDisplayUnit} = getFieldProps(quantityDef)\n  const defaultDisplayUnit = quantityDef?.m_annotations?.display?.[0]?.unit || deprecatedDefaultDisplayUnit\n\n  const displayUnitObj = useMemo(() => {\n    if (!dimension) return\n    let defaultDisplayUnitObj\n\n    // TODO: If we enable the new 'Schema' scope in the unit context, we should\n    // prioritize those values there. But for now we just read unit info from\n    // the schema.\n\n    // If a default display unit has been defined, use it instead\n    if (defaultDisplayUnit) {\n      try {\n        defaultDisplayUnitObj = new Unit(defaultDisplayUnit)\n      } catch (e) {\n        raiseError(`The provided defaultDisplayUnit for ${quantityDef.name} field is not valid.`)\n      }\n      if (defaultDisplayUnitObj.dimension(true) !== defaultUnit.dimension(true)) {\n        raiseError(`The provided defaultDisplayUnit for ${quantityDef.name} has incorrect dimensionality for this field.`)\n      }\n    // Use the global unit system defined in the schema\n    } else {\n      defaultDisplayUnitObj = new Unit(defaultUnit).toSystem(units)\n    }\n\n    return defaultDisplayUnitObj\n  }, [defaultDisplayUnit, defaultUnit, dimension, quantityDef, raiseError, units])\n\n  return displayUnitObj\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useCallback, useEffect, useMemo, useRef, useState} from 'react'\nimport {TextField, makeStyles, Box, Checkbox, Tooltip} from '@material-ui/core'\nimport Autocomplete from '@material-ui/lab/Autocomplete'\nimport PropTypes from 'prop-types'\nimport {Quantity} from '../units/Quantity'\nimport {parse} from '../units/common'\nimport {Unit} from '../units/Unit'\nimport {getUnits} from '../units/UnitContext'\nimport {debounce, isNil} from 'lodash'\nimport {TextFieldWithHelp, getFieldProps} from './StringEditQuantity'\nimport {useDisplayUnit} from \"../units/useDisplayUnit\"\nimport {getDisplayLabel} from \"../../utils\"\nimport {useRecoilValue} from \"recoil\"\nimport {configState} from \"../archive/ArchiveBrowser\"\n\nexport const NumberField = React.memo((props) => {\n  const {onChange, onInputChange, dimension, value, dataType, minValue, unit, maxValue, displayUnit, convertInPlace, debounceTime, ...otherProps} = props\n  const [error, setError] = useState('')\n  const previousValue = useRef('')\n  const previousNumber = useRef()\n  const previousUnitLabel = useRef(displayUnit?.label())\n  const previousNumberPart = useRef('')\n  const [inputValue, setInputValue] = useState('')\n\n  const fixDigits = useCallback((value) => {\n    return value.toPrecision(15)\n      .replace(/0+(e|$)/, '$1')\n      .replace(/\\.$/, '')\n      .replace(/\\.e/, 'e')\n  }, [])\n\n  const getStoredValue = useCallback((value, displayUnit) => {\n    const valueInBaseUnit = (isNil(value) || isNil(unit))\n      ? value\n      : new Quantity(value, displayUnit).to(unit).value()\n    return valueInBaseUnit && fixDigits(Number(valueInBaseUnit))\n  }, [fixDigits, unit])\n\n  // Whenever a new value arrives or the units change, change the text\n  // accordingly. If the field is associated with a unit and the same numerical\n  // value as set previously comes back with the same unit, preserve the\n  // formatting by reusing the saved input text. Fields that do not have a unit\n  // simply take in the new value.\n  useEffect(() => {\n    if (!isNil(unit)) {\n      if (convertInPlace) {\n        let newVal\n        if (!isNil(value) && value === previousNumber.current && displayUnit?.label() === previousUnitLabel.current) {\n          newVal = previousNumberPart.current\n        } else if (isNil(value) || isNaN(value)) {\n          newVal = ''\n        } else if (unit && displayUnit) {\n          newVal = new Quantity(value, unit).to(displayUnit).value()\n        }\n        previousUnitLabel.current = displayUnit?.label()\n        previousNumber.current = value\n        previousNumberPart.current = newVal\n        const inputValue = newVal && fixDigits(Number(newVal))\n        previousValue.current = inputValue\n        setInputValue(inputValue)\n        onInputChange(inputValue)\n      }\n    } else {\n      const inputValue = (isNil(value) || isNaN(value)) ? '' : String(value)\n      previousValue.current = inputValue\n      setInputValue(inputValue)\n    }\n  }, [value, displayUnit, unit, convertInPlace, onInputChange, fixDigits])\n\n  // Given the text input, returns a the extracted number, unit and possible\n  // errors.\n  const parseInput = useCallback((input) => {\n    if (isNil(input) || input === '') {\n      previousNumberPart.current = ''\n      return {}\n    }\n\n    // Try to parse the quantity. Value is required, unit is optional.\n    const {unit: parsedUnit, value, valueString, error} = parse(input, {dimension, requireValue: true})\n    previousNumberPart.current = valueString\n    if (parsedUnit) {\n      previousUnitLabel.current = parsedUnit.label()\n    }\n    if (error) {\n      return {error}\n    }\n\n    // Validate number datatype\n    let isValid = true\n    if (['int64', 'int32', 'int'].includes(dataType)) {\n      isValid = Number.isInteger(value)\n    } else if (['uint64', 'uint32', 'uint'].includes(dataType)) {\n      isValid = Number.isInteger(value) && value >= 0\n    } else if (['float64', 'float32', 'float'].includes(dataType)) {\n      isValid = !isNaN(value)\n    }\n    if (!isValid) {\n      return {error: `Enter a valid numerical value with datatype '${dataType}'`}\n    }\n\n    // Validate number range\n    const storingValue = Number(getStoredValue(value, parsedUnit || displayUnit))\n    if (!isNaN(storingValue)) {\n      if (!isNaN(maxValue) && maxValue < storingValue) {\n        return {error: `Enter a value that is equal or smaller than ${maxValue}` + (unit ? ` (${unit})` : '')}\n      }\n      if (!isNaN(minValue) && minValue > storingValue) {\n        return {error: `Enter a value that is equal or larger than ${minValue}` + (unit ? ` (${unit})` : '')}\n      }\n    }\n\n    return {value: value, unit: parsedUnit}\n  }, [dataType, dimension, displayUnit, getStoredValue, maxValue, minValue, unit])\n\n  // The final handler for text input change\n  const handleChange = useCallback((inputValue) => {\n    // If the input has not been changed meaningfully, do nothing.\n    const trimmed = inputValue?.trim()\n    if (trimmed === previousValue.current) {\n      return\n    }\n\n    // Store the new value in a ref, reset errors\n    previousValue.current = trimmed\n    setError('')\n\n    // Try to interpret the value, if a meaningful value was returned, send the\n    // new value in a normalized form to the handler.\n    const parsedInput = parseInput(trimmed)\n    const {value: number, error} = parsedInput\n    const newUnit = parsedInput.unit || displayUnit\n\n    if (error) {\n      setError(error)\n    } else {\n      if (!convertInPlace) {\n        setInputValue(previousNumberPart.current)\n        onInputChange(previousNumberPart.current)\n      }\n      if (onChange) {\n        const storedValue = getStoredValue(number, newUnit)\n        previousNumber.current = storedValue\n        const numberedStoredValue = Number(storedValue)\n        onChange(!isNaN(numberedStoredValue) ? numberedStoredValue : undefined, newUnit)\n        onInputChange(number)\n      }\n    }\n  }, [parseInput, displayUnit, convertInPlace, onChange, onInputChange, getStoredValue])\n\n  // Routes text field changes to a handler after a debounce time\n  const debouncedHandleChange = useMemo(() => debounce(handleChange, 500), [handleChange])\n\n  // When input changes, saves the entered text into a state and queues a\n  // processing event with debounce time.\n  const handleInputChange = useCallback(event => {\n    setInputValue(event.target.value)\n    if (debounceTime) {\n      debouncedHandleChange(event.target.value)\n    }\n  }, [debounceTime, debouncedHandleChange])\n\n  // Request immediate validation on blur\n  const handleBlur = useCallback(() => {\n    handleChange(inputValue)\n  }, [handleChange, inputValue])\n\n  return <TextFieldWithHelp\n    fullWidth variant='filled' size='small'\n    value={String(inputValue)}\n    onBlur={handleBlur}\n    error={!!error}\n    helperText={error}\n    onChange={handleInputChange}\n    onKeyDown={(event) => { if (event.key === 'Enter') handleChange(inputValue) }}\n    data-testid='number-edit-quantity-value'\n    {...otherProps}\n  />\n})\nNumberField.propTypes = {\n  onChange: PropTypes.func.isRequired,\n  onInputChange: PropTypes.func.isRequired,\n  maxValue: PropTypes.number,\n  minValue: PropTypes.number,\n  dataType: PropTypes.string,\n  value: PropTypes.number,\n  unit: PropTypes.string,\n  displayUnit: PropTypes.object,\n  dimension: PropTypes.string,\n  convertInPlace: PropTypes.bool,\n  debounceTime: PropTypes.number\n}\n\nexport const NumberEditQuantity = React.memo((props) => {\n  const {quantityDef, value, onChange, ...otherProps} = props\n  const defaultUnit = useMemo(() => quantityDef.unit && new Unit(quantityDef.unit), [quantityDef])\n  const dimension = defaultUnit && defaultUnit.dimension(false)\n  const dimensionBase = defaultUnit && defaultUnit.dimension(true)\n  const [checked, setChecked] = useState(true)\n  const [displayedValue, setDisplayedValue] = useState(true)\n  const {defaultDisplayUnit: deprecatedDefaultDisplayUnit, ...fieldProps} = getFieldProps(quantityDef)\n  const displayUnit = useDisplayUnit(quantityDef)\n  const config = useRecoilValue(configState)\n  const label = getDisplayLabel(quantityDef, true, config?.showMeta)\n  const [unit, setUnit] = useState(displayUnit)\n\n  // Set the unit if display unit changes\n  useEffect(() => {\n    setUnit(displayUnit)\n  }, [displayUnit])\n\n  // Get a list of unit options for this field\n  const options = useMemo(() => {\n    const units = [...getUnits(dimension)].map(x => new Unit(x).label())\n    unit && units.push(unit.label())\n    defaultUnit && units.push(defaultUnit.label())\n    displayUnit && units.push(displayUnit.label())\n    return [...new Set(units)]\n  }, [displayUnit, defaultUnit, dimension, unit])\n\n  // Handle a change in NumberField input\n  const handleChange = useCallback((value, unit) => {\n    onChange(value)\n    setUnit(unit)\n  }, [onChange])\n\n  // Handle a change in NumberField input\n  const handleInputChange = useCallback((displayedValue) => {\n    setDisplayedValue(displayedValue)\n  }, [])\n\n  // Handle a change in the unit dialog\n  const handleUnitChange = useCallback((newUnit) => {\n    if (!checked && quantityDef.unit && newUnit && !isNil(value)) {\n      const storedValue = new Quantity(Number(displayedValue), newUnit).to(quantityDef.unit).value()\n      onChange(storedValue)\n    }\n    setUnit(new Unit(newUnit))\n  }, [checked, displayedValue, onChange, quantityDef.unit, value])\n\n  return <Box display='flex'>\n    <NumberField\n      value={value}\n      onChange={handleChange}\n      onInputChange={handleInputChange}\n      dimension={dimension}\n      convertInPlace={checked}\n      unit={quantityDef?.unit}\n      displayUnit={unit}\n      dataType={quantityDef.type?.type_data}\n      {...fieldProps}\n      {...otherProps}\n      label={label}\n    />\n    {unit && (\n      <Box display='flex'>\n        <Tooltip title={'If checked, numeric value is converted when the unit is changed.'}>\n          <Checkbox\n            onChange={event => setChecked(event.target.checked)}\n            color=\"primary\"\n            checked={checked}\n          />\n        </Tooltip>\n        <UnitSelect options={options} unit={unit} dimension={dimensionBase} onChange={handleUnitChange}/>\n      </Box>\n    )}\n  </Box>\n})\nNumberEditQuantity.propTypes = {\n  quantityDef: PropTypes.object.isRequired,\n  value: PropTypes.number,\n  onChange: PropTypes.func\n}\n\nexport const useUnitSelectStyles = makeStyles(theme => ({\n  root: {\n    width: '150px'\n  }\n}))\n\nexport const UnitSelect = React.memo(({options, unit, onChange, dimension, disabled}) => {\n  const classes = useUnitSelectStyles()\n  const [error, setError] = useState()\n  const [value, setValue] = useState(unit.label())\n  const [open, setOpen] = useState(false)\n\n  // Set the input value when unit changes\n  useEffect(() => {\n    unit && setValue(unit.label())\n  }, [unit])\n\n  // Validate input and submit unit if valid\n  const submit = useCallback((val) => {\n    const {unit, error} = parse(val, {dimension, requireUnit: true})\n    if (error) {\n      setError(error)\n    } else {\n      onChange(unit)\n    }\n  }, [dimension, onChange])\n\n  const handleInputChange = useCallback((event, value) => {\n    setError()\n    setValue(value)\n  }, [])\n\n  const handleOptionChange = useCallback((event, value) => {\n    setError()\n    submit(value)\n  }, [submit])\n\n  const finalOptions = useMemo(() => {\n    return options\n  }, [options])\n\n  // Submit on enter\n  const handleEnter = useCallback((event) => {\n    if (event.key === 'Enter') {\n      setOpen(false)\n      submit(value)\n      event.stopPropagation()\n      event.preventDefault()\n    }\n  }, [submit, value])\n\n  return <Autocomplete\n    className={classes.root}\n    size='small'\n    freeSolo\n    disabled={disabled}\n    forcePopupIcon\n    disableClearable\n    value={value}\n    options={finalOptions}\n    getOptionLabel={(option) => option}\n    filterOptions={(options) => options}\n    onInputChange={handleInputChange}\n    onChange={handleOptionChange}\n    open={open}\n    onOpen={() => { if (value.trim() !== '') { setOpen(true) } }}\n    onClose={() => setOpen(false)}\n    onBlur={() => submit(value)}\n    renderInput={(params) => <TextField\n      {...params}\n      label=\"Unit\"\n      data-testid = 'number-edit-quantity-unit'\n      variant=\"filled\"\n      error={!!error}\n      helperText={error}\n      onKeyDown={handleEnter}\n      InputProps={{\n        ...params.InputProps\n        // endAdornment: <HelpAdornment title={'Moi'} description={'Terve'}/>\n      }}\n    />}\n  />\n})\nUnitSelect.propTypes = {\n  options: PropTypes.arrayOf(PropTypes.string),\n  unit: PropTypes.object.isRequired,\n  dimension: PropTypes.string.isRequired,\n  onChange: PropTypes.func,\n  disabled: PropTypes.bool\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useCallback} from 'react'\nimport {MenuItem} from '@material-ui/core'\nimport PropTypes from 'prop-types'\nimport {getFieldProps, TextFieldWithHelp} from './StringEditQuantity'\nimport AutoComplete from '@material-ui/lab/Autocomplete'\nimport {getDisplayLabel} from \"../../utils\"\nimport {useRecoilValue} from \"recoil\"\nimport {configState} from \"../archive/ArchiveBrowser\"\n\nexport const EnumEditQuantity = React.memo((props) => {\n  const {quantityDef, value, onChange, suggestions, ...otherProps} = props\n  const fieldProps = getFieldProps(quantityDef)\n  const config = useRecoilValue(configState)\n  const label = getDisplayLabel(quantityDef, true, config?.showMeta)\n\n  const handleChange = useCallback(value => {\n    if (onChange) {\n      onChange(value === '' ? undefined : value)\n    }\n  }, [onChange])\n\n  if ((quantityDef.type?.type_kind === 'python' && quantityDef.type?.type_data === 'str') || quantityDef.type === undefined) {\n    return <AutoComplete\n      freeSolo\n      options={suggestions || []}\n      onChange={(event, value) => handleChange(value)}\n      onBlur={(event) => handleChange(event.target.value)}\n      ListboxProps={{style: {maxHeight: '150px'}}}\n      value={value || null}\n      renderInput={params => (\n        <TextFieldWithHelp\n          {...params}\n          variant='filled' size='small' fullWidth\n          {...fieldProps}\n          {...otherProps}\n          label={label}\n        />\n      )}\n    />\n  }\n\n  return <TextFieldWithHelp\n    select variant='filled' size='small' withOtherAdornment fullWidth\n    value={value || ''}\n    onChange={event => handleChange(event.target.value)}\n    {...fieldProps}\n    {...otherProps}\n    label={label}\n  >\n    {quantityDef.type?.type_data.map(item => (\n      <MenuItem value={item} key={item}>\n        {item}\n      </MenuItem>\n    ))}\n  </TextFieldWithHelp>\n})\nEnumEditQuantity.propTypes = {\n  quantityDef: PropTypes.object.isRequired,\n  value: PropTypes.string,\n  onChange: PropTypes.func,\n  suggestions: PropTypes.arrayOf(PropTypes.string)\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useCallback} from 'react'\nimport PropTypes from 'prop-types'\nimport AutoComplete from '@material-ui/lab/Autocomplete'\nimport {getFieldProps, TextFieldWithHelp} from './StringEditQuantity'\nimport {getDisplayLabel} from \"../../utils\"\nimport {useRecoilValue} from \"recoil\"\nimport {configState} from \"../archive/ArchiveBrowser\"\n\nexport const AutocompleteEditQuantity = React.memo((props) => {\n  const {quantityDef, value, onChange, ...otherProps} = props\n  const config = useRecoilValue(configState)\n  const label = getDisplayLabel(quantityDef, true, config?.showMeta)\n\n  const handleChange = useCallback((event, value) => {\n    value = value || event.target.value\n    if (onChange) {\n      onChange((value === null || value === '') ? undefined : value)\n    }\n  }, [onChange])\n\n  return <AutoComplete\n    options={quantityDef.type.type_data}\n    onChange={handleChange}\n    ListboxProps={{style: {maxHeight: '150px'}}}\n    value={value || null}\n    renderInput={params => (\n      <TextFieldWithHelp\n        {...params}\n        variant='filled' size='small' fullWidth\n        {...getFieldProps(quantityDef)}\n        {...otherProps}\n        label={label}\n      />\n    )}\n  />\n})\nAutocompleteEditQuantity.propTypes = {\n  quantityDef: PropTypes.object.isRequired,\n  value: PropTypes.string,\n  onChange: PropTypes.func\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useCallback} from 'react'\nimport {\n  FormControlLabel,\n  Checkbox, FormLabel, RadioGroup, Radio, FormControl\n} from '@material-ui/core'\nimport PropTypes from 'prop-types'\nimport {getFieldProps, WithHelp} from './StringEditQuantity'\nimport {getDisplayLabel} from \"../../utils\"\nimport {useRecoilValue} from \"recoil\"\nimport {configState} from \"../archive/ArchiveBrowser\"\n\nexport const BoolEditQuantity = React.memo(function BoolEditQuantity(props) {\n  const {quantityDef, value, onChange, booleanLabels, ...otherProps} = props\n  const fieldProps = getFieldProps(quantityDef)\n  const config = useRecoilValue(configState)\n  const label = getDisplayLabel(quantityDef, true, config?.showMeta)\n\n  const handleCheckboxChange = useCallback(e => {\n    const value = e.target.checked\n    if (onChange) {\n      onChange(value)\n    }\n  }, [onChange])\n\n  const handleRadioChange = useCallback(e => {\n    const value = e.target.value === 'true' ? true : (e.target.value === 'false' ? false : undefined)\n    if (onChange) {\n      onChange(value)\n    }\n  }, [onChange])\n\n  return (\n    <WithHelp {...fieldProps} label={label}>\n      {booleanLabels ? (\n        <FormControl>\n          <FormLabel>{label}</FormLabel>\n          <RadioGroup row value={String(value)} onChange={handleRadioChange}>\n            {Object.keys(booleanLabels).map(key => (\n              <FormControlLabel\n                value={key}\n                key={key}\n                control={<Radio {...otherProps} />}\n                label={booleanLabels[key]}\n              />\n            ))}\n          </RadioGroup>\n        </FormControl>\n      ) : (\n        <FormControlLabel\n          control={\n            <Checkbox\n              onChange={handleCheckboxChange}\n              color=\"primary\"\n              checked={value === true}\n              indeterminate={value === undefined}\n              {...otherProps}\n            />\n          }\n          label={label}\n        />\n      )}\n    </WithHelp>\n  )\n})\n\nBoolEditQuantity.propTypes = {\n  quantityDef: PropTypes.object.isRequired,\n  value: PropTypes.oneOf([true, false, undefined]),\n  onChange: PropTypes.func,\n  booleanLabels: (props, propName, componentName) => {\n    const labels = props[propName]\n    if (!labels) return null\n    if (typeof labels !== 'object') {\n      return new Error(`Invalid prop \\`${propName}\\` supplied to \\`${componentName}\\`. Expected an object.`)\n    }\n    const validKeys = ['true', 'false', 'undefined']\n    if (!Object.keys(labels).every(key => validKeys.includes(key))) {\n      return new Error(`Invalid prop \\`${propName}\\` supplied to \\`${componentName}\\`. Expected keys \"true\", \"false\", \"undefined\".`)\n    }\n    return null\n  }\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport {Button, Dialog, DialogActions, DialogContent, DialogTitle, makeStyles} from '@material-ui/core'\nimport DialogContentText from '@material-ui/core/DialogContentText'\n\nconst useStyles = makeStyles(theme => ({\n  dialog: {\n    width: '100%',\n    minWidth: 400\n  }\n}))\n\nconst OverwriteExistingFileDialog = React.memo(({open, data, message, onOverwrite, onCancel}) => {\n  const classes = useStyles()\n\n  return <React.Fragment>\n    <Dialog classes={{paper: classes.dialog}} open={open} disableEscapeKeyDown data-testid='overwrite-reference-dialog'>\n      <DialogTitle>Overwrite file</DialogTitle>\n      <DialogContent>\n        <DialogContentText>\n          {message || `There is already a file with the same name in this path. Do you want to overwrite the file?`}\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <span style={{flexGrow: 1}} />\n        <Button onClick={onCancel} color=\"secondary\">\n          No\n        </Button>\n        <Button onClick={() => onOverwrite(data)} color=\"secondary\">\n          Yes\n        </Button>\n      </DialogActions>\n    </Dialog>\n  </React.Fragment>\n})\nOverwriteExistingFileDialog.propTypes = {\n  open: PropTypes.bool,\n  data: PropTypes.any,\n  message: PropTypes.string,\n  onOverwrite: PropTypes.func,\n  onCancel: PropTypes.func\n}\n\nexport default OverwriteExistingFileDialog\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { Typography, Box, DialogTitle, DialogContent, Dialog, LinearProgress} from '@material-ui/core'\n\nfunction LinearProgressWithLabel(props) {\n  return (\n    <Box display=\"flex\" alignItems=\"center\">\n      <Box width=\"100%\" mr={1}>\n        <LinearProgress variant=\"determinate\" {...props} />\n      </Box>\n      <Typography variant=\"body2\" color=\"textSecondary\">{`${Math.round(\n        props.value\n      )}%`}</Typography>\n    </Box>\n  )\n}\nLinearProgressWithLabel.propTypes = {\n  value: PropTypes.number.isRequired\n}\n\nexport default function UploadProgressDialog({uploading}) {\n    if (uploading || uploading === 0) {\n      return (<Dialog open>\n        <DialogTitle>Uploading file ...</DialogTitle>\n        <DialogContent>\n          <Box width={300}>\n            <LinearProgressWithLabel value={uploading} />\n          </Box>\n        </DialogContent>\n      </Dialog>)\n  }\n  return null\n}\n\nUploadProgressDialog.propTypes = {\n  uploading: PropTypes.number\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useCallback, useRef, useState} from 'react'\nimport PropTypes from 'prop-types'\nimport {\n  makeStyles, IconButton, Tooltip, TextField\n} from '@material-ui/core'\nimport UploadIcon from '@material-ui/icons/CloudUpload'\nimport { useDropzone } from 'react-dropzone'\nimport { useApi } from '../api'\nimport {ItemButton, useLane} from '../archive/Browser'\nimport { useEntryStore } from '../entry/EntryContext'\nimport OverwriteExistingFileDialog from './OverwriteExistingFileDialog'\nimport UploadProgressDialog from '../uploads/UploadProgressDialog'\nimport {getDisplayLabel} from \"../../utils\"\nimport {useRecoilValue} from \"recoil\"\nimport {configState} from \"../archive/ArchiveBrowser\"\n\nconst useFileEditQuantityStyles = makeStyles(theme => ({\n  dropzone: {\n    border: 0\n  },\n  dropzoneActive: {\n    backgroundColor: theme.palette.primary.main,\n    borderTopLeftRadius: 4,\n    borderTopRightRadius: 4,\n    '& input, & button, & label, & a': {\n      color: theme.palette.primary.contrastText\n    }\n  }\n}))\nconst FileEditQuantity = React.memo(props => {\n  const classes = useFileEditQuantityStyles()\n  const {onChange, onFailed, quantityDef, value, ...otherProps} = props\n  const {index} = otherProps\n  const {uploadId, metadata} = useEntryStore() || {}\n  const {api} = useApi()\n  const [askForOverwrite, setAskForOverwrite] = useState(false)\n  const dropedFiles = useRef([])\n  const [uploading, setUploading] = useState(null)\n  const lane = useLane()\n  const config = useRecoilValue(configState)\n  const label = getDisplayLabel(quantityDef, true, config?.showMeta)\n\n  const uploadFile = useCallback((files, overwrite = false) => {\n    const mainfilePathSegments = metadata.mainfile.split('/')\n    const mainfileDir = mainfilePathSegments.slice(0, mainfilePathSegments.length - 1).join('/')\n    const mainfileDirEncoded = mainfileDir.split('/').map(segment => encodeURIComponent(segment)).join('/')\n    let fullPaths = files.map((file) => mainfileDir ? mainfileDir + '/' + file.name : file.name)\n\n    const formData = new FormData() // eslint-disable-line no-undef\n    if (quantityDef.shape.length > 0) {\n      files.forEach((file) => {\n        formData.append('file', file)\n      })\n    } else {\n      formData.append('file', files[0])\n      fullPaths = fullPaths[0]\n    }\n\n    return new Promise((resolve, reject) => {\n      api.put(\n        `/uploads/${uploadId}/raw/${mainfileDirEncoded}?overwrite_if_exists=${overwrite}`,\n        formData, {\n          onUploadProgress: (progressEvent) => {\n            const percentCompleted = Math.round((progressEvent.loaded * 100) / progressEvent.total)\n            setUploading(percentCompleted)\n          }\n        }\n      )\n        .then(response => resolve({response, fullPaths}))\n        .catch(error => reject(error))\n        .finally(() => {\n          setUploading(null)\n        })\n    })\n  }, [api, uploadId, metadata, quantityDef])\n\n  const handleDropFiles = useCallback(files => {\n    if (!files?.[0]?.name) {\n      return // Not dropping a file, but something else. Ignore.\n    }\n\n    dropedFiles.current = files\n    uploadFile(files).then(({response, fullPaths}) => {\n      if (onChange) {\n        onChange(fullPaths)\n      }\n    }).catch(error => {\n      if (error.apiMessage === \"The provided path already exists and overwrite_if_exists is set to False.\") {\n        setAskForOverwrite(true)\n      } else {\n        onFailed(new Error(error))\n      }\n    })\n  }, [uploadFile, onChange, onFailed])\n\n  const handleChange = useCallback(event => {\n    const value = event.target.value\n    if (onChange) {\n      onChange(value)\n    }\n  }, [onChange])\n\n  const {getRootProps, getInputProps, open, isDragAccept} = useDropzone({onDrop: handleDropFiles, noClick: true})\n  const dropzoneClassName = isDragAccept ? classes.dropzoneActive : classes.dropzone\n\n  const handleOverwrite = useCallback((files) => {\n    if (!files?.[0]?.name) {\n      return\n    }\n\n    uploadFile(files, true)\n      .then(({response, fullPaths}) => {\n        if (onChange) {\n          onChange(fullPaths)\n        }\n      })\n      .catch(error => {\n        onFailed(new Error(error))\n      })\n    setAskForOverwrite(false)\n  }, [onChange, onFailed, uploadFile])\n\n  return (\n    <div {...getRootProps({className: dropzoneClassName})}>\n      <UploadProgressDialog uploading={uploading} />\n      <input {...getInputProps()} />\n      <TextField\n        value={value || ''} onChange={handleChange}\n        size=\"small\" variant=\"filled\" fullWidth\n        label={label}\n        {...otherProps}\n        InputProps={{\n          endAdornment: (\n            <React.Fragment>\n              <IconButton size=\"small\" onClick={open} >\n                <Tooltip title=\"upload file (click or drop file)\">\n                  <UploadIcon/>\n                </Tooltip>\n              </IconButton>\n              {lane && value && (\n                <ItemButton size=\"small\" itemKey={index === undefined ? quantityDef.name : `${quantityDef.name}/${index}`} />\n              )}\n            </React.Fragment>\n          )\n        }}\n      />\n      <OverwriteExistingFileDialog\n        open={askForOverwrite}\n        data={dropedFiles.current}\n        onOverwrite={handleOverwrite}\n        onCancel={() => setAskForOverwrite(false)}\n      />\n    </div>\n  )\n})\nFileEditQuantity.propTypes = {\n  quantityDef: PropTypes.object.isRequired,\n  value: PropTypes.string,\n  onChange: PropTypes.func,\n  onFailed: PropTypes.func\n}\nexport default FileEditQuantity\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useCallback, useState, useRef } from 'react'\nimport { Editor } from '@tinymce/tinymce-react'\nimport PropTypes from 'prop-types'\nimport { Box, FormControl, FormLabel, makeStyles } from '@material-ui/core'\nimport DOMPurify from 'dompurify'\nimport {getDisplayLabel} from \"../../utils\"\nimport {useRecoilValue} from \"recoil\"\nimport {configState} from \"../archive/ArchiveBrowser\"\n\nconst useStyle = makeStyles(theme => ({\n  root: {\n    borderBottom: '1px solid rgba(0, 0, 0, 0.42)',\n    marginBottom: 1\n  },\n  focused: {\n    transition: 'border-bottom-color 200ms cubic-bezier(0.4, 0, 0.2, 1) 0ms',\n    transitionProperty: 'border-bottom-color',\n    transitionDuration: '200ms',\n    transitionTimingFunction: 'cubic-bezier(0.4, 0, 0.2, 1)',\n    transitionDelay: '0ms',\n    borderBottom: `2px solid ${theme.palette.primary.main}`\n  }\n}))\n\nconst RichTextEditQuantity = React.memo((props) => {\n  const classes = useStyle()\n  const {quantityDef, value, onChange, height} = props\n  const initialHeight = height || 500\n  const config = useRecoilValue(configState)\n  const label = getDisplayLabel(quantityDef, true, config?.showMeta)\n  const initialValue = useRef(value)\n  const editedValue = useRef(value)\n  const [focus, setFocus] = useState(false)\n  const [initialized, setInitialized] = useState(false)\n\n  if (editedValue.current !== value) {\n    // Means that the value has been changed elsewhere, for example edited in a different tab\n    // In this case we need to force an update to the provided value\n    editedValue.current = value\n    initialValue.current = value\n  }\n\n  const handleChange = useCallback((value) => {\n    editedValue.current = value\n    if (onChange) {\n      onChange(value === '' ? undefined : value)\n    }\n  }, [onChange])\n\n  const handleImageUpload = useCallback((blobInfo, success, failure, progress) => {\n    success('data:' + blobInfo.blob().type + ';base64,' + blobInfo.base64())\n  }, [])\n\n  const handleEditorInit = useCallback(editor => {\n    setInitialized(true)\n  }, [setInitialized])\n\n  return (\n    <FormControl fullWidth focused={focus} className={focus ? classes.focused : classes.root}>\n      <Box marginY={1}>\n        <FormLabel>{label}</FormLabel>\n      </Box>\n      <Box height={initialized ? 'initial' : initialHeight}>\n        <Editor\n          onInit={(event, editor) => handleEditorInit(editor)}\n          init={{\n            resize: true,\n            height: initialHeight,\n            menubar: false,\n            plugins: [\n              'advlist autolink lists link image charmap print preview anchor',\n              'searchreplace visualblocks code',\n              'insertdatetime media table paste code help wordcount'\n            ],\n            toolbar: 'undo redo | formatselect | ' +\n            'bold italic backcolor editimage | alignleft aligncenter ' +\n            'alignright alignjustify | bullist numlist outdent indent | image table | ' +\n            'removeformat',\n            skin: 'nomad',\n            images_upload_handler: handleImageUpload,\n            paste_data_images: true\n          }}\n          onEditorChange={handleChange}\n          onFocus={() => setFocus(true)}\n          onBlur={() => setFocus(false)}\n          initialValue={DOMPurify.sanitize(initialValue.current || '')}\n        />\n      </Box>\n    </FormControl>\n  )\n})\nRichTextEditQuantity.propTypes = {\n  quantityDef: PropTypes.object.isRequired,\n  value: PropTypes.string,\n  onChange: PropTypes.func,\n  height: PropTypes.oneOfType([PropTypes.number, PropTypes.string])\n}\n\nexport default RichTextEditQuantity\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// Contains definitions for the different search bar syntaxes. This mapping is\n// used for performing the parsing, creating an info dialog and for\n// including/excluding certain syntaxes with the app config.\n\nconst opMap = {\n  '<=': 'lte',\n  '>=': 'gte',\n  '>': 'gt',\n  '<': 'lt'\n}\nconst opMapReverse = {\n  '<=': 'gte',\n  '>=': 'lte',\n  '>': 'lt',\n  '<': 'gt'\n}\n\nconst reString = '[^\\\\s=<>](?:[^=<>]*[^\\\\s=<>])?'\nconst reOp = '(?:<|>)=?'\nconst reEquality = new RegExp(`^(${reString})\\\\s*=\\\\s*(${reString})$`)\nconst reLte = RegExp(`^(${reString})\\\\s*(${reOp})\\\\s*(${reString})$`)\nconst reLteGte = new RegExp(`^(${reString})\\\\s*(${reOp})\\\\s*(${reString})\\\\s*(${reOp})\\\\s*(${reString})$`)\nconst reExists = new RegExp(`^(${reString})\\\\s*=\\\\s*\\\\*$`)\n\nexport const SearchSyntaxes = {\n  existence: {\n    regex: reExists,\n    parse: (input) => {\n      const exists = input.match(reExists)\n      return {\n        inputNormalized: `${exists[1]} = *`,\n        target: 'quantities',\n        value: exists[1]\n      }\n    },\n    readme: 'Used to query for the existence of a specific metainfo field in the data.',\n    examples: ['authors.name = *'],\n    label: 'Value existence',\n    labelShort: 'existence'\n  },\n  equality: {\n    regex: reEquality,\n    parse: (input) => {\n      const equals = input.match(reEquality)\n      const target = equals[1]\n      return {\n        inputNormalized: `${equals[1]} = ${equals[2]}`,\n        target,\n        value: equals[2]\n      }\n    },\n    readme: 'Used to query for a specific value with exact match.',\n    examples: ['author.name = John Doe'],\n    label: 'Value equality',\n    labelShort: 'equality'\n  },\n  range_bounded: {\n    regex: reLteGte,\n    parse: (input) => {\n      const ltegteSandwich = input.match(reLteGte)\n      const a = ltegteSandwich[1]\n      const op1 = ltegteSandwich[2]\n      const b = ltegteSandwich[3]\n      const op2 = ltegteSandwich[4]\n      const c = ltegteSandwich[5]\n      const target = b\n      const value = {\n        [opMapReverse[op1]]: a,\n        [opMap[op2]]: c\n      }\n      return {\n        inputNormalized: `${ltegteSandwich[1]} ${ltegteSandwich[2]} ${ltegteSandwich[3]} ${ltegteSandwich[4]} ${ltegteSandwich[5]}`,\n        target,\n        value\n      }\n    },\n    readme: 'Queries values that are between two numerical limits, inclusive or exclusive. You can also specify a unit if the target has a certain dimensionality.',\n    examples: [\n      '0 <= results.material.n_elements <= 2',\n      '0 eV < results.properties.geometry_optimization.final_energy_difference < 1e-3 eV'\n    ],\n    label: 'Range query (bounded)',\n    labelShort: 'range'\n  },\n  range_half_bounded: {\n    regex: reLte,\n    parse: (input) => {\n      const ltegte = input.match(reLte)\n      const a = ltegte[1]\n      const op = ltegte[2]\n      const b = ltegte[3]\n      const aNumber = /\\d/.test(a)\n      const target = aNumber ? b : a\n      const query = aNumber ? a : b\n      const value = {[opMap[op]]: query}\nreturn {\n        inputNormalized: `${ltegte[1]} ${ltegte[2]} ${ltegte[3]}`,\n        target,\n        value\n      }\n    },\n    readme: 'Queries values that are above/below a numerical limit, inclusive or exclusive. You can also specify a unit if the target has a certain dimensionality.',\n    examples: [\n      'results.material.n_elements > 2',\n      'results.properties.geometry_optimization.final_energy_difference <= 1e-3 eV'\n    ],\n    label: 'Range query (half-bounded)',\n    labelShort: 'range'\n  },\n  free_text: {\n    regex: /[^]*/,\n    parse: (input) => {\n      return {\n        inputNormalized: input,\n        target: 'text_search_contents',\n        value: input\n      }\n    },\n    readme: 'Free-form text query across keywords associated with an entry. Requires that a set of text search contents has been filled in the entry.',\n    examples: ['type anything there'],\n    label: 'Free-text query',\n    labelShort: 'free-text'\n  }\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {\n  useCallback,\n  useMemo,\n  useEffect,\n  useContext,\n  createContext,\n  useRef\n} from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport PropTypes from 'prop-types'\nimport { Tooltip, List, ListItemText, ListSubheader } from '@material-ui/core'\nimport HelpOutlineIcon from '@material-ui/icons/HelpOutline'\nimport { getSchemaAbbreviation, getSuggestions, parseJMESPath } from '../../../utils'\nimport { useSearchContext } from '../SearchContext'\nimport { VariableSizeList } from 'react-window'\nimport { InputText } from './InputText'\n\n/**\n * Wrapper around InputText that is specialized in showing metainfo options. The\n * allowed options are controlled.\n */\nexport const InputMetainfoControlled = React.memo(({\n  label,\n  value,\n  options,\n  error,\n  validate,\n  onChange,\n  onSelect,\n  onAccept,\n  onBlur,\n  onError,\n  optional,\n  TextFieldProps,\n  InputProps,\n  PaperComponent,\n  group,\n  loading,\n  disableValidation,\n  disableValidateOnSelect\n}) => {\n  // Predefine all option objects, all option paths and also pre-tokenize the\n  // options for faster matching.\n  const { keys, keysSet, filter } = useMemo(() => {\n    const keys = Object.keys(options)\n    const keysSet = new Set(keys)\n    const { filter } = getSuggestions(keys, 0)\n    return { keys, keysSet, filter }\n  }, [options])\n\n  const textProps = useMemo(() => {\n    return {\n      label,\n      ...TextFieldProps\n    }\n  }, [label, TextFieldProps])\n\n  // Used to validate the input and raise errors\n  const validateFinal = useCallback((value) => {\n    if (disableValidation) {\n      return {valid: true, error: undefined}\n    }\n    const empty = !value || value.length === 0\n    if (optional && empty) {\n      return {valid: true, error: undefined}\n    } else if (empty) {\n      return {valid: false, error: 'Please specify a value.'}\n    }\n    if (validate) {\n      return validate(value)\n    } else if (!(keysSet.has(value))) {\n      return {valid: false, error: `The quantity \"${value}\" is not available.`}\n    }\n    return {valid: true, error: undefined}\n  }, [validate, keysSet, optional, disableValidation])\n\n  // Handles the selectance of a suggested value\n  const handleSelect = useCallback((key) => {\n    onSelect?.(key, options[key])\n  }, [onSelect, options])\n\n  // Used to filter the shown options based on input\n  const filterOptions = useCallback((opt, { inputValue }) => {\n    let filtered = filter(inputValue)\n    if (group) filtered = filtered.sort((a, b) => options[a].group > options[b].group ? 1 : -1)\n    return filtered\n  }, [options, filter, group])\n\n  return <InputText\n    value={value || null}\n    error={error}\n    onChange={onChange}\n    onSelect={handleSelect}\n    onAccept={onAccept}\n    onBlur={onBlur}\n    onError={onError}\n    suggestions={keys}\n    ListboxComponent={ListboxMetainfo}\n    TextFieldProps={textProps}\n    PaperComponent={PaperComponent}\n    InputProps={InputProps}\n    groupBy={group && ((key) => options?.[key]?.group)}\n    renderGroup={group && renderGroup}\n    getOptionLabel={option => option}\n    filterOptions={filterOptions}\n    loading={loading}\n    renderOption={(id) => <MetainfoOption id={id} options={options} />}\n    validate={validateFinal}\n    disableValidateOnSelect={disableValidateOnSelect}\n  />\n})\n\nInputMetainfoControlled.propTypes = {\n  label: PropTypes.string,\n  value: PropTypes.string,\n  options: PropTypes.objectOf(PropTypes.shape({\n    key: PropTypes.string.isRequired, // The value used for matching\n    definition: PropTypes.object, // The definition for the metainfo.\n    primary: PropTypes.string, // The value shown as primary text, defaults to key.\n    secondary: PropTypes.string, // Optional secondary text. Defaults to data type + schema read from definition.\n    description: PropTypes.string, // Optional description shown as hover. Defaults to desription read from definition.\n    schema: PropTypes.string, // Schema name. Defaults to schema read from searchQuantities.\n    dtype: PropTypes.string, // Data type. Defaults to data type read from definition.\n    group: PropTypes.string // Optional group information\n  })),\n  error: PropTypes.string,\n  validate: PropTypes.func, // Optional custom validation function\n  onChange: PropTypes.func,\n  onSelect: PropTypes.func,\n  onAccept: PropTypes.func,\n  onError: PropTypes.func,\n  onBlur: PropTypes.func,\n  optional: PropTypes.bool, // Set to true if field can be empty\n  group: PropTypes.bool, // Set to true if group should be shown\n  TextFieldProps: PropTypes.object,\n  InputProps: PropTypes.object,\n  PaperComponent: PropTypes.any,\n  loading: PropTypes.bool,\n  disableValidation: PropTypes.bool,\n  disableValidateOnSelect: PropTypes.bool\n}\n\nInputMetainfoControlled.defaultProps = {\n  label: \"quantity\"\n}\n\n/**\n * Wrapper around InputText that is specialized in showing metainfo options. The\n * allowed options are uncontrolled: they are specified by the current\n * SearchContext.\n */\nexport const InputMetainfo = React.memo(({\n  dtypes,\n  dtypesRepeatable,\n  disableNonAggregatable,\n  ...rest\n}) => {\n  const { filterData } = useSearchContext()\n\n  // Fetch the available metainfo names and create options that are compatible\n  // with InputMetainfo.\n  const options = useMemo(() => {\n    return getMetainfoOptions(filterData, dtypes, dtypesRepeatable, disableNonAggregatable)\n  }, [filterData, dtypes, dtypesRepeatable, disableNonAggregatable])\n\n  return <InputMetainfoControlled\n    options={options}\n    {...rest}\n  />\n})\n\nInputMetainfo.propTypes = {\n  /* List of allowed data types for non-repeatable quantities. */\n  dtypes: PropTypes.object,\n  /* List of allowed data types for repeatable quantities. */\n  dtypesRepeatable: PropTypes.object,\n  /* Whether non-aggregatable values are excluded */\n  disableNonAggregatable: PropTypes.bool\n}\n\n/**\n * Wrapper around InputText which accepts JMESPath syntax for quantities. The\n * allowed quantities are uncontrolled: they are specified by the current\n * SearchContext.\n */\nexport const InputJMESPath = React.memo(React.forwardRef(({\n  dtypes,\n  dtypesRepeatable,\n  disableNonAggregatable,\n  ...rest\n}, ref) => {\n  const { filterData } = useSearchContext()\n\n  // Fetch the available metainfo names and create options that are compatible\n  // with InputMetainfo.\n  const [options, keysSet] = useMemo(() => {\n    const options = getMetainfoOptions(filterData, dtypes, dtypesRepeatable, disableNonAggregatable)\n    const keysSet = new Set(Object.keys(options))\n    return [options, keysSet]\n  }, [filterData, dtypes, dtypesRepeatable, disableNonAggregatable])\n\n  // Used to validate the JMESPath input\n  const validate = useCallback((value) => {\n    const {quantity, path, extras, error: errorParse, schema} = parseJMESPath(value)\n    if (errorParse) {\n      return {valid: false, error: 'Invalid JMESPath query, please check your syntax.'}\n    }\n    if (!(keysSet.has(quantity))) {\n      return {valid: false, error: `The quantity \"${quantity}\" is not available.`}\n    }\n    for (const extra of extras) {\n      if (!filterData[extra]) {\n        return {valid: false, error: `The quantity \"${extra}\" is not available.`}\n      }\n    }\n    if (filterData[quantity].repeats_section && quantity === path + schema) {\n      return {valid: false, error: `The quantity \"${quantity}\" is contained in at least one repeatable section. Please use JMESPath syntax to select one or more target sections.`}\n    }\n    return {valid: true, error: undefined}\n  }, [keysSet, filterData])\n\n  return <InputMetainfoControlled\n    options={options}\n    validate={validate}\n    disableValidateOnSelect\n    ref={ref}\n    {...rest}\n  />\n}))\n\nInputJMESPath.propTypes = {\n  /* List of allowed data types for non-repeatable quantities. */\n  dtypes: PropTypes.object,\n  /* List of allowed data types for repeatable quantities. */\n  dtypesRepeatable: PropTypes.object,\n  /* Whether non-aggregatable values are excluded */\n  disableNonAggregatable: PropTypes.bool\n}\n\n/**\n * Custom virtualized list component for displaying metainfo values.\n */\nexport const ListboxMetainfo = React.forwardRef((props, ref) => {\n  const { children, ...other } = props\n  const itemSize = 64\n  const headerSize = 40\n  const itemData = React.Children.toArray(children)\n  const itemCount = itemData.length\n\n  // Calculate size of child element.\n  const getChildSize = (child) => {\n    return React.isValidElement(child) && child.type === ListSubheader\n      ? headerSize\n      : itemSize\n  }\n\n  // Calculates the height of the suggestion box\n  const getHeight = () => {\n    return itemCount > 8\n      ? 8 * itemSize\n      : itemData.map(getChildSize).reduce((a, b) => a + b, 0)\n  }\n\n  const gridRef = useResetCache(itemCount)\n\n  return <div ref={ref}>\n    <OuterElementContext.Provider value={other}>\n      <List disablePadding>\n        <VariableSizeList\n          itemData={itemData}\n          height={getHeight() + 2 * LISTBOX_PADDING}\n          width=\"100%\"\n          ref={gridRef}\n          outerElementType={OuterElementType}\n          innerElementType=\"ul\"\n          itemSize={(index) => getChildSize(itemData[index])}\n          overscanCount={5}\n          itemCount={itemCount}\n        >\n          {renderRow}\n        </VariableSizeList>\n      </List>\n    </OuterElementContext.Provider>\n  </div>\n})\n\nListboxMetainfo.propTypes = {\n  children: PropTypes.node\n}\n\nexport const LISTBOX_PADDING = 8\nconst OuterElementContext = createContext({})\n\nexport const OuterElementType = React.forwardRef((props, ref) => {\n  const outerProps = useContext(OuterElementContext)\n  return <div ref={ref} {...props} {...outerProps} />\n})\n\nexport const renderGroup = (params) => [\n  <ListSubheader key={params.key} component=\"div\">\n    {`${params.group} suggestions`}\n  </ListSubheader>,\n  params.children\n]\n\nexport function useResetCache(data) {\n  const ref = useRef(null)\n  useEffect(() => {\n    if (ref.current != null) {\n      ref.current.resetAfterIndex(0, true)\n    }\n  }, [data])\n  return ref\n}\n\nexport function renderRow({ data, index, style }) {\n  return React.cloneElement(data[index], {\n    style: {\n      ...style,\n      top: style.top + LISTBOX_PADDING\n    }\n  })\n}\n\n/* A metainfo option shown as a suggestion.\n */\nexport const useMetainfoOptionStyles = makeStyles(theme => ({\n  optionText: {\n    flexGrow: 1,\n    overflowX: 'scroll',\n    '&::-webkit-scrollbar': {\n      display: 'none'\n    },\n    '-ms-overflow-style': 'none',\n    scrollbarWidth: 'none'\n  },\n  noWrap: {\n    whiteSpace: 'nowrap'\n  },\n  option: {\n    width: '100%',\n    display: 'flex',\n    alignItems: 'stretch',\n    // The description icon is hidden until the item is hovered. It is not\n    // removed from the document with \"display: none\" in order for the hover to\n    // not change the layout which may cause other elements to shift around.\n    '& .description': {\n      visibility: \"hidden\",\n      marginRight: theme.spacing(-0.5),\n      display: 'flex',\n      width: theme.spacing(5),\n      marginLeft: theme.spacing(1),\n      alignItems: 'center',\n      justifyContent: 'center'\n    },\n    '&:hover .description': {\n      visibility: \"visible\"\n    }\n  }\n}))\nexport const MetainfoOption = ({id, options}) => {\n  const styles = useMetainfoOptionStyles()\n  const option = options[id]\n  const primary = option.primary || option.definition?.quantity || option.key\n  const dtype = option.dtype || option.definition?.dtype\n  const schema = getSchemaAbbreviation(option.schema || option.definition?.schema)\n  const secondary = option.secondary || ((dtype || schema)\n    ? `${dtype} ${schema ? `| ${schema}` : ''}`\n    : null)\n  const description = option.description || option.definition?.description\n\n  return <div className={styles.option}>\n    <ListItemText\n      primary={primary}\n      secondary={secondary}\n      className={styles.optionText}\n      primaryTypographyProps={{className: styles.noWrap}}\n      secondaryTypographyProps={{className: styles.noWrap}}\n    />\n    {description &&\n      <Tooltip title={description || ''}>\n        <div className=\"description\">\n          <HelpOutlineIcon fontSize=\"small\" color=\"action\"/>\n        </div>\n      </Tooltip>\n    }\n  </div>\n}\n\nMetainfoOption.propTypes = {\n  id: PropTypes.string,\n  options: PropTypes.object\n}\n\n/**\n * Used to filter a set of filterData according to the given filtering options.\n *\n * @param {*} filterData The filterData to filter\n * @param {*} dtypes Included data types as a set\n * @param {*} dtypesRepeatable  Included repeatabel data types as a set\n * @param {*} disableNonAggregatable  Whether to filter out non-aggregatable filters\n * @returns Object containing the filtered filters\n */\nfunction getMetainfoOptions(filterData, dtypes, dtypesRepeatable, disableNonAggregatable) {\n  return Object.fromEntries(\n    Object.entries(filterData)\n      .filter(([key, data]) => {\n        if (disableNonAggregatable && !data.aggregatable) return false\n        const dtype = data?.dtype\n        const passed = data?.repeats\n          ? dtypesRepeatable?.has(dtype)\n          : dtypes?.has(dtype)\n        return passed\n      })\n      .map(([key, data]) => [key, {\n        key: key,\n        definition: data\n    }])\n  )\n}\n","/* eslint-disable no-unused-vars */\n/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useCallback, useState, useMemo, createContext, useContext, useRef } from 'react'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\nimport assert from 'assert'\nimport { isNil, has } from 'lodash'\nimport { makeStyles } from '@material-ui/core/styles'\nimport SearchIcon from '@material-ui/icons/Search'\nimport HistoryIcon from '@material-ui/icons/History'\nimport CloseIcon from '@material-ui/icons/Close'\nimport { HelpButton } from '../../components/Help'\nimport { Paper, Tooltip, Chip, List, ListSubheader, Typography, IconButton, Box } from '@material-ui/core'\nimport { parseQuantityName, getSchemaAbbreviation } from '../../utils'\nimport { useSuggestions } from '../../hooks'\nimport { useSearchContext } from './SearchContext'\nimport { quantityNameSearch } from './FilterRegistry'\nimport { VariableSizeList } from 'react-window'\nimport { InputText } from './input/InputText'\nimport { SearchSuggestion, SuggestionType } from './SearchSuggestion'\nimport { SearchSyntaxes } from './SearchSyntaxes'\nimport { renderRow, useResetCache, LISTBOX_PADDING } from './input/InputMetainfo'\n\n/**\n * Displays a suggestion in the search bar.\n */\nexport const useSuggestionStyles = makeStyles(theme => ({\n  root: {\n    width: '100%',\n    height: '100%',\n    display: 'flex',\n    alignItems: 'center',\n    '& > *': {\n        marginRight: theme.spacing(1)\n    },\n    '& > *:last-child': {\n        marginRight: 0\n    },\n    // The delete icon is hidden until the item is hovered. It is not removed\n    // from the document with \"display: none\" in order for the hover to not\n    // change the layout which may cause other elements to shift around.\n    '& .delete': {\n      visibility: \"hidden\"\n    },\n    '&:hover .delete': {\n      visibility: \"visible\"\n    }\n  },\n  primary: {\n    flexGrow: 1,\n    whiteSpace: 'nowrap',\n    overflowX: 'scroll',\n    '&::-webkit-scrollbar': {\n      display: 'none'\n    },\n    '-ms-overflow-style': 'none',\n    scrollbarWidth: 'none'\n  }\n}))\nconst Suggestion = ({suggestion, onDelete, tooltip}) => {\n  const typeTooltip = (suggestion.type === SuggestionType.Name\n    ? 'Suggested name for an available filter in this app'\n    : SearchSyntaxes[suggestion.type]?.readme) || ''\n  const label = (suggestion.type === SuggestionType.Name\n    ? 'name'\n    : SearchSyntaxes[suggestion.type]?.labelShort) || ''\n  const styles = useSuggestionStyles()\n  let schema, primary\n  if (suggestion.type === SuggestionType.Name) {\n    const {path, schema: schemaTmp} = parseQuantityName(suggestion.input)\n    primary = path\n    schema = schemaTmp\n  } else {\n    primary = suggestion.input\n  }\n\n  return <div className={styles.root}>\n    <Typography className={styles.primary}>\n      <Tooltip title={tooltip || ''} placement='bottom' enterDelay={500} enterNextDelay={500}>\n        <span>{primary}</span>\n      </Tooltip>\n    </Typography>\n    {suggestion.history\n      ? <Tooltip title=\"Remove from search history\">\n        <IconButton className=\"delete\" size=\"small\" onClick={(event) => {\n          event.preventDefault()\n          event.stopPropagation()\n          onDelete?.()\n        }}>\n          <CloseIcon fontSize=\"small\" color=\"action\" />\n        </IconButton>\n      </Tooltip>\n      : null\n    }\n    {suggestion.history\n      ? <Tooltip title=\"From search history\">\n        <HistoryIcon fontSize=\"small\" color=\"action\"/>\n      </Tooltip>\n      : null\n    }\n    {schema\n      ? <Tooltip title={`Definition from ${schema}`}>\n      <Typography variant='caption'>{getSchemaAbbreviation(schema)}</Typography>\n    </Tooltip>\n      : null\n    }\n    <Tooltip title={typeTooltip}>\n      <Chip size='small' label={label}/>\n    </Tooltip>\n  </div>\n}\n\nSuggestion.propTypes = {\n  suggestion: PropTypes.object,\n  onDelete: PropTypes.func,\n  tooltip: PropTypes.string\n}\n\nconst queryControlsHeight = 5.5\nexport const useStyles = makeStyles(theme => ({\n  root: {\n    width: '100%',\n    display: 'flex',\n    flexDirection: 'column'\n  },\n  paper: {\n    width: '100%'\n  },\n  offset: {\n    height: theme.spacing(queryControlsHeight),\n    display: 'flex',\n    flexDirection: 'row',\n    alignItems: 'center'\n  },\n  queryContainer: {\n    minHeight: theme.spacing(queryControlsHeight),\n    marginTop: theme.spacing(0.5),\n    width: '100%',\n    display: 'flex',\n    flexDirection: 'row',\n    alignItems: 'flex-start'\n  },\n  iconButton: {\n    padding: 10\n  }\n}))\n\n/**\n * This component shows a search bar with autocomplete functionality.\n */\nconst SearchBar = React.memo(({\n  quantities,\n  className\n}) => {\n  const styles = useStyles()\n  const {\n    filters,\n    filterData,\n    filterFullnames,\n    useUpdateFilter,\n    useParseQuery,\n    useSearchSuggestions,\n    usePushSearchSuggestion,\n    useRemoveSearchSuggestion,\n    useSetPagination,\n    searchSyntaxes,\n    useResetFilters,\n    useRefresh,\n    useApiData\n  } = useSearchContext()\n\n  const includedFormats = Object\n    .keys(SearchSyntaxes)\n    .filter((key) => !searchSyntaxes?.exclude?.includes(key))\n  const formatReadmeList = includedFormats\n    .map((key) => {\n      const examples = SearchSyntaxes[key]?.examples?.map((example) => `   ${example}`).join('\\n')\n      return ` - **${SearchSyntaxes[key]?.label}**: ${SearchSyntaxes[key]?.readme} For example:\\n\\n   \\`\\`\\`\\n${examples}\\n   \\`\\`\\`\\n`\n    })\n    .join('\\n')\n  const [inputValue, setInputValue] = useState('')\n  const [suggestionInput, setSuggestionInput] = useState('')\n  const [error, setError] = useState(false)\n  const setPagination = useSetPagination()\n  const updateFilter = useUpdateFilter()\n  const parseQuery = useParseQuery()\n  const inputRef = useRef()\n\n  const [quantitiesAll, quantitiesAllSet, quantitiesSuggestable] = useMemo(() => {\n    let quantitySetSuggestable, quantityList\n    // Custom list of quantities. They are validated against the current search\n    // context.\n    if (quantities) {\n      for (const quantity of quantities) {\n        assert(\n          quantity.name === quantityNameSearch || has(filterData, quantity.name),\n          `Quantity ${quantity.name} does not exist in the current search context.`\n        )\n      }\n      quantityList = [...quantities]\n      quantitySetSuggestable = new Set(\n        quantityList\n          .map(q => q.name)\n          .filter(name => name === quantityNameSearch || filterData[name]?.suggestion)\n      )\n    // Default quantities to use. Certain quantities are prioritized, others\n    // come in alphabetical order.\n    } else {\n      quantitySetSuggestable = new Set([\n        'results.material.elements',\n        'results.material.chemical_formula_hill',\n        'results.material.chemical_formula_anonymous',\n        'results.material.structural_type',\n        'results.material.symmetry.structure_name',\n        'results.method.simulation.program_name',\n        'authors.name'\n      ])\n      const filterList = [...filters]\n      filterList.forEach(q => quantitySetSuggestable.add(q))\n      quantityList = filterList.map((name) => ({name, size: 5}))\n      // The list of available quantity names is provided at the very\n      // bottom.\n      quantitySetSuggestable.add(quantityNameSearch)\n      quantityList.push({name: quantityNameSearch})\n    }\n    const quantitySet = new Set(quantityList.map((q) => q.name))\n    return [quantityList, quantitySet, quantitySetSuggestable]\n  }, [quantities, filterData, filters])\n\n  const [suggestionNames, setSuggestionNames] = useState(quantitiesSuggestable)\n  const suggestionQuantities = useMemo(() => {\n    return quantitiesAll.filter((q) => suggestionNames.has(q.name))\n  }, [quantitiesAll, suggestionNames])\n\n  const [suggestionsMatch, setSuggestionsMatch] = useState([])\n  const pushSuggestion = usePushSearchSuggestion()\n  const removeSuggestion = useRemoveSearchSuggestion()\n  const suggestionsHistory = useSearchSuggestions(inputValue)\n  const [suggestionsMetainfo, loading] = useSuggestions(suggestionQuantities, quantitiesAllSet, suggestionInput, filterData)\n\n  // Contains the final set of suggestions\n  const [suggestions, keys] = useMemo(() => {\n    const suggestions = {}\n\n    for (const suggestion of suggestionsMatch) {\n      suggestions[suggestion.key] = suggestion\n    }\n\n    for (const suggestion of suggestionsHistory) {\n      suggestions[suggestion.key] = suggestion\n    }\n\n    for (const suggestion of suggestionsMetainfo) {\n      let input, type\n      if (suggestion.category === quantityNameSearch) {\n        type = SuggestionType.Name\n        input = suggestion.value\n      } else {\n        type = SuggestionType.Equality\n        input = `${suggestion.category} = ${suggestion.value}`\n      }\n      const suggestionObject = new SearchSuggestion({input, type})\n      const key = suggestionObject.key\n      if (!has(suggestions, key)) {\n        suggestions[key] = suggestionObject\n      }\n    }\n    return [suggestions, Object.keys(suggestions)]\n  }, [suggestionsMatch, suggestionsHistory, suggestionsMetainfo])\n\n  const clearSuggestions = useCallback(() => {\n    setSuggestionInput('')\n    setSuggestionsMatch([])\n  }, [])\n\n  const clearInput = useCallback(() => {\n    setError(error => error ? undefined : null)\n    setInputValue('')\n    setSuggestionInput('')\n  }, [])\n\n  // Used to check the validity of the given quantity name\n  const checkMetainfo = useCallback((name) => {\n    const fullName = filterFullnames[name] || name\n    if (!quantitiesAllSet.has(fullName)) {\n      return [undefined, `The quantity '${name}' is not supported`]\n    }\n    if (filterData[fullName].section) {\n      return [fullName, `Cannot target metainfo sections`]\n    }\n    return [fullName, undefined]\n  }, [quantitiesAllSet, filterData, filterFullnames])\n\n  // Get suggestions based on the current input and the supported query syntaxes\n  const getSuggestionsMatch = useCallback((input) => {\n    input = input?.trim()\n    if (!input?.length) {\n      return []\n    }\n    const suggestions = []\n    for (const key of includedFormats) {\n        // regex.test() is significantly faster than string.match()\n        const match = SearchSyntaxes[key].regex.test(input)\n        if (match) {\n          suggestions.push(new SearchSuggestion({input, type: key}))\n        }\n    }\n    return suggestions\n  }, [includedFormats])\n\n  // Triggered when the user selects a highlighted item with mouse or with\n  // keyboard.\n  const handleAccept = useCallback((key) => {\n    let suggestion = suggestions[key]\n    if (!suggestion) {\n      const bestSuggestion = suggestions[keys[0]]\n      if (bestSuggestion?.input?.trim() === key?.trim()) {\n        suggestion = bestSuggestion\n      } else {\n        setError('Unsupported query')\n        return\n      }\n    }\n    if (suggestion.type === SuggestionType.Name) {\n      setInputValue(suggestion.input)\n      return\n    }\n\n    // Parse the suggestion using the matched format\n    const format = SearchSyntaxes[suggestion.type]\n    const {target: targetTmp, value: valueTmp, inputNormalized} = format.parse(suggestion.input)\n\n    // Check that targeted metainfo is ok, and attempt to parse the query\n    const [target, errorMeta] = checkMetainfo(targetTmp)\n    let value, errorQuery\n    if (!errorMeta) {\n      try {\n        value = parseQuery(target, valueTmp)\n      } catch (err) {\n        errorQuery = `Invalid value for the metainfo ${target}. Please check your syntax.`\n      }\n    }\n\n    // Catch any errors and raise them\n    const error = errorMeta || errorQuery\n    if (error) {\n      setError(error)\n      return\n    }\n\n    // The pagination is explicitly set to be done by descending relevance\n    // score if a free-text query is performed\n    if (suggestion.type === SuggestionType.Freetext) {\n      setPagination(old => {\n        return {...old, order_by: '_score', order: 'desc'}\n      })\n    }\n\n    // Update the search filter\n    updateFilter([target, old => {\n      const multiple = filterData[target].multiple\n      return (format?.label === SuggestionType.RangeHalfBounded || suggestion.type === SuggestionType.RangeBounded || isNil(old) || !multiple)\n        ? value\n        : new Set([...old, ...value])\n    }])\n\n    // We need to create a copy here, since Recoil won't allow mutating object\n    // stored in a state.\n    const normalizedSuggestion = new SearchSuggestion(suggestion)\n    normalizedSuggestion.input = inputNormalized\n\n    pushSuggestion(normalizedSuggestion)\n    clearSuggestions()\n    clearInput()\n  }, [checkMetainfo, clearInput, clearSuggestions, filterData, keys, parseQuery, pushSuggestion, suggestions, updateFilter, setPagination])\n\n  // When a suggestion is highlighted with keyboard (not mouse), the text field\n  // is changed to that suggestion value. Note that this should not trigger the\n  // suggestions etc. and this is why we don't set inputValue.\n  const handleHighlight = useCallback((key, reason) => {\n    if (reason === 'keyboard') {\n      const suggestion = suggestions[key]?.input\n      if (suggestion) {\n        inputRef.current.value = suggestion\n      }\n    }\n  }, [suggestions])\n\n  // Handle typing events\n  const handleInputChange = useCallback((input) => {\n    setError(error => error ? undefined : null)\n    setInputValue(input)\n    input = input?.trim()\n    if (!input) {\n      clearSuggestions()\n      return\n    }\n\n    // Get suggestions for making specific queries\n    setSuggestionsMatch(getSuggestionsMatch(input))\n\n    // Start getting suggestions from ES\n    const split = input.split('=', 2)\n    let quantitySet = quantitiesSuggestable\n    if (split.length === 2) {\n      const quantityName = split[0].trim()\n      const quantityFullname = filterFullnames[quantityName]\n      if (quantitiesSuggestable.has(quantityName)) {\n        quantitySet = new Set([quantityName])\n        input = split[1].trim()\n      } else if (quantitiesSuggestable.has(quantityFullname)) {\n        quantitySet = new Set([quantityFullname])\n        input = split[1].trim()\n      }\n    }\n    setSuggestionNames(quantitySet)\n    setSuggestionInput(input)\n  }, [quantitiesSuggestable, filterFullnames, getSuggestionsMatch, clearSuggestions])\n\n  return <Box className={clsx(className, styles.root)}>\n    <Paper className={styles.paper}>\n      <InputText\n        value={inputValue || null}\n        onChange={handleInputChange}\n        onSelect={handleAccept}\n        onAccept={handleAccept}\n        onHighlight={handleHighlight}\n        suggestions={keys}\n        disableAcceptOnBlur\n        autoHighlight={inputValue?.trim() === suggestions[keys[0]]?.input?.trim()}\n        ListboxComponent={ListboxSuggestion}\n        TextFieldProps={{\n          variant: 'outlined',\n          placeholder: 'Type your query or keyword here',\n          label: error || undefined,\n          error: !!error,\n          InputLabelProps: { shrink: true },\n          size: \"medium\"\n        }}\n        InputProps={{\n          startAdornment: <SearchIcon className={styles.iconButton} color=\"action\" />,\n          endAdornment: <Tooltip title=\"Search bar syntax help\">\n            <HelpButton\n              IconProps={{fontSize: 'small'}}\n              maxWidth=\"md\"\n              size=\"small\"\n              heading=\"Search bar help\"\n              text={`\n  The search bar provides a fast way to start formulating queries.\n  Once you start typing a keyword or a query, suggestions for queries\n  and metainfo names are given based on your search history and the\n  available data. This search bar supports the following syntaxes:\n\n  ${formatReadmeList}`}\n            />\n          </Tooltip>,\n          inputRef: inputRef\n        }}\n        getOptionLabel={option => option}\n        filterOptions={(options) => options}\n        loading={loading}\n        renderOption={(id) => <Suggestion\n          suggestion={suggestions[id]}\n          onDelete={() => removeSuggestion(suggestions[id].key)}\n          tooltip={suggestions[id].type === SuggestionType.Name ? filterData[suggestions[id].input]?.description : undefined}\n        />}\n      />\n    </Paper>\n  </Box>\n})\n\nSearchBar.propTypes = {\n // List of quantities that the search targets. The suggestions are returned in\n // the same order.\n  quantities: PropTypes.arrayOf(PropTypes.shape({\n    name: PropTypes.string,\n    size: PropTypes.number\n  })),\n  className: PropTypes.string\n}\n\n/**\n * Custom virtualized list component for displaying searchbar suggestions.\n */\nconst OuterElementContext = createContext({})\nexport const ListboxSuggestion = React.forwardRef((props, ref) => {\n  const { children, ...other } = props\n  const itemSize = 48\n  const headerSize = 40\n  const itemData = React.Children.toArray(children)\n  const itemCount = itemData.length\n\n  // Calculate size of child element.\n  const getChildSize = (child) => {\n    return React.isValidElement(child) && child.type === ListSubheader\n      ? headerSize\n      : itemSize\n  }\n\n  // Calculates the height of the suggestion box\n  const getHeight = () => {\n    return itemCount > 8\n      ? 8 * itemSize\n      : itemData.map(getChildSize).reduce((a, b) => a + b, 0)\n  }\n\n  const gridRef = useResetCache(itemCount)\n\n  return <div ref={ref}>\n    <OuterElementContext.Provider value={other}>\n      <List disablePadding>\n        <VariableSizeList\n          itemData={itemData}\n          height={getHeight() + 2 * LISTBOX_PADDING}\n          width=\"100%\"\n          ref={gridRef}\n          outerElementType={OuterElementType}\n          innerElementType=\"ul\"\n          itemSize={(index) => getChildSize(itemData[index])}\n          overscanCount={5}\n          itemCount={itemCount}\n        >\n          {renderRow}\n        </VariableSizeList>\n      </List>\n    </OuterElementContext.Provider>\n  </div>\n})\n\nListboxSuggestion.propTypes = {\n  children: PropTypes.node\n}\n\nconst OuterElementType = React.forwardRef((props, ref) => {\n  const outerProps = useContext(OuterElementContext)\n  return <div ref={ref} {...props} {...outerProps} />\n})\n\nexport default SearchBar\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useContext, useEffect, useState, useCallback } from 'react'\nimport PropTypes from 'prop-types'\nimport { DoesNotExist } from '../api'\nimport { useDataStore } from '../DataStore'\nimport { useHistory } from 'react-router-dom'\nimport { getUrl } from '../nav/Routes'\nimport { apiBase } from '../../config'\n\nexport const uploadPageContext = React.createContext()\n\nexport function useUploadPageContext() {\n  return useContext(uploadPageContext)\n}\n\nconst UploadPageContext = React.memo(function UploadPageContext({uploadId, children}) {\n  const dataStore = useDataStore()\n  dataStore.resetIfNeeded(uploadId)\n  const [uploadStoreObj, setUploadStoreObj] = useState(dataStore.getUpload(apiBase, uploadId))\n\n  const onUploadStoreUpdated = useCallback((oldStoreObj, newStoreObj) => {\n    setUploadStoreObj(newStoreObj)\n  }, [setUploadStoreObj])\n\n  useEffect(() => {\n    return dataStore.subscribeToUpload(apiBase, uploadId, onUploadStoreUpdated, true, true)\n  }, [dataStore, uploadId, onUploadStoreUpdated])\n\n  const history = useHistory()\n\n  useEffect(() => {\n    if (uploadStoreObj.error && uploadStoreObj.error instanceof DoesNotExist && uploadStoreObj.deletionRequested) {\n      history.push(getUrl('user/uploads', new URL(window.location.href).pathname))\n    }\n  })\n\n  return <uploadPageContext.Provider value={uploadStoreObj}>\n    {children}\n  </uploadPageContext.Provider>\n})\nUploadPageContext.propTypes = {\n  uploadId: PropTypes.string.isRequired,\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ])\n}\n\nexport default UploadPageContext\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { apiBase } from '../../config'\nimport { Tooltip, IconButton, Menu, MenuItem } from '@material-ui/core'\nimport DownloadIcon from '@material-ui/icons/CloudDownload'\n\nconst EntryDownloadButton = React.memo(function EntryDownloadButton(props) {\n  const {tooltip, disabled, buttonProps, dark, query} = props\n  const [anchorEl, setAnchorEl] = useState(null)\n\n  const handleClick = event => {\n    event.stopPropagation()\n    setAnchorEl(event.currentTarget)\n  }\n\n  const handleSelect = (urlSuffix) => {\n    setAnchorEl(null)\n    const queryStringData = query\n    const owner = query.visibility || 'visible'\n    const url = `${apiBase}/v1/entries/${urlSuffix}?owner=${owner}&json_query=${JSON.stringify(queryStringData)}`\n    window.location.assign(url)\n  }\n\n  const handleClose = () => {\n    setAnchorEl(null)\n  }\n\n  return <React.Fragment>\n    <IconButton\n      {...buttonProps}\n      disabled={disabled}\n      onClick={handleClick}\n      style={dark ? {color: 'white'} : null}\n    >\n      <Tooltip title={tooltip || 'Download'}>\n        <DownloadIcon />\n      </Tooltip>\n    </IconButton>\n    <Menu\n      anchorEl={anchorEl}\n      open={Boolean(anchorEl)}\n      onClose={handleClose}\n    >\n      <MenuItem onClick={() => handleSelect('raw')}>Raw uploaded files</MenuItem>\n      <MenuItem onClick={() => handleSelect('archive/download')}>Processed data</MenuItem>\n    </Menu>\n  </React.Fragment>\n})\nEntryDownloadButton.propTypes = {\n  /**\n   * The query that defines what to download.\n   */\n  query: PropTypes.object.isRequired,\n  /**\n   * A tooltip for the button\n   */\n  tooltip: PropTypes.string,\n  /**\n   * Whether the button is disabled\n   */\n  disabled: PropTypes.bool,\n  /**\n   * Properties forwarded to the button.\n   */\n  buttonProps: PropTypes.object,\n  dark: PropTypes.bool\n}\n\nexport default EntryDownloadButton\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useMemo } from 'react'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore'\nimport { QuantityCell, QuantityRow, QuantityTable } from '../../Quantity'\nimport { isNil, chunk } from 'lodash'\nimport {\n  Accordion as MuiAccordion,\n  AccordionDetails as MuiAccordionDetails,\n  AccordionSummary as MuiAccordionSummary,\n  Card,\n  CardContent,\n  CardHeader,\n  CardActions,\n  Grid,\n  Typography,\n  makeStyles,\n  withStyles\n} from '@material-ui/core'\nimport { traverseDeep } from '../../../utils'\n\n/**\n * Contains components for displaying properties. The main idea is:\n * - Each main property category should be placed inside a PropertyCard.\n * - A property card should have PropertyGrid as a direct descendant.\n * - PropertyItems are used to display individual properties inside a PropertyGrid.\n * - If you wish to subdivide a single PropertyItem into smaller subitems, use a\n *   PropertySubGrid with the set of wanted PropertyItems inside it.\n */\n\nconst gridSpacing = 2\n\n/**\n * Card for displaying a set of related properties.\n */\nconst usePropertyCardStyles = makeStyles(theme => ({\n  header: {\n    paddingBottom: theme.spacing(1),\n    minHeight: 0,\n    flexGrow: '0'\n  },\n  content: {\n    height: '100%',\n    width: '100%',\n    boxSizing: 'border-box',\n    minHeight: 0\n  },\n  action: {\n    marginRight: theme.spacing(0),\n    marginTop: theme.spacing(0)\n  },\n  container: {\n    display: 'flex',\n    flexDirection: 'column',\n    height: '100%',\n    width: '100%'\n  }\n}))\nexport function PropertyCard({className, children, ...headerProps}) {\n  const styles = usePropertyCardStyles()\n\n  return <Card className={className} data-testid='property-card'>\n    <div className={styles.container}>\n      <CardHeader\n        {...headerProps}\n        className={styles.header}\n        classes={{action: styles.action}}\n      />\n      <CardContent className={styles.content}>\n        {children}\n      </CardContent>\n    </div>\n  </Card>\n}\nPropertyCard.propTypes = {\n  className: PropTypes.string,\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ])\n}\n\n/**\n * For displaying actions at the bottom of a PropertyCard.\n */\nconst usePropertyCardActionsStyles = makeStyles(theme => ({\n  root: {\n    marginLeft: 'auto'\n  }\n}))\nexport function PropertyCardActions({children}) {\n  const styles = usePropertyCardActionsStyles()\n  return <CardActions disableSpacing>\n    <div className={styles.root}>\n      {children}\n    </div>\n  </CardActions>\n}\n\nPropertyCardActions.propTypes = {\n  children: PropTypes.any\n}\n\n/**\n * For displaying actions at the bottom of a PropertyCard.\n */\nconst usePropertyTitleStyles = makeStyles(theme => ({\n  root: {\n    textTransform: 'none',\n    fontSize: '0.9rem'\n  }\n}))\nexport function PropertyTitle({title, align, className}) {\n  const styles = usePropertyTitleStyles()\n  return title\n    ? <Typography\n      variant=\"button\"\n      align={align || 'center'}\n      className={clsx(className, styles.root)}\n    >{title}</Typography>\n    : null\n}\n\nPropertyTitle.propTypes = {\n  title: PropTypes.string,\n  align: PropTypes.string,\n  className: PropTypes.string\n}\n\n/**\n * For displaying a row of properties, typically within a PropertyCard.\n */\nexport function PropertyGrid({className, children}) {\n  return <Grid container spacing={gridSpacing} className={className} style={{height: '100%'}}>\n    {children}\n  </Grid>\n}\n\nPropertyGrid.propTypes = {\n  className: PropTypes.string,\n  children: PropTypes.any\n}\n\n/**\n * For displaying a grid of PropertyItems inside another PropertyItem.\n */\nconst usePropertySubGridStyles = makeStyles(theme => ({\n  root: {\n    height: `calc(100% + ${theme.spacing(gridSpacing)}px)`\n  }\n}))\nexport function PropertySubGrid({children}) {\n  const styles = usePropertySubGridStyles()\n  return <Grid container spacing={gridSpacing} className={styles.root}>\n    {children}\n  </Grid>\n}\n\nPropertySubGrid.propTypes = {\n  className: PropTypes.string,\n  children: PropTypes.any\n}\n\n/**\n * For displaying an individual property, typically within a PropertyRow.\n */\nconst usePropertyItemStyles = makeStyles(theme => ({\n  title: {\n    marginBottom: theme.spacing(1)\n  },\n  column: {\n    width: '100%',\n    height: '100%',\n    display: 'flex',\n    flexDirection: 'column'\n  },\n  content: {\n    flex: 1,\n    minHeight: 0 // min-height: 0 to allow the item to shrink to fit inside the container.\n  }\n}))\nexport function PropertyItem({\n  title,\n  align,\n  className,\n  classes,\n  children,\n  height,\n  minHeight,\n  ...other\n}) {\n  const styles = usePropertyItemStyles({classes: classes})\n  return <Grid\n    item\n    {...other}\n    className={className}\n    style={\n      (!isNil(height) || !isNil(minHeight)) && {height: height, minHeight: minHeight}\n    }\n  >\n    <div className={styles.column}>\n      <PropertyTitle title={title} className={styles.title}/>\n      <div className={styles.content}>\n        {children}\n      </div>\n    </div>\n  </Grid>\n}\n\nPropertyItem.propTypes = {\n  title: PropTypes.string,\n  align: PropTypes.string,\n  height: PropTypes.string.isRequired,\n  minHeight: PropTypes.string,\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  children: PropTypes.any\n}\n\nPropertyItem.defaultProps = {\n  height: '400px'\n}\n\n/**\n * For displaying the provenance for a property.\n */\nconst usePropertyProvenanceListStyle = makeStyles(theme => ({\n  column: {\n    width: '100%',\n    height: '100%',\n    display: 'flex',\n    flexDirection: 'column'\n  },\n  content: {\n    flex: 1,\n    minHeight: 0 // min-height: 0 to allow the item to shrink to fit inside the container.\n  }\n}))\nexport function PropertyProvenanceList({className, classes, children, ...other}) {\n  const styles = usePropertyProvenanceListStyle({classes: classes})\n  return <Grid item {...other} className={className}>\n    <div className={styles.column}>\n      <div className={styles.content}>\n        {children}\n      </div>\n    </div>\n  </Grid>\n}\n\nPropertyProvenanceList.propTypes = {\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  children: PropTypes.any\n}\n\nconst Accordion = withStyles((theme) => ({\n  expanded: {\n    margin: theme.spacing(1)\n  }\n}))(MuiAccordion)\n\nconst AccordionSummary = withStyles((theme) => ({\n  root: {\n    padding: `0 ${theme.spacing(1)}px`,\n    minHeight: theme.spacing(4),\n    '&$expanded': {\n      minHeight: theme.spacing(4)\n    }\n  },\n  content: {\n    margin: 0,\n    '&$expanded': {\n      margin: 0\n    }\n  },\n  expanded: {}\n}))(MuiAccordionSummary)\n\nconst AccordionDetails = withStyles((theme) => ({\n  root: {\n    margin: 0,\n    padding: `0 ${theme.spacing(1)}px`\n  }\n}))(MuiAccordionDetails)\n\n/**\n * For displaying provenance steps.\n */\nexport const PropertyProvenanceItem = React.memo(({title, data, path, columns}) => {\n  // Recursively extract items from the data and split the items into equal sized rows\n  const rows = useMemo(() => {\n    if (!data) return undefined\n\n    const quantities = []\n    for (const [key, value] of traverseDeep(data, true)) {\n      quantities.push({\n        quantity: `${path === '' ? '' : `${path}.`}${key.join('.')}`,\n        value: value\n      })\n    }\n\n    return chunk(quantities, columns)\n  }, [data, path, columns])\n\n  if (!data) {\n    return null\n  }\n\n  return <Accordion defaultExpanded elevation={0}>\n    <AccordionSummary IconButtonProps={{size: 'small'}} expandIcon={<ExpandMoreIcon />}>\n      <PropertyTitle title={title} />\n    </AccordionSummary>\n    <AccordionDetails>\n      <QuantityTable>\n        {rows.map((row) =>\n          <QuantityRow key={row[0].quantity}>\n            {row.map((column) => <QuantityCell\n              key={column.quantity}\n              {...column}\n            />)}\n          </QuantityRow>\n        )}\n      </QuantityTable>\n    </AccordionDetails>\n  </Accordion>\n})\n\nPropertyProvenanceItem.propTypes = {\n  title: PropTypes.string,\n  data: PropTypes.object,\n  path: PropTypes.string,\n  columns: PropTypes.number\n}\n\nPropertyProvenanceItem.defaultProps = {\n  columns: 4\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useCallback, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { capitalize, isEmpty } from 'lodash'\nimport { Select, FormControl, MenuItem } from '@material-ui/core'\nimport { PropertyCard, PropertyGrid, PropertyItem, PropertyCardActions } from './PropertyCard'\nimport Quantity, { QuantityTable, QuantityRow, QuantityCell } from '../../Quantity'\nimport { MaterialButton } from '../../nav/Routes'\nimport Structure, { toMateriaStructure } from '../../visualization/Structure'\nimport NoData from '../../visualization/NoData'\nimport { encyclopediaBase, guiBase } from '../../../config'\n\n/**\n * For displaying the most descriptive chemical formula that is present in an\n * entry.\n*/\nexport function Formula({data}) {\n  const formula = (data) => {\n    const material = data?.results?.material\n    if (!material) {\n      return null\n    }\n\n    return material.chemical_formula_hill || material.chemical_formula_reduced || material.chemical_formula_descriptive\n  }\n\n  return <Quantity\n    quantity={formula} label='Formula' noWrap data={data}\n    description=\"The chemical formula that describes the simulated system or experimental sample.\"\n  />\n}\n\nFormula.propTypes = {\n  data: PropTypes.object\n}\n\n/**\n * Displays a summary of material related properties for an entry.\n */\nconst MaterialCard = React.memo(({index, properties, archive}) => {\n  // Find out which properties are present\n  const structures = index?.results?.properties?.structures\n  const hasStructures = structures?.structure_original ||\n    structures?.structure_conventional ||\n    structures?.structure_primitive\n  const hasLatticeParameters = structures?.structure_original?.lattice_parameters ||\n    structures?.structure_conventional?.lattice_parameters ||\n    structures?.structure_primitive?.lattice_parameters\n  const hasSymmetry = index?.results?.material?.symmetry\n\n  // Get all structure types that are present\n  const structureTypes = {}\n  if (structures) {\n    Object.keys(structures).forEach((key) => {\n      const name = capitalize(key.split('_').pop())\n      structureTypes[key] = name\n    })\n  }\n\n  // Determine the structure to show by default\n  let defaultStructure\n  if (structures && !isEmpty(structures)) {\n    if ('structure_original' in structures) {\n      defaultStructure = 'structure_original'\n    } else if ('structure_conventional' in structures) {\n      defaultStructure = 'structure_conventional'\n    } else if (!isEmpty(structures)) {\n      defaultStructure = Object.keys(structures)[0]\n    }\n  }\n  const [structureType, setStructureType] = useState(defaultStructure)\n\n  const handleStructureChange = useCallback((event) => {\n    setStructureType(event.target.value)\n  }, [])\n\n  if (!index?.results?.material) {\n    return null\n  }\n\n  // Prepare the data for the visualizer\n  const urlPrefix = `${window.location.pathname.slice(guiBase.length)}/data/results/properties/structures`\n  const materialId = index.results?.material?.material_id\n  const structurePath = `results.properties.structures.${structureType}`\n  const structureSection = archive?.results?.properties?.structures?.[structureType]\n  const m_path = `${urlPrefix}/${structureType}`\n  const structure = structureSection && toMateriaStructure(structureSection)\n\n  // Dropdown for selecting a specific structure\n  const select = hasStructures && <FormControl>\n    <Select\n      value={structureType}\n      onChange={handleStructureChange}\n      label=\"Structure\"\n    >\n      {Object.entries(structureTypes).map(([type, name]) =>\n        <MenuItem key={type} value={type}>{name}</MenuItem>\n      )}\n    </Select>\n  </FormControl>\n  return <PropertyCard title=\"Material\" action={select}>\n    <PropertyGrid>\n      <PropertyItem title=\"Composition\" xs={6} height=\"auto\">\n        <QuantityTable data={index}>\n          <QuantityRow>\n            <QuantityCell colSpan={2}>\n              <Formula data={index}/>\n            </QuantityCell>\n          </QuantityRow>\n          <QuantityRow>\n            <QuantityCell quantity=\"results.material.structural_type\"/>\n          </QuantityRow>\n          <QuantityRow>\n            <QuantityCell quantity=\"results.material.elements\" colSpan={2}/>\n          </QuantityRow>\n          <QuantityRow>\n            <QuantityCell quantity=\"results.material.n_elements\"/>\n          </QuantityRow>\n        </QuantityTable>\n      </PropertyItem>\n      <PropertyItem title=\"Structure\" xs={6} height=\"280px\">\n        {hasStructures\n          ? <Structure\n            data={structure}\n            structuralType={index.results?.material?.structural_type}\n            cellType={structureType.split('_').pop()}\n            m_path={m_path}\n            data-testid=\"viewer-material\"\n          />\n          : <NoData/>}\n      </PropertyItem>\n      <PropertyItem title=\"Symmetry\" xs={6} height=\"auto\" minHeight=\"200px\">\n        {hasSymmetry\n          ? <QuantityTable data={index}>\n            <QuantityRow>\n              <QuantityCell quantity=\"results.material.symmetry.crystal_system\"/>\n              <QuantityCell quantity=\"results.material.symmetry.bravais_lattice\"/>\n            </QuantityRow>\n            <QuantityRow>\n              <QuantityCell quantity=\"results.material.symmetry.space_group_number\"/>\n              <QuantityCell quantity=\"results.material.symmetry.space_group_symbol\"/>\n            </QuantityRow>\n            <QuantityRow>\n              <QuantityCell quantity=\"results.material.symmetry.point_group\"/>\n              <QuantityCell quantity=\"results.material.symmetry.structure_name\"/>\n            </QuantityRow>\n          </QuantityTable>\n          : <NoData/>\n        }\n      </PropertyItem>\n      <PropertyItem title=\"Lattice parameters\" xs={6} height=\"auto\" minHeight=\"200px\">\n        {hasLatticeParameters\n          ? <QuantityTable data={index}>\n            <QuantityRow>\n              <QuantityCell quantity={`${structurePath}.lattice_parameters.a`}/>\n              <QuantityCell quantity={`${structurePath}.lattice_parameters.b`}/>\n              <QuantityCell quantity={`${structurePath}.lattice_parameters.c`}/>\n            </QuantityRow>\n            <QuantityRow>\n              <QuantityCell quantity={`${structurePath}.lattice_parameters.alpha`} label=\"\"/>\n              <QuantityCell quantity={`${structurePath}.lattice_parameters.beta`} label=\"\"/>\n              <QuantityCell quantity={`${structurePath}.lattice_parameters.gamma`} label=\"\"/>\n            </QuantityRow>\n            <QuantityRow>\n              <QuantityCell colSpan={2} quantity={`${structurePath}.cell_volume`}/>\n            </QuantityRow>\n          </QuantityTable>\n          : <NoData/>}\n      </PropertyItem>\n    </PropertyGrid>\n    {encyclopediaBase && materialId &&\n      <PropertyCardActions>\n        <MaterialButton materialId={materialId}>\n          View in Encyclopedia\n        </MaterialButton>\n      </PropertyCardActions>\n    }\n  </PropertyCard>\n})\n\nMaterialCard.propTypes = {\n  index: PropTypes.object.isRequired,\n  properties: PropTypes.object.isRequired,\n  archive: PropTypes.object\n}\n\nexport default MaterialCard\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport Quantity from '../Quantity'\nimport { Formula } from './properties/MaterialCard'\nimport { Tooltip, IconButton, Box } from '@material-ui/core'\nimport { EntryButton } from '../nav/Routes'\nimport DetailsIcon from '@material-ui/icons/ArrowForward'\nimport { makeStyles } from '@material-ui/core/styles'\n\nexport const MethodMetadata = React.memo(({data}) => {\n  const methodQuantities = []\n  const addMethodQuantities = (obj, parentKey, hidden = []) => {\n    const children = {}\n    Object.keys(obj).forEach(key => {\n      if (hidden.includes(key)) {\n        return\n      }\n      const value = obj[key]\n      if (Array.isArray(value) || typeof value === 'string') {\n        if (value.length > 0) {\n          methodQuantities.push({quantity: `${parentKey}.${key}`})\n        }\n      } else if (value instanceof Object) {\n        children[key] = value\n      }\n    })\n    Object.keys(children).forEach(key => addMethodQuantities(children[key], `${parentKey}.${key}`))\n  }\n  if (data?.results?.method) {\n    addMethodQuantities(data.results.method, 'results.method')\n  }\n  if (data?.results?.eln) {\n    addMethodQuantities(data.results.eln, 'results.eln', ['names', 'sections', 'descriptions'])\n  }\n\n  methodQuantities.push({quantity: 'entry_type'})\n  methodQuantities.push({quantity: 'entry_name'})\n\n  return <Quantity flex>\n    {methodQuantities.map(({...quantityProps}) => (\n      <Quantity\n        key={quantityProps.quantity}\n        {...quantityProps}\n        noWrap\n        data={data}\n        hideIfUnavailable\n      />\n    ))}\n  </Quantity>\n})\nMethodMetadata.propTypes = {\n  data: PropTypes.object\n}\n\nexport const DomainMetadata = React.memo(({data}) => {\n  return <>\n    <Quantity flex>\n      <Formula data={data} />\n    </Quantity>\n    <MethodMetadata data={data} />\n  </>\n})\nDomainMetadata.propTypes = {\n  data: PropTypes.object\n}\n\nexport const UserMetadata = React.memo(({data}) => {\n  return (\n    <div>\n      <Quantity quantity='comment' data={data} />\n      <Quantity quantity='references' data={data}/>\n      <Quantity quantity='authors' data={data}/>\n      <Quantity quantity='datasets' data={data}/>\n    </div>\n  )\n})\nUserMetadata.propTypes = {\n  data: PropTypes.object.isRequired\n}\n\nexport const EntryIds = React.memo(({data}) => {\n  return (\n    <div>\n      <Quantity column >\n        {/* <Quantity quantity=\"pid\" label='PID' placeholder=\"not yet assigned\" noWrap data={data} withClipboard /> */}\n        <Quantity quantity=\"entry_id\" noWrap withClipboard data={data} />\n        <Quantity quantity=\"raw_id\" noWrap withClipboard data={data} />\n        <Quantity quantity=\"external_id\" noWrap withClipboard data={data} />\n        <Quantity quantity=\"mainfile\" noWrap ellipsisFront data={data} withClipboard />\n        <Quantity quantity=\"upload_id\" data={data}/>\n      </Quantity>\n    </div>\n  )\n})\nEntryIds.propTypes = {\n  data: PropTypes.object.isRequired\n}\n\nexport const VisitEntryAction = React.memo(({data, ...props}) => {\n  // The visit button is hidden if the entry is still processing.\n  if (data.process_running) {\n    return null\n  }\n\n  // The exit transition is disabled for this tooltip because this button causes\n  // a navigation that does not fully remove the button from the DOM (the page\n  // is cached and a new page is shown immediately). If the exit transition is\n  // left on, the button can flicker on the new page.\n  return <Tooltip\n    TransitionProps={{exit: false}}\n    title=\"Go to the entry page\"\n  >\n    <EntryButton\n      {...props}\n      entryId={data.entry_id}\n    />\n  </Tooltip>\n})\nVisitEntryAction.propTypes = {\n  data: PropTypes.object.isRequired\n}\n\nexport const EntryRowActions = React.memo((props) => {\n  return <Box display={'flex'} flexBasis={'auto'} justifyContent={'flex-end'}>\n    <VisitEntryAction {...props} component={IconButton}><DetailsIcon/></VisitEntryAction>\n  </Box>\n})\n\nconst useEntryDetailsStyles = makeStyles(theme => ({\n  entryDetails: {\n    paddingTop: theme.spacing(2),\n    paddingLeft: theme.spacing(4),\n    paddingRight: theme.spacing(4)\n  },\n  entryDetailsContents: {\n    display: 'flex',\n    width: '100%',\n    margin: '0'\n  },\n  entryDetailsRow: {\n    paddingRight: theme.spacing(3)\n  },\n  entryDetailsActions: {\n    display: 'flex',\n    flexBasis: 'auto',\n    flexGrow: 0,\n    flexShrink: 0,\n    justifyContent: 'flex-end',\n    marginBottom: theme.spacing(1),\n    marginTop: theme.spacing(2)\n  }\n}))\n\nexport const EntryDetails = React.memo(({data}) => {\n  const classes = useEntryDetailsStyles()\n\n  return (\n    <div className={classes.entryDetails}>\n      <div className={classes.entryDetailsContents}>\n        <div className={classes.entryDetailsRow}>\n          <DomainMetadata data={data} />\n        </div>\n\n        <div className={classes.entryDetailsRow} style={{flexGrow: 1, minWidth: 'fit-content'}}>\n          <Quantity className={classes.entryDetailsRow} column>\n            <Quantity quantity='comment' data={data} />\n            <Quantity quantity='references' data={data} />\n            <Quantity quantity='authors' data={data} />\n            <Quantity quantity='datasets' data={data} />\n          </Quantity>\n        </div>\n\n        <div className={classes.entryDetailsRow} style={{maxWidth: '33%', paddingRight: 0}}>\n          <Quantity column >\n            <Quantity quantity=\"entry_id\" data={data} />\n            <Quantity quantity=\"mainfile\" data={data} />\n            <Quantity quantity=\"upload_id\" data={data} />\n            <Quantity quantity=\"raw_id\" data={data} />\n            <Quantity quantity=\"external_id\" data={data} />\n          </Quantity>\n        </div>\n      </div>\n\n      <div className={classes.entryDetailsActions}>\n        <VisitEntryAction color=\"primary\" data={data}>\n          Go to the entry page\n        </VisitEntryAction>\n      </div>\n    </div>\n  )\n})\nEntryDetails.propTypes = {\n  data: PropTypes.object.isRequired\n}\n\nexport default EntryDetails\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { IconButton } from '@material-ui/core'\nimport { MaterialButton } from '../nav/Routes'\nimport DetailsIcon from '@material-ui/icons/ArrowForward'\n\nexport const MaterialRowActions = React.memo(({data, ...rest}) => {\n  return <MaterialButton materialId={data.material_id} {...rest} component={IconButton}>\n    <DetailsIcon/>\n  </MaterialButton>\n})\n\nMaterialRowActions.propTypes = {\n  data: PropTypes.object.isRequired\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useState, useMemo, useEffect, useCallback } from 'react'\nimport PropTypes from 'prop-types'\nimport jmespath from 'jmespath'\nimport { Paper, Typography, Tooltip, IconButton } from '@material-ui/core'\nimport { Alert } from '@material-ui/lab'\nimport LaunchIcon from '@material-ui/icons/Launch'\nimport {\n  Datatable,\n  DatatableLoadMorePagination,\n  DatatableTable,\n  DatatableToolbar,\n  DatatableToolbarActions\n} from '../datatable/Datatable'\nimport EntryDownloadButton from '../entry/EntryDownloadButton'\nimport EntryDetails, { EntryRowActions } from '../entry/EntryDetails'\nimport { MaterialRowActions } from '../material/MaterialDetails'\nimport { pluralize, formatInteger, parseJMESPath, filterOptions } from '../../utils'\nimport { isEmpty, isArray } from 'lodash'\nimport { useSearchContext } from './SearchContext'\n\n/**\n * Used to retrieve an URL link from the row metadata and display a link icon to\n * that resource.\n */\nexport const ActionURL = React.memo(({action, data}) => {\n  const {path} = parseJMESPath(action.path)\n  let href = jmespath.search(data, path)\n  href = isArray(href) ? href[0] : href\n  return <Tooltip title={action.description || ''}>\n    <IconButton href={href} target=\"_blank\"><LaunchIcon/></IconButton>\n  </Tooltip>\n})\nActionURL.propTypes = {\n  action: PropTypes.object.isRequired, // Action configuration from app config\n  data: PropTypes.object.isRequired // ES index data\n}\n\n/**\n * Displays the list of search results.\n */\nexport const SearchResults = React.memo(({\n  columns,\n  resource,\n  rows,\n  useResults,\n  useApiQuery,\n  noAction,\n  onSelectedChanged,\n  defaultUncollapsedEntryID,\n  title,\n  'data-testid': testID,\n  PaperProps,\n  ...otherProps\n}) => {\n  const {data, pagination, setPagination} = useResults()\n  const apiQuery = useApiQuery()\n  const [selected, setSelected] = useState(new Set())\n\n  useEffect(() => {\n    if (onSelectedChanged) {\n      onSelectedChanged(selected)\n    }\n  }, [onSelectedChanged, selected])\n\n  const query = useMemo(() => {\n    if (selected === 'all') {\n      return apiQuery\n    }\n    return {entry_id: [...selected]}\n  }, [selected, apiQuery])\n\n  const actions = useCallback((data) => {\n    const actionComponents = []\n    for (const [key, value] of Object.entries(filterOptions(rows.actions))) {\n      const component = {\n        'url': <ActionURL key={key} action={value} data={data}/>\n      }[value.type]\n      if (component) {\n        actionComponents.push(component)\n      }\n    }\n    if (resource === \"entries\") {\n      actionComponents.push(<EntryRowActions key=\"entries-default-action\" data={data}/>)\n    } else if (resource === \"materials\") {\n      actionComponents.push(<MaterialRowActions key=\"materials-default-action\" data={data}/>)\n    }\n    return actionComponents\n  }, [rows, resource])\n\n  if (isEmpty(columns)) {\n    return <Alert severity=\"warning\">\n      No search columns defined within this search context. Ensure that all GUI artifacts are created.\n    </Alert>\n  }\n\n  if (pagination.total === 0) {\n    return <Typography>no results</Typography>\n  }\n\n  if (!pagination.total) {\n    return <Typography>searching ...</Typography>\n  }\n\n  // Select components based on the targeted resource\n  let details\n  let buttons\n  if (resource === \"entries\") {\n    details = rows?.details?.render || EntryDetails\n    if (!noAction) buttons = <EntryDownloadButton tooltip=\"Download files\" query={query} />\n  }\n\n  return <Paper data-testid={testID} {...PaperProps}>\n    <Datatable\n      data={data}\n      pagination={pagination}\n      onPaginationChanged={setPagination}\n      columns={columns?.options && Object.values(columns.options)}\n      shownColumns={columns?.selected}\n      selected={rows?.selection?.enabled ? selected : undefined}\n      getId={option => option.entry_id}\n      onSelectedChanged={rows?.selection?.enabled ? setSelected : undefined}\n      {...otherProps}\n    >\n      <DatatableToolbar title={`${formatInteger(data.length)}/${pluralize(title || 'result', pagination.total, true, true, title ? undefined : 'search')}`}>\n        {rows?.selection?.enabled &&\n          <DatatableToolbarActions selection>\n            {buttons}\n          </DatatableToolbarActions>\n        }\n      </DatatableToolbar>\n      <DatatableTable\n        actions={rows?.actions?.enabled ? actions : undefined}\n        details={rows?.details?.enabled ? details : undefined}\n        defaultUncollapsedRow={defaultUncollapsedEntryID && data.find(row => row.entry_id === defaultUncollapsedEntryID)}\n      >\n        <DatatableLoadMorePagination color=\"primary\">load more</DatatableLoadMorePagination>\n      </DatatableTable>\n    </Datatable>\n  </Paper>\n})\n\nSearchResults.propTypes = {\n  columns: PropTypes.object,\n  resource: PropTypes.string,\n  rows: PropTypes.object,\n  useResults: PropTypes.func,\n  useApiQuery: PropTypes.func,\n  noAction: PropTypes.bool,\n  PaperProps: PropTypes.object,\n  onSelectedChanged: PropTypes.func,\n  defaultUncollapsedEntryID: PropTypes.string,\n  title: PropTypes.string,\n  'data-testid': PropTypes.string\n}\n\nSearchResults.defaultProps = {\n  'data-testid': 'search-results'\n}\n\n/**\n * Displays search results from the current search context.\n */\nexport const SearchResultsWithContext = React.memo((props) => {\n  const {columns, resource, rows, useResults, useApiQuery} = useSearchContext()\n\n  return <SearchResults\n    columns={columns}\n    resource={resource}\n    rows={rows}\n    useResults={useResults}\n    useApiQuery={useApiQuery}\n    {...props}\n  />\n})\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useCallback, useContext, useEffect, useMemo, useState} from 'react'\nimport {\n  makeStyles, DialogContent, Dialog, Typography, FormControlLabel,\n  Box, MenuItem, ListItemIcon, ListItemText, MenuList, Chip, RadioGroup, Radio, FormControl, Checkbox\n} from '@material-ui/core'\nimport Button from '@material-ui/core/Button'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport PropTypes from 'prop-types'\nimport {FreeformSearchContext, useSearchContext} from \"../search/SearchContext\"\nimport {ui, searchQuantities, apiBase} from \"../../config\"\nimport SearchBar from '../search/SearchBar'\nimport {useApi} from '../api'\nimport {useUploadPageContext} from './UploadPageContext'\nimport {useEntryStore} from '../entry/EntryContext'\nimport {traverse, useGlobalMetainfo} from '../archive/metainfo'\nimport { defaultFilterGroups, quantityNameSearch } from '../search/FilterRegistry'\nimport { SearchResultsWithContext } from '../search/SearchResults'\nimport {useDataStore} from '../DataStore'\nimport {pluralize, resolveNomadUrlNoThrow} from \"../../utils\"\nimport {Check} from '@material-ui/icons'\nimport { cloneDeep } from 'lodash'\nimport {getItemLabelKey} from '../archive/ArchiveBrowser'\n\n// Use the same context as in the global entries search, but with free-text\n// query enabled\nconst searchDialogContext = React.createContext()\nconst context = cloneDeep(ui?.apps?.options?.entries)\ncontext.search_syntaxes.exclude = undefined\n\nconst allFilters = new Set(defaultFilterGroups && (Object.keys(context?.filter_menus?.options))\n  .map(filter => {\n    const group = defaultFilterGroups?.[filter]\n    return group ? Array.from(group) : []\n  }).flat())\n\nconst useStyles = makeStyles(theme => ({\n  dialog: {\n    width: '100%',\n    minWidth: 1100,\n    minHeight: 400\n  },\n  dialogContent: {\n  },\n  resultsTable: {\n    overflowY: 'scroll',\n    maxHeight: 700\n  },\n  searchBar: {\n    display: 'flex',\n    flexGrow: 0,\n    zIndex: 1,\n    backgroundColor: 'rgba(0, 0, 0, 0.09)'\n  },\n  filters: {\n    marginTop: 10\n  }\n}))\n\nconst shownColumns = [\n  'entry_name',\n  'entry_type',\n  'authors',\n  'upload_name'\n]\n\nexport async function getSectionsInfo(api, dataStore, reference, entry_id) {\n  let response\n  try {\n    response = await api.post(`entries/archive/query`, {\n      owner: 'visible',\n      query: {\n        entry_id: entry_id,\n        processed: true\n      }\n    })\n  } catch (e) {\n    return []\n  }\n  const dataArchive = response?.data?.[0]?.archive\n  if (!dataArchive) return\n  const sections = Object.keys(dataArchive).filter((key) => 'm_def' in dataArchive[key])\n  const referencedSubSections = []\n  if (sections.length > 0) {\n    for (const section of sections) {\n      const m_def = dataArchive[section].m_def\n      const url = dataArchive.metadata.upload_id ? `${apiBase}/uploads/${dataArchive.metadata.upload_id}/archive/${entry_id}` : undefined\n      const dataMetainfoDefUrl = resolveNomadUrlNoThrow(m_def, url)\n      const sectionDef = await dataStore.getMetainfoDefAsync(dataMetainfoDefUrl)\n      traverse(dataArchive[section], sectionDef, section, (section, sectionDef, path) => {\n        const ref = reference && [...reference][0]\n        if (ref &&\n          (sectionDef._qualifiedName === ref || sectionDef._allBaseSections?.map(section => section._qualifiedName).includes(ref))) {\n          const itemLabelKey = getItemLabelKey(sectionDef)\n          const name = itemLabelKey && section[itemLabelKey]\n          referencedSubSections.push({name: name, upload_id: response?.data?.[0]?.upload_id, entry_id: response?.data?.[0]?.entry_id, path: path})\n        }\n      })\n    }\n  }\n  const references = referencedSubSections || []\n  return references.map(reference => {\n    const fullPath = reference?.path && reference.path !== '/data' && reference.path !== 'data' ? `${dataArchive?.metadata?.mainfile}#${reference.path}` : dataArchive?.metadata?.mainfile\n    return {\n      label: reference.name ? `${reference.name} (./${reference?.path})` : `./${reference?.path}`,\n      fullPath: fullPath,\n      mainfile: dataArchive?.metadata?.mainfile,\n      entry_name: dataArchive?.metadata?.entry_name,\n      entry_id: reference.entry_id,\n      upload_id: reference.upload_id,\n      shownValue: reference.name || fullPath,\n      value: reference.path,\n      data: reference\n    }\n  })\n}\n\nexport async function getSchemaInfo(globalMetainfo, entry_id) {\n  const customMetainfo = await globalMetainfo.fetchAllCustomMetainfos(true, {entry_id: entry_id})\n  const schemaArchive = customMetainfo[0]?._data\n  const sectionDefs = schemaArchive?.definitions?.section_definitions\n  return sectionDefs.map(sectionDef => {\n    const fullPath = `${schemaArchive?.metadata?.mainfile}#${sectionDef.name}`\n    return {\n      label: sectionDef.name,\n      fullPath: fullPath,\n      mainfile: schemaArchive?.metadata?.mainfile,\n      entry_name: schemaArchive?.metadata?.entry_name,\n      entry_id: schemaArchive.metadata.entry_id,\n      value: sectionDef.name,\n      shownValue: sectionDef.name || fullPath,\n      data: {sectionDef: sectionDef, archive: schemaArchive}\n    }\n  })\n}\n\nconst Details = React.memo(({data}) => {\n  const {api} = useApi()\n  const entry_id = data?.entry_id\n  const globalMetainfo = useGlobalMetainfo()\n  const dataStore = useDataStore()\n  const {useFiltersLockedState} = useSearchContext()\n  const filtersLocked = useFiltersLockedState(['section_defs.definition_qualified_name'])\n  const [sections, setSections] = useState()\n\n  const {selected, onSelectedChanged} = useContext(searchDialogContext)\n\n  useEffect(() => {\n    if (entry_id && globalMetainfo) {\n      fetch()\n    }\n    async function fetch() {\n      if (filtersLocked['section_defs.definition_qualified_name']?.has('nomad.metainfo.metainfo.Definition')) {\n        const schemas = await getSchemaInfo(globalMetainfo, entry_id)\n        setSections(schemas)\n      } else {\n        const references = await getSectionsInfo(api, dataStore, filtersLocked['section_defs.definition_qualified_name'], entry_id)\n        setSections(references)\n      }\n    }\n  }, [api, dataStore, entry_id, filtersLocked, globalMetainfo])\n\n  if (!sections) {\n    return ''\n  }\n\n  return (\n    <MenuList dense>\n      {sections.map((section, index) => {\n        const isSelected = selected && section.entry_id === selected.entry_id && section.value === selected.value\n        return (\n          <MenuItem key={`${entry_id}-${index + 1}`} value={section.label} onClick={() => onSelectedChanged(section)}>\n            {isSelected && <ListItemIcon>\n              <Check data-testid='check-icon'/>\n            </ListItemIcon>}\n            <ListItemText inset={!isSelected}>\n              {section.label}\n            </ListItemText>\n          </MenuItem>\n        )\n      })}\n    </MenuList>\n  )\n})\nDetails.propTypes = {\n  data: PropTypes.object.isRequired\n}\n\nconst columns = context?.columns\nconst rows = context?.rows\ncolumns.selected = shownColumns\nrows.details = {enabled: true, render: Details}\nrows.actions = {enabled: false}\n\nfunction SearchBox({open, onCancel, onSelectedChanged, selected}) {\n  const classes = useStyles()\n  const {user} = useApi()\n  const [filter, setFilter] = useState('visible')\n  const [unpublished, setUnpublished] = useState(true)\n  const [published, setPublished] = useState(true)\n  const {\n    useSetFilter,\n    useFilters,\n    useFiltersLocked,\n    useUpdateFilter,\n    filters: filterList\n  } = useSearchContext()\n  const filtersLocked = useFiltersLocked()\n  const filters = useFilters([...allFilters]\n    .filter(\n      filter => filter !== 'visibility' &&\n      filter !== 'processed' &&\n      filter !== 'upload_id' &&\n      filter !== 'published' &&\n      filter !== 'main_author.user_id' &&\n      !filtersLocked[filter]\n    ))\n  const updateFilter = useUpdateFilter()\n  const uploadContext = useUploadPageContext()\n  const entryContext = useEntryStore()\n  const {uploadId} = uploadContext || entryContext\n  const setVisibilityFilter = useSetFilter('visibility')\n  const setUploadIdFilter = useSetFilter('upload_id')\n  const setProcessedFilter = useSetFilter('processed')\n  const setPublishedFilter = useSetFilter('published')\n  const setMainAuthorFilter = useSetFilter('main_author.user_id')\n\n  const handleCancel = useCallback(() => {\n    onCancel()\n  }, [onCancel])\n\n  useEffect(() => {\n    setProcessedFilter(true)\n    setPublishedFilter(published === unpublished ? undefined : published)\n    if (filter === 'visible') {\n      setVisibilityFilter(undefined)\n      setMainAuthorFilter(undefined)\n      setUploadIdFilter(undefined)\n    } else if (filter === 'mine') {\n      setVisibilityFilter('user')\n      setMainAuthorFilter(undefined)\n      setUploadIdFilter(undefined)\n    } else if (filter === 'coauthors') {\n      setVisibilityFilter(undefined)\n      setMainAuthorFilter([user.sub], {queryMode: 'none'})\n      setUploadIdFilter(undefined)\n    } else if (filter === 'upload') {\n      setVisibilityFilter(undefined)\n      setMainAuthorFilter(undefined)\n      setUploadIdFilter(uploadId)\n    }\n  }, [filter, published, unpublished, setUploadIdFilter, setMainAuthorFilter, setVisibilityFilter, setPublishedFilter, setProcessedFilter, uploadId, user])\n\n  const contextValue = useMemo(() => ({\n    selected: selected,\n    onSelectedChanged: onSelectedChanged\n  }), [onSelectedChanged, selected])\n\n  const definedFilters = useMemo(() => {\n    return Object.values(filters).filter(value => {\n      return value !== undefined\n    })\n  }, [filters])\n\n  const handleResetSearch = () => {\n    return Object.keys(filters).forEach(key => {\n      updateFilter([key, undefined])\n    })\n  }\n\n  // Customize the search bar suggestions priority.\n  const quantities = useMemo(() => {\n    let quantities = new Set([\n      'entry_name',\n      'mainfile',\n      'text_search_contents',\n      'results.material.elements',\n      'results.material.chemical_formula_hill',\n      'results.material.chemical_formula_anonymous',\n      'results.material.structural_type',\n      'results.material.symmetry.structure_name',\n      'results.method.simulation.program_name',\n      'authors.name'\n    ])\n    const allQuantities = [...filterList]\n    allQuantities\n      .filter(q => !quantities.has(q) && searchQuantities[q]?.suggestion)\n      .forEach(q => quantities.add(q))\n    quantities = [...quantities].map((name) => ({name, size: 5}))\n    quantities.push({name: quantityNameSearch})\n    return quantities\n  }, [filterList])\n\n  return <searchDialogContext.Provider value={contextValue}>\n    <Dialog classes={{paper: classes.dialog}} open={open} data-testid='section-select-dialog'>\n      <DialogContent className={classes.dialogContent}>\n        <SearchBar quantities={quantities} className={classes.searchBar} />\n        <Typography className={classes.filters} variant=\"body1\">\n          Filters\n        </Typography>\n        <Box display='grid'>\n          <FormControl>\n            <RadioGroup row>\n              <FormControlLabel\n                value={'visible'}\n                control={(\n                  <Radio\n                    checked={filter === 'visible'}\n                    onClick={() => setFilter('visible')}\n                  />\n                )}\n                label='All'\n              />\n              <FormControlLabel\n                value={'mine'}\n                control={(\n                  <Radio\n                    checked={filter === 'mine'}\n                    onClick={() => setFilter('mine')}\n                  />\n                )}\n                label='Only mine'\n              />\n              <FormControlLabel\n                value={'coauthors'}\n                control={(\n                  <Radio\n                    checked={filter === 'coauthors'}\n                    onClick={() => setFilter('coauthors')}\n                  />\n                )}\n                label='Only from others'\n              />\n              <FormControlLabel\n                value={'upload'}\n                control={(\n                  <Radio\n                    checked={filter === 'upload'}\n                    onClick={() => setFilter('upload')}\n                  />\n                )}\n                label='Only this upload'\n              />\n            </RadioGroup>\n          </FormControl>\n          <Box display='flex'>\n            <FormControlLabel\n              control={<Checkbox\n                onChange={event => setPublished(event.target.checked)}\n                color='primary'\n                checked={published}\n                name='Published'\n              />}\n              label='Published'\n            />\n            <FormControlLabel\n              control={<Checkbox\n                onChange={event => setUnpublished(event.target.checked)}\n                color='primary'\n                checked={unpublished}\n                name='Unpublished'\n              />}\n              label='Unpublished'\n            />\n          </Box>\n          {definedFilters.length > 0 && <Chip label={`and ${definedFilters.length} more ${pluralize('filter', definedFilters.length, false)}`} color=\"primary\" onDelete={() => handleResetSearch()}/>}\n        </Box>\n        <div className={classes.resultsTable}>\n          <SearchResultsWithContext\n            defaultUncollapsedEntryID={selected?.entry_id}\n            multiSelect={false}\n            noAction\n          />\n        </div>\n      </DialogContent>\n      <DialogActions>\n        <span style={{flexGrow: 1}} />\n        <Button onClick={handleCancel} color=\"secondary\">\n          Cancel\n        </Button>\n      </DialogActions>\n    </Dialog>\n  </searchDialogContext.Provider>\n}\nSearchBox.propTypes = {\n  open: PropTypes.bool,\n  onCancel: PropTypes.func,\n  onSelectedChanged: PropTypes.func,\n  selected: PropTypes.object\n}\n\nfunction SectionSelectDialog(props) {\n  const {open, onSelectedChanged, selected, onCancel, filtersLocked} = props\n\n  if (!open) return null\n\n  return <FreeformSearchContext\n    resource={context?.resource}\n    initialPagination={context?.pagination}\n    initialColumns={columns}\n    initialRows={rows}\n    initialFilterMenus={context?.filter_menus}\n    initialFiltersLocked={filtersLocked}\n    initialSearchSyntaxes={context?.search_syntaxes}\n    id='sectionselect'\n  >\n    <SearchBox open={open} onCancel={onCancel} onSelectedChanged={onSelectedChanged} selected={selected}/>\n  </FreeformSearchContext>\n}\nSectionSelectDialog.propTypes = {\n  open: PropTypes.bool,\n  onSelectedChanged: PropTypes.func,\n  selected: PropTypes.object,\n  onCancel: PropTypes.func,\n  filtersLocked: PropTypes.object\n}\n\nexport default SectionSelectDialog\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useCallback, useEffect, useMemo, useState} from 'react'\nimport PropTypes from 'prop-types'\nimport {useApi} from '../api'\nimport {Autocomplete} from '@material-ui/lab'\nimport {useGlobalMetainfo} from '../archive/metainfo'\nimport {useDataStore} from '../DataStore'\nimport {getSchemaInfo, getSectionsInfo} from './SectionSelectDialog'\nimport {ListItemText} from '@material-ui/core'\nimport {useSuggestions} from \"../../hooks\"\nimport {useErrors} from \"../errors\"\nimport {debounce} from 'lodash'\nimport {defaultFilterData} from '../search/FilterRegistry'\n\nconst getOptionSelected = (option, value) => {\n  return value ? option.entry_id === value.entry_id && option.value === value.value : false\n}\n\nconst suggestionQuantities = [{'name': 'entry_name', 'size': 10}, {'name': 'mainfile', 'size': 10}]\nconst quantitiesAllSet = new Set(['entry_name', 'mainfile'])\n\nconst entryFilterOptions = (option) => {\n    return `${option.mainfile}|${option.entry_name}|${option.upload_name || option.upload_id}|${option.entry_id}|${option.shownValue}`\n}\n\nconst pathFilterOptions = (option) => {\n  return `${option.mainfile}#${option.value}|${option.mainfile}#/${option.value}|${option.mainfile}#${option.label}`\n}\n\nconst filterOptions = (options, state) => {\n  const inputValue = state?.inputValue\n  if (inputValue) {\n    const parts = inputValue.split(\"#\")\n    const entryName = parts?.[0] || ''\n    const path = parts?.[1] || ''\n    const shownEntries = []\n    return options?.filter(option => {\n      if (option.menuType === 'entry') {\n        const found = entryFilterOptions(option).match(new RegExp(entryName.toLowerCase(), \"gi\"))\n        if (option?.entry_id && found) {\n          shownEntries.push(option.entry_id)\n        }\n        return found\n      } else {\n        if (option?.entry_id && shownEntries.includes(option.entry_id)) {\n          return pathFilterOptions(option).match(new RegExp(path.toLowerCase(), \"gi\"))\n        } else {\n          return false\n        }\n      }\n    })\n  } else {\n    return []\n  }\n}\n\nfunction SectionSelectAutocomplete(props) {\n  const {renderInput, onValueChanged, value, showSectionLabel, filtersLocked, onError} = props\n  const {api} = useApi()\n  const {raiseError} = useErrors()\n  const globalMetainfo = useGlobalMetainfo()\n  const dataStore = useDataStore()\n  const [suggestionInput, setSuggestionInput] = useState('')\n  const [entries, setEntries] = useState([])\n  const [selectedEntry, setSelectedEntry] = useState(undefined)\n  const [suggestions] = useSuggestions(suggestionQuantities, quantitiesAllSet, suggestionInput, defaultFilterData)\n  const [inputValue, setInputValue] = useState({primary: '', secondary: ''})\n  const [lastInputValue, setLastInputValue] = useState({primary: '', secondary: ''})\n  const [options, setOptions] = useState([])\n  const [internalError, setInternalError] = useState('')\n  const [showPrimary, setShowPrimary] = useState(!showSectionLabel)\n\n  useEffect(() => {\n    setInternalError('')\n    const entryNames = suggestions.filter(suggestion => suggestion.category === 'entry_name').map(suggestion => suggestion.value)\n    const mainfiles = suggestions.filter(suggestion => suggestion.category === 'mainfile').map(suggestion => suggestion.value)\n    const queries = []\n    if (entryNames?.length > 0) {\n      queries.push({'entry_name:any': entryNames})\n    }\n    if (mainfiles?.length > 0) {\n      queries.push({'mainfile:any': mainfiles})\n    }\n    if (value?.entry_id) {\n      queries.push({'entry_id': value.entry_id})\n    }\n    if (queries.length === 0) return\n    const requestBody = {\n      owner: 'visible',\n      exclude: ['quantities', 'sections', 'files'],\n      query: {\n        and: [\n          filtersLocked,\n          {or: queries}\n        ]\n      }\n    }\n    api.post(`entries/query`, requestBody).then(response => {\n      const data = response?.data?.map(entry => {\n        return {\n          upload_id: entry.upload_id,\n          upload_name: entry.upload_name,\n          entry_id: entry.entry_id,\n          mainfile: entry.mainfile,\n          entry_name: entry.entry_name,\n          shownValue: '',\n          menuType: 'entry'}\n      })\n      let notFoundEntries = new Set()\n      entryNames.forEach(entryName => {\n        if (!data.map(entry => entry.entry_name).includes(entryName)) {\n          notFoundEntries.add(entryName)\n        }\n      })\n      mainfiles.forEach(mainfile => {\n        if (!data.map(entry => entry.mainfile).includes(mainfile)) {\n          notFoundEntries.add(mainfile)\n        }\n      })\n      data?.sort((a, b) => (a.entry_name || a.mainfile) >= (b.entry_name || b.mainfile) ? 1 : -1)\n      notFoundEntries = [...notFoundEntries].sort((a, b) => a >= b ? 1 : -1)\n      setEntries(data.concat(notFoundEntries.map(entryName => {\n        return {mainfile: entryName, entry_name: entryName, menuType: 'entry'}\n      })))\n    }).catch(error => {\n      raiseError(error)\n    })\n  }, [api, filtersLocked, raiseError, suggestions, value])\n\n  const handleInputValueChange = useCallback((value) => {\n    setSuggestionInput(value.toLowerCase())\n  }, [])\n\n  const debouncedHandleInputChange = useMemo(() => {\n    return debounce(handleInputValueChange, 700)\n  }, [handleInputValueChange])\n\n  const handleInputChange = useCallback((event, value) => {\n    if (event?.type === 'change') {\n      setInputValue({primary: value, secondary: value})\n      debouncedHandleInputChange(value)\n    }\n  }, [debouncedHandleInputChange])\n\n  useEffect(() => {\n    const newOptions = []\n    entries.forEach(entry => {\n      newOptions.push(entry)\n      if (selectedEntry && entry.entry_id === selectedEntry.entryId) {\n        selectedEntry.sections.forEach(section => {\n          newOptions.push(section)\n        })\n      }\n    })\n    if (options.length !== newOptions.length || !options.every((option, index) => option === newOptions[index])) {\n      setOptions(newOptions)\n    }\n  }, [entries, options, selectedEntry])\n\n  const handleChange = useCallback((_, value) => {\n    setInputValue({primary: value?.fullPath, secondary: value?.shownValue})\n    setLastInputValue({primary: value?.fullPath, secondary: value?.shownValue})\n    onValueChanged(value)\n  }, [onValueChanged])\n\n  const setSection = useCallback((sections, value, updateInputValue) => {\n    setSelectedEntry({entryId: value.entry_id, sections: sections})\n    if (updateInputValue) {\n      setInputValue({primary: `${value.mainfile}#`, secondary: `${value.mainfile}#`})\n    } else {\n      const section = sections?.find(section => section.value === value?.value)\n      if (!section) {\n        onError('The provided path does not exist')\n        const path = value?.archive?.mainfile ? (value?.value && value.value !== '/data' && value.value !== 'data' ? `${value.archive.mainfile}#${value?.value}` : value.archive.mainfile) : ''\n        setInputValue({primary: path, secondary: path})\n        setLastInputValue({primary: path, secondary: path})\n      } else {\n        setInputValue({primary: section?.fullPath, secondary: section?.shownValue})\n        setLastInputValue({primary: section?.fullPath, secondary: section?.shownValue})\n      }\n    }\n  }, [onError])\n\n  const loadSections = useCallback((value, updateInputValue = false) => {\n    if (filtersLocked['section_defs.definition_qualified_name']?.includes('nomad.metainfo.metainfo.Definition')) {\n      getSchemaInfo(globalMetainfo, value.entry_id)\n        .then(sections => setSection(sections, value, updateInputValue))\n    } else {\n      getSectionsInfo(api, dataStore, filtersLocked['section_defs.definition_qualified_name'], value?.entry_id)\n        .then(sections => setSection(sections, value, updateInputValue))\n    }\n  }, [api, dataStore, filtersLocked, globalMetainfo, setSection])\n\n  useEffect(() => {\n    if (!internalError) {\n      if (value?.entry_id && value?.value) {\n        loadSections(value)\n      } else {\n        setInputValue({primary: '', secondary: ''})\n        setLastInputValue({primary: '', secondary: ''})\n      }\n    }\n  }, [internalError, loadSections, onError, value])\n\n  const handleEntryClicked = useCallback((event, option) => {\n    event.stopPropagation()\n    if (selectedEntry !== undefined && option.entry_id === selectedEntry.entryId) {\n      setSelectedEntry(undefined)\n    } else {\n      loadSections(option, true)\n    }\n  }, [loadSections, selectedEntry])\n\n  const handleBlur = useCallback((event) => {\n    if (showSectionLabel) {\n      setShowPrimary(false)\n    }\n    setInputValue(lastInputValue)\n  }, [lastInputValue, showSectionLabel])\n\n  if (options === undefined) {\n    return null\n  }\n\n  const renderOption = (option, props) => {\n    if (option.menuType === 'entry') {\n      if (option?.entry_id) {\n        return <ListItemText\n          key={option.entry_id}\n          primary={option?.entry_name || option.mainfile}\n          secondary={option?.upload_name ? `upload name: ${option.upload_name}` : `upload id: ${option.upload_id}`}\n          onClick={(event) => handleEntryClicked(event, option)}\n          data-testid={'section-select-entry-activated'}/>\n      } else {\n        return <ListItemText\n          key={option?.entry_name || option.mainfile}\n          secondary={option?.entry_name || option.mainfile}\n          onClick={(event) => event.stopPropagation()}\n          data-testid={'section-select-entry-deactivate'}/>\n      }\n    } else {\n      return <ListItemText\n        key={`${option?.entry_id}:${option?.value}`}\n        inset={true}\n        primary={option?.label}\n        data-testid={'section-select-path'}/>\n    }\n  }\n\n  return <Autocomplete\n      value={value || null}\n      getOptionSelected={getOptionSelected}\n      options={options}\n      onInputChange={handleInputChange}\n      onChange={handleChange}\n      onFocus={(event) => setShowPrimary(true)}\n      onBlur={handleBlur}\n      getOptionLabel={(option) => option.shownValue || ''}\n      filterOptions={filterOptions}\n      renderInput={renderInput}\n      renderOption={renderOption}\n      inputValue={(showPrimary ? inputValue.primary : inputValue.secondary) || ''}\n      freeSolo\n  />\n}\nSectionSelectAutocomplete.propTypes = {\n  // The standard autocomplete renderInput\n  renderInput: PropTypes.func,\n  // The event when the selected section is changed\n  onValueChanged: PropTypes.func,\n  // The default selected section\n  value: PropTypes.object,\n  // True if the section label should be shown when the focus is lost\n  showSectionLabel: PropTypes.bool,\n  // Determines the fixed search filters to find the corresponding references or the desired sections.\n  filtersLocked: PropTypes.object,\n  // Fires and passes the error message when an error occurs during fetching the data or resolving the value\n  onError: PropTypes.func\n}\n\nexport default SectionSelectAutocomplete\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useCallback, useContext, useEffect, useMemo, useState} from 'react'\nimport PropTypes from 'prop-types'\nimport { useApi } from '../api'\nimport { useErrors } from '../errors'\nimport {\n  Box, Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  IconButton, makeStyles,\n  TextField,\n  Tooltip\n} from '@material-ui/core'\nimport { useEntryStore } from '../entry/EntryContext'\nimport {ItemButton, useLane} from '../archive/Browser'\nimport { getFieldProps } from './StringEditQuantity'\nimport { refType, resolveNomadUrl, getDisplayLabel } from '../../utils'\nimport AddIcon from '@material-ui/icons/AddCircle'\nimport { getUrlFromDefinition, QuantityMDef } from '../archive/metainfo'\nimport EditIcon from '@material-ui/icons/Edit'\nimport SectionSelectDialog from '../uploads/SectionSelectDialog'\nimport DialogContentText from '@material-ui/core/DialogContentText'\nimport AutoComplete from '@material-ui/lab/Autocomplete'\nimport {useDataStore} from '../DataStore'\nimport SectionSelectAutocomplete from '../uploads/SectionSelectAutocomplete'\nimport {Link} from \"react-router-dom\"\nimport DetailsIcon from '@material-ui/icons/ArrowForward'\nimport OverwriteExistingFileDialog from './OverwriteExistingFileDialog'\nimport {useRecoilValue} from \"recoil\"\nimport {configState} from \"../archive/ArchiveBrowser\"\n\nconst referenceEditQuantityContext = React.createContext(undefined)\n\nfunction useReferenceEditQuantityContext() {\n  return useContext(referenceEditQuantityContext)\n}\n\nconst useStyles = makeStyles(theme => ({\n  dialog: {\n    width: '100%',\n    minWidth: 400\n  }\n}))\n\nfunction useReferecedSectionDef(quantityDef) {\n  return useMemo(() => {\n    const referencedDefinition = quantityDef.type._referencedDefinition\n    return referencedDefinition.m_def === QuantityMDef ? referencedDefinition._section : referencedDefinition\n  }, [quantityDef])\n}\n\nconst CreateNewReferenceDialog = React.memo(({allEntryDataSections, open, onSuccess, onFailed, onCanceled}) => {\n  const classes = useStyles()\n  const {deploymentUrl, uploadId} = useEntryStore('*') || {}\n  const {user, api} = useApi()\n  const {raiseError} = useErrors()\n  const [value, setValue] = useState('')\n  const [suggestions, setSuggestions] = useState([])\n  const [selectedUpload, setSelectedUpload] = useState(null)\n  const [askForOverwrite, setAskForOverwrite] = useState(false)\n  const [selectedSection, setSelectedSection] = useState()\n\n  useEffect(() => {\n    setSelectedSection(allEntryDataSections?.[0])\n    const prepareUploads = async () => {\n      const response = await api.get(`/uploads?is_published=false&page_size=10000`)\n      const uploads = response.data.map(upload => {\n        const uploadName = uploadId === upload.upload_id\n          ? (upload.upload_name ? `${upload.upload_name} (This upload)` : 'This upload')\n          : (upload.upload_name ? upload.upload_name : `upload-id: ${upload.upload_id}`)\n        if (user.sub === upload.main_author) {\n          return {label: uploadName, upload_id: upload.upload_id, main_author: upload.main_author, group: 'My uploads'}\n        } else {\n          return {label: uploadName, upload_id: upload.upload_id, main_author: upload.main_author}\n        }\n      })\n      const myUploads = uploads.filter(upload => upload.group !== undefined)\n      const othersUploads = uploads.filter(upload => upload.group === undefined)\n      if (othersUploads.length > 0) {\n        const authorsID = new Set(othersUploads.map(upload => upload.main_author))\n        const response = await api.get(`users?user_id=${Array.from(authorsID).join('&user_id=')}`)\n        const users = response['data']\n        const usersInfo = {}\n        users.forEach(user => (usersInfo[user.user_id] = {name: user.name, affiliation: user.affiliation}))\n        othersUploads.forEach(upload => {\n          upload['group'] = `Owned by ${(usersInfo[upload.main_author]?.affiliation ? `${usersInfo[upload.main_author]?.name} (${usersInfo[upload.main_author]?.affiliation})` : usersInfo[upload.main_author]?.name)}`\n        })\n        setSuggestions(myUploads.concat(othersUploads))\n      } else {\n        setSuggestions(uploads)\n      }\n    }\n    if (user?.sub && open) {\n      prepareUploads()\n    }\n  }, [api, raiseError, uploadId, user?.sub, open, allEntryDataSections])\n\n  const createNewEntry = useCallback((fileName, overwrite = false) => {\n    const archive = {\n      data: {\n        m_def: getUrlFromDefinition(selectedSection, {deploymentUrl, uploadId: selectedUpload.upload_id}, true)\n      }\n    }\n    return new Promise((resolve, reject) => {\n      api.put(`uploads/${selectedUpload.upload_id}/raw/?file_name=${fileName}.archive.json&wait_for_processing=true&overwrite_if_exists=${overwrite}`, archive)\n        .then(response => {\n          // TODO handle processing errors\n          if (response?.processing?.entry?.process_status !== 'SUCCESS') {\n            let error = 'Failed to create the reference.'\n            if (response?.processing?.entry?.errors) {\n              error = `${error} Details: ${response?.processing?.entry?.errors}`\n            }\n            reject(new Error(error))\n          } else {\n            resolve(response)\n          }\n        })\n        .catch(error => {\n          reject(error)\n        })\n    })\n  }, [selectedSection, deploymentUrl, selectedUpload?.upload_id, api])\n\n  const handleOverwrite = useCallback((data) => {\n    createNewEntry(data, true)\n      .then(response => {\n        onSuccess(response.processing)\n      })\n      .catch(error => {\n        onFailed(new Error(error))\n      })\n    setAskForOverwrite(false)\n  }, [createNewEntry, onFailed, onSuccess])\n\n  const handleCreateClick = useCallback(() => {\n    createNewEntry(value)\n      .then(response => {\n        onSuccess(response.processing)\n      })\n      .catch(error => {\n        if (error.apiMessage === \"The provided path already exists and overwrite_if_exists is set to False.\") {\n          setAskForOverwrite(true)\n        } else {\n          onFailed(new Error(error))\n        }\n      })\n  }, [createNewEntry, onFailed, onSuccess, value])\n\n  useEffect(() => {\n    if (suggestions.length > 0) {\n      const thisUpload = suggestions.find(upload => uploadId === upload.upload_id)\n      setSelectedUpload(thisUpload)\n    }\n  }, [suggestions, uploadId])\n\n  return <React.Fragment>\n    <Dialog classes={{paper: classes.dialog}} open={open} disableEscapeKeyDown data-testid='create-reference-dialog'>\n      <DialogTitle>{selectedSection?.name ? `Create new reference of type ${selectedSection.name}` : `Create new reference`}</DialogTitle>\n      <DialogContent>\n        <AutoComplete\n          options={suggestions}\n          style={{width: '100%', paddingBottom: 10}}\n          onChange={(event, value) => setSelectedUpload(value)}\n          value={selectedUpload}\n          getOptionSelected={(option, value) => option.upload_id === value.upload_id}\n          groupBy={(option) => option.group}\n          getOptionLabel={(option) => option.label}\n          renderInput={(params) => <TextField {...params} label=\"Target upload\" variant='filled' />}\n        />\n        {allEntryDataSections?.length > 1 ? <AutoComplete\n          options={allEntryDataSections}\n          style={{width: '100%', paddingBottom: 10}}\n          onChange={(event, value) => setSelectedSection(value)}\n          value={selectedSection}\n          getOptionSelected={(option, value) => option._qualifiedName === value._qualifiedName}\n          getOptionLabel={(option) => option.name}\n          renderInput={(params) => <TextField {...params} label=\"Inheriting classes\" variant='filled' />}\n        /> : ''}\n        <TextField\n          style={{width: '100%'}}\n          label={'Name'}\n          value={value}\n          variant='filled'\n          onChange={event => setValue(event.target.value)}\n          data-testid='new-reference-name'\n        />\n        <DialogContentText>\n          {value ? `File name: ${value}.archive.json` : ''}\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <span style={{flexGrow: 1}} />\n        <Button onClick={() => onCanceled()} color=\"secondary\">\n          Cancel\n        </Button>\n        <Button onClick={handleCreateClick} disabled={!value || !selectedUpload?.upload_id} color=\"secondary\">\n          Create\n        </Button>\n      </DialogActions>\n    </Dialog>\n    <OverwriteExistingFileDialog\n      open={askForOverwrite}\n      data={value}\n      onOverwrite={handleOverwrite}\n      onCancel={() => setAskForOverwrite(false)}\n    />\n  </React.Fragment>\n})\nCreateNewReferenceDialog.propTypes = {\n  allEntryDataSections: PropTypes.object.isRequired,\n  open: PropTypes.bool,\n  onSuccess: PropTypes.func,\n  onFailed: PropTypes.func,\n  onCanceled: PropTypes.func\n}\n\nexport const ItemLink = React.forwardRef(function ItemLink({itemKey, ...props}, ref) {\n  const reference = useReferenceEditQuantityContext()\n  const path = reference?.value\n  return <Link\n    {...props}\n    data-testid={`item:${itemKey}`}\n    to={`/user/uploads/upload/id/${reference?.archive?.upload_id}/entry/id/${reference?.archive?.entry_id}/data/${path}`}\n  />\n})\nItemLink.propTypes = {\n  itemKey: PropTypes.string.isRequired\n}\n\nconst ReferenceEditQuantity = React.memo(function ReferenceEditQuantity(props) {\n  const {url} = useEntryStore('*') || {}\n  const {quantityDef, value, onChange, index} = props\n  const [entry, setEntry] = useState(null)\n  const [open, setOpen] = useState(false)\n  const [createEntryDialogOpen, setCreateEntryDialogOpen] = useState(false)\n  const {user, api} = useApi()\n  const {raiseError} = useErrors()\n  const [error, setError] = useState({error: undefined, processingError: undefined})\n  const lane = useLane()\n  const dataStore = useDataStore()\n  const referencedSectionDef = useReferecedSectionDef(quantityDef)\n  const referencedSectionQualifiedName = useMemo(() => referencedSectionDef?._qualifiedName, [referencedSectionDef])\n\n  useEffect(() => {\n    if (!value || value === '') {\n      setError({error: null, processingError: null})\n      setEntry(null)\n      return\n    }\n    const resolveValue = async () => {\n      if (!url) {\n        return\n      }\n      const resolvedUrl = resolveNomadUrl(value, url)\n      if (resolvedUrl.type !== refType.archive && resolvedUrl.type !== refType.metainfo) {\n        throw new Error(`Expected archive or metainfo reference, got ${resolvedUrl.type} type for ${value}`)\n      }\n      let query = {\n        entry_id: resolvedUrl.entryId\n      }\n      if (resolvedUrl?.uploadId) {\n        query = {upload_id: resolvedUrl.uploadId, ...query}\n      }\n      const response = await api.post(`entries/archive/query`, {\n        owner: 'visible',\n        query: query,\n        'required': {\n          'metadata': {\n            'upload_id': '*',\n            'entry_id': '*',\n            'mainfile': '*',\n            'processing_errors': '*'\n          }\n        }\n      }, {\n        noLoading: true\n      })\n      const data = response.data\n      if (data.length > 0) {\n        const archive = data[0].archive.metadata\n        if (archive.processing_errors.length === 0) {\n          setEntry({value: value, archive: archive})\n          setError({error: null, processingError: null})\n        } else {\n          setEntry(null)\n          setError({error: null, processingError: 'There are some processing errors in the referenced value'})\n        }\n      } else {\n        setEntry(null)\n        setError({error: 'The referenced value does not exist anymore', processingError: null})\n      }\n    }\n    resolveValue()\n  }, [api, url, value])\n\n  const getReferencePath = useCallback((value) => {\n    if (value?.entry_id && value?.upload_id && value?.path) {\n      return `../uploads/${value.upload_id}/archive/${value.entry_id}#${value.path}`\n    } else if (value?.entry_id && value?.upload_id) {\n      return `../uploads/${value.upload_id}/archive/${value.entry_id}#data`\n    } else if (value?.entry_id) {\n      return `../upload/archive/${value.entry_id}#data`\n    } else {\n      return undefined\n    }\n  }, [])\n\n  const changeValue = useCallback((value) => {\n    if (onChange) {\n      onChange(value)\n    }\n  }, [onChange])\n\n  const handleValueChange = useCallback((value) => {\n    const referencePath = getReferencePath(value?.data)\n    changeValue(referencePath)\n    setOpen(false)\n  }, [changeValue, getReferencePath])\n\n  const itemKey = useMemo(() => {\n    if (!isNaN(index)) {\n      return `${quantityDef.name}:${index}`\n    } else {\n      return quantityDef.name\n    }\n  }, [quantityDef, index])\n\n  const {helpDescription, showSectionLabel, ...otherProps} = getFieldProps(quantityDef)\n  const config = useRecoilValue(configState)\n  const label = getDisplayLabel(quantityDef, true, config?.showMeta)\n\n  const handleSuccess = useCallback((value) => {\n    setCreateEntryDialogOpen(false)\n    const referencePath = getReferencePath({\n      entry_name: value.entry.mainfile,\n      upload_id: value.upload_id,\n      entry_id: value.entry_id\n    })\n    changeValue(referencePath)\n    setEntry({value: referencePath.split('#')[1], archive: value.entry})\n  }, [changeValue, getReferencePath])\n\n  const handleFailed = useCallback((error) => {\n    setCreateEntryDialogOpen(false)\n    raiseError(error)\n  }, [raiseError])\n\n  const handleCanceled = useCallback(() => {\n    setCreateEntryDialogOpen(false)\n  }, [])\n\n  const filtersLocked = useMemo(() => ({'section_defs.definition_qualified_name': [referencedSectionQualifiedName]}), [referencedSectionQualifiedName])\n\n  const addIconButtonToEndAdornment = useCallback((endAdornment, actions) => {\n    const children = React.Children.toArray(endAdornment.props.children)\n    actions.forEach(iconButton => {\n      children.push(iconButton)\n    })\n    return React.cloneElement(endAdornment, {}, children)\n  }, [])\n\n  const allEntryDataSections = useMemo(() => {\n    const inheritingSections = dataStore.getAllInheritingSections(referencedSectionDef)\n    const allSections = [referencedSectionDef].concat(inheritingSections)\n    return allSections.filter(section => !!section._allBaseSections.find(baseSection => baseSection._qualifiedName === 'nomad.datamodel.data.EntryData'))\n  }, [dataStore, referencedSectionDef])\n\n  const actions = useMemo(() => {\n    const actions = []\n    if (!value && allEntryDataSections?.length > 0) {\n      actions.push(<IconButton key={'createAction'} size={'small'} disabled={!user?.sub} onClick={() => setCreateEntryDialogOpen(true)}>\n        <Tooltip title=\"Create and assign a new reference\">\n          <AddIcon/>\n        </Tooltip>\n      </IconButton>)\n    }\n    actions.push(<IconButton key={'editAction'} size={'small'} onClick={() => setOpen(true)}>\n      <Tooltip title=\"Search for the references\">\n        <EditIcon/>\n      </Tooltip>\n    </IconButton>)\n    if (lane && value && !error.error) {\n      actions.push(\n        // TODO Disabled this button, because the browser does not correctly update after\n        // the navigation. This needs to be fixed first.\n        <Box display=\"none\">\n          <ItemButton\n            key={'navigateToReference'}\n            size=\"small\" itemKey={itemKey}\n            itemLink={ItemLink}\n            icon={<DetailsIcon/>}\n          />\n        </Box>\n      )\n      actions.push(<ItemButton key={'navigateAction'} size=\"small\" itemKey={itemKey}/>)\n    }\n    return actions\n  }, [value, lane, itemKey, user, error.error, allEntryDataSections])\n\n  const referencedValue = useMemo(() => {\n    const value = entry?.value?.split('#')[1] || ''\n    return entry ? {entry_id: entry?.archive?.entry_id, value: value.replace(/^(\\/*)(.*)/gi, '$2'), archive: entry?.archive} : null\n  }, [entry])\n\n  const handleError = useCallback((error) => {\n    setError(previousError => ({...previousError, error: error}))\n  }, [])\n\n  if (value && referencedValue === undefined) {\n    return null\n  }\n\n  return <referenceEditQuantityContext.Provider value={referencedValue}>\n    <Box display=\"flex\" flexDirection=\"row\" alignItems=\"center\" >\n      <Box flexGrow={1}>\n        <SectionSelectAutocomplete\n          onValueChanged={handleValueChange}\n          value={referencedValue}\n          filtersLocked={filtersLocked}\n          onError={handleError}\n          showSectionLabel={showSectionLabel}\n          renderInput={(params) => {\n            return (\n              <TextField\n                {...params}\n                variant=\"filled\"\n                error={!!(error.error || error.processingError)}\n                helperText={error.error || error.processingError}\n                InputProps={{\n                  ...params.InputProps,\n                  endAdornment: addIconButtonToEndAdornment(params.InputProps.endAdornment, actions)\n                }}\n                {...otherProps}\n                label={label}\n                placeholder={'search by entry name or file name'}\n                data-testid='reference-edit-quantity'\n              />\n            )\n          }}\n        />\n        <CreateNewReferenceDialog open={createEntryDialogOpen} allEntryDataSections={allEntryDataSections} onSuccess={handleSuccess} onFailed={handleFailed} onCanceled={handleCanceled}/>\n      </Box>\n      <SectionSelectDialog\n        open={open}\n        onCancel={() => setOpen(false)}\n        onSelectedChanged={handleValueChange}\n        selected={entry && {entry_id: entry?.archive?.entry_id, value: entry?.value?.split('#')[1]}}\n        filtersLocked={filtersLocked}\n      />\n    </Box>\n  </referenceEditQuantityContext.Provider>\n})\nReferenceEditQuantity.propTypes = {\n  quantityDef: PropTypes.object.isRequired,\n  value: PropTypes.string,\n  onChange: PropTypes.func,\n  index: PropTypes.number // additional index used for navigation of higher shaped references\n}\n\nexport default ReferenceEditQuantity\n","import {\n  CircularProgress,\n  Dialog,\n  DialogContent,\n  DialogTitle, TextField, makeStyles\n} from '@material-ui/core'\nimport Button from '@material-ui/core/Button'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContentText from '@material-ui/core/DialogContentText'\nimport React, { useCallback, useState } from 'react'\nimport { useApi } from '../api'\n\nexport const useInviteUserDialogStyles = makeStyles(theme => ({\n  button: {\n    marginLeft: theme.spacing(1)\n  },\n  dialog: {\n    width: '100%'\n  },\n  submitWrapper: {\n    margin: theme.spacing(1),\n    position: 'relative'\n  },\n  submitProgress: {\n    position: 'absolute',\n    top: '50%',\n    left: '50%',\n    marginTop: -12,\n    marginLeft: -12\n  }\n}))\n\nexport const InviteUserDialog = React.memo(function InviteUserDialog(props) {\n  const classes = useInviteUserDialogStyles()\n  const [open, setOpen] = useState(false)\n  const [submitting, setSubmitting] = useState(false)\n  const [canSubmit, setCanSubmit] = useState(false)\n  const [error, setError] = useState(null)\n  const [data, setData] = useState({\n    first_name: '',\n    last_name: '',\n    email: '',\n    affiliation: ''\n  })\n  const { api } = useApi()\n\n  const handleClose = useCallback((event, reason) => {\n    if (reason !== 'backdropClick') {\n      setOpen(false)\n    }\n  }, [setOpen])\n\n  const handleSubmit = useCallback(() => {\n    setSubmitting(true)\n\n    api.inviteUser(data).then(() => {\n      setSubmitting(false)\n      setOpen(false)\n    }).catch(error => {\n      let message = '' + error\n      try {\n        message = JSON.parse(error.request.responseText).detail || '' + error\n      } catch (e) { }\n      setError(message)\n      setSubmitting(false)\n      setCanSubmit(false)\n    })\n  }, [data, setSubmitting, setOpen, setError, api])\n\n  const handleChange = useCallback((key, value) => {\n    const valid = value && !Object.keys(data).find(dataKey => !(key === dataKey || data[dataKey]))\n    setData({ ...data, [key]: value })\n    setCanSubmit(valid)\n  }, [setData, data, setCanSubmit])\n\n  const handleOpen = useCallback(() => {\n    setOpen(true)\n  }, [setOpen])\n\n  const input = (key, label) => <TextField\n    variant=\"filled\"\n    label={label}\n    value={data[key]}\n    onChange={event => handleChange(key, event.target.value)}\n    margin=\"normal\"\n    fullWidth />\n  return <React.Fragment>\n    <Button className={classes.button}\n      onClick={handleOpen}\n      color=\"secondary\" disabled={submitting}\n    >\n      Invite new user\n    </Button>\n    <Dialog\n      classes={{ paper: classes.dialog }}\n      open={open}\n      onClose={handleClose} disableEscapeKeyDown>\n      <DialogTitle>Invite a new user to NOMAD</DialogTitle>\n      <DialogContent>\n        <DialogContentText>\n          If you want to add a user as co-author or share your data with someone that\n          is not already a NOMAD user, you can invite this person here. We need just a few\n          details about this person. After your invite, the new user will receive an\n          Email that allows her to set a password and further details. Anyhow, you will\n          be able to add the user as co-author or someone to share with immediately after the\n          invite.\n        </DialogContentText>\n        {error && <DialogContentText color=\"error\">\n          {error}\n        </DialogContentText>}\n        {input('email', 'Email')}\n        {input('first_name', 'First name')}\n        {input('last_name', 'Last name')}\n        {input('affiliation', 'Affiliation')}\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={handleClose} disabled={submitting}>\n          Cancel\n        </Button>\n        <div className={classes.submitWrapper}>\n          <Button onClick={handleSubmit} color=\"primary\" disabled={!canSubmit}>\n            Submit\n          </Button>\n          {submitting && <CircularProgress size={24} className={classes.submitProgress} />}\n        </div>\n      </DialogActions>\n    </Dialog>\n  </React.Fragment>\n})\nInviteUserDialog.propTypes = {}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  Box,\n  Dialog,\n  DialogContent,\n  DialogTitle,\n  Divider,\n  FormControl,\n  IconButton,\n  InputLabel,\n  MenuItem, Select,\n  TextField,\n  Tooltip,\n  Typography,\n  makeStyles\n} from '@material-ui/core'\nimport Button from '@material-ui/core/Button'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContentText from '@material-ui/core/DialogContentText'\nimport DeleteIcon from '@material-ui/icons/Delete'\nimport AutoComplete from '@material-ui/lab/Autocomplete'\nimport { debounce } from 'lodash'\nimport PropTypes from 'prop-types'\nimport React, { useCallback, useContext, useEffect, useMemo, useReducer, useState } from 'react'\nimport { useApi } from '../api'\nimport { Datatable, DatatableTable } from '../datatable/Datatable'\nimport { useErrors } from '../errors'\nimport { InviteUserDialog } from './InviteUserDialog'\nimport { useUploadPageContext } from './UploadPageContext'\n\nexport const editMembersDialogContext = React.createContext()\n\nconst useStyles = makeStyles(theme => ({\n  dialog: {\n    width: '100%'\n  }\n}))\n\nfunction MembersTable() {\n  const {members, setIsChanged} = useContext(editMembersDialogContext)\n  const forceUpdate = useReducer(bool => !bool)[1]\n\n  const columns = [\n    {key: 'Name', align: 'left', render: member => member.name},\n    {key: 'Affiliation', align: 'left', render: member => member.affiliation},\n    {\n      key: 'Role',\n      align: 'left',\n      render: member => (member.role === 'Main author' ? member.role\n        : <Select value={member.role}\n          onChange={(event) => {\n            member.role = event.target.value\n            setIsChanged(true)\n            forceUpdate()\n          }}\n        >\n          <MenuItem value={'Co-author'}>Co-author</MenuItem>\n          <MenuItem value={'Reviewer'}>Reviewer</MenuItem>\n        </Select>)\n    }\n  ]\n\n  return <Datatable columns={columns} data={members}>\n    <DatatableTable actions={DeleteAction} />\n  </Datatable>\n}\n\nexport const fetchUsers = (api, previousQuery, newQuery) => {\n  return new Promise((resolve, reject) => {\n    api.getUsers({prefix: newQuery})\n      .then(users => {\n        const withQueryInName = users.filter(user => user.name.toLowerCase().indexOf(newQuery) !== -1)\n        withQueryInName.sort((a, b) => {\n          const aValue = a.name.toLowerCase()\n          const bValue = b.name.toLowerCase()\n          if (aValue.startsWith(newQuery)) {\n            return -1\n          } else if (bValue.startsWith(newQuery)) {\n            return 1\n          } else {\n            return 0\n          }\n        })\n        resolve(withQueryInName.slice(0, 5))\n      })\n      .catch(err => {\n        reject(err)\n      })\n  })\n}\n\nfunction AddMember({...props}) {\n  const {api, raiseError} = props\n  const [role, setRole] = useState('Co-author')\n  const [suggestions, setSuggestions] = useState([])\n  const [newMember, setNewMember] = useState([])\n  const {members, setMembers, setIsChanged} = useContext(editMembersDialogContext)\n  const [isDuplicated, setIsDuplicated] = useState(false)\n  const [isValid, setIsValid] = useState(false)\n  const [query, setQuery] = useState('')\n\n  const handleInputChange = useCallback((event, value) => {\n    const newQuery = value.toLowerCase()\n    if (!(newQuery.startsWith(query) && suggestions.length === 0) || query === '') {\n      fetchUsers(api, query, newQuery)\n        .then(setSuggestions)\n        .catch(err => {\n          setSuggestions([])\n          raiseError(err)\n        })\n    }\n    setQuery(newQuery)\n  }, [api, query, raiseError, suggestions.length])\n\n  const debouncedHandleInputChange = useMemo(() => (\n    debounce(handleInputChange, 700)\n  ), [handleInputChange])\n\n  const handleChange = useCallback((event, value) => {\n    if (value && value?.user_id) {\n      setNewMember(value)\n      setIsValid(true)\n      setIsDuplicated(members.map(member => member.user_id).includes(value.user_id))\n    } else {\n      setIsValid(false)\n    }\n  }, [members])\n\n  const handleAdd = useCallback(() => {\n    if (role) {\n      if (!members.map(member => member.user_id).includes(newMember.user_id)) {\n        newMember['role'] = role\n        setMembers(members => [...members, newMember])\n        setIsChanged(true)\n      } else {\n        setIsDuplicated(true)\n      }\n    }\n  }, [members, newMember, role, setIsChanged, setMembers])\n\n  return <React.Fragment>\n    <AutoComplete\n      style={{width: '100%'}}\n      options={suggestions}\n      getOptionLabel={option => (option.affiliation ? `${option.name} (${option.affiliation})` : option.name)}\n      getOptionSelected={(option, value) => value ? option.user_id === value.user_id : false}\n      onInputChange={debouncedHandleInputChange}\n      onChange={handleChange}\n      renderInput={params => (\n        <TextField\n          {...params}\n          variant='filled'\n          size='small'\n          label='Search the name and select a user from the list'\n          placeholder=\"Member's name\"\n          margin='normal'\n          fullWidth\n        />\n      )}\n    />\n    <Box marginLeft={2}>\n      <Typography hidden={!isDuplicated} color=\"error\">\n        The selected user is already in the members list\n      </Typography>\n    </Box>\n    <FormControl variant='filled' size='small' fullWidth>\n      <InputLabel htmlFor='role'>Select the member&apos;s role</InputLabel>\n      <Select\n        native\n        onChange={(event) => setRole(event.target.value)}\n        inputProps={{\n          name: 'role',\n          id: 'role'\n        }}\n      >\n        <option value={'Co-author'}>Co-author</option>\n        <option value={'Reviewer'}>Reviewer</option>\n      </Select>\n    </FormControl>\n    <Box display=\"flex\" justifyContent=\"end\" paddingY={1}>\n      <Button onClick={handleAdd} color=\"primary\" variant=\"contained\" disabled={isDuplicated || !isValid}>\n        Add\n      </Button>\n    </Box>\n  </React.Fragment>\n}\nAddMember.propTypes = {\n  api: PropTypes.object.isRequired,\n  raiseError: PropTypes.func.isRequired\n}\n\nconst DeleteAction = React.memo((props) => {\n  const {data} = props\n  const {members, setMembers, setIsChanged} = useContext(editMembersDialogContext)\n\n  const handleRemove = () => {\n    const filteredMembers = members.filter(member => !(member.user_id === data.user_id))\n    setMembers(filteredMembers)\n    setIsChanged(true)\n  }\n\n  const isOwner = data.role === 'Main author'\n\n  return <IconButton disabled={isOwner} onClick={handleRemove} data-testid='member-delete-button'>\n    <Tooltip title=\"Remove the member\">\n      <DeleteIcon />\n    </Tooltip>\n  </IconButton>\n})\nDeleteAction.propTypes = {\n  data: PropTypes.object.isRequired\n}\n\nconst EditMembersDialog = ({open, setOpen}) => {\n  const classes = useStyles()\n  const {api} = useApi()\n  const {raiseError} = useErrors()\n  const {uploadId, upload, updateUpload} = useUploadPageContext()\n  const [members, setMembers] = useState([])\n  const [isChanged, setIsChanged] = useState(false)\n  const [openConfirmDialog, setOpenConfirmDialog] = useState(false)\n\n  const getUsers = useCallback((user_ids, roles) => {\n    return new Promise((resolve, reject) => {\n      api.get(`users?user_id=${user_ids.join('&user_id=')}`)\n        .then(response => {\n          const members = response['data'].map((member, index) => {\n            member.role = roles[index]\n            return member\n          })\n          resolve(members)\n        })\n        .catch(error => reject(new Error('Unable to fetch the members' + error)))\n      })\n  }, [api])\n\n  const fetchMembers = useCallback(() => {\n    const user_ids = [upload.main_author].concat(upload.coauthors, upload.reviewers)\n    const roles = ['Main author'].concat(upload.coauthors.map(_ => 'Co-author'), upload.reviewers.map(_ => 'Reviewer'))\n    return getUsers(user_ids, roles)\n  }, [getUsers, upload])\n\n  useEffect(() => {\n    if (!open) {\n      return\n    }\n\n    setMembers([])\n    setIsChanged(false)\n    fetchMembers()\n      .then(setMembers)\n      .catch(raiseError)\n  }, [fetchMembers, open, raiseError])\n\n  const handleDiscardChanges = () => {\n    setOpenConfirmDialog(false)\n    setOpen(false)\n  }\n\n  const handleSubmitChanges = () => {\n    if (isChanged) {\n      const newCoauthors = members.filter(member => member.role === 'Co-author').map(member => member.user_id)\n      const newReviewers = members.filter(member => member.role === 'Reviewer').map(member => member.user_id)\n      api.post(`/uploads/${uploadId}/edit`, {\n        'metadata': {\n          'coauthors': newCoauthors,\n          'reviewers': newReviewers\n        }\n      }).then(results => {\n        updateUpload({upload: results.data})\n        setOpen(false)\n      }).catch(err => raiseError(err))\n    } else {\n      setOpen(false)\n    }\n  }\n\n  const handleConfirm = () => {\n    if (isChanged) {\n      setOpenConfirmDialog(true)\n    } else {\n      setOpen(false)\n    }\n  }\n\n  const contextValue = useMemo(() => ({\n    members: members,\n    setMembers: setMembers,\n    isChanged: isChanged,\n    setIsChanged: setIsChanged\n  }), [members, setMembers, isChanged, setIsChanged])\n\n  return <editMembersDialogContext.Provider value={contextValue}>\n    <React.Fragment>\n      {open && <Dialog classes={{paper: classes.dialog}} open={open} disableEscapeKeyDown data-testid='edit-members-dialog'>\n        <DialogTitle>Edit upload members</DialogTitle>\n        <DialogContent>\n          <DialogContentText>\n            You can add and remove members for this upload and change their access. Reviewers can view the upload, co-authors can also edit it.\n          </DialogContentText>\n          <Divider />\n          <AddMember api={api} raiseError={raiseError} />\n          <MembersTable />\n        </DialogContent>\n        <DialogActions>\n          <InviteUserDialog />\n          <span style={{flexGrow: 1}} />\n          <Button onClick={handleConfirm} color=\"secondary\">\n            Cancel\n          </Button>\n          <Button onClick={handleSubmitChanges} disabled={!isChanged} color=\"secondary\">\n            Submit\n          </Button>\n        </DialogActions>\n        <Dialog\n          open={openConfirmDialog}\n          aria-describedby=\"alert-dialog-description\"\n        >\n          <DialogContent>\n            <DialogContentText id=\"alert-dialog-description\">\n              Your changes are not submitted yet. Discard changes?\n            </DialogContentText>\n          </DialogContent>\n          <DialogActions>\n            <Button onClick={() => setOpenConfirmDialog(false)} autoFocus>Cancel</Button>\n            <Button onClick={handleDiscardChanges}>Discard</Button>\n          </DialogActions>\n        </Dialog>\n      </Dialog>}\n    </React.Fragment>\n  </editMembersDialogContext.Provider>\n}\nEditMembersDialog.propTypes = {\n  open: PropTypes.bool.isRequired,\n  setOpen: PropTypes.func.isRequired\n}\n\nexport default EditMembersDialog\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useCallback, useEffect, useMemo, useState} from 'react'\nimport PropTypes from 'prop-types'\nimport {getFieldProps, TextFieldWithHelp} from './StringEditQuantity'\nimport {Box, CircularProgress, FormLabel, InputAdornment, makeStyles, Typography} from '@material-ui/core'\nimport AutoComplete from '@material-ui/lab/Autocomplete'\nimport {debounce} from 'lodash'\nimport {fetchUsers} from '../uploads/EditMembersDialog'\nimport {useApi} from '../api'\nimport {useErrors} from '../errors'\nimport {getDisplayLabel} from \"../../utils\"\nimport {useRecoilValue} from \"recoil\"\nimport {configState} from \"../archive/ArchiveBrowser\"\n\nconst useStyles = makeStyles(theme => ({\n  label: {\n    marginLeft: theme.spacing(1)\n  },\n  fields: {\n    width: '100%',\n    marginTop: theme.spacing(1)\n  }\n}))\n\nexport const AuthorEditQuantity = React.memo((props) => {\n  const {quantityDef, onChange, ...otherProps} = props\n  const {helpDescription, ...otherFieldProps} = otherProps\n  const classes = useStyles()\n  const {api} = useApi()\n  const {raiseError} = useErrors()\n  const [author, setAuthor] = useState(undefined)\n  const [user, setUser] = useState(undefined)\n  const [email, setEmail] = useState(otherProps?.value?.email)\n  const [query, setQuery] = useState('')\n  const [suggestions, setSuggestions] = useState([])\n  const [searching, setSearching] = useState(false)\n  const userOnly = useMemo(() => quantityDef.type?.type_kind === 'User', [quantityDef])\n  const config = useRecoilValue(configState)\n  const label = getDisplayLabel(quantityDef, true, config?.showMeta)\n\n  const searchUsers = useCallback((value) => {\n    const newQuery = value.toLowerCase()\n    if (!(newQuery.startsWith(query) && suggestions.length === 0) || query === '') {\n      fetchUsers(api, query, newQuery)\n        .then(setSuggestions)\n        .catch(err => {\n          raiseError(err)\n          setSuggestions([])\n        })\n    }\n    setQuery(newQuery)\n    setSearching(false)\n  }, [api, raiseError, query, suggestions])\n\n  const handleChange = useCallback((key, value) => {\n    if (onChange) {\n      let newValue = {...author}\n      if (key === 'user') {\n        setSuggestions(value ? [value] : [])\n        if (value) {\n          newValue['user_id'] = value?.user_id\n          newValue['first_name'] = value?.first_name\n          newValue['last_name'] = value?.last_name\n          newValue['affiliation'] = value?.affiliation\n          newValue['affiliation_address'] = value?.affiliation_address\n          delete newValue['email']\n          setEmail(undefined)\n          setAuthor(newValue)\n        } else {\n          newValue = undefined\n        }\n      } else {\n        if (value) {\n          newValue[key] = value\n        } else {\n          delete newValue[key]\n        }\n      }\n      onChange(newValue && Object.keys(newValue).length !== 0 ? newValue : undefined)\n    }\n  }, [author, onChange])\n\n  useEffect(() => {\n    const initUser = async (user_id) => {\n      if (user_id) {\n        const users = await api.getUsers({user_id: user_id})\n        if (users.length > 0) {\n          setSuggestions(users)\n          setUser(users[0])\n        } else {\n          setSuggestions([])\n          setUser(undefined)\n        }\n      } else {\n        setUser(undefined)\n        setSuggestions([])\n      }\n    }\n\n    initUser(otherFieldProps.value?.user_id)\n\n    if (typeof otherProps?.value === 'string' && otherProps.value.includes('@')) {\n      api.getUsers({email: otherProps.value})\n        .then(users => {\n          if (users.length > 0) {\n            handleChange('user', users[0])\n            setSuggestions([users[0]])\n          } else {\n            setSuggestions([])\n          }\n        })\n    } else {\n      setAuthor(otherProps?.value)\n    }\n  }, [api, handleChange, otherFieldProps.value, otherProps.value, quantityDef.default])\n\n  const isValidEmail = useCallback((value) => value ? value.match(/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/) : true, [])\n\n  const handleEmailChange = useCallback((value) => {\n    setEmail(value)\n    if (isValidEmail(value)) {\n      handleChange('email', value)\n    }\n  }, [handleChange, isValidEmail])\n\n  const debouncedSearchUsers = useMemo(() => debounce(searchUsers, 700), [searchUsers])\n\n  const handleUserInputChange = useCallback((event, value) => {\n    if (!(event && event.type && event.type === 'change')) {\n      return\n    }\n    setSearching(true)\n    debouncedSearchUsers(value)\n  }, [debouncedSearchUsers])\n\n  const userField = (\n    <AutoComplete\n      options={suggestions}\n      getOptionLabel={option => option ? (option.affiliation ? `${option.name} (${option.affiliation})` : option.name) : ''}\n      getOptionSelected={(option, value) => suggestions && value && value.user_id && option.user_id === value.user_id}\n      onInputChange={handleUserInputChange}\n      onChange={(event, value) => handleChange('user', value)}\n      value={user && suggestions.some(option => option.user_id === user.user_id) ? user : null}\n      renderInput={params => (\n        <TextFieldWithHelp\n          className={classes.fields}\n          {...params}\n          InputProps={(searching ? {\n            endAdornment: (searching && <InputAdornment position=\"end\">\n              <CircularProgress color=\"inherit\" size={20} />\n            </InputAdornment>)\n          } : params.InputProps)}\n          variant='filled'\n          size='small'\n          placeholder=\"Search member's name\"\n          margin='normal'\n          fullWidth\n          {...getFieldProps(quantityDef)}\n          label={(userOnly ? label : 'User account')}\n        />\n      )}\n      data-testid='user-edit-quantity'\n    />\n  )\n\n  return <React.Fragment>\n    {userOnly ? userField : (\n      <Box marginTop={2} marginBottom={2}>\n        <FormLabel component=\"legend\">\n          {label}\n        </FormLabel>\n        {userField}\n        <Typography className={classes.label} variant={'caption'}>\n          {'Or provide author information'}\n        </Typography>\n        <TextFieldWithHelp\n          label={'First name'}\n          variant='filled'\n          size='small'\n          placeholder='First name'\n          inputProps={{readOnly: !!otherProps?.value?.user_id}}\n          value={otherProps?.value?.first_name}\n          onChange={event => handleChange('first_name', event.target.value)}\n          fullWidth\n        />\n        <TextFieldWithHelp\n          className={classes.fields}\n          label={'Last name'}\n          variant='filled'\n          size='small'\n          placeholder='Last name'\n          inputProps={{readOnly: !!otherProps?.value?.user_id}}\n          value={otherProps?.value?.last_name}\n          onChange={event => handleChange('last_name', event.target.value)}\n          fullWidth\n        />\n        <TextFieldWithHelp\n          className={classes.fields}\n          label={'Affiliation'}\n          variant='filled'\n          size='small'\n          placeholder='Affiliation'\n          inputProps={{readOnly: !!otherProps?.value?.user_id}}\n          value={otherProps?.value?.affiliation}\n          onChange={event => handleChange('affiliation', event.target.value)}\n          fullWidth\n        />\n        <TextFieldWithHelp\n          className={classes.fields}\n          label={'Email'}\n          variant='filled'\n          size='small'\n          placeholder=\"Email address\"\n          inputProps={{readOnly: !!otherProps?.value?.user_id}}\n          value={email}\n          onChange={event => handleEmailChange(event.target.value)}\n          error={!isValidEmail(email)}\n          helperText={!isValidEmail(email) && 'The email is not valid!'}\n          fullWidth\n        />\n        <TextFieldWithHelp\n          className={classes.fields}\n          label={'Address'}\n          variant='filled'\n          size='small'\n          placeholder='Affiliation address'\n          inputProps={{readOnly: !!otherProps?.value?.user_id}}\n          value={otherProps?.value?.affiliation_address}\n          onChange={event => handleChange('affiliation_address', event.target.value)}\n          fullWidth\n        />\n      </Box>\n    )}\n  </React.Fragment>\n})\nAuthorEditQuantity.propTypes = {\n  quantityDef: PropTypes.object.isRequired,\n  value: PropTypes.object,\n  onChange: PropTypes.func\n}\n\nexport default AuthorEditQuantity\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useCallback} from 'react'\nimport {\n  FormControlLabel,\n  FormControl,\n  FormLabel, RadioGroup, Radio\n} from '@material-ui/core'\nimport PropTypes from 'prop-types'\nimport {getFieldProps, WithHelp} from './StringEditQuantity'\nimport {getDisplayLabel} from \"../../utils\"\nimport {useRecoilValue} from \"recoil\"\nimport {configState} from \"../archive/ArchiveBrowser\"\n\nexport const RadioEnumEditQuantity = React.memo((props) => {\n  const {quantityDef, value, onChange, ...otherProps} = props\n  const fieldProps = getFieldProps(quantityDef)\n  const config = useRecoilValue(configState)\n  const label = getDisplayLabel(quantityDef, true, config?.showMeta)\n\n  const handleChange = useCallback((value) => {\n    if (onChange) {\n      onChange(value === '' ? undefined : value)\n    }\n  }, [onChange])\n\n  return (\n    <WithHelp {...fieldProps} label={label}>\n      <FormControl>\n        <FormLabel>{label}</FormLabel>\n        <RadioGroup row>\n          {quantityDef.type?.type_data.map(item => (\n            <FormControlLabel\n              value={item} key={item}\n              control={(\n                <Radio\n                  checked={value === item}\n                  onClick={() => handleChange(item)}\n                  {...otherProps}\n                />\n              )}\n              label={item}\n            />))}\n        </RadioGroup>\n      </FormControl>\n    </WithHelp>\n  )\n})\nRadioEnumEditQuantity.propTypes = {\n  quantityDef: PropTypes.object.isRequired,\n  value: PropTypes.string,\n  onChange: PropTypes.func\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useEffect, useRef, useState } from 'react'\nimport { makeStyles, alpha } from '@material-ui/core/styles'\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore'\nimport ExpandLessIcon from '@material-ui/icons/ExpandLess'\nimport { useResizeDetector } from 'react-resize-detector'\nimport { useWindowSize } from '../../hooks'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\n\n/**\n * Component for displaying a scrollable view.\n */\nconst useStyles = makeStyles(theme => {\n  const startColor = alpha(theme.palette.grey[100], 0.0)\n  const endColor = alpha(theme.palette.grey[300], 0.4)\n  return {\n    root: {\n      width: '100%',\n      height: '100%'\n    },\n    containerOuter: {\n      width: '100%',\n      height: '100%',\n      position: 'relative'\n    },\n    containerInner: {\n      width: '100%',\n      height: '100%',\n      overflowY: 'scroll',\n      boxSizing: 'border-box'\n    },\n    scrollHint: {\n      zIndex: 3,\n      position: 'absolute',\n      width: '100%',\n      height: '1.5rem',\n      background: alpha(theme.palette.background.default, 0.8),\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      pointerEvents: 'none'\n    },\n    scrollUp: {\n      background: `linear-gradient(0deg, ${endColor} 0%, ${startColor} 100%)`,\n      bottom: 0\n    },\n    scrollDown: {\n      borderTop: `1px solid ${theme.palette.grey[300]}`,\n      background: `linear-gradient(0deg, ${startColor} 0%, ${endColor} 100%)`,\n      top: 0\n    }\n  }\n})\nconst useScrollStyles = makeStyles((theme) => ({\n  scrollBar: {\n    overflowY: 'scroll',\n    '&::-webkit-scrollbar': {\n      display: 'none'\n    },\n    '-ms-overflow-style': 'none',\n    scrollbarWidth: 'none'\n  }\n}))\n\nconst Scrollable = React.memo(({\n  onBottom,\n  scrollBar,\n  hints,\n  footer,\n  className,\n  classes,\n  children,\n  'data-testid': testID\n}) => {\n  const refRoot = useRef()\n  const { height, ref } = useResizeDetector()\n  const { windowHeight } = useWindowSize()\n  const [isOverflowing, setIsOverflowing] = useState(false)\n  const [isTop, setIsTop] = useState(true)\n  const [isBottom, setIsBottom] = useState(false)\n  const styles = useStyles({classes: classes})\n  const scrollStyles = useScrollStyles({classes: {scrollBar: classes?.scrollBar}})\n\n  // When the height of children changes or the window size changes, redetermine\n  // whether to show scrollhints\n  useEffect(() => {\n    const element = refRoot?.current\n    if (element) {\n      const scrollHeight = element.scrollHeight - element.offsetHeight\n      const overflowing = scrollHeight > 0\n      setIsOverflowing(overflowing)\n    }\n  }, [height, windowHeight])\n\n  // Attach event listener for checking if scrolled to top or bottom\n  useEffect(() => {\n    const element = refRoot?.current\n\n    function updateScrollPosition() {\n      const scrollHeight = element.scrollHeight - element.offsetHeight\n      const bottom = Math.round(element.scrollTop) >= scrollHeight\n      const top = Math.round(element.scrollTop) <= 0\n      setIsTop(top || null)\n      setIsBottom(bottom || null)\n      if (bottom && onBottom) {\n        onBottom()\n      }\n    }\n\n    if (element) {\n      element.addEventListener('scroll', updateScrollPosition, false)\n      return function cleanup() {\n        element.removeEventListener('scroll', updateScrollPosition, false)\n      }\n    }\n  }, [onBottom])\n\n  return <div className={clsx(className, styles.root)} data-testid={testID}>\n    <div className={clsx(styles.containerOuter)}>\n      {(hints && isOverflowing && !isTop) && <div className={clsx(styles.scrollHint, styles.scrollDown)}>\n        <ExpandLessIcon color=\"action\"/>\n      </div>}\n      <div ref={refRoot} className={clsx(styles.containerInner, !scrollBar && scrollStyles.scrollBar)}>\n        <div ref={ref}>\n          {children}\n          {footer}\n        </div>\n      </div>\n      {(hints && isOverflowing && !isBottom) && <div className={clsx(styles.scrollHint, styles.scrollUp)}>\n        <ExpandMoreIcon color=\"action\"/>\n      </div>}\n    </div>\n  </div>\n})\n\nScrollable.propTypes = {\n  onBottom: PropTypes.func, // Callback that is fired when bottom reached\n  scrollBar: PropTypes.bool, // Whether to show native scrollbar\n  hints: PropTypes.bool, // Whether to show scroll hints\n  fixed: PropTypes.bool, // Whether to show scroll hints\n  footer: PropTypes.object, // A fixed component that is shown at the bottom\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  children: PropTypes.any,\n  'data-testid': PropTypes.string\n}\nScrollable.defaultProps = {\n  scrollBar: false,\n  hints: true\n}\n\nexport default Scrollable\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useCallback } from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport {\n  Checkbox,\n  MenuItem,\n  FormControlLabel\n} from '@material-ui/core'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\nimport { useSearchContext } from '../SearchContext'\n\n/**\n * Menu showing the Filter settings.\n */\nconst useStyles = makeStyles((theme) => {\n  return {\n    root: {\n    },\n    menuItem: {\n      width: '10rem'\n    },\n    systems: {\n      margin: theme.spacing(2),\n      marginTop: theme.spacing(1)\n    }\n  }\n})\nconst FilterSettings = React.memo(({\n  className,\n  classes,\n  'data-testid': testID\n}) => {\n  const styles = useStyles(classes)\n  const {\n    useIsStatisticsEnabled,\n    useSetIsStatisticsEnabled\n  } = useSearchContext()\n  const [isStatisticsEnabled, setIsStatisticsEnabled] = [useIsStatisticsEnabled(), useSetIsStatisticsEnabled()]\n\n  const handleStatsChange = useCallback((event, value) => {\n    setIsStatisticsEnabled(value)\n  }, [setIsStatisticsEnabled])\n\n  return <div className={clsx(styles.root, className)} data-testid={testID}>\n    <MenuItem>\n      <FormControlLabel\n        control={<Checkbox\n          checked={isStatisticsEnabled}\n          onChange={handleStatsChange}\n        />}\n        label=\"Show advanced statistics\"\n      />\n    </MenuItem>\n  </div>\n})\n\nFilterSettings.propTypes = {\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  'data-testid': PropTypes.string\n}\n\nexport default FilterSettings\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useState, useCallback, useContext, useEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\nimport {\n  List,\n  ListItem,\n  ListItemText,\n  ListItemIcon,\n  Divider,\n  Paper,\n  Menu,\n  Typography\n} from '@material-ui/core'\nimport ArrowForwardIcon from '@material-ui/icons/ArrowForward'\nimport ArrowBackIcon from '@material-ui/icons/ArrowBack'\nimport NavigateNextIcon from '@material-ui/icons/NavigateNext'\nimport MoreVert from '@material-ui/icons/MoreVert'\nimport Scrollable from '../../visualization/Scrollable'\nimport FilterSettings from './FilterSettings'\nimport { Actions, ActionHeader, Action } from '../../Actions'\nimport { useSearchContext } from '../SearchContext'\nimport { pluralize } from '../../../utils'\nimport { isNil } from 'lodash'\n\n// The menu animations use a transition on the 'transform' property. Notice that\n// animating 'transform' instead of e.g. the 'left' property is much more\n// performant. We also hint the browser that the transform property will be\n// animated using the 'will-change' property: this will pre-optimize the element\n// for animation when possible (the recommendation is to remove/add it when\n// needed, but in this case we keep it on constantly).\n//\n// The menu widths are hardcoded. We need the widths to perform the close\n// animation. Another option would be to use useLayoutEffect to determine the\n// sizes of the components dynamically, but this seems to be quite a bit less\n// responsive compared to hardcoding the values.\n\nexport const filterMenuContext = React.createContext()\nconst paddingHorizontal = 1.5\nexport const collapsedMenuWidth = 3.3\n\n// Topmost header for filter menus. Contains menu actions and an overline text\nconst useFilterMenuTopHeaderStyles = makeStyles(theme => {\n  return {\n    root: {\n      paddingTop: theme.spacing(1.2),\n      paddingRight: theme.spacing(paddingHorizontal),\n      paddingLeft: theme.spacing(paddingHorizontal)\n    },\n    title: {\n      display: 'flex',\n      alignItems: 'center',\n      fontSize: '0.75rem',\n      marginTop: -3,\n      marginBottom: -3\n    }\n  }\n})\nexport const FilterMenuTopHeader = React.memo(({\n  title,\n  actions,\n  className\n}) => {\n  const styles = useFilterMenuTopHeaderStyles()\n  return <div className={clsx(className, styles.root)}>\n    <Actions>\n      <ActionHeader>\n        <Typography className={styles.title} variant=\"overline\">{title}</Typography>\n      </ActionHeader>\n      {actions}\n    </Actions>\n  </div>\n})\nFilterMenuTopHeader.propTypes = {\n  overlineTitle: PropTypes.string,\n  title: PropTypes.string,\n  topAction: PropTypes.node,\n  actions: PropTypes.node,\n  className: PropTypes.string\n}\n\n// Header for filter menus. Contains panel actions and an overline text.\nconst useFilterMenuHeaderStyles = makeStyles(theme => {\n  return {\n    root: {\n      height: theme.spacing(3),\n      paddingBottom: theme.spacing(1.1),\n      paddingTop: theme.spacing(0.3),\n      paddingLeft: theme.spacing(paddingHorizontal),\n      paddingRight: theme.spacing(paddingHorizontal),\n      display: 'flex',\n      flexDirection: 'column',\n      justifyContent: 'center'\n    },\n    title: {\n      display: 'flex',\n      alignItems: 'center',\n      fontSize: '0.90rem'\n    }\n  }\n})\nexport const FilterMenuHeader = React.memo(({\n  title,\n  actions,\n  className,\n  'data-testid': testID\n}) => {\n  const styles = useFilterMenuHeaderStyles()\n  return <div className={clsx(className, styles.root)} data-testid={testID}>\n    <Actions>\n      <ActionHeader>\n        <Typography className={styles.title} variant=\"button\">{title}</Typography>\n      </ActionHeader>\n      {actions}\n    </Actions>\n  </div>\n})\n\nFilterMenuHeader.propTypes = {\n  overlineTitle: PropTypes.string,\n  title: PropTypes.string,\n  topAction: PropTypes.node,\n  actions: PropTypes.node,\n  className: PropTypes.string,\n  'data-testid': PropTypes.string\n}\n\nconst useFilterMenuStyles = makeStyles(theme => {\n  const width = 22\n  return {\n    root: {\n      boxSizing: 'border-box',\n      display: 'flex',\n      position: 'relative',\n      flexDirection: 'column',\n      width: `${width}rem`,\n      height: '100%',\n      '-webkit-transform': 'none',\n      transform: 'none',\n      transition: 'transform 250ms',\n      willChange: 'transform'\n    },\n    collapsed: {\n      '-webkit-transform': `translateX(-${width - collapsedMenuWidth}rem)`,\n      transform: `translateX(-${width - collapsedMenuWidth}rem)`\n    }\n  }\n})\n\nexport const FilterMenu = React.memo(({\n  selected,\n  onSelectedChange,\n  open,\n  onOpenChange,\n  collapsed,\n  onCollapsedChange,\n  className,\n  children\n}) => {\n  const styles = useFilterMenuStyles()\n  const [size, setSize] = useState('m')\n\n  const handleChange = useCallback((newValue) => {\n    if (newValue !== selected) {\n      onOpenChange(true)\n    } else {\n      onOpenChange(old => !old)\n    }\n    onSelectedChange && onSelectedChange(newValue)\n  }, [selected, onSelectedChange, onOpenChange])\n\n  return <div className={clsx(className, styles.root, collapsed && styles.collapsed)}>\n    <filterMenuContext.Provider value={{\n      selected: selected,\n      onChange: handleChange,\n      open: open,\n      onOpenChange: onOpenChange,\n      size: size,\n      onSizeChange: setSize,\n      collapsed: collapsed,\n      onCollapsedChange: onCollapsedChange\n    }}>\n      {children}\n    </filterMenuContext.Provider>\n  </div>\n})\nFilterMenu.propTypes = {\n  selected: PropTypes.string,\n  onSelectedChange: PropTypes.func,\n  open: PropTypes.bool,\n  onOpenChange: PropTypes.func,\n  collapsed: PropTypes.bool,\n  onCollapsedChange: PropTypes.func,\n  className: PropTypes.string,\n  children: PropTypes.node\n}\n\nconst useFilterMenuItemsStyles = makeStyles(theme => {\n  return {\n    root: {\n      boxSizing: 'border-box',\n      display: 'flex',\n      flexDirection: 'column',\n      width: '100%',\n      height: '100%',\n      backgroundColor: theme.palette.background.paper,\n      zIndex: 3\n    },\n    headerTextVertical: {\n      display: 'flex',\n      alignItems: 'center',\n      position: 'absolute',\n      right: '0.07rem',\n      top: '2.5rem',\n      height: `${collapsedMenuWidth}rem`,\n      transform: 'rotate(90deg)'\n    },\n    menu: {\n      position: 'absolute',\n      right: 0,\n      top: 0,\n      bottom: 0,\n      left: 0,\n      boxSizing: 'border-box'\n    },\n    menuBorder: {\n      boxShadow: `1px 0px 0px 0px ${theme.palette.action.selected}`\n    },\n    padding: {\n      paddingBottom: `${theme.spacing(1.5)}px`\n    },\n    button: {\n      marginRight: 0,\n      '-webkit-transform': 'none',\n      transform: 'none',\n      transition: 'transform 250ms',\n      willChange: 'transform'\n    },\n    hidden: {\n      display: 'none'\n    },\n    overflow: {\n      overflow: 'visible'\n    },\n    list: {\n      paddingTop: 0\n    },\n    container: {\n      display: 'flex',\n      flexDirection: 'column',\n      height: '100%'\n    },\n    content: {\n      flex: 1,\n      minHeight: 0\n    },\n    collapsedActions: {\n      paddingTop: theme.spacing(0.7),\n      paddingLeft: theme.spacing(paddingHorizontal),\n      paddingRight: theme.spacing(paddingHorizontal)\n    }\n  }\n})\nexport const FilterMenuItems = React.memo(({\n  className,\n  children\n}) => {\n  // const { useResetFilters, useRefresh, useApiData } = useSearchContext()\n  const styles = useFilterMenuItemsStyles()\n  const { open, onOpenChange, collapsed, onCollapsedChange } = useContext(filterMenuContext)\n  const [anchorEl, setAnchorEl] = React.useState(null)\n  const isSettingsOpen = Boolean(anchorEl)\n\n  // Callbacks\n  const openMenu = useCallback((event) => {\n    setAnchorEl(event.currentTarget)\n  }, [])\n  const closeMenu = useCallback(() => {\n    setAnchorEl(null)\n  }, [])\n\n  // Unfortunately the ClickAwayListener does not play nicely together with\n  // Menus/Select/Popper. When using Portals, the clicks are registered wrong.\n  // When Portals are disabled (disablePortal), their positioning goes haywire.\n  // The clicks outside are thus detected by individual event listeners that\n  // toggle the menu state.\n  return <div className={clsx(className, styles.root)}>\n    <div className={clsx(styles.menu, open && styles.menuBorder, collapsed && styles.hidden)}>\n      <div className={styles.container}>\n        <FilterMenuTopHeader/>\n        <FilterMenuHeader\n          title=\"Filters\"\n          actions={<>\n            <Action\n              tooltip={'Hide filter menu'}\n              onClick={() => {\n                onCollapsedChange(old => !old)\n                onOpenChange(false)\n              }}\n              // className={styles.button}\n            >\n              <ArrowBackIcon fontSize=\"small\"/>\n            </Action>\n            <Action\n              tooltip=\"Options\"\n              onClick={openMenu}\n            >\n              <MoreVert fontSize=\"small\"/>\n            </Action>\n            <Menu\n              anchorEl={anchorEl}\n              open={isSettingsOpen}\n              onClose={closeMenu}\n              getContentAnchorEl={null}\n              anchorOrigin={{ vertical: 'bottom', horizontal: 'right' }}\n              transformOrigin={{ vertical: 'top', horizontal: 'right' }}\n              keepMounted\n            >\n              <div>\n                <FilterSettings/>\n              </div>\n            </Menu>\n          </>}\n        />\n        <div className={styles.content}>\n          <Scrollable>\n            <div className={styles.padding}>\n              <Divider/>\n              <List dense className={styles.list}>\n                {children}\n              </List>\n            </div>\n          </Scrollable>\n        </div>\n      </div>\n    </div>\n    <div className={clsx(!collapsed && styles.hidden)}>\n      <Actions className={styles.collapsedActions}>\n        {collapsed && <Action\n          tooltip={'Show filter menu'}\n          onClick={() => {\n            onCollapsedChange(false)\n          }}\n          className={styles.button}\n        >\n          <ArrowForwardIcon fontSize=\"small\"/>\n        </Action>}\n      </Actions>\n      <Typography\n        className={clsx(styles.headerText, styles.headerTextVertical)}\n        variant=\"button\"\n      >Filters\n      </Typography>\n    </div>\n  </div>\n})\nFilterMenuItems.propTypes = {\n  className: PropTypes.string,\n  children: PropTypes.node\n}\n\nconst levelIndent = 1.8\nconst leftGutter = 3.0\nconst rightGutter = 2.35\nconst itemHeight = 2.6\nconst useFilterMenuItemStyles = makeStyles(theme => {\n  return {\n    root: {\n      minHeight: `${itemHeight}rem`\n    },\n    label: {\n      textTransform: 'capitalize'\n    },\n    listIcon: {\n      fontsize: '1rem',\n      minWidth: '1.5rem'\n    },\n    arrow: {\n      marginLeft: theme.spacing(1),\n      fontSize: '1.5rem'\n    },\n    gutters: {\n      paddingLeft: theme.spacing(leftGutter),\n      paddingRight: theme.spacing(rightGutter)\n    },\n    listItem: {\n      position: 'relative',\n      height: `${itemHeight}rem`\n    },\n    actions: {\n      display: 'flex',\n      flexDirection: 'column',\n      paddingLeft: theme.spacing(leftGutter),\n      paddingRight: theme.spacing(rightGutter)\n    },\n    divider: {\n      width: '100%',\n      backgroundColor: theme.palette.grey[300]\n    }\n  }\n})\nexport const FilterMenuItem = React.memo(({\n  id,\n  label,\n  onClick,\n  actions,\n  disableButton,\n  level\n}) => {\n  const styles = useFilterMenuItemStyles()\n  const theme = useTheme()\n  const { selected, open, onChange } = useContext(filterMenuContext)\n  const handleClick = disableButton ? undefined : (onClick || onChange)\n  const opened = open && id === selected\n\n  return <div className={styles.root}>\n    {(label || handleClick) &&\n    <ListItem\n      button={!!handleClick}\n      className={styles.listItem}\n      classes={{gutters: styles.gutters}}\n      onClick={handleClick && (() => handleClick(id))}\n    >\n      {label && <ListItemText\n        style={{marginLeft: theme.spacing(level * levelIndent)}}\n        primaryTypographyProps={{\n          color: opened ? 'primary' : 'initial',\n          className: styles.label\n        }}\n        primary={label}\n        data-testid={`menu-item-label-${id}`}\n      />}\n      {handleClick && <ListItemIcon className={styles.listIcon}>\n        <NavigateNextIcon color={opened ? 'primary' : 'action'} className={styles.arrow}/>\n      </ListItemIcon>}\n    </ListItem>}\n    {actions && <div\n      className={styles.actions}\n      style={{marginLeft: theme.spacing(level * levelIndent)}}\n    >\n      {actions}\n    </div>}\n    <Divider className={styles.divider}/>\n  </div>\n})\n\nFilterMenuItem.propTypes = {\n  id: PropTypes.string,\n  label: PropTypes.string,\n  onClick: PropTypes.func,\n  actions: PropTypes.node,\n  disableButton: PropTypes.bool,\n  level: PropTypes.number\n}\nFilterMenuItem.defaultProps = {\n  level: 0\n}\n\nconst useFilterSubMenusStyles = makeStyles(theme => {\n  const widthS = 25\n  const widthM = 32\n  const widthL = 40\n  const widthXL = 48\n  return {\n    root: {\n      zIndex: 2,\n      display: 'flex',\n      flexDirection: 'column',\n      position: 'absolute',\n      right: 0,\n      top: 0,\n      bottom: 0,\n      width: `${widthXL}rem`,\n      backgroundColor: theme.palette.background.paper,\n      '-webkit-transform': 'none',\n      transform: 'none',\n      transition: 'transform 250ms',\n      flexGrow: 1,\n      boxSizing: 'border-box',\n      willChange: 'transform'\n    },\n    collapsed: {\n      display: 'none'\n    },\n    containerS: {\n      '-webkit-transform': `translateX(${widthS}rem)`,\n      transform: `translateX(${widthS}rem)`\n    },\n    containerM: {\n      '-webkit-transform': `translateX(${widthM}rem)`,\n      transform: `translateX(${widthM}rem)`\n    },\n    containerL: {\n      '-webkit-transform': `translateX(${widthL}rem)`,\n      transform: `translateX(${widthL}rem)`\n    },\n    containerXL: {\n      '-webkit-transform': `translateX(${widthXL}rem)`,\n      transform: `translateX(${widthXL}rem)`\n    },\n    menu: {\n      position: 'absolute',\n      right: 0,\n      top: 0,\n      bottom: 0,\n      boxSizing: 'border-box',\n      display: 'flex',\n      flexDirection: 'column'\n    },\n    content: {\n      flex: 1,\n      minHeight: 0\n    },\n    menuS: {\n      width: `${widthS}rem`\n    },\n    menuM: {\n      width: `${widthM}rem`\n    },\n    menuL: {\n      width: `${widthL}rem`\n    },\n    menuXL: {\n      width: `${widthXL}rem`\n    },\n    button: {\n      marginRight: 0\n    }\n  }\n})\n\nexport const FilterSubMenus = React.memo(({\n  children\n}) => {\n  const { useResults } = useSearchContext()\n  const nResults = useResults()?.pagination?.total\n  const styles = useFilterSubMenusStyles()\n  const { open, onOpenChange, size, collapsed } = useContext(filterMenuContext)\n  const [menuStyle, containerStyle] = {\n    s: [styles.menuS, styles.containerS],\n    m: [styles.menuM, styles.containerM],\n    l: [styles.menuL, styles.containerL],\n    xl: [styles.menuXL, styles.containerXL]\n  }[size]\n\n  return <Paper\n    elevation={4}\n    className={clsx(styles.root, open && containerStyle)}\n  >\n    <div className={clsx(styles.menu, menuStyle, collapsed && styles.collapsed)}>\n      <FilterMenuTopHeader\n        title={isNil(nResults) ? 'loading...' : pluralize('result', nResults, true)}\n        actions={<Action\n          tooltip=\"Close submenu\"\n          onClick={() => { onOpenChange(false) }}\n          className={styles.button}\n        >\n          <ArrowBackIcon fontSize=\"small\"/>\n        </Action>}\n      />\n      <div className={styles.content}>\n        {children}\n      </div>\n    </div>\n  </Paper>\n})\nFilterSubMenus.propTypes = {\n  sizes: PropTypes.object,\n  children: PropTypes.node\n}\n\nconst useFilterSubMenuStyles = makeStyles(theme => ({\n  root: {\n    width: '100%',\n    height: '100%',\n    display: 'flex',\n    flexDirection: 'column'\n  },\n  hidden: {\n    display: 'none'\n  },\n  padding: {\n    paddingBottom: theme.spacing(1.5),\n    paddingLeft: theme.spacing(paddingHorizontal),\n    paddingRight: theme.spacing(paddingHorizontal)\n  },\n  content: {\n    flex: 1,\n    minHeight: 0\n  }\n}))\n\nexport const FilterSubMenu = React.memo(({\n  id,\n  label,\n  size,\n  actions,\n  children\n}) => {\n  const styles = useFilterSubMenuStyles()\n  const { selected, onSizeChange } = useContext(filterMenuContext)\n  const visible = id === selected\n  useEffect(() => {\n    if (visible) {\n      onSizeChange(size)\n    }\n  }, [size, visible, onSizeChange])\n\n  return <div className={clsx(styles.root, !visible && styles.hidden)}>\n    <FilterMenuHeader title={label} actions={actions} data-testid={`filter-menu-header-${id}`}/>\n    <div className={styles.content}>\n      <Scrollable>\n        {children}\n      </Scrollable>\n    </div>\n  </div>\n})\nFilterSubMenu.propTypes = {\n  id: PropTypes.string,\n  label: PropTypes.string,\n  size: PropTypes.oneOf(['s', 'm', 'l', 'xl']),\n  actions: PropTypes.node,\n  children: PropTypes.node\n}\nFilterSubMenu.defaultProps = {\n  size: 's'\n}\n\nexport default FilterSubMenu\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport {\n  Grid,\n  Divider,\n  makeStyles\n} from '@material-ui/core'\n\n/**\n * For displaying a grid of input properties.\n *\n * Notice that we have to use a workaround for the MUI grid item in order to\n * prevent horizontal overflow. A padding is applied to the parent element as\n * described in https://v4.mui.com/components/grid/#negative-margin\n */\nconst inputGridSpacing = 2\nconst useInputGridStyles = makeStyles(theme => ({\n  root: {\n    paddingLeft: theme.spacing(inputGridSpacing / 2),\n    paddingRight: theme.spacing(inputGridSpacing / 2)\n  }\n}))\nexport function InputGrid({children}) {\n  const styles = useInputGridStyles()\n  return <div className={styles.root}>\n    <Grid container spacing={inputGridSpacing} style={{marginTop: 0}}>\n      {children}\n    </Grid>\n  </div>\n}\n\nInputGrid.propTypes = {\n  children: PropTypes.any\n}\n\n/**\n * For displaying an individual input filter, typically within a InputGrid.\n */\nconst useInputGridItemStyles = makeStyles(theme => ({\n  root: {\n    marginBottom: theme.spacing(inputGridSpacing / 2)\n  },\n  content: {\n    paddingLeft: theme.spacing(inputGridSpacing / 4),\n    paddingRight: theme.spacing(inputGridSpacing / 4)\n  },\n  divider: {\n    marginLeft: theme.spacing(-inputGridSpacing / 2),\n    marginRight: theme.spacing(-inputGridSpacing / 2),\n    marginTop: theme.spacing(-inputGridSpacing / 2),\n    marginBottom: theme.spacing(inputGridSpacing / 4),\n    backgroundColor: theme.palette.grey[300]\n  }\n}))\nexport function InputGridItem({classes, children, ...other}) {\n  const styles = useInputGridItemStyles({classes: classes})\n  return <Grid item {...other} className={styles.root}>\n    <Divider className={styles.divider}/>\n    <div className={styles.content}>\n      {children}\n    </div>\n  </Grid>\n}\n\nInputGridItem.propTypes = {\n  classes: PropTypes.object,\n  children: PropTypes.any\n}\n\nInputGridItem.defaultProps = {\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useCallback } from 'react'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\nimport {\n  FormControlLabel,\n  Checkbox,\n  Tooltip,\n  Typography\n} from '@material-ui/core'\nimport PropTypes from 'prop-types'\nimport { isNil } from 'lodash'\nimport clsx from 'clsx'\nimport { useSearchContext, getValue } from '../SearchContext'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    width: '100%',\n    display: 'flex',\n    alignItems: 'flex-start',\n    justifyContent: 'center',\n    flexDirection: 'column',\n    boxSizing: 'border-box'\n  }\n}))\n\n/**\n * A checkbox where the selection controls a true/false value within a quantity.\n */\nconst InputCheckbox = React.memo(({\n  quantity,\n  label,\n  description,\n  initialValue,\n  className,\n  classes,\n  'data-testid': testID\n}) => {\n  const theme = useTheme()\n  const styles = useStyles({classes: classes, theme: theme})\n  const {filterData, useFilterState, useFilterLocked} = useSearchContext()\n  const [filter, setFilter] = useFilterState(quantity)\n  const filterLocked = useFilterLocked(quantity)\n\n  // Determine the description and units\n  const def = filterData[quantity]\n  const descFinal = description || def?.description || ''\n  const labelFinal = label || def?.label\n  const locked = !isNil(filterLocked) && def.global\n  const val = getValue(def, filter, filterLocked, initialValue)\n\n  const handleChange = useCallback((event, value) => {\n    setFilter(value)\n  }, [setFilter])\n\n  return <div className={clsx(className, styles.root)} data-testid={testID}>\n    <Tooltip title={descFinal}>\n      <FormControlLabel\n        control={<Checkbox\n          color=\"secondary\"\n          disabled={locked}\n          checked={val}\n          onChange={handleChange}\n        />}\n        label={<Typography>{labelFinal}</Typography>}\n      />\n    </Tooltip>\n  </div>\n})\n\nInputCheckbox.propTypes = {\n  quantity: PropTypes.string.isRequired,\n  label: PropTypes.string,\n  description: PropTypes.string,\n  initialValue: PropTypes.bool,\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  'data-testid': PropTypes.string\n}\n\nexport default InputCheckbox\n\n/**\n * A checkbox where the selection activates a specific value within a quantity.\n */\nconst useInputCheckboxValueStyles = makeStyles(theme => ({\n  root: {\n    '& > :last-child': {\n      marginRight: -3\n    }\n  },\n  control: {\n    padding: 6\n  }\n}))\nexport const InputCheckboxValue = React.memo(({\n  quantity,\n  description,\n  value,\n  className,\n  classes,\n  'data-testid': testID\n}) => {\n  const theme = useTheme()\n  const styles = useInputCheckboxValueStyles({classes: classes, theme: theme})\n  const {filterData, useFilterState} = useSearchContext()\n  const [filter, setFilter] = useFilterState(quantity)\n\n  // Determine the description and units\n  const def = filterData[quantity]\n  const descFinal = description || def?.description || ''\n\n  const handleChange = useCallback(() => {\n    setFilter(old => {\n      const newValue = old ? new Set(old) : new Set()\n      newValue.has(value) ? newValue.delete(value) : newValue.add(value)\n      return newValue\n    })\n  }, [setFilter, value])\n\n  return <div className={clsx(className, styles.root)} data-testid={testID}>\n    <Tooltip title={descFinal}>\n      <Checkbox\n        color=\"secondary\"\n        checked={filter ? filter.has(value) : false}\n        onChange={handleChange}\n        className={styles.control}\n        size=\"small\"\n      />\n    </Tooltip>\n  </div>\n})\n\nInputCheckboxValue.propTypes = {\n  quantity: PropTypes.string.isRequired,\n  description: PropTypes.string,\n  value: PropTypes.any,\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  'data-testid': PropTypes.string\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useMemo, useCallback, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\nimport { isNil } from 'lodash'\nimport elementData from '../../../elementData'\nimport { useResizeDetector } from 'react-resize-detector'\nimport { Tooltip } from '@material-ui/core'\nimport InputHeader from './InputHeader'\nimport InputCheckbox from './InputCheckbox'\nimport { makeStyles, useTheme, lighten } from '@material-ui/core/styles'\nimport { useSearchContext } from '../SearchContext'\nimport { approxInteger } from '../../../utils'\nimport { getScaler } from '../../plotting/common'\n\n/**\n * A single element in the periodic table.\n*/\nconst useElementStyles = makeStyles(theme => ({\n  text: {\n    fontFamily: theme.typography.fontFamily,\n    fill: theme.palette.text.default,\n    userSelect: 'none',\n    pointerEvents: 'none'\n  },\n  rect: {\n    transition: 'fill .15s ease',\n    cursor: 'pointer',\n    '&:hover': {\n      filter: 'drop-shadow(0px 0px 2px rgb(0 0 0 / 0.4))'\n    }\n  },\n  rectDisabled: {\n    cursor: 'auto',\n    '&:hover': {\n      filter: 'unset'\n    }\n  },\n  label: {\n    fontSize: '1rem',\n    fontWeight: 600\n  },\n  number: {\n    fontSize: '0.58rem'\n  },\n  count: {\n    fontSize: '0.58rem'\n  }\n}))\n\nconst Element = React.memo(({\n  x,\n  y,\n  width,\n  height,\n  element,\n  selected,\n  disabled,\n  onClick,\n  disableStatistics,\n  max,\n  count,\n  scale\n}) => {\n  const styles = useElementStyles()\n  const theme = useTheme()\n  const scaler = useMemo(() => getScaler(scale, [0, max], [0.2, 1]), [scale, max])\n  const finalCount = useMemo(() => approxInteger(count || 0), [count])\n  const finalScale = useMemo(() => scaler(count), [count, scaler])\n  const disabledFinal = disabled && !selected\n  const color = selected\n    ? theme.palette.secondary.main\n    : disabled\n      ? '#eee'\n      : disableStatistics\n        ? theme.palette.primary.light\n        : lighten(theme.palette.primary.light, 1 - finalScale)\n  const strokeColor = disabledFinal\n    ? theme.palette.text.disabled\n    : '#555'\n  const textColor = selected\n    ? 'white'\n    : disabled\n      ? theme.palette.text.disabled\n      : theme.palette.text.default\n\n  const handleClick = useCallback(() => {\n    if (disabledFinal) return\n    onClick && onClick()\n  }, [onClick, disabledFinal])\n\n  return <Tooltip title={element.name}>\n    <g>\n      <rect\n        data-testid={element.name}\n        x={x}\n        y={y}\n        width={width}\n        height={height}\n        stroke={strokeColor}\n        strokeWidth={1}\n        fill={color}\n        className={clsx(styles.rect, disabledFinal && styles.rectDisabled)}\n        onClick={handleClick}\n      />\n      <text\n        x={x + 0.5 * width}\n        y={y + 0.53 * height}\n        fill={textColor}\n        textAnchor=\"middle\"\n        dominantBaseline=\"middle\"\n        className={clsx(styles.text, styles.label)}>{element.symbol}\n      </text>\n      <text\n        x={x + 0.04 * width}\n        y={y + 0.03 * height}\n        fill={textColor}\n        textAnchor=\"start\"\n        dominantBaseline=\"hanging\"\n        className={clsx(styles.text, styles.number)}>{element.number}\n      </text>\n      {!disableStatistics && <text\n        x={x + 0.95 * width}\n        y={y + 0.93 * height}\n        fill={textColor}\n        textAnchor=\"end\"\n        dominantBaseline=\"auto\"\n        className={clsx(styles.text, styles.number)}>{finalCount}\n      </text>}\n    </g>\n  </Tooltip>\n})\n\nElement.propTypes = {\n  x: PropTypes.number.isRequired,\n  y: PropTypes.number.isRequired,\n  width: PropTypes.number.isRequired,\n  height: PropTypes.number.isRequired,\n  element: PropTypes.object.isRequired,\n  max: PropTypes.number,\n  count: PropTypes.number,\n  scale: PropTypes.string,\n  selected: PropTypes.bool,\n  disabled: PropTypes.bool,\n  onClick: PropTypes.func,\n  disableStatistics: PropTypes.bool\n}\n\n/**\n * Displays an interactive periodic table.\n*/\nconst usePeriodicTableStyles = makeStyles(theme => ({\n  root: {\n    minHeight: 0, // added min-height: 0 to prevent relayouting when within flexbox\n    flexGrow: 1,\n    width: '100%',\n    height: '100%',\n    position: 'relative'\n  },\n  container: {\n    position: 'absolute',\n    top: theme.spacing(-0.2),\n    left: '10%',\n    textAlign: 'center'\n  }\n}))\nexport const PeriodicTable = React.memo(({\n  quantity,\n  visible,\n  scale,\n  anchored,\n  disableStatistics,\n  aggId,\n  className,\n  'data-testid': testID\n}) => {\n  const styles = usePeriodicTableStyles()\n  const { height, width, ref } = useResizeDetector()\n  const {useFilterState, useAgg, useIsStatisticsEnabled} = useSearchContext()\n  const isStatisticsEnabled = useIsStatisticsEnabled()\n  const [filter, setFilter] = useFilterState(quantity)\n  const aggConfig = useMemo(() => ({type: 'terms'}), [])\n  const agg = useAgg(quantity, visible, aggId, aggConfig)\n  const availableValues = useMemo(() => {\n    const elementCountMap = {}\n    agg?.data && agg.data.forEach((value) => { elementCountMap[value.value] = value.count })\n    return elementCountMap\n  }, [agg])\n  disableStatistics = anchored\n    ? false\n    : isNil(disableStatistics) ? !isStatisticsEnabled : disableStatistics\n\n  const onElementClicked = useCallback((element) => {\n    setFilter(old => {\n      let newValues\n      if (old) {\n        const isSelected = old?.has(element)\n        isSelected ? old.delete(element) : old.add(element)\n        newValues = new Set(old)\n      } else {\n        newValues = new Set([element])\n      }\n      return newValues\n    })\n  }, [setFilter])\n\n  const max = useMemo(() => {\n    return agg\n      ? Math.max(...agg.data\n        .filter(option => !filter?.has(option.value))\n        .map(option => option.count))\n      : 0\n  }, [agg, filter])\n\n  const padding = 1\n  const margin = 3\n  const cellWidth = (width - 2 * padding - 17 * margin) / 18\n  const cellHeight = (height - 2 * padding - 9 * margin) / 10\n\n  return <div ref={ref} className={clsx(styles.root, className)} data-testid={testID}>\n    <svg\n      width=\"100%\"\n      height=\"100%\"\n      viewBox={`0 0 ${width || 0} ${height || 0}`}\n      shapeRendering='optimizeSpeed'\n      textRendering='optimizeSpeed'\n    >\n      {(width && height) &&\n        elementData.elements.map((element) => (\n          <Element\n            key={element.name}\n            element={element}\n            disabled={!availableValues[element.symbol]}\n            onClick={() => onElementClicked(element.symbol)}\n            selected={filter?.has(element.symbol)}\n            max={max}\n            count={availableValues[element.symbol]}\n            scale={scale}\n            x={padding + (element.xpos - 1) * (cellWidth + margin)}\n            y={padding + (element.ypos - 1) * (cellHeight + margin)}\n            width={cellWidth}\n            height={cellHeight}\n            disableStatistics={disableStatistics}\n          />\n        ))\n      }\n    </svg>\n    <div className={styles.container}>\n      <InputCheckbox\n        quantity=\"exclusive\"\n        label=\"only compositions that exclusively contain these atoms\"\n      ></InputCheckbox>\n    </div>\n  </div>\n})\n\nPeriodicTable.propTypes = {\n  quantity: PropTypes.string,\n  label: PropTypes.string,\n  description: PropTypes.string,\n  visible: PropTypes.bool,\n  scale: PropTypes.string,\n  anchored: PropTypes.bool,\n  disableStatistics: PropTypes.bool,\n  aggId: PropTypes.string,\n  className: PropTypes.string,\n  'data-testid': PropTypes.string\n}\n\nPeriodicTable.defaultProps = {\n  aggId: 'default',\n  'data-testid': 'periodictable'\n}\n\n/**\n * Periodic table that directly shows the targeted quantity along with some\n * extra controls.\n */\nconst useInputPeriodicTableStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex',\n    flexDirection: 'column'\n  }\n}))\nconst InputPeriodicTable = React.memo(({\n    quantity,\n    label,\n    description,\n    visible,\n    initialScale,\n    anchored,\n    disableStatistics,\n    aggId,\n    className\n  }) => {\n  const styles = useInputPeriodicTableStyles()\n  const [scale, setScale] = useState(initialScale)\n  const {filterData} = useSearchContext()\n\n  // Determine the description and title\n  const def = filterData[quantity]\n  const descFinal = description || def?.description || ''\n  const labelFinal = label || def?.label\n\n  return <div className={clsx(styles.root, className)}>\n    <InputHeader\n      quantity={quantity}\n      label={labelFinal}\n      description={descFinal}\n      scale={scale}\n      onChangeScale={setScale}\n      disableStatistics={disableStatistics}\n      disableAggSize\n      anchored={anchored}\n    />\n    <PeriodicTable\n      quantity={quantity}\n      visible={visible}\n      scale={scale}\n      anchored={anchored}\n      disableStatistics={disableStatistics}\n      aggId={aggId}\n    />\n  </div>\n})\n\nInputPeriodicTable.propTypes = {\n  quantity: PropTypes.string,\n  label: PropTypes.string,\n  description: PropTypes.string,\n  visible: PropTypes.bool,\n  initialScale: PropTypes.string,\n  anchored: PropTypes.bool,\n  disableStatistics: PropTypes.bool,\n  aggId: PropTypes.string,\n  className: PropTypes.string\n}\n\nInputPeriodicTable.defaultProps = {\n  initialScale: 'linear'\n}\n\nexport default InputPeriodicTable\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useMemo } from 'react'\nimport clsx from 'clsx'\nimport { Typography, Tooltip } from '@material-ui/core/'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\nimport PropTypes from 'prop-types'\nimport { approxInteger } from '../../../utils'\nimport { getScaler } from '../../plotting/common'\n\n/**\n * A rectangular bar displaying the relative occurence of a specific value. Uses\n * an animated CSS transform to react to changes in the bar size. Notice that\n * using a transform is much more performant than animating the width.\n */\nconst useStyles = makeStyles(theme => ({\n  root: {\n  },\n  container: {\n    position: 'relative',\n    width: '100%',\n    height: '100%'\n  },\n  rectangle: {\n    backgroundColor: theme.palette.primary.light,\n    width: '100%',\n    height: '100%',\n    '-webkit-transform': 'none',\n    transform: 'none',\n    transition: 'transform 250ms',\n    transformOrigin: 'bottom left',\n    willChange: 'transform'\n  },\n  value: {\n    position: 'absolute',\n    right: theme.spacing(1),\n    top: 0,\n    bottom: 0\n  }\n}))\nconst StatisticsBar = React.memo(({\n  max,\n  value,\n  scale,\n  selected,\n  vertical,\n  disabled,\n  disableValue,\n  tooltip,\n  onClick,\n  className,\n  classes,\n  'data-testid': testID\n}) => {\n  const styles = useStyles(classes)\n  const theme = useTheme()\n\n  // Calculate the approximated count and the final scaled value\n  const scaler = useMemo(() => scale ? getScaler(scale, [0, max]) : (value) => value, [scale, max])\n  const finalCount = useMemo(() => approxInteger(value || 0), [value])\n  const finalScale = useMemo(() => scaler(value), [value, scaler])\n\n  return <div onClick={onClick} className={clsx(className, styles.root)} data-testid={testID}>\n    <Tooltip placement=\"bottom\" enterDelay={0} title={tooltip || ''}>\n      <div className={styles.container}>\n        <div className={styles.rectangle} style={{\n          transform: vertical ? `scaleY(${finalScale})` : `scaleX(${finalScale})`,\n          backgroundColor: disabled ? theme.palette.action.disabledBackground : (selected ? theme.palette.secondary.veryLight : theme.palette.primary.veryLight)\n        }}></div>\n        {!disableValue && <Typography className={styles.value} style={{color: disabled ? theme.palette.text.disabled : undefined}}>{finalCount}</Typography>}\n      </div>\n    </Tooltip>\n  </div>\n})\n\nStatisticsBar.propTypes = {\n  max: PropTypes.number,\n  value: PropTypes.number,\n  scale: PropTypes.string,\n  selected: PropTypes.bool,\n  disabled: PropTypes.bool,\n  disableValue: PropTypes.bool,\n  tooltip: PropTypes.string,\n  vertical: PropTypes.bool,\n  onClick: PropTypes.func,\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  'data-testid': PropTypes.string\n}\n\nexport default StatisticsBar\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useCallback } from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport {\n  Checkbox,\n  Radio,\n  Tooltip,\n  Typography,\n  FormControlLabel\n} from '@material-ui/core'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\nimport StatisticsBar from '../widgets/StatisticsBar'\n\n/**\n * Represents a selectable item for a filter value.\n*/\nexport const inputItemHeight = 34\nconst useStyles = makeStyles(theme => ({\n  root: {\n    width: '100%',\n    height: inputItemHeight,\n    position: 'relative'\n  },\n  controlLabel: {\n    width: '100%',\n    height: '100%',\n    margin: 0\n  },\n  labelContainer: {\n    height: '100%',\n    width: '100%'\n  },\n  labelPlacementStart: {\n    margin: 0\n  },\n  container: {\n    position: 'relative',\n    height: '100%',\n    width: '100%'\n  },\n  label: {\n    position: 'absolute',\n    top: 0,\n    left: theme.spacing(0.5),\n    right: 0,\n    bottom: 0,\n    lineHeight: '100%',\n    textAlign: 'center',\n    display: 'flex',\n    alignItems: 'center'\n  },\n  bar: {\n    position: 'absolute',\n    top: theme.spacing(0.8),\n    left: 0,\n    right: 0,\n    bottom: theme.spacing(0.8)\n  }\n}))\nconst InputItem = React.memo(({\n  value,\n  label,\n  selected,\n  onChange,\n  disabled,\n  tooltip,\n  variant,\n  max,\n  count,\n  scale,\n  disableStatistics,\n  labelPlacement,\n  disableLabelClick,\n  disableSelect,\n  className,\n  classes,\n  'data-testid': testID,\n  ...moreProps\n}) => {\n  const styles = useStyles(classes)\n\n  const finalLabel = label || `${value}`\n  const handleChange = useCallback((event) => {\n    if (!disabled && onChange) onChange(event, value, !selected)\n  }, [value, disabled, onChange, selected])\n\n  let Control\n  if (variant === 'radio') {\n    Control = Radio\n  } else if (variant === 'checkbox') {\n    Control = Checkbox\n  }\n\n  // Component that contains the label and the statistics\n  const labelComponent = <div className={styles.container}>\n    {!disableStatistics && <StatisticsBar\n      className={styles.bar}\n      max={max}\n      value={count}\n      scale={scale}\n      selected={selected}\n      disabled={disabled}\n    />}\n    <div className={styles.label} style={!disableStatistics ? {right: '4rem'} : undefined}>\n      <Tooltip\n        placement=\"right\"\n        enterDelay={200}\n        title={tooltip || ''}\n      >\n        <Typography noWrap>{finalLabel}</Typography>\n      </Tooltip>\n    </div>\n  </div>\n\n  return <div className={clsx(className, styles.root)} data-testid={testID}>\n    {disableSelect\n      ? labelComponent\n      : <FormControlLabel\n        style={{pointerEvents: disableLabelClick ? 'none' : undefined}}\n        className={styles.controlLabel}\n        classes={{\n          label: styles.labelContainer,\n          labelPlacementStart: styles.labelPlacementStart\n        }}\n        labelPlacement={labelPlacement}\n        disabled={disabled}\n        control={<Control\n          checked={selected}\n          size=\"medium\"\n          color=\"secondary\"\n          onClick={handleChange}\n          name={finalLabel}\n          style={{\n            padding: 6,\n            pointerEvents: (disableLabelClick ? 'auto' : undefined),\n            marginRight: (labelPlacement === 'start' ? -8 : undefined),\n            marginLeft: (labelPlacement === 'end' ? -8 : undefined)\n          }}\n          {...moreProps}\n        />}\n        label={labelComponent}\n      />\n    }\n  </div>\n})\n\nInputItem.propTypes = {\n  value: PropTypes.any, // The actual value\n  label: PropTypes.string, // The name to show\n  selected: PropTypes.bool, // Whether the option is selected or not\n  onChange: PropTypes.func, // Callback when selecting\n  disabled: PropTypes.bool, // Whether the option should be disabled\n  tooltip: PropTypes.string, // Tooltip that is shown for label\n  variant: PropTypes.oneOf(['radio', 'checkbox']), // The type of item to display\n  max: PropTypes.number, // Maximum for statistics\n  count: PropTypes.number, // Count of these values for statistics\n  scale: PropTypes.string, // Scaling of the statistics\n  disableStatistics: PropTypes.bool, // Use to disable statistics for this item\n  labelPlacement: PropTypes.oneOf(['start', 'end']), // Controls the label placement\n  disableLabelClick: PropTypes.bool, // Whether clicking the label is enabled\n  disableSelect: PropTypes.bool, // Whether the checkbox is shown\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  'data-testid': PropTypes.string\n}\n\nInputItem.defaultProps = {\n  labelPlacement: 'end'\n}\n\nexport default InputItem\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\nimport { Typography, makeStyles } from '@material-ui/core'\n\n/**\n * Indicates that no input options are available with the current query\n * settings.\n */\nconst useStyles = makeStyles(theme => ({\n  root: {\n    fontStyle: 'italic',\n    color: theme.palette.text.disabled\n  }\n}))\nexport default function InputUnavailable({className}) {\n  const styles = useStyles()\n  return <Typography className={clsx(className, styles.root)}>\n    No options available with current query.\n  </Typography>\n}\n\nInputUnavailable.propTypes = {\n  className: PropTypes.string\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useCallback, useEffect, useState, useMemo } from 'react'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\nimport { useRecoilValue } from 'recoil'\nimport InputHeader from './InputHeader'\nimport InputTooltip from './InputTooltip'\nimport InputItem, { inputItemHeight } from './InputItem'\nimport InputUnavailable from './InputUnavailable'\nimport Placeholder from '../../visualization/Placeholder'\nimport { formatLabel } from '../../../utils'\nimport { useSearchContext } from '../SearchContext'\nimport { isNil } from 'lodash'\nimport Pagination from '../../visualization/Pagination'\nimport { guiState } from '../../GUIMenu'\nimport { InputTextQuantity } from './InputText'\n\n/**\n * Generic input component that can be configured to fit several use cases. The\n * most typical configufations are:\n * - Smallish, fixed number of options: do not show search field, use\n *   metainfo/explicit options to always show the options.\n * - Large amount of options which are not unique to entries: show search field\n *   and a subset of options sorted by their occurrence.\n * - Large amount of options which are unique for each entry: only show search field.\n */\nconst useStyles = makeStyles(theme => ({\n  root: {\n    width: '100%',\n    display: 'flex',\n    alignItems: 'flex-start',\n    justifyContent: 'center',\n    flexDirection: 'column',\n    boxSizing: 'border-box'\n  },\n  container: {\n    width: '100%'\n  },\n  grid: {\n    width: '100%',\n    display: 'grid',\n    gridAutoFlow: 'column'\n  },\n  progress: {\n    marginLeft: theme.spacing(0.5)\n  },\n  textField: {\n    marginBottom: theme.spacing(1)\n  }\n}))\nconst InputField = React.memo(({\n  quantity,\n  label,\n  description,\n  visible,\n  xs,\n  initialScale,\n  initialSize,\n  increment,\n  disableStatistics,\n  disableSearch,\n  disableOptions,\n  disableSuggestions,\n  formatLabels,\n  className,\n  classes,\n  'data-testid': testID\n}) => {\n  const theme = useTheme()\n  const {\n    filterData,\n    useAgg,\n    useAggCall,\n    useFilterState,\n    useIsStatisticsEnabled\n  } = useSearchContext()\n  const isStatisticsEnabled = useIsStatisticsEnabled()\n  const styles = useStyles({classes: classes, theme: theme})\n  const [visibleOptions, setVisibleOptions] = useState()\n  const aggIndicator = useRecoilValue(guiState('aggIndicator'))\n  const aggCollapse = useRecoilValue(guiState('aggCollapse'))\n  const [scale, setScale] = useState(initialScale || filterData[quantity]?.scale || 'linear')\n  disableStatistics = isNil(disableStatistics) ? !isStatisticsEnabled : disableStatistics\n\n  // See if the filter has a fixed amount of options. These may have been\n  // explicitly provided or defined in the metainfo. If you explicitly specify\n  // an initialSize, any fixed options are ignored and the data is retrieved\n  // through an aggregation (this is done because the top aggregations may not\n  // match the list of explicit options).\n  const fixedOptions = useMemo(() => {\n    return isNil(initialSize)\n      ? filterData[quantity]?.options\n      : undefined\n  }, [initialSize, filterData, quantity])\n  const nFixedOptions = fixedOptions && Object.keys(fixedOptions).length\n  const minSize = disableOptions ? 0 : initialSize || nFixedOptions || filterData[quantity]?.aggs?.terms?.size\n  const placeholder = filterData[quantity]?.placeholder || \"Type here\"\n  const [requestedAggSize, setRequestedAggSize] = useState(minSize)\n  const incr = useState(increment || minSize)[0]\n  const [loading, setLoading] = useState(false)\n  const aggConfig = useMemo(() => {\n    const config = {type: 'terms', size: minSize}\n    // If a fixed list of options is used, we must restrict the aggregation\n    // return values with 'include'. Otherwise the returned results may not\n    // contain the correct values.\n    const options = filterData[quantity]?.options\n    if (options) config.include = Object.keys(options)\n    return config\n  }, [minSize, filterData, quantity])\n  const agg = useAgg(quantity, visible && !disableOptions && !(disableStatistics && fixedOptions), 'scroll', aggConfig)\n  const aggCall = useAggCall(quantity, 'scroll')\n  const receivedAggSize = agg?.data?.length\n  const [filter, setFilter] = useFilterState(quantity)\n  const unavailable = disableOptions ? false : !(agg?.data && agg.data.length > 0)\n  const disabled = unavailable\n\n  // Form the final list of options. If no fixed options are available, the\n  // options are gathered from the aggregation.\n  const finalOptions = useMemo(() => {\n    if (fixedOptions) {\n      return fixedOptions\n    }\n    if (agg?.data) {\n      const opt = {}\n      const maxSize = Math.min(requestedAggSize, agg.data.length)\n      for (let i = 0; i < maxSize; ++i) {\n        const value = agg.data[i]\n        opt[value.value] = {label: value.value}\n      }\n      return opt\n    }\n    return {}\n  }, [fixedOptions, agg, requestedAggSize])\n\n  // Modify the checkboxes according to changing filters, changing aggregation\n  // results or change in the available options.\n  useEffect(() => {\n    const opt = {}\n    for (const [key, value] of Object.entries(finalOptions)) {\n      opt[key] = {\n        checked: filter ? filter.has(key) : false,\n        label: formatLabels ? formatLabel(value.label) : value.label,\n        disabled: !disableStatistics\n      }\n    }\n    if (agg?.data) {\n      for (const value of agg.data) {\n        const key = value.value\n        const selected = filter ? filter.has(key) : false\n        const oldState = opt[key]\n        const disabled = selected ? false : value.count === 0\n        if (oldState) {\n          oldState.count = value.count\n          oldState.disabled = disabled\n        }\n      }\n    }\n    setVisibleOptions(opt)\n  }, [agg, filter, finalOptions, disableStatistics, formatLabels])\n\n  // Show more values\n  const handleShowMore = useCallback(() => {\n    setLoading(true)\n    let newSize = requestedAggSize + incr\n    aggCall({type: 'terms', size: newSize}, (response) => {\n      if (response?.data?.length === requestedAggSize) {\n        newSize = requestedAggSize\n      }\n      setLoading(false)\n      setRequestedAggSize(newSize)\n    })\n  }, [aggCall, incr, requestedAggSize])\n\n  // Show less values\n  const handleShowLess = useCallback(() => {\n    setRequestedAggSize(old => {\n      const newSize = Math.max(old - incr, minSize)\n      aggCall({type: 'terms', size: newSize}, () => {})\n      return newSize\n    })\n  }, [aggCall, incr, minSize])\n\n  // Handle changes in the selected values\n  const handleChange = useCallback((event, key, selected) => {\n    const newOptions = {...visibleOptions}\n    newOptions[key].checked = selected\n    const checked = Object.entries(newOptions)\n      .filter(([key, value]) => value.checked)\n      .map(([key, value]) => key)\n    setFilter(new Set(checked))\n  }, [setFilter, visibleOptions])\n\n  // Create the search component\n  const searchComponent = useMemo(() => {\n    return disableSearch\n      ? null\n      : <InputTooltip unavailable={unavailable}>\n        <div className={styles.container}>\n          <InputTextQuantity\n            className={styles.textField}\n            quantity={quantity}\n            disabled={disabled}\n            disableSuggestions={disableSuggestions}\n            placeholder={placeholder}\n            fullWidth\n          />\n        </div>\n      </InputTooltip>\n  }, [disableSearch, unavailable, styles, quantity, disabled, disableSuggestions, placeholder])\n\n  // Create the options component\n  const optionsComponent = useMemo(() => {\n    if (disableOptions) {\n      return\n    }\n\n    const nItems = agg ? Object.keys(finalOptions).length : minSize\n    const didNotReceiveMore = isNil(receivedAggSize) ? false : receivedAggSize < requestedAggSize\n    const noMoreAvailable = isNil(nFixedOptions) ? false : requestedAggSize >= nFixedOptions\n    const hide = didNotReceiveMore || noMoreAvailable\n    const showMore = fixedOptions\n      ? false\n      : !hide\n    const showLess = fixedOptions\n      ? false\n      : (requestedAggSize - incr >= minSize)\n\n    const nRows = Math.ceil(nItems * xs / 12)\n    const actionsHeight = 34\n    let reservedHeight\n    if (aggCollapse === 'on') {\n      const itemHeight = nRows * inputItemHeight\n      const actionHeight = (showMore || showLess) ? actionsHeight : 0\n      reservedHeight = nItems > 0 ? (itemHeight + actionHeight) : undefined\n    } else if (aggCollapse === 'off') {\n      const itemHeight = Math.max(minSize * xs / 12, nRows) * inputItemHeight\n      const allLoaded = !isNil(nFixedOptions) && initialSize >= nFixedOptions\n      const actionHeight = (fixedOptions || allLoaded) ? 0 : actionsHeight\n      reservedHeight = itemHeight + actionHeight\n    }\n\n    const max = agg ? Math.max(...agg.data.map(option => option.count)) : 0\n    const items = visibleOptions && <div\n      className={styles.grid}\n      style={{gridTemplateRows: `repeat(${nRows}, 1fr)`}}\n    >\n      {Object.entries(visibleOptions).map(([key, value]) => (\n        <InputItem\n          key={key}\n          value={key}\n          label={value.label}\n          selected={value.checked}\n          disabled={value.disabled}\n          disableStatistics={disableStatistics}\n          onChange={handleChange}\n          variant=\"checkbox\"\n          max={max}\n          count={value.count}\n          scale={scale}\n        />\n      ))}\n    </div>\n\n    const noMore = agg?.exhausted && receivedAggSize === requestedAggSize\n    let aggComp\n    if (fixedOptions) {\n      aggComp = items\n    } else if (receivedAggSize === 0) {\n      aggComp = <InputUnavailable/>\n    } else if (!agg && aggIndicator === 'on') {\n      aggComp = <Placeholder\n        variant=\"rect\"\n        data-testid={`${testID}-placeholder`}\n        margin={0}\n      />\n    } else {\n      aggComp = <>\n        {items}\n        <Pagination\n          showMore={showMore}\n          showLess={showLess}\n          disableMore={noMore}\n          loadingMore={loading}\n          marginTop={0.5}\n          onLess={handleShowLess}\n          onMore={handleShowMore}\n        />\n      </>\n    }\n    return <div className={styles.container} style={{height: reservedHeight}}>\n      {aggComp}\n    </div>\n  }, [\n    disableOptions,\n    disableStatistics,\n    agg,\n    finalOptions,\n    minSize,\n    fixedOptions,\n    receivedAggSize,\n    requestedAggSize,\n    incr,\n    xs,\n    aggCollapse,\n    visibleOptions,\n    styles,\n    aggIndicator,\n    initialSize,\n    handleChange,\n    scale,\n    handleShowMore,\n    handleShowLess,\n    loading,\n    nFixedOptions,\n    testID\n  ]\n  )\n\n  return <div className={clsx(className, styles.root)} data-testid={testID}>\n    <InputHeader\n      quantity={quantity}\n      label={label}\n      description={description}\n      scale={scale}\n      onChangeScale={setScale}\n      disableStatistics={disableStatistics}\n    />\n    {searchComponent}\n    {optionsComponent}\n  </div>\n})\n\nInputField.propTypes = {\n  quantity: PropTypes.string.isRequired,\n  label: PropTypes.string,\n  description: PropTypes.string,\n  visible: PropTypes.bool,\n  xs: PropTypes.number,\n  initialScale: PropTypes.number, // The initial statistics scaling\n  initialSize: PropTypes.number, // The initial maximum number of items to load\n  increment: PropTypes.number, // The amount of new items to load on 'show more'\n  disableStatistics: PropTypes.bool, // Whether to disable statistics\n  disableSearch: PropTypes.bool, // Whether to show the search field\n  disableOptions: PropTypes.bool, // Whether to show the options gathered through aggregations\n  disableSuggestions: PropTypes.bool, // Whether to disable the text field suggestions\n  formatLabels: PropTypes.bool, // Whether to reformat the options labels\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  'data-testid': PropTypes.string\n}\n\nInputField.defaultProps = {\n  xs: 12\n}\n\nexport default InputField\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport clsx from 'clsx'\nimport { makeStyles } from '@material-ui/core/styles'\nimport PropTypes from 'prop-types'\n\n/**\n * Tick used in plots.\n */\nconst usePlotTickStyles = makeStyles(theme => ({\n  root: {\n    backgroundColor: theme.palette.grey[500]\n  }\n}))\nconst PlotTick = React.memo(({\n  length,\n  thickness,\n  orientation,\n  className,\n  classes,\n  'data-testid': testID\n}) => {\n  const styles = usePlotTickStyles(classes)\n  return <div\n    className={clsx(className, styles.root)}\n    style={orientation === 'vertical'\n      ? {width: length, height: thickness}\n      : {width: thickness, height: length}\n    }\n    data-testid={testID}\n  />\n})\n\nPlotTick.propTypes = {\n  length: PropTypes.number,\n  thickness: PropTypes.number,\n  orientation: PropTypes.oneOf(['horizontal', 'vertical']),\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  'data-testid': PropTypes.string\n}\n\nPlotTick.defaultProps = {\n  length: 6,\n  thickness: 1\n}\n\nexport default PlotTick\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport clsx from 'clsx'\nimport { Typography } from '@material-ui/core'\nimport { makeStyles } from '@material-ui/core/styles'\nimport PropTypes from 'prop-types'\nimport PlotTick from './PlotTick'\n\n/**\n * Label used in plots.\n */\nconst usePlotLabelStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex',\n    alignItems: 'center'\n  },\n  horizontal: {\n    justifyContent: 'flex-start',\n    alignItems: 'center',\n    flexDirection: 'column-reverse',\n    transform: 'translateX(-50%)'\n  },\n  vertical: {\n    flexDirection: 'row',\n    justifyContent: 'flex-end',\n    transform: 'translateY(50%)'\n  },\n  label: {\n    lineHeight: 1,\n    flexShrink: 0,\n    flexGrow: 0\n  },\n  tick: {\n    flexShrink: 0,\n    flexGrow: 0\n  }\n}))\n\nconst PlotLabel = React.memo(({\n  label,\n  size,\n  labelPadding,\n  tickLength,\n  orientation,\n  className,\n  classes,\n  'data-testid': testID\n}) => {\n  const styles = usePlotLabelStyles(classes)\n  return <div className={clsx(className, styles[orientation], styles.root)} data-testid={testID}>\n    <Typography\n      className={styles.label}\n      style={{fontSize: size}}\n      noWrap\n    >{label}\n    </Typography>\n    <div style={{flex: `0 0 ${labelPadding}px`}} />\n    <PlotTick\n      className={styles.label}\n      length={tickLength}\n      orientation={orientation}\n    />\n  </div>\n})\n\nPlotLabel.propTypes = {\n  label: PropTypes.string,\n  size: PropTypes.number,\n  labelPadding: PropTypes.number,\n  tickLength: PropTypes.number,\n  orientation: PropTypes.oneOf(['horizontal', 'vertical']),\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  'data-testid': PropTypes.string\n}\n\nPlotLabel.defaultProps = {\n  size: 6,\n  labelPadding: 3,\n  orientation: 'horizontal'\n}\n\nexport default PlotLabel\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useMemo } from 'react'\nimport clsx from 'clsx'\nimport { format } from 'date-fns'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { isArray, isNil } from 'lodash'\nimport { useResizeDetector } from 'react-resize-detector'\nimport { getScaler, getTicks } from './common'\nimport { formatNumber, DType } from '../../utils'\nimport PlotLabel from './PlotLabel'\nimport PlotTick from './PlotTick'\nimport PropTypes from 'prop-types'\n\n/**\n * Represents a plot axis. Can be oriented to fit different sides of a plot\n * using the placement argument.\n */\nconst usePlotAxisStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex',\n    position: 'relative',\n    overflow: 'hidden'\n  },\n  left: {\n    flexDirection: 'row',\n    height: '100%'\n  },\n  bottom: {\n    flexDirection: 'column-reverse',\n    width: '100%'\n  },\n  labelContainer: {\n    position: 'relative'\n  },\n  labelPositioner: {\n    position: 'absolute'\n  },\n  topTick: {\n    position: 'absolute',\n    top: 0,\n    right: 0\n  },\n  verticalAxis: {\n    position: 'absolute',\n    width: 1,\n    right: 0,\n    backgroundColor: theme.palette.grey[500]\n  },\n  horizontalAxis: {\n    position: 'absolute',\n    height: 1,\n    top: 0,\n    backgroundColor: theme.palette.grey[500]\n  }\n}))\n\nconst PlotAxis = React.memo(({\n  min,\n  max,\n  dtype,\n  mode,\n  decimals,\n  scale,\n  labels,\n  labelHeight,\n  labelWidth,\n  placement,\n  tickLength,\n  labelPadding,\n  overflowLeft,\n  overflowRight,\n  overflowTop,\n  overflowBottom,\n  className,\n  classes,\n  'data-testid': testID}) => {\n  const styles = usePlotAxisStyles(classes)\n  const {height, width, ref} = useResizeDetector()\n  const orientation = {\n    left: 'vertical',\n    bottom: 'horizontal'\n  }[placement]\n  const axisSize = orientation === 'vertical'\n    ? height\n    : width\n  const labelSize = (orientation === 'vertical'\n    ? labelHeight\n    : labelWidth)\n\n  // Determine the correct scaler\n  const scaler = useMemo(\n    () => getScaler(scale, [min, max], [0, axisSize])\n  , [scale, min, max, axisSize])\n\n  // Determine styles that depend on overflow values\n  overflowBottom = isNil(overflowBottom) ? 8 : overflowBottom\n  overflowTop = isNil(overflowTop) ? (placement === 'bottom' ? 0 : 8) : overflowTop\n  overflowLeft = isNil(overflowLeft) ? (placement === 'bottom' ? 0 : 8) : overflowLeft\n  overflowRight = isNil(overflowRight) ? (placement === 'left' ? 0 : 8) : overflowRight\n  const rootStyle = useMemo(() => {\n    return {\n      marginTop: -overflowTop,\n      paddingTop: overflowTop,\n      marginBottom: -overflowBottom,\n      paddingBottom: overflowBottom,\n      marginRight: -overflowRight,\n      paddingRight: overflowRight,\n      marginLeft: -overflowLeft,\n      paddingLeft: overflowLeft\n    }\n  }, [overflowBottom, overflowLeft, overflowRight, overflowTop])\n  const axisStyle = useMemo(() => {\n    let axisStyle\n    if (placement === 'left') {\n      axisStyle = {\n        top: overflowTop,\n        bottom: overflowBottom - 1\n      }\n    } else if (placement === 'bottom') {\n      axisStyle = {\n        left: overflowLeft - 1,\n        right: overflowRight - 1\n      }\n    }\n    return axisStyle\n  }, [overflowBottom, overflowLeft, overflowRight, overflowTop, placement])\n\n  const labelList = useMemo(() => {\n    if (!axisSize) {\n      return []\n    }\n\n    // Function for formatting ticks\n    const formatTick = (value) => {\n      return dtype === DType.Timestamp\n        ? format(value, 'MMM d')\n        : formatNumber(value, dtype, mode, decimals)\n    }\n\n    // Manual ticks\n    if (isArray(labels)) {\n      return labels.map((tick) => ({...tick, label: formatTick(tick.label), pos: scaler(tick.pos) / axisSize}))\n    }\n\n    // On linear and log axes, the labels are spaced evenly, and the number of\n    // labels is calculated from the available space. On non-linearly spaced\n    // axes, we calculate the number of labels with formula:\n    // axisSize - scaler(max - (max-min) / nLabels) = labelSize\n    // -> nLabels = (max-min) / (max - scaler.invert(axisSize - labelSize)\n    const padding = 10\n    let nItems = (scale === 'linear' || scale === 'log')\n      ? Math.floor(axisSize / (labelSize + padding))\n      : Math.floor((max - min) / (max - scaler.invert(axisSize - (labelSize + padding))))\n\n    // At least two labels should be attempted to be shown\n    nItems = Math.max(2, nItems)\n\n    // If the scale length is zero, show only one tick\n    if (min === max) {\n      return [{\n        label: formatTick(min),\n        pos: 0\n      }]\n    }\n\n    // Get reasonable, human-readable ticks. the .ticks function from d3-scale\n    // does not guarantee an upper limit to the number of ticks, so it cannot be\n    // directly used.\n    return getTicks(min, max, nItems, scale, dtype, mode, decimals)\n      .map(({tick, value}) => {\n        return {\n          label: tick,\n          pos: scaler(value) / axisSize\n        }\n      })\n  }, [axisSize, dtype, labelSize, labels, max, min, scaler, mode, decimals, scale])\n\n  // Here we estimate the maximum label width. This is a relatively simple\n  // approximattion calculated using the font size. A more reliable way would to\n  // to actually render to label and measure it's size on the DOM, but this is\n  // more expensive.\n  const finalLabelWidth = useMemo(() => {\n    if (labelWidth) {\n      return labelWidth\n    }\n    const maxCharacters = labelList?.length\n      ? Math.max(...labelList.map(label => label.label.length))\n      : 0\n    const width = tickLength + labelPadding + maxCharacters * 0.56 * labelHeight\n    return width\n  }, [labelWidth, labelList, tickLength, labelPadding, labelHeight])\n\n  return <div\n    ref={ref}\n    className={clsx(className, styles[placement], styles.root)}\n    data-testid={testID || `plot-axis-${placement}`}\n    style={rootStyle}\n  >\n    <div\n      className={styles.labelContainer}\n      style={orientation === 'vertical'\n        ? {width: finalLabelWidth, height: '100%'}\n        : {height: labelHeight + labelPadding + tickLength, width: '100%'}\n      }\n    >\n      {labelList.map(({pos, label}, i) => <div\n        key={i}\n        className={styles.labelPositioner}\n        style={orientation === 'vertical'\n          ? {bottom: `${pos * 100}%`, right: 0}\n          : {left: `${pos * 100}%`, top: 0}\n        }\n      >\n        <PlotLabel\n          label={label}\n          labelPadding={labelPadding}\n          size={labelHeight}\n          tickLength={tickLength}\n          orientation={orientation}\n        />\n      </div>)}\n      {orientation === 'vertical' && <div className={styles.topTick}>\n        <PlotTick orientation={orientation} length={tickLength}/>\n      </div>}\n    </div>\n    <div className={styles[`${orientation}Axis`]} style={axisStyle}/>\n  </div>\n})\n\nPlotAxis.propTypes = {\n  min: PropTypes.number,\n  max: PropTypes.number,\n  scale: PropTypes.string,\n  mode: PropTypes.oneOf(['scientific', 'SI', 'standard']),\n  decimals: PropTypes.number,\n  labels: PropTypes.array,\n  placement: PropTypes.oneOf(['left', 'bottom']),\n  labelHeight: PropTypes.number,\n  labelWidth: PropTypes.number,\n  labelPadding: PropTypes.number,\n  overflowTop: PropTypes.number,\n  overflowBottom: PropTypes.number,\n  overflowLeft: PropTypes.number,\n  overflowRight: PropTypes.number,\n  tickLength: PropTypes.number,\n  dtype: PropTypes.string,\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  'data-testid': PropTypes.string\n}\n\nPlotAxis.defaultProps = {\n  labelHeight: 12,\n  tickLength: 6,\n  labelPadding: 3,\n  scale: 'linear',\n  scientific: true, // Whether to use scientific notation, e.g. 1e+3\n  siPostfix: false, // Whether to use SI postfixes, e.g. K, M, B\n  decimals: 3 // How many decimals to show for custom labels\n}\n\nexport default PlotAxis\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useCallback, useMemo } from 'react'\nimport clsx from 'clsx'\nimport { clamp } from 'lodash'\nimport { Tooltip } from '@material-ui/core/'\nimport { makeStyles } from '@material-ui/core/styles'\nimport PropTypes from 'prop-types'\n\n/**\n * Bar within a plot.\n */\nconst usePlotAxisStyles = makeStyles(theme => ({\n  root: {\n    position: 'absolute',\n    cursor: 'pointer',\n    height: '100%',\n    paddingLeft: '1px',\n    paddingRight: '1px'\n  },\n  container: {\n    position: 'relative',\n    width: '100%',\n    height: '100%'\n  },\n  rectangle: {\n    width: '100%',\n    height: '100%',\n    '-webkit-transform': 'none',\n    transform: 'none',\n    transition: 'transform 250ms',\n    transformOrigin: 'bottom left',\n    willChange: 'transform',\n    backgroundColor: theme.palette.primary.veryLight,\n    position: 'relatives'\n  },\n  highlight: {\n    position: 'absolute',\n    top: 0,\n    bottom: 0,\n    backgroundColor: theme.palette.secondary.veryLight\n  }\n}))\n\nconst PlotBar = React.memo(({\n  startX,\n  endX,\n  startY,\n  endY,\n  selected,\n  tooltip,\n  onClick,\n  className,\n  classes,\n  'data-testid': testID}) => {\n  const styles = usePlotAxisStyles(classes)\n\n  const handleClick = useCallback((event) => {\n    onClick && onClick(event)\n  }, [onClick])\n\n  const highlightStyle = useMemo(() => {\n    if (selected === false) {\n      return {visibility: 'hidden'}\n    }\n    if (selected === true) {\n      return {\n        left: '0%',\n        right: '0%'\n      }\n    }\n    return {\n      left: `${clamp(selected[0] * 100, 0, 100)}%`,\n      right: `${clamp((1 - selected[1]) * 100, 0, 100)}%`\n    }\n  }, [selected])\n\n  return <div\n    onClick={handleClick}\n    className={clsx(className, styles.root)}\n    style={{left: `${startX * 100}%`, right: `${(1 - endX) * 100}%`}}\n    data-testid={testID}\n  >\n    <Tooltip placement=\"bottom\" enterDelay={0} leaveDelay={0} title={tooltip || ''} arrow>\n      <div className={styles.container}>\n        <div className={styles.rectangle} style={{transform: `scaleY(${endY - startY})`}}>\n          <div\n            className={styles.highlight}\n            style={highlightStyle}/>\n        </div>\n      </div>\n    </Tooltip>\n  </div>\n})\n\nPlotBar.propTypes = {\n  startX: PropTypes.number,\n  endX: PropTypes.number,\n  startY: PropTypes.number,\n  endY: PropTypes.number,\n  /* The selection as a boolean, or as a range. The range is given as two\n   * percentages indicate the start and end of the selection. */\n  selected: PropTypes.oneOfType([PropTypes.bool, PropTypes.arrayOf(PropTypes.number)]),\n  tooltip: PropTypes.string,\n  onClick: PropTypes.func,\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  'data-testid': PropTypes.string\n}\n\nPlotBar.defaultProps = {\n}\n\nexport default PlotBar\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useRef, useMemo, useCallback } from 'react'\nimport clsx from 'clsx'\nimport { range as rangeLodash, isNil, clamp } from 'lodash'\nimport { useRecoilValue } from 'recoil'\nimport { Slider, InputAdornment } from '@material-ui/core'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { KeyboardDateTimePicker } from '@material-ui/pickers'\nimport { pluralize, formatInteger, DType } from '../../utils'\nimport { Quantity } from '../units/Quantity'\nimport InputUnavailable from '../search/input/InputUnavailable'\nimport { InputTextField } from '../search/input/InputText'\nimport Placeholder from '../visualization/Placeholder'\nimport PlotAxis from './PlotAxis'\nimport PlotBar from './PlotBar'\nimport FilterTitle from '../search/FilterTitle'\nimport { guiState } from '../GUIMenu'\nimport PropTypes from 'prop-types'\nimport { getScaler } from './common'\nimport { dateFormat } from '../../config'\n\n/**\n * An interactive histogram for numeric values.\n */\nconst useStyles = makeStyles(theme => ({\n  root: {\n    width: '100%',\n    height: '100%',\n    boxSizing: 'border-box'\n  },\n  container: {\n    width: '100%',\n    height: '100%',\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'center',\n    justifyContent: 'center'\n  },\n  histogram: {\n    width: '100%',\n    height: '100%'\n  },\n  overflow: {\n    flex: '1 1 auto',\n    width: '100%',\n    height: '100%'\n  },\n  grid: {\n    width: '100%',\n    height: '100%',\n    boxSizing: 'border-box',\n    display: 'grid',\n    gridTemplateColumns: 'auto 1fr',\n    gridTemplateRows: '1fr auto',\n    paddingRight: theme.spacing(0.75),\n    paddingBottom: theme.spacing(0.25)\n  },\n  plot: {\n    gridColumn: 2,\n    gridRow: 1,\n    position: 'relative'\n  },\n  canvas: {\n    width: '100%',\n    height: '100%',\n    position: 'relative',\n    overflow: 'hidden'\n  },\n  slider: {\n    zIndex: 10,\n    position: 'absolute',\n    bottom: -14,\n    left: 0,\n    right: 0\n  },\n  yaxis: {\n    gridColumn: 1,\n    gridRow: 1,\n    height: '100%'\n  },\n  square: {\n    gridColumn: 1,\n    gridRow: 2\n  },\n  xaxis: {\n    gridColumn: 2,\n    gridRow: 2\n  },\n  inputField: {\n    marginTop: 0,\n    marginBottom: 0,\n    flexGrow: 1,\n    minWidth: '6.1rem',\n    maxWidth: '8.5rem'\n  },\n  inputFieldDate: {\n    maxWidth: '15rem'\n  },\n  thumb: {\n    '&:active': {\n      boxShadow: '0px 0px 0px 12px rgb(0, 141, 195, 16%)'\n    },\n    '&:focusVisible': {\n      boxShadow: '0px 0px 0px 6px rgb(0, 141, 195, 16%)'\n    }\n  },\n  title: {\n    flexGrow: 1,\n    marginLeft: theme.spacing(0.5),\n    marginRight: theme.spacing(0.5)\n  },\n  // The following two styles are needed in order for the TextInput to\n  // transition from having a label to not having a label. The MUI component\n  // does not otherwise transition correctly.\n  inputMargin: {\n    paddingTop: 10,\n    paddingBottom: 11\n  },\n  adornment: {\n    marginTop: '0px !important'\n  },\n  spacer: {\n    height: '3rem',\n    flex: '1 1 100%',\n    paddingLeft: '18px',\n    paddingRight: '18px',\n    display: 'flex',\n    alignItems: 'center'\n  },\n  row: {\n    marginTop: theme.spacing(0.25),\n    width: '100%',\n    display: 'flex',\n    flexDirection: 'row',\n    justifyContent: 'center',\n    alignItems: 'flex-start'\n  }\n}))\nconst PlotHistogram = React.memo(({\n  xAxis,\n  yAxis,\n  bins,\n  range,\n  step,\n  nBins,\n  discretization,\n  dtypeY,\n  disabled,\n  tooltipLabel,\n  highlight,\n  disableSlider,\n  onRangeChange,\n  onRangeCommit,\n  onMinChange,\n  onMaxChange,\n  onMinBlur,\n  onMaxBlur,\n  onMinSubmit,\n  onMaxSubmit,\n  onClick,\n  minXInclusive,\n  maxXInclusive,\n  className,\n  classes,\n  showinput,\n  minError,\n  maxError,\n  minInput,\n  maxInput,\n  minLocal,\n  maxLocal,\n  stepSlider,\n  disableHistogram,\n  disableXTitle,\n  'data-testid': testID\n}) => {\n  const styles = useStyles(classes)\n  const useDynamicStyles = makeStyles((theme) => {\n    const color = highlight ? theme.palette.secondary.main : theme.palette.primary.main\n    return {\n      thumb: {\n        'border': `2px solid ${color}`,\n        '&[data-index=\"0\"]': {\n          backgroundColor: minXInclusive ? color : 'white'\n        },\n        '&[data-index=\"1\"]': {\n          backgroundColor: maxXInclusive ? color : 'white'\n        }\n      }\n    }\n  })\n  const dynamicStyles = useDynamicStyles()\n\n  const aggIndicator = useRecoilValue(guiState('aggIndicator'))\n  const oldRangeRef = useRef()\n  const artificialRange = 1\n  const isArtificial = !step && bins?.length === 1\n  const isTime = xAxis.dtype === DType.Timestamp\n  step = isArtificial ? artificialRange / nBins : step\n\n  // Determine the final maximum of x-axis. If the values are discrete, the\n  // maximum x value needs to be increased.\n  let maxX = isArtificial ? xAxis.min + artificialRange : xAxis.max\n  if (discretization) {\n    if (!isNil(maxX)) {\n      maxX += step\n    }\n  }\n\n  // Determine the final bin data and the y axis limits.\n  const [finalBins, minY, maxY] = useMemo(() => {\n    if (isNil(bins)) {\n      return [null, null, null]\n    }\n    const minY = 0\n    const maxY = Math.max(...bins.map(item => item.count))\n    const scaler = getScaler(yAxis.scale, [minY, maxY])\n    const finalBins = bins.map((bucket) => {\n      return {\n        ...bucket,\n        start: bucket.value,\n        end: bucket.value + step,\n        scale: scaler(bucket.count)\n      }\n    })\n    return [finalBins, minY, maxY]\n  }, [bins, step, yAxis.scale])\n\n  // Transforms the original range into an internal range used for\n  // visualization.\n  const toInternalRange = useCallback((range) => {\n    return (discretization && !isNil(range?.[1]))\n      ? [range[0], range[1] + step]\n      : range\n  }, [discretization, step])\n\n  // Transforms the internal range into the original range.\n  const toExternalRange = useCallback((range) => {\n    return (discretization && !isNil(range?.[1]))\n      ? [range[0], range[1] - step]\n      : range\n  }, [discretization, step])\n\n  const rangeInternal = useMemo(() => {\n    return toInternalRange([range?.gte, range?.lte])\n  }, [range, toInternalRange])\n\n  // Turns the internal range values back to the external counterparts before\n  // sending the event.\n  const handleRangeCommit = useCallback((event, range) => {\n    onRangeCommit && onRangeCommit(event, toExternalRange(range))\n  }, [onRangeCommit, toExternalRange])\n\n  // Handle clicks on the histogram bins\n  const handleClick = useCallback((event, item) => {\n    onClick && onClick(event, isArtificial\n      ? [item.start, item.start]\n      : [item.start, discretization ? item.start : item.end])\n  }, [isArtificial, onClick, discretization])\n\n  // Turns the internal range values back to the external counterparts before\n  // sending the event.\n  const handleRangeChange = useCallback((event, range) => {\n    if (!onRangeChange) {\n      return\n    }\n    range = toExternalRange(range)\n    // Check if the value has actually changed: MUI Slider does not do this\n    // automatically.\n    if (oldRangeRef.current &&\n      oldRangeRef.current[0] === range[0] &&\n      oldRangeRef.current[1] === range[1]) {\n      return\n    }\n    oldRangeRef.current = range\n    onRangeChange(event, range)\n  }, [onRangeChange, toExternalRange])\n\n  // Calculates the selection value for a bin.\n  const calculateSelection = useCallback((bin, range) => {\n    if (!highlight) {\n      return false\n    }\n    if (isArtificial) {\n      return bin.start === rangeInternal[0]\n    }\n    const interval = bin.end - bin.start\n    const min = clamp((range[0] - bin.start) / interval, 0, 1)\n    const max = clamp((range[1] - bin.start) / interval, 0, 1)\n    const size = max - min\n    if (size <= 0) {\n      return false\n    }\n    if (min <= 0 && max >= 1) {\n      return true\n    }\n    return [min, max]\n  }, [highlight, isArtificial, rangeInternal])\n\n  // Create the plot once items are ready\n  const plot = useMemo(() => {\n    if (isNil(finalBins) || isNil(xAxis.min) || isNil(maxX)) {\n      return null\n    }\n    return <div className={styles.canvas}>\n      {Object.values(finalBins).map((item, i) => {\n        return <PlotBar\n          startX={(item.start - xAxis.min) / (maxX - xAxis.min)}\n          endX={(item.end - xAxis.min) / (maxX - xAxis.min)}\n          startY={0}\n          endY={item.scale}\n          key={i}\n          tooltip={`${formatInteger(item.count)} ${pluralize(tooltipLabel, item.count, false)}`}\n          vertical\n          disableValue\n          selected={calculateSelection(item, rangeInternal)}\n          onClick={(event) => handleClick(event, item)}\n        />\n      })}\n    </div>\n  }, [finalBins, xAxis.min, maxX, styles.canvas, calculateSelection, rangeInternal, handleClick, tooltipLabel])\n\n  // Create x-axis once axis range is ready\n  const xaxis = useMemo(() => {\n    if (isNil(finalBins) || isNil(xAxis.min) || isNil(maxX)) {\n      return null\n    }\n    let labels\n\n    // One bin is shown for the artificial values\n    if (isArtificial) {\n      const offset = discretization ? 0.5 * step : 0\n      labels = [{\n        label: finalBins[0].start,\n        pos: finalBins[0].start + offset\n      }]\n    // Discrete values get label at the center of the bin.\n    } else if (discretization) {\n      const start = step * Math.ceil(xAxis.min / step)\n      const end = step * Math.floor(maxX / step)\n      labels = rangeLodash(start, end).map(x => ({\n        label: x,\n        pos: x + 0.5 * step\n      }))\n    }\n\n    const min = new Quantity(xAxis.min, xAxis.unitStorage).to(xAxis.unit).value()\n    const max = new Quantity(maxX, xAxis.unitStorage).to(xAxis.unit).value()\n\n    return <PlotAxis\n      placement=\"bottom\"\n      min={min}\n      max={max}\n      mode=\"scientific\"\n      labels={labels}\n      labelWidth={45}\n      overflowLeft={25}\n      dtype={xAxis.dtype}\n      className={styles.xaxis}\n    />\n  }, [finalBins, xAxis.min, xAxis.unitStorage, maxX, discretization, isArtificial, xAxis.dtype, styles.xaxis, xAxis.unit, step])\n\n  const [minAdornment, maxAdornment] = useMemo(() => {\n    return disableHistogram\n      ? [undefined, undefined]\n      : [\n      {\n        startAdornment: <InputAdornment\n          position=\"start\"\n          classes={{positionStart: styles.adornment}}\n        >min:</InputAdornment>,\n        classes: {inputMarginDense: styles.inputMargin}\n      },\n      {\n        startAdornment: <InputAdornment\n          position=\"start\"\n          classes={{positionStart: styles.adornment}}\n        >max:</InputAdornment>,\n        classes: {inputMarginDense: styles.inputMargin}\n      }\n    ]\n  }, [disableHistogram, styles])\n\n  // Determine the min input component\n  let inputMinField\n  if (xAxis.dtype === DType.Timestamp) {\n    inputMinField = <KeyboardDateTimePicker\n      error={!!minError}\n      disabled={disabled}\n      helperText={minError}\n      ampm={false}\n      className={clsx(styles.inputField, styles.inputFieldDate)}\n      variant=\"inline\"\n      inputVariant=\"filled\"\n      label=\"Start time\"\n      format={`${dateFormat} kk:mm`}\n      value={minInput}\n      invalidDateMessage=\"\"\n      InputAdornmentProps={{ position: 'end' }}\n      onAccept={(date) => {\n        onMinChange(date)\n        onMinSubmit(date)\n      }}\n      onChange={onMinChange}\n      onBlur={onMinBlur}\n      onKeyDown={(event) => { if (event.key === 'Enter') { onMinSubmit(minInput) } }}\n    />\n  } else {\n    inputMinField = <InputTextField\n      error={!!minError}\n      disabled={disabled}\n      helperText={minError}\n      className={styles.inputField}\n      InputProps={minAdornment}\n      label={disableHistogram ? 'min' : ' '}\n      value={minInput}\n      onChange={onMinChange}\n      onBlur={onMinBlur}\n      onKeyDown={(event) => { if (event.key === 'Enter') { onMinSubmit(minInput) } }}\n    />\n  }\n\n  // Determine the max input component\n  let inputMaxField\n  if (xAxis.dtype === DType.Timestamp) {\n    inputMaxField = <KeyboardDateTimePicker\n      error={!!maxError}\n      disabled={disabled}\n      helperText={maxError}\n      ampm={false}\n      className={clsx(styles.inputField, styles.inputFieldDate)}\n      variant=\"inline\"\n      inputVariant=\"filled\"\n      label=\"End time\"\n      format={`${dateFormat} kk:mm`}\n      value={maxInput}\n      invalidDateMessage=\"\"\n      InputAdornmentProps={{ position: 'end' }}\n      onAccept={(date) => {\n        onMaxChange(date)\n        onMaxSubmit(date)\n      }}\n      onChange={onMaxChange}\n      onBlur={onMaxBlur}\n      onKeyDown={(event) => { if (event.key === 'Enter') { onMaxSubmit(maxInput) } }}\n    />\n  } else {\n    inputMaxField = <InputTextField\n      error={!!maxError}\n      disabled={disabled}\n      helperText={maxError}\n      className={styles.inputField}\n      InputProps={maxAdornment}\n      label={disableHistogram ? 'max' : ' '}\n      value={maxInput}\n      onChange={onMaxChange}\n      onBlur={onMaxBlur}\n      onKeyDown={(event) => { if (event.key === 'Enter') { onMaxSubmit(maxInput) } }}\n    />\n  }\n\n  // Create y-axis once axis range is ready.\n  const yaxis = useMemo(() => {\n    if (isNil(minY) || isNil(maxY)) {\n      return null\n    }\n    return <PlotAxis\n      placement=\"left\"\n      min={minY}\n      max={maxY}\n      mode='SI'\n      scale={yAxis.scale}\n      dtype={dtypeY}\n      className={styles.yaxis}\n    />\n  }, [dtypeY, maxY, minY, yAxis.scale, styles.yaxis])\n\n  // Determine the final component to show.\n  let histComp\n  if (bins?.length === 0) {\n    histComp = <InputUnavailable/>\n  } else if (isNil(bins) && aggIndicator === 'on') {\n    histComp = <Placeholder\n      variant=\"rect\"\n      data-testid={`${testID}-placeholder`}\n      margin={0}\n    />\n  } else {\n    histComp = <div className={styles.overflow}>\n      <div className={styles.grid}>\n        {yaxis}\n        <div className={styles.plot}>\n          {plot}\n          {!disableSlider &&\n            <Slider\n              disabled={disabled || isArtificial || (maxX - xAxis.min) === discretization}\n              color={highlight ? 'secondary' : 'primary'}\n              min={xAxis.min}\n              max={maxX}\n              step={step}\n              value={rangeInternal}\n              onChange={handleRangeChange}\n              onChangeCommitted={handleRangeCommit}\n              valueLabelDisplay=\"off\"\n              classes={{thumb: styles.thumb && dynamicStyles.thumb}}\n              className={styles.slider}\n            />\n          }\n        </div>\n        <div className={styles.square} />\n        {xaxis}\n      </div>\n  </div>\n  }\n\n  const titleComp = <div className={styles.title}>\n    <FilterTitle\n      quantity={xAxis.quantity}\n      label={xAxis.title}\n      unit={xAxis.unit}\n      variant=\"caption\"\n      className={styles.titletext}\n      noWrap={false}\n    />\n  </div>\n\n  return <div className={clsx(className, styles.root)} data-testid={testID}>\n    <div className={styles.container}>\n      {!disableHistogram && <div className={clsx(styles.histogram, classes?.histogram)}>{histComp}</div>}\n      {!disableXTitle && titleComp}\n      <div className={styles.row}>\n        {showinput\n          ? <>\n            {inputMinField}\n            {(disableHistogram && !isTime)\n              ? <div className={styles.spacer}>\n                  <Slider\n                    disabled={disabled || (minLocal === maxLocal)}\n                    color={highlight ? 'secondary' : 'primary'}\n                    min={minLocal}\n                    max={maxLocal}\n                    step={stepSlider}\n                    value={[range.gte, range.lte]}\n                    onChange={onRangeChange}\n                    onChangeCommitted={onRangeCommit}\n                    valueLabelDisplay=\"off\"\n                  />\n                </div>\n              : <div className={styles.title} />\n            }\n            {inputMaxField}\n            </>\n          : null\n        }\n      </div>\n    </div>\n  </div>\n})\n\nPlotHistogram.propTypes = {\n  xAxis: PropTypes.object,\n  yAxis: PropTypes.object,\n  /* The bins data to show. */\n  bins: PropTypes.arrayOf(PropTypes.shape({\n    value: PropTypes.number,\n    count: PropTypes.number\n  })),\n  range: PropTypes.object,\n  step: PropTypes.number,\n  /* The number of bins: required only when showing a dummy bin for histograms\n   * that have no width. */\n  nBins: PropTypes.number,\n  /* Discretization of the values. */\n  discretization: PropTypes.number,\n  dtypeY: PropTypes.string,\n  disabled: PropTypes.bool,\n  /* The label to show for the tooltips */\n  tooltipLabel: PropTypes.string,\n  /* Whether the selected region should be highlighted */\n  highlight: PropTypes.bool,\n  /* Disable the intervative slider shown on top of the plot */\n  disableSlider: PropTypes.bool,\n  /* Function to call when a histogram bar has been clicked */\n  onClick: PropTypes.func,\n  /* Whether the min slider is inclusive (=min value is included) */\n  minXInclusive: PropTypes.bool,\n  /* Whether the max slider is inclusive (=max value is included) */\n  maxXInclusive: PropTypes.bool,\n  showInput: PropTypes.bool,\n  onRangeChange: PropTypes.func,\n  onRangeCommit: PropTypes.func,\n  onMinChange: PropTypes.func,\n  onMaxChange: PropTypes.func,\n  onMinSubmit: PropTypes.func,\n  onMaxSubmit: PropTypes.func,\n  showinput: PropTypes.bool,\n  maxError: PropTypes.any,\n  minError: PropTypes.any,\n  maxInput: PropTypes.any,\n  minInput: PropTypes.any,\n  maxLocal: PropTypes.any,\n  minLocal: PropTypes.any,\n  stepSlider: PropTypes.any,\n  disableHistogram: PropTypes.bool,\n  disableXTitle: PropTypes.bool,\n  onMinBlur: PropTypes.func,\n  onMaxBlur: PropTypes.func,\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  'data-testid': PropTypes.string\n}\n\nexport default PlotHistogram\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useCallback, useMemo } from 'react'\nimport PropTypes from 'prop-types'\nimport { useSearchContext } from '../SearchContext'\nimport { Widget } from './Widget'\nimport { ActionCheckbox, ActionSelect } from '../../Actions'\nimport { Range } from '../input/InputRange'\nimport { scales } from '../../plotting/common'\nimport {getDisplayLabel} from '../../../utils'\nimport { Unit } from '../../units/Unit'\nimport { useUnitContext } from '../../units/UnitContext'\n\n/**\n * Displays a histogram widget.\n */\nexport const autorangeDescription = 'Automatically center the view on the data'\nexport const WidgetHistogram = React.memo((\n{\n  id,\n  title,\n  description,\n  x,\n  y,\n  nbins,\n  autorange,\n  showinput,\n  className\n}) => {\n  const { filterData, useSetWidget } = useSearchContext()\n  const {units} = useUnitContext()\n  const setWidget = useSetWidget(id)\n\n  // Create final axis config for the plot\n  const xAxis = useMemo(() => {\n    const xFilter = filterData[x.quantity]\n    const xTitle = x.title || getDisplayLabel(xFilter)\n    const xType = xFilter?.dtype\n    const xUnit = x.unit\n      ? new Unit(x.unit)\n      : new Unit(xFilter.unit || 'dimensionless').toSystem(units)\n\n    return {\n      ...x,\n      title: xTitle,\n      unit: xUnit,\n      dtype: xType\n    }\n  }, [filterData, x, units])\n\n  const handleEdit = useCallback(() => {\n    setWidget(old => { return {...old, editing: true } })\n  }, [setWidget])\n\n  const handleChangeScale = useCallback((value) => {\n    setWidget(old => { return {...old, y: {...old.y, scale: value}} })\n  }, [setWidget])\n\n  return <Widget\n    id={id}\n    title={title || 'Histogram'}\n    description={description}\n    onEdit={handleEdit}\n    className={className}\n    actions={<>\n      <ActionCheckbox\n        tooltip={autorangeDescription}\n        label=\"autorange\"\n        value={autorange}\n        onChange={(value) => setWidget(old => ({...old, autorange: value}))}\n      />\n      <ActionSelect\n        value={y.scale}\n        options={scales}\n        tooltip=\"Statistics scaling\"\n        onChange={handleChangeScale}\n      />\n    </>}\n  >\n    <Range\n      xAxis={xAxis}\n      yAxis={y}\n      visible={true}\n      nBins={nbins}\n      anchored={true}\n      autorange={autorange}\n      showinput={showinput}\n      aggId={id}\n    />\n  </Widget>\n})\n\nWidgetHistogram.propTypes = {\n  id: PropTypes.string.isRequired,\n  title: PropTypes.string,\n  description: PropTypes.string,\n  x: PropTypes.object,\n  y: PropTypes.object,\n  nbins: PropTypes.number,\n  autorange: PropTypes.bool,\n  showinput: PropTypes.bool,\n  className: PropTypes.string\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useState, useMemo, useCallback, useEffect, useRef, useContext } from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\nimport { isNil } from 'lodash'\nimport InputHeader from './InputHeader'\nimport { inputSectionContext } from './InputSection'\nimport { Quantity } from '../../units/Quantity'\nimport { Unit } from '../../units/Unit'\nimport { useUnitContext } from '../../units/UnitContext'\nimport { DType, formatNumber } from '../../../utils'\nimport { getInterval } from '../../plotting/common'\nimport { useSearchContext } from '../SearchContext'\nimport PlotHistogram from '../../plotting/PlotHistogram'\nimport { isValid, getTime } from 'date-fns'\nimport { ActionCheckbox } from '../../Actions'\nimport { autorangeDescription } from '../widgets/WidgetHistogram'\n\n/*\n * Component for displaying a numerical range as a slider/histogram together\n * with query input possibility.\n */\nconst useStyles = makeStyles(theme => ({\n  root: {\n    width: '100%',\n    height: '100%'\n  },\n  histogram: {\n  }\n}))\nexport const Range = React.memo(({\n  xAxis,\n  yAxis,\n  nSteps,\n  visible,\n  nBins,\n  disableHistogram,\n  disableXTitle,\n  autorange,\n  showinput,\n  aggId,\n  className,\n  classes,\n  'data-testid': testID\n}) => {\n  const {filterData, useAgg, useFilterState, useIsStatisticsEnabled} = useSearchContext()\n  const sectionContext = useContext(inputSectionContext)\n  const repeats = sectionContext?.repeats\n  const isStatisticsEnabled = useIsStatisticsEnabled()\n  const styles = useStyles({classes})\n  const [filter, setFilter] = useFilterState(xAxis.quantity)\n  const [minLocal, setMinLocal] = useState()\n  const [maxLocal, setMaxLocal] = useState()\n  const [plotData, setPlotData] = useState({xAxis, yAxis})\n  const loading = useRef(false)\n  const firstRender = useRef(true)\n  const validRange = useRef()\n  const rangeChanged = useRef(false)\n  const minInputChanged = useRef(false)\n  const maxInputChanged = useRef(false)\n  const [range, setRange] = useState({gte: undefined, lte: undefined})\n  const [minError, setMinError] = useState(false)\n  const [maxError, setMaxError] = useState(false)\n  const [minInclusive, setMinInclusive] = useState(true)\n  const [maxInclusive, setMaxInclusive] = useState(true)\n  const highlight = Boolean(filter)\n  disableHistogram = isNil(disableHistogram) ? !isStatisticsEnabled : disableHistogram\n\n  // Determine the description and units\n  const def = filterData[xAxis.quantity]\n  const unitStorage = useMemo(() => { return new Unit(def?.unit || 'dimensionless') }, [def])\n  const discretization = xAxis.dtype === DType.Int ? 1 : undefined\n  const isTime = xAxis.dtype === DType.Timestamp\n  const firstLoad = useRef(true)\n\n  // We need to set a valid initial input state: otherwise the component thinks\n  // it is uncontrolled.\n  const [minInput, setMinInput] = useState(isTime ? new Date() : '')\n  const [maxInput, setMaxInput] = useState(isTime ? new Date() : '')\n\n  // Function for converting filter values into storage units used by the API.\n  const fromDisplayUnit = useCallback(filter => {\n    return filter instanceof Quantity\n      ? filter.to(unitStorage).value()\n      : filter\n  }, [unitStorage])\n\n  // Function for converting filter values from storage unit to display unit\n  const fromStorageUnit = useCallback(filter => {\n    return (isTime)\n      ? filter\n      : filter instanceof Quantity\n        ? filter.to(unitStorage)\n        : new Quantity(filter, unitStorage)\n  }, [unitStorage, isTime])\n\n  // Function for converting filter values from display unit to storage unit\n  const toStorageUnit = useCallback(filter => {\n    return (isTime)\n      ? filter\n      : filter instanceof Quantity\n        ? filter.to(unitStorage)\n        : new Quantity(filter, xAxis.unit).to(unitStorage)\n  }, [isTime, xAxis.unit, unitStorage])\n\n  // Aggregation when the statistics are enabled: a histogram aggregation with\n  // extended bounds based on the currently set filter range. Note: the config\n  // should be memoed in order to prevent re-renders.\n  const minRef = useRef(fromDisplayUnit(isNil(filter?.gte) ? filter?.gt : filter?.gte))\n  const maxRef = useRef(fromDisplayUnit(isNil(filter?.lte) ? filter?.lt : filter?.lte))\n  const aggHistogramConfig = useMemo(() => {\n    const filterBounds = (filter) ? {\n      min: fromDisplayUnit(isNil(filter.gte) ? filter.gt : filter.gte),\n      max: fromDisplayUnit(isNil(filter.lte) ? filter.lt : filter.lte)\n    } : undefined\n    let exclude_from_search\n    let extended_bounds\n    // Extended bounds are always applied on the first load but with no\n    // filtering.\n    if (firstLoad.current) {\n      extended_bounds = filterBounds\n      exclude_from_search = true\n    } else {\n      // Is zoom is not disabled, the current filter defines the histogram\n      // boundary.\n      if (autorange) {\n        extended_bounds = filterBounds\n        exclude_from_search = false\n      } else {\n        // Is zoom is disabled and filter is outside the old boundary, the\n        // filter defines the new boundary and filter is active.\n        const outOfBounds = filter ? (filterBounds.min < minRef.current || filterBounds.max > maxRef.current) : false\n        if (outOfBounds) {\n          extended_bounds = filterBounds\n          exclude_from_search = false\n        } else {\n          // Is zoom is disabled and filter is within the old boundary, and the\n          // global boundary, the old boundary is kept.\n          extended_bounds = filter\n            ? (isNil(minRef.current) ? undefined : {min: minRef.current, max: maxRef.current})\n            : undefined\n          exclude_from_search = true\n        }\n      }\n    }\n    return (isTime || !discretization)\n      ? {type: 'histogram', buckets: nBins, exclude_from_search, extended_bounds}\n      : {type: 'histogram', interval: discretization, exclude_from_search, extended_bounds}\n  }, [filter, fromDisplayUnit, isTime, discretization, nBins, autorange])\n  const agg = useAgg(xAxis.quantity, visible && !disableHistogram, `${aggId}_histogram`, aggHistogramConfig)\n  useEffect(() => {\n    if (!isNil(agg)) {\n      firstLoad.current = false\n    }\n  }, [agg])\n\n  // Aggregation when the statistics are disabled: a simple min_max aggregation\n  // is enough in order to get the slider range.\n  const aggSliderConfig = useMemo(() => ({type: 'min_max', exclude_from_search: true}), [])\n  const aggSlider = useAgg(xAxis.quantity, visible && disableHistogram, `${aggId}_slider`, aggSliderConfig)\n\n  // Determine the global minimum and maximum values\n  const [minGlobal, maxGlobal] = useMemo(() => {\n    let minGlobal\n    let maxGlobal\n    if (disableHistogram) {\n      minGlobal = aggSlider?.data?.[0]\n      maxGlobal = aggSlider?.data?.[1]\n    } else {\n      const nBuckets = agg?.data?.length || 0\n      if (nBuckets === 1) {\n        minGlobal = agg.data[0].value\n        maxGlobal = minGlobal\n      } else if (nBuckets > 1) {\n        for (const bucket of agg.data) {\n          if (isNil(minGlobal)) {\n            minGlobal = bucket.value\n          }\n          maxGlobal = bucket.value + (discretization ? 0 : agg.interval)\n        }\n        if (isNil(minGlobal)) {\n          minGlobal = agg.data[0].value\n        }\n        if (isNil(maxGlobal)) {\n          maxGlobal = agg.data[agg.data.length - 1].value + (discretization ? 0 : agg.interval)\n        }\n      }\n    }\n    firstRender.current = false\n    return [minGlobal, maxGlobal]\n  }, [agg, aggSlider, disableHistogram, discretization])\n\n  const stepHistogram = agg?.interval\n  const unavailable = isNil(minGlobal) || isNil(maxGlobal) || isNil(range)\n  const disabled = unavailable\n\n  // Determine the step value for sliders. Notice that this does not have to\n  // match with the histogram binning, and that we want to do call the\n  // getInterval function on the display unit range.\n  const stepSlider = useMemo(() => {\n    if (discretization) {\n      return discretization\n    }\n    if (isNil(maxLocal) || isNil(minLocal)) {\n      return undefined\n    }\n    const rangeSI = maxLocal - minLocal\n    const range = new Quantity(rangeSI, unitStorage.toDelta()).to(xAxis.unit).value()\n    const intervalCustom = getInterval(range, nSteps, xAxis.dtype)\n    return new Quantity(intervalCustom, xAxis.unit).to(unitStorage).value()\n  }, [maxLocal, minLocal, discretization, nSteps, xAxis.dtype, xAxis.unit, unitStorage])\n\n  // When filter changes, the plot data should not be updated.\n  useEffect(() => {\n    if (autorange) loading.current = true\n  }, [filter, autorange])\n\n  // Once the aggregation data arrives, the plot data can be updated.\n  useEffect(() => {\n    if (!isNil(agg)) {\n      loading.current = false\n    }\n  }, [agg])\n\n  // We refresh the plot information only when all of the data is updated.\n  // Essentially this syncs the axis limits and data so that they are updated\n  // simultaneously.\n  useEffect(() => {\n    if (loading.current || isNil(agg?.data)) {\n      return\n    }\n\n    setPlotData({\n      xAxis: {\n        quantity: xAxis.quantity,\n        unit: xAxis.unit,\n        unitStorage: unitStorage,\n        dtype: xAxis.dtype,\n        title: xAxis.title,\n        min: minLocal,\n        max: maxLocal\n      },\n      yAxis,\n      step: stepHistogram,\n      data: agg.data\n    })\n  }, [loading, nBins, agg, minLocal, maxLocal, stepHistogram, unitStorage, xAxis.quantity, xAxis.unit, xAxis.dtype, xAxis.title, xAxis.scale, yAxis])\n\n  // Function for converting search values into the currently selected unit\n  // system.\n  const toInternal = useCallback(filter => {\n    return (!isTime && unitStorage)\n      ? formatNumber(new Quantity(filter, unitStorage).to(xAxis.unit).value())\n      : filter\n  }, [unitStorage, isTime, xAxis.unit])\n\n  // If no filter has been specified by the user, the range is automatically\n  // adjusted according to global min/max of the field. If filter is set, the\n  // slider value is set according to it.\n  useEffect(() => {\n    let lte\n    let gte\n    let min\n    let max\n    let minInc = true\n    let maxInc = true\n\n    // Helper functions for determining the min/max boundaries.\n    const limit = (global, filter, min) => {\n      const func = min ? Math.min : Math.max\n      if (autorange) {\n        return filter\n      } else {\n        return func(global, filter)\n      }\n    }\n    const limitMin = (global, filter) => limit(global, filter, true)\n    const limitMax = (global, filter) => limit(global, filter, false)\n\n    if (!isNil(minGlobal) && !isNil(maxGlobal)) {\n      // When no filter is set, use the whole available range\n      if (isNil(filter)) {\n        gte = minGlobal\n        lte = maxGlobal\n        min = minGlobal\n        max = maxGlobal\n      // A single specific value is given\n      } else if (filter instanceof Quantity) {\n        gte = filter.to(unitStorage).value()\n        lte = filter.to(unitStorage).value()\n        min = limitMin(minGlobal, gte)\n        max = limitMax(maxGlobal, lte)\n      // A range is given. For visualization purposes open-ended queries are\n      // displayed as well, although making such queries is currently not\n      // supported.\n      } else {\n        minInc = isNil(filter.gt)\n        maxInc = isNil(filter.lt)\n        gte = filter.gte || filter.gt\n        lte = filter.lte || filter.lt\n        gte = gte instanceof Quantity ? gte.to(unitStorage).value() : gte\n        lte = lte instanceof Quantity ? lte.to(unitStorage).value() : lte\n\n        if (isNil(gte)) {\n          min = limitMin(minGlobal, lte)\n          gte = min\n        } else {\n          min = limitMin(minGlobal, gte)\n        }\n        if (isNil(lte)) {\n          max = limitMax(maxGlobal, gte)\n          lte = max\n        } else {\n          max = limitMax(maxGlobal, lte)\n        }\n      }\n      minRef.current = min\n      maxRef.current = max\n      setMinInclusive(minInc)\n      setMaxInclusive(maxInc)\n      setMinLocal(min)\n      setMaxLocal(max)\n      setRange({gte: gte, lte: lte})\n      setMinInput(toInternal(gte))\n      setMaxInput(toInternal(lte))\n      setMaxError()\n      setMinError()\n    }\n  }, [minGlobal, maxGlobal, filter, unitStorage, toInternal, def, isTime, autorange])\n\n  // Returns whether the given range is an acceptable value to be queried and\n  // displayed.\n  const validateRange = useCallback((range) => {\n    if (isTime) {\n      return range[1] - range[0] >= 60000\n    }\n    return true\n  }, [isTime])\n\n  // Handles changes in the min input\n  const handleMinChange = useCallback((value) => {\n    if (autorange) loading.current = true\n    let val\n    if (isTime) {\n      value.setSeconds(0, 0)\n      val = getTime(value)\n    } else {\n      val = value.target?.value\n    }\n    minInputChanged.current = true\n    setMinInput(val)\n    setMaxError()\n    setMinError()\n  }, [isTime, autorange])\n\n  // Handles changes in the max input\n  const handleMaxChange = useCallback((value) => {\n    if (autorange) loading.current = true\n    loading.current = true\n    let val\n    if (isTime) {\n      value.setSeconds(0, 0)\n      val = getTime(value)\n    } else {\n      val = value.target?.value\n    }\n    maxInputChanged.current = true\n    setMaxInput(val)\n    setMaxError()\n    setMinError()\n  }, [isTime, autorange])\n\n  // Called when min values are submitted through the input field\n  const handleMinSubmit = useCallback((value) => {\n    let error\n    if (isTime) {\n      if (!isValid(value)) {\n        error = 'Invalid start date.'\n      } else {\n        value = getTime(value)\n      }\n    } else {\n      const number = Number.parseFloat(value)\n      if (isNaN(number)) {\n        error = 'Invalid minimum value.'\n      } else {\n        value = toStorageUnit(number)\n      }\n    }\n    if ((isTime ? value : value.value) > range.lte) {\n      error = 'Cannot be larger than maximum value.'\n    }\n    if (error) {\n      setMinError(error)\n    } else {\n      minInputChanged.current = false\n      setFilter(old => {\n        return {\n          gte: value,\n          lte: fromStorageUnit(isNil(old?.lte) ? maxLocal : old.lte)\n        }\n      })\n    }\n  }, [isTime, setFilter, fromStorageUnit, toStorageUnit, maxLocal, range])\n\n  // Called when max values are submitted through the input field\n  const handleMaxSubmit = useCallback((value) => {\n    let error\n    if (isTime) {\n      if (!isValid(value)) {\n        error = 'Invalid end date.'\n      } else {\n        value = getTime(value)\n      }\n    } else {\n      const number = Number.parseFloat(value)\n      if (isNaN(number)) {\n        error = 'Invalid maximum value.'\n      } else {\n        value = toStorageUnit(number)\n      }\n    }\n    if ((isTime ? value : value.value) < range.gte) {\n      error = 'Cannot be smaller than minimum value.'\n    }\n    if (error) {\n      setMaxError(error)\n    } else {\n      maxInputChanged.current = false\n      setFilter(old => {\n        return {\n          gte: fromStorageUnit(isNil(old?.gte) ? minLocal : old.gte),\n          lte: value\n        }\n      })\n    }\n  }, [isTime, setFilter, fromStorageUnit, toStorageUnit, minLocal, range])\n\n  // Handle range commit: Set the filter when mouse is released on a slider.\n  // Notice that we cannot rely on the value given by the slider event: it may\n  // correspond to a non-valid range. Instead we need to use the latest valid\n  // value saved when the value has changed.\n  const handleRangeCommit = useCallback((event) => {\n    const value = validRange.current\n    if (!isNil(value) && rangeChanged.current) {\n      setFilter({\n        gte: fromStorageUnit(value[0]),\n        lte: fromStorageUnit(value[1])\n      })\n      rangeChanged.current = false\n    }\n  }, [setFilter, fromStorageUnit])\n\n  // Handle range change: only change the rendered values, filter is send with\n  // handleRangeCommit.\n  const handleRangeChange = useCallback((event, value, validate = true) => {\n    if (autorange) loading.current = true\n    const valid = !validate || validateRange(value)\n    if (valid) {\n      rangeChanged.current = true\n      validRange.current = value\n      setRange({gte: value[0], lte: value[1]})\n      setMinInput(toInternal(value[0]))\n      setMaxInput(toInternal(value[1]))\n      setMinInclusive(true)\n      setMaxInclusive(true)\n      setMaxError()\n      setMinError()\n    }\n  }, [validateRange, validRange, toInternal, autorange])\n\n  // Handle min input field blur: only if the input has changed, the filter will\n  // be submitted.\n  const handleMinBlur = useCallback(() => {\n    minInputChanged.current && handleMinSubmit(minInput)\n  }, [minInput, handleMinSubmit, minInputChanged])\n\n  // Handle max input field blur: only if the input has changed, the filter will\n  // be submitted.\n  const handleMaxBlur = useCallback(() => {\n    maxInputChanged.current && handleMaxSubmit(maxInput)\n  }, [maxInput, handleMaxSubmit, maxInputChanged])\n\n  return <div className={clsx(className, styles.root)} data-testid={testID}>\n    <PlotHistogram\n      bins={plotData?.data}\n      xAxis={plotData?.xAxis}\n      yAxis={plotData?.yAxis}\n      step={plotData?.step}\n      minXInclusive={minInclusive}\n      maxXInclusive={maxInclusive}\n      disabled={disabled}\n      nBins={nBins}\n      range={range}\n      highlight={highlight}\n      discretization={discretization}\n      tooltipLabel={repeats ? 'value' : 'entry'}\n      dtypeY={DType.Int}\n      onRangeChange={handleRangeChange}\n      onRangeCommit={handleRangeCommit}\n      onMinBlur={handleMinBlur}\n      onMaxBlur={handleMaxBlur}\n      onMinChange={handleMinChange}\n      onMaxChange={handleMaxChange}\n      onMinSubmit={handleMinSubmit}\n      onMaxSubmit={handleMaxSubmit}\n      classes={{histogram: classes?.histogram}}\n      onClick={(event, value) => {\n        handleRangeChange(event, value, false)\n        handleRangeCommit(event, value)\n      }}\n      minError={minError}\n      maxError={maxError}\n      minInput={minInput}\n      maxInput={maxInput}\n      minLocal={minLocal}\n      maxLocal={maxLocal}\n      showinput={showinput}\n      stepSlider={stepSlider}\n      disableHistogram={disableHistogram}\n      disableXTitle={disableXTitle}\n      data-testid={`${testID}-histogram`}\n    />\n  </div>\n})\n\nRange.propTypes = {\n  xAxis: PropTypes.object,\n  yAxis: PropTypes.object,\n  /* Target number of steps for the slider that is shown when statistics are\n   * disabled. The actual number may vary, as the step is chosen to be a\n   * human-readable value that depends on the range and the unit. */\n  nSteps: PropTypes.number,\n  /* Number of bins for the histogram (and the slider) when statistics are\n   * enabled. */\n  nBins: PropTypes.number,\n  visible: PropTypes.bool,\n  /* Whether the histogram is disabled */\n  disableHistogram: PropTypes.bool,\n  /* Whether the x title is disabled */\n  disableXTitle: PropTypes.bool,\n  /* Set the range automatically according to data. */\n  autorange: PropTypes.bool,\n  /* Show the input fields for min and max value */\n  showinput: PropTypes.bool,\n  aggId: PropTypes.string,\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  'data-testid': PropTypes.string\n}\n\nRange.defaultProps = {\n  nSteps: 20,\n  nBins: 30,\n  aggId: 'default',\n  'data-testid': 'inputrange'\n}\n\n/**\n * A small wrapper around Range for use in the filter menus.\n */\nconst useInputRangeStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex',\n    flexDirection: 'column'\n  },\n  histogram: {\n    height: '8rem'\n  }\n}))\nconst InputRange = React.memo(({\n  label,\n  quantity,\n  description,\n  nSteps,\n  visible,\n  initialScale,\n  nBins,\n  disableHistogram,\n  initialAutorange,\n  aggId,\n  className,\n  'data-testid': testID\n}) => {\n  const {filterData} = useSearchContext()\n  const {units} = useUnitContext()\n  const styles = useInputRangeStyles()\n  const [scale, setScale] = useState(initialScale || filterData[quantity].scale)\n  const dtype = filterData[quantity].dtype\n  const isTime = dtype === DType.Timestamp\n  const [autorange, setAutorange] = useState(isNil(initialAutorange) ? isTime : initialAutorange)\n  const x = useMemo(() => (\n    {\n      quantity,\n      dtype,\n      unit: new Unit(filterData[quantity]?.unit || 'dimensionless').toSystem(units)\n    }\n  ), [quantity, filterData, dtype, units])\n  const y = useMemo(() => ({scale: scale}), [scale])\n\n  // Determine the description and title\n  const def = filterData[quantity]\n  const descFinal = description || def?.description || ''\n  const labelFinal = label || def?.label\n\n  // Component for enabling/disabling autorange\n  const actions = <ActionCheckbox\n    value={autorange}\n    label=\"zoom\"\n    tooltip={autorangeDescription}\n    onChange={(value) => setAutorange(value)}\n  />\n\n  return <div className={clsx(styles.root, className)}>\n    <InputHeader\n      label={labelFinal}\n      quantity={quantity}\n      description={descFinal}\n      scale={scale}\n      onChangeScale={setScale}\n      disableStatistics={disableHistogram}\n      actions={actions}\n    />\n    <Range\n      xAxis={x}\n      yAxis={y}\n      nSteps={nSteps}\n      visible={visible}\n      nBins={nBins}\n      disableHistogram={disableHistogram}\n      disableXTitle\n      autorange={autorange}\n      showinput\n      aggId={aggId}\n      classes={{histogram: styles.histogram}}\n      data-testid={testID}\n    />\n  </div>\n})\n\nInputRange.propTypes = {\n  label: PropTypes.string,\n  quantity: PropTypes.string.isRequired,\n  description: PropTypes.string,\n  nSteps: PropTypes.number,\n  nBins: PropTypes.number,\n  visible: PropTypes.bool,\n  initialScale: PropTypes.string,\n  disableHistogram: PropTypes.bool,\n  initialAutorange: PropTypes.bool,\n  aggId: PropTypes.string,\n  className: PropTypes.string,\n  'data-testid': PropTypes.string\n}\n\nInputRange.defaultProps = {\n  nSteps: 20,\n  nBins: 30,\n  aggId: 'default',\n  'data-testid': 'inputrange'\n}\n\nexport default InputRange\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { FilterSubMenu, filterMenuContext } from './FilterMenu'\nimport { InputGrid, InputGridItem } from '../input/InputGrid'\nimport InputPeriodicTable from '../input/InputPeriodicTable'\nimport InputField from '../input/InputField'\nimport InputRange from '../input/InputRange'\n\nconst useStyles = makeStyles(theme => ({\n  grid: {\n    marginTop: theme.spacing(2)\n  },\n  periodicTable: {\n    height: '30rem'\n  }\n}))\n\nconst FilterSubMenuElements = React.memo(({\n  id,\n  ...rest\n}) => {\n  const {selected, open} = useContext(filterMenuContext)\n  const visible = open && id === selected\n  const styles = useStyles()\n\n  return <FilterSubMenu id={id} {...rest}>\n    <InputGrid className={styles.grid}>\n      <InputGridItem xs={12}>\n        <InputPeriodicTable\n          quantity=\"results.material.elements\"\n          visible={visible}\n          className={styles.periodicTable}\n        />\n      </InputGridItem>\n      <InputGridItem xs={6}>\n        <InputField\n          quantity=\"results.material.chemical_formula_hill\"\n          visible={visible}\n          disableOptions\n        />\n      </InputGridItem>\n      <InputGridItem xs={6}>\n        <InputField\n          quantity=\"results.material.chemical_formula_iupac\"\n          visible={visible}\n          disableOptions\n        />\n      </InputGridItem>\n      <InputGridItem xs={6}>\n        <InputField\n          quantity=\"results.material.chemical_formula_reduced\"\n          visible={visible}\n          disableOptions\n        />\n      </InputGridItem>\n      <InputGridItem xs={6}>\n        <InputField\n          quantity=\"results.material.chemical_formula_anonymous\"\n          visible={visible}\n          placeholder=\"E.g. A2B, A3B2\"\n          disableOptions\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputRange\n          quantity=\"results.material.n_elements\"\n          visible={visible}\n          step={1}\n        />\n      </InputGridItem>\n    </InputGrid>\n  </FilterSubMenu>\n})\nFilterSubMenuElements.propTypes = {\n  id: PropTypes.string\n}\n\nexport default FilterSubMenuElements\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { FilterSubMenu, filterMenuContext } from './FilterMenu'\nimport { InputGrid, InputGridItem } from '../input/InputGrid'\nimport InputField from '../input/InputField'\n\nconst FilterSubMenuStructure = React.memo(({\n  id,\n  ...rest\n}) => {\n  const {selected, open} = useContext(filterMenuContext)\n  const visible = open && id === selected\n\n  return <FilterSubMenu id={id} {...rest}>\n    <InputGrid>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.material.structural_type\"\n          visible={visible}\n          disableSearch\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.material.symmetry.bravais_lattice\"\n          visible={visible}\n          xs={6}\n          disableSearch\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.material.symmetry.crystal_system\"\n          visible={visible}\n          xs={12}\n          disableSearch\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.material.symmetry.space_group_symbol\"\n          visible={visible}\n          disableOptions\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.material.symmetry.structure_name\"\n          visible={visible}\n          initialSize={5}\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.material.symmetry.strukturbericht_designation\"\n          visible={visible}\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.material.symmetry.point_group\"\n          visible={visible}\n          disableOptions\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.material.symmetry.hall_symbol\"\n          visible={visible}\n          disableOptions\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.material.symmetry.prototype_aflow_id\"\n          visible={visible}\n          disableOptions\n        />\n      </InputGridItem>\n    </InputGrid>\n  </FilterSubMenu>\n})\nFilterSubMenuStructure.propTypes = {\n  id: PropTypes.string\n}\n\nexport default FilterSubMenuStructure\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { FilterSubMenu, filterMenuContext } from './FilterMenu'\nimport { InputGrid, InputGridItem } from '../input/InputGrid'\nimport InputField from '../input/InputField'\n\nconst FilterSubMenuMethod = React.memo(({\n  id,\n  ...rest\n}) => {\n  const {selected, open} = useContext(filterMenuContext)\n  const visible = open && id === selected\n\n  return <FilterSubMenu id={id} {...rest}>\n    <InputGrid spacing={2}>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.method.simulation.program_name\"\n          visible={visible}\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.method.simulation.program_version\"\n          visible={visible}\n          disableOptions\n        />\n      </InputGridItem>\n    </InputGrid>\n  </FilterSubMenu>\n})\nFilterSubMenuMethod.propTypes = {\n  id: PropTypes.string\n}\n\nexport default FilterSubMenuMethod\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { FilterSubMenu, filterMenuContext } from './FilterMenu'\nimport { InputGrid, InputGridItem } from '../input/InputGrid'\nimport InputField from '../input/InputField'\nimport InputRange from '../input/InputRange'\n\nconst FilterSubMenuPrecision = React.memo(({\n  id,\n  ...rest\n}) => {\n  const {selected, open} = useContext(filterMenuContext)\n  const visible = open && id === selected\n\n  return <FilterSubMenu id={id} {...rest}>\n    <InputGrid>\n      <InputGridItem xs={12}>\n        <InputRange\n          quantity=\"results.method.simulation.precision.k_line_density\"\n          visible={visible}\n          xs={12}\n          disableSearch\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.method.simulation.precision.native_tier\"\n          visible={visible}\n          xs={12}\n          disableOptions\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.method.simulation.precision.basis_set\"\n          visible={visible}\n          xs={12}\n          disableSearch\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputRange\n          quantity=\"results.method.simulation.precision.planewave_cutoff\"\n          visible={visible}\n          xs={12}\n          disableSearch\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputRange\n          quantity=\"results.method.simulation.precision.apw_cutoff\"\n          visible={visible}\n          xs={12}\n          disableSearch\n        />\n      </InputGridItem>\n    </InputGrid>\n  </FilterSubMenu>\n})\nFilterSubMenuPrecision.propTypes = {\n  id: PropTypes.string\n}\n\nexport default FilterSubMenuPrecision\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { FilterSubMenu, filterMenuContext } from './FilterMenu'\nimport { InputGrid, InputGridItem } from '../input/InputGrid'\nimport InputField from '../input/InputField'\nimport InputRange from '../input/InputRange'\nimport { InputCheckboxValue } from '../input/InputCheckbox'\n\nconst FilterSubMenuDFT = React.memo(({\n  id,\n  ...rest\n}) => {\n  const {selected, open} = useContext(filterMenuContext)\n  const visible = open && id === selected\n\n  return <FilterSubMenu\n    id={id}\n    actions={<InputCheckboxValue\n      quantity=\"results.method.method_name\"\n      value=\"DFT\"\n      description=\"Search DFT entries\"\n    />}\n    {...rest}\n  >\n    <InputGrid>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.method.simulation.dft.xc_functional_type\"\n          visible={visible}\n          xs={12}\n          disableSearch\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.method.simulation.dft.xc_functional_names\"\n          visible={visible}\n          xs={12}\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputRange\n          quantity=\"results.method.simulation.dft.exact_exchange_mixing_factor\"\n          visible={visible}\n          xs={12}\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputRange\n          quantity=\"results.method.simulation.dft.hubbard_kanamori_model.u_effective\"\n          visible={visible}\n          xs={12}\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.method.simulation.dft.core_electron_treatment\"\n          visible={visible}\n          disableSearch\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.method.simulation.dft.relativity_method\"\n          visible={visible}\n          disableSearch\n        />\n      </InputGridItem>\n    </InputGrid>\n  </FilterSubMenu>\n})\nFilterSubMenuDFT.propTypes = {\n  id: PropTypes.string\n}\n\nexport default FilterSubMenuDFT\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { FilterSubMenu, filterMenuContext } from './FilterMenu'\nimport { InputGrid, InputGridItem } from '../input/InputGrid'\nimport InputField from '../input/InputField'\nimport { InputCheckboxValue } from '../input/InputCheckbox'\n\nconst FilterSubMenuTB = React.memo(({\n  id,\n  ...rest\n}) => {\n  const {selected, open} = useContext(filterMenuContext)\n  const visible = open && id === selected\n\n  return <FilterSubMenu\n    id={id}\n    actions={<InputCheckboxValue\n      quantity=\"results.method.method_name\"\n      value=\"TB\"\n      description=\"Search TB entries\"\n    />}\n    {...rest}>\n    <InputGrid>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.method.simulation.tb.type\"\n          visible={visible}\n          xs={12}\n          disableSearch\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.method.simulation.tb.localization_type\"\n          visible={visible}\n          xs={12}\n          disableSearch\n        />\n      </InputGridItem>\n    </InputGrid>\n  </FilterSubMenu>\n})\nFilterSubMenuTB.propTypes = {\n  id: PropTypes.string\n}\n\nexport default FilterSubMenuTB\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { FilterSubMenu, filterMenuContext } from './FilterMenu'\nimport { InputGrid, InputGridItem } from '../input/InputGrid'\nimport InputField from '../input/InputField'\nimport { InputCheckboxValue } from '../input/InputCheckbox'\n\nconst FilterSubMenuGW = React.memo(({\n  id,\n  ...rest\n}) => {\n  const {selected, open} = useContext(filterMenuContext)\n  const visible = open && id === selected\n\n  return <FilterSubMenu\n    id={id}\n    actions={<InputCheckboxValue\n      quantity=\"results.method.method_name\"\n      value=\"GW\"\n      description=\"Search GW entries\"\n    />}\n    {...rest}>\n    <InputGrid>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.method.simulation.gw.type\"\n          visible={visible}\n          xs={12}\n          disableSearch\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.method.simulation.gw.starting_point_type\"\n          visible={visible}\n          xs={12}\n          disableSearch\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.method.simulation.gw.basis_set_type\"\n          visible={visible}\n          xs={12}\n          disableSearch\n        />\n      </InputGridItem>\n    </InputGrid>\n  </FilterSubMenu>\n})\nFilterSubMenuGW.propTypes = {\n  id: PropTypes.string\n}\n\nexport default FilterSubMenuGW\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { FilterSubMenu, filterMenuContext } from './FilterMenu'\nimport { InputGrid, InputGridItem } from '../input/InputGrid'\nimport InputField from '../input/InputField'\nimport { InputCheckboxValue } from '../input/InputCheckbox'\n\nconst FilterSubMenuBSE = React.memo(({\n  id,\n  ...rest\n}) => {\n  const {selected, open} = useContext(filterMenuContext)\n  const visible = open && id === selected\n\n  return <FilterSubMenu\n    id={id}\n    actions={<InputCheckboxValue\n      quantity=\"results.method.method_name\"\n      value=\"BSE\"\n      description=\"Search BSE entries\"\n    />}\n    {...rest}>\n    <InputGrid>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.method.simulation.bse.type\"\n          visible={visible}\n          xs={12}\n          disableSearch\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.method.simulation.bse.solver\"\n          visible={visible}\n          xs={12}\n          disableSearch\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.method.simulation.bse.starting_point_type\"\n          visible={visible}\n          xs={12}\n          disableSearch\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.method.simulation.bse.basis_set_type\"\n          visible={visible}\n          xs={12}\n          disableSearch\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.method.simulation.bse.gw_type\"\n          visible={visible}\n          xs={12}\n          disableSearch\n        />\n      </InputGridItem>\n    </InputGrid>\n  </FilterSubMenu>\n})\nFilterSubMenuBSE.propTypes = {\n  id: PropTypes.string\n}\n\nexport default FilterSubMenuBSE\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { FilterSubMenu, filterMenuContext } from './FilterMenu'\nimport { InputGrid, InputGridItem } from '../input/InputGrid'\nimport InputField from '../input/InputField'\nimport InputRange from '../input/InputRange'\nimport { InputCheckboxValue } from '../input/InputCheckbox'\n\nconst FilterSubMenuDMFT = React.memo(({\n  id,\n  ...rest\n}) => {\n  const {selected, open} = useContext(filterMenuContext)\n  const visible = open && id === selected\n\n  return <FilterSubMenu\n    id={id}\n    actions={<InputCheckboxValue\n      quantity=\"results.method.method_name\"\n      value=\"DMFT\"\n      description=\"Search DMFT entries\"\n    />}\n    {...rest}>\n    <InputGrid>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.method.simulation.dmft.impurity_solver_type\"\n          visible={visible}\n          xs={12}\n          disableSearch\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputRange\n          quantity=\"results.method.simulation.dmft.inverse_temperature\"\n          visible={visible}\n          xs={12}\n          disableSearch\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.method.simulation.dmft.magnetic_state\"\n          visible={visible}\n          xs={12}\n          disableSearch\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputRange\n          quantity=\"results.method.simulation.dmft.u\"\n          visible={visible}\n          xs={12}\n          disableSearch\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputRange\n          quantity=\"results.method.simulation.dmft.jh\"\n          visible={visible}\n          xs={12}\n          disableSearch\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.method.simulation.dmft.analytical_continuation\"\n          visible={visible}\n          xs={12}\n          disableSearch\n        />\n      </InputGridItem>\n    </InputGrid>\n  </FilterSubMenu>\n})\nFilterSubMenuDMFT.propTypes = {\n  id: PropTypes.string\n}\n\nexport default FilterSubMenuDMFT\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { FilterSubMenu, filterMenuContext } from './FilterMenu'\nimport { InputGrid, InputGridItem } from '../input/InputGrid'\nimport InputField from '../input/InputField'\nimport InputRange from '../input/InputRange'\nimport InputSection from '../input/InputSection'\nimport { InputCheckboxValue } from '../input/InputCheckbox'\n\nconst FilterSubMenuEELS = React.memo(({\n  id,\n  ...rest\n}) => {\n  const {selected, open} = useContext(filterMenuContext)\n  const visible = open && id === selected\n\n  return <FilterSubMenu\n    id={id}\n    actions={<InputCheckboxValue\n      quantity=\"results.method.method_name\"\n      value=\"EELS\"\n      description=\"Search EELS entries\"\n    />}\n    {...rest}>\n    <InputGrid>\n      <InputGridItem xs={12}>\n        <InputSection\n          section=\"results.properties.spectroscopic.spectra.provenance.eels\"\n          disableHeader\n          visible={visible}\n        >\n          <InputField\n            quantity=\"results.properties.spectroscopic.spectra.provenance.eels.detector_type\"\n            visible={visible}\n            xs={12}\n          />\n          <InputRange\n            quantity=\"results.properties.spectroscopic.spectra.provenance.eels.resolution\"\n            visible={visible}\n          />\n          <InputRange\n            quantity=\"results.properties.spectroscopic.spectra.provenance.eels.min_energy\"\n            visible={visible}\n          />\n          <InputRange\n            quantity=\"results.properties.spectroscopic.spectra.provenance.eels.max_energy\"\n            visible={visible}\n          />\n        </InputSection>\n      </InputGridItem>\n    </InputGrid>\n  </FilterSubMenu>\n})\nFilterSubMenuEELS.propTypes = {\n  id: PropTypes.string\n}\n\nexport default FilterSubMenuEELS\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { FilterSubMenu, filterMenuContext } from './FilterMenu'\nimport { InputGrid, InputGridItem } from '../input/InputGrid'\nimport InputSection from '../input/InputSection'\nimport InputRange from '../input/InputRange'\nimport InputField from '../input/InputField'\n\nconst FilterSubMenuElectronic = React.memo(({\n  id,\n  ...rest\n}) => {\n  const {selected, open} = useContext(filterMenuContext)\n  const visible = open && id === selected\n\n  return <FilterSubMenu id={id} {...rest}>\n    <InputGrid>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"electronic_properties\"\n          visible={visible}\n          disableSearch\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputSection\n          section=\"results.properties.electronic.band_structure_electronic.band_gap\"\n          visible={visible}\n        >\n          <InputField\n            quantity=\"results.properties.electronic.band_structure_electronic.band_gap.type\"\n            visible={visible}\n            disableSearch\n          />\n          <InputRange\n            quantity=\"results.properties.electronic.band_structure_electronic.band_gap.value\"\n            visible={visible}\n          />\n        </InputSection>\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputSection\n          section=\"results.properties.electronic.band_structure_electronic\"\n          visible={visible}\n        >\n          <InputField\n            quantity=\"results.properties.electronic.band_structure_electronic.spin_polarized\"\n            visible={visible}\n            disableSearch\n          />\n        </InputSection>\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputSection\n          section=\"results.properties.electronic.dos_electronic\"\n          visible={visible}\n        >\n          <InputField\n            quantity=\"results.properties.electronic.dos_electronic.spin_polarized\"\n            visible={visible}\n            disableSearch\n          />\n        </InputSection>\n      </InputGridItem>\n    </InputGrid>\n  </FilterSubMenu>\n})\nFilterSubMenuElectronic.propTypes = {\n  id: PropTypes.string\n}\n\nexport default FilterSubMenuElectronic\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { FilterSubMenu, filterMenuContext } from './FilterMenu'\nimport { InputGrid, InputGridItem } from '../input/InputGrid'\nimport InputRange from '../input/InputRange'\nimport InputField from '../input/InputField'\n\nconst FilterSubMenuSolarCell = React.memo(({\n  id,\n  ...rest\n}) => {\n  const {selected, open} = useContext(filterMenuContext)\n  const visible = open && id === selected\n\n  return <FilterSubMenu id={id} {...rest}>\n    <InputGrid>\n      <InputGridItem xs={12}>\n        <InputRange\n          quantity=\"results.properties.optoelectronic.solar_cell.efficiency\"\n          visible={visible}\n        />\n        <InputRange\n          quantity=\"results.properties.optoelectronic.solar_cell.fill_factor\"\n          visible={visible}\n        />\n        <InputRange\n          quantity=\"results.properties.optoelectronic.solar_cell.open_circuit_voltage\"\n          visible={visible}\n        />\n        <InputRange\n          quantity=\"results.properties.optoelectronic.solar_cell.short_circuit_current_density\"\n          visible={visible}\n        />\n        <InputRange\n          quantity=\"results.properties.optoelectronic.solar_cell.illumination_intensity\"\n          visible={visible}\n        />\n        <InputRange\n          quantity=\"results.properties.optoelectronic.solar_cell.device_area\"\n          visible={visible}\n        />\n        <InputField\n          quantity=\"results.properties.optoelectronic.solar_cell.device_architecture\"\n          visible={visible}\n        />\n        <InputField\n          quantity=\"results.properties.optoelectronic.solar_cell.device_stack\"\n          visible={visible}\n        />\n        <InputField\n          quantity=\"results.properties.optoelectronic.solar_cell.absorber\"\n          visible={visible}\n        />\n        <InputField\n          quantity=\"results.properties.optoelectronic.solar_cell.absorber_fabrication\"\n          visible={visible}\n        />\n        <InputField\n          quantity=\"results.properties.optoelectronic.solar_cell.electron_transport_layer\"\n          visible={visible}\n        />\n        <InputField\n          quantity=\"results.properties.optoelectronic.solar_cell.hole_transport_layer\"\n          visible={visible}\n        />\n        <InputField\n          quantity=\"results.properties.optoelectronic.solar_cell.substrate\"\n          visible={visible}\n        />\n        <InputField\n          quantity=\"results.properties.optoelectronic.solar_cell.back_contact\"\n          visible={visible}\n        />\n      </InputGridItem>\n    </InputGrid>\n  </FilterSubMenu>\n})\nFilterSubMenuSolarCell.propTypes = {\n  id: PropTypes.string\n}\n\nexport default FilterSubMenuSolarCell\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { FilterSubMenu, filterMenuContext } from './FilterMenu'\nimport { InputGrid, InputGridItem } from '../input/InputGrid'\nimport InputSection from '../input/InputSection'\nimport InputRange from '../input/InputRange'\nimport InputField from '../input/InputField'\n\nconst FilterSubMenuCatalyst = React.memo(({\n  id,\n  ...rest\n}) => {\n  const {selected, open} = useContext(filterMenuContext)\n  const visible = open && id === selected\n\n  return <FilterSubMenu id={id} {...rest}>\n    <InputGrid>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.properties.catalytic.reaction.name\"\n          visible={visible}\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputSection\n          section=\"results.properties.catalytic.reaction.reactants\"\n          visible={visible}\n        >\n          <InputField\n          quantity=\"results.properties.catalytic.reaction.reactants.name\"\n          visible={visible}\n          />\n          <InputRange\n          quantity=\"results.properties.catalytic.reaction.reactants.conversion\"\n          visible={visible}\n          />\n          <InputRange\n          quantity=\"results.properties.catalytic.reaction.reactants.gas_concentration_in\"\n          visible={visible}\n          />\n          <InputRange\n          quantity=\"results.properties.catalytic.reaction.reactants.gas_concentration_out\"\n          visible={visible}\n          />\n        </InputSection>\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputSection\n          section=\"results.properties.catalytic.reaction.products\"\n          visible={visible}\n        >\n          <InputField\n          quantity=\"results.properties.catalytic.reaction.products.name\"\n          visible={visible}\n          />\n          <InputRange\n          quantity=\"results.properties.catalytic.reaction.products.selectivity\"\n          visible={visible}\n          />\n          <InputRange\n          quantity=\"results.properties.catalytic.reaction.products.gas_concentration_out\"\n          visible={visible}\n          />\n        </InputSection>\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputRange\n          quantity=\"results.properties.catalytic.reaction.reaction_conditions.temperature\"\n          visible={visible}\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputSection\n          section=\"results.properties.catalytic.catalyst\"\n          disableHeader\n          visible={visible}\n        >\n          <InputField\n            quantity=\"results.properties.catalytic.catalyst.catalyst_type\"\n            visible={visible}\n          />\n          <InputField\n            quantity=\"results.properties.catalytic.catalyst.preparation_method\"\n            visible={visible}\n          />\n          <InputField\n            quantity=\"results.properties.catalytic.catalyst.catalyst_name\"\n            visible={visible}\n          />\n          <InputField\n            quantity=\"results.properties.catalytic.catalyst.characterization_methods\"\n            visible={visible}\n          />\n          <InputRange\n            quantity=\"results.properties.catalytic.catalyst.surface_area\"\n            visible={visible}\n          />\n        </InputSection>\n      </InputGridItem>\n    </InputGrid>\n  </FilterSubMenu>\n})\nFilterSubMenuCatalyst.propTypes = {\n  id: PropTypes.string\n}\n\nexport default FilterSubMenuCatalyst\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { FilterSubMenu, filterMenuContext } from './FilterMenu'\nimport { InputGrid, InputGridItem } from '../input/InputGrid'\nimport InputField from '../input/InputField'\n\nconst FilterSubMenuElectronic = React.memo(({\n  id,\n  ...rest\n}) => {\n  const {selected, open} = useContext(filterMenuContext)\n  const visible = open && id === selected\n\n  return <FilterSubMenu id={id} {...rest}>\n    <InputGrid>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"vibrational_properties\"\n          visible={visible}\n          disableSearch\n        />\n      </InputGridItem>\n    </InputGrid>\n  </FilterSubMenu>\n})\nFilterSubMenuElectronic.propTypes = {\n  id: PropTypes.string\n}\n\nexport default FilterSubMenuElectronic\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { FilterSubMenu, filterMenuContext } from './FilterMenu'\nimport InputRange from '../input/InputRange'\nimport InputField from '../input/InputField'\nimport InputSection from '../input/InputSection'\nimport { InputGrid, InputGridItem } from '../input/InputGrid'\n\nconst FilterSubMenuMechanical = React.memo(({\n  id,\n  ...rest\n}) => {\n  const {selected, open} = useContext(filterMenuContext)\n  const visible = open && id === selected\n\n  return <FilterSubMenu id={id} {...rest}>\n    <InputGrid>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"mechanical_properties\"\n          visible={visible}\n          disableSearch\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputSection\n          section=\"results.properties.mechanical.bulk_modulus\"\n          visible={visible}\n        >\n          <InputField\n            quantity=\"results.properties.mechanical.bulk_modulus.type\"\n            visible={visible}\n            initialSize={5}\n          />\n          <InputRange\n            quantity=\"results.properties.mechanical.bulk_modulus.value\"\n            visible={visible}\n          />\n        </InputSection>\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputSection\n          section=\"results.properties.mechanical.shear_modulus\"\n          visible={visible}\n        >\n          <InputField\n            quantity=\"results.properties.mechanical.shear_modulus.type\"\n            visible={visible}\n            disableSearch\n          />\n          <InputRange\n            quantity=\"results.properties.mechanical.shear_modulus.value\"\n            visible={visible}\n          />\n        </InputSection>\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputSection\n          section=\"results.properties.mechanical.energy_volume_curve\"\n          visible={visible}\n        >\n          <InputField\n            quantity=\"results.properties.mechanical.energy_volume_curve.type\"\n            visible={visible}\n            initialSize={5}\n          />\n        </InputSection>\n      </InputGridItem>\n    </InputGrid>\n  </FilterSubMenu>\n})\nFilterSubMenuMechanical.propTypes = {\n  id: PropTypes.string\n}\n\nexport default FilterSubMenuMechanical\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { FilterSubMenu, filterMenuContext } from './FilterMenu'\nimport InputRange from '../input/InputRange'\nimport InputField from '../input/InputField'\nimport InputSection from '../input/InputSection'\nimport { InputGrid, InputGridItem } from '../input/InputGrid'\n\nconst FilterSubMenuMolecularDynamics = React.memo(({\n  id,\n  ...rest\n}) => {\n  const {selected} = useContext(filterMenuContext)\n  const visible = id === selected\n\n  return <FilterSubMenu id={id} {...rest}>\n    <InputGrid>\n      <InputGridItem xs={12}>\n        <InputSection\n          section=\"results.properties.thermodynamic.trajectory\"\n          disableHeader\n          visible={visible}\n        >\n          <InputField\n            quantity=\"results.properties.thermodynamic.trajectory.available_properties\"\n            visible={visible}\n            disableSearch\n            formatLabels\n          />\n          <InputField\n            quantity=\"results.properties.thermodynamic.trajectory.provenance.molecular_dynamics.ensemble_type\"\n            disableSearch\n            visible={visible}\n          />\n          <InputRange\n            quantity=\"results.properties.thermodynamic.trajectory.provenance.molecular_dynamics.time_step\"\n            visible={visible}\n          />\n        </InputSection>\n      </InputGridItem>\n    </InputGrid>\n  </FilterSubMenu>\n})\nFilterSubMenuMolecularDynamics.propTypes = {\n  id: PropTypes.string\n}\n\nexport default FilterSubMenuMolecularDynamics\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { FilterSubMenu, filterMenuContext } from './FilterMenu'\nimport { InputGrid, InputGridItem } from '../input/InputGrid'\nimport InputField from '../input/InputField'\nimport { InputCheckboxValue } from '../input/InputCheckbox'\n\nconst FilterSubMenuELN = React.memo(({\n  id,\n  ...rest\n}) => {\n  const {selected, open} = useContext(filterMenuContext)\n  const visible = open && id === selected\n\n  return <FilterSubMenu\n    id={id}\n    actions={<InputCheckboxValue\n      quantity=\"quantities\"\n      value=\"data\"\n      description=\"Search ELN entries\"\n    />}\n    {...rest}\n  >\n    <InputGrid>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.eln.sections\"\n          visible={visible}\n          xs={12}\n          disableSearch\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.eln.tags\"\n          visible={visible}\n          xs={12}\n          disableSearch\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.eln.methods\"\n          visible={visible}\n          xs={12}\n          disableSearch\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.eln.instruments\"\n          visible={visible}\n          xs={12}\n          disableSearch\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.eln.names\"\n          visible={visible}\n          disableStatistics\n          disableOptions\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.eln.descriptions\"\n          visible={visible}\n          disableStatistics\n          disableOptions\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.eln.lab_ids\"\n          visible={visible}\n          disableStatistics\n          disableOptions\n        />\n      </InputGridItem>\n    </InputGrid>\n  </FilterSubMenu>\n})\nFilterSubMenuELN.propTypes = {\n  id: PropTypes.string\n}\n\nexport default FilterSubMenuELN\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { FilterSubMenu, filterMenuContext } from './FilterMenu'\nimport { InputGrid, InputGridItem } from '../input/InputGrid'\nimport InputField from '../input/InputField'\nimport InputRange from '../input/InputRange'\n\nconst FilterSubMenuAuthor = React.memo(({\n  id,\n  ...rest\n}) => {\n  const {selected, open} = useContext(filterMenuContext)\n  const visible = open && id === selected\n\n  return <FilterSubMenu id={id} {...rest}>\n    <InputGrid>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"authors.name\"\n          visible={visible}\n          disableOptions\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputRange\n          quantity=\"upload_create_time\"\n          visible={visible}\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"external_db\"\n          visible={visible}\n          disableSearch\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"datasets.dataset_name\"\n          visible={visible}\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"datasets.doi\"\n          visible={visible}\n          disableStatistics\n          disableOptions\n        />\n      </InputGridItem>\n    </InputGrid>\n  </FilterSubMenu>\n})\nFilterSubMenuAuthor.propTypes = {\n  id: PropTypes.string\n}\n\nexport default FilterSubMenuAuthor\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useCallback } from 'react'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\nimport { isNil } from 'lodash'\nimport InputHeader from './InputHeader'\nimport InputItem from './InputItem'\nimport { useSearchContext, getValue } from '../SearchContext'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    width: '100%',\n    display: 'flex',\n    alignItems: 'flex-start',\n    justifyContent: 'center',\n    flexDirection: 'column',\n    boxSizing: 'border-box'\n  }\n}))\nconst InputRadio = React.memo(({\n  quantity,\n  label,\n  description,\n  initialValue,\n  options,\n  className,\n  classes,\n  'data-testid': testID\n}) => {\n  const theme = useTheme()\n  const { filterData, useFilterState, useFilterLocked } = useSearchContext()\n  const styles = useStyles({classes: classes, theme: theme})\n  const [filter, setFilter] = useFilterState(quantity)\n  const filterLocked = useFilterLocked(quantity)\n\n  // Determine the description and units\n  const def = filterData[quantity]\n  const locked = !isNil(filterLocked) && filterData[quantity].global\n  const descFinal = description || def?.description || ''\n  const labelFinal = label || def?.label\n  const val = getValue(def, filter, filterLocked, initialValue)\n\n  const handleChange = useCallback((event, key, selected) => {\n    setFilter(key)\n  }, [setFilter])\n\n  return <div className={clsx(className, styles.root)} data-testid={testID}>\n    <InputHeader\n      quantity={quantity}\n      label={labelFinal}\n      description={descFinal}\n      disableWidget\n      disableStatistics\n    />\n    {options && Object.entries(options).map(([key, value]) =>\n      <InputItem\n        key={key}\n        value={key}\n        label={value.label}\n        disabled={locked || value.disabled}\n        selected={val === key}\n        onChange={handleChange}\n        tooltip={value.tooltip}\n        variant=\"radio\"\n        disableStatistics\n      />\n    )}\n  </div>\n})\n\nInputRadio.propTypes = {\n  quantity: PropTypes.string.isRequired,\n  label: PropTypes.string,\n  description: PropTypes.string,\n  initialValue: PropTypes.string,\n  options: PropTypes.object, // Mapping from option name to show label and tooltip\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  'data-testid': PropTypes.string\n}\n\nexport default InputRadio\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useCallback, useEffect, useMemo, useState, useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\nimport { FilterSubMenu, filterMenuContext } from './FilterMenu'\nimport { InputGrid, InputGridItem } from '../input/InputGrid'\nimport { Box, Collapse, makeStyles } from '@material-ui/core'\nimport { SectionMDef, SubSectionMDef, useGlobalMetainfo } from '../../archive/metainfo'\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore'\nimport ChevronRightIcon from '@material-ui/icons/ChevronRight'\nimport { useSearchContext } from '../SearchContext'\nimport InputItem from '../input/InputItem'\nimport { InputTextQuantity } from '../input/InputText'\nimport { useErrors } from '../../errors'\nimport { useDataStore } from '../../DataStore'\nimport InputField from '../input/InputField'\nimport InputRadio from '../input/InputRadio'\nimport { useApi } from '../../api'\nimport InputHeader from '../input/InputHeader'\n\nconst filterProperties = def => !(def.name.startsWith('x_') || def.virtual)\n\nconst useDefinitionStyles = makeStyles(theme => ({\n  root: {},\n  item: {\n    '&:hover': {\n      backgroundColor: theme.palette.grey[100]\n    },\n    cursor: 'pointer',\n    width: '100%',\n    display: 'flex',\n    flexDirection: 'row',\n    alignItems: 'center',\n    flexWrap: 'nowrap',\n    paddingRight: theme.spacing(1),\n    boxSizing: 'border-box'\n  },\n  icon: {\n  },\n  name: {\n    flexGrow: 1\n  },\n  actions: {\n    marginLeft: theme.spacing(1)\n  },\n  children: {\n    marginLeft: theme.spacing(3)\n  }\n}))\n\nconst Definition = React.memo(function Definition({node, name, path, className}) {\n  const classes = useDefinitionStyles()\n  const [open, setOpen] = useState(!path)\n  const { useFilterState } = useSearchContext()\n  const [filter, setFilter] = useFilterState('quantities')\n\n  const handleSelect = useCallback((event) => {\n    event.stopPropagation()\n    setFilter(old => {\n      let newValues\n      if (old) {\n        const isSelected = old?.has(path)\n        isSelected ? old.delete(path) : old.add(path)\n        newValues = new Set(old)\n      } else {\n        newValues = new Set([path])\n      }\n      return newValues\n    })\n  }, [path, setFilter])\n\n  const handleToggle = useCallback(event => {\n    event.stopPropagation()\n    setOpen(open => !open)\n  }, [setOpen])\n\n  const children = Object.keys(node)\n  const hasChildren = children.length > 0\n\n  const icon = useMemo(() => {\n    const iconProps = {\n      className: classes.icon,\n      fontSize: 'small'\n    }\n    return hasChildren\n      ? (open ? <ExpandMoreIcon {...iconProps} /> : <ChevronRightIcon {...iconProps}/>)\n      : <div className={classes.icon} />\n  }, [hasChildren, open, classes.icon])\n\n  const childPathPrefix = path + '.'\n  const indeterminate = useMemo(() => {\n    if (!filter) {\n      return false\n    }\n    return hasChildren && Array.from(filter).find(fullPath => fullPath.startsWith(childPathPrefix)) !== undefined\n  }, [filter, hasChildren, childPathPrefix])\n\n  return <div className={clsx(className, classes.root)}>\n    <div onClick={hasChildren ? handleToggle : null} className={classes.item}>\n      {icon}\n      <InputItem\n        value={path}\n        label={name}\n        selected={filter?.has(path) || false}\n        onChange={handleSelect}\n        variant=\"checkbox\"\n        labelPlacement=\"start\"\n        disableStatistics\n        disableLabelClick\n        disableSelect={!path}\n        indeterminate={indeterminate}\n      />\n    </div>\n    {hasChildren && (\n      <Collapse in={open} className={classes.children}>\n        {open && children.map((name, index) => (\n          <Definition\n            key={index}\n            name={name}\n            node={node[name]}\n            path={childPathPrefix + name} />\n        ))}\n      </Collapse>\n    )}\n  </div>\n})\nDefinition.propTypes = {\n  node: PropTypes.object.isRequired,\n  name: PropTypes.string,\n  path: PropTypes.string,\n  className: PropTypes.string\n}\n\nconst FilterSubMenuMetadata = React.memo(({\n  id,\n  ...rest\n}) => {\n  const {api} = useApi()\n  const {selected, open} = useContext(filterMenuContext)\n  const visible = open && id === selected\n  const authenticated = api?.keycloak?.authenticated\n  const dataStore = useDataStore()\n  const globalMetainfo = useGlobalMetainfo()\n  const [[options, tree], setOptions] = useState([[], {}])\n  const {raiseError} = useErrors()\n  useEffect(() => {\n    if (!globalMetainfo || !visible) {\n      return\n    }\n    const root = globalMetainfo.getEntryArchiveDefinition()\n    const subSections = root?.sub_sections\n    const tree = {}\n    if (!subSections) {\n      return []\n    }\n    const options = []\n    const defsSet = new Set()\n    function addDef(def, prefix, node) {\n      const fullName = prefix ? `${prefix}.${def.name}` : def.name\n      node[def.name] = node[def.name] || {}\n      node = node[def.name]\n      if (defsSet.has(def)) {\n        return\n      }\n      defsSet.add(def)\n      options.push({value: fullName})\n      if (def.m_def === SubSectionMDef && def.sub_section) {\n        def = def.sub_section\n      }\n      if (def.m_def === SectionMDef) {\n        def._allProperties.filter(filterProperties).forEach(def => addDef(def, fullName, node))\n        dataStore.getAllInheritingSections(def).forEach(def => {\n          def._allProperties.filter(filterProperties).forEach(def => addDef(def, fullName, node))\n        })\n      }\n    }\n    subSections.forEach(def => addDef(def, null, tree))\n    setOptions([options, tree])\n  }, [raiseError, dataStore, globalMetainfo, setOptions, visible])\n\n  return <FilterSubMenu id={id} {...rest}>\n    <InputGrid>\n      <InputGridItem xs={12}>\n        <InputRadio\n          quantity=\"visibility\"\n          label=\"Visibility\"\n          initialValue={authenticated ? 'visible' : 'public'}\n          options={{\n            all: {label: 'All', disabled: !authenticated, tooltip: 'Consider all entries.'},\n            public: {label: 'Public', disabled: false, tooltip: 'Consider all entries that can be publically downloaded, i.e. only published entries without embargo.'},\n            visible: {label: 'Visible', disabled: !authenticated, tooltip: 'Consider all entries that are visible to you. This includes entries with embargo or unpublished entries that belong to you or are shared with you.'},\n            shared: {label: 'Shared', disabled: !authenticated, tooltip: 'Only consider entries that belong to you or are shared with you.'},\n            user: {label: 'User', disabled: !authenticated, tooltip: 'Only consider entries that belong to you.'},\n            staging: {label: 'Unpublished', disabled: !authenticated, tooltip: 'Only search through unpublished entries.'}\n          }}\n        ></InputRadio>\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"entry_id\"\n          visible={visible}\n          disableStatistics\n          disableOptions\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"upload_id\"\n          visible={visible}\n          disableStatistics\n          disableOptions\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"upload_name\"\n          visible={visible}\n          disableStatistics\n          disableOptions\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"results.material.material_id\"\n          visible={visible}\n          disableStatistics\n          disableOptions\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputField\n          quantity=\"datasets.dataset_id\"\n          visible={visible}\n          disableStatistics\n          disableOptions\n        />\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <InputHeader quantity=\"quantities\" disableStatistics/>\n        <Box marginBottom={1}>\n          <InputTextQuantity\n            quantity=\"quantities\"\n            suggestions={options}\n          />\n        </Box>\n        {Object.keys(tree).map((name, index) => (\n          <Definition node={tree[name]} name={name} path={name} key={index} />\n        ))}\n      </InputGridItem>\n    </InputGrid>\n  </FilterSubMenu>\n})\nFilterSubMenuMetadata.propTypes = {\n  id: PropTypes.string\n}\n\nexport default FilterSubMenuMetadata\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useCallback, useContext, useEffect, useMemo, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { FilterSubMenu, filterMenuContext } from './FilterMenu'\nimport { Box, TextField } from \"@material-ui/core\"\nimport { useSearchContext } from \"../SearchContext\"\nimport AutoComplete from \"@material-ui/lab/Autocomplete\"\nimport { useApi } from '../../api'\nimport { debounce, isArray, isEmpty } from 'lodash'\nimport { searchQuantities } from '../../../config'\n\n// List of optimade identifiers. We get these from the metainfo.\nconst prefix = 'optimade.'\nconst identifiers = Object.keys(searchQuantities)\n  .filter(key => key.startsWith(prefix))\n  .map(key => key.slice(prefix.length))\n  .sort()\n\nconst FilterSubMenuOptimade = React.memo(({\n  id,\n  ...rest\n}) => {\n  const [suggestions, setSuggestions] = useState([['']])\n  const [values, setValues] = useState([{value: '', valid: true, msg: ''}])\n  const {selected, open} = useContext(filterMenuContext)\n  const {useFilterState} = useSearchContext()\n  const {api} = useApi()\n  const visible = open && id === selected\n  const [optimadeFilters, setOptimadeFilters] = useFilterState(\"optimade_filter\")\n\n  const renderSuggestion = useCallback((command, options, suggestions) => {\n    options.filter((item, pos) => options.indexOf(item) === pos).forEach(option => {\n      if (option === 'IDENTIFIER') {\n        identifiers.forEach(identifier => {\n          suggestions.push([command, identifier].join(' '))\n        })\n      } else if (['OPERATOR', 'ESCAPED_STRING', 'SIGNED_FLOAT', 'SIGNED_INT'].includes(option)) {\n        suggestions.push(command.concat(' <', option, '>'))\n      } else {\n        suggestions.push([command, option].join(' '))\n      }\n    })\n  }, [])\n\n  const getSuggestions = useCallback(async (filter, index) => {\n    const requestBody = {\n      exclude: ['atoms', 'only_atoms', 'files', 'quantities', 'dft.quantities', 'optimade', 'dft.labels', 'dft.geometries'],\n      verify_only: true,\n      owner: 'public',\n      query: {\n        optimade_filter: filter\n      }\n    }\n    try {\n      await api.post(`entries/query`, requestBody)\n      setValues(oldValues => {\n        const newValues = [...oldValues]\n        newValues[index] = {value: oldValues[index].value, valid: true, msg: ''}\n        return newValues\n      })\n      return {valid: true, suggestions: []}\n    } catch (error) {\n      if (isArray(error?.apiMessage)) {\n        const suggestions = []\n        error?.apiMessage.forEach((err) => {\n          const errorLocations = err?.loc\n          errorLocations.forEach(location => {\n            if (location?.[0] === 'optimade_filter') {\n              let errorIndex = Number(err.msg.match(/col \\d+/i)?.[0].match(/\\d+/)?.[0]) - 1\n              if (err.msg.match(/Unexpected end-of-input/i)) {\n                errorIndex = filter.length\n              }\n              const commands = identifiers.filter(identifier => identifier.startsWith(filter))\n              if (commands.length > 0) {\n                commands.forEach(command => suggestions.push(command))\n              }\n              const options = Array.from(err.msg.matchAll(/\\t\\* \\w+\\n/g), m => m[0].slice(3, -1))\n              const command = filter.slice(0, errorIndex).trim()\n              renderSuggestion(command, options, suggestions)\n              const semanticError = err.msg.match(/Semantic error.*\\n\\n(.*)/i)\n              if (semanticError) {\n                setValues(oldValues => {\n                  const newValues = [...oldValues]\n                  newValues[index] = {value: oldValues[index].value, valid: oldValues[index].valid, msg: semanticError?.[1]}\n                  return newValues\n                })\n              }\n            }\n          })\n        })\n        return {valid: false, suggestions: suggestions}\n      }\n      return {valid: false, suggestions: []}\n    }\n  }, [api, renderSuggestion])\n\n  useEffect(() => {\n    if (!visible || isEmpty(optimadeFilters)) return\n    const newOptimadeFilters = optimadeFilters ? [...optimadeFilters, ''] : ['']\n    const newValues = newOptimadeFilters.map(value => ({value: value, valid: !!value, msg: ''}))\n    setValues(newValues)\n    const prepareOptions = async () => {\n      const allSuggestions = await Promise.all(newOptimadeFilters.map(async (optimadeFilter, index) => {\n        const command = optimadeFilter && optimadeFilter.trim()\n        const validation = await getSuggestions(command || '.', index)\n        return [optimadeFilter].concat(validation.suggestions)\n      }))\n      setSuggestions(allSuggestions)\n    }\n    prepareOptions()\n  }, [optimadeFilters, getSuggestions, visible])\n\n  const validate = useCallback(async (value, index) => {\n    const validation = await getSuggestions((value && value.trim()) || '.', index)\n    setSuggestions(suggestions => {\n      const newSuggestions = [...suggestions]\n      newSuggestions[index] = [value].concat(validation.suggestions)\n      return newSuggestions\n    })\n    return validation\n  }, [getSuggestions])\n\n  const debouncedPrepareSuggestions = useMemo(() => (\n    debounce(validate, 500)\n  ), [validate])\n\n  const setFilter = useCallback((value, index) => {\n    setValues(oldValue => {\n      const newValues = [...oldValue]\n      if (!value) {\n        index !== newValues.length - 1 && newValues.splice(index, 1)\n      } else {\n        newValues[index] = {value: value, valid: false, msg: ''}\n      }\n      return newValues\n    })\n    const newSuggestions = [...suggestions]\n    if (!value) {\n      index !== newSuggestions.length - 1 && newSuggestions.splice(index, 1)\n    } else {\n      newSuggestions[index] = [value]\n    }\n    setSuggestions(newSuggestions)\n  }, [suggestions])\n\n  const handleInputChange = useCallback((value, index) => {\n    setFilter(value, index)\n    debouncedPrepareSuggestions(value, index)\n  }, [debouncedPrepareSuggestions, setFilter])\n\n  const setOptimadeFilter = useCallback((index, value, valid = false) => {\n    const newFilters = [...values].filter(value => !!value.value)\n    if (newFilters.length === 0 || (!newFilters.every(value => !!value.valid) && !valid)) return\n    const newOptimadeFilters = [...newFilters].map(value => value.value)\n    if (!value) {\n      newOptimadeFilters.splice(index, 1)\n    } else {\n      newOptimadeFilters[index] = value\n    }\n    setOptimadeFilters(new Set(newOptimadeFilters))\n  }, [setOptimadeFilters, values])\n\n  const handleChange = useCallback(async (event, value, index) => {\n    if (values[index].value !== value) {\n      setFilter(value, index)\n      if (!values[index].value) return\n    }\n    if (!values[index].valid) {\n      const validation = await validate(value, index)\n      if (!validation.valid) return\n      setOptimadeFilter(index, value, true)\n    } else {\n      setOptimadeFilter(index, value)\n    }\n  }, [setFilter, setOptimadeFilter, validate, values])\n\n  return <FilterSubMenu id={id} {...rest}>\n    {visible && values && values.length === suggestions.length && values.map((value, index) => {\n      return <Box key={index} paddingLeft={2} paddingRight={2}>\n        <AutoComplete\n          options={suggestions[index]}\n          style={{width: '100%'}}\n          onChange={(event, value) => handleChange(event, value, index)}\n          onKeyDown={(event) => (event.key === 'Enter' && handleChange(event, value.value, index))}\n          value={value.value}\n          getOptionSelected={(option, value) => option === value}\n          getOptionLabel={option => (option && String(option)) || ''}\n          renderInput={params => (\n            <TextField\n              {...params}\n              variant='filled' label='Filter'\n              placeholder='Type optimade filter' margin='normal' fullWidth size='small'\n              onChange={event => handleInputChange(event.target.value, index)}\n              error={!!value.msg}\n              helperText={!!value.msg && value.msg}\n            />\n          )}\n        />\n      </Box>\n    })}\n  </FilterSubMenu>\n})\nFilterSubMenuOptimade.propTypes = {\n  id: PropTypes.string\n}\n\nexport default FilterSubMenuOptimade\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useContext } from 'react'\nimport PropTypes from 'prop-types'\nimport { FilterSubMenu, filterMenuContext } from './FilterMenu'\nimport InputRange from '../input/InputRange'\nimport InputSection from '../input/InputSection'\nimport { InputCheckboxValue } from '../input/InputCheckbox'\nimport { InputGrid, InputGridItem } from '../input/InputGrid'\n\nconst FilterSubMenuGeometryOptimization = React.memo(({\n  id,\n  ...rest\n}) => {\n  const {selected, open} = useContext(filterMenuContext)\n  const visible = open && id === selected\n\n  return <FilterSubMenu\n    id={id}\n    actions={<InputCheckboxValue\n      quantity=\"results.properties.available_properties\"\n      value=\"geometry_optimization\"\n      description=\"Search entries with geometry optimization results\"\n    />}\n    {...rest}>\n    <InputGrid>\n      <InputGridItem xs={12}>\n        <InputSection\n          section=\"results.properties.geometry_optimization\"\n          visible={visible}\n          disableHeader\n        >\n          <InputRange\n            quantity=\"results.properties.geometry_optimization.final_energy_difference\"\n            visible={visible}\n          />\n          <InputRange\n            quantity=\"results.properties.geometry_optimization.final_force_maximum\"\n            visible={visible}\n          />\n          <InputRange\n            quantity=\"results.properties.geometry_optimization.final_displacement_maximum\"\n            visible={visible}\n          />\n        </InputSection>\n      </InputGridItem>\n    </InputGrid>\n  </FilterSubMenu>\n})\nFilterSubMenuGeometryOptimization.propTypes = {\n  id: PropTypes.string\n}\n\nexport default FilterSubMenuGeometryOptimization\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useCallback, useContext, useEffect, useMemo, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { isNil } from 'lodash'\nimport { FilterSubMenu, filterMenuContext } from './FilterMenu'\nimport {\n  Box,\n  Button,\n  FormControl,\n  InputLabel,\n  LinearProgress,\n  MenuItem,\n  Select,\n  Typography\n} from '@material-ui/core'\nimport { InputGrid, InputGridItem } from '../input/InputGrid'\nimport { useApi } from '../../api'\nimport { useErrors } from '../../errors'\nimport { useSearchContext } from '../SearchContext'\nimport { useGlobalMetainfo } from '../../archive/metainfo'\nimport { NumberEditQuantity } from '../../editQuantity/NumberEditQuantity'\nimport { StringEditQuantity } from '../../editQuantity/StringEditQuantity'\nimport { EnumEditQuantity } from '../../editQuantity/EnumEditQuantity'\nimport { DateTimeEditQuantity, DateEditQuantity } from '../../editQuantity/DateTimeEditQuantity'\nimport { editQuantityComponents } from '../../editQuantity/EditQuantity'\nimport { InputMetainfoControlled } from '../../search/input/InputMetainfo'\nimport { DType, getDatatype, rsplit, parseQuantityName } from '../../../utils'\nimport { InputTextField } from '../input/InputText'\n\nconst types = {\n  [DType.Int]: 'Integer',\n  [DType.Float]: 'Float',\n  [DType.Timestamp]: 'Datetime',\n  [DType.String]: 'String',\n  [DType.Enum]: 'Enum'\n}\n\nconst operators = {\n  'search': '=',\n  'lt': '<',\n  'lte': '<=',\n  'gte': '=>',\n  'gt': '>'\n}\n\nconst typeOperators = {\n  [DType.Int]: Object.keys(operators),\n  [DType.Float]: Object.keys(operators),\n  [DType.Timestamp]: Object.keys(operators),\n  [DType.String]: ['search'],\n  [DType.Enum]: ['search'],\n  [DType.Boolean]: ['search']\n}\n\nconst valueKeys = {\n  [DType.Int]: 'int_value',\n  [DType.Float]: 'float_value',\n  [DType.Timestamp]: 'datetime_value',\n  [DType.String]: 'str_value',\n  [DType.Enum]: 'str_value',\n  [DType.Boolean]: 'bool_value'\n}\n\nconst componentMap = {\n  [DType.Int]: NumberEditQuantity,\n  [DType.Float]: NumberEditQuantity,\n  [DType.Timestamp]: DateEditQuantity,\n  [DType.String]: StringEditQuantity,\n  [DType.Enum]: EnumEditQuantity,\n  [DType.Boolean]: StringEditQuantity\n}\n\nconst getValueKey = (quantityDef) => {\n  const dtype = getDatatype(quantityDef)\n  const result = valueKeys[dtype]\n\n  if (!result) {\n    throw Error('Unsupported quantity type')\n  }\n  return result\n}\n\nconst getOperators = (quantityDef) => {\n  const dtype = getDatatype(quantityDef)\n  const result = typeOperators[dtype]\n  if (!result) {\n    throw Error('Unsupported quantity type')\n  }\n  return result\n}\n\nconst EditQuantity = React.memo(({quantityDef, value, onChange}) => {\n  const [component, componentProps] = useMemo(() => {\n    const elnAnnotation = quantityDef.m_annotations?.eln[0] || {}\n    let {component, props, ...otherProps} = elnAnnotation\n    component = component && editQuantityComponents[component]\n    const usesCompatibleComponent = [StringEditQuantity, EnumEditQuantity, NumberEditQuantity, DateTimeEditQuantity].indexOf(component) !== -1\n\n    if (!(component && usesCompatibleComponent)) {\n      const type = getDatatype(quantityDef)\n      // fall back on StringEditQuantity if type ends up being unknown\n      component = type === DType.Unknown ? StringEditQuantity : componentMap[type]\n      props = {}\n      otherProps = {}\n    }\n\n    return [component, {\n      ...props,\n      ...otherProps,\n      label: 'value',\n      quantityDef: quantityDef\n    }]\n  }, [quantityDef])\n\n  return React.createElement(\n    component, {\n      ...componentProps,\n      value: value,\n      onChange: onChange\n  })\n})\nEditQuantity.propTypes = {\n  quantityDef: PropTypes.object.isRequired,\n  value: PropTypes.any,\n  onChange: PropTypes.func.isRequired\n}\n\nconst QuantityFilter = React.memo(({quantities, filter, onChange}) => {\n  const {id, value} = filter\n  const operator = filter.operator || 'search'\n  const quantityDef = useMemo(() => {\n    return quantities.find(q => q.id === id)?._quantityDef\n  }, [id, quantities])\n\n  const options = useMemo(() => {\n    return Object.fromEntries(quantities.map(quantity => {\n      const {path, schema} = parseQuantityName(quantity.id)\n      return [\n        quantity.id, {\n          key: quantity.id,\n          primary: path,\n          schema: schema,\n          description: quantity?._quantityDef?.description,\n          dtype: getDatatype(quantity?._quantityDef)\n        }\n      ]\n    }\n      ))\n  }, [quantities])\n\n  const handleValueChange = useCallback((value) => {\n    onChange({\n      operator: 'search',\n      ...filter,\n      value: value\n    })\n  }, [filter, onChange])\n\n  const handleIdChange = useCallback((value) => {\n    onChange({\n      operator: 'search',\n      id: value\n    })\n  }, [onChange])\n\n  const handleOperatorChange = useCallback((e) => {\n    onChange({\n      ...filter,\n      operator: e.target.value\n    })\n  }, [filter, onChange])\n\n  const availableOperators = quantityDef ? getOperators(quantityDef) : ['search']\n\n  return (<React.Fragment>\n    <Box display=\"flex\" flexWrap=\"wrap\" flexDirection=\"row\" alignItems=\"flex-start\" marginTop={1}>\n      <Box marginBottom={1} width=\"100%\">\n        <InputMetainfoControlled\n          options={options}\n          value={id}\n          onChange={handleIdChange}\n          onSelect={handleIdChange}\n          // TODO: There should be better error handling here. Errors for now\n          // simply clear out the input.\n          onError={(error) => error && handleIdChange(\"\")}\n          optional\n        />\n      </Box>\n      <Box marginRight={1} width={65}>\n        <FormControl fullWidth size=\"small\" variant=\"filled\">\n          <InputLabel>op</InputLabel>\n          <Select\n            value={operator}\n            onChange={handleOperatorChange}\n            renderValue={value => <b>{operators[value]}</b>}\n          >\n            {availableOperators.map((operator, index) => (\n              <MenuItem key={index} value={operator}>{operators[operator]}</MenuItem>\n            ))}\n          </Select>\n        </FormControl>\n      </Box>\n      <Box flexGrow={1}>\n        {\n          quantityDef ? (\n            <EditQuantity\n              fullWidth\n              value={value}\n              onChange={handleValueChange}\n              quantityDef={quantityDef}\n            />\n          ) : (\n            <InputTextField\n              label=\"value\"\n              fullWidth\n              value={filter.value || ''}\n              onChange={e => handleValueChange(e.target.value)}\n            />\n          )\n        }\n      </Box>\n    </Box>\n  </React.Fragment>)\n})\nQuantityFilter.propTypes = {\n  quantities: PropTypes.arrayOf(PropTypes.object).isRequired,\n  filter: PropTypes.object.isRequired,\n  onChange: PropTypes.func.isRequired\n}\n\nconst FilterSubMenuCustomQuantities = React.memo(({\n  id,\n  ...rest\n}) => {\n  const metainfo = useGlobalMetainfo()\n  const {selected, open} = useContext(filterMenuContext)\n  const {useFilterState} = useSearchContext()\n  const [loaded, setLoaded] = useState(false)\n  const visible = open && id === selected\n  const {api} = useApi()\n  const {raiseError} = useErrors()\n  const [query, setQuery] = useFilterState('custom_quantities')\n  const [quantities, setQuantities] = useState(null)\n\n  const [andFilters, setAndFilters] = useState([{}])\n\n  useEffect(() => {\n    if (!metainfo || loaded || !visible) {\n      return\n    }\n    const retrieve = async () => {\n      const response = await api.post('entries/query', {\n        'owner': 'visible',\n        'query': {\n          'quantities:any': ['data', 'nexus']\n        },\n        'pagination': {\n          'page_size': 0\n        },\n        'aggregations': {\n          'paths': {\n            'terms': {\n              'quantity': 'search_quantities.id',\n              'size': 1000,\n              'entries': {\n                'size': 1,\n                'required': {\n                  'include': [\n                    'search_quantities.id',\n                    'search_quantities.definition'\n                  ]\n                }\n              }\n            }\n          }\n        }\n      }, {\n        noLoading: true\n      })\n      const quantities = []\n      for (const path of response.aggregations.paths.terms.data) {\n        const searchableQuantity = path.entries[0].search_quantities\n        const [section_path, quantity_path] = rsplit(searchableQuantity.definition, '.', 1)\n\n        // The definition may not exist in the installation if e.g. the\n        // definition is removed, or access rights to YAML files are changed.\n        // In this case the value is not shown.\n        let quantityDef\n        try {\n          const sectionDef = await metainfo.resolveDefinition(section_path, false)\n          quantityDef = sectionDef?._properties?.[quantity_path]\n        } catch (error) {\n        }\n        if (!quantityDef) continue\n\n        const type = getDatatype(quantityDef)\n        let description = types[type] || 'unknown type'\n        if (quantityDef.unit) {\n          description += ` in ${quantityDef.unit}`\n        }\n        quantities.push({\n          ...searchableQuantity,\n          _quantityDef: quantityDef,\n          _description: description\n        })\n      }\n      setQuantities(quantities)\n      setLoaded(true)\n    }\n    retrieve().catch(raiseError)\n  }, [loaded, visible, api, raiseError, setQuantities, metainfo])\n\n  const handleFilterChange = useCallback((filter, index) => {\n    setAndFilters(filters => {\n      const newFilters = [...filters]\n      newFilters[index] = filter\n      return newFilters\n    })\n  }, [setAndFilters])\n\n  const handleAndClicked = useCallback(() => {\n    setAndFilters(filters => [...filters, {}])\n  }, [setAndFilters])\n\n  const handleClearClicked = useCallback(() => {\n    setAndFilters([{}])\n    setQuery([])\n  }, [setAndFilters, setQuery])\n\n  const searchEnabled = useMemo(() => {\n    return andFilters.every(f => f.id && !isNil(f.value))\n  }, [andFilters])\n\n  const handleSearchClicked = useCallback(() => {\n    const query = {\n      and: andFilters.map(filter => {\n        const {id, value, operator} = filter\n        const quantityDef = id && quantities.find(q => q.id === id)._quantityDef\n        const valueKey = getValueKey(quantityDef)\n        const valueKeyWithOperator = operator === 'search' ? valueKey : `${valueKey}:${operator}`\n        return {\n          search_quantities: {\n            id: id,\n            [valueKeyWithOperator]: value\n          }\n        }\n      })\n    }\n    setQuery(query)\n  }, [andFilters, setQuery, quantities])\n\n  useEffect(() => {\n    const andFilters = query?.and?.map(filter => {\n      const searchQuantity = filter.search_quantities\n      const valueKey = Object.keys(searchQuantity)[1]\n      const valueKeyWithOperator = valueKey.split(':')\n      const operator = valueKeyWithOperator.length === 2 ? valueKeyWithOperator[1] : 'search'\n      return {\n        id: searchQuantity.id,\n        value: searchQuantity[Object.keys(searchQuantity)[1]],\n        operator: operator\n      }\n    })\n    setAndFilters(andFilters || [{}])\n  }, [query, setAndFilters])\n\n  if (!quantities) {\n    return (\n      <FilterSubMenu id={id} {...rest}>\n        <InputGrid>\n          <InputGridItem xs={12}>\n            <LinearProgress/>\n          </InputGridItem>\n        </InputGrid>\n      </FilterSubMenu>\n    )\n  }\n\n  if (quantities.length === 0) {\n    return (\n      <FilterSubMenu id={id} {...rest}>\n        <InputGrid>\n          <InputGridItem xs={12}>\n            <Typography>\n              Could not find valid quantities to search for. Make sure that you have access to the data and that the metainfo associated with the quantities can be loaded correctly.\n            </Typography>\n          </InputGridItem>\n        </InputGrid>\n      </FilterSubMenu>\n    )\n  }\n\n  return <FilterSubMenu id={id} {...rest}>\n    <InputGrid>\n      <InputGridItem xs={12}>\n        <Box marginTop={2}>\n          {andFilters.map((filter, index) => (\n            <Box key={index} marginY={1}>\n              <QuantityFilter\n                quantities={quantities}\n                filter={filter}\n                onChange={filter => handleFilterChange(filter, index)}\n              />\n            </Box>\n          ))}\n          <Box flexDirection=\"row\" display=\"flex\">\n            <Button\n              variant=\"contained\" color=\"primary\" onClick={handleAndClicked}\n            >And</Button>\n            <Box marginLeft={1}>\n              <Button\n                variant=\"contained\" color=\"primary\" onClick={handleClearClicked}\n                disabled={andFilters.length === 1 && Object.keys(andFilters[0]).length === 0}\n              >Clear</Button>\n            </Box>\n          </Box>\n        </Box>\n      </InputGridItem>\n      <InputGridItem xs={12}>\n        <Box marginTop={2} display=\"flex\" flexDirection=\"row\" justifyContent=\"right\">\n          <Button\n            variant=\"contained\" color=\"primary\" onClick={handleSearchClicked}\n            disabled={!searchEnabled}\n          >Update search</Button>\n        </Box>\n      </InputGridItem>\n    </InputGrid>\n  </FilterSubMenu>\n})\nFilterSubMenuCustomQuantities.propTypes = {\n  id: PropTypes.string\n}\n\nexport default FilterSubMenuCustomQuantities\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useEffect, useMemo, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { Alert } from '@material-ui/lab'\nimport { has } from 'lodash'\nimport {\n  FilterMenu,\n  FilterMenuItem,\n  FilterMenuItems,\n  FilterSubMenus\n} from './FilterMenu'\nimport { makeStyles } from '@material-ui/core/styles'\nimport FilterSubMenuElements from './FilterSubMenuElements'\nimport FilterSubMenuStructure from './FilterSubMenuStructure'\nimport FilterSubMenuMethod from './FilterSubMenuMethod'\nimport FilterSubMenuPrecision from './FilterSubMenuPrecision'\nimport FilterSubMenuDFT from './FilterSubMenuDFT'\nimport FilterSubMenuTB from './FilterSubMenuTB'\nimport FilterSubMenuGW from './FilterSubMenuGW'\nimport FilterSubMenuBSE from './FilterSubMenuBSE'\nimport FilterSubMenuDMFT from './FilterSubMenuDMFT'\nimport FilterSubMenuEELS from './FilterSubMenuEELS'\nimport FilterSubMenuElectronic from './FilterSubMenuElectronic'\nimport FilterSubMenuSolarCell from './FilterSubMenuSolarCell'\nimport FilterSubMenuCatalyst from './FilterSubMenuCatalystProperties'\nimport FilterSubMenuVibrational from './FilterSubMenuVibrational'\nimport FilterSubMenuMechanical from './FilterSubMenuMechanical'\nimport FilterSubMenuMolecularDynamics from './FilterSubMenuMolecularDynamics'\nimport FilterSubMenuELN from './FilterSubMenuELN'\nimport FilterSubMenuAuthor from './FilterSubMenuAuthor'\nimport FilterSubMenuMetadata from './FilterSubMenuMetadata'\nimport FilterSubMenuOptimade from './FilterSubMenuOptimade'\nimport { useSearchContext } from '../SearchContext'\nimport { delay } from '../../../utils'\nimport FilterSubMenuGeometryOptimization from './FilterSubMenuGeometryOptimization'\nimport InputCheckbox from '../input/InputCheckbox'\nimport FilterSubMenuCustomQuantities from './FilterSubMenuCustomQuantities'\n\nexport const menuMap = {\n  elements: FilterSubMenuElements,\n  structure: FilterSubMenuStructure,\n  method: FilterSubMenuMethod,\n  precision: FilterSubMenuPrecision,\n  dft: FilterSubMenuDFT,\n  tb: FilterSubMenuTB,\n  gw: FilterSubMenuGW,\n  bse: FilterSubMenuBSE,\n  dmft: FilterSubMenuDMFT,\n  eels: FilterSubMenuEELS,\n  electronic: FilterSubMenuElectronic,\n  solarcell: FilterSubMenuSolarCell,\n  heterogeneouscatalyst: FilterSubMenuCatalyst,\n  vibrational: FilterSubMenuVibrational,\n  mechanical: FilterSubMenuMechanical,\n  molecular_dynamics: FilterSubMenuMolecularDynamics,\n  geometry_optimization: FilterSubMenuGeometryOptimization,\n  eln: FilterSubMenuELN,\n  custom_quantities: FilterSubMenuCustomQuantities,\n  author: FilterSubMenuAuthor,\n  metadata: FilterSubMenuMetadata,\n  optimade: FilterSubMenuOptimade\n}\n\nconst useFilterMainMenuStyles = makeStyles(theme => ({\n  combine: {\n  }\n}))\n\n/**\n * Swipable menu that shows the available filters on the left side of the\n * screen.\n */\nconst FilterMainMenu = React.memo(({\n  open,\n  onOpenChange,\n  collapsed,\n  onCollapsedChange\n}) => {\n  const [value, setValue] = React.useState()\n  const {filterMenus} = useSearchContext()\n  const [loaded, setLoaded] = useState(false)\n  const styles = useFilterMainMenuStyles()\n\n  // Rendering the submenus is delayed on the event queue: this makes loading\n  // the search page more responsive by first loading everything else.\n  useEffect(() => {\n    delay(() => { setLoaded(true) })\n  }, [])\n\n  // The shown menu items\n  const menuItems = useMemo(() => {\n    return filterMenus?.options\n     ? Object.values(filterMenus.options).map(option => {\n        return <FilterMenuItem\n          key={option.key}\n          id={option.key}\n          label={option.label}\n          level={option.level}\n          disableButton={!has(menuMap, option.key)}\n          actions={option?.actions?.options && Object.values(option.actions.options)\n            .map((action) => {\n              const content = action.type === 'checkbox'\n                ? <InputCheckbox\n                  key={action.key}\n                  quantity={action.quantity}\n                  description={action.tooltip}\n                  label={action.label}\n                  className={styles.combine}\n                ></InputCheckbox>\n                : null\n              return content\n          })}\n        />\n      })\n    : <Alert severity=\"warning\">\n      No search menus defined within this search context. Ensure that all GUI artifacts are created.\n    </Alert>\n  }, [filterMenus, styles])\n\n  // The shown submenus\n  const subMenus = useMemo(() => {\n    return filterMenus?.options\n      ? Object.values(filterMenus.options)\n        .filter(option => menuMap[option.key])\n        .map(option => {\n          const Comp = menuMap[option.key]\n          return <Comp\n            key={option.key}\n            id={option.key}\n            label={option.label}\n            size={option.size}\n          />\n        })\n      : null\n  }, [filterMenus])\n\n  return <FilterMenu\n    selected={value}\n    onSelectedChange={setValue}\n    open={open}\n    onOpenChange={onOpenChange}\n    collapsed={collapsed}\n    onCollapsedChange={onCollapsedChange}\n  >\n    <FilterMenuItems>\n      {menuItems}\n    </FilterMenuItems>\n    <FilterSubMenus>\n      {loaded && subMenus}\n    </FilterSubMenus>\n  </FilterMenu>\n})\nFilterMainMenu.propTypes = {\n  open: PropTypes.bool,\n  onOpenChange: PropTypes.func,\n  collapsed: PropTypes.bool,\n  onCollapsedChange: PropTypes.func\n}\n\nexport default FilterMainMenu\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useMemo } from 'react'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\nimport { isNil, isEmpty, isPlainObject } from 'lodash'\nimport { useSearchContext } from './SearchContext'\nimport { useUnitContext } from '../units/UnitContext'\nimport { Typography, Box, Chip } from '@material-ui/core'\nimport FilterTitle from './FilterTitle'\nimport Ellipsis from '../visualization/Ellipsis'\nimport ClearIcon from '@material-ui/icons/Clear'\nimport ReplayIcon from '@material-ui/icons/Replay'\nimport LockIcon from '@material-ui/icons/Lock'\nimport CodeIcon from '@material-ui/icons/Code'\nimport { Actions, Action } from '../Actions'\nimport { SourceApiCall, SourceApiDialogButton, SourceDialogDivider, SourceJsonCode } from '../buttons/SourceDialogButton'\n\n/**\n * Thin wrapper for MUI Chip that is used for displaying (and possibly removing)\n * query values.\n */\nconst useQueryChipStyles = makeStyles(theme => ({\n  root: {\n    maxWidth: '100%'\n  },\n  chipRoot: {\n    width: '100%',\n    maxWidth: '100%'\n  },\n  chipLabel: {\n    minWidth: '1rem',\n    maxWidth: '25rem'\n  }\n}))\nexport const QueryChip = React.memo(({\n  label,\n  onDelete,\n  color,\n  className,\n  locked\n}) => {\n  const styles = useQueryChipStyles()\n\n  return <div className={clsx(className, styles.root)}>\n    <Chip\n      label={<Ellipsis tooltip={label}>{label}</Ellipsis>}\n      onDelete={locked ? undefined : onDelete}\n      color={locked ? undefined : color}\n      icon={locked ? <LockIcon/> : undefined}\n      classes={{root: styles.chipRoot, label: styles.chipLabel}}\n    />\n  </div>\n})\n\nQueryChip.propTypes = {\n  label: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  onDelete: PropTypes.func,\n  color: PropTypes.string,\n  className: PropTypes.string,\n  locked: PropTypes.bool\n}\nQueryChip.defaultProps = {\n  color: 'primary'\n}\n\n/**\n * Used to group several related query chips inside one container.\n */\nexport const queryTitleHeight = 2.2\nexport const queryGroupHeight = 4.1 + queryTitleHeight\nexport const queryGroupSpacing = 0.5\nconst useQueryChipGroupStyles = makeStyles(theme => ({\n  root: {\n    position: 'relative',\n    minHeight: theme.spacing(queryGroupHeight),\n    marginLeft: theme.spacing(queryGroupSpacing),\n    marginRight: theme.spacing(queryGroupSpacing)\n  },\n  chips: {\n    marginTop: theme.spacing(queryTitleHeight),\n    display: 'flex',\n    flexDirection: 'row',\n    flexWrap: 'wrap',\n    alignItems: 'center',\n    justifyContent: 'center',\n    backgroundColor: theme.palette.primary.main,\n    borderRadius: theme.spacing(2)\n  },\n  titleRoot: {\n    position: 'absolute',\n    left: theme.spacing(0.4),\n    right: 0,\n    top: 0,\n    height: theme.spacing(queryTitleHeight)\n  },\n  title: {\n    color: theme.palette.grey[600]\n  }\n}))\nexport const QueryChipGroup = React.memo(({\n  quantity,\n  className,\n  children\n}) => {\n  const styles = useQueryChipGroupStyles()\n  return <div className={clsx(className, styles.root)}>\n    <FilterTitle\n      quantity={quantity}\n      variant=\"caption\"\n      classes={{root: styles.titleRoot, text: styles.title}}\n      disableUnit\n    />\n    <div className={styles.chips}>\n      {children}\n    </div>\n  </div>\n})\n\nQueryChipGroup.propTypes = {\n  quantity: PropTypes.string,\n  color: PropTypes.string,\n  className: PropTypes.string,\n  children: PropTypes.node\n}\nQueryChipGroup.defaultProps = {\n  color: 'primary'\n}\n\n/**\n * Operators between query chips.\n */\nconst useQueryOpStyles = makeStyles(theme => ({\n  root: {\n    fontSize: '0.6rem',\n    marginLeft: theme.spacing(0.2),\n    marginRight: theme.spacing(0),\n    color: 'white'\n  }\n}))\nexport const QueryOp = React.memo(({className, children}) => {\n  const styles = useQueryOpStyles()\n  return <Typography variant=\"caption\" className={clsx(className, styles.root)}>{children}</Typography>\n})\n\nQueryOp.propTypes = {\n  className: PropTypes.string,\n  children: PropTypes.node\n}\n\nexport const QueryAnd = React.memo(() => {\n  return <QueryOp>AND</QueryOp>\n})\n\nexport const QueryOr = React.memo(() => {\n  return <QueryOp>OR</QueryOp>\n})\n\n// Custom function for chip creation\nconst createChips = (name, filterValue, onDelete, filterData, units) => {\n  if (isNil(filterValue)) return []\n\n  const { serializerPretty: serializer, customSerialization, queryMode } = filterData[name]\n  const isArray = Array.isArray(filterValue)\n  const isSet = filterValue instanceof Set\n  const isObj = isPlainObject(filterValue)\n  const op = queryMode === \"any\" ? <QueryOr/> : <QueryAnd/>\n  const chips = []\n\n  const createChip = (label, onDelete, single = false) => (\n    <QueryChip key={label} label={label} onDelete={onDelete} single={single}/>\n  )\n\n  if (customSerialization) {\n    chips.push({ comp: createChip(serializer(filterValue), () => onDelete(undefined)), op })\n  } else if (isArray || isSet) {\n    Array.from(filterValue).forEach((value, index) => {\n      chips.push({\n        comp: createChip(serializer(value, units), () => {\n          const newValue = isSet ? new Set(filterValue) : [...filterValue]\n          isSet ? newValue.delete(value) : newValue.splice(index, 1)\n          onDelete(newValue)\n        }),\n        op\n      })\n    })\n  } else if (isObj) {\n    const createRangeChip = (label, comparison) => {\n      const content = `${comparison} ${serializer(filterValue[label], units)}`\n      if (!isNil(filterValue[label])) {\n        let newValue = {...filterValue}\n        delete newValue[label]\n        newValue = isEmpty(newValue) ? undefined : newValue\n        chips.push({ comp: createChip(content, () => onDelete(newValue)), op })\n      }\n    }\n\n    createRangeChip('lte', '<=')\n    createRangeChip('lt', '<')\n    createRangeChip('gte', '>=')\n    createRangeChip('gt', '>')\n  } else {\n    chips.push({ comp: createChip(serializer(filterValue), () => onDelete(undefined)), op })\n  }\n\n  return chips.length ? (\n    <QueryChipGroup key={name} quantity={name}>\n      {chips.map((chip, index) => (\n        <React.Fragment key={index}>\n          {chip.comp}\n          {index < chips.length - 1 && chip.op}\n        </React.Fragment>\n      ))}\n    </QueryChipGroup>\n  ) : null\n}\n\n/*\n * Displays chips for the current query.\n */\nconst useStyles = makeStyles(theme => ({\n  root: {\n    width: '100%',\n    boxSizing: 'border-box',\n    display: 'flex',\n    flexDirection: 'row',\n    flexWrap: 'wrap',\n    alignItems: 'flex-end',\n    marginLeft: theme.spacing(-queryGroupSpacing),\n    marginRight: theme.spacing(-queryGroupSpacing)\n  },\n  empty: {\n    marginTop: theme.spacing(1.8)\n  },\n  chip: {\n    padding: theme.spacing(0.5)\n  }\n}))\nconst QueryChips = React.memo(({ className, classes }) => {\n  const { filterData, useQuery, useUpdateFilter } = useSearchContext()\n  const query = useQuery()\n  const updateFilter = useUpdateFilter()\n  const theme = useTheme()\n  const { units } = useUnitContext()\n  const styles = useStyles({ classes, theme })\n\n  const chips = useMemo(() => {\n    const chips = []\n    // The query chips are created in alphabetical order\n    const keys = Object.keys(query)\n    keys.sort()\n    for (const quantity of keys) {\n      const filterValue = query[quantity]\n      // Each key in a section is mapped into a group\n      const isSection = filterData[quantity].section\n      if (isSection) {\n        const addChipsForSection = (data) => {\n          const newChips = []\n          Object.entries(data).forEach(([key, value], index) => {\n            // Empty filters are skipped\n            if (isEmpty(value)) return\n            const onDelete = (newValue) => {\n              const newSection = { ...data, [key]: newValue }\n              if (newValue === undefined) delete newSection[key]\n              updateFilter([quantity, newSection])\n            }\n            newChips.push(\n              <React.Fragment key={`${quantity}.${key}`}>\n                {createChips(`${quantity}.${key}`, value, onDelete, filterData, units)}\n                {index < Object.entries(data).length - 1 && <QueryAnd/>}\n              </React.Fragment>\n            )\n          })\n          return newChips\n        }\n        const newChips = addChipsForSection(filterValue)\n        newChips.length && chips.push(newChips)\n      // Regular chips get their own group\n      } else {\n        const onDelete = (newValue) => updateFilter([quantity, newValue])\n        chips.push(createChips(quantity, filterValue, onDelete, filterData, units))\n      }\n    }\n\n    return chips\n  }, [query, filterData, units, updateFilter])\n\n  return (\n    <div className={clsx(className, styles.root)}>\n      {chips.length\n        ? chips\n        : <Typography className={styles.empty}><i>Your query will be shown here</i></Typography>\n      }\n    </div>\n  )\n})\n\nQueryChips.propTypes = {\n  className: PropTypes.string,\n  classes: PropTypes.object\n}\n\nconst useQueryStyles = makeStyles(theme => ({\n  root: {\n    minHeight: theme.spacing(queryGroupHeight),\n    margin: theme.spacing(1, 0.25),\n    width: '100%',\n    display: 'flex',\n    flexDirection: 'row',\n    alignItems: 'flex-start'\n  },\n  offset: {\n    height: theme.spacing(queryGroupHeight),\n    display: 'flex',\n    flexDirection: 'row',\n    alignItems: 'center',\n    width: 'unset'\n  }\n}))\n\n/**\n * Displays the current query and actions for it.\n */\nconst Query = React.memo(() => {\n  const {useResetFilters, useRefresh, useApiData} = useSearchContext()\n  const styles = useQueryStyles()\n  const resetFilters = useResetFilters()\n  const refresh = useRefresh()\n  const apiData = useApiData()\n\n  return <Box className={styles.root}>\n    <QueryChips/>\n    <Actions className={styles.offset}>\n      <Action\n        tooltip=\"Clear query\"\n        onClick={() => resetFilters()}\n      >\n        <ClearIcon fontSize=\"small\"/>\n      </Action>\n      <Action\n        tooltip=\"Refresh results\"\n        onClick={() => refresh()}\n      >\n        <ReplayIcon fontSize=\"small\"/>\n      </Action>\n      <Action\n        tooltip=\"\"\n        ButtonComponent={SourceApiDialogButton}\n        ButtonProps={{\n          tooltip: \"View API call for the query\",\n          maxWidth: \"lg\",\n          fullWidth: true,\n          icon: <CodeIcon fontSize=\"small\"/>,\n          buttonProps: {\n            size: \"small\"\n          }\n        }}\n      >\n        <Typography>\n          NOMAD uses the same query format throughout its API. This is the query\n          based on the current filters:\n        </Typography>\n        <SourceJsonCode data={{owner: apiData?.body?.owner, query: apiData?.body?.query}}/>\n        <SourceDialogDivider/>\n        <Typography>\n          One application of the above query is this API call. This is what is currently\n          used to render this page and includes all displayed statistics data\n          (aggregations).\n        </Typography>\n        <SourceApiCall\n          {...apiData}\n        />\n      </Action>\n    </Actions>\n  </Box>\n})\nQuery.propTypes = {}\n\nexport default Query\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useState, useEffect, useMemo, useCallback, forwardRef} from 'react'\nimport PropTypes from 'prop-types'\nimport { makeStyles, useTheme } from '@material-ui/core'\nimport { hasWebGLSupport } from '../../utils'\nimport * as d3 from 'd3'\nimport FilterTitle from '../search/FilterTitle'\nimport Plot from './Plot'\nimport { useHistory } from 'react-router-dom'\nimport { getUrl } from '../nav/Routes'\n\n/**\n * A Plotly-based interactive scatter plot.\n */\nconst hasWebGL = hasWebGLSupport()\nconst useStyles = makeStyles(theme => ({\n  root: {\n    width: '100%',\n    height: '100%',\n    boxSizing: 'border-box',\n    display: 'grid',\n    gridTemplateColumns: 'auto 1fr',\n    gridTemplateRows: '1fr auto',\n    marginBottom: theme.spacing(0.5)\n  },\n  plot: {\n    gridColumn: 2,\n    gridRow: 1,\n    position: 'relative'\n  },\n  xaxis: {\n    gridColumn: 2,\n    gridRow: 2,\n    display: 'flex',\n    flexDirection: 'row',\n    alignItems: 'center',\n    justifyContent: 'center',\n    height: '1rem',\n    marginTop: theme.spacing(0.5)\n  },\n  yaxis: {\n    gridColumn: 1,\n    gridRow: 1,\n    height: '100%',\n    marginRight: theme.spacing(0.5),\n    width: '1rem',\n    display: 'flex',\n    flexDirection: 'row',\n    alignItems: 'center',\n    justifyContent: 'center'\n  },\n  square: {\n    gridColumn: 1,\n    gridRow: 2\n  },\n  color: {\n    gridColumn: 3,\n    gridRow: 1,\n    height: '100%',\n    marginLeft: theme.spacing(0.5),\n    width: '1rem',\n    display: 'flex',\n    flexDirection: 'row',\n    alignItems: 'center',\n    justifyContent: 'center'\n  },\n  colorlabel: {\n    transform: 'rotate(90deg)'\n  }\n}))\nconst PlotScatter = React.memo(forwardRef((\n{\n  data,\n  title,\n  xAxis,\n  yAxis,\n  colorAxis,\n  discrete,\n  autorange,\n  dragmode,\n  onSelected,\n  onDeselect,\n  onNavigateToEntry,\n  'data-testid': testID\n}, canvas) => {\n  const styles = useStyles()\n  const theme = useTheme()\n  const [finalData, setFinalData] = useState(!data ? data : undefined)\n  const history = useHistory()\n\n  // Side effect that runs when the data that is displayed should change. By\n  // running all this heavy stuff within useEffect (instead of e.g. useMemo),\n  // the first render containing the placeholders etc. can be done as fast as\n  // possible.\n  useEffect(() => {\n    if (!data) {\n      setFinalData(data)\n      return\n    }\n\n    const hoverTemplate = (xLabel, yLabel, colorLabel, xUnit, yUnit, colorUnit) => {\n      let template = `<b>Click to go to entry page</b>` +\n        `<br>` +\n        `${xLabel || ''}: %{x} ${xUnit === 'dimensionless' ? '' : xUnit}<br>` +\n        `${yLabel || ''}: %{y} ${yUnit === 'dimensionless' ? '' : yUnit}<br>`\n      if (colorLabel) {\n        template = template +\n          `${colorLabel || ''}: %{${discrete ? 'text' : 'text:.3'}} ${colorUnit === 'dimensionless' ? '' : colorUnit}<br>`\n      }\n      template = template + `<extra></extra>`\n      return template\n    }\n    const scatterType = hasWebGL ? 'scattergl' : 'scatter'\n\n    // If dealing with a quantized color, each group is separated into it's own\n    // trace which has a legend as well.\n    const traces = []\n    if (colorAxis?.quantity && discrete) {\n      const options = [...new Set(data.color)]\n      const nOptions = options.length\n      const scale = d3.scaleSequential([0, 1], d3.interpolateTurbo)\n      const offset = 0.1\n      for (const option of options) {\n        const xArray = []\n        const yArray = []\n        const colorArray = []\n        const entryIdArray = []\n        for (let i = 0; i < data.color.length; ++i) {\n          if (data.color[i] === option) {\n            xArray.push(data.x[i])\n            yArray.push(data.y[i])\n            colorArray.push(data.color[i])\n            entryIdArray.push(data.id[i])\n          }\n        }\n        traces.push({\n          x: xArray,\n          y: yArray,\n          entry_id: entryIdArray,\n          name: option,\n          text: colorArray,\n          mode: 'markers',\n          type: scatterType,\n          textposition: 'top center',\n          showlegend: true,\n          hovertemplate: hoverTemplate(\n            xAxis.title,\n            yAxis.title,\n            colorAxis.title,\n            xAxis.unit,\n            yAxis.unit,\n            ''\n          ),\n          marker: {\n            size: 8,\n            color: scale(offset + (1 - 2 * offset) * options.indexOf(option) / (nOptions - 1)),\n            line: {\n              color: theme.palette.grey[800],\n              width: 1\n            }\n          }\n        })\n      }\n    // When dealing with a continuous color, display a colormap\n    } else if (colorAxis?.quantity && !discrete) {\n      traces.push({\n        x: data.x,\n        y: data.y,\n        color: data.color,\n        text: data.color,\n        entry_id: data.id,\n        mode: 'markers',\n        type: scatterType,\n        textposition: 'top center',\n        showlegend: false,\n        hoverinfo: \"text\",\n        hovertemplate: hoverTemplate(\n          xAxis.title,\n          yAxis.title,\n          colorAxis.title,\n          xAxis.unit,\n          yAxis.unit,\n          colorAxis.unit\n        ),\n        marker: {\n          size: 8,\n          color: data.color,\n          colorscale: 'YlGnBu',\n          line: {\n            color: theme.palette.grey[800],\n            width: 1\n          },\n          colorbar: {\n            thickness: 20,\n            ypad: 0,\n            xpad: 5,\n            tickfont: {\n              family: theme.typography.fontFamily\n            }\n          }\n        }\n      })\n    // When color is not set, all points are displayed in a single plot with\n    // primary theme color.\n    } else {\n      traces.push({\n        x: data.x,\n        y: data.y,\n        entry_id: data.id,\n        mode: 'markers',\n        type: scatterType,\n        textposition: 'top center',\n        showlegend: false,\n        hoverinfo: \"text\",\n        hovertemplate: hoverTemplate(\n          xAxis.title,\n          yAxis.title,\n          '',\n          xAxis.unit,\n          yAxis.unit,\n          ''\n        ),\n        marker: {\n          size: 8,\n          color: theme.palette.secondary.main,\n          line: {\n            color: theme.palette.grey[800],\n            width: 1\n          }\n        }\n      })\n    }\n    setFinalData(traces)\n  }, [colorAxis?.quantity, colorAxis?.title, colorAxis?.unit, data, discrete, theme, xAxis.title, xAxis.unit, yAxis.title, yAxis.unit])\n\n  const layout = useMemo(() => {\n    return {\n      dragmode: dragmode,\n      hovermode: 'closest',\n      hoverlabel: {\n        bgcolor: theme.palette.grey[100],\n        bordercolor: theme.palette.grey[100],\n        font: {\n          color: theme.palette.grey[800],\n          family: theme.typography.fontFamily\n        }\n      },\n      showlegend: true,\n      legend: {\n        x: 1,\n        xanchor: 'right',\n        y: 1\n      },\n      xaxis: {\n        type: xAxis.scale,\n        fixedrange: false,\n        autorange: autorange\n      },\n      yaxis: {\n        type: yAxis.scale,\n        fixedrange: false,\n        autorange: autorange\n      },\n      margin: {\n        l: 8,\n        r: 0,\n        t: 8,\n        b: 24\n      }\n    }\n  // Any further changes to dragmode need to be handled through callbacks in\n  // order to do the layout updates correctly. TODO: The plot component should\n  // have a consistent way for handling layout changes: they should either\n  // happen through a property or through some update function, but not through\n  // both. This is a general problem in trying to 'reactify' a non-react library\n  // like Plotly.\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [autorange, xAxis.scale, yAxis.scale])\n\n  // Change dragmode\n  useEffect(() => {\n    canvas.current?.relayout && canvas.current.relayout((layout) => {\n      return {\n        ...layout,\n        dragmode\n      }\n    })\n  }, [dragmode, canvas])\n\n  const handleClick = useCallback(d => {\n    const pointIndex = d.points[0].pointIndex\n    const entryId = d.points[0].data.entry_id[pointIndex]\n    const path = `entry/id/${entryId}`\n    onNavigateToEntry()\n    history.push(getUrl(path))\n  }, [history, onNavigateToEntry])\n\n  return <div className={styles.root}>\n    <div className={styles.yaxis}>\n      <FilterTitle\n        quantity={yAxis.quantity}\n        label={yAxis.title}\n        unit={yAxis.unit}\n        variant=\"caption\"\n        rotation=\"up\"\n      />\n    </div>\n    <div className={styles.plot}>\n      <Plot\n        data={finalData}\n        layout={layout}\n        floatTitle={title}\n        fixedMargins={true}\n        autorange={autorange}\n        onSelected={onSelected}\n        onDeselect={onDeselect}\n        disableDefaultActions\n        throttleResize\n        data-testid={testID}\n        ref={canvas}\n        onClick={handleClick}\n      />\n    </div>\n    <div className={styles.square} />\n    <div className={styles.xaxis}>\n      <FilterTitle\n        quantity={xAxis.quantity}\n        label={xAxis.title}\n        unit={xAxis.unit}\n        variant=\"caption\"\n      />\n    </div>\n    {!discrete && colorAxis &&\n      <div className={styles.color}>\n        <FilterTitle\n          rotation=\"down\"\n          quantity={colorAxis.quantity}\n          unit={colorAxis.unit}\n          label={colorAxis.title}\n          description=\"\"\n          variant=\"caption\"\n        />\n      </div>\n    }\n  </div>\n}))\n\nPlotScatter.propTypes = {\n  data: PropTypes.object,\n  title: PropTypes.string,\n  xAxis: PropTypes.object, // Contains x-axis settings\n  yAxis: PropTypes.object, // Contains y-axis settings\n  colorAxis: PropTypes.object, // Contains colorbar settings\n  discrete: PropTypes.bool,\n  autorange: PropTypes.bool,\n  dragmode: PropTypes.string,\n  onSelected: PropTypes.func,\n  onDeselect: PropTypes.func,\n  onNavigateToEntry: PropTypes.func,\n  'data-testid': PropTypes.string\n}\n\nPlotScatter.defaultProps = {\n  unitX: 'dimensionless',\n  unitY: 'dimensionless',\n  unitColor: 'dimensionless'\n}\n\nexport default PlotScatter\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useCallback, useEffect, useMemo, useRef, useState} from 'react'\nimport PropTypes from 'prop-types'\nimport { number, bool } from 'yup'\nimport jmespath from 'jmespath'\nimport { isEmpty, isArray, isEqual, range, isNil, flattenDeep } from 'lodash'\nimport {\n  Divider,\n  Tooltip,\n  makeStyles\n} from '@material-ui/core'\nimport { ToggleButton, ToggleButtonGroup, Alert } from '@material-ui/lab'\nimport { Widget, schemaWidget, schemaAxis, schemaMarkers } from './Widget'\nimport { useSearchContext } from '../SearchContext'\nimport Floatable from '../../visualization/Floatable'\nimport PlotScatter from '../../plotting/PlotScatter'\nimport { Action, ActionCheckbox } from '../../Actions'\nimport { CropFree, PanTool, Fullscreen, Replay } from '@material-ui/icons'\nimport { autorangeDescription } from './WidgetHistogram'\nimport { styled } from '@material-ui/core/styles'\nimport {DType, parseJMESPath, getDisplayLabel} from '../../../utils'\nimport { Quantity } from '../../units/Quantity'\nimport { Unit } from '../../units/Unit'\nimport { useUnitContext } from '../../units/UnitContext'\n\nconst StyledToggleButtonGroup = styled(ToggleButtonGroup)(({ theme }) => ({\n  '& .MuiToggleButtonGroup-grouped': {\n    margin: theme.spacing(0, 0.25),\n    border: 0,\n    '&.Mui-disabled': {\n      border: 0\n    },\n    '&:not(:first-of-type)': {\n      borderRadius: theme.shape.borderRadius\n    },\n    '&:first-of-type': {\n      borderRadius: theme.shape.borderRadius\n    }\n  }\n}))\n\n/**\n * A thin wrapper for displaying a Plotly scatter plot as a widget.\n */\nconst useStyles = makeStyles((theme) => ({\n  widget: {\n    width: '100%',\n    height: '100%'\n  },\n  divider: {\n    margin: theme.spacing(0.5, 0.5)\n  },\n  alert: {\n    overflow: 'auto'\n  }\n}))\n\nexport const WidgetScatterPlot = React.memo((\n{\n  id,\n  title,\n  description,\n  x,\n  y,\n  markers,\n  size,\n  autorange,\n  dragmode,\n  className,\n  onSelected\n}) => {\n  const styles = useStyles()\n  const {units} = useUnitContext()\n  const canvas = useRef()\n  const [float, setFloat] = useState(false)\n  const [loading, setLoading] = useState(true)\n  const { useSetWidget, useHits, filterData, useSetFilter } = useSearchContext()\n\n  // Parse additional JMESPath config\n  const [xParsed, yParsed, colorParsed, error] = useMemo(() => {\n    const xParsed = parseJMESPath(x?.quantity)\n    const yParsed = parseJMESPath(y?.quantity)\n    const colorParsed = markers?.color?.quantity ? parseJMESPath(markers.color.quantity) : {}\n    if (xParsed.error || yParsed.error || colorParsed.error) {\n      return [{}, {}, {}, 'Invalid JMESPath query, please check your syntax.']\n    }\n    return [xParsed, yParsed, colorParsed, undefined]\n  }, [markers?.color?.quantity, x?.quantity, y?.quantity])\n\n  // Parse units\n  const {unitXObj, unitYObj, unitColorObj, displayUnitX, displayUnitY, displayUnitColor, discrete} = useMemo(() => {\n    if (error) return {}\n    const unitXObj = new Unit(filterData[xParsed.quantity].unit || 'dimensionless')\n    const unitYObj = new Unit(filterData[yParsed.quantity].unit || 'dimensionless')\n    const unitColorObj = new Unit(filterData[colorParsed?.quantity]?.unit || 'dimensionless')\n    const displayUnitX = x.unit ? new Unit(x.unit) : unitXObj.toSystem(units)\n    const displayUnitY = y.unit ? new Unit(y.unit) : unitYObj.toSystem(units)\n    const displayUnitColor = markers?.color?.unit ? new Unit(markers?.color?.unit) : unitColorObj.toSystem(units)\n    const discrete = colorParsed?.quantity && new Set([DType.String, DType.Enum]).has(filterData[colorParsed.quantity]?.dtype)\n    return {unitXObj, unitYObj, unitColorObj, displayUnitX, displayUnitY, displayUnitColor, discrete}\n  }, [filterData, x.unit, xParsed.quantity, y.unit, yParsed.quantity, markers?.color?.unit, colorParsed?.quantity, units, error])\n\n  // Create final axis config for the plot\n  const {xAxis, yAxis, colorAxis} = useMemo(() => {\n    if (error) return {}\n    const xFilter = filterData[xParsed.quantity]\n    const yFilter = filterData[yParsed.quantity]\n    const colorFilter = filterData[colorParsed.quantity]\n    const xTitle = x.title || xFilter?.label || getDisplayLabel(xFilter)\n    const yTitle = y.title || yFilter?.label || getDisplayLabel(yFilter)\n    const xType = xFilter?.dtype\n    const yType = yFilter?.dtype\n    const colorTitle = markers?.color?.title || colorFilter?.label || getDisplayLabel(colorFilter)\n    const unitLabelX = displayUnitX.label()\n    const unitLabelY = displayUnitY.label()\n    const unitLabelColor = displayUnitColor.label()\n    return {\n      xAxis: {...x, ...xParsed, title: xTitle, unit: unitLabelX, type: xType},\n      yAxis: {...y, ...yParsed, title: yTitle, unit: unitLabelY, type: yType},\n      colorAxis: markers?.color ? {...markers.color, ...colorParsed, title: colorTitle, unit: unitLabelColor} : {}\n    }\n  }, [colorParsed, displayUnitColor, displayUnitX, displayUnitY, filterData, markers?.color, x, xParsed, y, yParsed, error])\n\n  const setXFilter = useSetFilter(xParsed.quantity)\n  const setYFilter = useSetFilter(yParsed.quantity)\n\n  const setWidget = useSetWidget(id)\n  const pagination = useMemo(() => ({\n    page_size: size,\n    order: 'asc'\n  }), [size])\n  const required = useMemo(() => {\n    const include = new Set(['entry_id'])\n    for (const config of [xParsed, yParsed, colorParsed]) {\n      if (!isEmpty(config)) {\n        include.add(config.quantity)\n        for (const extra of config.extras) {\n          include.add(extra)\n        }\n      }\n    }\n    return {include: [...include]}\n  }, [xParsed, yParsed, colorParsed])\n\n  useEffect(() => {\n    setLoading(true)\n  }, [required, pagination])\n\n  const hitsCallback = useCallback(() => {\n    setLoading(false)\n  }, [])\n\n  // Fetch the data using the useHits hook that automatically applies the\n  // existing filters. We filter out data that is invalid (e.g. no values or\n  // incompatible sizes between x/y/color). TODO: The API should support an\n  // \"exists\" query that could be used to return hits that actually have the\n  // requested values.  This way we would get a better match for the query size\n  // and we would not need to manually validate and check the results.\n  const hits = useHits(id, required, pagination, hitsCallback)\n  const dataRaw = useMemo(() => {\n    if (!hits || error) return\n    function getData(hit) {\n      const hitData = {}\n\n      // Get each property using JMESPath. Errors at this stage will simply\n      // cause the entry to be ignored.\n      for (const [name, path] of [['x', xParsed.path], ['y', yParsed.path], ['color', colorParsed.path]]) {\n        if (isEmpty(path)) continue\n        let value\n        try {\n          value = jmespath.search(hit, path)\n        } catch (e) {\n          return {error: 'Invalid JMESPATH'}\n        }\n        // Missing x/y/color value will cause an error unless dealing with\n        // discretized colors\n        if (isNil(value)) {\n          if (name === 'color' && discrete) {\n            value = 'undefined'\n          } else {\n            return {error: 'Empty value'}\n          }\n        }\n        hitData[name] = value\n      }\n\n      // Get the shapes\n      const xShape = getShape(hitData.x)\n      const yShape = getShape(hitData.y)\n\n      // Check if x/y leaf shapes match\n      if (xShape[xShape.length - 1] !== yShape[yShape.length - 1]) {\n        return {error: 'Incompatible size for x/y'}\n      }\n\n      // If x/y shapes do not match, extend accordingly\n      const biggestShape = [xShape, yShape].reduce((prev, current) => {\n        return (prev.length > current.length)\n          ? prev\n          : current\n      })\n      hitData.x = extendFront(hitData.x, xShape, biggestShape)\n      hitData.y = extendFront(hitData.y, yShape, biggestShape)\n\n      // Modify color dimensions\n      let colorShape = colorParsed.path && getShape(hitData.color)\n      if (colorShape && !isEqual(colorShape, biggestShape)) {\n        // If color has one more dimension than other arrays and it is discrete,\n        // we reduce the last dimension to a single string\n        if (discrete && colorShape.length === biggestShape.length + 1) {\n          hitData.color = reduceInner(hitData.color)\n          colorShape = colorShape.slice(0, -1)\n        }\n        // Scalar color values are extended\n        if (colorShape.length === 0 || (colorShape.length === 1 && colorShape[0] === 1)) {\n          hitData.color = fill(\n            biggestShape,\n            colorShape.length === 0\n               ? hitData.color\n               : hitData.color[0]\n          )\n        // Colors are extended according to traces\n        } else if ((colorShape.length < biggestShape.length) && colorShape[0] === biggestShape[0]) {\n          hitData.color = extendBack(hitData.color, colorShape, biggestShape)\n        } else {\n          return {error: 'Incompatible size for color'}\n        }\n      }\n\n      // Flatten arrays\n      hitData.x = flatten(hitData.x)\n      hitData.y = flatten(hitData.y)\n      hitData.color = colorParsed.path && flatten(hitData.color)\n\n      // If shapes still don't match, skip entry. TODO: This check is not ideal,\n      // since we may be accepting accidentally mathing sizes. A proper shape\n      // check that would also allow \"ragged arrays\" would be better.\n      if (hitData.x.length !== hitData.y.length || (colorParsed.path && hitData.x.length !== hitData.color.length)) {\n        return {error: 'Incompatible number of elements'}\n      }\n\n      return {hitData, nPoints: hitData.x.length}\n    }\n    const x = []\n    const y = []\n    const color = colorParsed.path ? [] : undefined\n    const id = []\n    for (const hit of hits) {\n      const {hitData, error, nPoints} = getData(hit)\n      if (error || !nPoints) continue\n      for (const i of range(nPoints)) {\n        x.push(hitData.x[i])\n        y.push(hitData.y[i])\n        colorParsed.path && color.push(hitData.color?.[i])\n        id.push(hit.entry_id)\n      }\n    }\n    return {x, y, color, id}\n  }, [discrete, hits, xParsed.path, yParsed.path, colorParsed.path, error])\n\n  // Perform unit conversion, report errors\n  const data = useMemo(() => {\n    if (!dataRaw) return\n    const x = xAxis.type === DType.Timestamp\n      ? dataRaw.x\n      : new Quantity(dataRaw.x, unitXObj).to(displayUnitX).value()\n    const y = yAxis.type === DType.Timestamp\n      ? dataRaw.y\n      : new Quantity(dataRaw.y, unitYObj).to(displayUnitY).value()\n    const color = dataRaw.color && (discrete\n      ? dataRaw.color\n      : new Quantity(dataRaw.color, unitColorObj).to(displayUnitColor).value()\n    )\n    return {x, y, color, id: dataRaw.id}\n  }, [dataRaw, displayUnitColor, displayUnitX, displayUnitY, unitColorObj, unitXObj, unitYObj, discrete, xAxis, yAxis])\n\n  const handleEdit = useCallback(() => {\n    setWidget(old => { return {...old, editing: true } })\n  }, [setWidget])\n\n  const handleDragModeChanged = useCallback((event, value) => {\n    if (value !== null) {\n      setWidget(old => ({...old, dragmode: value}))\n    }\n  }, [setWidget])\n\n  const handleResetClick = useCallback(() => {\n    canvas.current.reset()\n  }, [])\n\n  const handleFloat = useCallback(() => {\n    // The current layout needs to be saved, because the DOM change will\n    // cause it to be lost.\n    canvas.current?.saveLayout()\n    setFloat(old => !old)\n  }, [])\n\n  const handleSelected = useCallback((data) => {\n    const range = data?.range\n    if (!range) return\n    setXFilter({\n      gte: new Quantity(range.x[0], displayUnitX),\n      lte: new Quantity(range.x[1], displayUnitX)\n    })\n    setYFilter({\n      gte: new Quantity(range.y[0], displayUnitY),\n      lte: new Quantity(range.y[1], displayUnitY)\n    })\n    onSelected?.(data)\n  }, [onSelected, setXFilter, setYFilter, displayUnitX, displayUnitY])\n\n  const handleDeselect = useCallback(() => {\n    onSelected?.(undefined)\n  }, [onSelected])\n\n  const actions = useMemo(() => {\n      return <>\n        <ActionCheckbox\n          tooltip={autorangeDescription}\n          label=\"autorange\"\n          value={autorange}\n          onChange={(value) => setWidget(old => ({...old, autorange: value}))}\n        />\n        <Divider flexItem orientation=\"vertical\" className={styles.divider} />\n        <StyledToggleButtonGroup\n          size=\"small\"\n          value={dragmode}\n          exclusive\n          onChange={handleDragModeChanged}\n        >\n          <ToggleButton value=\"pan\">\n            <Tooltip title=\"Pan\">\n              <PanTool fontSize=\"small\"/>\n            </Tooltip>\n          </ToggleButton>\n          <ToggleButton value=\"select\">\n            <Tooltip title=\"Focus on region\">\n              <CropFree fontSize=\"small\"/>\n            </Tooltip>\n          </ToggleButton>\n        </StyledToggleButtonGroup>\n        <Divider flexItem orientation=\"vertical\" className={styles.divider} />\n        <Action tooltip='Reset view' onClick={handleResetClick}>\n          <Replay fontSize=\"small\"/>\n        </Action>\n        <Action tooltip='Toggle fullscreen' onClick={handleFloat}>\n          <Fullscreen fontSize=\"small\"/>\n        </Action>\n      </>\n  }, [dragmode, handleDragModeChanged, handleResetClick, handleFloat, autorange, setWidget, styles])\n\n  const handleNavigated = useCallback(() => {\n    setFloat(false)\n  }, [])\n\n  return <Floatable\n      className={className}\n      float={float}\n      onFloat={handleFloat}\n    >\n    <Widget\n      id={id}\n      title={title || \"Scatter plot\"}\n      description={description}\n      onEdit={handleEdit}\n      actions={actions}\n      className={styles.widget}\n    >\n      {error\n        ? <Alert severity=\"error\" className={styles.alert}>\n            {error}\n          </Alert>\n        : <PlotScatter\n          data={loading ? undefined : data}\n          xAxis={xAxis}\n          yAxis={yAxis}\n          colorAxis={colorAxis}\n          discrete={discrete}\n          autorange={autorange}\n          onSelected={handleSelected}\n          onDeselect={handleDeselect}\n          dragmode={dragmode}\n          onNavigateToEntry={handleNavigated}\n          data-testid={id}\n          ref={canvas}\n        />\n      }\n    </Widget>\n  </Floatable>\n})\n\nWidgetScatterPlot.propTypes = {\n  id: PropTypes.string.isRequired,\n  title: PropTypes.string,\n  description: PropTypes.string,\n  x: PropTypes.object,\n  y: PropTypes.object,\n  markers: PropTypes.object,\n  size: PropTypes.number,\n  autorange: PropTypes.bool,\n  dragmode: PropTypes.string,\n  className: PropTypes.string,\n  onSelected: PropTypes.func\n}\n\nexport const schemaWidgetScatterPlot = schemaWidget.shape({\n  x: schemaAxis.required('Quantity for the x axis is required.'),\n  y: schemaAxis.required('Quantity for the y axis is required.'),\n  markers: schemaMarkers,\n  size: number().integer().required('Size is required.'),\n  autorange: bool()\n})\n\n/**\n * Used to flatten the input into a single array of values.\n */\nfunction flatten(input) {\n  return isArray(input)\n    ? flattenDeep(input)\n    : [input]\n}\n\n/**\n * Gets the shape of an abitrarily nested array.\n */\nfunction getShape(input) {\n  if (!isArray(input)) {\n    return []\n  }\n\n  const shape = []\n  let inner = input\n\n  while (isArray(inner)) {\n    shape.push(inner.length)\n    inner = inner[0]\n  }\n\n  return shape\n}\n\n/**\n * Reduces the innermost dimension into a single value.\n */\nfunction reduceInner(input) {\n  function reduceRec(inp) {\n    if (isArray(inp)) {\n      if (isArray(inp[0])) {\n        for (let i = 0; i < inp.length; ++i) {\n          inp[i] = reduceRec(inp[i])\n        }\n      } else {\n        return inp.sort().join(\", \")\n      }\n    }\n    return inp\n  }\n  return reduceRec(input)\n}\n\n/**\n * Resizes the given array to a new size by extending the data to fit the front\n * dimensions (similar to array = array[None, :] in NumPy).\n */\nfunction extendFront(array, oldShape, newShape) {\n  // If shape is already correct, return the input array\n  const diff = newShape.length - oldShape.length\n  if (diff === 0) return array\n\n  // Extend the array\n  const extendedArray = []\n  function extendRec(depth) {\n    const dim = newShape[depth]\n    const hasData = depth === diff\n    if (hasData) {\n      return array\n    } else {\n      for (let j = 0; j < dim; ++j) {\n        extendedArray.push(extendRec(depth + 1))\n      }\n    }\n    return extendedArray\n  }\n  extendRec(0)\n  return extendedArray\n}\n\n/**\n * Resizes the given array to a new size by extending the data to fit the last\n * dimensions dimensions (similar to array = array[:, None] in NumPy).\n */\nfunction extendBack(array, oldShape, newShape) {\n  // If shape is already correct, return the input array\n  const diff = newShape.length - oldShape.length\n  if (diff === 0) return array\n\n  // Extend the array\n  const extendedArray = []\n  const nTraces = newShape[0]\n  for (let i = 0; i < nTraces; ++i) {\n    const traceArray = []\n    for (let j = 0; j < newShape[1]; ++j) {\n      traceArray.push([array[i]])\n    }\n    extendedArray.push(traceArray)\n  }\n  return extendedArray\n}\n\n/**\n * Creates a new array with the given shape, filled with the given value.\n */\nfunction fill(shape, fillValue) {\n  if (shape.length === 0) {\n    return fillValue\n  } else {\n    const innerShape = shape.slice(1)\n    const innerArray = []\n    for (let i = 0; i < shape[0]; i++) {\n        innerArray.push(fill(innerShape, fillValue))\n    }\n    return innerArray\n  }\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useCallback} from 'react'\nimport PropTypes from 'prop-types'\nimport {\n  List,\n  ListItem,\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  makeStyles,\n  MenuItem,\n  TextField,\n  Typography\n} from '@material-ui/core'\nimport { useSearchContext } from '../SearchContext'\n\n/**\n * A dialog that is used to configure a widget.\n */\nexport const useStyles = makeStyles(theme => ({\n  width: {\n    maxWidth: \"700px\"\n  }\n}))\nexport const WidgetEditDialog = React.memo(({id, title, open, visible, onAccept, onClose, error, children}) => {\n  const styles = useStyles()\n  const { useRemoveWidget } = useSearchContext()\n  const removeWidget = useRemoveWidget()\n\n  const handleClose = useCallback((event, reason) => {\n    // Do not close dialog on backdrop click: user may lose lot of filled info\n    // accidentally\n    if (reason === 'backdropClick') {\n      return\n    }\n\n    // If the widget has not bee visualized, then closing the dialog deletes\n    // the widget completely.\n    onClose && onClose()\n    if (!visible) {\n      removeWidget(id)\n    }\n  }, [id, onClose, removeWidget, visible])\n\n  const handleAccept = useCallback(() => {\n    onAccept && onAccept()\n  }, [onAccept])\n\n  return <Dialog\n    fullWidth={true}\n    maxWidth=\"sm\"\n    open={open}\n    classes={{paperWidthSm: styles.width}}\n    onClose={handleClose}\n  >\n    <DialogTitle>{title || ''}</DialogTitle>\n    <DialogContent>\n      {children}\n    </DialogContent>\n    <DialogActions>\n      <Button onClick={handleClose} color=\"primary\">\n        Cancel\n      </Button>\n      <Button disabled={!!error} onClick={handleAccept} color=\"primary\">\n        Done\n      </Button>\n    </DialogActions>\n  </Dialog>\n})\n\nWidgetEditDialog.propTypes = {\n  id: PropTypes.string,\n  title: PropTypes.string,\n  open: PropTypes.bool,\n  visible: PropTypes.bool,\n  onClose: PropTypes.func,\n  onAccept: PropTypes.func,\n  error: PropTypes.bool,\n  children: PropTypes.node\n\n}\n\n/**\n * A group of options in an edit dialog.\n */\nconst useEditGroupStyles = makeStyles((theme) => ({\n  heading: {\n    color: theme.palette.primary.main\n  },\n  list: {\n    width: '100%'\n  }\n}))\nexport const WidgetEditGroup = React.memo(({title, children}) => {\n  const styles = useEditGroupStyles()\n\n  return <>\n    <Typography variant=\"button\" className={styles.heading}>{title}</Typography>\n    <List dense className={styles.list}>\n      {children}\n    </List>\n  </>\n})\n\nWidgetEditGroup.propTypes = {\n  title: PropTypes.string,\n  children: PropTypes.node\n}\n\n/**\n * An option in an edit dialog.\n */\nexport const WidgetEditOption = React.memo(({children}) => {\n  return <ListItem>\n    {children}\n  </ListItem>\n})\n\nWidgetEditOption.propTypes = {\n  children: PropTypes.node\n}\n\n/**\n * Select (=dropdown) component for widget edit.\n */\nexport const WidgetEditSelect = React.memo(({label, disabled, options, value, onChange}) => {\n  return <TextField\n      select\n      fullWidth\n      label={label}\n      variant=\"filled\"\n      value={value || ''}\n      onChange={onChange}\n      disabled={disabled}\n    >\n      {Object.entries(options).map(([key, value]) =>\n        <MenuItem value={value} key={key}>{key}</MenuItem>\n      )}\n    </TextField>\n})\n\nWidgetEditSelect.propTypes = {\n  label: PropTypes.string,\n  disabled: PropTypes.bool,\n  options: PropTypes.object,\n  value: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  onChange: PropTypes.func\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useState, useCallback, useMemo } from 'react'\nimport PropTypes from 'prop-types'\nimport { string } from 'yup'\nimport { TextField, MenuItem } from '@material-ui/core'\nimport { useSearchContext } from '../SearchContext'\nimport { Widget, schemaWidget } from './Widget'\nimport { ActionSelect } from '../../Actions'\nimport { WidgetEditDialog, WidgetEditGroup, WidgetEditOption } from './WidgetEdit'\nimport { InputTextField } from '../input/InputText'\nimport { PeriodicTable } from '../input/InputPeriodicTable'\nimport { scales } from '../../plotting/common'\n\n/**\n * Displays a periodic table as a widget.\n */\nexport const WidgetPeriodicTable = React.memo((\n{\n  id,\n  title,\n  description,\n  quantity,\n  scale,\n  className\n}) => {\n  const { useSetWidget } = useSearchContext()\n  const setWidget = useSetWidget(id)\n\n  const handleEdit = useCallback(() => {\n    setWidget(old => { return {...old, editing: true } })\n  }, [setWidget])\n\n  const handleChangeScale = useCallback((value) => {\n    setWidget(old => { return {...old, scale: value} })\n  }, [setWidget])\n\n  return <Widget\n    id={id}\n    quantity={quantity}\n    title={title}\n    description={description}\n    onEdit={handleEdit}\n    className={className}\n    actions={\n      <ActionSelect\n        value={scale}\n        options={scales}\n        tooltip=\"Statistics scaling\"\n        onChange={handleChangeScale}\n      />\n    }\n  >\n    <PeriodicTable\n      quantity={quantity}\n      scale={scale}\n      anchored={true}\n      disableStatistics={true}\n      visible={true}\n      // Can't use the same aggregation identifier as the periodic table in the\n      // filter menu: due to rendering order the aggregation may otherwise get\n      // turned off when menu is not open.\n      aggId={'widget'}\n    />\n  </Widget>\n})\n\nWidgetPeriodicTable.propTypes = {\n  id: PropTypes.string.isRequired,\n  title: PropTypes.string,\n  description: PropTypes.string,\n  quantity: PropTypes.string,\n  scale: PropTypes.string,\n  className: PropTypes.string\n}\n\n/**\n * A dialog that is used to configure a scatter plot widget.\n */\nexport const WidgetPeriodicTableEdit = React.memo((props) => {\n    const {id, editing, visible} = props\n    const { useSetWidget } = useSearchContext()\n    const [settings, setSettings] = useState(props)\n    const [errors, setErrors] = useState({})\n    const setWidget = useSetWidget(id)\n    const hasError = useMemo(() => {\n      return Object.values(errors).some((d) => !!d) || !schemaWidgetPeriodicTable.isValidSync(settings)\n    }, [errors, settings])\n\n    const handleSubmit = useCallback((settings) => {\n      setWidget(old => ({...old, ...settings}))\n    }, [setWidget])\n\n    const handleChange = useCallback((key, value) => {\n      setSettings(old => ({...old, [key]: value}))\n    }, [setSettings])\n\n    const handleClose = useCallback(() => {\n      setWidget(old => ({...old, editing: false}))\n    }, [setWidget])\n\n    const handleError = useCallback((key, value) => {\n      setErrors(old => ({...old, [key]: value}))\n    }, [setErrors])\n\n    const handleAccept = useCallback((key, value) => {\n      try {\n        schemaWidgetPeriodicTable.validateSyncAt(key, {[key]: value})\n      } catch (e) {\n        handleError(key, e.message)\n        return\n      }\n      setErrors(old => ({...old, [key]: undefined}))\n      setSettings(old => ({...old, [key]: value}))\n    }, [handleError, setSettings])\n\n    const handleEditAccept = useCallback(() => {\n      handleSubmit({...settings, editing: false, visible: true})\n    }, [handleSubmit, settings])\n\n    return <WidgetEditDialog\n        id={id}\n        open={editing}\n        visible={visible}\n        title=\"Edit periodic table widget\"\n        onClose={handleClose}\n        onAccept={handleEditAccept}\n        error={hasError}\n      >\n      <WidgetEditGroup title=\"Elements\">\n        <WidgetEditOption>\n          <TextField\n            select\n            fullWidth\n            label=\"Statistics scaling\"\n            variant=\"filled\"\n            value={settings.scale}\n            onChange={(event) => {\n              handleChange('scale', event.target.value)\n              handleAccept('scale', event.target.value)\n            }}\n          >\n            {Object.keys(scales).map((key) =>\n              <MenuItem value={key} key={key}>{key}</MenuItem>\n            )}\n          </TextField>\n        </WidgetEditOption>\n      </WidgetEditGroup>\n      <WidgetEditGroup title=\"General\">\n        <WidgetEditOption>\n          <InputTextField\n            label=\"title\"\n            fullWidth\n            value={settings?.title}\n            onChange={(event) => handleChange('title', event.target.value)}\n          />\n        </WidgetEditOption>\n      </WidgetEditGroup>\n    </WidgetEditDialog>\n})\n\nWidgetPeriodicTableEdit.propTypes = {\n  id: PropTypes.string.isRequired,\n  editing: PropTypes.bool,\n  visible: PropTypes.bool,\n  quantity: PropTypes.string,\n  scale: PropTypes.string,\n  onClose: PropTypes.func\n}\n\nexport const schemaWidgetPeriodicTable = schemaWidget.shape({\n  quantity: string().required('Quantity is required.'),\n  scale: string().required('Scale is required.')\n})\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useState, useCallback, useMemo } from 'react'\nimport PropTypes from 'prop-types'\nimport { string, bool } from 'yup'\nimport clsx from 'clsx'\nimport { isNil } from 'lodash'\nimport {\n  TextField,\n  Typography,\n  MenuItem,\n  FormControlLabel,\n  Checkbox,\n  makeStyles\n} from '@material-ui/core'\nimport { useResizeDetector } from 'react-resize-detector'\nimport { useSearchContext } from '../SearchContext'\nimport { InputMetainfo } from '../input/InputMetainfo'\nimport { InputTextQuantity, InputTextField } from '../input/InputText'\nimport InputItem, { inputItemHeight } from '../input/InputItem'\nimport InputUnavailable from '../input/InputUnavailable'\nimport InputTooltip from '../input/InputTooltip'\nimport Placeholder from '../../visualization/Placeholder'\nimport { Widget, schemaWidget } from './Widget'\nimport { ActionSelect } from '../../Actions'\nimport { WidgetEditDialog, WidgetEditGroup, WidgetEditOption } from './WidgetEdit'\nimport { DType, pluralize } from '../../../utils'\nimport { scales } from '../../plotting/common'\n\n// Predefined in order to not break memoization\nconst dtypes = new Set([DType.String, DType.Enum])\n\n/**\n * Displays a terms widget.\n */\nconst useStyles = makeStyles(theme => ({\n  root: {\n  },\n  outerContainer: {\n    position: 'relative',\n    width: '100%',\n    height: '100%'\n  },\n  innerContainer: {\n    position: 'absolute',\n    top: 0,\n    bottom: 0,\n    right: 0,\n    left: 0,\n    display: 'flex',\n    flexDirection: 'column'\n  },\n  menuItem: {\n    height: inputItemHeight\n  },\n  menuItemSelected: {\n    '&.Mui-selected': {\n      backgroundColor: 'transparent'\n    }\n  },\n  chips: {\n    display: 'flex',\n    flexWrap: 'wrap'\n  },\n  icon: {\n    right: theme.spacing(1)\n  },\n  spacer: {\n    flex: 1,\n    minHeight: 0\n  },\n  textField: {\n    marginBottom: theme.spacing(1)\n  },\n  count: {\n    height: '1.2rem',\n    marginTop: theme.spacing(0.25),\n    marginRight: theme.spacing(1),\n    display: 'flex',\n    justifyContent: 'flex-end',\n    alignItems: 'center',\n    color: theme.palette.text.disabled\n  }\n}))\nexport const WidgetTerms = React.memo((\n{\n  id,\n  title,\n  description,\n  quantity,\n  scale,\n  showinput,\n  className,\n  'data-testid': testID\n}) => {\n  const {useAgg, useFilterState, filterData} = useSearchContext()\n  const styles = useStyles()\n  const [filter, setFilter] = useFilterState(quantity)\n  const { height, ref } = useResizeDetector()\n  const { useSetWidget } = useSearchContext()\n  const setWidget = useSetWidget(id)\n\n  // The terms aggregations need to request at least 1 item or an API error is thrown\n  const aggSize = useMemo(() => Math.max(Math.floor(height / inputItemHeight), 1), [height])\n  const aggConfig = useMemo(() => {\n    const config = {type: 'terms', size: aggSize}\n    // If a fixed list of options is used, we must restrict the aggregation\n    // return values with 'include'. Otherwise the returned results may not\n    // contain the correct values.\n    const options = filterData[quantity]?.options\n    if (options) config.include = Object.keys(options)\n    return config\n  }, [aggSize, filterData, quantity])\n  const agg = useAgg(quantity, !isNil(height), id, aggConfig)\n  const max = agg ? Math.max(...agg.data.map(option => option.count)) : 0\n\n  const handleChange = useCallback((event, key, selected) => {\n    setFilter(old => {\n      if (!old) return new Set([key])\n      const newValue = new Set(old)\n      selected ? newValue.add(key) : newValue.delete(key)\n      return newValue\n    })\n  }, [setFilter])\n\n  const handleEdit = useCallback(() => {\n    setWidget(old => { return {...old, editing: true } })\n  }, [setWidget])\n\n  const handleChangeScale = useCallback((value) => {\n    setWidget(old => { return {...old, scale: value} })\n  }, [setWidget])\n\n  const [aggComp, nShown] = useMemo(() => {\n    let aggComp\n    let nShown = 0\n    if (!agg) {\n      aggComp = <Placeholder\n        variant=\"rect\"\n        data-testid={`${testID}-placeholder`}\n        margin={0}\n      />\n      nShown = 0\n    } else {\n      if (agg?.data && agg.data.length > 0) {\n        aggComp = []\n        const maxSize = Math.min(aggConfig.size, agg.data.length)\n        for (let i = 0; i < maxSize; ++i) {\n          const option = agg.data[i]\n          if (option.count > 0 && nShown < maxSize) {\n            aggComp.push(<InputItem\n              key={option.value}\n              value={option.value}\n              selected={filter ? filter.has(option.value) : false}\n              max={max}\n              onChange={handleChange}\n              variant=\"checkbox\"\n              count={option.count}\n              scale={scale}\n            />)\n            ++nShown\n          }\n        }\n      } else {\n        aggComp = <InputUnavailable/>\n        nShown = 0\n      }\n    }\n    return [aggComp, nShown]\n  }, [agg, aggConfig, filter, handleChange, max, scale, testID])\n\n  const count = pluralize('item', nShown, true)\n\n  return <Widget\n    id={id}\n    quantity={quantity}\n    title={title}\n    description={description}\n    onEdit={handleEdit}\n    className={clsx(className)}\n    actions={\n      <ActionSelect\n        value={scale}\n        options={scales}\n        tooltip=\"Statistics scaling\"\n        onChange={handleChangeScale}\n      />\n    }\n  >\n    <InputTooltip>\n      <div className={clsx(styles.outerContainer)}>\n        <div className={clsx(styles.innerContainer)}>\n          {showinput\n            ? <InputTextQuantity\n                className={styles.textField}\n                quantity={quantity}\n                disabled={false}\n                disableSuggestions={false}\n                fullWidth\n              />\n            : null\n          }\n          <div ref={ref} className={styles.spacer}>\n            {aggComp}\n          </div>\n          {nShown !== 0 && <div className={styles.count}>\n            <Typography variant=\"overline\">\n              {nShown < aggConfig.size\n                ? nShown === 1\n                  ? 'Showing the only item'\n                  : `Showing all ${count}`\n                : `Showing top ${count}`\n              }\n            </Typography>\n          </div>}\n        </div>\n      </div>\n    </InputTooltip>\n  </Widget>\n})\n\nWidgetTerms.propTypes = {\n  id: PropTypes.string.isRequired,\n  title: PropTypes.string,\n  description: PropTypes.string,\n  quantity: PropTypes.string,\n  nbins: PropTypes.number,\n  scale: PropTypes.string,\n  autorange: PropTypes.bool,\n  showinput: PropTypes.bool,\n  className: PropTypes.string,\n  'data-testid': PropTypes.string\n}\n\nWidgetTerms.defaultProps = {\n  'data-testid': 'widgetterms'\n}\n\n/**\n * A dialog that is used to configure a scatter plot widget.\n */\nexport const WidgetTermsEdit = React.memo((props) => {\n    const {id, editing, visible} = props\n    const { useSetWidget } = useSearchContext()\n    const [settings, setSettings] = useState(props)\n    const [errors, setErrors] = useState({})\n    const setWidget = useSetWidget(id)\n    const hasError = useMemo(() => {\n      return Object.values(errors).some((d) => !!d) || !schemaWidgetTerms.isValidSync(settings)\n    }, [errors, settings])\n\n    const handleSubmit = useCallback((settings) => {\n      setWidget(old => ({...old, ...settings}))\n    }, [setWidget])\n\n    const handleChange = useCallback((key, value) => {\n      setSettings(old => ({...old, [key]: value}))\n    }, [setSettings])\n\n    const handleError = useCallback((key, value) => {\n      setErrors(old => ({...old, [key]: value}))\n    }, [setErrors])\n\n    const handleClose = useCallback(() => {\n      setWidget(old => ({...old, editing: false}))\n    }, [setWidget])\n\n    const handleAccept = useCallback((key, value) => {\n      try {\n        schemaWidgetTerms.validateSyncAt(key, {[key]: value})\n      } catch (e) {\n        handleError(key, e.message)\n        return\n      }\n      setErrors(old => ({...old, [key]: undefined}))\n      setSettings(old => ({...old, [key]: value}))\n    }, [handleError, setSettings])\n\n    const handleEditAccept = useCallback(() => {\n      handleSubmit({...settings, editing: false, visible: true})\n    }, [handleSubmit, settings])\n\n    return <WidgetEditDialog\n        id={id}\n        open={editing}\n        visible={visible}\n        title=\"Edit terms widget\"\n        onClose={handleClose}\n        onAccept={handleEditAccept}\n        error={hasError}\n      >\n      <WidgetEditGroup title=\"x axis\">\n        <WidgetEditOption>\n          <InputMetainfo\n            label=\"quantity\"\n            value={settings.quantity}\n            error={errors.quantity}\n            onChange={(value) => handleChange('quantity', value)}\n            onSelect={(value) => handleAccept('quantity', value)}\n            onError={(value) => handleError('quantity', value)}\n            dtypes={dtypes}\n            dtypesRepeatable={dtypes}\n            disableNonAggregatable\n          />\n        </WidgetEditOption>\n        <WidgetEditOption>\n          <TextField\n            select\n            fullWidth\n            label=\"Statistics scaling\"\n            variant=\"filled\"\n            value={settings.scale}\n            onChange={(event) => { handleChange('scale', event.target.value) }}\n          >\n            {Object.keys(scales).map((key) =>\n              <MenuItem value={key} key={key}>{key}</MenuItem>\n            )}\n          </TextField>\n        </WidgetEditOption>\n      </WidgetEditGroup>\n      <WidgetEditGroup title=\"general\">\n        <WidgetEditOption>\n          <InputTextField\n            label=\"title\"\n            fullWidth\n            value={settings?.title}\n            onChange={(event) => handleChange('title', event.target.value)}\n          />\n        </WidgetEditOption>\n        <WidgetEditOption>\n          <FormControlLabel\n            control={<Checkbox checked={settings.showinput} onChange={(event, value) => handleChange('showinput', value)}/>}\n            label='Show input field'\n          />\n        </WidgetEditOption>\n      </WidgetEditGroup>\n    </WidgetEditDialog>\n})\n\nWidgetTermsEdit.propTypes = {\n  id: PropTypes.string.isRequired,\n  editing: PropTypes.bool,\n  visible: PropTypes.bool,\n  quantity: PropTypes.string,\n  scale: PropTypes.string,\n  nbins: PropTypes.number,\n  autorange: PropTypes.bool,\n  showinput: PropTypes.bool,\n  onClose: PropTypes.func\n}\n\nexport const schemaWidgetTerms = schemaWidget.shape({\n  quantity: string().required('Quantity is required.'),\n  scale: string().required('Scale is required.'),\n  showinput: bool()\n})\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useState, useLayoutEffect, useMemo, useCallback, useRef } from 'react'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\nimport { cloneDeep, isNil, range } from 'lodash'\nimport { Responsive as ResponsiveGridLayout } from \"react-grid-layout\"\nimport { useResizeDetector } from 'react-resize-detector'\nimport { Paper } from '@material-ui/core'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { WidgetScatterPlot } from './WidgetScatterPlot'\nimport { WidgetPeriodicTable } from './WidgetPeriodicTable'\nimport { WidgetHistogram } from './WidgetHistogram'\nimport { WidgetTerms } from './WidgetTerms'\nimport { useSearchContext } from '../SearchContext'\n\n// Breakpoints are designed so that the periodic table is always properly\n// visible for each breakpoint/column combination\nconst periodicTableMinWidth = 710\nconst periodicTableCols = 12\nconst cols = {xxl: 36, xl: 30, lg: 24, md: 18, sm: 12}\nconst breakpoints = Object.fromEntries(Object.entries(cols).map(([size, nCols]) => {\n  return [size, periodicTableMinWidth / periodicTableCols * nCols]\n}))\nconst sizes = Object.entries(breakpoints)\nconst margin = [0, 0]\n\n/**\n * Used for calculating the number of columns based on the current width.\n * @param {number} width The grid width\n * @returns The number of columns.\n */\nfunction getNCols(width) {\n  let breakpoint\n  for (const [key, size] of sizes) {\n    breakpoint = key\n    if (width >= size) break\n  }\n  return cols[breakpoint]\n}\n\n/**\n * This class is used to build a layout where items are added one by one and\n * adding a new item does not modify the existing layout. Used to replace the\n * initial layout created by 'react-grid-layout'.\n */\nclass Layout {\n  constructor(items, nCols) {\n    this.items = []\n    this.nCols = nCols\n    for (const item of items) {\n      this.add(item)\n    }\n  }\n\n  /**\n   * Used to add an item to the layout. Notice that the order in which the items\n   * are added matters.\n   * @param {object} item Object containing at least a width and a height\n   */\n  add(item) {\n    // If the item already has a location, skip the automatization.\n    if (!isNil(item.x) && !isNil(item.y)) {\n      this.items.push(item)\n    // If no location specified, place it in the best available location.\n    } else {\n      // Get all suitable locations. A location is suitable if the item fits in\n      // there.\n      const locations = this.getAvailableLocations()\n      const locationsFit = locations\n        .filter((loc) => item.w <= loc.w && item.h <= loc.h)\n\n      // Choose the best one. Currently the topmost location is the best.\n      locationsFit.sort((a, b) => a.y - b.y)\n      const bestLocation = locationsFit[0]\n\n      // Add item to best location\n      this.items.push({...item, x: bestLocation.x, y: bestLocation.y})\n    }\n  }\n\n  /**\n   * Updates the list of available locations. Available locations are\n   * represented by a rectangle that has a top-left coordinate, width and\n   * height. Notice that this implementation is not very optimal as it tries out\n   * every point in the grid.\n   */\n  getAvailableLocations() {\n    const locations = []\n    if (this.items.length > 0) {\n      const bottom = Math.max(...this.items.map((item) => item.y + item.h))\n      const epsilon = 1e-4\n      for (const i of range(this.nCols - 1)) {\n        for (const j of range(bottom - 1)) {\n          const point = {x: i, y: j}\n          // See how much horizontal space there is\n          let xMax = point.x\n          while (!this.withinItem({x: xMax + epsilon, y: point.y + epsilon}) && xMax < this.nCols) {\n            xMax += 1\n          }\n          // See how much vertical space there is\n          let yMax = point.y\n          while (!this.withinItem({x: point.x + epsilon, y: yMax + epsilon}) && yMax < bottom) {\n            yMax += 1\n          }\n          if (yMax === bottom) yMax = Infinity\n          const width = xMax - point.x\n          const height = yMax - point.y\n          if (width && height) {\n            locations.push({...point, w: width, h: height})\n          }\n        }\n      }\n      // Add a location at the bottom row that can be used for items that take up\n      // all columns.\n      locations.push({x: 0, y: bottom, w: this.nCols, h: Infinity})\n    } else {\n      locations.push({x: 0, y: 0, w: this.nCols, h: Infinity})\n    }\n    return locations\n  }\n\n  /**\n   * Checks if the given coordinate is within any of the items. Idea from:\n   * https://math.stackexchange.com/questions/190111/how-to-check-if-a-point-is-inside-a-rectangle\n   *\n   * @param {object} point Object containin an x and a y coordinate.\n   * @returns Whether the coordinate is within an item.\n   */\n  withinItem(point) {\n    function dot(a, b) {\n      return a.x * b.x + a.y * b.y\n    }\n    for (const item of this.items) {\n      const AB = {x: item.w, y: 0}\n      const AM = {x: point.x - item.x, y: point.y - item.y}\n      const BC = {x: 0, y: item.h}\n      const BM = {x: point.x - (item.x + item.w), y: point.y - item.y}\n      const ABAB = dot(AB, AB)\n      const ABAM = dot(AB, AM)\n      const BCBC = dot(BC, BC)\n      const BCBM = dot(BC, BM)\n      const within = (ABAB >= ABAM) && (ABAM >= 0) && (BCBC >= BCBM) && (BCBM >= 0)\n      if (within) return true\n    }\n    return false\n  }\n\n  /**\n   * Returns the calculated layout.\n   * @returns Object containing a list of items.\n   */\n  getLayout() {\n    return this.items\n  }\n}\n\n/**\n * A component that is used to display all of the widgets in an interactive\n * grid. The items can be moved around and resized.\n */\nconst useStyles = makeStyles(theme => {\n  return {\n    root: {\n      position: 'relative',\n      marginLeft: theme.spacing(-0.75),\n      marginRight: theme.spacing(-0.75)\n    },\n    component: {\n      position: 'absolute',\n      top: theme.spacing(0.5),\n      bottom: theme.spacing(1.25),\n      left: theme.spacing(1.5),\n      right: theme.spacing(1.5),\n      height: 'unset',\n      width: 'unset'\n    },\n    containerOuter: {\n      position: 'relative'\n    },\n    containerInner: {\n      position: 'absolute',\n      top: theme.spacing(0.75),\n      bottom: theme.spacing(0.75),\n      left: theme.spacing(0.75),\n      right: theme.spacing(0.75),\n      height: 'unset',\n      width: 'unset'\n    }\n  }\n})\nconst WidgetGrid = React.memo(({\n  className,\n  classes\n}) => {\n  const styles = useStyles(classes)\n  const { useWidgetsState } = useSearchContext()\n  const { ref, width } = useResizeDetector()\n  const [widgets, setWidgets] = useWidgetsState()\n  const [validWidth, setValidWidth] = useState()\n  const nCols = getNCols(validWidth)\n  const firstLayout = useRef(true)\n\n  // Create the layouts\n  const layout = useMemo(() => {\n    if (!nCols) return {}\n\n    // If layouts are not provided for all different breakpoints, duplicate the\n    // closest layout that is found. We need to work on copies as the widgets\n    // information is immutable.\n    const widgetCopies = {}\n    for (const [id, widget] of Object.entries(widgets)) {\n      if (!widget.visible) continue\n      if (!widget.layout) {\n        widgetCopies[id] = widget\n        continue\n      }\n      const widgetCopy = cloneDeep(widget)\n      const breakpointNames = Object.keys(breakpoints)\n      for (const i of range(0, breakpointNames.length)) {\n        const breakpoint = breakpointNames[i]\n        if (!widgetCopy.layout[breakpoint]) {\n          for (const j of range(1, breakpointNames.length - 1)) {\n            const breakpointSmaller = widgetCopy.layout[breakpointNames[i - j]]\n            const breakpointBigger = widgetCopy.layout[breakpointNames[i + j]]\n            if (breakpointSmaller) {\n              widgetCopy.layout[breakpoint] = breakpointSmaller\n              break\n            } else if (breakpointBigger) {\n              widgetCopy.layout[breakpoint] = breakpointBigger\n              break\n            }\n          }\n        }\n      }\n      widgetCopies[id] = widgetCopy\n    }\n\n    const layouts = {}\n    for (const breakpoint of Object.keys(breakpoints)) {\n      // This is the layout in the format as react-grid-layout would read it. x:\n      // Infinity means that we want to place the item at the very end.\n      // Add widgets\n      let i = 0\n      let layout = Object.entries(widgetCopies)\n        .map(([id, value]) => {\n          const layout = value.layout?.[breakpoint]\n          const config = {\n            i: id,\n            x: isNil(layout?.x) ? Infinity : layout?.x,\n            y: isNil(layout?.y) ? 0 : layout?.y,\n            w: isNil(layout?.w) ? 3 : layout?.w,\n            h: isNil(layout?.h) ? 3 : layout?.h,\n            minW: isNil(layout?.minW) ? 3 : layout?.minW,\n            minH: isNil(layout?.minH) ? 3 : layout?.minH,\n            index: i\n          }\n          ++i\n          return config\n        })\n\n      // Calculate a sane initial layout using the custom Layout class. The\n      // initial layout as calculated by react-grid-layout is not always very\n      // great.\n      if (firstLayout.current) {\n        layout = new Layout(layout.sort((a, b) => a.index - b.index), nCols).getLayout()\n        firstLayout.current = false\n      }\n      layouts[breakpoint] = layout\n    }\n    return layouts\n  }, [widgets, nCols])\n\n  // The grid children are memoized as instructed in the docs of\n  // 'react-grid-layout' for performance.\n  const children = useMemo(() => {\n    return Object.entries(widgets)\n        .filter(([id, value]) => value?.visible)\n        .sort((a, b) => b[1].index - a[1].index)\n        .map(([id, value]) => {\n          const Comp = {\n            scatterplot: WidgetScatterPlot,\n            periodictable: WidgetPeriodicTable,\n            histogram: WidgetHistogram,\n            terms: WidgetTerms\n          }[value.type]\n          return <div key={id} className={styles.containerOuter}>\n            <Paper className={styles.containerInner}>\n              <Comp\n                id={id}\n                {...value}\n                className={styles.component}\n              ></Comp>\n            </Paper>\n          </div>\n        })\n  }, [widgets, styles])\n\n  // Mount the grid only after the width has been succesfully calculated. Also\n  // the latest valid width is stored and used for the actual grid, since upon\n  // the changing route, the width of the component goes to zero causing\n  // unwanted flickering.\n  useLayoutEffect(() => {\n    if (width) {\n      setValidWidth(width)\n    }\n  }, [width])\n\n  // The layouts are stored when they are changed. This allows retaining the\n  // layout for each breakpoint individually. Notice that we need to feed in the\n  // changed layout back to the component so that it works in a controlled\n  // manner.\n  const handleLayoutChange = useCallback((layout, allLayouts) => {\n    setWidgets(old => {\n      const newLayout = cloneDeep(old)\n      for (const [breakpoint, value] of Object.entries(allLayouts)) {\n        for (const layout of value) {\n          newLayout[layout.i].layout[breakpoint] = cloneDeep(layout)\n        }\n      }\n      return newLayout\n    })\n  }, [setWidgets])\n\n  return <div ref={ref} className={clsx(className, styles.root)}>\n    { validWidth\n      ? <ResponsiveGridLayout\n        className=\"layout\"\n        layouts={layout}\n        compactType=\"horizontal\"\n        draggableHandle=\".dragHandle\"\n        autoSize={true}\n        onLayoutChange={handleLayoutChange}\n        isDraggable={true}\n        isResizable={true}\n        isBounded={true}\n        rowHeight={validWidth / nCols}\n        margin={margin}\n        breakpoints={breakpoints}\n        cols={cols}\n        resizeHandle={<ResizeHandle/>}\n        width={validWidth}\n      >\n        {children}\n      </ResponsiveGridLayout>\n    : null }\n  </div>\n})\n\nWidgetGrid.propTypes = {\n  className: PropTypes.string,\n  classes: PropTypes.object\n}\n\nexport default WidgetGrid\n\n/**\n * A custom resize handle component for the grid items.\n */\nconst useHandleStyles = makeStyles(theme => {\n  return {\n    root: {\n      margin: theme.spacing(1),\n      width: '25px',\n      height: '25px'\n    }\n  }\n})\nconst ResizeHandle = React.forwardRef((props, ref) => {\n  const {handleAxis, ...restProps} = props\n  const styles = useHandleStyles()\n  return <div\n    ref={ref}\n    className={clsx(\n      'react-resizable-handle',\n      `react-resizable-handle-${handleAxis}`,\n      styles.root\n    )}\n    {...restProps}\n    >\n    </div>\n})\nResizeHandle.propTypes = {\n  handleAxis: PropTypes.string\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useCallback, useState} from 'react'\nimport PropTypes from 'prop-types'\nimport { number, bool, reach } from 'yup'\nimport { cloneDeep } from 'lodash'\nimport {\n  Checkbox,\n  FormControlLabel,\n  MenuItem,\n  TextField\n} from '@material-ui/core'\nimport { InputJMESPath } from '../input/InputMetainfo'\nimport { schemaWidget, schemaAxis, schemaMarkers } from './Widget'\nimport { WidgetEditDialog, WidgetEditGroup, WidgetEditOption, WidgetEditSelect } from './WidgetEdit'\nimport { useSearchContext } from '../SearchContext'\nimport { autorangeDescription } from './WidgetHistogram'\nimport { DType, setDeep, parseJMESPath, isEmptyString } from '../../../utils'\nimport { InputTextField } from '../input/InputText'\nimport { scalesLimited } from '../../plotting/common'\nimport UnitInput from '../../units/UnitInput'\n\n// Predefined in order to not break memoization\nconst dtypesNumeric = new Set([DType.Int, DType.Float, DType.Timestamp])\nconst dtypesColor = new Set([DType.String, DType.Enum, DType.Float, DType.Int])\nconst nPointsOptions = {\n  100: 100,\n  1000: 1000,\n  10000: 10000\n}\n/**\n * A dialog that is used to configure a scatter plot widget.\n */\nexport const WidgetScatterPlotEdit = React.memo(({widget}) => {\n    const { filterData, useSetWidget } = useSearchContext()\n    const [settings, setSettings] = useState(cloneDeep(widget))\n    const [errors, setErrors] = useState({})\n    const [dimensions, setDimensions] = useState({})\n    const setWidget = useSetWidget(widget.id)\n\n    const handleError = useCallback((key, value) => {\n      setErrors(old => ({...old, [key]: value}))\n    }, [setErrors])\n\n    const handleErrorQuantity = useCallback((key, value) => {\n      handleError(key, value)\n      setDimensions((old) => ({...old, [key]: null}))\n    }, [handleError])\n\n    const handleChange = useCallback((key, value) => {\n      setSettings(old => {\n        const newValue = {...old}\n        setDeep(newValue, key, value)\n        return newValue\n      })\n    }, [setSettings])\n\n    const handleClose = useCallback(() => {\n      setWidget(old => ({...old, editing: false}))\n    }, [setWidget])\n\n    const handleAccept = useCallback((key, value) => {\n      try {\n        reach(schemaWidgetScatterPlot, key).validateSync(value)\n      } catch (e) {\n        handleError(key, e.message)\n        return\n      }\n      setErrors(old => ({...old, [key]: undefined}))\n      handleChange(key, value)\n    }, [handleError, handleChange])\n\n    const handleAcceptQuantity = useCallback((key, value) => {\n      handleAccept(key, value)\n      const { quantity } = parseJMESPath(value)\n      const dimension = filterData[quantity]?.dimension\n      setDimensions((old) => ({...old, [key]: dimension}))\n    }, [handleAccept, filterData])\n\n    // Upon accepting the entire form, we perform final validation that also\n    // takes into account cross-field incompatibilities\n    const handleEditAccept = useCallback(() => {\n      // Check for independent errors from components\n      const independentErrors = Object.values(errors).some(x => !!x)\n      if (independentErrors) return\n\n      // Check for missing values. This check is required because there is no\n      // value set when a new widget is created, and pressing the done button\n      // without filling a value should raise an error.\n      const xEmpty = isEmptyString(settings?.x?.quantity)\n      if (xEmpty) {\n        handleErrorQuantity('x.quantity', 'Please specify a value.')\n      }\n      const yEmpty = isEmptyString(settings?.y?.quantity)\n      if (yEmpty) {\n        handleErrorQuantity('y.quantity', 'Please specify a value.')\n      }\n\n      if (!independentErrors && !xEmpty && !yEmpty) {\n        setWidget(old => ({...old, ...{...settings, editing: false, visible: true}}))\n      }\n    }, [settings, setWidget, errors, handleErrorQuantity])\n\n    return <WidgetEditDialog\n        id={widget.id}\n        open={widget.editing}\n        visible={widget.visible}\n        title=\"Edit scatter plot widget\"\n        onClose={handleClose}\n        onAccept={handleEditAccept}\n      >\n      <WidgetEditGroup title=\"x axis\">\n        <WidgetEditOption>\n          <InputJMESPath\n            label=\"quantity\"\n            value={settings.x?.quantity}\n            onChange={(value) => handleChange('x.quantity', value)}\n            onSelect={(value) => handleAcceptQuantity('x.quantity', value)}\n            onAccept={(value) => handleAcceptQuantity('x.quantity', value)}\n            error={errors['x.quantity']}\n            onError={(value) => handleErrorQuantity('x.quantity', value)}\n            dtypes={dtypesNumeric}\n            dtypesRepeatable={dtypesNumeric}\n          />\n        </WidgetEditOption>\n        <WidgetEditOption>\n          <InputTextField\n            label=\"title\"\n            fullWidth\n            value={settings.x?.title}\n            onChange={(event) => handleChange('x.title', event.target.value)}\n          />\n        </WidgetEditOption>\n        <WidgetEditOption>\n          <UnitInput\n            label='unit'\n            value={settings.x?.unit}\n            onChange={(value) => handleChange('x.unit', value)}\n            onSelect={(value) => handleAccept('x.unit', value)}\n            onAccept={(value) => handleAccept('x.unit', value)}\n            error={errors['x.unit']}\n            onError={(value) => handleError('x.unit', value)}\n            dimension={dimensions['x.quantity'] || null}\n            optional\n            disableGroup\n          />\n        </WidgetEditOption>\n        <WidgetEditOption>\n          <TextField\n            select\n            fullWidth\n            label=\"scale\"\n            variant=\"filled\"\n            value={settings.x?.scale}\n            onChange={(event) => { handleChange('x.scale', event.target.value) }}\n          >\n            {Object.keys(scalesLimited).map((key) =>\n              <MenuItem value={key} key={key}>{key}</MenuItem>\n            )}\n          </TextField>\n        </WidgetEditOption>\n      </WidgetEditGroup>\n      <WidgetEditGroup title=\"y axis\">\n        <WidgetEditOption>\n          <InputJMESPath\n            label=\"quantity\"\n            value={settings.y?.quantity}\n            onChange={(value) => handleChange('y.quantity', value)}\n            onSelect={(value) => handleAcceptQuantity('y.quantity', value)}\n            onAccept={(value) => handleAcceptQuantity('y.quantity', value)}\n            error={errors['y.quantity']}\n            onError={(value) => handleErrorQuantity('y.quantity', value)}\n            dtypes={dtypesNumeric}\n            dtypesRepeatable={dtypesNumeric}\n          />\n        </WidgetEditOption>\n        <WidgetEditOption>\n          <InputTextField\n            label=\"title\"\n            fullWidth\n            value={settings.y?.title}\n            onChange={(event) => handleChange('y.title', event.target.value)}\n          />\n        </WidgetEditOption>\n        <WidgetEditOption>\n          <UnitInput\n            label='unit'\n            value={settings.y?.unit}\n            onChange={(value) => handleChange('y.unit', value)}\n            onSelect={(value) => handleAccept('y.unit', value)}\n            onAccept={(value) => handleAccept('y.unit', value)}\n            error={errors['y.unit']}\n            onError={(value) => handleError('y.unit', value)}\n            dimension={dimensions['y.quantity'] || null}\n            optional\n            disableGroup\n          />\n        </WidgetEditOption>\n        <WidgetEditOption>\n          <TextField\n            select\n            fullWidth\n            label=\"scale\"\n            variant=\"filled\"\n            value={settings.y?.scale}\n            onChange={(event) => { handleChange('y.scale', event.target.value) }}\n          >\n            {Object.keys(scalesLimited).map((key) =>\n              <MenuItem value={key} key={key}>{key}</MenuItem>\n            )}\n          </TextField>\n        </WidgetEditOption>\n      </WidgetEditGroup>\n      <WidgetEditGroup title=\"marker color\">\n        <WidgetEditOption>\n          <InputJMESPath\n            label=\"quantity\"\n            value={settings?.markers?.color?.quantity}\n            onChange={(value) => handleChange('markers.color.quantity', value)}\n            onSelect={(value) => handleAcceptQuantity('markers.color.quantity', value)}\n            onAccept={(value) => handleAcceptQuantity('markers.color.quantity', value)}\n            error={errors['markers.color.quantity']}\n            onError={(value) => handleErrorQuantity('markers.color.quantity', value)}\n            dtypes={dtypesColor}\n            dtypesRepeatable={dtypesColor}\n            optional\n          />\n        </WidgetEditOption>\n        <WidgetEditOption>\n          <InputTextField\n            label=\"title\"\n            fullWidth\n            value={settings.markers?.color?.title}\n            onChange={(event) => handleChange('markers.color.title', event.target.value)}\n          />\n        </WidgetEditOption>\n        <WidgetEditOption>\n          <UnitInput\n            label='unit'\n            value={settings.markers?.color?.unit}\n            onChange={(value) => handleChange('markers.color.unit', value)}\n            onSelect={(value) => handleAccept('markers.color.unit', value)}\n            onAccept={(value) => handleAccept('markers.color.unit', value)}\n            error={errors['markers.color.unit']}\n            onError={(value) => handleError('markers.color.unit', value)}\n            dimension={dimensions['markers.color.quantity'] || null}\n            optional\n            disableGroup\n          />\n        </WidgetEditOption>\n      </WidgetEditGroup>\n      <WidgetEditGroup title=\"general\">\n        <WidgetEditOption>\n          <InputTextField\n            label=\"title\"\n            fullWidth\n            value={settings?.title}\n            onChange={(event) => handleChange('title', event.target.value)}\n          />\n        </WidgetEditOption>\n        <WidgetEditOption>\n          <WidgetEditSelect\n            label=\"Maximum number of entries to load\"\n            options={nPointsOptions}\n            value={settings.size}\n            onChange={(event) => { handleChange('size', event.target.value) }}\n          />\n        </WidgetEditOption>\n        <WidgetEditOption>\n          <FormControlLabel\n            control={<Checkbox checked={settings.autorange} onChange={(event, value) => handleChange('autorange', value)}/>}\n            label={autorangeDescription}\n          />\n        </WidgetEditOption>\n      </WidgetEditGroup>\n    </WidgetEditDialog>\n})\n\nWidgetScatterPlotEdit.propTypes = {\n  widget: PropTypes.object\n}\n\nexport const schemaWidgetScatterPlot = schemaWidget.shape({\n  x: schemaAxis.required('Quantity for the x axis is required.'),\n  y: schemaAxis.required('Quantity for the y axis is required.'),\n  markers: schemaMarkers,\n  size: number().integer().required('Size is required.'),\n  autorange: bool()\n})\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useState, useCallback } from 'react'\nimport PropTypes from 'prop-types'\nimport { number, bool, reach } from 'yup'\nimport { cloneDeep } from 'lodash'\nimport {\n  TextField,\n  MenuItem,\n  Checkbox,\n  FormControlLabel\n} from '@material-ui/core'\nimport { useSearchContext } from '../SearchContext'\nimport { InputMetainfo } from '../input/InputMetainfo'\nimport { InputTextField } from '../input/InputText'\nimport UnitInput from '../../units/UnitInput'\nimport { schemaWidget, schemaAxis, schemaAxisBase } from './Widget'\nimport { WidgetEditDialog, WidgetEditGroup, WidgetEditOption } from './WidgetEdit'\nimport { DType, parseJMESPath, setDeep, isEmptyString } from '../../../utils'\nimport { scales } from '../../plotting/common'\nimport { autorangeDescription } from './WidgetHistogram'\n\n// Predefined in order to not break memoization\nconst dtypes = new Set([DType.Float, DType.Int, DType.Timestamp])\n\n/**\n * A dialog that is used to configure a scatter plot widget.\n */\nexport const WidgetHistogramEdit = React.memo(({widget}) => {\n    const { filterData, useSetWidget } = useSearchContext()\n    const [settings, setSettings] = useState(cloneDeep(widget))\n    const [errors, setErrors] = useState({})\n    const [dimensions, setDimensions] = useState({})\n    const setWidget = useSetWidget(widget.id)\n\n    const handleChange = useCallback((key, value) => {\n      setSettings(old => {\n        const newValue = {...old}\n        setDeep(newValue, key, value)\n        return newValue\n      })\n    }, [setSettings])\n\n    const handleError = useCallback((key, value) => {\n      setErrors(old => ({...old, [key]: value}))\n    }, [setErrors])\n\n    const handleErrorQuantity = useCallback((key, value) => {\n      handleError(key, value)\n      setDimensions((old) => ({...old, [key]: null}))\n    }, [handleError])\n\n    const handleAccept = useCallback((key, value) => {\n      try {\n        reach(schemaWidgetHistogram, key).validateSync(value)\n      } catch (e) {\n        handleError(key, e.message)\n        return\n      }\n      setErrors(old => ({...old, [key]: undefined}))\n      handleChange(key, value)\n    }, [handleError, handleChange])\n\n    const handleAcceptQuantity = useCallback((key, value) => {\n      handleAccept(key, value)\n      const { quantity } = parseJMESPath(value)\n      const dimension = filterData[quantity]?.dimension\n      setDimensions((old) => ({...old, [key]: dimension}))\n    }, [handleAccept, filterData])\n\n    const handleClose = useCallback(() => {\n      setWidget(old => ({...old, editing: false}))\n    }, [setWidget])\n\n    // Upon accepting the entire form, we perform final validation.\n    const handleEditAccept = useCallback(() => {\n      const independentErrors = Object.values(errors).some(x => !!x)\n      if (independentErrors) return\n\n      // Check for missing values. This check is required because there is no\n      // value set when a new widget is created, and pressing the done button\n      // without filling a value should raise an error.\n      const xEmpty = isEmptyString(settings?.x?.quantity)\n      if (xEmpty) {\n        handleErrorQuantity('x.quantity', 'Please specify a value.')\n      }\n\n      if (!independentErrors && !xEmpty) {\n        setWidget(old => ({...old, ...{...settings, editing: false, visible: true}}))\n      }\n    }, [settings, setWidget, errors, handleErrorQuantity])\n\n    return <WidgetEditDialog\n        id={widget.id}\n        open={widget.editing}\n        visible={widget.visible}\n        title=\"Edit histogram widget\"\n        onClose={handleClose}\n        onAccept={handleEditAccept}\n      >\n      <WidgetEditGroup title=\"x axis\">\n        <WidgetEditOption>\n          <InputMetainfo\n            label=\"quantity\"\n            value={settings.x?.quantity}\n            error={errors['x.quantity']}\n            onChange={(value) => handleChange('x.quantity', value)}\n            onAccept={(value) => handleAcceptQuantity('x.quantity', value)}\n            onSelect={(value) => handleAcceptQuantity('x.quantity', value)}\n            onError={(value) => handleErrorQuantity('x.quantity', value)}\n            dtypes={dtypes}\n            dtypesRepeatable={dtypes}\n          />\n        </WidgetEditOption>\n        <WidgetEditOption>\n          <InputTextField\n            label=\"title\"\n            fullWidth\n            value={settings.x?.title}\n            onChange={(event) => handleChange('x.title', event.target.value)}\n          />\n        </WidgetEditOption>\n        <WidgetEditOption>\n          <UnitInput\n            label='unit'\n            value={settings.x?.unit}\n            onChange={(value) => handleChange('x.unit', value)}\n            onSelect={(value) => handleAccept('x.unit', value)}\n            onAccept={(value) => handleAccept('x.unit', value)}\n            error={errors['x.unit']}\n            onError={(value) => handleError('x.unit', value)}\n            dimension={dimensions['x.quantity'] || null}\n            optional\n            disableGroup\n          />\n        </WidgetEditOption>\n      </WidgetEditGroup>\n      <WidgetEditGroup title=\"y axis\">\n        <WidgetEditOption>\n          <TextField\n            select\n            fullWidth\n            label=\"scale\"\n            variant=\"filled\"\n            value={settings.y?.scale}\n            onChange={(event) => { handleChange('y.scale', event.target.value) }}\n          >\n            {Object.keys(scales).map((key) =>\n              <MenuItem value={key} key={key}>{key}</MenuItem>\n            )}\n          </TextField>\n        </WidgetEditOption>\n      </WidgetEditGroup>\n      <WidgetEditGroup title=\"general\">\n        <WidgetEditOption>\n          <InputTextField\n            label=\"title\"\n            fullWidth\n            value={settings?.title}\n            onChange={(event) => handleChange('title', event.target.value)}\n          />\n        </WidgetEditOption>\n        <WidgetEditOption>\n          <TextField\n            select\n            fullWidth\n            label=\"Maximum number of bins\"\n            variant=\"filled\"\n            value={settings.nbins}\n            onChange={(event) => { handleChange('nbins', event.target.value) }}\n          >\n            <MenuItem value={10}>10</MenuItem>\n            <MenuItem value={20}>20</MenuItem>\n            <MenuItem value={30}>30</MenuItem>\n            <MenuItem value={40}>40</MenuItem>\n            <MenuItem value={50}>50</MenuItem>\n          </TextField>\n        </WidgetEditOption>\n\n        <WidgetEditOption>\n          <FormControlLabel\n            control={<Checkbox checked={settings.autorange} onChange={(event, value) => handleChange('autorange', value)}/>}\n            label={autorangeDescription}\n          />\n        </WidgetEditOption>\n        <WidgetEditOption>\n          <FormControlLabel\n            control={<Checkbox checked={settings.showinput} onChange={(event, value) => handleChange('showinput', value)}/>}\n            label='Show input fields'\n          />\n        </WidgetEditOption>\n      </WidgetEditGroup>\n    </WidgetEditDialog>\n})\n\nWidgetHistogramEdit.propTypes = {\n  widget: PropTypes.object,\n  onClose: PropTypes.func\n}\n\nexport const schemaWidgetHistogram = schemaWidget.shape({\n  x: schemaAxis.required('X-axis configuration is required.'),\n  y: schemaAxisBase.required('Y-axis configuration is required.'),\n  nbins: number().integer().required(),\n  autorange: bool(),\n  showinput: bool()\n})\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useCallback, useState, useEffect} from 'react'\nimport PropTypes from 'prop-types'\nimport {\n  Accordion,\n  AccordionSummary,\n  AccordionDetails,\n  Typography,\n  Button,\n  Dialog,\n  DialogActions,\n  DialogContent,\n  DialogTitle,\n  withStyles\n} from '@material-ui/core'\nimport { isArray, cloneDeep } from 'lodash'\nimport CodeIcon from '@material-ui/icons/Code'\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore'\nimport ExpandLessIcon from '@material-ui/icons/ExpandLess'\nimport AddCircleIcon from '@material-ui/icons/AddCircle'\nimport ReplayIcon from '@material-ui/icons/Replay'\nimport WidgetGrid from './WidgetGrid'\nimport { Actions, Action } from '../../Actions'\nimport { useSearchContext } from '../SearchContext'\nimport { WidgetScatterPlotEdit, schemaWidgetScatterPlot } from './WidgetScatterPlotEdit'\nimport { WidgetHistogramEdit, schemaWidgetHistogram } from './WidgetHistogramEdit'\nimport { WidgetTermsEdit, schemaWidgetTerms } from './WidgetTerms'\nimport { WidgetPeriodicTableEdit, schemaWidgetPeriodicTable } from './WidgetPeriodicTable'\nimport InputConfig from '../input/InputConfig'\nimport { cleanse } from '../../../utils'\nimport Markdown from '../../Markdown'\nimport { getWidgetsObject } from './Widget'\nimport { ContentButton } from '../../buttons/SourceDialogButton'\n\nconst DashboardAccordion = withStyles({\n  root: {\n    backgroundColor: 'transparent'\n  },\n  expanded: {}\n})(Accordion)\n\nconst summaryMinHeight = 40\nconst DashboardAccordionSummary = withStyles({\n  root: {\n    padding: 0,\n    margin: 0,\n    minHeight: summaryMinHeight,\n    '&$expanded': {\n      minHeight: summaryMinHeight\n    }\n  },\n  content: {\n    margin: 0,\n    '&$expanded': {\n      margin: '0'\n    }\n  },\n  expanded: {}\n})(AccordionSummary)\n\nconst DashboardAccordionDetails = withStyles((theme) => ({\n  root: {\n    padding: 0,\n    display: 'block'\n  }\n}))(AccordionDetails)\n\n/**\n * A collapsible area that shows the currently active widgets in a grid.\n */\nconst Dashboard = React.memo(() => {\n  const [expanded, setExpanded] = useState(true)\n  const { useWidgetsValue, useAddWidget, useResetWidgets } = useSearchContext()\n  const resetWidgets = useResetWidgets()\n  const widgets = useWidgetsValue()\n  const addWidget = useAddWidget()\n\n  // Adds a new scatter plot widget\n  const handleScatterplot = useCallback(() => {\n    const index = Date.now()\n    const id = index.toString()\n    const layout = {x: Infinity, y: 0, w: 9, h: 6}\n    const value = {\n      id: id,\n      editing: true,\n      visible: false,\n      layout: {\n        sm: {...layout},\n        md: {...layout},\n        lg: {...layout},\n        xl: {...layout},\n        xxl: {...layout}\n      },\n      // x: {scale: 'linear'},\n      // y: {scale: 'linear'},\n      size: 1000,\n      autorange: true,\n      type: 'scatterplot'\n    }\n    addWidget(id, value)\n  }, [addWidget])\n\n  // Adds a new periodic table widget\n  const handlePeriodicTable = useCallback(() => {\n    const index = Date.now()\n    const id = index.toString()\n    const layout = {x: Infinity, y: 0, w: 12, h: 9}\n    const value = {\n      id: id,\n      editing: true,\n      visible: false,\n      layout: {\n        sm: {...layout},\n        md: {...layout},\n        lg: {...layout},\n        xl: {...layout},\n        xxl: {...layout}\n      },\n      scale: 'linear',\n      quantity: 'results.material.elements',\n      type: 'periodictable'\n    }\n    addWidget(id, value)\n  }, [addWidget])\n\n  // Adds a new histogram widget\n  const handleHistogram = useCallback(() => {\n    const index = Date.now()\n    const id = index.toString()\n    const layout = {x: Infinity, y: 0, w: 8, h: 3}\n    const value = {\n      id: id,\n      editing: true,\n      visible: false,\n      layout: {\n        sm: {...layout},\n        md: {...layout},\n        lg: {...layout},\n        xl: {...layout},\n        xxl: {...layout}\n      },\n      autorange: false,\n      nbins: 30,\n      y: {scale: 'linear'},\n      type: 'histogram'\n    }\n    addWidget(id, value)\n  }, [addWidget])\n\n  // Adds a new histogram widget\n  const handleTerms = useCallback(() => {\n    const index = Date.now()\n    const id = index.toString()\n    const layout = {x: Infinity, y: 0, w: 6, h: 9}\n    const value = {\n      id: id,\n      editing: true,\n      visible: false,\n      layout: {\n        sm: {...layout},\n        md: {...layout},\n        lg: {...layout},\n        xl: {...layout},\n        xxl: {...layout}\n      },\n      scale: 'linear',\n      type: 'terms'\n    }\n    addWidget(id, value)\n  }, [addWidget])\n\n  const handleExpand = useCallback(() => {\n    setExpanded(old => !old)\n  }, [])\n\n  const handleReset = useCallback(() => {\n    resetWidgets()\n  }, [resetWidgets])\n\n  return <DashboardAccordion expanded={expanded} elevation={0}>\n    <DashboardAccordionSummary\n      aria-controls=\"panel1a-content\"\n      id=\"panel1a-header\"\n    >\n      <Actions justifyContent=\"flex-start\">\n        <DashboardAction\n          title=\"Terms\"\n          onClick={handleTerms}\n          tooltip=\"Add a terms widget to the dashboard\"\n        />\n        <DashboardAction\n          title=\"Histogram\"\n          onClick={handleHistogram}\n          tooltip=\"Add a histogram widget to the dashboard\"\n        />\n        <DashboardAction\n          title=\"Scatter plot\"\n          onClick={handleScatterplot}\n          tooltip=\"Add a scatter plot widget to the dashboard\"\n        />\n        <DashboardAction\n          title=\"Periodic table\"\n          onClick={handlePeriodicTable}\n          tooltip=\"Add a periodic table widget to the dashboard\"\n        />\n        <Action\n          onClick={handleReset}\n          tooltip=\"Reset the default dashboard configuration\"\n        >\n            <ReplayIcon fontSize=\"small\"/>\n        </Action>\n        <Action\n          tooltip=\"\"\n          ButtonComponent={DashboardExportButton}\n          ButtonProps={{\n            tooltip: \"Dashboard export/import\",\n            title: \"Dashboard export/import\",\n            DialogProps: {\n              maxWidth: \"md\",\n              fullWidth: true\n            },\n            ButtonProps: {\n              size: \"small\"\n            }\n          }}>\n            <CodeIcon fontSize=\"small\"/>\n        </Action>\n        <Action\n          onClick={handleExpand}\n          tooltip={expanded ? 'Hide dashboard' : 'Show dashboard'}\n        >\n            {expanded ? <ExpandLessIcon fontSize=\"small\"/> : <ExpandMoreIcon fontSize=\"small\"/>}\n        </Action>\n      </Actions>\n    </DashboardAccordionSummary>\n    <DashboardAccordionDetails>\n      <WidgetGrid />\n    </DashboardAccordionDetails>\n    {widgets && Object.entries(widgets).map(([id, value]) => {\n      if (!value.editing) return null\n      const comp = {\n        scatterplot: <WidgetScatterPlotEdit key={id} widget={value}/>,\n        periodictable: <WidgetPeriodicTableEdit key={id} {...value}/>,\n        histogram: <WidgetHistogramEdit key={id} widget={value}/>,\n        terms: <WidgetTermsEdit key={id} {...value}/>\n      }[value.type]\n      return comp || null\n    })}\n  </DashboardAccordion>\n})\n\nDashboard.propTypes = {\n}\n\nconst buttonProps = {\n  variant: 'outlined',\n  startIcon: <AddCircleIcon color=\"primary\"/>\n}\nconst DashboardAction = React.memo(({title, ...rest}) => {\n  return <Action {...rest} ButtonComponent={Button} ButtonProps={buttonProps}>\n    <Typography variant=\"caption\">{title}</Typography>\n  </Action>\n})\nDashboardAction.propTypes = {\n  title: PropTypes.string,\n  children: PropTypes.node\n}\n\nconst schemas = {\n  scatterplot: schemaWidgetScatterPlot,\n  periodictable: schemaWidgetPeriodicTable,\n  histogram: schemaWidgetHistogram,\n  terms: schemaWidgetTerms\n}\n\n/**\n * A button that displays a dialog that can be used to modify the current\n * dashboard setup.\n */\nexport const DashboardExportButton = React.memo(({tooltip, title, DialogProps, ButtonProps}) => {\n  const {useWidgetsState} = useSearchContext()\n  const [widgets, setWidgets] = useWidgetsState()\n  const [widgetExport, setWidgetExport] = useState()\n  const [widgetImport, setWidgetImport] = useState()\n  const [widgetImportError, setWidgetImportError] = useState(null)\n  const [open, setOpen] = useState(false)\n\n  // The widget export data. Only reacts if the menu is open.\n  useEffect(() => {\n    if (!open) return\n    // Work on a copy: data in Recoil is unmutable\n    const widgetsExport = cloneDeep(widgets)\n\n    const exp = Object\n      .values(widgetsExport)\n      .map((widget) => {\n        const schema = schemas[widget.type]\n        const casted = schema?.cast(widget, {stripUnknown: true})\n\n        // Remove undefined values. YUP cannot do this, and the YAML\n        // serialization will otherwise include these.\n        cleanse(casted)\n\n        // Perform custom sort: type first, layout last\n        const sorted = {}\n        if (casted['type']) sorted['type'] = casted['type']\n        const fields = new Set(['type', 'layout'])\n        for (const [key, value] of Object.entries(casted)) {\n          if (!fields.has(key)) {\n            sorted[key] = value\n          }\n        }\n        if (casted['layout']) sorted['layout'] = casted['layout']\n        return sorted\n      })\n      setWidgetExport(exp)\n  }, [open, widgets])\n\n  // Validate new widget config\n  const handleChange = useCallback((data) => {\n    if (!isArray(data)) return\n    let error\n    for (const widget of data) {\n      const type = widget.type\n      const schema = schemas[type]\n      if (!schema) return\n      try {\n        schema.validateSync(widget)\n      } catch (e) {\n        setWidgetImportError(e.message)\n        error = e\n        break\n      }\n    }\n    if (!error) {\n      setWidgetImport(data)\n      setWidgetImportError(null)\n    }\n  }, [])\n\n  // Save the dashboard setup\n  const handleSave = useCallback(() => {\n    if (widgetImport) {\n      if (widgetImportError) return\n      const widgetsInternal = getWidgetsObject(widgetImport)\n      setWidgets(widgetsInternal)\n    }\n    setOpen(false)\n  }, [widgetImportError, widgetImport, setWidgets])\n\n  return <ContentButton\n    tooltip={tooltip}\n    buttonContent={<CodeIcon fontSize=\"small\"/>}\n    ButtonProps={{...ButtonProps, onClick: () => { setOpen(true) }}}\n  >\n    <Dialog {...DialogProps} open={open}>\n      {title && <DialogTitle>{title}</DialogTitle>}\n      <DialogContent>\n        <Markdown text=\"The current dashboard configuration in YAML. You can modify it here directly and save it to update the dashboard.\"/>\n        <InputConfig\n          data={widgetExport}\n          format='YAML'\n          maxRows={30}\n          minRows={30}\n          onChange={handleChange}\n          error={widgetImportError}\n          onError={setWidgetImportError}\n        />\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => setOpen(false)}>\n          Cancel\n        </Button>\n        <Button disabled={!!widgetImportError} onClick={handleSave}>\n          Save\n        </Button>\n      </DialogActions>\n    </Dialog>\n  </ContentButton>\n})\nDashboardExportButton.propTypes = {\n  label: PropTypes.string,\n  title: PropTypes.string,\n  tooltip: PropTypes.string,\n  DialogProps: PropTypes.object,\n  ButtonProps: PropTypes.object,\n  children: PropTypes.node\n}\n\nexport default Dashboard\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport clsx from 'clsx'\nimport PropTypes from 'prop-types'\nimport { Box } from '@material-ui/core'\nimport { makeStyles } from '@material-ui/core/styles'\nimport FilterMainMenu from './menus/FilterMainMenu'\nimport { collapsedMenuWidth } from './menus/FilterMenu'\nimport SearchBar from './SearchBar'\nimport Query from './Query.js'\nimport { SearchResultsWithContext } from './SearchResults'\nimport Dashboard from './widgets/Dashboard'\nimport { useSearchContext } from './SearchContext'\n\n/**\n * The primary search interface that is reused throughout the application in\n * different contexts. Displays a menu of filters, a search bar, a list of\n * results and optionally a customizable header above the search bar.\n */\nconst useStyles = makeStyles(theme => {\n  return {\n    root: {\n      display: 'flex',\n      flexDirection: 'row',\n      height: '100%',\n      width: '100%'\n    },\n    leftColumn: {\n      flexShrink: 0,\n      flexGrow: 0,\n      height: '100%',\n      zIndex: 2\n    },\n    leftColumnCollapsed: {\n      maxWidth: `${collapsedMenuWidth}rem`\n    },\n    center: {\n      flexGrow: 1,\n      height: '100%',\n      overflowY: 'scroll'\n    },\n    searchBar: {\n      display: 'flex',\n      flexGrow: 0,\n      zIndex: 1,\n      marginBottom: theme.spacing(0.3)\n    },\n    shadow: {\n      pointerEvents: 'none',\n      position: 'absolute',\n      left: 0,\n      right: 0,\n      bottom: 0,\n      top: 0,\n      height: '100%',\n      width: '100%',\n      backgroundColor: 'black',\n      transition: 'opacity 200ms',\n      willChange: 'opacity',\n      zIndex: 1,\n      opacity: 0\n    },\n    shadowVisible: {\n      opacity: 0.1\n    }\n  }\n})\n\nconst SearchPage = React.memo(({\n  header\n}) => {\n  const styles = useStyles()\n  const {\n    useIsMenuOpen,\n    useSetIsMenuOpen,\n    useIsCollapsed,\n    useSetIsCollapsed\n  } = useSearchContext()\n  const [isMenuOpen, setIsMenuOpen] = [useIsMenuOpen(), useSetIsMenuOpen()]\n  const [isCollapsed, setIsCollapsed] = [useIsCollapsed(), useSetIsCollapsed()]\n\n  return <div className={styles.root}>\n    <div className={clsx(styles.leftColumn, isCollapsed && styles.leftColumnCollapsed)}>\n      <FilterMainMenu\n        open={isMenuOpen}\n        onOpenChange={setIsMenuOpen}\n        collapsed={isCollapsed}\n        onCollapsedChange={setIsCollapsed}\n      />\n    </div>\n    <div className={styles.center} onClick={() => setIsMenuOpen(false)}>\n      <Box margin={2.5} paddingBottom={3}>\n        <Box marginBottom={2}>\n          {header}\n        </Box>\n        <Box marginBottom={0}>\n          <SearchBar className={styles.searchBar} />\n          <Query/>\n        </Box>\n        <Box marginBottom={1} zIndex={0}>\n          <Dashboard/>\n        </Box>\n        <Box position=\"relative\" zIndex={1}>\n          <SearchResultsWithContext/>\n        </Box>\n        <div className={clsx(styles.shadow, isMenuOpen && styles.shadowVisible)}></div>\n      </Box>\n    </div>\n  </div>\n})\nSearchPage.propTypes = {\n  header: PropTypes.node\n}\n\nexport default SearchPage\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useCallback, useEffect, useMemo, useState} from 'react'\nimport PropTypes from 'prop-types'\nimport {cloneDeep} from 'lodash'\nimport {\n  Chip,\n  Dialog, DialogContent, IconButton, TextField, Tooltip\n} from \"@material-ui/core\"\nimport {FreeformSearchContext, useSearchContext} from \"../search/SearchContext\"\nimport {ui} from \"../../config\"\nimport DialogActions from \"@material-ui/core/DialogActions\"\nimport Button from \"@material-ui/core/Button\"\nimport SearchPage from \"../search/SearchPage\"\nimport SearchIcon from \"@material-ui/icons/Search\"\nimport {useRecoilValue} from \"recoil\"\nimport {configState} from \"../archive/ArchiveBrowser\"\nimport {getDisplayLabel, pluralize} from \"../../utils\"\nimport Autocomplete from \"@material-ui/lab/Autocomplete\"\nimport {ItemButton, useLane} from \"../archive/Browser\"\nimport ClearIcon from \"@material-ui/icons/Clear\"\n\nconst context = cloneDeep(ui?.apps?.options?.eln)\n\nconst shownColumns = [\n  'entry_name',\n  'entry_type',\n  'authors',\n  'upload_name'\n]\n\nconst columns = context?.columns\nconst rows = context?.rows\ncolumns.selected = shownColumns\nrows.details = {enabled: false}\nrows.actions = {enabled: false}\n\nfunction SearchDialog({open, filters, pageSize, onCancel, onQueryChanged}) {\n  const {filters: queryFilters, useFilters, useSetFilters, useResults, useApiData} = useSearchContext()\n  const setFilters = useSetFilters()\n  const filterValues = useFilters(queryFilters)\n  const {data, setPagination} = useResults()\n  const apiData = useApiData()\n\n  const updateFilters = useCallback(() => {\n    const newValue = {}\n    for (const key in filters) {\n      if (Object.hasOwnProperty.call(filters, key)) {\n        newValue[key] = Array.isArray(filters[key]) || filters[key] instanceof Set ? new Set(filters[key]) : filters[key]\n      }\n    }\n    if (setPagination && pageSize) {\n      setPagination(old => {\n        return {...old, page_size: pageSize}\n      })\n    }\n    setFilters(newValue)\n  }, [pageSize, setFilters, filters, setPagination])\n\n  useEffect(() => {\n    if (open) {\n      updateFilters()\n    }\n  }, [updateFilters, open])\n\n  const newFilters = useMemo(() => {\n    const filters = {...filterValues}\n    for (const key in filters) {\n      if (key in filters && filters[key] === undefined) {\n        delete filters[key]\n      }\n    }\n    return filters\n  }, [filterValues])\n\n  const results = useMemo(() => {\n    if (!data) {\n      return undefined\n    }\n    return data.map(entry => ({entry_id: entry.entry_id, upload_id: entry.upload_id, mainfile: entry.mainfile}))\n  }, [data])\n\n  const handleQueryChanged = useCallback(() => {\n    if (onQueryChanged) {\n      onQueryChanged(newFilters, apiData, results)\n    }\n  }, [onQueryChanged, newFilters, apiData, results])\n\n  return <Dialog\n    open={open}\n    PaperProps={{\n      style: {\n        maxWidth: '1800px',\n        maxHeight: '1200px',\n        width: '1800px',\n        height: '1200px'\n      }\n    }}\n    data-testid='search-dialog'\n  >\n    <DialogContent>\n      <SearchPage/>\n    </DialogContent>\n    <DialogActions>\n      <span style={{flexGrow: 1}} />\n      <Button onClick={() => onCancel()} color=\"secondary\">\n        Cancel\n      </Button>\n      <Button onClick={() => handleQueryChanged()} color=\"secondary\" data-testid='search-dialog-ok'>\n        OK\n      </Button>\n    </DialogActions>\n  </Dialog>\n}\nSearchDialog.propTypes = {\n  open: PropTypes.bool,\n  filters: PropTypes.object,\n  pageSize: PropTypes.number,\n  onCancel: PropTypes.func,\n  onQueryChanged: PropTypes.func\n}\n\nfunction QueryEditQuantity({quantityDef, onChange, value, storeInArchive, index, maxData}) {\n  const config = useRecoilValue(configState)\n  const label = getDisplayLabel(quantityDef, true, config?.showMeta)\n  const [open, setOpen] = useState(false)\n  const lane = useLane()\n\n  const filters = useMemo(() => value?.filters || {}, [value])\n\n  const handleCancel = useCallback(() => {\n    setOpen(false)\n  }, [])\n\n  const handleQueryChanged = useCallback((filters, query, results) => {\n    if (onChange) {\n      const newFilters = {}\n      for (const key in filters) {\n        if (Object.hasOwnProperty.call(filters, key)) {\n          newFilters[key] = Array.isArray(filters[key]) || filters[key] instanceof Set ? [...filters[key]] : filters[key]\n        }\n      }\n      const newValue = {\n        owner: query.response.owner,\n        query: query.response.query,\n        pagination: query.response.pagination,\n        filters: newFilters\n      }\n      if (storeInArchive) {\n        newValue.data = results\n      }\n      onChange(newValue)\n    }\n    setOpen(false)\n  }, [onChange, storeInArchive])\n\n  const tags = useMemo(() => {\n    let tags = []\n    for (const key in filters) {\n      const filterValue = filters[key]\n      if (filterValue) {\n        if (Array.isArray(filterValue[key])) {\n          tags = tags.concat([...filterValue].map(value => ({key: key, value: value, tag: `${key}:${value}`})))\n        } else {\n          tags = tags.concat({key: key, value: filterValue, tag: `${key}:${filterValue}`})\n        }\n      }\n    }\n    return tags\n  }, [filters])\n\n  const itemKey = useMemo(() => {\n    if (!isNaN(index)) {\n      return `${quantityDef.name}:${index}`\n    } else {\n      return quantityDef.name\n    }\n  }, [quantityDef, index])\n\n  const handleClearResults = useCallback(() => {\n    if (onChange) {\n      onChange(undefined)\n    }\n  }, [onChange])\n\n  const actions = useMemo(() => {\n    const actions = []\n    if (value) {\n      actions.push(\n        <IconButton\n          key={'clear'}\n          color=\"seconadry\"\n          size=\"small\"\n          onClick={handleClearResults}\n        >\n          <Tooltip title=\"Clear results\">\n            <ClearIcon/>\n          </Tooltip>\n        </IconButton>\n      )\n    }\n    actions.push(<IconButton\n      key={'search'}\n      color=\"seconadry\"\n      size=\"small\"\n      onClick={() => setOpen(true)}\n    >\n      <Tooltip title=\"Search dialog\">\n        <SearchIcon/>\n      </Tooltip>\n    </IconButton>)\n    if (lane && value) {\n      actions.push(<ItemButton key={'navigate'} size=\"small\" itemKey={itemKey}/>)\n    }\n    return actions\n  }, [value, lane, handleClearResults, itemKey])\n\n  return <React.Fragment>\n    <Autocomplete\n      multiple\n      open={false}\n      options={[]}\n      getOptionLabel={(option) => option.tag}\n      limitTags={1}\n      value={tags}\n      inputValue={''}\n      renderTags={(value, getTagProps) => {\n        return value.map((option, index) => {\n          return <Chip\n            key={index}\n            {...getTagProps({ index })}\n            label={option.tag}\n            size=\"small\"\n            color=\"primary\"\n            onDelete={undefined}\n          />\n        })\n      }}\n      renderInput={(params) => (\n        <TextField\n          {...params}\n          label={label}\n          variant=\"filled\"\n          placeholder={value?.results && Array.isArray(value.results) && value.results.length > 0\n            ? pluralize('result', value.results.length, true)\n            : \"no results\"}\n          InputProps={{\n            ...params.InputProps,\n            endAdornment: React.cloneElement(params.InputProps.endAdornment, {}, actions)\n          }}\n        />\n      )}\n    />\n    <FreeformSearchContext\n      resource={context?.resource}\n      initialPagination={context?.pagination}\n      initialColumns={columns}\n      initialRows={rows}\n      initialFilterMenus={context?.filter_menus}\n      initialFiltersLocked={undefined}\n      initialFilterValues={filters}\n      initialSearchSyntaxes={context?.search_syntaxes}\n      id={`queryeditquantity-${quantityDef._qualifiedName}`}\n    >\n      <SearchDialog\n        open={open}\n        filters={filters}\n        onCancel={handleCancel}\n        onQueryChanged={handleQueryChanged}\n        pageSize={maxData || 100}\n      />\n    </FreeformSearchContext>\n  </React.Fragment>\n}\nQueryEditQuantity.propTypes = {\n  // The quantity definition\n  quantityDef: PropTypes.object,\n  // The event when the searched results have been changed\n  onChange: PropTypes.func,\n  // The searched value\n  value: PropTypes.string,\n  // To store the search results in the value\n  storeInArchive: PropTypes.bool,\n  // The index of the quantity which repeats\n  index: PropTypes.number,\n  // The maximum number of searched data\n  maxData: PropTypes.number\n}\n\nexport default QueryEditQuantity\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {DateEditQuantity, DateTimeEditQuantity, TimeEditQuantity} from './DateTimeEditQuantity'\nimport { StringEditQuantity, URLEditQuantity } from './StringEditQuantity'\nimport {NumberEditQuantity} from './NumberEditQuantity'\nimport {EnumEditQuantity} from './EnumEditQuantity'\nimport {AutocompleteEditQuantity} from './AutocompleteEditQuantity'\nimport {BoolEditQuantity} from './BoolEditQuantity'\nimport FileEditQuantity from './FileEditQuantity'\nimport RichTextEditQuantity from './RichTextEditQuantity'\nimport ReferenceEditQuantity from './ReferenceEditQuantity'\nimport AuthorEditQuantity from './AuthorEditQuantity'\nimport { RadioEnumEditQuantity } from './RadioEnumEditQuantity'\nimport QueryEditQuantity from \"./QueryEditQuantity\"\n\nexport const editQuantityComponents = {\n  NumberEditQuantity: NumberEditQuantity,\n  StringEditQuantity: StringEditQuantity,\n  URLEditQuantity: URLEditQuantity,\n  EnumEditQuantity: EnumEditQuantity,\n  SelectEnumEditQuantity: EnumEditQuantity,\n  RadioEnumEditQuantity: RadioEnumEditQuantity,\n  AutocompleteEditQuantity: AutocompleteEditQuantity,\n  BoolEditQuantity: BoolEditQuantity,\n  FileEditQuantity: FileEditQuantity,\n  DateTimeEditQuantity: DateTimeEditQuantity,\n  DateEditQuantity: DateEditQuantity,\n  TimeEditQuantity: TimeEditQuantity,\n  RichTextEditQuantity: RichTextEditQuantity,\n  ReferenceEditQuantity: ReferenceEditQuantity,\n  AuthorEditQuantity: AuthorEditQuantity,\n  QueryEditQuantity: QueryEditQuantity\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useMemo, useRef, useState} from 'react'\nimport PropTypes from 'prop-types'\nimport {PropertyCard} from './PropertyCard'\nimport SectionEditor from '../../archive/SectionEditor'\nimport { useEntryStore } from '../EntryContext'\nimport {Box, IconButton, Typography, makeStyles} from '@material-ui/core'\nimport CodeIcon from '@material-ui/icons/Code'\nimport MoreIcon from '@material-ui/icons/MoreVert'\nimport { ArchiveButton } from '../../nav/Routes'\nimport {getAllVisibleProperties, SectionPlots} from '../../archive/ArchiveBrowser'\nimport Quantity, {QuantityCell, QuantityRow, QuantityTable} from '../../Quantity'\nimport {Editor} from '@tinymce/tinymce-react'\nimport { pluralize } from '../../../utils'\nimport {Matrix} from '../../archive/visualizations'\nimport { isEditable } from '../../archive/metainfo'\n\nconst useStyles = makeStyles(theme => ({\n  subSection: {\n    width: '100%',\n    display: 'flex',\n    flexDirection: 'column',\n    justifyContent: 'center'\n  },\n  arrayAction: {\n    padding: 0\n  },\n  subSectionAction: {\n  },\n  row: {\n    display: 'flex',\n    justifyContent: 'space-between'\n  }\n}))\n\nexport const PropertyPreview = React.memo(({quantityDef, section}) => {\n  const classes = useStyles()\n  const {entryId, uploadId} = useEntryStore()\n  const maxPreviewLength = 5\n  if (!quantityDef.type) {\n    return null\n  }\n\n  const shape = quantityDef.shape || []\n  if (shape.length === 0) {\n    if (quantityDef.m_annotations?.eln?.[0]?.component === 'RichTextEditQuantity') {\n      return <QuantityCell >\n        <Quantity data={section} quantity={quantityDef} maxWidth={'100%'}>\n          <Editor\n            init={{\n              height: '600px',\n              width: '100%',\n              plugins: [\n                'advlist autolink lists link image charmap print preview anchor',\n                'searchreplace visualblocks code',\n                'insertdatetime media table paste code help wordcount'\n              ],\n              skin: 'nomadPreview',\n              resize: false,\n              toolbar: false,\n              menubar: false,\n              branding: false,\n              statusbar: false\n            }}\n            initialValue={section[quantityDef.name]}\n            disabled={true}\n          />\n        </Quantity>\n      </QuantityCell>\n    }\n    return <QuantityCell >\n      <Quantity data={section} quantity={quantityDef} />\n    </QuantityCell>\n  } else if (shape.length === 1) {\n    const values = section[quantityDef.name] || []\n    return <QuantityCell>\n      <Quantity data={section} quantity={quantityDef} >\n        <Box width='100%'>\n          {values.slice(0, maxPreviewLength).map((value, index) =>\n            <Quantity key={index} data={{[quantityDef.name]: value}} quantity={quantityDef} noLabel/>\n          )}\n          {values.length >= maxPreviewLength &&\n            <Box className={classes.row}>\n              <Typography noWrap variant={'body1'}>\n                {`and ${values.length - maxPreviewLength} more ${pluralize('item', values.length - maxPreviewLength, false)}`}\n              </Typography>\n              <ArchiveButton\n                className={classes.arrayAction}\n                component={IconButton}\n                entryId={entryId} uploadId={uploadId}\n                path={`data/${quantityDef.name}`}\n              >\n                <MoreIcon/>\n              </ArchiveButton>\n            </Box>\n          }\n        </Box>\n      </Quantity>\n    </QuantityCell>\n  } else {\n    return <QuantityCell>\n      <Quantity data={section} quantity={quantityDef} >\n        <Box width={'100%'} textAlign='center'>\n          <Matrix\n            values={section[quantityDef.name]}\n            shape={shape}\n            invert={false}\n            type={quantityDef.type.type_data}\n            key={`matrix:${quantityDef.name}`}\n          />\n          <Typography noWrap variant=\"caption\">\n            ({quantityDef.shape.map((dimension, index) => <span key={index}>\n              {index > 0 && <span>&nbsp;&times;&nbsp;</span>}{String(dimension)}\n            </span>)}&nbsp;)\n          </Typography>\n        </Box>\n      </Quantity>\n    </QuantityCell>\n  }\n})\nPropertyPreview.propTypes = {\n  quantityDef: PropTypes.object.isRequired,\n  section: PropTypes.object.isRequired\n}\n\nconst SectionPreview = React.memo(({sectionDef, section}) => {\n  const rootRef = useRef()\n\n  const allVisibleProperties = useMemo(() => getAllVisibleProperties(sectionDef), [sectionDef])\n\n  return (\n    <div ref={rootRef}>\n      {<QuantityTable data={section}>\n        {allVisibleProperties.map(property => (\n          <QuantityRow key={property.name} >\n            <PropertyPreview quantityDef={property} section={section}/>\n          </QuantityRow>\n        ))}\n      </QuantityTable>}\n    </div>\n  )\n})\nSectionPreview.propTypes = {\n  sectionDef: PropTypes.object.isRequired,\n  section: PropTypes.object\n}\n\nconst SectionCard = React.memo(({archivePath, sectionDef, section, readOnly, ...props}) => {\n  const {entryId, uploadId} = useEntryStore()\n  const [showJson, setShowJson] = useState(false)\n\n  const actions = <React.Fragment>\n    <IconButton onClick={() => setShowJson(value => !value)}>\n      <CodeIcon />\n    </IconButton>\n    <ArchiveButton\n      component={IconButton}\n      entryId={entryId} uploadId={uploadId}\n      path={archivePath}\n    >\n      <MoreIcon/>\n    </ArchiveButton>\n  </React.Fragment>\n\n  if (!sectionDef) {\n    console.error('SectionCard: section definition is not available')\n    return null\n  }\n\n  return <PropertyCard title={sectionDef.label || sectionDef.name} action={actions}>\n    {sectionDef._qualifiedName === 'nomad.parsing.tabular.Table' && (\n      <Box margin={2}>\n        <Typography>Data from a table with {section.row_refs?.length || '...'} rows.</Typography>\n      </Box>\n    )}\n    <Box>\n      {(readOnly || !isEditable(sectionDef))\n        ? (\n          <SectionPreview\n            sectionDef={sectionDef}\n            section={section}\n            archivePath={archivePath}\n            {...props}\n          />\n        ) : (\n          <SectionEditor\n            sectionDef={sectionDef}\n            section={section}\n            showJson={showJson}\n            {...props}\n          />\n        )}\n      {(sectionDef.m_annotations?.plot || sectionDef._allBaseSections.map(section => section.name).includes('PlotSection')) && <SectionPlots sectionDef={sectionDef} section={section} uploadId={uploadId} entryId={entryId}/>}\n    </Box>\n  </PropertyCard>\n})\n\nSectionCard.propTypes = {\n  archivePath: PropTypes.string.isRequired,\n  sectionDef: PropTypes.object.isRequired,\n  section: PropTypes.object.isRequired,\n  readOnly: PropTypes.bool\n}\n\nexport default SectionCard\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useCallback, useMemo, useRef } from 'react'\nimport PropTypes from 'prop-types'\nimport { Box, makeStyles } from '@material-ui/core'\nimport { useEntryStore } from '../entry/EntryContext'\nimport { extend } from 'lodash'\nimport ListEditQuantity from '../editQuantity/ListEditQuantity'\nimport InputConfig from '../search/input/InputConfig'\nimport { editQuantityComponents } from '../editQuantity/EditQuantity'\nimport { QuantityMDef } from './metainfo'\nimport {getAllVisibleProperties} from './ArchiveBrowser'\nimport {QuantityRow, QuantityTable} from '../Quantity'\nimport {PropertyPreview} from '../entry/properties/SectionCard'\n\nconst PropertyEditor = React.memo(function PropertyEditor({quantityDef, value, onChange}) {\n  const editAnnotations = quantityDef.m_annotations?.eln || []\n  const editAnnotation = editAnnotations[0] || {}\n  const {component, props, ...moreProps} = editAnnotation\n  const editComponent = component && editQuantityComponents[component]\n  if (!editComponent) {\n    return null\n  }\n  const editComponentProps = {\n    quantityDef: quantityDef,\n    value: value === undefined ? quantityDef.default : value,\n    onChange: onChange,\n    ...moreProps,\n    ...(props || {})\n  }\n\n  const shape = quantityDef.shape || []\n  if (shape.length === 0) {\n    return <Box data-testid={\"editable-quantity-editor\"}>\n      {React.createElement(editComponent, editComponentProps)}\n    </Box>\n  } else if (shape.length === 1) {\n    return <Box data-testid={\"editable-quantity-editor\"}>\n      <ListEditQuantity\n        component={editComponent}\n        {...editComponentProps}\n      />\n    </Box>\n  } else {\n    console.log('Unsupported quantity shape ', shape)\n    return null\n  }\n})\nPropertyEditor.propTypes = {\n  quantityDef: PropTypes.object.isRequired,\n  value: PropTypes.any,\n  onChange: PropTypes.func.isRequired\n}\n\nconst useSectionEditorStyles = makeStyles(theme => ({\n  root: {\n    minWidth: 600\n  },\n  quantityTable: {\n    marginBottom: 5\n  }\n}))\nconst SectionEditor = React.memo(function SectionEditor({sectionDef, section, onChange, showJson}) {\n  const classes = useSectionEditorStyles()\n  const {handleArchiveChanged} = useEntryStore() || {}\n  const rootRef = useRef()\n\n  const handleChange = useCallback((property, value) => {\n    if (section[property.name] === value) {\n      return\n    }\n    section[property.name] = value\n    if (onChange) {\n      onChange(section)\n    }\n    handleArchiveChanged()\n  }, [section, onChange, handleArchiveChanged])\n\n  const handleJsonChange = useCallback((data) => {\n    extend(section, data)\n    if (onChange) {\n      onChange(section)\n    }\n    handleArchiveChanged()\n  }, [handleArchiveChanged, onChange, section])\n\n  const allVisibleProperties = useMemo(() => getAllVisibleProperties(sectionDef), [sectionDef])\n  const allVisibleQuantities = useMemo(() => allVisibleProperties.filter(property => property.m_def === QuantityMDef && property.m_annotations?.eln), [allVisibleProperties])\n\n  const jsonData = useMemo(() => {\n    if (!showJson) {\n      return null\n    }\n    const jsonData = {}\n    allVisibleQuantities\n      .filter(property => {\n        // TODO this is just a hack to avoid large values, e.g. rich text with images\n        const value = section[property.name]\n        return !value || typeof value !== 'string' || value.length <= 1e3\n      })\n      .forEach(property => {\n        jsonData[property.name] = section[property.name]\n      })\n    return jsonData\n  }, [showJson, allVisibleQuantities, section])\n\n  return (\n    <div className={classes.root} ref={rootRef}>\n      {showJson\n        ? (\n          <Box height={rootRef.current?.clientHeight} marginY={1}>\n            <InputConfig data={jsonData} onChange={handleJsonChange} />\n          </Box>\n        ) : (\n          allVisibleQuantities.map(quantity => (\n            quantity._isEditable\n              ? <Box marginBottom={1} key={quantity.name} data-testid={\"visible-quantity\"}>\n                <PropertyEditor\n                  quantityDef={quantity}\n                  value={section?.[quantity.name]} onChange={value => handleChange(quantity, value)}\n                />\n              </Box>\n              : <Box key={quantity.name} data-testid={\"visible-quantity\"}>\n                <QuantityTable className={classes.quantityTable} data={section}>\n                  <QuantityRow>\n                    <PropertyPreview quantityDef={quantity} section={section}/>\n                  </QuantityRow>\n                </QuantityTable>\n              </Box>\n          ))\n        )\n      }\n    </div>\n  )\n})\nSectionEditor.propTypes = {\n  sectionDef: PropTypes.object.isRequired,\n  section: PropTypes.object,\n  onChange: PropTypes.func,\n  showJson: PropTypes.bool,\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ])\n}\n\nexport default SectionEditor\n","import React, {useMemo} from 'react'\nimport {Box} from '@material-ui/core'\nimport {Quantity as Q} from '../units/Quantity'\nimport {useUnitContext} from '../units/UnitContext'\nimport {titleCase, resolveInternalRef} from '../../utils'\nimport {cloneDeep, merge} from 'lodash'\nimport Plot from '../plotting/Plot'\nimport PropTypes from 'prop-types'\nimport {withErrorHandler} from '../ErrorHandler'\n\nclass XYPlotError extends Error {\n  constructor(message) {\n    super(message)\n    this.name = 'XYPlotError'\n  }\n}\n\nconst traverse = (value, callback, parent = null, key = null) => {\n  if (value && typeof value === 'object') {\n    Object.entries(value).forEach(([k, v]) => {\n      traverse(v, callback, value, k)\n    })\n  } else if (value && Array.isArray(value)) {\n    value.forEach((item, index) => {\n      traverse(item, callback, value, index)\n    })\n  } else {\n    callback(parent, key, value)\n  }\n}\n\nconst PlotlyFigure = React.memo(function PlotlyFigure({plot, section, sectionDef, title, metaInfoLink}) {\n  const {units} = useUnitContext()\n\n  const plotlyGraphObj = useMemo(() => {\n    if (!sectionDef?._properties) {\n      return [undefined, undefined]\n    }\n\n    const toUnit = path => {\n      const relativePath = '/' + path.replace('./', '')\n      const resolvedQuantityDef = resolveInternalRef(relativePath, sectionDef)\n      if (resolvedQuantityDef === undefined || resolvedQuantityDef === null) {\n        throw new XYPlotError(`Could not resolve the path ${path}`)\n      }\n      let value\n      try {\n        value = resolveInternalRef(relativePath, section)\n      } catch (err) {\n        if (!err.message.startsWith('Path does not exist:')) {\n          throw new XYPlotError(err.message)\n        }\n      }\n      if (value === undefined || value === null) {\n        // there is not data yet\n        return [undefined, undefined]\n      }\n      const unit = resolvedQuantityDef?.unit\n      if (unit) {\n        const displayUnit = resolvedQuantityDef?.m_annotations?.eln?.[0]?.defaultDisplayUnit\n        const quantity = displayUnit ? new Q(value, unit).to(displayUnit) : new Q(value, unit).toSystem(units)\n        return [quantity.value(), quantity.label()]\n      } else {\n        return [value, unit]\n      }\n    }\n\n    /**\n     * Recursively splits a path containing slice notation (`start:stop`)\n     * @param {String} path The path which should be split at repeating sections\n     * @param {Boolean} isScalar Whether the quantity at the end of the path is scalar\n     * @returns {Array} The paths and names of the new paths\n     */\n    function resolveSlice(path, isScalar) {\n      const pathArr = path.split('/')\n      for (let i = 0; i < pathArr.length; i++) {\n        const pathSection = pathArr[i]\n        if (pathSection.includes(':')) {\n          const repeatPath = pathArr.slice(0, i).join('/')\n          const repeat = resolveInternalRef('/' + repeatPath.replace('./', ''), section)\n          if (repeat === undefined) { return [[], []] }\n          // Get start and stop from python slice notation\n          let [start, stop, rest] = pathSection.split(':').map((x) => x === '' ? undefined : parseInt(x))\n          if (Number.isNaN(start) || Number.isNaN(stop) || rest !== undefined) {\n            throw new XYPlotError(`Invalid slice notation: \"${pathSection}\"`)\n          }\n          start = start === undefined || start < -repeat.length ? 0 : (start < 0 ? start + repeat.length : start)\n          stop = stop === undefined || stop > repeat.length ? repeat.length : (stop < 0 ? stop + repeat.length : stop)\n          // If there are initialized sections in this range\n          if (stop > start) {\n            const remainPath = pathArr.slice(i + 1).join('/')\n            const allPaths = []\n            const allNames = []\n            for (let j = start; j < stop; j++) {\n              const repeatDef = resolveInternalRef('/' + repeatPath.replace('./', '') + `/${j}/sub_section`, sectionDef)\n              const label = isScalar ? undefined : (repeat[j][repeatDef?.more?.label_quantity] ?? repeat[j].name)\n              const [paths, names] = resolveSlice(`${repeatPath}/${j}/${remainPath}`, isScalar)\n              const subSectionName = label ?? `${titleCase(pathArr[i - 1])}${isScalar ? '' : ` ${j}`}`\n              names.forEach((name) => { allNames.push(`${subSectionName}, ${name}`) })\n              allPaths.push(...paths)\n            }\n            return [allPaths, allNames]\n          }\n          return [[], []]\n        }\n      }\n      return [[path], [titleCase(pathArr[pathArr.length - 1])]]\n    }\n\n    /**\n     * Function for getting all the paths for an array of paths that may contain slice\n     * notation. The function also returns names to be used as labels if withNames is true.\n     * @param {Array} slicedPaths The array of paths that may contatin slice notation\n     * @param {Boolean} withNames Whether or not the functiion should return names\n     * @returns Array of paths or Array of Array of paths and names\n     */\n    function getSlicedPaths(path, withNames) {\n      const slicedPaths = Array.isArray(path) ? path : [path]\n      const allPaths = []\n      const Names = []\n      slicedPaths.forEach((slicedPath) => {\n        const pathRelative = '/' + slicedPath.replace('./', '')\n        // Removes the index in the path and resolve the shape of the quantity\n        const isScalar = resolveInternalRef(pathRelative.replace(/\\/-?\\d*:-?\\d*/gm, '/0') + '/shape', sectionDef)?.length === 0\n        const [paths, names] = resolveSlice(pathRelative, isScalar)\n        // If the quanitity is a scalar an Array of paths is added otherwise the paths are added one by one\n        allPaths.push(...(isScalar ? [paths] : paths))\n        if (withNames) {\n          // For scalar quantities the name is taken as the first one\n          Names.push(...(isScalar ? [names[0]] : names))\n        }\n      })\n      return withNames ? [allPaths, Names] : allPaths\n    }\n\n    /**\n     * Gets the value array, unit and split path for:\n     * 1. A path to an array quanitity\n     * or\n     * 2. An array of paths to a scalar quantity\n     * @param {*} path String path or Array of string paths\n     * @returns Array of [value, unit, split path]\n     */\n    function getValues(path) {\n      let Values = []\n      let Unit = ''\n      let pathArray = ''\n      if (Array.isArray(path)) {\n        // If path is an Array of paths the quantity is scalar and Values is build from all of them\n        path.forEach((Point) => {\n          const [Value, PointUnit] = toUnit(Point)\n          Values.push(Value)\n          Unit = PointUnit\n          pathArray = Point.split('/')\n        })\n      } else {\n        [Values, Unit] = toUnit(path)\n        pathArray = path.split('/')\n      }\n      return [Values, Unit, pathArray]\n    }\n\n    const xUnits = []\n    const xLabels = []\n    const yUnits = []\n    const yLabels = []\n    const zUnits = []\n    const zLabels = []\n\n    const resolveReferences = (data, key, units, labels) => {\n      const value = data?.[key]\n      if (value && (typeof value === 'string' || value instanceof String)) {\n        if (value.startsWith(\"#\")) {\n          const [paths, names] = getSlicedPaths(value.slice(1), true)\n          const [values, unit, path] = getValues(paths[0])\n          const label = names[0] || titleCase(path[path.length - 1])\n          data[key] = values\n          units.push(unit)\n          labels.push(label)\n        }\n      }\n    }\n\n    const plotlyGraphObj = cloneDeep(plot)\n    const isDataArray = plotlyGraphObj?.data && Array.isArray(plotlyGraphObj.data)\n    const dataArray = isDataArray ? plotlyGraphObj.data : [plotlyGraphObj.data]\n    dataArray.forEach((data, index) => {\n      resolveReferences(data, 'x', xUnits, xLabels)\n      resolveReferences(data, 'y', yUnits, yLabels)\n      resolveReferences(data, 'z', zUnits, zLabels)\n    })\n\n    traverse(plotlyGraphObj.data, (data, key, value) => {\n      if (key === 'color') {\n        if (typeof value === 'string' || value instanceof String) {\n          if (value.startsWith(\"#\")) {\n            let paths, values\n            try {\n              [paths] = getSlicedPaths(value.slice(1), true);\n              [values] = getValues(paths[0])\n            } catch (error) {\n              if (value && /^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.test(value)) {\n                values = value\n              } else {\n                throw new XYPlotError(error)\n              }\n            }\n            data[key] = values\n          }\n        }\n      }\n    })\n\n    const layout = {}\n    if (xLabels.length > 0) {\n      layout.xaxis = {\n        title: xUnits[0] ? `${xLabels[0]} (${xUnits[0]})` : xLabels[0]\n      }\n    }\n    yLabels.forEach((yLabel, index) => {\n      layout[index === 0 ? 'yaxis' : `yaxis${index + 1}`] = {\n        title: yUnits[index] ? `${yLabel} (${yUnits[index]})` : yLabel\n      }\n    })\n    zLabels.forEach((zLabel, index) => {\n      layout[index === 0 ? 'zaxis' : `zaxis${index + 1}`] = {\n        title: zUnits[index] ? `${zLabel} (${zUnits[index]})` : zLabel\n      }\n    })\n\n    plotlyGraphObj.layout = merge({}, layout, plotlyGraphObj.layout)\n    return plotlyGraphObj\n  }, [plot, section, sectionDef, units])\n\n  return <Box minWidth={500} height={plotlyGraphObj?.layout?.height || plotlyGraphObj?.layout?.template?.layout?.height || 500}>\n    <Plot\n      data={plotlyGraphObj.data}\n      layout={plotlyGraphObj.layout}\n      floatTitle={title}\n      fixedMargins={true}\n      config={plotlyGraphObj.config}\n      metaInfoLink={metaInfoLink}\n    />\n  </Box>\n})\nPlotlyFigure.propTypes = {\n  plot: PropTypes.object.isRequired,\n  sectionDef: PropTypes.object.isRequired,\n  section: PropTypes.object,\n  title: PropTypes.string,\n  metaInfoLink: PropTypes.string\n}\n\nexport default withErrorHandler(\n  (error) => error.name === 'XYPlotError'\n    ? error.message\n    : 'Could not load plot due to an unexpected error.'\n)(PlotlyFigure)\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useCallback, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport clsx from 'clsx'\nimport { Paper, Tooltip, IconButton } from '@material-ui/core'\nimport SearchIcon from '@material-ui/icons/Search'\nimport { useStyles } from '../search/SearchBar'\nimport { InputMetainfoControlled } from '../search/input/InputMetainfo'\n\n/**\n * This component shows a search bar with autocomplete functionality.\n */\nconst ArchiveSearchBar = React.memo(({options, group, onChange, className}) => {\n  const [value, setValue] = useState(null)\n  const styles = useStyles()\n\n  const handleSelect = useCallback((key) => {\n    const obj = options[key]\n    setValue(obj?.primary)\n    onChange && onChange(obj.url)\n  }, [options, onChange])\n\n  const handleAccept = useCallback((key) => {\n    const obj = options[key]\n    if (obj && onChange) onChange(obj.url)\n  }, [options, onChange])\n\n  return <Paper className={clsx(className, styles.root)}>\n    <InputMetainfoControlled\n      value={value}\n      onChange={setValue}\n      onSelect={handleSelect}\n      onAccept={handleAccept}\n      options={options}\n      group={group}\n      TextFieldProps={{\n        variant: \"outlined\",\n        placeholder: \"Type your keyword here\",\n        size: \"medium\"\n      }}\n      InputProps={{\n        classes: {\n          notchedOutline: styles.notchedOutline\n        },\n        startAdornment: <Tooltip title=\"Add filter\">\n          <IconButton className={styles.iconButton} onClick={() => handleAccept(value)} aria-label=\"search\">\n            <SearchIcon />\n          </IconButton>\n        </Tooltip>\n      }}\n    />\n  </Paper>\n})\n\nArchiveSearchBar.propTypes = {\n  options: PropTypes.objectOf(PropTypes.shape({\n    primary: PropTypes.string,\n    secondary: PropTypes.string,\n    group: PropTypes.string,\n    key: PropTypes.string,\n    url: PropTypes.string\n  })),\n  group: PropTypes.bool,\n  onChange: PropTypes.func,\n  className: PropTypes.string\n}\n\nexport default ArchiveSearchBar\n","import React, {useMemo} from 'react'\nimport {Box, useTheme} from '@material-ui/core'\nimport {Quantity as Q} from '../units/Quantity'\nimport { useUnitContext } from '../units/UnitContext'\nimport {titleCase, resolveInternalRef} from '../../utils'\nimport {getLineStyles} from '../plotting/common'\nimport { merge } from 'lodash'\nimport Plot from '../plotting/Plot'\nimport PropTypes from 'prop-types'\nimport {withErrorHandler} from '../ErrorHandler'\n\nclass XYPlotError extends Error {\n  constructor(message) {\n    super(message)\n    this.name = 'XYPlotError'\n  }\n}\n\nconst XYPlot = React.memo(function XYPlot({plot, section, sectionDef, title}) {\n  const theme = useTheme()\n  const {units} = useUnitContext()\n  const xAxis = plot.x || plot['x_axis'] || plot['xAxis']\n  const yAxis = plot.y || plot['y_axis'] || plot['yAxis']\n\n  const [data, layout] = useMemo(() => {\n    if (!sectionDef?._properties) {\n      return [undefined, undefined]\n    }\n    const XPrime = Array.isArray(xAxis) ? xAxis : [xAxis]\n    const YPrime = Array.isArray(yAxis) ? yAxis : [yAxis]\n    const toUnit = path => {\n      const relativePath = '/' + path.replace('./', '')\n      const resolvedQuantityDef = resolveInternalRef(relativePath, sectionDef)\n      if (resolvedQuantityDef === undefined || resolvedQuantityDef === null) {\n        throw new XYPlotError(`Could not resolve the path ${path}`)\n      }\n      let value\n      try {\n        value = resolveInternalRef(relativePath, section)\n      } catch (err) {\n        if (!err.message.startsWith('Path does not exist:')) {\n          throw new XYPlotError(err.message)\n        }\n      }\n      if (value === undefined || value === null) {\n        // there is not data yet\n        return [undefined, undefined]\n      }\n      const unit = resolvedQuantityDef?.unit\n      if (unit) {\n        const displayUnit = resolvedQuantityDef?.m_annotations?.eln?.[0]?.defaultDisplayUnit\n        const quantity = displayUnit ? new Q(value, unit).to(displayUnit) : new Q(value, unit).toSystem(units)\n        return [quantity.value(), quantity.label()]\n      } else {\n        return [value, unit]\n      }\n    }\n\n    /**\n     * Recursively splits a path containing slice notation (`start:stop`)\n     * @param {String} path The path which should be split at repeating sections\n     * @param {Boolean} isScalar Whether the quantity at the end of the path is scalar\n     * @returns {Array} The paths and names of the new paths\n     */\n    function resolveSlice(path, isScalar) {\n      const pathArr = path.split('/')\n      for (let i = 0; i < pathArr.length; i++) {\n        const pathSection = pathArr[i]\n        if (pathSection.includes(':')) {\n          const repeatPath = pathArr.slice(0, i).join('/')\n          const repeat = resolveInternalRef('/' + repeatPath.replace('./', ''), section)\n          if (repeat === undefined) { return [[], []] }\n          // Get start and stop from python slice notation\n          let [start, stop, rest] = pathSection.split(':').map((x) => x === '' ? undefined : parseInt(x))\n          if (Number.isNaN(start) || Number.isNaN(stop) || rest !== undefined) {\n            throw new XYPlotError(`Invalid slice notation: \"${pathSection}\"`)\n          }\n          start = start === undefined || start < -repeat.length ? 0 : (start < 0 ? start + repeat.length : start)\n          stop = stop === undefined || stop > repeat.length ? repeat.length : (stop < 0 ? stop + repeat.length : stop)\n          // If there are initialized sections in this range\n          if (stop > start) {\n            const remainPath = pathArr.slice(i + 1).join('/')\n            const allPaths = []\n            const allNames = []\n            for (let j = start; j < stop; j++) {\n              const repeatDef = resolveInternalRef('/' + repeatPath.replace('./', '') + `/${j}/sub_section`, sectionDef)\n              const label = isScalar ? undefined : (repeat[j][repeatDef?.more?.label_quantity] ?? repeat[j].name)\n              const [paths, names] = resolveSlice(`${repeatPath}/${j}/${remainPath}`, isScalar)\n              const subSectionName = label ?? `${titleCase(pathArr[i - 1])}${isScalar ? '' : ` ${j}`}`\n              names.forEach((name) => { allNames.push(`${subSectionName}, ${name}`) })\n              allPaths.push(...paths)\n            }\n            return [allPaths, allNames]\n          }\n          return [[], []]\n        }\n      }\n      return [[path], [titleCase(pathArr[pathArr.length - 1])]]\n    }\n\n    /**\n     * Function for getting all the paths for an array of paths that may contain slice\n     * notation. The function also returns names to be used as labels if withNames is true.\n     * @param {Array} slicedPaths The array of paths that may contatin slice notation\n     * @param {Boolean} withNames Whether or not the functiion should return names\n     * @returns Array of paths or Array of Array of paths and names\n     */\n    function getSlicedPaths(slicedPaths, withNames) {\n      const allPaths = []\n      const Names = []\n      slicedPaths.forEach((slicedPath) => {\n        const pathRelative = '/' + slicedPath.replace('./', '')\n        // Removes the index in the path and resolve the shape of the quantity\n        const isScalar = resolveInternalRef(pathRelative.replace(/\\/-?\\d*:-?\\d*/gm, '/0') + '/shape', sectionDef)?.length === 0\n        const [paths, names] = resolveSlice(pathRelative, isScalar)\n        // If the quanitity is a scalar an Array of paths is added otherwise the paths are added one by one\n        allPaths.push(...(isScalar ? [paths] : paths))\n        if (withNames) {\n          // For scalar quantities the name is taken as the first one\n          Names.push(...(isScalar ? [names[0]] : names))\n        }\n      })\n      return withNames ? [allPaths, Names] : allPaths\n    }\n\n    const [Y, Names] = getSlicedPaths(YPrime, true)\n    const X = getSlicedPaths(XPrime, false)\n    const nLines = Y.length\n\n    /**\n     * Gets the value array, unit and split path for:\n     * 1. A path to an array quanitity\n     * or\n     * 2. An array of paths to a scalar quantity\n     * @param {*} path String path or Array of string paths\n     * @returns Array of [value, unit, split path]\n     */\n    function getValues(path) {\n      let Values = []\n      let Unit = ''\n      let pathArray = ''\n      if (Array.isArray(path)) {\n        // If path is an Array of paths the quantity is scalar and Values is build from all of them\n        path.forEach((Point) => {\n          const [Value, PointUnit] = toUnit(Point)\n          Values.push(Value)\n          Unit = PointUnit\n          pathArray = Point.split('/')\n        })\n      } else {\n        [Values, Unit] = toUnit(path)\n        pathArray = path.split('/')\n      }\n      return [Values, Unit, pathArray]\n    }\n\n    const xUnits = []\n    const xLabels = []\n    const xValuesArray = []\n    X.forEach((x) => {\n      const [xValues, xUnit, xPath] = getValues(x)\n      const xLabel = titleCase(xPath[xPath.length - 1])\n      xUnits.push(xUnit)\n      xLabels.push(xLabel)\n      xValuesArray.push(xValues)\n    })\n\n    const isMultiX = X.length > 1\n\n    const lines = getLineStyles(nLines, theme).map(line => {\n      return {type: 'scatter',\n        line: line}\n    })\n    if (plot.lines) {\n      Y.forEach((y, index) => {\n        merge(lines[index], plot.lines[index])\n      })\n    }\n\n    if (isMultiX) {\n      if (X.length !== Y.length) {\n        throw new XYPlotError('The length of provided x axes and y axes do not match!')\n      }\n      if (xUnits.some(unit => unit !== xUnits[0])) {\n        throw new XYPlotError('Different units are provided for x data. Multi xAxis plot is not supported!')\n      }\n    }\n\n    const data = []\n    const yUnits = []\n    const yLabels = []\n    Y.forEach((y, index) => {\n      const [yValues, yUnit, yPath] = getValues(y)\n      // For scalar quantities the default mode is set to 'markers'\n      lines[index].mode = lines[index].mode ?? (Array.isArray(y) ? 'markers' : 'lines')\n      const yLabel = titleCase(yPath[yPath.length - 1])\n      const line = {\n        name: Names[index],\n        x: isMultiX ? xValuesArray[index] : xValuesArray[0],\n        y: yValues,\n        ...lines[index]\n      }\n      data.push(line)\n      yUnits.push(yUnit)\n      yLabels.push(yLabel)\n    })\n\n    const getColor = index => {\n      const line = lines[index]\n      if ('mode' in line) {\n        if (line.mode === 'lines') {\n          return {color: line.line?.color}\n        } else if (line.mode === 'markers') {\n          return {color: line.marker?.color}\n        }\n      }\n      return {color: '#000000'}\n    }\n\n    const sameUnit = !yUnits.some(unit => unit !== yUnits[0])\n\n    const layout = {\n      xaxis: {\n        title: xUnits[0] ? `${xLabels[0]} (${xUnits[0]})` : xLabels[0],\n        fixedrange: false\n      },\n      yaxis: {\n        title: sameUnit ? (yUnits[0] ? `${titleCase(title)} (${yUnits[0]})` : titleCase(title)) : (yUnits[0] ? `${yLabels[0]} (${yUnits[0]})` : yLabels[0]),\n        titlefont: !sameUnit && nLines > 1 ? getColor(0) : undefined,\n        tickfont: !sameUnit && nLines > 1 ? getColor(0) : undefined\n      },\n      showlegend: sameUnit && nLines > 1,\n      legend: {\n        x: 1,\n        y: 1,\n        xanchor: 'right'\n      }\n    }\n\n    if (!sameUnit) {\n      Y.forEach((y, index) => {\n        const color = getColor(index)\n        if (index > 0) {\n          layout[`yaxis${index + 1}`] = {\n            title: yUnits[index] ? `${yLabels[index]} (${yUnits[index]})` : yLabels[index],\n            anchor: index === 1 ? 'x' : 'free',\n            overlaying: 'y',\n            side: index % 2 === 0 ? 'left' : 'right',\n            titlefont: nLines > 1 ? color : undefined,\n            tickfont: nLines > 1 ? color : undefined,\n            position: index % 2 === 0 ? 0.1 * index : 1.0 - 0.1 * (index - 1)\n          }\n          data[index]['yaxis'] = `y${index + 1}`\n        }\n      })\n    }\n\n    if (plot.layout) {\n      merge(layout, plot.layout)\n    }\n    return [data, layout]\n  }, [plot.layout, plot.lines, xAxis, yAxis, section, sectionDef, theme, title, units])\n\n  return <Box minWidth={500} height={500}>\n    <Plot\n      data={data}\n      layout={layout}\n      floatTitle={title}\n      fixedMargins={true}\n      config={plot.config}\n    />\n  </Box>\n})\nXYPlot.propTypes = {\n  plot: PropTypes.object.isRequired,\n  sectionDef: PropTypes.object.isRequired,\n  section: PropTypes.object,\n  title: PropTypes.string\n}\n\nexport default withErrorHandler(\n  (error) => error.name === 'XYPlotError'\n    ? error.message\n    : 'Could not load plot due to an unexpected error.'\n)(XYPlot)\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useCallback, useContext, useEffect, useMemo, useRef, useState} from 'react'\nimport PropTypes from 'prop-types'\nimport { atom, useRecoilState, useRecoilValue } from 'recoil'\nimport {\n  Box, Button, Checkbox, Dialog, DialogActions, DialogContent, DialogContentText, FormControl, FormControlLabel,\n  FormGroup, FormHelperText, Grid, IconButton, makeStyles, MenuItem, TextField, Tooltip, Typography\n} from '@material-ui/core'\nimport {useHistory, useRouteMatch} from 'react-router-dom'\nimport Browser, {\n  Adaptor, browserContext, Compartment, Content, Item, ItemChip, laneContext, useLane\n} from './Browser'\nimport { RawFileAdaptor } from './FileBrowser'\nimport {\n  AttributeMDef, getUrlFromDefinition, isEditable, isReference, PackageMDef, QuantityMDef, quantityUsesFullStorage,\n  removeSubSection, SectionMDef, SubSectionMDef, useMetainfo\n} from './metainfo'\nimport { ArchiveTitle, DefinitionLabel, metainfoAdaptorFactory } from './MetainfoBrowser'\nimport { Matrix, Number } from './visualizations'\nimport Markdown from '../Markdown'\nimport { Overview } from './Overview'\nimport { Quantity as Q } from '../units/Quantity'\nimport ArrowRightIcon from '@material-ui/icons/ArrowRight'\nimport ArrowDownIcon from '@material-ui/icons/ArrowDropDown'\nimport DownloadIcon from '@material-ui/icons/CloudDownload'\nimport SaveIcon from '@material-ui/icons/Save'\nimport AddIcon from '@material-ui/icons/AddCircle'\nimport CodeIcon from '@material-ui/icons/Code'\nimport DeleteIcon from '@material-ui/icons/Delete'\nimport grey from '@material-ui/core/colors/grey'\nimport classNames from 'classnames'\nimport { useApi } from '../api'\nimport { useErrors } from '../errors'\nimport { SourceApiCall, SourceApiDialogButton, SourceJsonDialogButton } from '../buttons/SourceDialogButton'\nimport { Download } from '../entry/Download'\nimport Pagination from '../visualization/Pagination'\nimport SectionEditor from './SectionEditor'\nimport PlotlyFigure from './PlotlyFigure'\nimport {\n  appendDataUrl, createEntryUrl, createUploadUrl, formatTimestamp, parseNomadUrl, refType, resolveInternalRef,\n  resolveNomadUrl, systemMetainfoUrl, titleCase, isWaitingForUpdateTestId, resolveNomadUrlNoThrow, getOptions,\n  getDisplayLabel\n} from '../../utils'\nimport { EntryButton } from '../nav/Routes'\nimport NavigateIcon from '@material-ui/icons/ArrowForward'\nimport ReloadIcon from '@material-ui/icons/Replay'\nimport UploadIcon from '@material-ui/icons/CloudUpload'\nimport {apiBase} from '../../config'\nimport { Alert } from '@material-ui/lab'\nimport { complex, format } from 'mathjs'\nimport ReactJson from 'react-json-view'\nimport { range, isNaN, partition } from 'lodash'\nimport { useDataStore, useEntryStoreObj } from '../DataStore'\nimport { useEntryStore } from '../entry/EntryContext'\nimport ArchiveSearchBar from './ArchiveSearchBar'\nimport DOMPurify from 'dompurify'\nimport XYPlot from \"./XYPlot\"\nimport { useDisplayUnit } from '../units/useDisplayUnit'\nimport H5Web from '../visualization/H5Web'\n\nexport const configState = atom({\n  key: 'config',\n  default: {\n    'showMeta': false,\n    'showCodeSpecific': false,\n    'showAllDefined': false\n  }\n})\n\nconst ArchiveBrowser = React.memo(function ArchiveBrowser({url}) {\n  const parsedUrl = useMemo(() => parseNomadUrl(url), [url])\n  const {archive, metadata} = useEntryStoreObj(parsedUrl.deploymentUrl, parsedUrl.entryId, false, '*')\n  const metainfo = useMetainfo(systemMetainfoUrl)\n  const dataStore = useDataStore()\n  const [searchOptions, setSearchOptions] = useState({})\n  const rootSectionDef = metainfo ? metainfo.getEntryArchiveDefinition() : null\n\n  useEffect(() => {\n    if (!metainfo) return\n    let isSubscribed = true\n    archiveSearchOptions(archive, metainfo, metadata, dataStore).then((options) => {\n      isSubscribed && setSearchOptions(options)\n    })\n    return () => {\n      isSubscribed = false\n    }\n  }, [archive, metainfo, metadata, dataStore])\n\n  const adaptor = useMemo(() => {\n    if (!archive || !rootSectionDef) {\n      return null\n    }\n    return archiveAdaptorFactory(url, archive, rootSectionDef)\n  }, [url, archive, rootSectionDef])\n\n  if (!adaptor) {\n    return null\n  }\n\n  // For some reason, this hook does not work in all of the components used in\n  // the Browser (notably: Quantity, QuantityItemPreview). In order to pass the\n  // up-to-date unit information, we pass the hook value down the component\n  // hierarchy.\n  return (\n    <Browser\n      adaptor={adaptor}\n      form={<ArchiveConfigForm searchOptions={searchOptions} data={archive}/>}\n    />\n  )\n})\nArchiveBrowser.propTypes = ({\n  url: PropTypes.string.isRequired\n})\nexport default ArchiveBrowser\n\nexport const ArchiveSaveButton = React.memo(function ArchiveSaveButton(props) {\n  const {editable, archiveHasChanges, saveArchive, reload} = useEntryStore()\n  const [openErrorDialog, setOpenErrorDialog] = useState(false)\n  const [disabled, setDisabled] = useState(false)\n\n  const handleClick = useCallback(() => {\n    saveArchive().catch(error => {\n      if (error?.status === 409) {\n        setOpenErrorDialog(true)\n        setDisabled(true)\n      }\n    })\n  }, [saveArchive])\n\n  const handleReload = useCallback(() => {\n    reload()\n    setOpenErrorDialog(false)\n    setDisabled(false)\n  }, [reload])\n\n  return <React.Fragment>\n    {editable &&\n      <IconButton\n        disabled={!archiveHasChanges || disabled} color=\"primary\"\n        onClick={handleClick}\n      >\n        <Tooltip title=\"Save entry\">\n          <SaveIcon/>\n        </Tooltip>\n      </IconButton>\n    }\n    <Dialog\n      open={openErrorDialog}\n      aria-describedby=\"alert-dialog-description\"\n    >\n      <DialogContent>\n        <DialogContentText>\n          The changes cannot be saved. The content has been modified by someone else.\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => setOpenErrorDialog(false)}>OK</Button>\n        <Button onClick={handleReload} autoFocus>Reload</Button>\n      </DialogActions>\n    </Dialog>\n  </React.Fragment>\n})\n\nexport const ArchiveReloadButton = React.memo(function ArchiveReloadButton(props) {\n  const {reload} = useEntryStore()\n\n  return <React.Fragment>\n    <IconButton\n      color=\"primary\"\n      onClick={reload}\n    >\n      <Tooltip title=\"Reload archive\">\n        <ReloadIcon/>\n      </Tooltip>\n    </IconButton>\n  </React.Fragment>\n})\n\nconst useStyles = makeStyles(theme => {\n  return {\n    container: {\n      alignItems: 'center',\n      flexWrap: 'nowrap'\n    },\n    searchBar: {\n      width: 750,\n      marginRight: theme.spacing(1)\n    }\n  }\n})\n\nconst ArchiveConfigForm = React.memo(function ArchiveConfigForm({searchOptions, data}) {\n  const styles = useStyles()\n  const [config, setConfig] = useRecoilState(configState)\n  const history = useHistory()\n  const { url } = useRouteMatch()\n\n  const handleConfigChange = event => {\n    const changes = {[event.target.name]: event.target.checked}\n    if (changes.showCodeSpecific) {\n      changes.showAllDefined = !changes.showCodeSpecific\n    } else if (changes.showAllDefined) {\n      changes.showCodeSpecific = !changes.showAllDefined\n    }\n    setConfig({...config, ...changes})\n  }\n\n  const entryId = data?.metadata?.entry_id\n\n  const handleChange = useCallback((path) => {\n    if (path) {\n      history.push(url + path)\n    }\n  }, [history, url])\n\n  return (\n    <Box marginBottom={1.5} padding={0}>\n      <FormGroup row className={styles.container}>\n        <ArchiveSearchBar\n          options={searchOptions}\n          onChange={handleChange}\n          className={styles.searchBar}\n          group\n        />\n        <Box flexGrow={1}/>\n        <Tooltip title=\"Enable to also show all code specific data\">\n          <FormControlLabel\n            control={\n              <Checkbox\n                checked={config.showCodeSpecific}\n                onChange={handleConfigChange}\n                name=\"showCodeSpecific\"\n              />\n            }\n            label=\"code specific\"\n          />\n        </Tooltip>\n        <Tooltip title=\"Enable to also show metadata that is in principle available, but not within this entry\">\n          <FormControlLabel\n            control={\n              <Checkbox\n                checked={config.showAllDefined}\n                onChange={handleConfigChange}\n                name=\"showAllDefined\"\n              />\n            }\n            label=\"all defined\"\n          />\n        </Tooltip>\n        <Tooltip title=\"Show the Metainfo definition on the bottom of each lane\">\n          <FormControlLabel\n            control={\n              <Checkbox\n                checked={config.showMeta}\n                onChange={handleConfigChange}\n                name=\"showMeta\"/>\n            }\n            label=\"technical view\"\n          />\n        </Tooltip>\n        {entryId && <Download\n          tooltip=\"download the archive\"\n          url={`entries/${entryId}/archive/download?ignore_mime_type=true`}\n          component={IconButton}\n        >\n          <DownloadIcon/>\n        </Download>}\n        <SourceApiDialogButton maxWidth=\"lg\" fullWidth>\n          <SourceApiCall/>\n        </SourceApiDialogButton>\n        <ArchiveReloadButton/>\n        <ArchiveSaveButton/>\n      </FormGroup>\n    </Box>\n  )\n})\nArchiveConfigForm.propTypes = ({\n  data: PropTypes.object.isRequired,\n  searchOptions: PropTypes.object.isRequired\n})\n\nexport const ArchiveReUploadButton = React.memo((props) => {\n  const {uploadId, metadata, reload} = useEntryStore()\n  const {api} = useApi()\n  const {raiseError} = useErrors()\n\n  const handleClick = useCallback((files) => {\n    const input = document.createElement('input')\n    input.type = 'file'\n    input.onchange = (event) => {\n      const file = event.target.files[0]\n      if (!file) {\n        return\n      }\n      const formData = new FormData() // eslint-disable-line no-undef\n      formData.set('file', file, metadata.entry_name)\n      api.put(`uploads/${uploadId}/raw/?wait_for_processing=true`, formData)\n        .then(() => {\n          reload()\n        })\n        .catch(raiseError)\n    }\n\n    input.click()\n  }, [api, metadata?.entry_name, raiseError, reload, uploadId])\n\n  return <IconButton onClick={handleClick}>\n    <Tooltip title=\"Replace this entry's mainfile\">\n      <UploadIcon/>\n    </Tooltip>\n  </IconButton>\n})\n\nexport function archiveAdaptorFactory(archiveRootUrl, archiveRootObj, rootSectionDef) {\n  return new SectionAdaptor(archiveRootUrl, archiveRootObj, rootSectionDef)\n}\n\nasync function archiveSearchOptions(data, metainfo, metadata, dataStore) {\n  const options = {}\n\n  async function traverse(data, sectionDef, parentName, parentPath) {\n    let def = sectionDef\n    if (data?.m_def) {\n      const m_def = data.m_def\n      if (def._qualifiedName === 'nomad.datamodel.data.EntryData' || def._qualifiedName === 'nomad.datamodel.datamodel.EntryArchiveReference') {\n        const url = metadata.upload_id && metadata.entry_id ? `${apiBase}/uploads/${metadata.upload_id}/archive/${metadata.entry_id}` : undefined\n        const sectionDefUrl = resolveNomadUrlNoThrow(m_def, url)\n        def = await dataStore.getMetainfoDefAsync(sectionDefUrl)\n      }\n    }\n\n    for (const key in data) {\n      const childDef = def?._properties?.[key]\n      if (!childDef) {\n        continue\n      }\n\n      if (key === \"quantities\" || key === \"base_sections\" || key === \"sub_sections\" || key === 'processing_logs') {\n        continue\n      }\n\n      if (!(key in data)) {\n        continue\n      }\n\n      const child = data[key]\n\n      if (child === undefined) {\n        continue\n      }\n\n      const isSectionDefinitions = key === 'section_definitions'\n      const path = parentPath ? (isSectionDefinitions ? parentPath : `${parentPath}/${key}`) : `/${key}`\n      const name = parentName ? `${parentName}.${childDef.name}` : childDef.name\n\n      const value = child\n      let secondary = childDef?.m_def || ''\n      if (typeof value !== 'object' && !Array.isArray(value) && value !== null) {\n        secondary = `${value}`\n      }\n      const pathSections = path.split('/')\n      const group = pathSections[0] || pathSections[1]\n      options[name] = {\n        key: name,\n        primary: name,\n        secondary: secondary,\n        group: group,\n        data: data,\n        def: childDef,\n        url: path\n      }\n\n      if (childDef.m_def === SubSectionMDef) {\n        const sectionDef = childDef.sub_section\n        if (Array.isArray(child) && child.length > 0 && child[0]) {\n          if (child.length > 1) {\n            for (const [index, value] of child.entries()) {\n              await traverse(value, sectionDef, isSectionDefinitions ? `${name}.${value.name}` : name, isSectionDefinitions ? `${path}/${value.name}` : `${path}/${index}`)\n            }\n          } else {\n            await traverse(child[0], sectionDef, name, path)\n          }\n        } else {\n          await traverse(child, sectionDef, name, path)\n        }\n      }\n    }\n  }\n\n  await traverse(data, metainfo.getEntryArchiveDefinition(), null, null)\n  return new Promise((resolve, reject) => {\n    resolve(options)\n  })\n}\n\nclass ArchiveAdaptor extends Adaptor {\n  /**\n   * @param {*} objUrl An absolute url (string or a parsed url object), identifying a location in some archive.\n   * @param {*} obj The data that objUrl points to = a location in some archive.\n   * @param {*} def The metainfo definition of obj\n   */\n  constructor(objUrl, obj, def, property, isInEln) {\n    super()\n    this.objUrl = objUrl\n    this.parsedObjUrl = parseNomadUrl(objUrl)\n    if (!this.parsedObjUrl.isResolved) throw new Error(`Resolved url is required, got ${objUrl}`)\n    if (this.parsedObjUrl.type !== refType.archive) throw new Error(`Bad url type, expected entry url, got ${objUrl}`)\n    // Will be set when initializing the adaptor\n    this.api = undefined\n    this.dataStore = undefined\n    this.entryIsEditable = undefined\n    this.isInEln = isInEln === undefined && def.m_def === SectionMDef ? isEditable(def) : isInEln\n    this.obj = obj // The data in the archive tree to display\n    this.def = def\n    this.property = property\n    this.external_refs = {}\n  }\n\n  async initialize(api, dataStore) {\n    this.api = api\n    this.dataStore = dataStore\n    const {editable} = await dataStore.getEntryAsync(\n      this.parsedObjUrl.deploymentUrl, this.parsedObjUrl.entryId, false, '*')\n    this.entryIsEditable = editable\n  }\n\n  async adaptorFactory(objUrl, obj, property) {\n    let def = property\n    if (property.m_def === SubSectionMDef) {\n      def = property.sub_section\n    }\n\n    if (obj.m_def === PackageMDef) {\n      // We're viewing an archive which contains metainfo definitions, and open the definitions node\n      const metainfo = await this.dataStore.getMetainfoAsync(objUrl)\n      return metainfoAdaptorFactory(metainfo._data.definitions)\n    }\n\n    if (def.m_def === SectionMDef) {\n      if (obj.m_def) {\n        // Override the def given by the schema with the potentially more specific\n        // def given by the data\n        const ref = obj.m_def_id ? `${obj.m_def}@${obj.m_def_id}` : obj.m_def\n        const newDefUrl = resolveNomadUrl(ref, objUrl)\n        def = await this.dataStore.getMetainfoDefAsync(newDefUrl)\n      }\n      const isInEln = this.isInEln || isEditable(def)\n      return new SectionAdaptor(objUrl, obj, def, property, isInEln)\n    }\n\n    if (def.m_def === QuantityMDef) {\n      if (def.type.type_kind === 'reference') {\n        // Should only happen if the reference encountered has not been resolved, which can\n        // happen if the reference is invalid or if it is of a type which we have no handler for.\n        return new UnresolvedReferenceAdaptor(objUrl, obj, def)\n      }\n\n      return new QuantityAdaptor(objUrl, obj, def)\n    }\n\n    if (def.m_def === AttributeMDef) {\n      return new AttributeAdaptor(objUrl, obj, def)\n    }\n\n    throw new Error('not implemented')\n  }\n\n  async itemAdaptor(key) {\n    if (key === '_metainfo') {\n      return metainfoAdaptorFactory(this.def)\n    }\n\n    if (key === '_subsectionmetainfo') {\n      return metainfoAdaptorFactory(this.property)\n    }\n\n    if (key.startsWith('_external_ref')) {\n      const ref = this.external_refs[key]\n      if (!ref) return null\n\n      const refUrl = createEntryUrl(apiBase, ref.upload_id, ref.entry_id)\n      const {archive} = await this.dataStore.getEntryAsync(apiBase, ref.entry_id, false, '*')\n      const metainfo = await this.dataStore.getMetainfoAsync(systemMetainfoUrl)\n      const rootSectionDef = metainfo.getEntryArchiveDefinition()\n      return this.adaptorFactory(refUrl, archive, rootSectionDef)\n    }\n\n    throw new Error('Unknown item key')\n  }\n}\n\nclass SectionAdaptor extends ArchiveAdaptor {\n  async itemAdaptor(key) {\n    let [name, index] = key.split(':')\n    let urlSuffix = index ? `${name}/${index}` : name\n    const property = this.def._properties[name] || (name === 'm_attributes' && this.def.attributes.find(attr => attr.name === index))\n    let value = this.obj[name] === undefined || this.obj[name] === null ? property?.default : this.obj[name]\n    const text_index = index\n    index = parseInt(index)\n    index = isNaN(index) ? text_index : index\n    if (index < 0) index = index + value.length\n    if (property.m_def === QuantityMDef && quantityUsesFullStorage(property)) {\n      value = value[index]\n    }\n    if (!property) {\n      return super.itemAdaptor(key)\n    } else if (property.m_def === SubSectionMDef) {\n      let subSectionAdaptor\n      let subSectionIndex = -1\n      if (property.repeats) {\n        subSectionIndex = index || 0\n        subSectionAdaptor = await this.adaptorFactory(\n          appendDataUrl(this.parsedObjUrl, `${name}/${subSectionIndex}`), value[subSectionIndex], property)\n      } else {\n        subSectionAdaptor = await this.adaptorFactory(\n          appendDataUrl(this.parsedObjUrl, name), value, property)\n      }\n      subSectionAdaptor.parentRelation = {\n        parent: this.obj,\n        subSectionDef: property,\n        subSectionIndex: subSectionIndex\n      }\n      return subSectionAdaptor\n    } else if (property.m_def === QuantityMDef) {\n      // References: sections and quantities\n      if (isReference(property)) {\n        let reference = null\n        if (property.shape.length === 0) {\n          reference = value\n          urlSuffix = name\n        } else if (property.shape.length === 1) {\n          const indexStr = key.split(':')[1]\n          const index = parseInt(indexStr)\n          reference = value[index]\n          urlSuffix = `${name}/${index}`\n        }\n        if (!reference) {\n          return this.adaptorFactory(\n            appendDataUrl(this.parsedObjUrl, urlSuffix), value, property)\n        }\n        try {\n          const resolvedUrl = resolveNomadUrl(reference, this.parsedObjUrl)\n          if (resolvedUrl.type === refType.archive) {\n            const {archive} = await this.dataStore.getEntryAsync(resolvedUrl.deploymentUrl, resolvedUrl.entryId, false, '*')\n            const resolvedObj = resolveInternalRef('/' + (resolvedUrl.path || ''), archive)\n            let resolvedDef\n            if (resolvedObj.m_def) {\n              // the custom definition is present anyway\n              resolvedDef = property.type._referencedDefinition\n            } else {\n              const metainfo = await this.dataStore.getMetainfoAsync(systemMetainfoUrl)\n              try {\n                resolvedDef = metainfo.getEntryArchiveDefinition()\n                for (const item of resolvedUrl.path.split('/')) {\n                  if (item.match(/^-?\\d+$/) || item === '') continue\n                  resolvedDef = resolvedDef._properties[item]\n                  if (resolvedDef.sub_section) resolvedDef = resolvedDef.sub_section\n                }\n              } catch {\n                resolvedDef = property.type._referencedDefinition\n              }\n            }\n            return this.adaptorFactory(resolvedUrl, resolvedObj, resolvedDef)\n          }\n          throw new Error('Unhandled reference type')\n        } catch (error) {\n          // some sections cannot be resolved, because they are not part of the archive\n          // user_id->user is one example\n          return this.adaptorFactory(\n            appendDataUrl(this.parsedObjUrl, urlSuffix), reference, property)\n        }\n      }\n      // Regular quantities\n      if (property.m_annotations?.browser) {\n        if (property.m_annotations.browser[0].adaptor === 'RawFileAdaptor') {\n          const deploymentUrl = this.parsedObjUrl.deploymentUrl\n          const uploadId = this.parsedObjUrl.uploadId\n          const path = this.obj[property.name]\n          const uploadUrl = createUploadUrl(deploymentUrl, uploadId, path, index)\n          return new RawFileAdaptor(uploadUrl, null, false)\n        }\n      }\n      return this.adaptorFactory(appendDataUrl(this.parsedObjUrl, urlSuffix), value, property)\n    } else if (property.m_def === AttributeMDef) {\n      return this.adaptorFactory(\n        appendDataUrl(this.parsedObjUrl, `m_attributes/${index}`),\n        this.obj?.m_attributes[index],\n        property)\n    } else {\n      throw new Error('Unknown metainfo meta definition')\n    }\n  }\n\n  render() {\n    return <Section\n      section={this.obj}\n      def={this.def}\n      property={this.property}\n      parentRelation={this.parentRelation}\n      sectionIsInEln={this.isInEln}\n      sectionIsEditable={this.entryIsEditable && this.isInEln}\n    />\n  }\n}\n\nclass UnresolvedReferenceAdaptor extends ArchiveAdaptor {\n  render() {\n    return <UnresolvedReference value={this.obj} def={this.def}/>\n  }\n}\n\nclass QuantityAdaptor extends ArchiveAdaptor {\n  async itemAdaptor(key) {\n    const attribute = this.def?.attributes?.find(attr => attr.name === key)\n    if (attribute) {\n      const value = this.obj?.m_attributes?.[key]\n      return await this.adaptorFactory(\n        appendDataUrl(this.parsedObjUrl, `m_attributes/${key}`),\n        value,\n        attribute)\n    }\n\n    return super.itemAdaptor(key)\n  }\n\n  render() {\n    if (quantityUsesFullStorage(this.def)) {\n      return <FullStorageQuantity value={this.obj} def={this.def}/>\n    } else {\n      return <Quantity value={this.obj} def={this.def}/>\n    }\n  }\n}\n\nclass AttributeAdaptor extends ArchiveAdaptor {\n  render() {\n    return <Attribute value={this.obj} def={this.def}/>\n  }\n}\n\nconst convertComplexArray = (real, imag) => {\n  return Array.isArray(real)\n    ? real.map((r, i) => convertComplexArray(r, imag[i]))\n    : format(complex(real, imag), {notation: 'auto', precision: 4, lowerExp: -999, upperExp: 999})\n}\n\nexport function QuantityItemPreview({value, def}) {\n  const displayUnit = useDisplayUnit(def)\n\n  if (isReference(def)) {\n    return <Box component=\"span\" fontStyle=\"italic\">\n      <Typography component=\"span\">reference ...</Typography>\n    </Box>\n  }\n  if (def.m_annotations?.browser?.[0]?.render_value === 'HtmlValue' || def.m_annotations?.eln?.[0]?.component === 'RichTextEditQuantity') {\n    return <Box component=\"span\" whiteSpace=\"nowrap\" fontStyle=\"italic\">\n      <Typography component=\"span\">rich text</Typography>\n    </Box>\n  }\n  if (def.type.type_data === 'nomad.metainfo.metainfo._JSON' || def.type.type_data === 'nomad.metainfo.data_type.JSON') {\n    return <Box component=\"span\" whiteSpace=\"nowrap\" fontStyle=\"italic\">\n      <Typography component=\"span\">JSON data</Typography>\n    </Box>\n  }\n  if (def.type.type_data === 'nomad.datamodel.hdf5.HDF5Dataset' || def.type.type_data === 'nomad.datamodel.hdf5.HDF5Reference') {\n    return <Box component=\"span\" fontStyle=\"italic\">\n      <Typography component=\"span\">HDF5 array</Typography>\n    </Box>\n  }\n  if (def.shape.length > 0) {\n    const dimensions = []\n    let typeLabel = 'unknown'\n    try {\n      let current = value.re || value.im || value\n      for (let i = 0; i < def.shape.length; i++) {\n        dimensions.push(current.length)\n        current = current[0]\n      }\n      if (def.type.type_kind === 'python') {\n        typeLabel = 'list'\n      } else if (typeof value === 'string') {\n        typeLabel = 'HDF5 array'\n        dimensions.length = 0\n      } else {\n        if (dimensions.length === 1) {\n          typeLabel = 'vector'\n        } else if (dimensions.length === 2) {\n          typeLabel = 'matrix'\n        } else {\n          typeLabel = 'tensor'\n        }\n      }\n    } catch (e) {\n      console.error('Quantity shape did not fit quantity value.', e)\n    }\n    return <Box component=\"span\" whiteSpace=\"nowrap\" fontStyle=\"italic\">\n      <Typography component=\"span\">\n        {dimensions.map((dimension, index) => (\n          <span key={index}>\n            {index > 0 && <span>&nbsp;&times;&nbsp;</span>}{String(dimension)}\n          </span>\n        ))}&nbsp;{typeLabel}\n      </Typography>\n    </Box>\n  } else {\n    let finalValue\n    if (def.type.type_data === 'nomad.metainfo.metainfo._Datetime' || def.type.type_data === 'nomad.metainfo.data_type.Datetime') {\n      finalValue = formatTimestamp(value)\n    } else if (def.type.type_data.startsWith?.('complex')) {\n      finalValue = convertComplexArray(value.re, value.im)\n    } else {\n      finalValue = value\n    }\n\n    if (displayUnit) {\n      finalValue = new Q(finalValue, def.unit).to(displayUnit).value()\n    }\n    return <Box component=\"span\" whiteSpace=\"nowarp\">\n      <Number component=\"span\" variant=\"body1\" value={finalValue} exp={8}/>\n      {displayUnit && <Typography component=\"span\">&nbsp;{displayUnit.label()}</Typography>}\n    </Box>\n  }\n}\n\nQuantityItemPreview.propTypes = ({\n  value: PropTypes.any,\n  def: PropTypes.object.isRequired\n})\n\nexport const QuantityValue = React.memo(function QuantityValue({value, def}) {\n  const {uploadId} = useEntryStore() || {}\n  const displayUnit = useDisplayUnit(def)\n\n  const getRenderValue = useCallback(value => {\n    let finalValue\n    if (def.type.type_data === 'nomad.metainfo.metainfo._Datetime' || def.type.type_data === 'nomad.metainfo.data_type.Datetime') {\n      finalValue = formatTimestamp(value)\n    } else if (def.type.type_data.startsWith?.('complex')) {\n      finalValue = convertComplexArray(value.re, value.im)\n    } else {\n      finalValue = value\n    }\n    let finalUnit\n    if (def.unit && typeof finalValue !== 'string') {\n      const systemUnitQ = new Q(finalValue, def.unit).to(displayUnit)\n      finalValue = systemUnitQ.value()\n      finalUnit = systemUnitQ.label()\n    }\n    return [finalValue, finalUnit]\n  }, [def, displayUnit])\n\n  const isMathValue = (def.type.type_kind === 'numpy' || def.type.type_kind === 'python') && typeof value !== 'string'\n  if (isMathValue) {\n    const [finalValue, finalUnit] = getRenderValue(value)\n    if (def.shape.length > 0) {\n      return <Box textAlign=\"center\">\n        <Matrix\n          values={finalValue}\n          shape={def.shape}\n          invert={def.shape.length === 1}\n          type={def.type.type_data}\n          key={`matrix:${def.name}`}\n        />\n        <Typography noWrap variant=\"caption\">\n          ({def.shape.map((dimension, index) => <span key={index}>\n            {index > 0 && <span>&nbsp;&times;&nbsp;</span>}{String(dimension)}\n          </span>)})\n        </Typography>\n        {finalUnit && <Typography noWrap>{finalUnit}</Typography>}\n      </Box>\n    } else {\n      return <Number value={finalValue} exp={16} variant=\"body1\" unit={finalUnit}/>\n    }\n  } else if (def.m_annotations?.browser?.[0]?.render_value === 'HtmlValue' || def.m_annotations?.eln?.[0]?.component === 'RichTextEditQuantity') {\n    const html = DOMPurify.sanitize(value)\n    return <div dangerouslySetInnerHTML={{__html: html}}/>\n  } else if (def.type?.type_data === 'nomad.metainfo.metainfo._JSON' || def.type?.type_data === 'nomad.metainfo.data_type.JSON') {\n    return <ReactJson\n      name=\"value\"\n      src={value}\n      enableClipboard={false}\n      collapsed={2}\n      displayObjectSize={false}\n    />\n  } else {\n    if (def.type.type_data.startsWith?.('complex')) {\n      value = convertComplexArray(value.re, value.im)\n\n      return Array.isArray(value)\n        ? <ul style={{margin: 0}}>\n          {value.map((value, index) => <li key={index}><Typography>{value}</Typography></li>)}\n        </ul>\n        : <Typography>{value}</Typography>\n    } else if (Array.isArray(value)) {\n      return <ul style={{margin: 0}}>\n        {value.map((value, index) => {\n          const [finalValue] = getRenderValue(value)\n          return <li key={index}>\n            <Typography>{typeof finalValue === 'object' ? JSON.stringify(finalValue) : finalValue?.toString()}</Typography>\n          </li>\n        })}\n      </ul>\n    } else if (def.type?.type_data === 'nomad.datamodel.hdf5.HDF5Dataset' || def.type?.type_data === 'nomad.datamodel.hdf5.HDF5Reference') {\n      const h5Path = value.match(/(?:\\/uploads\\/(?<uploadId>.+?)\\/(?<source>.+?)\\/)*(?<filename>.+?)#(?<path>.+)/)\n      const h5UploadId = h5Path.groups.uploadId || uploadId\n      const h5Source = h5Path.groups.source || (h5Path.groups.filename.endsWith('.h5') ? 'raw' : 'archive')\n      return <Compartment title='hdf5'>\n        <H5Web upload_id={h5UploadId} filename={h5Path.groups.filename} initialPath={h5Path.groups.path} source={h5Source} sidebarOpen={false}></H5Web>\n      </Compartment>\n    } else if (def?.type?.type_kind === 'custom' && def?.type?.type_data === 'nomad.datamodel.data.Query') {\n      return <Query value={value} def={def}/>\n    } else {\n      const [finalValue] = getRenderValue(value)\n      return <Typography>{typeof finalValue === 'object' ? JSON.stringify(finalValue) : finalValue?.toString()}</Typography>\n    }\n  }\n})\nQuantityValue.propTypes = ({\n  value: PropTypes.any,\n  def: PropTypes.object.isRequired,\n  unit: PropTypes.string\n})\n\nconst InheritingSections = React.memo(function InheritingSections({def, section, lane}) {\n  const dataStore = useDataStore()\n  const browser = useContext(browserContext)\n  const originalInheritingSectionsRef = useRef([def, ...dataStore.getAllInheritingSections(def)])\n\n  const currentInheritingSections = useMemo(() => {\n    return [def, ...dataStore.getAllInheritingSections(def)]\n  }, [dataStore, def])\n\n  const getSelectionValue = useCallback((def) => {\n    return getUrlFromDefinition(def, {deploymentUrl: apiBase}, true)\n  }, [])\n\n  const validSections = useMemo(() => {\n    if (Object.keys(section).filter(key => key !== 'm_def').length === 0) {\n      return originalInheritingSectionsRef.current\n    } else {\n      return currentInheritingSections\n    }\n  }, [originalInheritingSectionsRef, currentInheritingSections, section])\n\n  const showSelection = useMemo(() => {\n    return validSections.length > 1\n  }, [validSections])\n\n  const handleInheritingSectionsChange = useCallback((e) => {\n    if (Object.keys(section).filter(key => key !== 'm_def').length !== 0) {\n      if (!currentInheritingSections.includes(e.target.value)) {\n        // TODO show alert dialog\n        return\n      }\n    }\n    section.m_def = e.target.value\n    browser.invalidateLanesFromIndex(lane.index)\n  }, [section, browser, lane, currentInheritingSections])\n\n  if (!showSelection) {\n    return null\n  }\n\n  return (\n    <Box sx={{minWidth: 120}}>\n      <FormControl fullWidth>\n        <FormHelperText>Multiple specific sections are available</FormHelperText>\n        <TextField\n          value={getSelectionValue(def)}\n          variant=\"filled\"\n          label=\"Select a section\"\n          data-testid={`inheriting:${def.name}`}\n          onChange={handleInheritingSectionsChange}\n          size=\"small\"\n          select\n        >\n          {validSections.map((inheritingSection, i) => {\n            const sectionValue = getSelectionValue(inheritingSection)\n            return (\n              <MenuItem key={i} value={sectionValue}>\n                {inheritingSection.name}\n              </MenuItem>\n            )\n          })}\n        </TextField>\n      </FormControl>\n    </Box>\n  )\n})\nInheritingSections.propTypes = ({\n  section: PropTypes.object.isRequired,\n  def: PropTypes.object.isRequired,\n  lane: PropTypes.object\n})\n\nexport function getAllVisibleProperties(sectionDef) {\n  const properties = sectionDef?.m_annotations?.eln?.[0]?.properties\n  const hide = sectionDef?.m_annotations?.eln?.[0]?.hide || []\n  const allProperties = sectionDef._allProperties?.map(property => property.name)\n  const visible = getOptions(properties?.visible, allProperties)\n  const editable = getOptions(properties?.editable, allProperties)\n  let filteredProperties = sectionDef._allProperties\n  filteredProperties = filteredProperties.filter(property => visible.includes(property.name))\n  filteredProperties = filteredProperties.filter(property => !hide.includes(property.name))\n  const order = properties?.order || []\n  const visibleProperties = filteredProperties.map(property => ({...property, _isEditable: editable.includes(property.name)}))\n  const reversedOrder = [...order].reverse()\n  visibleProperties.sort((a, b) => reversedOrder.indexOf(b.name) - reversedOrder.indexOf(a.name) || a.m_parent_index - b.m_parent_index)\n  const quantities = visibleProperties.filter(property => property.m_parent_sub_section === \"quantities\")\n  const sub_sections = visibleProperties.filter(property => property.m_parent_sub_section === \"sub_sections\")\n  return [...quantities, ...sub_sections]\n}\n\nexport function Section({section, def, property, parentRelation, sectionIsEditable, sectionIsInEln}) {\n  const {handleArchiveChanged, uploadId, entryId} = useEntryStore() || {}\n  const config = useRecoilValue(configState)\n  const [showJson, setShowJson] = useState(false)\n  const lane = useContext(laneContext)\n  const history = useHistory()\n\n  const isEditable = useMemo(() => {\n    let editableExcluded = false\n    let parent = def?._parent\n    let name = def?.name\n    while (!editableExcluded && parent) {\n      const properties = parent.m_annotations?.eln?.[0]?.properties\n      if (properties && parent._allProperties) {\n        const allProperties = parent._allProperties.map(property => property.name)\n        const editable = getOptions(properties?.editable, allProperties)\n        const excluded = allProperties.filter(propertyName => !editable.includes(propertyName))\n        editableExcluded = excluded.some(item => item.toLowerCase() === name.toLowerCase())\n      }\n      name = parent.name\n      parent = parent._parent\n    }\n    return sectionIsEditable && !editableExcluded\n  }, [def, sectionIsEditable])\n\n  const navEntryId = useMemo(() => {\n    return lane?.adaptor?.parsedObjUrl?.entryId\n  }, [lane])\n\n  const actions = useMemo(() => {\n    const navButton = navEntryId && (\n      <Grid item>\n        <EntryButton entryId={navEntryId} component={IconButton} size=\"small\">\n          <NavigateIcon/>\n        </EntryButton>\n      </Grid>\n    )\n\n    const jsonButton = !isEditable ? (\n      <Grid item>\n        <SourceJsonDialogButton\n          buttonProps={{size: 'small'}}\n          tooltip={`Show section data as JSON`}\n          title={`Underlying section data as JSON`}\n          data={section}\n          maxWidth=\"sm\"\n          fullWidth={true}\n        />\n      </Grid>\n    ) : (\n      <Grid item>\n        <IconButton onClick={() => setShowJson(value => !value)} size=\"small\">\n          <CodeIcon/>\n        </IconButton>\n      </Grid>\n    )\n\n    const handleDelete = () => {\n      removeSubSection(\n        parentRelation.parent,\n        parentRelation.subSectionDef,\n        parentRelation.subSectionIndex)\n      handleArchiveChanged()\n      history.push(lane.prev.path)\n    }\n\n    const deleteButton = isEditable && (\n      <Grid item>\n        <IconButton onClick={handleDelete} size=\"small\">\n          <DeleteIcon/>\n        </IconButton>\n      </Grid>\n    )\n\n    return <Grid container justifyContent=\"space-between\" wrap=\"nowrap\" spacing={1}>\n      {navButton}{jsonButton}{deleteButton}\n    </Grid>\n  }, [navEntryId, setShowJson, isEditable, parentRelation, lane, history, handleArchiveChanged, section])\n\n  const renderQuantityItem = useCallback((key, quantityName, quantityDef, value, disabled) => {\n    const itemKey = quantityName ? `${key}:${quantityName}` : key\n    const isDefault = value !== undefined && value !== null && (section[key] === undefined || section[key] === null)\n    const label = getDisplayLabel(quantityDef, true, config?.showMeta)\n    return (\n      <Box key={itemKey} data-testid={\"visible-quantity\"}>\n        <Item itemKey={itemKey} disabled={disabled}>\n          <Box component=\"span\" whiteSpace=\"nowrap\" style={{maxWidth: 100, overflow: 'ellipses'}}>\n            <Typography component=\"span\">\n              <Box fontWeight=\"bold\" component=\"span\">\n                {quantityName || label}\n              </Box>\n            </Typography>{!disabled &&\n            <span>&nbsp;=&nbsp;\n              <QuantityItemPreview\n                value={value}\n                def={quantityDef}\n              />\n            </span>\n          }\n          </Box>\n          {isDefault && <ItemChip label=\"default value\"/>}\n        </Item>\n      </Box>\n    )\n  }, [config?.showMeta, section])\n\n  const renderQuantity = useCallback(quantityDef => {\n    const key = quantityDef.name\n    const value = section[key] === undefined || section[key] === null ? quantityDef.default : section[key]\n    const disabled = value === undefined\n    if (!disabled && quantityDef.type.type_kind === 'reference' && quantityDef.shape.length === 1) {\n      return <ReferenceValuesList key={key} quantityDef={quantityDef}/>\n    }\n    if (quantityUsesFullStorage(quantityDef)) {\n      const storage = section[quantityDef.name] || {}\n      return <React.Fragment key={key}>\n        {Object.keys(storage).map(quantityName =>\n          renderQuantityItem(key, quantityName, quantityDef, storage[quantityName]?.m_value, disabled)\n        )}\n      </React.Fragment>\n    } else {\n      return renderQuantityItem(key, null, quantityDef, value, disabled)\n    }\n  }, [section, renderQuantityItem])\n\n  const allVisibleProperties = useMemo(() => getAllVisibleProperties(def), [def])\n\n  if (!section) {\n    console.error('section is not available')\n    return null\n  }\n\n  const filter = config.showCodeSpecific ? def => !def.virtual : def => !def.virtual && !def.name.startsWith('x_')\n  let sub_sections = allVisibleProperties.filter(prop => prop.m_def === SubSectionMDef)\n  if (def.name === 'EntryArchive') {\n    // put the most abstract data (last added data) first, e.g. results, metadata, workflow, run\n    sub_sections = [...def.sub_sections]\n    sub_sections.reverse()\n  }\n  const quantities = allVisibleProperties.filter(prop => prop.m_def === QuantityMDef)\n\n  const subSectionsToRender = sub_sections\n    .filter(subSectionDef => section[subSectionDef.name] || config.showAllDefined || isEditable)\n    .filter(filter)\n  const subSectionCompartment = (\n    <Compartment title=\"sub sections\">\n      {subSectionsToRender\n        .map(subSectionDef => {\n          return <SubSection\n            key={subSectionDef.name}\n            subSectionDef={subSectionDef}\n            section={section}\n            editable={isEditable}\n          />\n        })\n      }\n    </Compartment>\n  )\n\n  let contents\n  if (isEditable) {\n    contents = <React.Fragment>\n      {quantities.length > 0 && (\n        <Compartment title=\"quantities\">\n          <SectionEditor sectionDef={def} section={section} showJson={showJson}/>\n          <Box marginTop={2}>\n            {quantities\n              .filter(filter)\n              .filter(quantityDef => !quantityDef.m_annotations?.eln?.[0]?.component)\n              .map(renderQuantity)\n            }\n          </Box>\n        </Compartment>\n      )}\n      {subSectionCompartment}\n      {(def.m_annotations?.plot || def._allBaseSections.map(section => section.name).includes('PlotSection')) && <SectionPlots sectionDef={def} section={section} uploadId={uploadId} entryId={entryId}/>}\n    </React.Fragment>\n  } else {\n    const attributes = section?.m_attributes || {}\n    contents = <React.Fragment>\n      <Compartment title=\"quantities\">\n        {quantities\n          .filter(quantityDef => section[quantityDef.name] !== undefined || config.showAllDefined || sectionIsInEln)\n          .filter(filter)\n          .map(renderQuantity)\n        }\n      </Compartment>\n      {subSectionCompartment}\n      {Object.keys(attributes).length > 0 && <Compartment title=\"attributes\">\n        {Object.keys(attributes).map(key => (\n          <Item key={key} itemKey={`m_attributes:${key}`}>{key}</Item>\n        ))}\n      </Compartment>}\n      {(def.m_annotations?.plot || def._allBaseSections.map(section => section.name).includes('PlotSection')) && <SectionPlots sectionDef={def} section={section} uploadId={uploadId} entryId={entryId}/>}\n    </React.Fragment>\n  }\n  const eln = def?.m_annotations?.eln\n  const laneWidth = (eln && eln.length > 0 ? eln[0].lane_width : undefined)\n  const otherProps = (laneWidth ? {minWidth: laneWidth, maxWidth: laneWidth} : undefined)\n  return (\n    <Content {...otherProps}>\n      {isEditable && sectionIsInEln && (\n        <InheritingSections def={def} section={section} lane={lane}/>\n      )}\n      <ArchiveTitle def={def} property={property} data={section} kindLabel=\"section\" actions={actions}/>\n      <Overview section={section} def={def}/>\n      {contents}\n      <ExternalReferences/>\n    </Content>\n  )\n}\n\nSection.propTypes = ({\n  section: PropTypes.object.isRequired,\n  def: PropTypes.object.isRequired,\n  property: PropTypes.object,\n  parentRelation: PropTypes.object,\n  sectionIsEditable: PropTypes.bool,\n  sectionIsInEln: PropTypes.bool\n})\n\nexport function getItemLabelKey(sectionDef) {\n  let itemLabelKey = sectionDef.more?.label_quantity\n  if (!itemLabelKey) {\n    itemLabelKey = ['name', 'type', 'id'].find(key => (\n      sectionDef._properties[key] && sectionDef._properties[key].m_def === QuantityMDef\n    ))\n  }\n  return itemLabelKey\n}\n\nfunction SubSection({subSectionDef, section, editable}) {\n  const {handleArchiveChanged} = useEntryStore() || {}\n  const lane = useLane()\n  const history = useHistory()\n  const [open, setOpen] = useState(false)\n  const config = useRecoilValue(configState)\n\n  const {itemKey, label, getItemLabel} = useMemo(() => {\n    const sectionDef = subSectionDef.sub_section\n    let itemLabelKey = getItemLabelKey(sectionDef)\n    let labelQuantity = itemLabelKey && sectionDef._properties[itemLabelKey]\n    if (labelQuantity && quantityUsesFullStorage(labelQuantity)) {\n      // We do not yet support label quantities that use full storage\n      labelQuantity = undefined\n      itemLabelKey = undefined\n    }\n    const getItemLabel = item => {\n      if (labelQuantity) {\n        const value = item[itemLabelKey]\n        if (value) {\n          return <QuantityValue value={item[itemLabelKey]} def={labelQuantity}/>\n        }\n      } else if (itemLabelKey) {\n        return item[itemLabelKey]\n      }\n      return null\n    }\n    return {\n      itemKey: subSectionDef.name,\n      label: getDisplayLabel(subSectionDef, true, config?.showMeta),\n      getItemLabel: getItemLabel\n    }\n  }, [subSectionDef, config?.showMeta])\n\n  const handleAdd = useCallback(() => {\n    let subSectionKey = subSectionDef.name\n    if (subSectionDef.repeats) {\n      let values = section[subSectionDef.name]\n      if (!values) {\n        values = []\n        section[subSectionDef.name] = values\n      }\n      values.push({})\n      if (values.length > 1) {\n        subSectionKey += `:${values.length - 1}`\n      }\n      setOpen(true)\n    } else {\n      section[subSectionDef.name] = {}\n    }\n    handleArchiveChanged()\n    history.push(`${lane.path}/${subSectionKey}`)\n  }, [subSectionDef, section, lane, history, handleArchiveChanged])\n\n  const values = section[subSectionDef.name] || []\n  const showList = subSectionDef.repeats && values.length > 1\n  const actions = editable && (subSectionDef.repeats || !section[subSectionDef.name]) && (\n    <Box marginRight={!showList && section[subSectionDef.name] ? -1 : 2}>\n      <IconButton data-testid={`subsection:${subSectionDef.name}`} onClick={handleAdd} size=\"small\">\n        <AddIcon style={{fontSize: 20}}/>\n      </IconButton>\n    </Box>\n  )\n\n  const handleClick = useCallback(() => {\n    setOpen(open => !open)\n  }, [])\n\n  if (showList) {\n    return <PropertyValuesList\n      itemKey={itemKey}\n      label={label || 'list'}\n      actions={actions}\n      values={values.map(getItemLabel)}\n      open={open}\n      onClick={handleClick}\n    />\n  } else {\n    return (\n      <Box data-testid={'subsection'}>\n        <Item\n          itemKey={subSectionDef.repeats ? `${subSectionDef.name}/0` : subSectionDef.name}\n          disabled={!section[subSectionDef.name]} actions={actions}\n        >\n          <Typography component=\"span\">\n            <Box fontWeight=\"bold\" component=\"span\">\n              {label}\n            </Box>\n          </Typography>\n        </Item>\n      </Box>\n    )\n  }\n}\n\nSubSection.propTypes = ({\n  subSectionDef: PropTypes.object.isRequired,\n  section: PropTypes.object.isRequired,\n  editable: PropTypes.bool\n})\n\nfunction ReferenceValuesList({quantityDef}) {\n  const lane = useContext(laneContext)\n  const values = useMemo(() => lane.adaptor.obj[quantityDef.name].map(() => null), [lane.adaptor.obj, quantityDef.name])\n  const [open, setOpen] = useState(false)\n  const config = useRecoilValue(configState)\n  const label = getDisplayLabel(quantityDef, true, config?.showMeta)\n\n  const handleClick = useCallback(() => {\n    setOpen(open => !open)\n  }, [])\n\n  return <PropertyValuesList\n    itemKey={quantityDef.name}\n    values={values}\n    label={label}\n    open={open}\n    onClick={handleClick}\n  />\n}\n\nReferenceValuesList.propTypes = ({\n  quantityDef: PropTypes.object.isRequired\n})\n\nconst usePropertyValuesListStyles = makeStyles(theme => ({\n  root: {\n    margin: `0 -${theme.spacing(1)}px`,\n    padding: `0 ${theme.spacing(1)}px`,\n    width: '100%',\n    display: 'flex',\n    flexDirection: 'row',\n    wrap: 'nowrap',\n    alignItems: 'center'\n  },\n  title: {\n    flexGrow: 1,\n    color: theme.palette.text.primary,\n    textDecoration: 'none',\n    margin: `0 -${theme.spacing(1)}px`,\n    whiteSpace: 'nowrap',\n    display: 'flex',\n    fontWeight: 'bold'\n  },\n  selected: {\n    backgroundColor: theme.palette.primary.main,\n    color: theme.palette.primary.contrastText,\n    whiteSpace: 'nowrap'\n  },\n  unSelected: {\n    '&:hover': {\n      backgroundColor: grey[300]\n    }\n  },\n  actions: {}\n}))\n\n/**\n * Displays a list of values that can be collapsed. Long lists are paginated in\n * order to prevent issues with rendering.\n */\nexport function PropertyValuesList(props) {\n  const {label, itemKey, values, ...otherProps} = props\n  return <FoldableList\n    label={label || itemKey || 'list'}\n    {...otherProps}\n  >\n    {values.map((value, index) => {\n      return <Item key={index} itemKey={`${itemKey}/${index}`} length={values.length}>\n        <Box display=\"grid\" flexDirection=\"row\" flexGrow={1}>\n          <Box component=\"span\" marginLeft={2}>\n            {value && typeof value === 'object'\n              ? value // item should be a react component\n              : <Typography component=\"span\">{value || index}</Typography>\n            }\n          </Box>\n        </Box>\n      </Item>\n    })}\n  </FoldableList>\n}\n\nPropertyValuesList.propTypes = ({\n  itemKey: PropTypes.string.isRequired,\n  label: PropTypes.string,\n  values: PropTypes.arrayOf(PropTypes.object).isRequired,\n  actions: PropTypes.node,\n  /**\n   * Initial number of items to be shown from top of the list.\n   */\n  nTop: PropTypes.number,\n  /**\n   * Initial number of items to be shown from bottom of the list.\n   */\n  nBottom: PropTypes.number,\n  /**\n   * Initial number of items to be added or removed by show more and show less buttons.\n   */\n  pageSize: PropTypes.number,\n  /**\n   * To control the collapse state from outside the component.\n   */\n  open: PropTypes.bool,\n  /**\n   * An event firing when the item is clicked.\n   */\n  onClick: PropTypes.func,\n  /**\n   * To customize the label style in different places.\n   */\n  className: PropTypes.object,\n  /**\n   * Get item as children.\n   */\n  children: PropTypes.node\n})\n\nPropertyValuesList.defaultProps = ({\n  nTop: 50,\n  nBottom: 5,\n  pageSize: 25\n})\n\n/**\n * Displays a list of values that can be collapsed. Long lists are paginated in\n * order to prevent issues with rendering.\n */\nexport function FoldableList({label, children, actions, nTop, nBottom, pageSize, open, onClick, className}) {\n  const classes = {...usePropertyValuesListStyles(), ...className}\n  const [nShownTop, setNShownTop] = useState(0)\n  const [nShownBottom, setNShownBottom] = useState(0)\n  const lane = useContext(laneContext)\n  const selected = lane?.next?.key\n  const showSelected = !open && (selected === label || selected?.startsWith(label + ':'))\n\n  const topStart = 0\n  const topEnd = Math.min(children.length, nTop + nShownTop)\n  const bottomStart = Math.max(topEnd, children.length - nBottom - nShownBottom)\n  const bottomEnd = children.length\n\n  return <React.Fragment>\n    <div className={classNames(\n      classes.root, showSelected ? classes.selected : classes.unSelected)}\n    >\n      <Typography onClick={onClick} className={classes.title}>\n        {open ? <ArrowDownIcon/> : <ArrowRightIcon/>}\n        <span role=\"item-list\">{label}</span>\n      </Typography>\n      {actions && <div className={classes.actions}>\n        {actions}\n      </div>}\n    </div>\n    {open &&\n      <div data-testid={`item-list:${label}`}>\n        {range(topStart, topEnd).map((index) => children[index])}\n        {topEnd < bottomStart && <Box marginLeft={0.8}>\n          {nTop > 0 && <Pagination\n            showMore\n            showLess={nShownTop > 0}\n            onMore={() => setNShownTop(x => Math.min(bottomStart, x + pageSize))}\n            onLess={() => setNShownTop(x => Math.max(0, x - pageSize))}\n            variant=\"down\"\n            data-testid=\"propertyvalueslist-pagination-down\"\n          />}\n          {nBottom > 0 && <Pagination\n            showMore\n            showLess={nShownBottom > 0}\n            onMore={() => setNShownBottom(x => Math.min(children.length - nShownTop - nBottom, x + pageSize))}\n            onLess={() => setNShownBottom(x => Math.max(0, x - pageSize))}\n            variant=\"up\"\n            data-testid=\"propertyvalueslist-pagination-up\"\n          />}\n        </Box>}\n        {range(bottomStart, bottomEnd).map((index) => children[index])}\n      </div>\n    }\n  </React.Fragment>\n}\n\nFoldableList.propTypes = ({\n  label: PropTypes.string.isRequired,\n  /**\n   * Get item as children.\n   */\n  children: PropTypes.arrayOf(PropTypes.node).isRequired,\n  actions: PropTypes.node,\n  /**\n   * Initial number of items to be shown from top of the list.\n   */\n  nTop: PropTypes.number,\n  /**\n   * Initial number of items to be shown from bottom of the list.\n   */\n  nBottom: PropTypes.number,\n  /**\n   * Initial number of items to be added or removed by show more and show less buttons.\n   */\n  pageSize: PropTypes.number,\n  /**\n   * To control the collapse state from outside the component.\n   */\n  open: PropTypes.bool,\n  /**\n   * An event firing when the item is clicked.\n   */\n  onClick: PropTypes.func,\n  /**\n   * To customize the label style in different places.\n   */\n  className: PropTypes.object\n})\n\nFoldableList.defaultProps = ({\n  nTop: 50,\n  nBottom: 5,\n  pageSize: 25\n})\n\nexport const SectionPlots = React.memo(function SectionPlots({section, sectionDef, uploadId, entryId}) {\n  let sortedFigures\n  const annotationPlot = sectionDef?.m_annotations?.plot && sectionDef.m_annotations?.plot\n  if (section?.figures) {\n    section?.figures.forEach((figure, index) => {\n      figure.pathIndex = index\n    })\n    const [indexedFigures, otherFigures] = section.figures && partition(section.figures, figure => figure?.index !== undefined)\n    sortedFigures = indexedFigures.sort((a, b) => a.index - b.index)\n    sortedFigures = [...sortedFigures, ...otherFigures]\n  }\n  const [selected, setSelected] = useState([0])\n\n  const plots = useMemo(() => {\n    const validPlots = []\n    let key = 0\n    sortedFigures?.forEach(plot => {\n      if (plot?.figure) {\n        plot.figure.data = (Array.isArray(plot?.figure?.data) ? [...plot?.figure?.data] : [{...plot?.figure?.data}])\n        validPlots.push({pathIndex: plot.pathIndex, plot: plot.figure, key: key, label: plot.label || plot?.layout?.title?.text || 'Untitled', type: 'PlotSection'})\n      }\n    })\n    const annotationPlots = annotationPlot\n      ? Array.isArray(annotationPlot) ? [...annotationPlot] : [{...annotationPlot}]\n      : undefined\n    annotationPlots?.forEach(plot => {\n      if (!('label' in plot)) {\n        const yAxis = plot.y || plot['y_axis'] || plot['yAxis']\n        const pathParts = Array.isArray(yAxis) ? ['unnamed'] : yAxis.split('/')\n        plot.label = pathParts[pathParts.length - 1]\n      }\n      validPlots.push({plot: plot, key: key, label: plot.label || 'Untitled', type: 'PlotAnnotation'})\n      key = key + 1\n    })\n    return validPlots\n  }, [annotationPlot, sortedFigures])\n\n  useEffect(() => {\n    setSelected([0])\n  }, [plots.length])\n\n  if (plots.length < 1 || selected.find(index => index >= plots.length)) {\n    return null\n  }\n\n  return <Compartment title=\"plot\">\n    <Box minWidth={500}>\n      {plots.length > 1 && <TextField\n        select variant=\"filled\" size=\"small\" fullWidth label={'Shown plots'} style={{marginBottom: 2}}\n        SelectProps={{\n          multiple: true,\n          value: selected,\n          onChange: event => setSelected(event.target.value),\n          renderValue: newSelected => newSelected.map(index => {\n            return titleCase(plots?.[index]?.label)\n          })?.join(', ')\n        }}\n      >\n        {plots.map((plot, index) => (\n          <MenuItem key={index} value={index}>\n            <Checkbox\n              checked={selected.findIndex(selectedIndex => selectedIndex === index) >= 0}\n            />\n            {titleCase(plots?.[index]?.label)}\n          </MenuItem>\n        ))}\n      </TextField>}\n      {selected.map(index => plots?.[index])\n        ?.map((plot) => {\n          return plot.type === 'PlotSection'\n            ? <PlotlyFigure\n              key={plot.key}\n              sectionDef={sectionDef}\n              section={section}\n              plot={plot.plot}\n              title={plot.label}\n              metaInfoLink={uploadId && entryId && `/user/uploads/upload/id/${uploadId}/entry/id/${entryId}/data/data/figures:${plot.pathIndex}/figure`}\n            />\n            : <XYPlot\n              key={plot.key}\n              sectionDef={sectionDef}\n              section={section}\n              plot={plot.plot}\n              title={plot.label}\n            />\n        })}\n    </Box>\n  </Compartment>\n})\nSectionPlots.propTypes = {\n  sectionDef: PropTypes.object.isRequired,\n  section: PropTypes.object,\n  uploadId: PropTypes.string,\n  entryId: PropTypes.string\n}\n\nfunction FullStorageQuantity({value, def}) {\n  const attributes = value.m_attributes || {}\n  return <Quantity value={value.m_value} def={def} unit={value.m_unit}>\n    {Object.keys(attributes).length > 0 && <Compartment title=\"attributes\">\n      {Object.keys(attributes).map(key => (\n        <Item key={key} itemKey={key}>{key}</Item>\n      ))}\n    </Compartment>}\n  </Quantity>\n}\n\nFullStorageQuantity.propTypes = ({\n  value: PropTypes.any,\n  def: PropTypes.object.isRequired\n})\n\nfunction Quantity({value, def, unit, children}) {\n  const {prev} = useLane()\n  return <Content>\n    <ArchiveTitle def={def} data={value} kindLabel=\"value\"/>\n    {def.m_annotations?.plot && (\n      <Compartment title=\"plot\">\n        <XYPlot\n          section={prev.adaptor.obj}\n          sectionDef={prev.adaptor.def}\n          plot={def.m_annotations?.plot[0]}\n          title={def.name}\n        />\n      </Compartment>\n    )}\n    <Compartment title=\"value\">\n      <QuantityValue\n        value={value}\n        def={def}\n        unit={unit}\n      />\n    </Compartment>\n    {children}\n    <ExternalReferences/>\n  </Content>\n}\n\nQuantity.propTypes = ({\n  value: PropTypes.any,\n  def: PropTypes.object.isRequired,\n  unit: PropTypes.string,\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ])\n})\n\nfunction Query({value, def}) {\n  return <Content>\n    <Compartment title=\"filters\">\n      <QuantityValue\n        value={value?.filters ? Object.entries(value.filters).map(([key, value]) => `${key}: ${value}`) : []}\n        def={def}\n      />\n    </Compartment>\n    {value?.data && <Compartment title=\"results\">\n      <QuantityValue\n        value={value?.data ? value.data.map(entry => entry.mainfile || entry.entry_id) : []}\n        def={def}\n      />\n    </Compartment>}\n    <Compartment title=\"query\">\n      <SourceApiCall body={value} response={value}/>\n    </Compartment>\n  </Content>\n}\n\nQuery.propTypes = ({\n  value: PropTypes.any,\n  def: PropTypes.object.isRequired\n})\n\nfunction Attribute({value, def}) {\n  return <Content>\n    <ArchiveTitle def={def} data={value} kindLabel=\"attribute\"/>\n    <Compartment title=\"value\">\n      <QuantityValue\n        value={value}\n        def={def}\n      />\n    </Compartment>\n    <Meta def={def}/>\n  </Content>\n}\n\nAttribute.propTypes = ({\n  value: PropTypes.any,\n  def: PropTypes.object.isRequired\n})\n\nfunction UnresolvedReference({value, def}) {\n  const refTypeName = def?.type?._referencedDefinition?.name\n  const refTypeQualifiedName = def?.type?._referencedDefinition?._qualifiedName\n  const isOk = ['nomad.metainfo.metainfo.User'].includes(refTypeQualifiedName) // expected to not be resolvable\n  return <Content>\n    <ArchiveTitle def={def} data={value} kindLabel=\"value\"/>\n    <Compartment title=\"reference\">\n      {!isOk && <Typography color=\"error\">Cannot resolve reference.</Typography>}\n      <Typography><b>Reference type:</b></Typography>\n      <Typography>{refTypeName || 'unknown'}</Typography>\n      <Typography><b>Reference value:</b></Typography>\n      <Typography>{value}</Typography>\n    </Compartment>\n    <Meta def={def}/>\n  </Content>\n}\n\nUnresolvedReference.propTypes = ({\n  value: PropTypes.any,\n  def: PropTypes.object.isRequired\n})\n\nconst useMetaStyles = makeStyles(theme => ({\n  description: {\n    marginTop: theme.spacing(1)\n  },\n  graph: {\n    marginTop: theme.spacing(3)\n  },\n  metainfo: {\n    marginBottom: theme.spacing(2)\n  },\n  metainfoItem: {\n    fontWeight: 'bold'\n  }\n}))\n\nexport function Meta({def}) {\n  const classes = useMetaStyles()\n  const config = useRecoilValue(configState)\n  if (!config.showMeta) {\n    return null\n  }\n  return <Compartment title=\"meta\" color=\"primary\">\n    <div className={classes.metainfo}>\n      <Item itemKey=\"_metainfo\">\n        <DefinitionLabel classes={{root: classes.metainfoItem}} def={def} isDefinition component=\"span\"/>\n      </Item>\n    </div>\n    <Markdown classes={{root: classes.description}}>{def.description}</Markdown>\n  </Compartment>\n}\n\nMeta.propTypes = ({\n  def: PropTypes.object\n})\n\nconst baseQuery = {\n  'exclude': [\n    'atoms',\n    'only_atoms',\n    'files',\n    'quantities',\n    'dft.quantities',\n    'optimade',\n    'dft.labels',\n    'dft.geometries'\n  ],\n  'required': {\n    'metadata': '*'\n  },\n  'owner': 'visible',\n  'pagination': {\n    'order_by': 'upload_create_time', 'order': 'desc', 'page_size': 20\n  }\n}\n\nfunction ExternalReferences() {\n  const lane = useLane()\n  const [searchResults, setSearchResults] = useState(null)\n\n  const {api} = useApi()\n  const {raiseError} = useErrors()\n\n  const source = lane.adaptor\n\n  const entryId = source.parsedObjUrl.entryId\n  const dataPath = source.parsedObjUrl.path || '/'\n\n  const performSearch = () => {\n    if (searchResults) return\n    const referencing_query = Object.assign({}, baseQuery, {\n      'query': {\n        'entry_references.target_entry_id': entryId,\n        'entry_references.target_path': dataPath\n      }\n    })\n    api.query('entries', referencing_query, {noLoading: true}).then((data) => {\n      source.external_refs = Object.fromEntries(data.data.map((entry, index) => {\n        entry.entry_references = entry.entry_references.filter(ref => ref.target_entry_id === entryId && ref.target_path === dataPath)\n        return ['_external_ref_' + index, entry]\n      }))\n      setSearchResults(Object.values(source.external_refs))\n    }).catch(raiseError)\n  }\n\n  const entry_list = (list) => {\n    return list.map((ref, index) => (\n      <Item itemKey={'_external_ref_' + index} key={index}><Typography component=\"span\">\n        <Box fontWeight=\"bold\" component=\"span\">{ref.mainfile}</Box>\n        &nbsp;=&nbsp;\n        <Box component=\"span\" fontStyle=\"italic\">entry ...</Box>\n        {ref.entry_references?.map(\n          (ref, index) => <Typography key={index} variant=\"body2\">{ref.source_path}</Typography>\n        )}\n      </Typography></Item>\n    ))\n  }\n\n  return <Compartment title=\"referenced by\" startCollapsed={true} onUnfold={performSearch}>\n    {searchResults\n      ? searchResults.length > 0\n        ? searchResults.length === 20\n          ? <Tooltip title=\"Only showing at most the latest 20 entries.\">\n            {entry_list(searchResults)}\n          </Tooltip>\n          : entry_list(searchResults)\n        : <Alert severity={'info'}>not referenced by other entries</Alert>\n      : <Alert severity={'info'} data-testid={isWaitingForUpdateTestId}>loading...</Alert>}\n  </Compartment>\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useRef, useState, useEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport { Select, MenuItem, Card, CardContent, CardHeader, makeStyles, Tooltip } from '@material-ui/core'\nimport * as d3 from 'd3'\nimport { scaleBand, scalePow } from 'd3-scale'\nimport { formatQuantity, nomadPrimaryColor, nomadSecondaryColor, nomadFontFamily, nomadTheme } from '../config.js'\n\nfunction split(array, cols) {\n  if (cols === 1) {\n    return [array]\n  }\n  const size = Math.ceil(array.length / cols)\n  return [array.slice(0, size), ...split(array.slice(size), cols - 1)]\n}\n\nfunction isSelected(d, selected, multiple) {\n  // Determine if the value has been selected\n  let isSelected\n  if (multiple) {\n    if (selected === undefined) {\n      isSelected = false\n    } else {\n      if (Array.isArray(selected)) {\n        const selections = new Set(selected)\n        isSelected = selections.has(d.key)\n      } else {\n        isSelected = selected === d.key\n      }\n    }\n  } else {\n    isSelected = selected === d.key\n  }\n  return isSelected\n}\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    marginTop: theme.spacing(2)\n  },\n  content: {\n    paddingTop: 0,\n    position: 'relative'\n  },\n  tooltip: {\n    width: '100%',\n    height: '100%'\n  },\n  tooltipContent: {\n    position: 'absolute',\n    fontSize: nomadTheme.overrides.MuiTooltip.tooltip.fontSize,\n    fontWeight: nomadTheme.overrides.MuiTooltip.tooltip.fontWeight,\n    // backgroundColor: '#ffbb00' // Uncomment for debugging tooltips\n    display: 'none',\n    zIndex: 1,\n    cursor: 'pointer'\n  },\n  canvas: {\n    zIndex: 2\n  }\n}))\nexport default function Histogram({\n  initialScale = 1, getValueLabel, numberOfValues, title, data, columns = 1, tooltips,\n  onClick, selected, card, multiple\n}) {\n  onClick = onClick || (() => null)\n  data = data || []\n  numberOfValues = numberOfValues || data.length\n  getValueLabel = getValueLabel || (value => value.name)\n  title = title || 'Histogram'\n\n  const [tooltipHTML, setTooltipHTML] = useState('')\n  const [item, setItem] = useState()\n  const [scale, setScale] = useState(initialScale)\n  const classes = useStyles()\n  const containerRef = useRef()\n\n  const handleItemClicked = item => {\n    if (item.value !== 0) {\n      onClick(item)\n    }\n  }\n\n  useEffect(() => {\n    // TODO add proper treatment of not processed on server side and processing\n    const numberOfValuesToRender = numberOfValues\n    // if (data[data.length - 1] && data[data.length - 1].key === 'not processed') {\n    //   if (data[data.length - 2].key === 'unavailable') {\n    //     data[data.length - 2].value += data[data.length - 1].value\n    //     data.pop()\n    //     numberOfValuesToRender -= 1\n    //   }\n    // }\n\n    for (let i = data.length; i < numberOfValuesToRender; i++) {\n      data.push({key: `empty${i}`, name: '', value: 0})\n    }\n\n    const columnSize = Math.ceil(data.length / columns)\n    for (let i = data.length; i < columnSize * columns; i++) {\n      data.push({key: `empty${i}`, name: '', value: 0})\n    }\n    const columnsData = split(data, columns)\n\n    const containerWidth = containerRef.current.offsetWidth\n    const width = containerWidth / columns - (12 * (columns - 1))\n    const height = columnSize * 32\n    const padding = 16\n\n    const x = scalePow().range([0, width]).exponent(scale)\n\n    // we use at least the domain 0..1, because an empty domain causes a weird layout\n    const max = d3.max(data, d => d.value) || 1\n    x.domain([0, max])\n\n    const rectColor = d => isSelected(d, selected, multiple) ? nomadSecondaryColor.main : nomadPrimaryColor.light\n    const textColor = d => {\n      if (d.value === 0) {\n        return '#999'\n      }\n      return isSelected(d, selected, multiple) ? '#FFF' : '#000'\n    }\n\n    const container = d3.select(containerRef.current)\n    const tooltipContent = container.select('.' + classes.tooltipContent)\n    const svg = container.select('svg')\n      .attr('width', containerWidth)\n      .attr('height', height)\n    tooltipContent\n      .style('width', width + 'px')\n      .style('height', 27 + 'px')\n\n    const columnsG = svg\n      .selectAll('.column')\n      .data(columnsData.map((_, i) => `column${i}`))\n\n    columnsG.exit().remove()\n    columnsG\n      .enter()\n      .append('g')\n      .attr('id', d => d)\n      .attr('class', 'column')\n      .attr('transform', (d, i) => `translate(${i * (width + 12)}, 0)`)\n\n    columnsData.forEach((data, i) => {\n      const y = scaleBand().rangeRound([0, height]).padding(0.1)\n      y.domain(data.map(d => d.key))\n\n      const items = svg.select('#column' + i)\n        .selectAll('.item')\n        .data(data, d => d.key)\n\n      items.exit().remove()\n\n      items\n        .on('click', handleItemClicked)\n\n      let item = items.enter()\n        .append('g')\n        .attr('class', 'item')\n        .attr('display', d => getValueLabel(d) === '' ? 'none' : 'show')\n        .style('cursor', 'pointer')\n        .on('click', handleItemClicked)\n\n      item\n        .append('rect')\n        .attr('x', x(0))\n        .attr('y', d => y(d.key))\n        .attr('width', width)\n        .attr('class', 'background')\n        .style('opacity', 0)\n        .attr('height', y.bandwidth())\n\n      item\n        .append('rect')\n        .attr('class', 'bar')\n        .attr('x', x(0))\n        .attr('y', d => y(d.key))\n        .attr('width', d => x(d.value) - x(0))\n        .attr('height', y.bandwidth())\n        .style('fill', rectColor)\n        // .style('stroke', '#000')\n        // .style('stroke-width', '1px')\n        .style('shape-rendering', 'geometricPrecision')\n\n      item\n        .append('text')\n        .attr('class', 'name')\n        .attr('dy', '.75em')\n        .attr('x', x(0) + 4)\n        .attr('y', d => y(d.key) + 4)\n        .attr('text-anchor', 'start')\n        .style('fill', textColor)\n        .style('font-family', nomadFontFamily)\n        .text(d => getValueLabel(d))\n\n      item\n        .append('text')\n        .attr('class', 'value')\n        .attr('dy', y.bandwidth())\n        .attr('y', d => y(d.key) - 4)\n        .attr('x', d => width - 4)\n        .attr('text-anchor', 'end')\n        .style('fill', textColor)\n        .style('font-family', nomadFontFamily)\n        .text(d => formatQuantity(d.value))\n\n      item\n        .on('mouseenter', function(d) {\n          setItem(d)\n          if (tooltips) {\n            if (d.tooltip) {\n              tooltipContent\n                .style('left', i * (width) + padding + 'px')\n                .style('top', (y(d.key)) + 'px')\n                .style('display', 'block')\n              setTooltipHTML(d.tooltip)\n            }\n          }\n        })\n        .on('mouseleave', function(d) {\n        })\n\n      item = items.transition(d3.transition().duration(500))\n\n      item\n        .select('.bar')\n        .attr('y', d => y(d.key))\n        .attr('width', d => x(d.value) - x(0))\n        .attr('height', y.bandwidth())\n        .style('fill', rectColor)\n\n      item\n        .select('.name')\n        .text(d => getValueLabel(d))\n        .attr('y', d => y(d.key) + 4)\n        .style('fill', textColor)\n\n      item\n        .select('.value')\n        .text(d => formatQuantity(d.value))\n        .attr('y', d => y(d.key) - 4)\n        .attr('x', width - 4)\n        .style('fill', textColor)\n    })\n  })\n\n  const chart = <div ref={containerRef}>\n    <div className={classes.tooltip}>\n      <Tooltip\n        interactive\n        placement='right'\n        title={tooltipHTML}\n      >\n        <div className={classes.tooltipContent} onClick={() => { handleItemClicked(item) }}>\n        </div>\n      </Tooltip>\n      <svg className={classes.canvas}></svg>\n    </div>\n  </div>\n\n  if (card) {\n    return <Card classes={{root: classes.root}}>\n      <CardHeader\n        title={title}\n        titleTypographyProps={{variant: 'body1'}}\n        action={(\n          <Tooltip title=\"Select the power of the scale\">\n            <Select\n              value={scale}\n              onChange={(event) => setScale(event.target.value)}\n              displayEmpty\n              name=\"scale power\"\n            >\n              <MenuItem value={1}>linear</MenuItem>\n              <MenuItem value={0.5}>1/2</MenuItem>\n              <MenuItem value={0.25}>1/4</MenuItem>\n              <MenuItem value={0.125}>1/8</MenuItem>\n            </Select>\n          </Tooltip>\n        )}\n      />\n      <CardContent classes={{root: classes.content}}>\n        {chart}\n      </CardContent>\n    </Card>\n  } else {\n    return chart\n  }\n}\nHistogram.propTypes = {\n  /**\n   * An optional title for the chart. If no title is given, the Histogram is used.\n   */\n  title: PropTypes.string,\n  /**\n   * An optional scale power that is used as the initial scale before the user\n   * changes it. Default is 1 (linear scale).\n   */\n  initialScale: PropTypes.number,\n  /**\n   * The data. Must be an array of object with keys key (unique key), value (number),\n   * and name. Name is only necessary if no getValueLabel is given.\n   */\n  data: PropTypes.arrayOf(PropTypes.object),\n  /**\n   * The maximum number of values. This is used to fix the histograms size. Otherwise,\n   * the size is determined by the required space to render the existing values.\n   */\n  numberOfValues: PropTypes.number,\n  /**\n   * The number of columns that the values should be rendered in. Default is one.\n   */\n  columns: PropTypes.number,\n  /**\n   * Set to true to enable tooltips for each value.\n   */\n  tooltips: PropTypes.bool,\n  /**\n   * This callback is called if a value is clicked.\n   */\n  onClick: PropTypes.func,\n  /**\n   * The given value will be highlighted as selected.\n   */\n  selected: PropTypes.any,\n  /**\n   * A function that determined the label of a value.\n   */\n  getValueLabel: PropTypes.func,\n  /**\n   * If true the chart is wrapped in a MUI paper card with title and form.\n   */\n  card: PropTypes.bool,\n  /**\n   * If true, multiple values may be selected.\n   */\n  multiple: PropTypes.bool\n}\n\nHistogram.defaultProps = {\n  multiple: false\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useMemo, useEffect, useRef, useLayoutEffect, useContext, useState, useCallback} from 'react'\nimport PropTypes from 'prop-types'\nimport { useRecoilValue, useRecoilState, atom } from 'recoil'\nimport { configState } from './ArchiveBrowser'\nimport Browser, { Item, Content, Compartment, Adaptor, laneContext, Title, ItemChip } from './Browser'\nimport { Typography, Box, makeStyles, FormGroup, TextField, Button, Link } from '@material-ui/core'\nimport { vicinityGraph, SubSectionMDef, SectionMDef, QuantityMDef, CategoryMDef, useGlobalMetainfo, PackageMDef, AttributeMDef, getMetainfoFromDefinition } from './metainfo'\nimport * as d3 from 'd3'\nimport blue from '@material-ui/core/colors/blue'\nimport teal from '@material-ui/core/colors/teal'\nimport lime from '@material-ui/core/colors/lime'\nimport purple from '@material-ui/core/colors/purple'\nimport grey from '@material-ui/core/colors/grey'\nimport Markdown from '../Markdown'\nimport Histogram from '../Histogram'\nimport { appBase } from '../../config'\nimport { useHistory, useRouteMatch } from 'react-router-dom'\nimport Autocomplete from '@material-ui/lab/Autocomplete'\nimport { useApi } from '../api'\nimport { useErrors } from '../errors'\nimport { SourceJsonDialogButton } from '../buttons/SourceDialogButton'\nimport ReactJson from 'react-json-view'\nimport ArchiveSearchBar from './ArchiveSearchBar'\nimport {getDisplayLabel} from \"../../utils\"\n\nexport const help = `\nThe NOMAD *metainfo* defines all quantities used to represent archive data in\nNOMAD. You could say it is the archive *schema*. You can browse this schema and\nall its definitions here.\n\nThe NOMAD metainfo contains three different *kinds* of definitions:\n\n- **sections**: A section is a nested groups of quantities that allow a hierarchical data structure\n- **values**: Actual quantities that contain data\n- **references**: References that allow to connect related sections.\n\nAll definitions have a name that you can search for. Furthermore, all definitions\nare organized in packages. There is a *common* pkg with definitions that are\nused by all codes and there are packages for each code with code specific definitions.\nYou can select the pkg to browse below.\n\nDepending on the selected pkg, there are quite a large number of definitions.\nYou can use the *definition* field to search based on definition names.\n\nAll definitions are represented as *cards* below. Click on the various card items\nto expand sub-sections, open values or references, hide and show compartments, or\ncollapse cards again. The highlighted *main* card cannot be collapsed. The\nshapes in the background represent section containment (grey) and\nreference (blue) relations.\n\nIf you bookmark this page, you can save the definition represented by the highlighted\n*main* card.\n\nTo learn more about the metainfo, visit the [metainfo documentation](${appBase}/docs/metainfo.html).\n`\n\nconst showInnerSectionDefinitions = false\n\nfunction defCompare(a, b) {\n  return a.name.localeCompare(b.name)\n}\n\nexport const metainfoConfigState = atom({\n  key: 'metainfoConfig',\n  default: {\n    'packagePrefix': 'all'\n  }\n})\n\nexport function MetainfoPage() {\n  return <Box margin={3}>\n    <MetainfoBrowser />\n  </Box>\n}\n\nexport default function MetainfoBrowser() {\n  const globalMetainfo = useGlobalMetainfo()\n  const adaptor = useMemo(() => {\n    return globalMetainfo ? new MetainfoRootAdaptor(globalMetainfo.getEntryArchiveDefinition()) : null\n  }, [globalMetainfo])\n  if (!adaptor) {\n    return null\n  }\n  return <Browser\n    adaptor={adaptor}\n    form={<MetainfoConfigForm />}\n  />\n}\n\nconst useStyles = makeStyles(theme => {\n  return {\n    container: {\n      alignItems: 'center',\n      flexWrap: 'nowrap'\n    },\n    searchBar: {\n      width: 850,\n      marginRight: theme.spacing(1.5)\n    },\n    sourceBar: {\n      width: 350\n    },\n    textInput: {\n      margin: 0\n    }\n  }\n})\n\nconst MetainfoConfigForm = React.memo(function MetainfoConfigForm(props) {\n  const styles = useStyles()\n  const [config, setConfig] = useRecoilState(metainfoConfigState)\n  const globalMetainfo = useGlobalMetainfo()\n  const history = useHistory()\n  const { url } = useRouteMatch()\n\n  const searchOptions = useMemo(() => {\n    const defsByName = globalMetainfo.getDefsByName()\n    const searchOptions = {}\n    globalMetainfo && Object.keys(defsByName).forEach((name) => {\n      const defsForName = defsByName[name].filter(def => (\n        !def.extends_base_section && def.m_def !== SubSectionMDef && (\n          def._package.name.startsWith(config.packagePrefix) || def._package.name.startsWith('nomad'))\n      ))\n      defsForName.forEach(def => {\n        const path = globalMetainfo.path(def)\n        const prefix = 'nomad.datamodel.datamodel.EntryArchive/'\n        const instance = path.startsWith(prefix)\n        let info, label\n        if (instance) {\n          info = path.slice(prefix.length, path.length)?.replace(/\\//g, \".\")\n          label = info.split(\".\").slice(-1)[0] || info\n        } else {\n          info = def?._qualifiedName?.split('/')[0]\n          label = def.more?.label || def.name\n        }\n        const key = info || label\n        const option = {\n          url: url + '/' + path,\n          primary: label,\n          secondary: info,\n          key: key\n        }\n        searchOptions[key] = option\n      })\n    })\n    return searchOptions\n  }, [config.packagePrefix, url, globalMetainfo])\n\n  const handleChange = useCallback((path) => {\n    if (path) {\n      history.push(path)\n    }\n  }, [history])\n\n  return (\n    <Box marginBottom={1.5} padding={0}>\n      <FormGroup row className={styles.container}>\n        <ArchiveSearchBar\n          options={searchOptions}\n          onChange={handleChange}\n          className={styles.searchBar}\n        />\n        <Autocomplete\n          className={styles.sourceBar}\n          value={config.packagePrefix}\n          options={globalMetainfo ? ['all', ...Object.keys(globalMetainfo.getPackagePrefixes())] : []}\n          getOptionLabel={option => option.replace(/parser/g, '')}\n          onChange={(_, value) => setConfig({...config, packagePrefix: value})}\n          renderInput={(params) => <TextField\n            {...params}\n            variant=\"filled\"\n            label=\"source\"\n            margin=\"normal\"\n            className={styles.textInput}\n          />}\n        />\n      </FormGroup>\n    </Box>\n  )\n})\n\nexport async function metainfoAdaptorFactory(def) {\n  if (def.m_def === SectionMDef) {\n    return new SectionDefAdaptor(def)\n  } else if (def.m_def === SubSectionMDef) {\n    return new SubSectionDefAdaptor(def)\n  } else if (def.m_def === QuantityMDef) {\n    return new QuantityDefAdaptor(def)\n  } else if (def.m_def === CategoryMDef) {\n    return new CategoryDefAdaptor(def)\n  } else if (def.m_def === PackageMDef) {\n    return new PackageDefAdaptor(def)\n  } else if (def.m_def === AttributeMDef) {\n    return new AttributeDefAdaptor(def)\n  } else {\n    throw new Error('Unknown metainfo definition type')\n  }\n}\n\nclass MetainfoAdaptor extends Adaptor {\n  constructor(def) {\n    super()\n    this.def = def\n  }\n\n  async itemAdaptor(key) {\n    if (key === '_reference') {\n      return metainfoAdaptorFactory(this.def.type._referencedDefinition)\n    } else if (key.startsWith('_category:')) {\n      const categoryName = key.split(':')[1]\n      return metainfoAdaptorFactory(this.def.categories.find(categoryDef => categoryDef.name === categoryName))\n    } else if (key === '_metainfo') {\n      return metainfoAdaptorFactory(await getMetainfoFromDefinition(this.def).resolveDefinition(this.def.m_def))\n    } else {\n      throw new Error('Unknown item key')\n    }\n  }\n\n  async initialize(api, dataStore) {\n    if (this.def.m_def === SectionMDef || this.def.m_def === SubSectionMDef) {\n      this.inheritingSections = dataStore.getAllInheritingSections(this.def.sub_section || this.def)\n    }\n  }\n}\n\nexport class MetainfoRootAdaptor extends MetainfoAdaptor {\n  async itemAdaptor(key) {\n    const rootSection = getMetainfoFromDefinition(this.def).getRootSectionDefinitions().find(def => def._qualifiedName === key)\n    if (rootSection) {\n      return metainfoAdaptorFactory(rootSection)\n    } else {\n      const packagePrefixes = getMetainfoFromDefinition(this.def).getPackagePrefixes()\n      if (packagePrefixes[key]) {\n        return new PackagePrefixAdaptor(packagePrefixes[key])\n      }\n    }\n\n    return super.itemAdaptor(key)\n  }\n  render() {\n    return <Metainfo />\n  }\n}\n\nexport class PackageDefAdaptor extends MetainfoAdaptor {\n  async itemAdaptor(key) {\n    const sectionDef = this.def.section_definitions.find(sectionDef => sectionDef.name === key)\n    if (sectionDef) {\n      return metainfoAdaptorFactory(sectionDef)\n    }\n    return super.itemAdaptor(key)\n  }\n  render() {\n    return <Content>\n      <ArchiveTitle def={this.def} />\n      <DefinitionDocs def={this.def} />\n      <Compartment>\n        {this.def.section_definitions.map(sectionDef => (\n          <Item key={sectionDef.name} itemKey={sectionDef.name}>\n            <Typography>{sectionDef.name}</Typography>\n          </Item>\n        ))}\n      </Compartment>\n    </Content>\n  }\n}\n\nexport class PackagePrefixAdaptor extends MetainfoAdaptor {\n  async itemAdaptor(key) {\n    const [type, name] = key.split('@')\n    const def = Object.keys(this.def)\n      .map(key => this.def[key])\n      .reduce((value, pkg) => value || pkg[type].find(def => def._qualifiedName === name), null)\n    return metainfoAdaptorFactory(def)\n  }\n  render() {\n    const sectionDefs = Object.keys(this.def)\n      .map(key => this.def[key])\n      .reduce((defs, pkg) => {\n        pkg.section_definitions.forEach(def => defs.push(def))\n        return defs\n      }, [])\n    const categoryDefs = Object.keys(this.def)\n      .map(key => this.def[key])\n      .reduce((defs, pkg) => {\n        pkg.category_definitions.forEach(def => defs.push(def))\n        return defs\n      }, [])\n\n    return <Content>\n      <Compartment title=\"Sections\">\n        {sectionDefs.filter(def => !def.extends_base_section).sort(defCompare).map(def => {\n          const key = `section_definitions@${def._qualifiedName}`\n          return <Item key={key} itemKey={key}>\n            <Typography>{def.more?.label || def.name}</Typography>\n          </Item>\n        })}\n      </Compartment>\n      <Compartment title=\"Section Extensions\">\n        {sectionDefs.filter(def => def.extends_base_section).sort(defCompare).map(def => {\n          const key = `section_definitions@${def._qualifiedName}`\n          return <Item key={key} itemKey={key}>\n            <Typography>{def.more?.label || def.name}</Typography>\n          </Item>\n        })}\n      </Compartment>\n      <Compartment title=\"Categories\">\n        {categoryDefs.sort(defCompare).map(def => {\n          const key = `category_definitions@${def._qualifiedName}`\n          return <Item key={key} itemKey={key}>\n            <Typography>{def.more?.label || def.name}</Typography>\n          </Item>\n        })}\n      </Compartment>\n    </Content>\n  }\n}\n\nconst Metainfo = function Metainfo(props) {\n  const globalMetainfo = useGlobalMetainfo()\n  return <Content>\n    <Compartment title=\"archive root section\">\n      <Item itemKey=\"nomad.datamodel.datamodel.EntryArchive\">\n        <Typography>Entry</Typography>\n      </Item>\n    </Compartment>\n    <Compartment title=\"sources\">\n      {Object.keys(globalMetainfo.getPackagePrefixes()).map(key => <Item key={key} itemKey={key}>\n        <Typography>{key.replace(/parser$/, '')}</Typography>\n      </Item>)}\n    </Compartment>\n    <Compartment title=\"other root sections\" startCollapsed>\n      {globalMetainfo.getRootSectionDefinitions().filter(def => def.name !== 'EntryArchive').map((def, i) => (\n        <Item key={i} itemKey={def._qualifiedName}>\n          <Typography>\n            {def.more?.label || def.name}\n          </Typography>\n        </Item>\n      ))}\n    </Compartment>\n  </Content>\n}\n\nexport class SectionDefAdaptor extends MetainfoAdaptor {\n  itemAdaptor(key) {\n    if (key.includes('@')) {\n      const [type, name] = key.split('@')\n      if (type === '_innerSectionDef') {\n        const innerSectionDef = this.def.inner_section_definitions.find(def => def.name === name)\n        if (innerSectionDef) {\n          return metainfoAdaptorFactory(innerSectionDef)\n        }\n      } else if (type === '_inheritingSectionDef') {\n        const inheritingSectionDef = this.inheritingSections.find(inheritingSection => inheritingSection._qualifiedName === name)\n        if (inheritingSectionDef) {\n          return metainfoAdaptorFactory(inheritingSectionDef)\n        }\n      } else if (type === '_baseSectionDef') {\n        const baseSectionDef = this.def.base_sections[parseInt(name)]\n        if (baseSectionDef) {\n          return metainfoAdaptorFactory(baseSectionDef)\n        }\n      }\n    }\n\n    const property = this.def._properties[key]\n    if (property) {\n      return metainfoAdaptorFactory(property)\n    }\n\n    const attribute = this.def._allAttributes?.find(attr => attr.name === key)\n    if (attribute) {\n      return metainfoAdaptorFactory(attribute)\n    }\n\n    return super.itemAdaptor(key)\n  }\n  render() {\n    return <SectionDef def={this.def} inheritingSections={this.inheritingSections}/>\n  }\n}\n\nclass SubSectionDefAdaptor extends MetainfoAdaptor {\n  constructor(def) {\n    super(def)\n    this.sectionDefAdaptor = new SectionDefAdaptor(this.def.sub_section)\n  }\n  async initialize(api, dataStore) {\n    await this.sectionDefAdaptor.initialize(api, dataStore)\n  }\n  cleanup() {\n    this.sectionDefAdaptor.cleanup()\n  }\n  async itemAdaptor(key) {\n    const attributeDef = this.def._allAttributes?.find(def => def.name === key)\n    if (attributeDef) {\n      return metainfoAdaptorFactory(attributeDef)\n    }\n    return this.sectionDefAdaptor.itemAdaptor(key)\n  }\n  render() {\n    return <SubSectionDef def={this.def} inheritingSections={this.sectionDefAdaptor.inheritingSections}/>\n  }\n}\n\nclass QuantityDefAdaptor extends MetainfoAdaptor {\n  itemAdaptor(key) {\n    const attributeDef = this.def._allAttributes?.find(def => def.name === key)\n    if (attributeDef) {\n      return metainfoAdaptorFactory(attributeDef)\n    }\n\n    return super.itemAdaptor(key)\n  }\n\n  render() {\n    return <QuantityDef def={this.def} />\n  }\n}\n\nclass CategoryDefAdaptor extends MetainfoAdaptor {\n  render() {\n    return <Content>\n      <Definition def={this.def} />\n      <DefinitionDetails def={this.def} />\n    </Content>\n  }\n}\n\nclass AttributeDefAdaptor extends MetainfoAdaptor {\n  render() {\n    return <AttributeDef def={this.def} />\n  }\n}\n\nfunction SectionDefContent({def, inheritingSections}) {\n  const config = useRecoilValue(configState)\n  const metainfoConfig = useRecoilValue(metainfoConfigState)\n  const filter = def.extends_base_section ? () => true : def => {\n    if (def?._package?._unique_id?.startsWith('entry_id:')) {\n      // dynamically loaded custom schema\n      return true\n    }\n    if (def._package.name.startsWith('nomad')) {\n      return true\n    }\n    if (def._package.name.startsWith('nexus')) {\n      return true\n    }\n    if (metainfoConfig.packagePrefix !== 'all') {\n      return def._package.name.startsWith(metainfoConfig.packagePrefix)\n    }\n    if (def.name.startsWith('x_')) {\n      return config.showCodeSpecific\n    }\n    return true\n  }\n\n  return <React.Fragment>\n    <DefinitionProperties def={def} />\n    {def.base_sections.length > 0 &&\n      <Compartment title=\"base section\">\n        {def.base_sections.map((baseSection, index) => {\n          const key = `_baseSectionDef@${index}`\n          const categories = baseSection.categories\n          const unused = categories?.find(c => c.name === 'Unused')\n          return <Item key={key} itemKey={key}>\n            <Box component=\"span\" whiteSpace=\"nowrap\">\n              <Typography component=\"span\" color={unused && 'error'}>\n                <Box fontWeight=\"bold\" component=\"span\">\n                  {baseSection.name}\n                </Box>\n              </Typography>\n            </Box>\n          </Item>\n        })}\n      </Compartment>\n    }\n    {inheritingSections.length > 0 &&\n      <Compartment title=\"all inheriting sections\" startCollapsed>\n        {inheritingSections.map((inheritingSection, index) => {\n          const key = `_inheritingSectionDef@${inheritingSection._qualifiedName}`\n          const categories = inheritingSection.categories\n          const unused = categories?.find(c => c.name === 'Unused')\n          return <Item key={index} itemKey={key}>\n            <Box component=\"span\" whiteSpace=\"nowrap\">\n              <Typography component=\"span\" color={unused && 'error'}>\n                <Box fontWeight=\"bold\" component=\"span\">\n                  {inheritingSection.name}\n                </Box>\n              </Typography>\n            </Box>\n          </Item>\n        })}\n      </Compartment>\n    }\n    <Compartment title=\"sub section definitions\">\n      {def._allProperties.filter(prop => prop.m_def === SubSectionMDef).filter(filter)\n        .map(subSectionDef => {\n          const key = subSectionDef.name\n          const categories = subSectionDef.categories\n          const unused = categories?.find(c => c.name === 'Unused')\n          const inherited = subSectionDef._parent !== def\n          return <Item key={key} itemKey={key}>\n            <Typography component=\"span\" color={unused && 'error'}>\n              <Box fontWeight=\"bold\" component=\"span\">\n                {subSectionDef.name}\n              </Box>\n              {subSectionDef.repeats && <ItemChip label=\"repeats\"/>}\n              {subSectionDef._overwritten && <ItemChip label=\"overwritten\" />}\n              {inherited && <ItemChip label=\"inherited\" />}\n            </Typography>\n          </Item>\n        })\n      }\n    </Compartment>\n    <Compartment title=\"quantity definitions\">\n      {def._allProperties.filter(prop => prop.m_def === QuantityMDef).filter(filter)\n        .map(quantityDef => {\n          const key = quantityDef.name\n          const categories = quantityDef.categories\n          const unused = categories?.find(c => c.name === 'Unused')\n          const inherited = quantityDef._parent !== def\n          return <Item key={key} itemKey={key}>\n            <Box component=\"span\" whiteSpace=\"nowrap\">\n              <Typography component=\"span\" color={unused && 'error'}>\n                <Box fontWeight=\"bold\" component=\"span\">\n                  {quantityDef.name}\n                </Box>\n              </Typography>\n              {quantityDef._overwritten && <ItemChip label=\"overwritten\" />}\n              {inherited && <ItemChip label=\"inherited\" />}\n            </Box>\n          </Item>\n        })\n      }\n    </Compartment>\n    {showInnerSectionDefinitions && <Compartment title=\"inner section definitions\">\n      {def.inner_section_definitions.filter(filter)\n        .map(innerSectionDef => {\n          const key = `_innerSectionDef@${innerSectionDef.name}`\n          const categories = innerSectionDef.categories\n          const unused = categories?.find(c => c.name === 'Unused')\n          return <Item key={key} itemKey={key}>\n            <Box component=\"span\" whiteSpace=\"nowrap\">\n              <Typography component=\"span\" color={unused && 'error'}>\n                <Box fontWeight=\"bold\" component=\"span\">\n                  {getDisplayLabel(innerSectionDef, true)}\n                </Box>\n              </Typography>\n            </Box>\n          </Item>\n        })\n      }\n    </Compartment>}\n    <DefinitionDetails def={def} />\n    <Attributes def={def}/>\n    <Annotations def={def}/>\n  </React.Fragment>\n}\nSectionDefContent.propTypes = ({\n  def: PropTypes.object,\n  inheritingSections: PropTypes.array\n})\n\nfunction SectionDef({def, inheritingSections}) {\n  const label = getDisplayLabel(def, true)\n  return <Content>\n    <Definition def={def} kindLabel=\"section definition\" />\n    <DefinitionProperties def={def}>\n      <Typography>\n        <b>label</b>:&nbsp;\n        {label}\n      </Typography>\n    </DefinitionProperties>\n    <SectionDefContent def={def} inheritingSections={inheritingSections}/>\n  </Content>\n}\nSectionDef.propTypes = ({\n  def: PropTypes.object,\n  inheritingSections: PropTypes.array\n})\n\nfunction SubSectionDef({def, inheritingSections}) {\n  const sectionDef = def.sub_section\n  const label = getDisplayLabel(def, true)\n  return <React.Fragment>\n    <Content>\n      <ArchiveTitle def={def} useName isDefinition kindLabel=\"sub section definition\" />\n      <DefinitionProperties def={def}>\n        <Typography>\n          <b>label</b>:&nbsp;\n          {label}\n        </Typography>\n        <Typography>\n          <b>repeats</b>:&nbsp;\n          {def.repeats ? 'True' : 'False'}\n        </Typography>\n      </DefinitionProperties>\n      <DefinitionDocs def={sectionDef} />\n      <Attributes def={def}/>\n      <Annotations def={def}/>\n      <SectionDefContent def={sectionDef} inheritingSections={inheritingSections}/>\n    </Content>\n  </React.Fragment>\n}\nSubSectionDef.propTypes = ({\n  def: PropTypes.object,\n  inheritingSections: PropTypes.array\n})\n\nfunction DefinitionProperties({def, children}) {\n  const searchAnnotations = def.m_annotations && Object.keys(def.m_annotations)\n    .filter(key => key === 'elasticsearch')\n    .map(key => def.m_annotations[key].filter(\n      value => !(value.endsWith('.suggestion') || value.endsWith('__suggestion')))\n    )\n  const hasSearchAnnotations = searchAnnotations && searchAnnotations.length > 0\n\n  if (!(children || def.aliases?.length || def.deprecated || (def.more && Object.keys(def.more).length) || hasSearchAnnotations)) {\n    return null\n  }\n\n  return <Compartment title=\"properties\">\n    {children}\n    {def.aliases?.length && <Typography><b>aliases</b>:&nbsp;{def.aliases.map(a => `\"${a}\"`).join(', ')}</Typography>}\n    {def.deprecated && <Typography><b>deprecated</b>: {def.deprecated}</Typography>}\n    {Object.keys(def.more || {}).map((moreKey, i) => (\n      <Typography key={i}><b>{moreKey}</b>:&nbsp;{String(def.more[moreKey])}</Typography>\n    ))}\n    {hasSearchAnnotations > 0 && <Typography><b>search&nbsp;keys</b>:&nbsp;{\n      searchAnnotations.join(', ')}</Typography>}\n  </Compartment>\n}\nDefinitionProperties.propTypes = ({\n  def: PropTypes.object,\n  children: PropTypes.any\n})\n\nfunction QuantityDef({def}) {\n  const label = getDisplayLabel(def, true)\n  return <Content>\n    <Definition def={def} kindLabel=\"quantity definition\"/>\n    <DefinitionProperties def={def}>\n      <Typography>\n        <b>label</b>:&nbsp;\n        {label}\n      </Typography>\n      {def.type.type_kind !== 'reference'\n        ? <Typography>\n          <b>type</b>:&nbsp;\n          {Array.isArray(def.type.type_data) ? def.type.type_data.join(', ') : def.type.type_data}&nbsp;\n          {def.type.type_kind !== 'data' && `(${def.type.type_kind})`}\n        </Typography>\n        : <Item itemKey=\"_reference\">\n          <Typography>\n            <b>referenced section</b>\n          </Typography>\n        </Item>}\n      <Typography>\n        <b>shape</b>:&nbsp;\n        [{def.shape.join(', ')}]\n      </Typography>\n      {def.derived && <Typography><b>repeats</b>:&nbsp;true</Typography>}\n      {def.unit &&\n        <Typography><b>unit</b>:&nbsp;{def.unit}</Typography>}\n      {def.dimensionality &&\n        <Typography><b>dimensionality</b>:&nbsp;{def.dimensionality}</Typography>}\n      {def.default &&\n        <Typography><b>default</b>:&nbsp;{String(def.default)}</Typography>}\n      {def.derived && <Typography><b>derived</b>:&nbsp;true</Typography>}\n      {def.variable && <Typography><b>variable</b>:&nbsp;true</Typography>}\n    </DefinitionProperties>\n    <Attributes def={def}/>\n    <Annotations def={def}/>\n  </Content>\n}\nQuantityDef.propTypes = ({\n  def: PropTypes.object\n})\n\nfunction AttributeDef({def}) {\n  return <Content>\n    <Definition def={def} kindLabel=\"attribute definition\"/>\n    <DefinitionProperties def={def}>\n      <Typography>\n        <b>type</b>:&nbsp;\n        {Array.isArray(def.type.type_data) ? def.type.type_data.join(', ') : def.type.type_data}&nbsp;\n        {def.type.type_kind !== 'data' && `(${def.type.type_kind})`}\n      </Typography>\n      {def.shape && <Typography>\n        <b>shape</b>:&nbsp;\n        [{def.shape.join(', ')}]\n      </Typography>}\n      {def.default &&\n        <Typography><b>default</b>:&nbsp;{String(def.default)}</Typography>}\n    </DefinitionProperties>\n    <Attributes def={def}/>\n    <Annotations def={def}/>\n  </Content>\n}\nAttributeDef.propTypes = ({\n  def: PropTypes.object\n})\n\nfunction Attributes({def}) {\n  if (!def._allAttributes?.length) {\n    return null\n  }\n\n  return <Compartment title=\"attributes\">\n     {def._allAttributes.map((attributeDef) => {\n        const key = attributeDef.name\n        const inherited = attributeDef._parent !== def\n        return <Item key={key} itemKey={attributeDef.name}>\n          <Typography component=\"span\">\n            <Box fontWeight=\"bold\" component=\"span\">\n              {attributeDef.more?.label || attributeDef.name}\n            </Box>\n            {attributeDef._overwritten && <ItemChip label=\"overwritten\" />}\n            {inherited && <ItemChip label=\"inherited\" />}\n          </Typography>\n        </Item>\n      })}\n  </Compartment>\n}\nAttributes.propTypes = ({\n  def: PropTypes.object\n})\n\nfunction DefinitionDocs({def}) {\n  return <React.Fragment>\n    {def.description && !def.extends_base_section &&\n      <Compartment title=\"description\">\n        <Box marginTop={1} marginBottom={1}>\n          {def?._qualifiedName?.startsWith('nexus')\n            ? <Typography>{def.description}</Typography>\n            : <Markdown>{def.description}</Markdown>}\n        </Box>\n      </Compartment>\n    }\n    {def.links?.length &&\n      <Compartment title=\"links\">\n        {def.links.map((link, i) => <div key={i}>\n          <Link href={link} key={i}>{link.includes('manual.nexusformat.org') ? 'nexus manual' : link}</Link>\n        </div>)}\n      </Compartment>\n    }\n  </React.Fragment>\n}\nDefinitionDocs.propTypes = {\n  def: PropTypes.object.isRequired\n}\n\nfunction Definition({def, ...props}) {\n  return <React.Fragment>\n    <ArchiveTitle def={def} useName isDefinition {...props} />\n    <DefinitionDocs def={def} />\n  </React.Fragment>\n}\nDefinition.propTypes = {\n  def: PropTypes.object.isRequired\n}\n\nfunction DefinitionDetails({def, ...props}) {\n  const {api} = useApi()\n  const {raiseError} = useErrors()\n  const lane = useContext(laneContext)\n  const [usage, setUsage] = useState(null)\n  const [showUsage, setShowUsage] = useState(false)\n\n  const quantityPath = useMemo(() => {\n    const path = lane.path.split('/')\n    const index = path.indexOf('EntryArchive')\n    if (index >= 0) {\n      return path.slice(index + 1).join('.')\n    }\n    return null\n  }, [lane])\n\n  useEffect(() => {\n    if (showUsage) {\n      api.post('/entries/query', {\n        owner: 'visible',\n        query: {\n          'quantities:any': [quantityPath]\n        },\n        aggregations: {\n          program_names: {\n            terms: {\n              quantity: 'results.method.simulation.program_name',\n              pagination: {\n                page_size: 100 // make sure we get all codes\n              }\n            }\n          }\n        }\n      }).then(response => {\n        const aggData = response.aggregations.program_names.terms.data\n        setUsage(aggData)\n      }).catch(raiseError)\n    }\n  }, [api, raiseError, showUsage, quantityPath, setUsage])\n\n  return <React.Fragment>\n    {def.categories && def.categories.length > 0 && <Compartment title=\"Categories\">\n      {def.categories.map((categoryDef, index) => (\n        <Item key={index} itemKey={'_category:' + categoryDef.name}>\n          <Typography>{categoryDef.more?.label || categoryDef.name}</Typography>\n        </Item>\n      ))}\n    </Compartment>}\n    {/* {!lane.next && !def.extends_base_section && def.name !== 'EntryArchive' &&\n      <Compartment title=\"graph\">\n        <VicinityGraph def={def} key={def.name}/>\n      </Compartment>\n    } */}\n    {quantityPath &&\n      <Compartment title=\"usage\">\n        {!showUsage && <Button fullWidth variant=\"outlined\" onClick={() => setShowUsage(true)}>Show usage</Button>}\n        {showUsage && !usage && <Typography><i>loading ...</i></Typography>}\n        {usage && usage.length > 0 && (\n          <Histogram\n            data={usage.map(use => ({\n              key: use.value,\n              name: use.value,\n              value: use.count\n            }))}\n            initialScale={0.5}\n            title=\"Metadata use per code\"\n          />\n        )}\n        {usage && usage.length === 0 && (\n          <Typography color=\"error\"><i>This metadata is not used at all.</i></Typography>\n        )}\n      </Compartment>\n    }\n  </React.Fragment>\n}\nDefinitionDetails.propTypes = {\n  def: PropTypes.object.isRequired\n}\n\nconst definitionLabels = {\n  [PackageMDef]: 'package',\n  [SectionMDef]: 'section',\n  [QuantityMDef]: 'quantity',\n  [SubSectionMDef]: 'sub section',\n  [CategoryMDef]: 'category',\n  [AttributeMDef]: 'attribute'\n}\n\nexport function ArchiveTitle({def, property, isDefinition, data, kindLabel, useName, actions}) {\n  const color = isDefinition ? 'primary' : 'initial'\n  let label = definitionLabels[def.m_def]\n  if (def.extends_base_section) {\n    label += ' extension'\n  }\n  const title = isDefinition || useName ? def.name : getDisplayLabel(def)\n  return <Title\n    title={title}\n    tooltip={def._qualifiedName || def.name}\n    label={`${label}${isDefinition ? ' definition' : ''}`}\n    color={color}\n    definitionName={!isDefinition && def.name}\n    subSectionName={!isDefinition && property && property.m_def === 'nomad.metainfo.metainfo.SubSection' && property.name}\n    actions={actions ||\n      <SourceJsonDialogButton\n        buttonProps={{size: 'small'}}\n        tooltip={`Show ${(kindLabel + ' ') || ' '}data as JSON`}\n        title={`Underlying ${(kindLabel + ' ') || ' '}data as JSON`}\n        data={data || def}\n      />\n    }\n  />\n}\nArchiveTitle.propTypes = ({\n  def: PropTypes.object.isRequired,\n  property: PropTypes.object,\n  data: PropTypes.any,\n  isDefinition: PropTypes.bool,\n  kindLabel: PropTypes.string,\n  useName: PropTypes.bool,\n  actions: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ])\n})\n\nexport function DefinitionLabel({def, isDefinition, ...props}) {\n  let label = definitionLabels[def.m_def]\n  if (def.extends_base_section) {\n    label += ' extension'\n  }\n  return <Typography {...props}>\n    {label}{isDefinition ? ' definition' : ''}\n  </Typography>\n}\nDefinitionLabel.propTypes = ({\n  def: PropTypes.object.isRequired,\n  isDefinition: PropTypes.bool\n})\n\nconst Annotations = React.memo(function Annotations({def}) {\n  if (!def.m_annotations) {\n    return null\n  }\n\n  return (\n    <Compartment title=\"annotations\">\n      <ReactJson\n        name=\"m_annotations\"\n        src={def.m_annotations}\n        enableClipboard={false}\n        collapsed={2}\n        displayObjectSize={false}\n      />\n    </Compartment>\n  )\n})\nAnnotations.propTypes = {\n  def: PropTypes.object.isRequired\n}\n\nconst useVicinityGraphStyles = makeStyles(theme => ({\n  root: {\n    with: '100%',\n    minWidth: 300,\n    '& .links line': {\n      // stroke: '#000'\n      strokeWidth: 3\n    },\n    '& text': {\n      fontFamily: 'Titillium Web, sans',\n      fontSize: 12,\n      fontWeight: 'bold'\n    }\n  }\n}))\n\nconst linkColors = {\n  [QuantityMDef]: purple[500],\n  '_none': grey[700]\n}\nconst nodeColors = {\n  [QuantityMDef]: lime[500],\n  [SectionMDef]: blue[500],\n  [CategoryMDef]: teal[500]\n}\n\nexport function VicinityGraph({def}) {\n  const globalMetainfo = useGlobalMetainfo()\n\n  const graph = useMemo(() => {\n    const graph = vicinityGraph(def)\n    let x1 = Math.min(...graph.nodes.map(n => n.x)) - 32\n    const y1 = Math.min(...graph.nodes.map(n => n.y)) - 24\n    let x2 = Math.max(...graph.nodes.map(n => n.x)) + 32\n    const y2 = Math.max(...graph.nodes.map(n => n.y)) + 24\n    const w = Math.max(200, Math.abs(x2 - x1))\n    const px = w < 400 ? (400 - w) / 2 : 0\n    x1 -= px; x2 += px\n    graph.viewBox = `${x1} ${y1} ${x2 - x1} ${y2 - y1}`\n    graph.aspectRatio = Math.abs((x2 - x1) / (y2 - y1))\n\n    return graph\n  }, [def])\n\n  const classes = useVicinityGraphStyles()\n  const svgRef = useRef()\n  const history = useHistory()\n\n  useEffect(() => {\n    const svg = d3.select(svgRef.current)\n\n    const link = svg.select('.links')\n      .selectAll('line')\n      .data(graph.links)\n      .enter().append('line')\n      .attr('marker-end', d => `url(#arrowhead-${d.def.m_def || '_none'})`)\n      .attr('stroke', d => linkColors[d.def.m_def || '_none'])\n      .on('click', d => {\n        if (d.def.m_def === QuantityMDef) {\n          const path = globalMetainfo.path(d.def)\n          if (path) {\n            history.push(`/metainfo/${path}`)\n          }\n        }\n      })\n\n    const node = svg.select('.nodes')\n      .selectAll('g')\n      .data(graph.nodes)\n      .enter().append('g')\n\n    node.append('circle')\n      .attr('r', 10)\n      .attr('fill', d => nodeColors[d.def.m_def] || '#000')\n      .on('click', d => {\n        const path = globalMetainfo.path(d.def)\n        if (path) {\n          history.push(`/metainfo/${path}`)\n        }\n      })\n      .call(d3.drag()\n        .on('drag', d => {\n          d.x = d3.event.x\n          d.y = d3.event.y\n          ticked()\n        }))\n\n    node.append('text')\n      .text(d => d.def.more?.label || d.def.name)\n      .attr('text-anchor', 'middle')\n      .attr('y', d => ((d.i % 2) === 0) ? 20 : -14)\n\n    function ticked() {\n      link\n        .attr('x1', d => d.source.x)\n        .attr('y1', d => d.source.y)\n        .attr('x2', d => d.target.x)\n        .attr('y2', d => d.target.y)\n\n      node\n        .attr('transform', d => 'translate(' + d.x + ',' + d.y + ')')\n    }\n    ticked()\n  }, [graph, history, svgRef, globalMetainfo])\n\n  useLayoutEffect(() => {\n    svgRef.current.style.height = svgRef.current.clientWidth / graph.aspectRatio\n  }, [graph, svgRef])\n\n  return <svg\n    className={classes.root} ref={svgRef}\n    viewBox={graph.viewBox}\n  >\n    <g className='links' />\n    <g className='nodes' />\n    {Object.keys(linkColors).map(colorKey => {\n      const color = linkColors[colorKey]\n      return <marker\n        key={colorKey}\n        id={`arrowhead-${colorKey}`}\n        viewBox='-0 -5 10 10'\n        refX='21'\n        refY='0'\n        orient='auto'\n        markerWidth='3'\n        markerHeight='4'\n        xoverflow='visible'\n      >\n        <path d='M 0,-5 L 10 ,0 L 0,5' fill={color} stroke={color} />\n      </marker>\n    })}\n  </svg>\n}\nVicinityGraph.propTypes = ({\n  def: PropTypes.object.isRequired\n})\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { } from 'react'\nimport PropTypes from 'prop-types'\nimport { SectionTable } from '../Quantity'\nimport { useUnitContext } from '../units/UnitContext'\nimport { withErrorHandler } from '../ErrorHandler'\nimport NoData from './NoData'\nimport Placeholder from './Placeholder'\n\nexport const bandGapError = \"Could not load band gap.\"\n\n// Band gap quantities to show. Saved as const object to prevent re-renders\nconst columns = {\n  index: {label: 'Ch.', align: 'left'},\n  value: {label: 'Value'},\n  type: {label: 'Type', placeholder: '-'}\n}\n\n/**\n * Shows a summary of all band gap values, each displayed in a separate row of a\n * table.\n */\nconst BandGap = React.memo(({data, section, 'data-testid': testID}) => {\n  const {units} = useUnitContext()\n  const extendedColumns = {}\n  if (data && data[0].label) {\n    extendedColumns.label = {label: '', align: 'left'}\n  }\n\n  return data !== false\n    ? data\n      ? <SectionTable\n        horizontal\n        section={section || 'results.properties.electronic.band_structure_electronic.band_gap'}\n        quantities={{...extendedColumns, ...columns}}\n        data={{data: data}}\n        units={units}\n      />\n      : <Placeholder data-testid={`${testID}-placeholder`} />\n    : <NoData />\n})\n\nBandGap.propTypes = {\n  data: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.shape({\n      index: PropTypes.number,\n      value: PropTypes.number,\n      type: PropTypes.string,\n      label: PropTypes.string\n    })),\n    PropTypes.oneOf([false, undefined]) // False for NoData, undefined for Placeholder,\n  ]),\n  section: PropTypes.string,\n  'data-testid': PropTypes.string\n}\nBandGap.defaultProps = {\n  'data-testid': 'band-gap'\n}\n\nexport default withErrorHandler(bandGapError)(BandGap)\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useState, useEffect} from 'react'\nimport PropTypes from 'prop-types'\nimport { useTheme, makeStyles} from '@material-ui/core/styles'\nimport { Box } from '@material-ui/core'\nimport Plot from '../plotting/Plot'\nimport {\n    PropertyProvenanceItem,\n    PropertyProvenanceList\n} from '../entry/properties/PropertyCard'\nimport { withErrorHandler } from '../ErrorHandler'\nimport { mergeObjects, alphabet, resolveInternalRef } from '../../utils'\n\nexport const gfError = 'Could not load Greens functions.'\nconst types = {\n  greens_function_iw_im: {\n    xLabel: 'i\\u03c9<sub>n</sub>',\n    yLabel: 'Im G(i\\u03c9<sub>n</sub>)',\n    axis: 'matsubara_freq'\n  },\n  self_energy_iw_im: {\n    xLabel: 'i\\u03c9<sub>n</sub>',\n    yLabel: 'Im \\u03A3(i\\u03c9<sub>n</sub>)',\n    axis: 'matsubara_freq'\n  },\n  greens_function_tau_re: {\n    xLabel: '\\u03c4<sub>n</sub>',\n    yLabel: 'Re G(\\u03c4<sub>n</sub>)',\n    axis: 'tau'\n  },\n  greens_function_freq_im: {\n    xLabel: '\\u03c9',\n    yLabel: 'Im G(\\u03c9)',\n    axis: 'frequencies'\n  },\n  self_energy_freq_im: {\n    xLabel: '\\u03c9',\n    yLabel: 'Im \\u03A3(\\u03c9)',\n    axis: 'frequencies'\n  }\n}\n\nconst useStyles = makeStyles(theme => ({\n  plot: {height: '250px'}\n}))\n\n/**\n * Displays Greens functions data together with the provenance information.\n */\nconst GreensFunctions = React.memo(({\n  data,\n  provenance,\n  className,\n  'data-testid': testID,\n  ...other\n}) => {\n  const theme = useTheme()\n  const styles = useStyles()\n  const [finalData, setFinalData] = useState(\n    data || Object.fromEntries(Object.keys(types).map(type => [type, [data]]))\n  )\n\n  // Side effect that runs when the data that is displayed should change. By\n  // running all this heavy stuff as a side effect, the first render containing\n  // the placeholders etc. can be done as fast as possible.\n  useEffect(() => {\n    if (!data) {\n      setFinalData(Object.fromEntries(Object.keys(types).map(type => [type, [data]])))\n      return\n    }\n\n    const finalData = {}\n    for (const [key, plotArray] of Object.entries(data)) {\n      if (!plotArray) {\n        finalData[key] = [plotArray]\n        continue\n      }\n      const plots = plotArray.map(plot => {\n        const {plotData, legendTitle, legendWidth} = plotDegeneracy(plot.x, plot.y, provenance)\n\n        // Defining the plot\n        const layout = {\n          xaxis: {\n            fixedrange: false,\n            zeroline: true,\n            title: {\n              text: types[key].xLabel\n            }\n          },\n          yaxis: {\n            fixedrange: false,\n            zeroline: true,\n            title: {\n              text: types[key].yLabel\n            }\n          },\n          showlegend: true,\n          legend: {\n            x: 1,\n            y: 1,\n            title: {\n              text: legendTitle,\n              font: {\n                size: 12\n              }\n            },\n            xanchor: 'right',\n            itemwidth: legendWidth\n          }\n        }\n        return {\n          type: key,\n          plotData,\n          layout,\n          title: plot?.label || ''\n        }\n      })\n      finalData[key] = plots\n    }\n    setFinalData(finalData)\n  }, [data, provenance, theme])\n\n  return <Box display=\"flex\" flexDirection=\"column\" height=\"100%\" width=\"100%\">\n    {Object.entries(finalData).map(([key, plotArray]) => {\n      if (!plotArray) plotArray = [plotArray]\n      return plotArray.map((value, index) =>\n        <Plot\n          key={`${key}-${index}`}\n          data={value === false ? false : value?.plotData}\n          layout={value?.layout}\n          floatTitle={value?.title}\n          data-testid={`${testID}-${key}`}\n          className={styles.plot}\n          {...other}\n        />\n      )\n    })}\n    {(provenance && !Array.isArray(provenance)) && <Box flex=\"0 0 auto\">\n      <PropertyProvenanceList xs={12}>\n        <PropertyProvenanceItem\n          title=\"DMFT\"\n          data={provenance}\n          path={\"results.method.simulation.dmft\"}\n        />\n      </PropertyProvenanceList>\n    </Box>}\n  </Box>\n})\n\nconst plotType = PropTypes.oneOfType([PropTypes.arrayOf(PropTypes.object), PropTypes.oneOf([false, undefined])])\nGreensFunctions.propTypes = {\n  data: PropTypes.shape({\n    greens_function_iw_im: plotType, // Real part of Green's functions in matsubara_freq\n    self_energy_iw_im: plotType, // Imaginary part of self-energy in matsubara_freq\n    greens_function_tau_re: plotType, // Real part of Green's functions in tau\n    greens_function_freq_im: plotType, // Real part of Green's functions in frequencies\n    self_energy_freq_im: plotType // Imaginary part of self-energy in frequencies\n  }),\n  provenance: PropTypes.object, // DMFT provenance\n  className: PropTypes.string,\n  'data-testid': PropTypes.string\n}\nGreensFunctions.defaultProps = {\n  'data-testid': 'gfs'\n}\n\n/**\n * Given index and archive, resolves the data for plotting Green's functions.\n */\nexport function resolveGreensFunctions(properties, archive, pattern) {\n  // Return undefined if property not available\n  if (!properties.has('greens_functions_electronic')) return false\n\n  // With the current metainfo for Green's functions, we cannot tell just with\n  // the index data what type of plots will be available. Because of this, we\n  // don't show anything until the archive is loaded.\n  // TODO: This could be fixed by refactoring the greens functions data so that\n  // each section would contain an indexed list of what plots it contains.\n  if (!archive) return false\n\n  // Resolve the final data once archive is here\n  let gfReferences = archive?.results?.properties?.electronic?.greens_functions_electronic || []\n  if (!Array.isArray(gfReferences)) gfReferences = [gfReferences]\n  const greensFunctions = []\n  for (const reference of gfReferences) {\n    // Resolving Green's function quantities in tau\n    const gfTau = {}\n    const matchTau = reference.tau ? reference.tau.match(pattern) : undefined\n    const pathTau = matchTau ? matchTau[2] : reference.tau\n    const matchGreensFunctionTau = reference.greens_function_tau ? reference.greens_function_tau.match(pattern) : undefined\n    const pathGreensFunctionTau = matchGreensFunctionTau ? matchGreensFunctionTau[2] : reference.greens_function_tau\n    const sourceArchiveTau = matchTau\n      ? (archive.m_ref_archives[matchTau[1]] || archive.m_ref_archives[reference.tau.split('#')[0]])\n      : archive\n    if (sourceArchiveTau && pathTau) {\n      // @TODO ask why I have to flatten the axes (tau, matsubara_freq, frequencies) arrays\n      gfTau.tau = resolveInternalRef(pathTau, sourceArchiveTau).flat()\n      const greensFunctionTau = resolveInternalRef(pathGreensFunctionTau, sourceArchiveTau)\n      gfTau.greens_function_tau_re = greensFunctionTau ? greensFunctionTau.re : undefined\n    }\n\n    // Resolving Green's function quantities in Matsubara frequencies\n    const gfMatsFreq = {}\n    const matchMatsFreq = reference.matsubara_freq ? reference.matsubara_freq.match(pattern) : undefined\n    const pathMatsFreq = matchMatsFreq ? matchMatsFreq[2] : reference.matsubara_freq\n    const matchGreensFunctionMatsFreq = reference.greens_function_iw ? reference.greens_function_iw.match(pattern) : undefined\n    const pathGreensFunctionMatsFreq = matchGreensFunctionMatsFreq ? matchGreensFunctionMatsFreq[2] : reference.greens_function_iw\n    const matchSelfEnergyMatsFreq = reference.self_energy_iw ? reference.self_energy_iw.match(pattern) : undefined\n    const pathSelfEnergyMatsFreq = matchSelfEnergyMatsFreq ? matchSelfEnergyMatsFreq[2] : reference.self_energy_iw\n    const sourceArchiveMatsFreq = matchMatsFreq\n      ? (archive.m_ref_archives[matchMatsFreq[1]] || archive.m_ref_archives[reference.matsubara_freq.split('#')[0]])\n      : archive\n    if (sourceArchiveMatsFreq && pathMatsFreq) {\n      gfMatsFreq.matsubara_freq = resolveInternalRef(pathMatsFreq, sourceArchiveMatsFreq).flat()\n      const greensFunctionMatsFreq = resolveInternalRef(pathGreensFunctionMatsFreq, sourceArchiveMatsFreq)\n      gfMatsFreq.greens_function_iw_im = greensFunctionMatsFreq ? greensFunctionMatsFreq.im : undefined\n      const selfEnergyMatsFreq = resolveInternalRef(pathSelfEnergyMatsFreq, sourceArchiveMatsFreq)\n      gfMatsFreq.self_energy_iw_im = selfEnergyMatsFreq ? selfEnergyMatsFreq.im : undefined\n    }\n    const gfImAxis = mergeObjects(gfTau, gfMatsFreq)\n\n    // Resolving Green's function quantities in Matsubara frequencies\n    const gfFreq = {}\n    const matchFreq = reference.frequencies ? reference.frequencies.match(pattern) : undefined\n    const pathFreq = matchFreq ? matchFreq[2] : reference.frequencies\n    const matchGreensFunctionFreq = reference.greens_function_freq ? reference.greens_function_freq.match(pattern) : undefined\n    const pathGreensFunctionFreq = matchGreensFunctionFreq ? matchGreensFunctionFreq[2] : reference.greens_function_freq\n    const matchSelfEnergyFreq = reference.self_energy_freq ? reference.self_energy_freq.match(pattern) : undefined\n    const pathSelfEnergyFreq = matchSelfEnergyFreq ? matchSelfEnergyFreq[2] : reference.self_energy_freq\n    const sourceArchiveFreq = matchFreq\n      ? (archive.m_ref_archives[matchFreq[1]] || archive.m_ref_archives[reference.frequencies.split('#')[0]])\n      : archive\n    if (sourceArchiveFreq && pathFreq) {\n      gfFreq.frequencies = resolveInternalRef(pathFreq, sourceArchiveFreq).flat()\n      const greensFunctionFreq = resolveInternalRef(pathGreensFunctionFreq, sourceArchiveFreq)\n      gfFreq.greens_function_freq_im = greensFunctionFreq ? greensFunctionFreq.im : undefined\n      const selfEnergyFreq = resolveInternalRef(pathSelfEnergyFreq, sourceArchiveFreq)\n      gfFreq.self_energy_freq_im = selfEnergyFreq ? selfEnergyFreq.im : undefined\n    }\n\n    // Merging all resolved data into gf.\n    const gf = mergeObjects(gfImAxis, gfFreq)\n    gf.type = reference.type || undefined\n    gf.label = reference.label || undefined\n    gf.m_path = `${archive?.metadata?.entry_id}/data/results/properties/electronic/greens_functions_electronic`\n    if (Object.keys(gf).length !== 0 && gf.type !== 'impurity') greensFunctions.push(gf)\n  }\n\n  // Store all data under one dictionary for plotting\n  const data = {}\n  for (const gf of greensFunctions) {\n    for (const [type, value] of Object.entries(types)) {\n      if (gf[type] && gf[value.axis]) {\n        const oldData = data[type]\n        if (!oldData) {\n          data[type] = []\n        }\n        data[type].push({x: gf[value.axis], y: gf[type]})\n      }\n    }\n  }\n  return data\n}\n\n/**\n * Plots data in atom, orbital and spin space, taking into account degeneracies for the\n * labeling and titles.\n */\nfunction plotDegeneracy(axisData, data, provenance) {\n  const oneSpecies = data.length === 1\n  const oneSpin = provenance.magnetic_state === 'paramagnetic'\n  const atomLabels = alphabet\n  let legendTitle = ''\n  let legendWidth = 30\n  const plotData = []\n  for (let iAtom = 0; iAtom < data.length; ++iAtom) {\n    const atomData = data[iAtom]\n    if (oneSpin) { // We only show one spin data\n      const spinData = atomData[0]\n      for (let iOrb = 0; iOrb < spinData.length; ++iOrb) {\n        plotData.push({\n          x: axisData,\n          y: spinData[iOrb],\n          name: `${oneSpecies ? '' : `${atomLabels[iAtom]}`}d<sub>${iOrb}</sub>`,\n          type: 'scatter'\n        })\n      }\n      legendTitle = `${oneSpecies ? '<b>[orbital]</b>' : '<b>[atom][orbital]</b>'}`\n      legendWidth = oneSpecies ? 30 : 40\n    } else {\n      for (let iSpin = 0; iSpin < atomData.length; ++iSpin) {\n        const spinData = atomData[iSpin]\n        for (let iOrb = 0; iOrb < spinData.length; ++iOrb) {\n          plotData.push({\n            x: axisData,\n            y: spinData[iOrb],\n            name: `${oneSpecies ? '' : `${atomLabels[iAtom]}`}d<sub>${iOrb}</sub>${oneSpin ? '' : iSpin ? '+' : '-'}`,\n            type: 'scatter'\n          })\n        }\n      }\n      legendTitle = `${oneSpecies ? '<b>[orbital][spin]</b>' : '<b>[atom][orbital][spin]</b>'}`\n      legendWidth = oneSpecies ? 40 : 60\n    }\n  }\n  return {plotData, legendTitle, legendWidth}\n}\n\nexport default withErrorHandler(gfError)(GreensFunctions)\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useCallback, useMemo } from 'react'\nimport { Subject } from 'rxjs'\nimport PropTypes from 'prop-types'\nimport { Quantity } from '../units/Quantity'\nimport { useUnitContext } from '../units/UnitContext'\nimport DOS from './DOS'\nimport BandStructure from './BandStructure'\nimport BrillouinZone from './BrillouinZone'\nimport BandGap from './BandGap'\nimport GreensFunctions from './GreensFunctions'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { electronicRange } from '../../config'\nimport { PropertyGrid, PropertyItem } from '../entry/properties/PropertyCard'\n\n// Styles\nconst useStyles = makeStyles((theme) => {\n  return {\n    nodata: {\n      top: theme.spacing(0.7),\n      bottom: '3.55rem'\n    },\n    placeholder: {\n      top: theme.spacing(0.7),\n      bottom: theme.spacing(2)\n    }\n  }\n})\n\nconst ElectronicProperties = React.memo(({\n  bs,\n  dos,\n  brillouin_zone,\n  band_gap,\n  gf,\n  index,\n  classes\n}) => {\n  // We resolve the DMFT methodology from results.method\n  const dmftprovenance = index?.results?.method?.simulation?.dmft || []\n\n  const {units} = useUnitContext()\n  const range = useMemo(() => new Quantity(electronicRange, 'electron_volt').toSystem(units).value(), [units])\n  const bsLayout = useMemo(() => ({yaxis: {autorange: false, range: range}}), [range])\n  const dosLayout = useMemo(() => ({yaxis: {autorange: false, range: range}}), [range])\n\n  // RxJS subject for efficiently propagating y axis changes between DOS and BS\n  const bsYSubject = useMemo(() => new Subject(), [])\n  const dosYSubject = useMemo(() => new Subject(), [])\n\n  // Styles\n  const styles = useStyles({classes: classes})\n\n  // Synchronize panning between BS/DOS plots\n  const handleBSRelayouting = useCallback((event) => {\n    const update = {yaxis: {range: [event['yaxis.range[0]'], event['yaxis.range[1]']]}}\n    bsYSubject.next(update)\n  }, [bsYSubject])\n  const handleDOSRelayouting = useCallback((event) => {\n    const update = {yaxis: {range: [event['yaxis.range[0]'], event['yaxis.range[1]']]}}\n    dosYSubject.next(update)\n  }, [dosYSubject])\n\n  // Custom layout if only band gaps are available\n  if (bs === false && dos === false && brillouin_zone === false && gf === false) {\n    return <PropertyGrid>\n      <PropertyItem title=\"Band gaps\" xs={12} height=\"auto\">\n        <BandGap data={band_gap}/>\n      </PropertyItem>\n    </PropertyGrid>\n  // Custom layout if only DOS is available\n  } else if (bs === false && band_gap === false && brillouin_zone === false && gf === false) {\n    return <PropertyGrid>\n      <PropertyItem title=\"Band structure\" xs={8}>\n        <BandStructure\n          data={false}\n          layout={bsLayout}\n          units={units}\n          onRelayouting={handleBSRelayouting}\n          onReset={() => { bsYSubject.next({yaxis: {range: range}}) }}\n          layoutSubject={dosYSubject}\n          data-testid=\"bs-electronic\"\n        />\n      </PropertyItem>\n      <PropertyItem title=\"Density of states\" xs={4}>\n        <DOS\n          data={dos}\n          layout={dosLayout}\n          placeHolderStyle={styles.placeholder}\n          noDataStyle={styles.nodata}\n          onRelayouting={handleDOSRelayouting}\n          onReset={() => { dosYSubject.next({yaxis: {range: range}}) }}\n          units={units}\n          layoutSubject={bsYSubject}\n          data-testid=\"dos-electronic\"\n        />\n      </PropertyItem>\n    </PropertyGrid>\n  // Custom layout if only Greens functions are available\n  } else if (bs === false && dos === false && band_gap === false && brillouin_zone === false) {\n    return <PropertyGrid>\n      <PropertyItem title=\"Green's functions\" xs={12} height='auto'>\n        <GreensFunctions\n          data={gf}\n          provenance={dmftprovenance}\n        />\n      </PropertyItem>\n    </PropertyGrid>\n  // Layout when all properties can be present\n  } else {\n    return <PropertyGrid>\n      <PropertyItem title=\"Band structure\" xs={8}>\n        <BandStructure\n          data={bs}\n          layout={bsLayout}\n          units={units}\n          onRelayouting={handleBSRelayouting}\n          onReset={() => { bsYSubject.next({yaxis: {range: range}}) }}\n          layoutSubject={dosYSubject}\n          data-testid=\"bs-electronic\"\n        />\n      </PropertyItem>\n      <PropertyItem title=\"Density of states\" xs={4}>\n        <DOS\n          data={dos}\n          layout={dosLayout}\n          placeHolderStyle={styles.placeholder}\n          noDataStyle={styles.nodata}\n          onRelayouting={handleDOSRelayouting}\n          onReset={() => { dosYSubject.next({yaxis: {range: range}}) }}\n          units={units}\n          layoutSubject={bsYSubject}\n          data-testid=\"dos-electronic\"\n        />\n      </PropertyItem>\n      <PropertyItem title=\"Brillouin zone\" xs={8}>\n        <BrillouinZone\n          data={brillouin_zone}\n          data-testid=\"bz-electronic\"\n        />\n      </PropertyItem>\n      <PropertyItem title=\"Band gaps\" xs={4}>\n        <BandGap data={band_gap}/>\n      </PropertyItem>\n      {gf !== false &&\n        <PropertyItem title=\"Green's functions\" xs={12} height=\"auto\">\n          <GreensFunctions\n            data={gf}\n            provenance={dmftprovenance}\n          />\n        </PropertyItem>\n      }\n    </PropertyGrid>\n  }\n})\n\nElectronicProperties.propTypes = {\n  dos: PropTypes.any,\n  bs: PropTypes.any,\n  brillouin_zone: PropTypes.any,\n  band_gap: PropTypes.any,\n  gf: PropTypes.any,\n  classes: PropTypes.object,\n  index: PropTypes.object\n}\n\nexport default ElectronicProperties\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { resolveInternalRef } from '../../../utils'\nimport { PropertyCard } from './PropertyCard'\nimport ElectronicProperties from '../../visualization/ElectronicProperties'\nimport { resolveGreensFunctions } from '../../visualization/GreensFunctions'\nimport { resolveDosNew, resolveDosOld } from '../../visualization/DOS'\n\nconst ElectronicPropertiesCard = React.memo(({index, properties, archive}) => {\n  // Find out which properties are present\n  const hasDosNew = properties.has('dos_electronic_new')\n  const hasDosOld = properties.has('dos_electronic')\n  const hasBs = properties.has('band_structure_electronic')\n  const hasBandGap = properties.has('electronic.band_structure_electronic.band_gap')\n  const hasGf = properties.has('greens_functions_electronic')\n\n  // Do not show the card if none of the properties are available\n  if (!hasDosNew && !hasDosOld && !hasBs && !hasBandGap && !hasGf) return null\n\n  let bsReferences = archive?.results?.properties?.electronic?.band_structure_electronic || []\n  const pattern = '\\\\.\\\\./(?:entries|upload/archive|uploads.+?archive)/(.+?)(?:/archive#|#)(.+)'\n  if (!Array.isArray(bsReferences)) bsReferences = [bsReferences]\n\n  // Resolve the new DOS schema data. For older entries, resolve the old DOS schema data\n  let dos = (hasDosOld || hasDosNew) ? undefined : false\n  if (archive) {\n    if (hasDosNew) dos = resolveDosNew(properties, archive, pattern)\n    if (!hasDosNew && hasDosOld) dos = resolveDosOld(properties, archive, pattern)\n  }\n\n  // Resolve band structure data\n  let bs = hasBs ? undefined : false\n  let bz = hasBs ? undefined : false\n  if (archive) {\n    bs = []\n    try {\n      for (const reference of bsReferences) {\n        const d = {}\n        const match = reference.reciprocal_cell?.match(pattern)\n        const path = match ? match[2] : reference.reciprocal_cell\n        const segmentPath = match ? reference.segment.map(ref => ref.match(pattern)[2]) : reference.segment\n        const sourceArchive = match ? (archive.m_ref_archives[match[1]] || archive.m_ref_archives[reference.reciprocal_cell.split('#')[0]]) : archive\n        d.segment = sourceArchive ? resolveInternalRef(segmentPath, sourceArchive) : null\n        d.name = reference.label\n        d.m_path = `${archive?.metadata?.entry_id}/data/results/properties/electronic/band_structure_electronic`\n        if (reference.band_gap) {\n          d.energy_highest_occupied = Math.max(...reference.band_gap.map(x => x.energy_highest_occupied))\n          d.band_gap = reference.band_gap\n        }\n        if (d.segment) bs.push(d)\n        const reciprocal_cell = sourceArchive ? resolveInternalRef(path, sourceArchive) : null\n        if (reciprocal_cell) {\n          bz = {\n            reciprocal_cell: reciprocal_cell,\n            segment: d.segment\n          }\n        }\n      }\n    } catch (e) {\n    }\n    bs = bs.length === 0 ? false : bs\n    bz = bz || false\n  }\n\n  // Resolve band gap data. TODO: The API is not returning band gap\n  // information when using electronic: 'include-resolved' and there is\n  // nothing to resolve. This is why we alternatively also look for the band\n  // gap data in the index data.\n  let bg\n  if (hasBandGap) {\n    bg = []\n    function addBandGaps(sections) {\n      for (const section of sections || []) {\n        if (!section.band_gap) continue\n        bg.push(...section.band_gap)\n      }\n    }\n    addBandGaps(bsReferences)\n    if (bg.length === 0) {\n      let bsReferencesIndex = index?.results?.properties?.electronic?.band_structure_electronic || []\n      if (!Array.isArray(bsReferencesIndex)) bsReferencesIndex = [bsReferencesIndex]\n      addBandGaps(bsReferencesIndex)\n    }\n    bg = bg.length === 0 ? false : bg\n  } else {\n    bg = false\n  }\n\n  // Resolve Greens functions data\n  const gf = resolveGreensFunctions(properties, archive, pattern)\n\n  return <PropertyCard title=\"Electronic properties\">\n    <ElectronicProperties\n      bs={bs}\n      dos={dos}\n      brillouin_zone={bz}\n      band_gap={bg}\n      gf={gf}\n      index={index}\n    />\n  </PropertyCard>\n})\n\nElectronicPropertiesCard.propTypes = {\n  index: PropTypes.object.isRequired,\n  properties: PropTypes.object.isRequired,\n  archive: PropTypes.object\n}\n\nexport default ElectronicPropertiesCard\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { } from 'react'\nimport PropTypes from 'prop-types'\nimport { QuantityTable, QuantityRow, QuantityCell } from '../Quantity'\nimport NoData from './NoData'\nimport Placeholder from './Placeholder'\n\n/**\n * Shows a summary of solar cell properties.\n */\nconst SolarCell = React.memo(({data}) => {\n  const prefix = 'results.properties.optoelectronic.solar_cell'\n  return data !== false\n    ? data\n      ? <QuantityTable>\n        <QuantityRow>\n          <QuantityCell value={data?.efficiency} quantity={`${prefix}.efficiency`}/>\n          <QuantityCell value={data?.fill_factor} quantity={`${prefix}.fill_factor`}/>\n          <QuantityCell value={data?.open_circuit_voltage} quantity={`${prefix}.open_circuit_voltage`}/>\n          <QuantityCell value={data?.short_circuit_current_density} quantity={`${prefix}.short_circuit_current_density`}/>\n        </QuantityRow>\n        <QuantityRow>\n          <QuantityCell value={data?.illumination_intensity} quantity={`${prefix}.illumination_intensity`}/>\n          <QuantityCell value={data?.device_area} quantity={`${prefix}.device_area`}/>\n          <QuantityCell value={data?.device_architecture} colSpan={2} quantity={`${prefix}.device_architecture`}/>\n        </QuantityRow>\n        <QuantityRow>\n          <QuantityCell value={data?.absorber} colSpan={2} quantity={`${prefix}.absorber`}/>\n          <QuantityCell value={data?.absorber_fabrication} colSpan={2} quantity={`${prefix}.absorber_fabrication`}/>\n        </QuantityRow>\n        <QuantityRow>\n          <QuantityCell value={data?.device_stack} colSpan={4} maxWidth=\"none\" quantity={`${prefix}.device_stack`}/>\n        </QuantityRow>\n      </QuantityTable>\n      : <Placeholder />\n    : <NoData />\n})\n\nSolarCell.propTypes = {\n  data: PropTypes.any\n}\n\nexport default SolarCell\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { PropertyGrid, PropertyItem } from '../entry/properties/PropertyCard'\nimport SolarCell from './SolarCell'\n\n// Displays the set of optoelectronic properties.\nconst OptoelectronicProperties = React.memo(({\n  bandGap,\n  solarCell\n}) => {\n  return <PropertyGrid>\n    <PropertyItem title=\"Solar cell\" xs={12} height=\"auto\" minHeight=\"100px\">\n      <SolarCell data={solarCell} />\n    </PropertyItem>\n  </PropertyGrid>\n})\n\nOptoelectronicProperties.propTypes = {\n  bandGap: PropTypes.any, // Set to false if not available, set to other falsy value to show placeholder.\n  solarCell: PropTypes.any // Set to false if not available, set to other falsy value to show placeholder.\n}\n\nexport default OptoelectronicProperties\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { PropertyCard } from './PropertyCard'\nimport OptoelectronicProperties from '../../visualization/OptoelectronicProperties'\n\nconst SolarCellPropertiesCard = React.memo(({index, properties, archive}) => {\n  // Find out which properties are present\n  const hasSc = properties.has('solar_cell')\n\n  // Do not show the card if none of the properties are available\n  if (!hasSc) {\n    return null\n  }\n\n  // Resolve solar cell data\n  const solarCell = index?.results?.properties?.optoelectronic?.solar_cell || false\n\n  return <PropertyCard title=\"Solar Cell Properties\">\n    <OptoelectronicProperties solarCell={solarCell}/>\n  </PropertyCard>\n})\n\nSolarCellPropertiesCard.propTypes = {\n  index: PropTypes.object.isRequired,\n  properties: PropTypes.object.isRequired,\n  archive: PropTypes.object\n}\n\nexport default SolarCellPropertiesCard\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useState,\n  useRef,\n  useMemo\n} from 'react'\nimport { useResizeDetector } from 'react-resize-detector'\nimport { makeStyles } from '@material-ui/core'\nimport PropTypes from 'prop-types'\nimport { isNil, isEqual, range } from 'lodash'\nimport { Stage, Vector3 } from 'ngl'\nimport StructureBase from './StructureBase'\nimport { wrapModes } from '../buttons/DownloadSystemButton'\nimport * as THREE from 'three'\nimport { withErrorHandler } from '../ErrorHandler'\nimport { useAsyncError } from '../../hooks'\nimport { useApi } from '../api'\nimport { download, parseNomadUrl } from '../../utils'\n\nconst useStyles = makeStyles((theme) => ({\n  canvas: {\n    width: '100%',\n    height: '100%'\n  },\n  canvasParent: {\n    height: '100%',\n    width: '100%',\n    boxSizing: 'border-box'\n  }\n}))\nconst StructureNGL = React.memo(({\n  topologyMap,\n  entryId,\n  selected,\n  sizeLimit,\n  onFullscreen,\n  ...rest\n}) => {\n  const styles = useStyles()\n  const {height, width, ref: canvasParentRef} = useResizeDetector()\n  const [species, setSpecies] = useState()\n  const [loading, setLoading] = useState(true)\n  const [prompt, setPrompt] = useState()\n  const [accepted, setAccepted] = useState(false)\n  const [noData, setNoData] = useState(false)\n  const [ready, setReady] = useState(false)\n  const [showBonds, setShowBonds] = useState(false)\n  const [showCell, setShowCell] = useState(true)\n  const [showLatticeConstants, setShowLatticeConstants] = useState(true)\n  const [disableShowLatticeConstants, setDisableShowLatticeContants] = useState(true)\n  const [wrapMode, setWrapMode] = useState(wrapModes.wrap.key)\n  const [disableWrapMode, setDisableWrapMode] = useState(false)\n  const [disableShowCell, setDisableShowCell] = useState(false)\n  const [disableShowBonds, setDisableShowBonds] = useState(false)\n  const stageRef = useRef()\n  const viewerRef = useRef()\n  const componentsRef = useRef({})\n  const componentRef = useRef()\n  const canvasRef = useRef()\n  const readyRef = useRef(true)\n  const alignmentRef = useRef()\n  const rotationsRef = useRef()\n  const representationMap = useRef({})\n  const representationRef = useRef()\n  const selectionRef = useRef()\n  const { api } = useApi()\n  const asyncError = useAsyncError()\n  const {entryId: newEntryId, path} = getSystemAPIQuery(selected, entryId, topologyMap)\n  const system = topologyMap?.[selected]\n  const nAtomsAccepted = useRef(0)\n\n  // Fetch the number of atoms\n  const nAtoms = useMemo(() => {\n    const nAtoms = topologyMap?.[selected]?.n_atoms\n    if (nAtoms > 500) {\n      setShowBonds(false)\n      setDisableShowBonds(true)\n    }\n    if (nAtoms > sizeLimit && nAtoms > nAtomsAccepted.current) {\n      setPrompt(\n        `Visualization is by default disabled for systems with more than ${sizeLimit} ` +\n        `atoms. Do you wish to enable visualization for this system with ${nAtoms} atoms?`\n        )\n      setAccepted(false)\n    } else {\n      setPrompt()\n      setAccepted(true)\n    }\n    return nAtoms\n  }, [sizeLimit, topologyMap, selected])\n\n  // Updated the list of the species for the currently shown system\n  useEffect(() => {\n    const elements = system?.elements\n    let species\n    if (elements) {\n      try {\n        species = elements.map(symbol => {\n          const symbolUpperCase = symbol.toUpperCase()\n          const atomicNumber = atomicNumbers[symbolUpperCase]\n          const color = elementColors[symbolUpperCase]\n          return {\n            label: symbol,\n            color: color ? `#${color.toString(16).padStart(6, 0)}` : '#ff1493',\n            radius: vdwRadii[atomicNumber] || 0.1,\n            atomicNumber: atomicNumber || 0\n          }\n        })\n      } catch {\n      }\n    }\n    setSpecies(species)\n  }, [system])\n\n  // Forces a three.js render\n  const render = useCallback(() => {\n    viewerRef.current.render()\n  }, [])\n\n  // Toggles bond visiblity on all representations\n  const handleAccept = useCallback(() => {\n    nAtomsAccepted.current = nAtoms\n    setAccepted(true)\n    setPrompt()\n  }, [nAtoms])\n\n  // Toggles bond visiblity on all representations\n  const handleShowBonds = useCallback((value) => {\n    setShowBonds(value)\n    for (const repr of Object.values(representationMap.current)) {\n      repr.bonds.setVisibility(value)\n    }\n  }, [])\n\n  // Toggles cell visibility on all components\n  const handleShowCell = useCallback((value, updateState) => {\n    if (updateState) setShowCell(value)\n    for (const component of Object.values(componentsRef.current)) {\n      const unitCell = component.unitCell\n      if (unitCell) unitCell.visible = value\n    }\n    render()\n  }, [render])\n\n  // Toggles latticeConstant visibility on all components\n  const handleShowLatticeConstants = useCallback((value, updateState) => {\n    if (updateState) setShowLatticeConstants(value)\n    for (const component of Object.values(componentsRef.current)) {\n      const latticeConstants = component.latticeConstants\n      if (latticeConstants) latticeConstants.visible = value\n    }\n    render()\n  }, [render])\n\n  // Toggles position wrapping on all components\n  const handleWrapModeChange = useCallback((event) => {\n    setWrapMode(event.target.value)\n    representationRef.current.wrapMode = event.target.value\n    wrapRepresentation(componentRef.current, representationRef.current)\n    componentRef.current.autoView(selectionRef.current)\n  }, [])\n\n  /**\n   * Apply the given alignment and rotation to the component.\n   *\n   * @param {*} alignment The alignment to apply.\n   * @param {THREE.Euler} rotation The rotation to apply.\n   * @param {Vector3[]} basis The basis vectors.\n   * @param {*} component The component to which the view is applied to.\n   */\n  const view = useCallback(() => {\n      const rotations = rotationsRef.current\n      const alignment = alignmentRef.current\n      const component = componentRef.current\n      const basis = component.basis\n\n      // Reset the control orientation\n      component.stage.viewerControls.orient(new THREE.Matrix4())\n\n      // Get quaternion that aligns the lattice vectors\n      const quaternion = basis\n        ? getAlignment(alignment, {a: basis[0], b: basis[1], c: basis[2]})\n        : new THREE.Quaternion()\n\n      // Apply additional rotations to quaternion\n      for (const rotation of rotations) {\n        const quaternionRotate = new THREE.Quaternion()\n        quaternionRotate.setFromEuler(new THREE.Euler(...rotation.map(r => -r / 180 * Math.PI)))\n        quaternion.premultiply(quaternionRotate)\n      }\n\n      component.setRotation(quaternion)\n  }, [])\n\n  // Resets the zoom and alignment\n  const handleReset = useCallback(() => {\n    view()\n    componentRef.current.autoView(selectionRef.current)\n    // Autoview does not work nicely for single atoms: here we zoom back manually\n    if (representationRef?.current?.indices?.length === 1) {\n      componentRef.current.stage.viewerControls.zoom(-35)\n    }\n  }, [view])\n\n  // Resizes the canvas to fit current parent\n  const handleResize = useCallback((width, height) => {\n      if (!componentRef.current) return\n      canvasRef.current.style.width = `${width}px`\n      canvasRef.current.style.height = `${height}px`\n      stageRef.current.handleResize()\n      componentRef.current.autoView(selectionRef.current)\n  }, [])\n\n  // Whenever the canvas parent size changes, resize the WebGL canvas.\n  useLayoutEffect(() => {\n    handleResize(width, height)\n  }, [width, height, handleResize])\n\n  const handleFullscreen = useCallback(() => {\n    onFullscreen && onFullscreen()\n  }, [onFullscreen])\n\n  const handleTakeScreenshot = useCallback(async (name) => {\n    if (!stageRef.current) return\n    const imgData = await stageRef.current.makeImage()\n    try {\n      download(name + \".png\", imgData)\n    } catch (e) {\n    }\n  }, [])\n\n  // Initialize the viewer\n  useEffect(() => {\n    const drawDistance = 1000\n    const stage = new Stage(\n      canvasRef.current,\n      {\n        backgroundColor: \"white\",\n        cameraType: \"orthographic\",\n        clipNear: 0,\n        clipFar: drawDistance,\n        clipDist: 0,\n        zoomSpeed: 5,\n        fogNear: 0,\n        fogFar: drawDistance\n      }\n    )\n    stageRef.current = stage\n    viewerRef.current = stage.viewer\n  }, [])\n\n  /**\n   * Used to asynchronously load a new component to the NGL viewer. Since\n   * loading the structure is a long-taking operation, running this function\n   * later in the event queue allows the component to perform state updates\n   * (e.g. loading placeholder) while the viewer is loading.\n   */\n  const loadComponent = useCallback(async (system, entryId, path, componentKey, topologyMap) => {\n    // Load the structure if not already cached\n    const format = 'pdb'\n    let component = componentsRef.current[componentKey]\n    let root\n    if (!component) {\n      const systemResponse = await api.get(\n        `systems/${entryId}`,\n        {path: path, format},\n        {responseType: 'blob'}\n      )\n\n      // PDB files (or any other file formats supported by NGL) cannot contain\n      // both the full lattice vectors and the PBC. These are, however, needed\n      // for the proper visualization of the system. To work around this, they\n      // are stored as a REMARK 285 and read here.\n      const header = await systemResponse.slice([0], [280]).text()\n      let pbc = [true, true, true]\n      let a, b, c\n      const regexFloat = /[+-]?\\d+(\\.\\d+)?/g\n      for (const value of header.split('\\n')) {\n        const aPrefix = 'REMARK 285  A:'\n        const bPrefix = 'REMARK 285  B:'\n        const cPrefix = 'REMARK 285  C:'\n        const pbcPrefix = 'REMARK 285 PBC'\n        if (value.startsWith(aPrefix)) {\n          a = value.slice(aPrefix.length).match(regexFloat).map((v) => parseFloat(v))\n        } else if (value.startsWith(bPrefix)) {\n          b = value.slice(bPrefix.length).match(regexFloat).map((v) => parseFloat(v))\n        } else if (value.startsWith(cPrefix)) {\n          c = value.slice(cPrefix.length).match(regexFloat).map((v) => parseFloat(v))\n        } else if (value.startsWith(pbcPrefix)) {\n          const regex = /TRUE|FALSE/g\n          pbc = value.match(regex)?.map((v) => v === 'TRUE')\n        }\n      }\n\n      // Load file\n      component = await stageRef.current.loadFile(\n        systemResponse,\n        {ext: format, defaultRepresentation: false}\n      )\n\n      // Find the 'root' system for the selected item. The root system contains\n      // information about the cell and periodic boundary conditions.\n      function getRoot(top) {\n        return ((top.atoms_ref || top.atoms) && isNil(top.indices))\n          ? top\n          : getRoot(topologyMap[top.parent_system])\n      }\n      root = getRoot(system)\n\n      // Recursively add a new representation for each child that does not have\n      // it's own component\n      function addRepresentation(top) {\n        const structuralType = top.structural_type\n        const isMonomer = structuralType === 'monomer'\n        const isMolecule = structuralType === 'molecule'\n        const indices = top.indices\n          ? ((isMolecule || isMonomer)\n            ? top.indices[0]\n            : top.indices).flat()\n          : range(top.n_atoms)\n        const sele = top.indices\n          ? `@${indices.join(',')}`\n          : 'all'\n\n        // Add representation for the bonds\n        const bondRepr = component.addRepresentation(\n          'licorice',\n          {\n            colorScheme: 'uniform',\n            colorValue: 'white',\n            bondScale: 0.1,\n            sele\n          }\n        )\n        // Add representation for the atoms\n        const atomRepr = component.addRepresentation('spacefill', {radiusScale: 0.3, sele})\n        representationMap.current[top.system_id] = {\n          bonds: bondRepr,\n          atoms: atomRepr,\n          sele: sele,\n          indices: indices,\n          wrapMode: (isMonomer || isMolecule) ? wrapModes.unwrap.key : wrapModes.wrap.key\n        }\n        for (const child of top.child_systems || []) {\n          if (!child.atoms) addRepresentation(child)\n        }\n      }\n      addRepresentation(root)\n\n      // The file formats supported by NGL don't include the true lattice\n      // vectors, only the shape of the cell. If the lattive vectors aren't\n      // aligned with the cartesian coordinates, the visualization will be\n      // incorrect. This is why we need to fetch the true lattice vectors from\n      // the archive. Also none of the file formats store the full periodicity\n      // of the system, which is also needed for correct wrapping.\n\n      // Add a completely custom unit cell and lattice parameter visualization.\n      // The objects are added to a dummy 'unitcell' representation that is\n      // supported by NGL.\n      if (a && b && c) {\n        a = new THREE.Vector3().fromArray(a)\n        b = new THREE.Vector3().fromArray(b)\n        c = new THREE.Vector3().fromArray(c)\n        const metaCell = root?.cell\n        component.addRepresentation('unitcell', {opacity: 0})\n\n        // If some of the basis vectors are collapsed, we need to create\n        // artificial ones for the wrapping\n        const collapsed = [a.length() === 0, b.length() === 0, c.length() === 0]\n        const valid = [metaCell.a !== undefined, metaCell.b !== undefined, metaCell.c !== undefined]\n        const basis = [a, b, c]\n        const validBases = []\n        const invalidBases = []\n        for (let i = 0; i < collapsed.length; ++i) {\n          const isCollapsed = collapsed[i]\n          if (!isCollapsed) validBases.push(basis[i])\n          else invalidBases.push(i)\n        }\n        if (validBases.length === 2) {\n          const newBasis = new THREE.Vector3().crossVectors(\n            validBases[0],\n            validBases[1]\n          ).normalize()\n          basis[invalidBases[0]] = newBasis\n        }\n        const fracToCart = new THREE.Matrix4().makeBasis(basis[0], basis[1], basis[2])\n        const cartToFrac = fracToCart.clone().invert()\n\n        const cell = createCell(\n          new THREE.Vector3(),\n          basis,\n          collapsed,\n          '#000',\n          1,\n          0,\n          0\n        )\n        addObject3DToStage(cell, stageRef.current)\n        const latticeConstants = createLatticeConstants(\n          basis,\n          pbc,\n          collapsed,\n          valid,\n          {\n              font: 'Titillium Web,sans-serif',\n              size: 0.7,\n              stroke: {width: 0.06, color: \"#000\"},\n              a: {enabled: true, color: \"#C52929\", label: \"a\"},\n              b: {enabled: true, color: \"#47A823\", label: \"b\"},\n              c: {enabled: true, color: \"#3B5796\", label: \"c\"},\n              alpha: {enabled: true, color: \"#ffffff\", label: \"\"},\n              beta: {enabled: true, color: \"#ffffff\", label: \"\"},\n              gamma: {enabled: true, color: \"#ffffff\", label: \"\"}\n          }\n        )\n        addObject3DToStage(latticeConstants, stageRef.current)\n        component.unitCell = cell\n        component.cartToFrac = cartToFrac\n        component.fracToCart = fracToCart\n        component.basis = basis\n        component.pbc = pbc\n        component.latticeConstants = latticeConstants\n      }\n    }\n    componentRef.current = component\n    componentsRef.current[componentKey] = component\n\n  // We dont want this effect to react to 'wrap'\n  }, [api])\n\n  // Called whenever the system changes. Loads the structure asynchronously.\n  useEffect(() => {\n    // No structure to show\n    if (isNil(path)) {\n      setNoData(true)\n      setReady(true)\n      readyRef.current = true\n      return\n    }\n\n    // Start loading component\n    const componentKey = `${newEntryId}/${path}`\n    if (isNil(componentsRef.current[componentKey])) {\n      setLoading(true)\n    }\n    setReady(false)\n    readyRef.current = false\n    setNoData(false)\n\n    // For large systems we ask the user for permission\n    if (!accepted) return\n\n    // Remember to catch since react error boundaries do not automatically catch\n    // from async calls.\n    loadComponent(system, newEntryId, path, componentKey, topologyMap)\n      .catch(asyncError)\n      .finally(() => {\n        // Hide other components that have been loaded\n        for (const [key, component] of Object.entries(componentsRef.current)) {\n          component.setVisibility(key === componentKey)\n        }\n        setReady(true)\n        readyRef.current = true\n      })\n  }, [system, newEntryId, path, topologyMap, api, asyncError, loadComponent, accepted])\n\n  // React to selection\n  useEffect(() => {\n    if (!ready || !readyRef.current || !system) return\n\n    // Resolve how the selected topology should be visualized.\n    const topSelection = system\n    const topParent = system.parent_system\n    const structuralType = topSelection.structural_type\n    const isMonomer = structuralType === 'monomer'\n    const isMolecule = structuralType === 'molecule'\n    const isGroup = structuralType === 'group' || topSelection.label === 'subsystem'\n    const independent = topSelection.atoms || (topSelection.atoms_ref && isNil(topSelection.indices)) || isMolecule || isMonomer\n    const child_types = topSelection.child_systems\n      ? new Set(topSelection.child_systems.map(x => x.structural_type))\n      : new Set()\n    const isMonomerGroup = isGroup && isEqual(child_types, new Set(['monomer']))\n\n    // Determine the selection to center on.\n    const representation = representationMap.current[independent ? selected : topParent]\n    if (representation) {\n      representationRef.current = representation\n      selectionRef.current = representation?.sele\n\n      // Determine the selections to show opaque, i.e. as a solid color\n      const opaque = new Set([selected])\n\n      // Determine the selections to show transparent\n      const transparent = new Set((isGroup || structuralType === 'active orbitals') ? [topParent] : [])\n\n      // Determine whether to show cell\n      const cellVisible = !(isMolecule || isMonomer || isMonomerGroup)\n      if (cellVisible) {\n        handleShowCell(showCell)\n        handleShowLatticeConstants(showCell)\n      } else {\n        handleShowCell(false, false)\n        handleShowLatticeConstants(false, false)\n      }\n      setDisableShowCell(!cellVisible)\n      setDisableWrapMode(!independent)\n      setWrapMode(representation.wrapMode)\n      setDisableShowLatticeContants(!cellVisible)\n\n      // Loop through representations and set the correct visualization\n      for (const [key, value] of Object.entries(representationMap.current)) {\n        const transparency = opaque.has(key) ? 1 : transparent.has(key) ? 0.1 : 0\n        if (transparency) {\n          value.atoms.setParameters({opacity: transparency})\n          value.bonds.setParameters({opacity: transparency})\n          value.atoms.setVisibility(true)\n          value.bonds.setVisibility(showBonds)\n        } else {\n          value.atoms.setParameters({opacity: 0})\n          value.atoms.setVisibility(false)\n          value.bonds.setVisibility(false)\n        }\n      }\n      wrapRepresentation(componentRef.current, representation)\n\n      // Configure and reset the view based on the basis vectors.\n      const nBasis = 3\n      if (nBasis === 3) {\n        alignmentRef.current = [['up', 'c'], ['right', 'a']]\n        rotationsRef.current = [[0, 30, 0], [30, 0, 0]]\n      }\n      handleReset()\n    }\n    setLoading(false)\n  // We don't want this effect to react to 'showCell', 'showBonds',\n  // 'showLatticeParameters', or 'wrapMode'\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [selected, system, ready, handleShowCell, handleShowLatticeConstants, handleReset])\n\n  return <StructureBase\n    onTakeScreenshot={handleTakeScreenshot}\n    onFullscreen={handleFullscreen}\n    onReset={handleReset}\n    wrapMode={wrapMode}\n    onWrapModeChange={handleWrapModeChange}\n    disableWrapMode={disableWrapMode}\n    showLatticeConstants={showLatticeConstants}\n    onShowLatticeConstants={handleShowLatticeConstants}\n    disableShowLatticeConstants={disableShowLatticeConstants}\n    accepted={accepted}\n    onAccept={handleAccept}\n    showBonds={showBonds}\n    onShowBonds={handleShowBonds}\n    disableShowBonds={disableShowBonds}\n    showCell={showCell}\n    onShowCell={handleShowCell}\n    disableShowCell={disableShowCell}\n    float={false}\n    species={species}\n    loading={loading}\n    noData={noData}\n    nAtoms={nAtoms}\n    prompt={prompt}\n    // File download is disabled for older archives where system has indices but\n    // does not have atoms_ref filled.\n    disableFileDownload={!isNil(system?.indices) && isNil(system.atoms_ref)}\n    sizeLimit={sizeLimit}\n    entryId={newEntryId}\n    path={selected}\n    {...rest}\n  >\n    <div ref={canvasParentRef} className={styles.canvasParent}>\n      <div ref={canvasRef} className={styles.canvas}/>\n    </div>\n  </StructureBase>\n})\n\nStructureNGL.propTypes = {\n  entryId: PropTypes.string,\n  data: PropTypes.oneOfType([\n    PropTypes.bool,\n    PropTypes.string\n  ]),\n  topologyMap: PropTypes.object,\n  selected: PropTypes.string,\n  sizeLimit: PropTypes.number, // Maximum number of atoms before a prompt is shown.\n  onFullscreen: PropTypes.func\n}\n\nStructureNGL.defaultProps = {\n  sizeLimit: 40000\n}\n\nexport default withErrorHandler('Could not load structure.')(StructureNGL)\n\n/**\n * Used to resolve the API parameters for fetching a structure that is required\n * to visualize the current selection.\n *\n * @param {string} selected The selected system\n * @param {string} entryId Entry id\n * @param {object} topologyMap Object containing a mapping from system ids to the data.\n * @returns The final entry_id and path for fetching the system file through the API.\n */\nexport function getSystemAPIQuery(selected, entryId, topologyMap) {\n  if (isNil(selected) || isNil(entryId) || isNil(topologyMap)) {\n    return {entryId: undefined, path: undefined}\n  }\n\n  // Get path to the first system which stores a reference or actual data for\n  // the structure and does not specify indices. This way the visualizer is a\n  // bit more optimal compared to doing API calls for every subsystem.\n  function getPath(top) {\n    let path\n    if ((top.atoms_ref || top.atoms) && isNil(top.indices)) {\n      path = top.system_id\n    } else if (!isNil(top.indices)) {\n      path = getPath(topologyMap[top.parent_system])\n    }\n    return path\n  }\n  let path = getPath(topologyMap[selected])\n\n  // The path may be a reference that points to some other entry as well,\n  // here it is resolved\n  if (path && !path.startsWith('results')) {\n    const nomadUrl = parseNomadUrl(path)\n    entryId = nomadUrl.entryId || entryId\n    path = nomadUrl.path\n  }\n  return {entryId, path}\n}\n\n/**\n * Returns a quaternion that aligns the view according to the given input\n * options.\n *\n * @param {*} alignments: List of at most two alignments to set.  E.g. [['up',\n *   'c'], ['right', 'b']] will align the c-vector (see 'directions') to point\n *   up, and the b-vector to point right. These are applied sequentially.\n * @param {*} directions: Object containing a mapping between direction names\n * and the unit vectors that the correspond to.\n * @returns\n */\nfunction getAlignment(alignments, directions) {\n    // Check alignment validity\n    if (alignments === undefined) return\n    if (alignments.length > 2) throw Error('At most two alignments can be performed.')\n\n    const finalQuaternion = new THREE.Quaternion()\n    finalQuaternion.identity()\n    const alignedDirections = []\n    const rotate = (alignment) => {\n      const direction = alignment[0]\n      const target = alignment[1]\n      const targetMap = {\n        up: new THREE.Vector3(0, 1, 0),\n        down: new THREE.Vector3(0, -1, 0),\n        right: new THREE.Vector3(-1, 0, 0),\n        left: new THREE.Vector3(1, 0, 0),\n        front: new THREE.Vector3(0, 0, -1),\n        back: new THREE.Vector3(0, 0, 1)\n      }\n      const targetVector = targetMap[direction]\n\n      // Determine the top direction\n      const finalVector = directions[target]\n      for (const alignedDirection of alignedDirections) {\n        finalVector[alignedDirection] = 0\n      }\n\n      // Rotate the scene according to the selected top direction\n      if (finalVector.length() > 1e-8) {\n        const quaternion = new THREE.Quaternion().setFromUnitVectors(\n            finalVector.clone().normalize(),\n            targetVector.clone().normalize()\n        )\n        finalQuaternion.premultiply(quaternion)\n\n        // Rotate the given directions so that their direction will be correct\n        // for the next aligment\n        for (const dir in directions) {\n            directions[dir].clone().applyQuaternion(quaternion)\n        }\n\n        if (direction === \"right\" || direction === \"left\") {\n            alignedDirections.push(\"x\")\n        } else if (direction === \"up\" || direction === \"down\") {\n            alignedDirections.push(\"y\")\n        } else if (direction === \"front\" || direction === \"back\") {\n            alignedDirections.push(\"z\")\n        }\n      }\n    }\n\n    // Apply the alignments\n    for (const alignment of alignments) {\n        rotate(alignment)\n    }\n    return finalQuaternion\n}\n\n/**\n * Creates outlines for a cell specified by the given basis vectors.\n *\n * @param origin - The origin position for the cell\n * @param basis - The cell basis vectors\n * @param collapsed - Whether a basis vector is collapsed (length = 0)\n * @param color - Color for the cell wireframe\n * @param linewidth - Cell wireframe line width\n * @param dashSize - Cell wireframe dash size. Defaults to 0. Provide a value >\n *   0 for a dashed line.\n * @param gapSize - Cell wireframe dash size. Defaults to 0. Provide a value >\n *   0 for a dashed line.\n */\nfunction createCell(origin, basis, collapsed, color, linewidth, dashSize, gapSize) {\n    const cell = new THREE.Object3D()\n    let lineMaterial\n    if (!(dashSize === 0 && gapSize === 0)) {\n        lineMaterial = new THREE.LineDashedMaterial({\n            color: color,\n            linewidth: linewidth,\n            dashSize: dashSize,\n            gapSize: gapSize\n        })\n    } else {\n        lineMaterial = new THREE.LineBasicMaterial({\n            color: color,\n            linewidth: linewidth\n        })\n    }\n\n    function addEdge(points) {\n      const lineGeometry = new THREE.BufferGeometry().setFromPoints(points)\n      const line = new THREE.Line(lineGeometry, lineMaterial)\n      cell.add(line)\n      line.computeLineDistances()\n    }\n\n    for (let len = basis.length, i = 0; i < len; ++i) {\n        const isFirstCollapsed = collapsed[i]\n        if (isFirstCollapsed) continue\n        const basisVector = basis[i]\n\n        // First edge\n        const points1 = [origin, basisVector.clone().add(origin)]\n        addEdge(points1)\n\n        // Second edge\n        const secondIndex = (i + 1) % len\n        const isSecondCollapsed = collapsed[secondIndex]\n        const secondAddition = basis[secondIndex].clone()\n        if (!isSecondCollapsed) {\n          const points2 = [secondAddition.clone().add(origin), basisVector.clone().add(secondAddition).add(origin)]\n          addEdge(points2)\n        }\n\n        // Third edge\n        const thirdIndex = (i + 2) % len\n        const isThirdCollapsed = collapsed[thirdIndex]\n        const thirdAddition = basis[thirdIndex].clone()\n        if (!isThirdCollapsed) {\n          const points3 = [thirdAddition.clone().add(origin), basisVector.clone().add(thirdAddition).add(origin)]\n          addEdge(points3)\n        }\n\n        // Fourth edge\n        if (!isSecondCollapsed && !isThirdCollapsed) {\n          const points4 = [secondAddition.clone().add(thirdAddition).add(origin), basisVector.clone().add(secondAddition).add(thirdAddition).add(origin)]\n          addEdge(points4)\n        }\n    }\n    return cell\n}\n\n/**\n * Visualizes the lattice constants using the given visualization options.\n *\n * @param {string} options.font Font size for lattice constants. Defaults to 0.7.\n * constants. Applied as default to all labels, can be overridden\n * individually for each lattice constant.\n * @param {string} options.color Font color for lattice constants. Applied\n * as default to all labels, can be overridden individually for each lattice\n * constant. Defaults to\n * @param {string} options.stroke.color Font stroke color\n *   for lattice constants. Defaults to \"#000\". Applied as default to all\n *   labels, can be overridden individually for each lattice constant.\n * @param {string} options.stroke.width Font stroke width\n *   for lattice constants. Defaults to \"#000\". Applied as default to all\n *   labels, can be overridden individually for each lattice constant.\n * @param {string} options.a.enabled Whether to display this lattice\n *   contant. Defaults to true.\n * @param {string} options.a.color Font color. Defaults to \"#C52929\".\n * @param {string} options.a.font Font family. Defaults to \"Arial\".\n * @param {number} options.a.size Font size. Defaults to 0.7.\n * @param {number} options.a.label The label to display. Defaults to \"a\".\n * @param {number} options.a.stroke.width Font stroke width. Defaults to 0.06.\n * @param {string} options.a.stroke.color Font stroke color. Defaults to \"#000\".\n * @param {string} options.b.enabled Whether to display this lattice\n *   contant. Defaults to true.\n * @param {string} options.b.color Font color. Defaults to \"#47A823\".\n * @param {string} options.b.font Font family. Defaults to \"Arial\".\n * @param {number} options.b.size Font size. Defaults to 0.7.\n * @param {number} options.b.label The label to display. Defaults to \"b\".\n * @param {number} options.b.stroke.width Font stroke width. Defaults to 0.06.\n * @param {string} options.b.stroke.color Font stroke color. Defaults to \"#000\".\n * @param {string} options.c.enabled Whether to display this lattice\n *   contant. Defaults to true.\n * @param {string} options.c.color Font color. Defaults to \"#3B5796\".\n * @param {string} options.c.font Font family. Defaults to \"Arial\".\n * @param {number} options.c.size Font size. Defaults to 0.7.\n * @param {number} options.c.label The label to display. Defaults to \"c\".\n * @param {number} options.c.stroke.width Font stroke width. Defaults to 0.06.\n * @param {string} options.c.stroke.color Font stroke color. Defaults to \"#000\".\n * @param {string} options.alpha.enabled Whether to display this lattice\n *   contant. Defaults to true.\n * @param {string} options.alpha.color Font color. Defaults to \"#ffffff\".\n * @param {string} options.alpha.font Font family. Defaults to \"Arial\".\n * @param {number} options.alpha.size Font size. Defaults to 0.7.\n * @param {number} options.alpha.label The label to display. Defaults to \"\".\n * @param {number} options.alpha.stroke.width Font stroke width. Defaults to 0.06.\n * @param {string} options.alpha.stroke.color Font stroke color. Defaults to \"#000\".\n * @param {string} options.beta.enabled Whether to display this lattice\n *   contant. Defaults to true.\n * @param {string} options.beta.color Font color. Defaults to \"#ffffff\".\n * @param {string} options.beta.font Font family. Defaults to \"Arial\".\n * @param {number} options.beta.size Font size. Defaults to 0.7.\n * @param {number} options.beta.label The label to display. Defaults to \"\".\n * @param {number} options.beta.stroke.width Font stroke width. Defaults to 0.06.\n * @param {string} options.beta.stroke.color Font stroke color. Defaults to \"#000\".\n * @param {string} options.gamma.enabled Whether to display this lattice\n *   contant. Defaults to true.\n * @param {string} options.gamma.color Font color. Defaults to \"#ffffff\".\n * @param {string} options.gamma.font Font family. Defaults to \"Arial\".\n * @param {number} options.gamma.size Font size. Defaults to 0.7.\n * @param {number} options.gamma.label The label to display. Defaults to \"\".\n * @param {number} options.gamma.stroke.width Font stroke width. Defaults to 0.06.\n * @param {string} options.gamma.stroke.color Font stroke color. Defaults to \"#000\".\n */\nfunction createLatticeConstants(basis, periodicity, collapsed, valid, options) {\n  // Delete old instance\n  const latticeConstants = new THREE.Group()\n  const opt = options\n\n  // Determine the periodicity and setup the visualization accordingly\n  const periodicIndices = []\n  for (let dim = 0; dim < 3; ++dim) {\n      const p1 = periodicity[dim]\n      const p2 = periodicity[(dim + 1) % 3]\n      const p3 = periodicity[(dim + 2) % 3]\n      if (p1 && !p2 && !p3) {\n          periodicIndices.push(dim)\n          break\n      } else if (p1 && p2 && !p3) {\n          periodicIndices.push(dim)\n          periodicIndices.push((dim + 1) % 3)\n          break\n      }\n  }\n\n  // Create new instances\n  const infoColor = 0x000000\n  const axisOffset = 1.3\n\n  let iBasis = -1\n  const cellBasisColors = []\n  cellBasisColors.push(opt.a.color)\n  cellBasisColors.push(opt.b.color)\n  cellBasisColors.push(opt.c.color)\n  const angleColors = []\n  angleColors.push(opt.alpha.color)\n  angleColors.push(opt.beta.color)\n  angleColors.push(opt.gamma.color)\n  const angleStrokeColors = []\n  angleStrokeColors.push(opt.alpha?.stroke?.color === undefined ? opt.stroke.color : opt.alpha.stroke.color)\n  angleStrokeColors.push(opt.beta?.stroke?.color === undefined ? opt.stroke.color : opt.beta.stroke.color)\n  angleStrokeColors.push(opt.gamma?.stroke?.color === undefined ? opt.stroke.color : opt.gamma.stroke.color)\n  const angleStrokeWidths = []\n  angleStrokeWidths.push(opt.alpha?.stroke?.width === undefined ? opt.stroke.width : opt.alpha.stroke.width)\n  angleStrokeWidths.push(opt.beta?.stroke?.width === undefined ? opt.stroke.width : opt.beta.stroke.width)\n  angleStrokeWidths.push(opt.gamma?.stroke?.width === undefined ? opt.stroke.width : opt.gamma.stroke.width)\n  const angleLabels = [opt.gamma.label, opt.alpha.label, opt.beta.label]\n  const axisLabels = [opt.a.label, opt.b.label, opt.c.label]\n  const angleEnableds = [opt.gamma.enabled, opt.alpha.enabled, opt.beta.enabled]\n  const axisEnableds = [opt.a.enabled, opt.b.enabled, opt.c.enabled]\n  const axisFonts = []\n  axisFonts.push(opt.a.font === undefined ? opt.font : opt.a.font)\n  axisFonts.push(opt.b.font === undefined ? opt.font : opt.b.font)\n  axisFonts.push(opt.c.font === undefined ? opt.font : opt.c.font)\n  const axisFontSizes = []\n  axisFontSizes.push(opt.a.size === undefined ? opt.size : opt.a.size)\n  axisFontSizes.push(opt.b.size === undefined ? opt.size : opt.b.size)\n  axisFontSizes.push(opt.c.size === undefined ? opt.size : opt.c.size)\n  const strokeColors = []\n  strokeColors.push(opt.a?.stroke?.color === undefined ? opt.stroke.color : opt.a.stroke.color)\n  strokeColors.push(opt.b?.stroke?.color === undefined ? opt.stroke.color : opt.b.stroke.color)\n  strokeColors.push(opt.c?.stroke?.color === undefined ? opt.stroke.color : opt.c.stroke.color)\n  const strokeWidths = []\n  strokeWidths.push(opt.a?.stroke?.width === undefined ? opt.stroke.width : opt.a.stroke.width)\n  strokeWidths.push(opt.b?.stroke?.width === undefined ? opt.stroke.width : opt.b.stroke.width)\n  strokeWidths.push(opt.c?.stroke?.width === undefined ? opt.stroke.width : opt.c.stroke.width)\n  const angleFonts = []\n  angleFonts.push(opt.alpha.font === undefined ? opt.font : opt.alpha.font)\n  angleFonts.push(opt.beta.font === undefined ? opt.font : opt.beta.font)\n  angleFonts.push(opt.gamma.font === undefined ? opt.font : opt.gamma.font)\n  const angleFontSizes = []\n  angleFontSizes.push(opt.alpha.size === undefined ? opt.size : opt.alpha.size)\n  angleFontSizes.push(opt.beta.size === undefined ? opt.size : opt.beta.size)\n  angleFontSizes.push(opt.gamma.size === undefined ? opt.size : opt.gamma.size)\n\n  // If 2D periodic, we save the periodic indices, and ensure a right\n  // handed coordinate system.\n  for (let iTrueBasis = 0; iTrueBasis < 3; ++iTrueBasis) {\n    iBasis += 1\n    const axisLabel = axisLabels[iBasis]\n    const axisColor = cellBasisColors[iBasis]\n    const axisFont = axisFonts[iBasis]\n    const axisFontSize = axisFontSizes[iBasis]\n    const angleFontSize = angleFontSizes[iBasis]\n    const strokeWidth = strokeWidths[iBasis]\n    const strokeColor = strokeColors[iBasis]\n    const angleFont = angleFonts[iBasis]\n    const angleColor = angleColors[iBasis]\n    const angleLabel = angleLabels[iBasis]\n    const angleStrokeColor = angleStrokeColors[iBasis]\n    const angleStrokeWidth = angleStrokeWidths[iBasis]\n    const axisEnabled = axisEnableds[iBasis]\n    const angleEnabled = angleEnableds[iBasis]\n\n    const collapsed1 = collapsed[iTrueBasis]\n    const collapsed2 = collapsed[(iTrueBasis + 1) % 3]\n    const collapsed3 = collapsed[(iTrueBasis + 2) % 3]\n    const valid1 = valid[iTrueBasis]\n    const valid2 = valid[(iTrueBasis + 1) % 3]\n    const basisVec1 = basis[iTrueBasis]\n    const basisVec2 = basis[(iTrueBasis + 1) % 3].clone()\n    const basisVec3 = basis[(iTrueBasis + 2) % 3].clone()\n\n    // Basis and angle label selection, same for all systems\n    if (axisEnabled && !collapsed1 && valid1) {\n      const origin = new THREE.Vector3(0, 0, 0)\n      const dir = basisVec1.clone()\n\n      // Add an axis label\n      const textPos = dir.clone()\n          .multiplyScalar(0.5)\n      let labelOffset\n      let newBasis\n      if (collapsed2 && collapsed3) {\n          newBasis = new THREE.Vector3(0, 0, 1)\n          labelOffset = new THREE.Vector3().crossVectors(basisVec1, newBasis)\n      } else if (collapsed2) {\n          newBasis = new THREE.Vector3().crossVectors(basisVec1, basisVec3)\n          labelOffset = new THREE.Vector3().crossVectors(basisVec1, newBasis)\n      } else if (collapsed3) {\n          newBasis = new THREE.Vector3().crossVectors(basisVec1, basisVec2)\n          labelOffset = new THREE.Vector3().crossVectors(basisVec1, newBasis)\n      } else {\n          const labelOffset1 = new THREE.Vector3().crossVectors(basisVec1, basisVec2)\n          const labelOffset2 = new THREE.Vector3().crossVectors(basisVec1, basisVec3)\n          labelOffset = new THREE.Vector3().sub(labelOffset1).add(labelOffset2)\n      }\n      labelOffset.normalize()\n      labelOffset.multiplyScalar(0.8)\n      textPos.add(labelOffset)\n\n      const axisLabelSprite = createLabel(\n          textPos,\n          axisLabel,\n          axisColor,\n          axisFont,\n          axisFontSize,\n          new THREE.Vector2(0.0, 0.0),\n          strokeWidth,\n          strokeColor\n      )\n      latticeConstants.add(axisLabelSprite)\n      axisLabels.push(axisLabelSprite)\n\n      // Add basis vector colored line\n      const cellVectorMaterial = new THREE.MeshBasicMaterial({\n          color: axisColor,\n          transparent: true,\n          opacity: 0.75\n      })\n      const cellVector = basisVec1.clone()\n      const cellVectorLine = createCylinder(origin.clone(), cellVector.clone().add(origin), 0.09, 10, cellVectorMaterial)\n      latticeConstants.add(cellVectorLine)\n\n      // Add basis vector axis line\n      const cellAxisMaterial = new THREE.MeshBasicMaterial({\n          color: \"#000000\"\n      })\n      const axisStart = basis[iTrueBasis].clone()\n      const axisEnd = axisStart.clone().multiplyScalar(1 + axisOffset / axisStart.length())\n      const cellAxisVectorLine = createCylinder(origin.clone(), axisEnd, 0.02, 10, cellAxisMaterial)\n      latticeConstants.add(cellAxisVectorLine)\n\n      // Add axis arrow\n      const arrowGeometry = new THREE.CylinderGeometry(0, 0.10, 0.5, 12)\n      const arrowMaterial = new THREE.MeshBasicMaterial({\n          color: infoColor\n      })\n      const arrow = new THREE.Mesh(arrowGeometry, arrowMaterial)\n      arrow.position.copy(dir)\n          .multiplyScalar(1 + axisOffset / dir.length())\n      arrow.lookAt(new THREE.Vector3())\n      arrow.rotateX(-Math.PI / 2)\n      latticeConstants.add(arrow)\n    }\n\n    // Add angle label and curve\n    if (angleEnabled && !collapsed1 && !collapsed2 && valid1 && valid2) {\n      const arcMaterial = new THREE.LineDashedMaterial({\n          color: infoColor,\n          linewidth: 2,\n          dashSize: 0.2,\n          gapSize: 0.1\n      })\n\n      const normal = new THREE.Vector3().crossVectors(basisVec1, basisVec2)\n      const angle = basisVec1.angleTo(basisVec2)\n      const maxRadius = 5\n      const minRadius = 1\n      const radius = Math.max(\n        Math.min(1 / 6 * basisVec1.length(), 1 / 6 * basisVec2.length(), maxRadius),\n        minRadius\n      )\n      const curve = new THREE.EllipseCurve(\n          0, 0, // ax, aY\n          radius, radius, // xRadius, yRadius\n          0, angle, // aStartAngle, aEndAngle\n          false, // aClockwise\n          0 // aRotation\n      )\n      const nArcPoints = 20\n      const points = curve.getSpacedPoints(nArcPoints)\n      const arcGeometry = new THREE.BufferGeometry().setFromPoints(points)\n      const arc = new THREE.Line(arcGeometry, arcMaterial)\n      arc.computeLineDistances()\n\n      // First rotate the arc so that it's x-axis points towards the\n      // first basis vector that defines the arc\n      const xAxis = new THREE.Vector3(1, 0, 0)\n      const quaternion = new THREE.Quaternion().setFromUnitVectors(\n          xAxis,\n          basisVec1.clone().normalize()\n      )\n      arc.quaternion.copy(quaternion)\n\n      // Then rotate the arc along it's x axis so that the xy-plane\n      // coincides with the plane defined by the the two basis vectors\n      // that define the plane.\n      const verticesArray = arcGeometry.attributes.position.array\n      const nVertices = verticesArray.length / 3\n      const lastArcPointLocal = new THREE.Vector3().fromArray(verticesArray, (nVertices - 1) * 3)\n      arc.updateMatrixWorld() // The positions are not otherwise updated properly\n      const lastArcPointWorld = arc.localToWorld(lastArcPointLocal.clone())\n\n      // The angle direction is defined by the first basis vector\n      const axis = basisVec1\n      const arcNormal = new THREE.Vector3()\n          .crossVectors(axis, lastArcPointWorld)\n      let planeAngle = normal.angleTo(arcNormal)\n      const planeCross = new THREE.Vector3()\n          .crossVectors(basisVec2, lastArcPointWorld)\n      const directionValue = planeCross.dot(axis)\n      if (directionValue > 0) {\n          planeAngle = -planeAngle\n      }\n      arc.rotateX(planeAngle)\n\n      // Add label for the angle\n      arc.updateMatrixWorld() // The positions are not otherwise updated properly\n      arc.updateMatrix() // The positions are not otherwise updated properly\n      const angleLabelPos = arc.localToWorld(new THREE.Vector3().fromArray(verticesArray, (nArcPoints / 2 - 1) * 3))\n      const angleLabelLen = angleLabelPos.length()\n      angleLabelPos.multiplyScalar(1 + 0.3 / angleLabelLen)\n      const angleLabelObj = createLabel(\n          angleLabelPos,\n          angleLabel.toString(),\n          angleColor,\n          angleFont,\n          angleFontSize,\n          new THREE.Vector2(0.0, 0.0),\n          angleStrokeWidth,\n          angleStrokeColor\n      )\n      latticeConstants.add(angleLabelObj)\n      latticeConstants.add(arc)\n    }\n  }\n  return latticeConstants\n}\n\n/**\n * Helper function for creating a text sprite that lives in 3D space.\n *\n * @param pos1 - Start position\n * @param pos2 - End position\n * @param radius - Cylinder radius\n * @param material - Cylinder material\n */\nfunction createLabel(\n  position,\n  label,\n  color,\n  fontFamily,\n  fontSize,\n  offset = undefined,\n  strokeWidth = 0,\n  strokeColor = \"#000\"\n) {\n  const canvas = document.createElement('canvas')\n  const size = 256\n  canvas.width = size\n  canvas.height = size\n  const ctx = canvas.getContext('2d')\n\n  // Draw label\n  const fontFactor = 0.90\n  ctx.fillStyle = color\n  ctx.font = `${fontFactor * size}px ${fontFamily}`\n  ctx.textAlign = \"center\"\n  ctx.textBaseline = \"middle\"\n  if (strokeWidth > 0) {\n      ctx.lineWidth = strokeWidth * size\n      ctx.strokeStyle = strokeColor\n      ctx.strokeText(label, size / 2, size / 2)\n  }\n  ctx.fillText(label, size / 2, size / 2)\n\n  const texture = new THREE.Texture(canvas)\n  texture.needsUpdate = true\n  const material = new THREE.SpriteMaterial({ map: texture })\n  const sprite = new THREE.Sprite(material)\n  sprite.scale.set(fontSize, fontSize, 1)\n\n  // Apply offset\n  if (offset === undefined) {\n      offset = new THREE.Vector2(0, 0)\n  }\n  const trueOffset = new THREE.Vector2()\n  trueOffset.addVectors(offset, new THREE.Vector2(0.5, 0.5))\n  sprite.center.copy(trueOffset)\n\n  const labelRoot = new THREE.Object3D()\n  labelRoot.position.copy(position)\n  labelRoot.add(sprite)\n\n  return labelRoot\n}\n\n/**\n * Helper function for creating a cylinder mesh.\n *\n * @param pos1 - Start position\n * @param pos2 - End position\n * @param radius - Cylinder radius\n * @param material - Cylinder material\n */\nfunction createCylinder(pos1, pos2, radius, nSegments, material) {\n  const direction = new THREE.Vector3().subVectors(pos2, pos1)\n  const dirLen = direction.length()\n  const dirNorm = direction.clone().divideScalar(dirLen)\n  const arrow = new THREE.ArrowHelper(dirNorm, pos1)\n  const edgeGeometry = new THREE.CylinderGeometry(radius, radius, dirLen, nSegments)\n  const edge = new THREE.Mesh(edgeGeometry, material)\n  edge.rotation.copy(arrow.rotation.clone())\n  edge.position.copy(new THREE.Vector3().addVectors(pos1, direction.multiplyScalar(0.5)))\n\n  return edge\n}\n\n/**\n * Used to add custom three.js objects to an NGL stage. Note that this adds the\n * object to an item inside 'modelGroup'. This is the easiest way to attach the\n * objects to a group with the correct translations and rotations, but may break\n * if the first item is not a group.\n *\n * @param object - The object to add. Can be any object that inherits from Object3D.\n * @param stage - The NGL Stage to add the object into.\n * @param obects - List of custom objects into which the given one is added.\n */\nfunction addObject3DToStage(object, stage) {\n  const scene = stage.viewer.scene\n  const rotationGroup = scene.getObjectByName('rotationGroup')\n  const translationGroup = rotationGroup.getObjectByName('translationGroup')\n  const pickingGroup = translationGroup.getObjectByName('modelGroup')\n  // TODO: Since we don't know the actual three.js Object3Ds that correspond to\n  // each component, we are simply adding the object to the latest model object\n  // that is found and is visible by default.\n  const group = pickingGroup.children[pickingGroup.children.length - 2]\n  group.add(object)\n}\n\n/**\n * For setting the positions according to the currently set wrapmode.\n *\n * @param {ngl.Component} component The ngl component\n * @param {ngl.Representation} representation The ngl representation\n */\nfunction wrapRepresentation(component, representation) {\n  let posNew\n  const indices = representation.indices\n  const wrapMode = representation.wrapMode\n  const basis = component.basis\n  const cartToFrac = component.cartToFrac\n  const fracToCart = component.fracToCart\n  const pbc = component.pbc\n\n  if (!basis) return\n  if (!pbc.some(a => a)) return\n\n  // Gather and store the original cartesian positions if they are not already\n  // resolved.\n  if (isNil(representation.posCart)) {\n    representation.posCart = []\n    for (const index of indices) {\n      const ap = component.structure.getAtomProxy(index)\n      representation.posCart.push(ap.positionToVector3(new THREE.Vector3()))\n    }\n  }\n\n  // Use wrapped positions\n  if (wrapMode === wrapModes.wrap.key) {\n    if (!isNil(representation.posWrap)) {\n      posNew = representation.posWrap\n    } else {\n      posNew = representation.posCart.map(pos => {\n        return pos.clone().applyMatrix4(cartToFrac)\n      })\n      wrapPositions(posNew, cartToFrac, pbc)\n      posNew = posNew.map(pos => pos.applyMatrix4(fracToCart))\n      representation.posWrap = posNew\n    }\n  // Use unwrapped positions\n  } else if (wrapMode === wrapModes.unwrap.key) {\n    if (!isNil(representation.posUnwrap)) {\n      posNew = representation.posUnwrap\n    } else {\n      const posFrac = representation.posCart.map(pos => {\n        return pos.clone().applyMatrix4(cartToFrac)\n      })\n      const centerOfPos = getCenterOfPositions(posFrac, component.pbc)\n      posNew = posFrac.map(pos => pos.add(new Vector3(0.5, 0.5, 0.5).sub(centerOfPos)))\n      wrapPositions(posNew, cartToFrac, pbc)\n      posNew = posNew.map(pos => pos.applyMatrix4(fracToCart))\n      representation.posUnwrap = posNew\n    }\n  // Use original positions\n  } else if (wrapMode === wrapModes.original.key) {\n    posNew = representation.posCart\n  } else {\n    throw Error('Invalid wrapmode provided.')\n  }\n\n  // Set new positions within the structure data. This follows roughly the\n  // Structure.updatePosition()-function in NGL.\n  let i = 0\n  for (const index of indices) {\n    const ap = component.structure.getAtomProxy(index)\n    ap.positionFromVector3(posNew[i])\n    ++i\n  }\n\n  // This updates the actual visuals. TODO: not sure why this is producing an\n  // exception, ignored for now.\n  component.structure._hasCoords = undefined\n  component.structure.refreshPosition()\n  try {\n    component.updateRepresentations()\n  } catch {\n  }\n}\n\n/**\n * Wraps fractional positions within a cell respecting periodic boundary\n * conditions. Wrapping is done in place.\n *\n * @param {THREE.Vector3[]} posFrac Positions to wrap\n * @param {THREE.Matrix4} cartToFrac Matrix to convert cartesian positions to fractional\n * @param {bool[]} pbc Periodic boundary conditions for each lattice vector\n */\nfunction wrapPositions(posFrac, cartToFrac, pbc) {\n  const eps = 1e-2\n  const epsArray = new THREE.Vector3(eps, eps, eps).applyMatrix4(cartToFrac).toArray()\n  const center = [0.5, 0.5, 0.5] // Positions will be nearest to this location\n  const shift = center.map((center, i) => pbc[i] ? center - 0.5 - epsArray[i] : 0)\n  for (let len = posFrac.length, i = 0; i < len; ++i) {\n    const iFracPos = posFrac[i]\n    for (let i = 0; i < 3; ++i) {\n      if (!pbc[i]) continue\n      const comp = iFracPos.getComponent(i)\n      let remainder = ((comp - shift[i]) % 1) + shift[i]\n      // Unlike in python, remainder in javascript can be negative\n      if (remainder < -epsArray[i]) remainder += 1\n      iFracPos.setComponent(i, remainder)\n    }\n  }\n}\n\n// This data is copied directly from NGL as it cannot be imported directly.\nconst atomicNumbers = {\n  H: 1, D: 1, T: 1, HE: 2, LI: 3, BE: 4, B: 5, C: 6, N: 7, O: 8, F: 9, NE: 10, NA: 11, MG: 12, AL: 13, SI: 14, P: 15, S: 16, CL: 17, AR: 18, K: 19, CA: 20, SC: 21, TI: 22, V: 23, CR: 24, MN: 25, FE: 26, CO: 27, NI: 28, CU: 29, ZN: 30, GA: 31, GE: 32, AS: 33, SE: 34, BR: 35, KR: 36, RB: 37, SR: 38, Y: 39, ZR: 40, NB: 41, MO: 42, TC: 43, RU: 44, RH: 45, PD: 46, AG: 47, CD: 48, IN: 49, SN: 50, SB: 51, TE: 52, I: 53, XE: 54, CS: 55, BA: 56, LA: 57, CE: 58, PR: 59, ND: 60, PM: 61, SM: 62, EU: 63, GD: 64, TB: 65, DY: 66, HO: 67, ER: 68, TM: 69, YB: 70, LU: 71, HF: 72, TA: 73, W: 74, RE: 75, OS: 76, IR: 77, PT: 78, AU: 79, HG: 80, TL: 81, PB: 82, BI: 83, PO: 84, AT: 85, RN: 86, FR: 87, RA: 88, AC: 89, TH: 90, PA: 91, U: 92, NP: 93, PU: 94, AM: 95, CM: 96, BK: 97, CF: 98, ES: 99, FM: 100, MD: 101, NO: 102, LR: 103, RF: 104, DB: 105, SG: 106, BH: 107, HS: 108, MT: 109, DS: 110, RG: 111, CN: 112, NH: 113, FL: 114, MC: 115, LV: 116, TS: 117, OG: 118\n}\nconst vdwRadii = {\n  1: 1.1, 2: 1.4, 3: 1.81, 4: 1.53, 5: 1.92, 6: 1.7, 7: 1.55, 8: 1.52, 9: 1.47, 10: 1.54, 11: 2.27, 12: 1.73, 13: 1.84, 14: 2.1, 15: 1.8, 16: 1.8, 17: 1.75, 18: 1.88, 19: 2.75, 20: 2.31, 21: 2.3, 22: 2.15, 23: 2.05, 24: 2.05, 25: 2.05, 26: 2.05, 27: 2.0, 28: 2.0, 29: 2.0, 30: 2.1, 31: 1.87, 32: 2.11, 33: 1.85, 34: 1.9, 35: 1.83, 36: 2.02, 37: 3.03, 38: 2.49, 39: 2.4, 40: 2.3, 41: 2.15, 42: 2.1, 43: 2.05, 44: 2.05, 45: 2.0, 46: 2.05, 47: 2.1, 48: 2.2, 49: 2.2, 50: 1.93, 51: 2.17, 52: 2.06, 53: 1.98, 54: 2.16, 55: 3.43, 56: 2.68, 57: 2.5, 58: 2.48, 59: 2.47, 60: 2.45, 61: 2.43, 62: 2.42, 63: 2.4, 64: 2.38, 65: 2.37, 66: 2.35, 67: 2.33, 68: 2.32, 69: 2.3, 70: 2.28, 71: 2.27, 72: 2.25, 73: 2.2, 74: 2.1, 75: 2.05, 76: 2.0, 77: 2.0, 78: 2.05, 79: 2.1, 80: 2.05, 81: 1.96, 82: 2.02, 83: 2.07, 84: 1.97, 85: 2.02, 86: 2.2, 87: 3.48, 88: 2.83, 89: 2.0, 90: 2.4, 91: 2.0, 92: 2.3, 93: 2.0, 94: 2.0, 95: 2.0, 96: 2.0, 97: 2.0, 98: 2.0, 99: 2.0, 100: 2.0, 101: 2.0, 102: 2.0, 103: 2.0, 104: 2.0, 105: 2.0, 106: 2.0, 107: 2.0, 108: 2.0, 109: 2.0, 110: 2.0, 111: 2.0, 112: 2.0, 113: 2.0, 114: 2.0, 115: 2.0, 116: 2.0, 117: 2.0, 118: 2.0\n}\nconst elementColors = {\n  'H': 0xFFFFFF, 'HE': 0xD9FFFF, 'LI': 0xCC80FF, 'BE': 0xC2FF00, 'B': 0xFFB5B5, 'C': 0x909090, 'N': 0x3050F8, 'O': 0xFF0D0D, 'F': 0x90E050, 'NE': 0xB3E3F5, 'NA': 0xAB5CF2, 'MG': 0x8AFF00, 'AL': 0xBFA6A6, 'SI': 0xF0C8A0, 'P': 0xFF8000, 'S': 0xFFFF30, 'CL': 0x1FF01F, 'AR': 0x80D1E3, 'K': 0x8F40D4, 'CA': 0x3DFF00, 'SC': 0xE6E6E6, 'TI': 0xBFC2C7, 'V': 0xA6A6AB, 'CR': 0x8A99C7, 'MN': 0x9C7AC7, 'FE': 0xE06633, 'CO': 0xF090A0, 'NI': 0x50D050, 'CU': 0xC88033, 'ZN': 0x7D80B0, 'GA': 0xC28F8F, 'GE': 0x668F8F, 'AS': 0xBD80E3, 'SE': 0xFFA100, 'BR': 0xA62929, 'KR': 0x5CB8D1, 'RB': 0x702EB0, 'SR': 0x00FF00, 'Y': 0x94FFFF, 'ZR': 0x94E0E0, 'NB': 0x73C2C9, 'MO': 0x54B5B5, 'TC': 0x3B9E9E, 'RU': 0x248F8F, 'RH': 0x0A7D8C, 'PD': 0x006985, 'AG': 0xC0C0C0, 'CD': 0xFFD98F, 'IN': 0xA67573, 'SN': 0x668080, 'SB': 0x9E63B5, 'TE': 0xD47A00, 'I': 0x940094, 'XE': 0x940094, 'CS': 0x57178F, 'BA': 0x00C900, 'LA': 0x70D4FF, 'CE': 0xFFFFC7, 'PR': 0xD9FFC7, 'ND': 0xC7FFC7, 'PM': 0xA3FFC7, 'SM': 0x8FFFC7, 'EU': 0x61FFC7, 'GD': 0x45FFC7, 'TB': 0x30FFC7, 'DY': 0x1FFFC7, 'HO': 0x00FF9C, 'ER': 0x00E675, 'TM': 0x00D452, 'YB': 0x00BF38, 'LU': 0x00AB24, 'HF': 0x4DC2FF, 'TA': 0x4DA6FF, 'W': 0x2194D6, 'RE': 0x267DAB, 'OS': 0x266696, 'IR': 0x175487, 'PT': 0xD0D0E0, 'AU': 0xFFD123, 'HG': 0xB8B8D0, 'TL': 0xA6544D, 'PB': 0x575961, 'BI': 0x9E4FB5, 'PO': 0xAB5C00, 'AT': 0x754F45, 'RN': 0x428296, 'FR': 0x420066, 'RA': 0x007D00, 'AC': 0x70ABFA, 'TH': 0x00BAFF, 'PA': 0x00A1FF, 'U': 0x008FFF, 'NP': 0x0080FF, 'PU': 0x006BFF, 'AM': 0x545CF2, 'CM': 0x785CE3, 'BK': 0x8A4FE3, 'CF': 0xA136D4, 'ES': 0xB31FD4, 'FM': 0xB31FBA, 'MD': 0xB30DA6, 'NO': 0xBD0D87, 'LR': 0xC70066, 'RF': 0xCC0059, 'DB': 0xD1004F, 'SG': 0xD90045, 'BH': 0xE00038, 'HS': 0xE6002E, 'MT': 0xEB0026, 'DS': 0xFFFFFF, 'RG': 0xFFFFFF, 'CN': 0xFFFFFF, 'UUT': 0xFFFFFF, 'FL': 0xFFFFFF, 'UUP': 0xFFFFFF, 'LV': 0xFFFFFF, 'UUH': 0xFFFFFF, 'D': 0xFFFFC0, 'T': 0xFFFFA0\n}\n\n/**\n * Calculates the center of positions and also takes the periodicity of the\n * system into account.\n *\n * The algorithm is replicated from:\n * https://en.wikipedia.org/wiki/Center_of_mass#Systems_with_periodic_boundary_conditions\n *\n * @param {*} relative_positions\n * @param {*} cell\n * @param {*} pbc\n * @returns\n */\nfunction getCenterOfPositions(posFrac, pbc) {\n  const center = new Vector3()\n  const total = posFrac.length\n  for (const iComp of [0, 1, 2]) {\n      const iPbc = pbc[iComp]\n      let centerComp\n      if (iPbc) {\n        let xiSum = 0\n        let zetaSum = 0\n        for (const pos of posFrac) {\n          const component = pos.getComponent(iComp)\n          const theta = component * 2 * Math.PI\n          xiSum += Math.cos(theta)\n          zetaSum += Math.sin(theta)\n        }\n        const xiMean = xiSum / total\n        const zetaMean = zetaSum / total\n        const thetaMean = Math.atan2(-zetaMean, -xiMean) + Math.PI\n        centerComp = thetaMean / (2 * Math.PI)\n      } else {\n        let sum = 0\n        for (const pos of posFrac) {\n          sum += pos.getComponent(iComp)\n        }\n        centerComp = sum / posFrac.length\n      }\n      center.setComponent(iComp, centerComp)\n  }\n  return center\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useCallback, useState, useMemo } from 'react'\nimport PropTypes from 'prop-types'\nimport { isEmpty, isNil, merge, cloneDeep } from 'lodash'\nimport { PropertyCard } from './PropertyCard'\nimport { Tab, Tabs, Typography, Box } from '@material-ui/core'\nimport { makeStyles, useTheme } from '@material-ui/core/styles'\nimport StructureNGL from '../../visualization/StructureNGL'\nimport { FloatableNoReparent } from '../../visualization/Floatable'\nimport TreeView from '@material-ui/lab/TreeView'\nimport TreeItem from '@material-ui/lab/TreeItem'\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore'\nimport ChevronRightIcon from '@material-ui/icons/ChevronRight'\nimport { QuantityTable, QuantityRow, QuantityCell } from '../../Quantity'\n\n/**\n * For displaying the most descriptive chemical formula that is present in an\n * entry.\n*/\nconst nElementMap = {\n  1: 'unary',\n  2: 'binary',\n  3: 'ternary',\n  4: 'quaternary',\n  5: 'quinary',\n  6: 'sexinary',\n  7: 'septenary',\n  8: 'octanary',\n  9: 'nonary',\n  10: 'decimary'\n}\n\n/**\n * Displays information about the material and it's structure.\n */\nconst useMaterialCardStyles = makeStyles((theme) => ({\n  root: {\n    height: '700px'\n  },\n  card: {\n    height: '100%',\n    width: '100%'\n  }\n}))\n\nconst MaterialCardTopology = React.memo(({index, archive}) => {\n  const styles = useMaterialCardStyles()\n  const [topologyTrees, topologyMap] = useMemo(() => getTopology(index, archive), [index, archive])\n  const [selected, setSelected] = useState(topologyTrees[0].system_id)\n  const [tab, setTab] = useState('composition')\n  const [float, setFloat] = useState(false)\n\n  // Handle tab change\n  const handleTabChange = useCallback((event, value) => {\n    setTab(value)\n  }, [])\n\n  // Handle float change\n  const handleFloat = useCallback(() => {\n    setFloat(old => !old)\n  }, [])\n\n  return <div className={styles.root}>\n    <PropertyCard title=\"Material\" className={styles.card}>\n      <FloatableNoReparent float={float} onFloat={handleFloat}>\n        <Box display=\"flex\" flexDirection=\"column\" height=\"100%\" width=\"100%\">\n          <Box display=\"flex\" flex=\"1 1 auto\" minHeight={0}>\n            <Box display=\"flex\" flexDirection=\"row\" width=\"100%\">\n              <Box flex=\"1 1 33%\">\n                <Topology\n                  topologyTrees={topologyTrees}\n                  topologyMap={topologyMap}\n                  selected={selected}\n                  onSelect={setSelected}\n                />\n              </Box>\n              <Box flex=\"0 0 8px\"/>\n              <Box flex=\"1 1 67%\">\n                <StructureNGL\n                  topologyMap={topologyMap}\n                  entryId={index.entry_id}\n                  // Only once archive is loaded, the data for 'atoms' and\n                  // 'atoms_ref' will be present. Until that we can't load the\n                  // visualization as the topology can't tell which system to\n                  // load. TODO: Maybe the indices etc. could be stored in ES to\n                  // allow the structure to be loaded once metadata is ready?\n                  selected={archive ? selected : undefined}\n                  onFullscreen={handleFloat}\n                />\n              </Box>\n            </Box>\n          </Box>\n          <Box flex=\"0 0 222.72px\" minHeight={0}>\n            <MaterialTabs value={tab} onChange={handleTabChange} node={topologyMap[selected]} />\n          </Box>\n        </Box>\n      </FloatableNoReparent>\n    </PropertyCard>\n  </div>\n})\n\nMaterialCardTopology.propTypes = {\n  index: PropTypes.object.isRequired,\n  archive: PropTypes.object\n}\nconst useTopologyStyles = makeStyles((theme) => ({\n  root: {\n    height: '100%',\n    display: 'flex',\n    flexDirection: 'column'\n  },\n  tree: {\n    borderTop: `1px solid ${theme.palette.divider}`,\n    overflow: 'auto'\n  },\n  spacer: {\n    flexGrow: 1\n  }\n}))\n\n/**\n * Displays the topology in an interactive tree.\n */\nconst Topology = React.memo(({topologyTrees, topologyMap, selected, onSelect}) => {\n  const styles = useTopologyStyles()\n\n  // Add selection handlers and gather a list of all nodes.\n  const nodes = useMemo(() => {\n    const nodes = []\n    Object.values(topologyMap).forEach(node => {\n      node.onClick = () => onSelect(node.system_id)\n      nodes.push(node.system_id)\n    })\n    return nodes\n  }, [onSelect, topologyMap])\n\n  const [expanded, setExpanded] = useState(nodes)\n  const description = topologyMap?.[selected].description\n\n  // Handle node expansion\n  const handleToggle = useCallback((event, nodeIds) => {\n    setExpanded(nodeIds)\n  }, [])\n\n  return <div className={styles.root}>\n    <TreeView\n      selected={selected}\n      expanded={expanded}\n      className={styles.tree}\n      onNodeToggle={handleToggle}\n      defaultCollapseIcon={<ExpandMoreIcon />}\n      defaultExpandIcon={<ChevronRightIcon />}\n    >\n      {topologyTrees.map(topologyTree =>\n        <TopologyItem key={topologyTree.id} node={topologyTree} level={0} selected={selected}/>\n      )}\n    </TreeView>\n    <div className={styles.spacer} />\n    {description && <Box padding={1} paddingBottom={0}>\n      <Typography variant=\"body1\">Description:</Typography>\n      <Typography variant=\"caption\" >{description}</Typography>\n    </Box>}\n  </div>\n})\nTopology.propTypes = {\n  topologyTrees: PropTypes.list,\n  topologyMap: PropTypes.object,\n  selected: PropTypes.string,\n  onSelect: PropTypes.func\n}\n\nconst useTopologyItemStyles = makeStyles({\n  root: (props) => ({\n    '&:hover > $content': {\n      backgroundColor: props.theme.palette.action.hover\n    },\n    '&$selected > $content': {\n      backgroundColor: props.theme.palette.primary.main,\n      color: 'white'\n    },\n    '&:focus > $content $label, &:hover > $content $label, &$selected > $content $label': {\n      backgroundColor: 'transparent'\n    }\n  }),\n  content: (props) => ({\n    borderBottom: `1px solid ${props.theme.palette.divider}`,\n    fontWeight: props.theme.typography.fontWeightMedium,\n    '$expanded > &': {\n      fontWeight: props.theme.typography.fontWeightRegular\n    },\n    paddingLeft: props.theme.spacing(0.75 * props.level),\n    boxSizing: 'border-box'\n  }),\n  group: (props) => ({marginLeft: 0}),\n  // These empty classes are needed for reset\n  expanded: (props) => ({}),\n  selected: (props) => ({}),\n  label: (props) => ({\n    fontWeight: 'inherit',\n    color: 'inherit',\n    paddingLeft: 0\n  }),\n  row: (props) => ({\n    display: 'flex',\n    alignItems: 'center',\n    flexDirection: 'row',\n    paddingRight: props.theme.spacing(0.5)\n  }),\n  column: (props) => ({\n    display: 'flex',\n    alignItems: 'flex-start',\n    justifyContent: 'center',\n    flexDirection: 'column',\n    padding: props.theme.spacing(0.25, 0),\n    flexGrow: 1,\n    height: props.theme.spacing(5)\n  }),\n  nodeLabelPrimary: (props) => ({\n    textTransform: 'uppercase',\n    fontSize: 14\n  }),\n  nodeLabelSecondary: (props) => ({\n    fontSize: 12\n  }),\n  iconContainer: (props) => ({\n    paddingLeft: props.theme.spacing(0.5)\n  })\n})\n\nconst TopologyItem = React.memo(({node, level, selected}) => {\n  // The best way to dynamically manipulate the classes created by makeStyles\n  // was to make each style dependent on a set of properties. Creating the\n  // styles within the function does not seem to work.\n  const theme = useTheme()\n  const styleProps = useMemo(() => ({theme, level: level}), [theme, level])\n  const classes = useTopologyItemStyles(styleProps)\n  const isSelected = selected === node.system_id\n\n  return <TreeItem\n    onLabelClick={(event) => { node.onClick && node.onClick(); event.preventDefault() }}\n    nodeId={node.system_id}\n    label={\n      <div className={classes.row}>\n        <div className={classes.column}>\n          <Typography variant=\"body1\" className={classes.nodeLabelPrimary}>\n            {`${node.label}`}\n          </Typography>\n          <Typography\n            variant=\"body2\"\n            className={classes.nodeLabelSecondary}\n            style={{\n              color: isSelected ? 'white' : theme.palette.text.secondary\n            }}\n          >\n            {node.label === 'original'\n              ? undefined\n              : `${node.structural_type}` + (!isEmpty(node?.child_systems) && node.structural_type === 'group'\n                ? ` (${[...new Set(node.child_systems.map(x => x.structural_type))].join(', ')})`\n                : ''\n            )}\n          </Typography>\n        </div>\n      </div>\n    }\n    classes={{\n      root: classes.root,\n      content: classes.content,\n      expanded: classes.expanded,\n      selected: classes.selected,\n      iconContainer: classes.iconContainer,\n      group: classes.group,\n      label: classes.label\n    }}\n  >\n    {node.child_systems && node.child_systems.map(node => {\n      return <TopologyItem key={node.system_id} node={node} level={level + 1} selected={selected}/>\n    })}\n  </TreeItem>\n})\nTopologyItem.propTypes = {\n  node: PropTypes.object,\n  level: PropTypes.number,\n  selected: PropTypes.string\n}\n\n/**\n * Displays the information that is present for a single node within tabs.\n */\nconst useMaterialTabsStyles = makeStyles(theme => ({\n  noData: {\n    height: 172.72 // The height of three QuantityRows\n  }\n}))\nconst MaterialTabs = React.memo(({value, onChange, node}) => {\n  const styles = useMaterialTabsStyles()\n  const nElems = node?.n_elements\n  const nElemsLabel = nElementMap[nElems]\n  const n_elements = `${nElems}${nElemsLabel ? ` (${nElemsLabel})` : ''}`\n  const tabMap = useMemo(() => {\n    const hasTopology = !isEmpty(node)\n    const hasCell = !isEmpty(node?.cell)\n    const hasSymmetry = !isEmpty(node?.symmetry)\n    const hasPorosity = [\n      node.largest_cavity_diameter,\n      node.pore_limiting_diameter,\n      node.accessible_surface_area,\n      node.accessible_volume,\n      node.void_fraction,\n      node.n_of_channels\n    ].some(x => !isNil(x))\n    const hasSbu = [\n      node.sbu_type,\n      node.sbu_coordination_number\n    ].some(x => !isNil(x))\n    const hasActiveOrbitals = !isEmpty(node?.active_orbitals)\n    const hasCoreHole = hasActiveOrbitals && node?.label === 'core-hole'\n    const tabMap = {\n      composition: hasTopology && {\n        label: 'Composition'\n      },\n      cell: hasCell && {\n        label: 'Cell'\n      },\n      porosity: hasPorosity && {\n        label: 'Porosity'\n      },\n      sbu: hasSbu && {\n        label: 'SBU'\n      },\n      symmetry: hasSymmetry && {\n        label: 'Symmetry'\n      },\n      coreHole: hasCoreHole && {\n        label: 'Core-hole'\n      }\n    }\n    return tabMap\n  }, [node])\n\n  const finalValue = tabMap[value] ? value : 'composition'\n\n  return <>\n    <Tabs\n      value={finalValue}\n      onChange={onChange}\n      indicatorColor=\"primary\"\n      textColor=\"primary\"\n      variant=\"scrollable\"\n      scrollButtons=\"auto\"\n      TabScrollButtonProps={{classes: {disabled: styles.scrollbutton}}}\n    >\n      {Object.entries(tabMap).map(([key, value]) => value ? <Tab key={key} value={key} {...value}/> : null)}\n    </Tabs>\n    <MaterialTab selected={finalValue} value=\"composition\">\n      <QuantityTable fixed>\n        <QuantityRow separator>\n          <QuantityCell value={node?.chemical_formula_hill} quantity=\"results.material.topology.chemical_formula_hill\"/>\n          <QuantityCell value={node?.chemical_formula_iupac} quantity=\"results.material.topology.chemical_formula_iupac\"/>\n        </QuantityRow>\n        <QuantityRow>\n          <QuantityCell value={node?.structural_type} quantity=\"results.material.topology.structural_type\"/>\n          <QuantityCell value={node?.label} quantity=\"results.material.topology.label\"/>\n          <QuantityCell value={node?.material_id} quantity=\"results.material.topology.material_id\"/>\n        </QuantityRow>\n        <QuantityRow>\n          <QuantityCell value={node?.elements} quantity=\"results.material.topology.elements\"/>\n          <QuantityCell\n            quantity=\"results.material.topology.n_elements\"\n            value={n_elements}\n            format={false}\n          />\n          <QuantityCell value={node?.n_atoms} quantity=\"results.material.topology.n_atoms\"/>\n        </QuantityRow>\n      </QuantityTable>\n    </MaterialTab>\n    <MaterialTab selected={finalValue} value=\"porosity\">\n      <QuantityTable fixed>\n        <QuantityRow>\n          <QuantityCell value={node?.largest_cavity_diameter} label=\"LCD\" quantity=\"results.material.topology.largest_cavity_diameter\"/>\n          <QuantityCell value={node?.pore_limiting_diameter} label=\"PLD\" quantity=\"results.material.topology.pore_limiting_diameter\"/>\n          <QuantityCell value={node?.largest_included_sphere_along_free_sphere_path} label=\"LFPD\" quantity=\"results.material.topology.largest_included_sphere_along_free_sphere_path\"/>\n        </QuantityRow>\n        <QuantityRow>\n          <QuantityCell value={node?.accessible_surface_area} label=\"ASA\" quantity=\"results.material.topology.accessible_surface_area\"/>\n          <QuantityCell value={node?.accessible_volume} colSpan={2} label=\"AV\" quantity=\"results.material.topology.accessible_volume\"/>\n        </QuantityRow>\n        <QuantityRow>\n          <QuantityCell value={node?.void_fraction} quantity=\"results.material.topology.void_fraction\"/>\n          <QuantityCell value={node?.n_channels} colSpan={2} quantity=\"results.material.topology.n_channels\"/>\n        </QuantityRow>\n      </QuantityTable>\n    </MaterialTab>\n    <MaterialTab selected={finalValue} value=\"sbu\">\n      <QuantityTable fixed>\n        <QuantityRow>\n        <QuantityCell value={node?.sbu_coordination_number} quantity=\"results.material.topology.sbu_coordination_number\"/>\n        <QuantityCell value={node?.sbu_type} quantity=\"results.material.topology.sbu_type\"/>\n        </QuantityRow>\n      </QuantityTable>\n    </MaterialTab>\n    <MaterialTab selected={finalValue} value=\"cell\">\n      <QuantityTable fixed>\n        <QuantityRow>\n          <QuantityCell value={node?.cell?.a} quantity=\"results.material.topology.cell.a\"/>\n          <QuantityCell value={node?.cell?.b} quantity=\"results.material.topology.cell.b\"/>\n          <QuantityCell value={node?.cell?.c} quantity=\"results.material.topology.cell.c\"/>\n        </QuantityRow>\n        <QuantityRow>\n          <QuantityCell value={node?.cell?.alpha} quantity=\"results.material.topology.cell.alpha\"/>\n          <QuantityCell value={node?.cell?.beta} quantity=\"results.material.topology.cell.beta\"/>\n          <QuantityCell value={node?.cell?.gamma} quantity=\"results.material.topology.cell.gamma\"/>\n        </QuantityRow>\n        <QuantityRow>\n          <QuantityCell value={node?.cell?.volume} quantity=\"results.material.topology.cell.volume\"/>\n          <QuantityCell value={node?.cell?.mass_density} quantity=\"results.material.topology.cell.mass_density\"/>\n          <QuantityCell value={node?.cell?.atomic_density} quantity=\"results.material.topology.cell.atomic_density\"/>\n        </QuantityRow>\n      </QuantityTable>\n    </MaterialTab>\n    <MaterialTab selected={finalValue} value=\"symmetry\">\n      <QuantityTable>\n        <QuantityRow>\n          <QuantityCell value={node?.symmetry?.crystal_system} quantity=\"results.material.topology.symmetry.crystal_system\"/>\n          <QuantityCell value={node?.symmetry?.bravais_lattice} quantity=\"results.material.topology.symmetry.bravais_lattice\"/>\n          <QuantityCell value={node?.symmetry?.strukturbericht_designation} quantity=\"results.material.topology.symmetry.strukturbericht_designation\"/>\n          <QuantityCell value={node?.symmetry?.space_group_symbol} quantity=\"results.material.topology.symmetry.space_group_symbol\"/>\n        </QuantityRow>\n        <QuantityRow>\n          <QuantityCell value={node?.symmetry?.space_group_number} quantity=\"results.material.topology.symmetry.space_group_number\"/>\n          <QuantityCell value={node?.symmetry?.point_group} quantity=\"results.material.topology.symmetry.point_group\"/>\n          <QuantityCell value={node?.symmetry?.hall_number} quantity=\"results.material.topology.symmetry.hall_number\"/>\n          <QuantityCell value={node?.symmetry?.hall_symbol} quantity=\"results.material.topology.symmetry.hall_symbol\"/>\n        </QuantityRow>\n        <QuantityRow>\n          <QuantityCell value={node?.symmetry?.prototype_name} quantity=\"results.material.topology.symmetry.prototype_name\"/>\n          <QuantityCell value={node?.symmetry?.prototype_label_aflow} quantity=\"results.material.topology.symmetry.prototype_label_aflow\"/>\n        </QuantityRow>\n      </QuantityTable>\n    </MaterialTab>\n    <MaterialTab selected={finalValue} value=\"coreHole\">\n      <QuantityTable>\n        <QuantityRow>\n          <QuantityCell value={node?.elements} quantity=\"results.material.topology.elements\"/>\n          <QuantityCell\n            value={node?.active_orbitals?.n_electrons_excited}\n            quantity=\"results.material.topology.active_orbitals.n_electrons_excited\"\n            label=\"excited electrons\"\n            hideIfUnavailable={true}\n          />\n          <QuantityCell\n            value={node?.active_orbitals?.degeneracy}\n            quantity=\"results.material.topology.active_orbitals.degeneracy\"\n            hideIfUnavailable={true}\n          />\n        </QuantityRow>\n        <QuantityRow>\n          <QuantityCell\n            value={node?.active_orbitals?.n_quantum_number}\n            quantity=\"results.material.topology.active_orbitals.n_quantum_number\"\n            label=\"n\"\n            hideIfUnavailable={true}\n          />\n          <QuantityCell\n              value={node?.active_orbitals?.l_quantum_symbol}\n              quantity=\"results.material.topology.active_orbitals.l_quantum_symbol\"\n              label=\"l\"\n              hideIfUnavailable={true}\n            />\n          <QuantityCell\n              value={node?.active_orbitals?.ml_quantum_symbol}\n              quantity=\"results.material.topology.active_orbitals.ml_quantum_symbol\"\n              label=\"ml\"\n              hideIfUnavailable={true}\n            />\n          <QuantityCell\n              value={node?.active_orbitals?.ms_quantum_symbol}\n              quantity=\"results.material.topology.active_orbitals.ms_quantum_symbol\"\n              label=\"Spin\"\n              hideIfUnavailable={true}\n            />\n        </QuantityRow>\n      </QuantityTable>\n    </MaterialTab>\n</>\n}) // TODO: Add a cell for the total charge? Or keep it for the composition? + Add j and m_j (which are numerical arrays)\nMaterialTabs.propTypes = {\n  node: PropTypes.object,\n  value: PropTypes.any,\n  onChange: PropTypes.func\n}\n\nconst MaterialTab = React.memo(({selected, value, children}) => {\n  return <div\n    role=\"tabpanel\"\n    hidden={selected !== value}\n    id={`full-width-tabpanel-${value}`}\n    aria-labelledby={`full-width-tab-${value}`}\n  >\n    {children}\n  </div>\n})\nMaterialTab.propTypes = {\n  selected: PropTypes.string.isRequired,\n  value: PropTypes.string.isRequired,\n  children: PropTypes.node\n}\n\nexport default MaterialCardTopology\n\n/**\n * Retrieves the topology for a calculation given the index and archive.\n *\n * @param {object} index\n * @param {object} archive\n *\n * @return {undefined|object} If the given structure cannot be converted,\n * returns an empty object.\n */\nexport function getTopology(index, archive) {\n  // If topology is explicitly stored, use it.\n  let topology\n  if (index?.results?.material?.topology) {\n    topology = merge(\n      cloneDeep(index?.results?.material?.topology),\n      archive?.results?.material?.topology\n    )\n  }\n\n  // Create topology map\n  const topologyMap = Object.fromEntries(topology.map(top => ([top.system_id, top])))\n\n  // Create topology tree by finding the root node and then recursively\n  // replacing its children with the actual child instances.\n  const roots = topology.filter(top => isNil(top.parent_system))\n  const traverse = (node) => {\n    if (!isEmpty(node?.child_systems)) {\n      node.child_systems = node.child_systems.map(id => topologyMap[id])\n      node.child_systems.forEach(child => traverse(child))\n    }\n  }\n  for (const root of roots) {\n    traverse(root)\n  }\n\n  // Simplify the view if there is only one subsystem that covers everything.\n  for (const root of roots) {\n    if (root?.child_systems?.length === 1) {\n      const child = root.child_systems[0]\n      if (child.atomic_fraction === 1 && child?.system_relation?.type === 'subsystem') {\n        child.parent_system = root\n        root.child_systems = child.child_systems\n      }\n    }\n  }\n\n  return [roots, topologyMap]\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { PropertyCard, PropertyGrid, PropertyItem } from './PropertyCard'\nimport { QuantityTable, QuantityRow, QuantityCell } from '../../Quantity'\n\n/**\n * Displays a summary of material related properties for an entry.\n */\nconst MaterialCardFormula = React.memo(({index}) => {\n  if (!index?.results?.material) {\n    return null\n  }\n\n  return <PropertyCard title=\"Material\">\n    <PropertyGrid>\n      <PropertyItem title=\"Composition\" xs={12} height=\"auto\">\n        <QuantityTable data={index}>\n          <QuantityRow>\n            <QuantityCell quantity=\"results.material.chemical_formula_iupac\"/>\n            <QuantityCell quantity=\"results.material.chemical_formula_reduced\"/>\n          </QuantityRow>\n          <QuantityRow>\n            <QuantityCell quantity=\"results.material.chemical_formula_hill\"/>\n            <QuantityCell quantity=\"results.material.chemical_formula_descriptive\"/>\n          </QuantityRow>\n          <QuantityRow>\n            <QuantityCell quantity=\"results.material.elements\"/>\n            <QuantityCell quantity=\"results.material.n_elements\"/>\n          </QuantityRow>\n        </QuantityTable>\n      </PropertyItem>\n    </PropertyGrid>\n  </PropertyCard>\n})\n\nMaterialCardFormula.propTypes = {\n  index: PropTypes.object\n}\n\nexport default MaterialCardFormula\n","/* eslint-disable quotes */\n/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport H5Web from '../../visualization/H5Web'\nimport { Card, makeStyles } from '@material-ui/core'\n\nconst useNexusCardStyles = makeStyles(theme => ({\n  root: {\n    height: 500\n  }\n}))\n\nconst NexusCard = React.memo(function NexusCard({index}) {\n  const classes = useNexusCardStyles()\n  if (index.parser_name !== 'pynxtools.nomad.entrypoints:nexus_parser') {\n    return null\n  }\n  return (\n    <Card className={classes.root}>\n      <H5Web upload_id={index.upload_id} filename={index.mainfile} initialPath=\"/\"/>\n    </Card>\n  )\n})\nNexusCard.propTypes = {\n  index: PropTypes.object.isRequired\n}\n\nexport default NexusCard\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useEffect, useState, useMemo} from 'react'\nimport PropTypes from 'prop-types'\nimport { useTheme } from '@material-ui/core/styles'\nimport Plot from '../plotting/Plot'\nimport { mergeObjects } from '../../utils'\nimport { Quantity } from '../units/Quantity'\nimport { Unit } from '../units/Unit'\nimport { withErrorHandler } from '../ErrorHandler'\n\nconst HeatCapacity = React.memo(({\n  data,\n  layout,\n  className,\n  units,\n  'data-testid': testID,\n  ...other\n}) => {\n  const tempUnit = useMemo(() => new Unit('kelvin'), [])\n  const capacityUnit = useMemo(() => new Unit('joule / kelvin'), [])\n  const [finalData, setFinalData] = useState(!data ? data : undefined)\n  const theme = useTheme()\n\n  // Merge custom layout with default layout\n  const finalLayout = useMemo(() => {\n    const defaultLayout = {\n      xaxis: {\n        title: {\n          text: `Temperature (${tempUnit.toSystem(units).label()})`\n        },\n        zeroline: false\n      },\n      yaxis: {\n        title: {\n          text: `Heat capacity (${capacityUnit.toSystem(units).label()})`\n        },\n        zeroline: false\n      }\n    }\n    return mergeObjects(layout, defaultLayout)\n  }, [layout, units, tempUnit, capacityUnit])\n\n  // Side effect that runs when the data that is displayed should change. By\n  // running all this heavy stuff within useEffect (instead of e.g. useMemo),\n  // the first render containing the placeholders etc. can be done as fast as\n  // possible.\n  useEffect(() => {\n    if (!data) {\n      setFinalData(data)\n      return\n    }\n\n    // Convert units and determine range\n    const temperatures = new Quantity(data.temperatures, tempUnit).toSystem(units).value()\n    const heatCapacities = new Quantity(data.heat_capacities, capacityUnit).toSystem(units).value()\n\n    // Create the final data that will be plotted.\n    const plotData = [{\n      x: temperatures,\n      y: heatCapacities,\n      type: 'scatter',\n      mode: 'lines',\n      line: {\n        color: theme.palette.primary.main,\n        width: 2\n      }\n    }]\n\n    setFinalData(plotData)\n  }, [data, units, tempUnit, capacityUnit, theme])\n\n  return <Plot\n    data={finalData}\n    layout={finalLayout}\n    floatTitle=\"Heat capacity\"\n    metaInfoLink={data?.m_path}\n    data-testid={testID}\n    className={className}\n    {...other}\n  />\n})\n\nHeatCapacity.propTypes = {\n  data: PropTypes.oneOfType([\n    PropTypes.bool, // Set to false to show NoData component\n    PropTypes.shape({\n      heat_capacities: PropTypes.array.isRequired,\n      temperatures: PropTypes.array.isRequired,\n      m_path: PropTypes.string // Path of the section containing the data in the Archive\n    })\n  ]),\n  layout: PropTypes.object,\n  className: PropTypes.string,\n  units: PropTypes.object, // Contains the unit configuration\n  'data-testid': PropTypes.string\n}\nHeatCapacity.defaultProps = {\n  type: 'electronic'\n}\n\nexport default withErrorHandler('Could not load heat capacity.')(HeatCapacity)\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useEffect, useState, useMemo} from 'react'\nimport PropTypes from 'prop-types'\nimport { useTheme } from '@material-ui/core/styles'\nimport Plot from '../plotting/Plot'\nimport { mergeObjects } from '../../utils'\nimport { Quantity } from '../units/Quantity'\nimport { Unit } from '../units/Unit'\nimport { withErrorHandler } from '../ErrorHandler'\n\nconst HelmholtzFreeEnergy = React.memo(({\n  data,\n  layout,\n  className,\n  units,\n  'data-testid': testID,\n  ...other\n}) => {\n  const tempUnit = useMemo(() => new Unit('kelvin'), [])\n  const energyUnit = useMemo(() => new Unit('joule'), [])\n\n  // Merge custom layout with default layout\n  const finalLayout = useMemo(() => {\n    const defaultLayout = {\n      xaxis: {\n        title: {\n          text: `Temperature (${tempUnit.toSystem(units).label()})`\n        },\n        zeroline: false\n      },\n      yaxis: {\n        title: {\n          text: `Helmholtz free energy (${energyUnit.toSystem(units).label()})`\n        },\n        zeroline: false\n      }\n    }\n    return mergeObjects(layout, defaultLayout)\n  }, [layout, units, energyUnit, tempUnit])\n\n  const [finalData, setFinalData] = useState(!data ? data : undefined)\n  const theme = useTheme()\n\n  // Side effect that runs when the data that is displayed should change. By\n  // running all this heavy stuff within useEffect (instead of e.g. useMemo),\n  // the first render containing the placeholders etc. can be done as fast as\n  // possible.\n  useEffect(() => {\n    if (!data) {\n      setFinalData(data)\n      return\n    }\n\n    // Convert units\n    const temperatures = new Quantity(data.temperatures, tempUnit).toSystem(units).value()\n    const energies = new Quantity(data.energies, energyUnit).toSystem(units).value()\n\n    // Create the final data that will be plotted.\n    const plotData = [{\n      x: temperatures,\n      y: energies,\n      type: 'scatter',\n      mode: 'lines',\n      line: {\n        color: theme.palette.primary.main,\n        width: 2\n      }\n    }]\n\n    setFinalData(plotData)\n  }, [data, units, energyUnit, tempUnit, theme])\n\n  return <Plot\n    data={finalData}\n    layout={finalLayout}\n    floatTitle=\"Helmholtz free energy\"\n    metaInfoLink={data?.m_path}\n    data-testid={testID}\n    className={className}\n    {...other}\n  />\n})\n\nHelmholtzFreeEnergy.propTypes = {\n  data: PropTypes.oneOfType([\n    PropTypes.bool, // Set to false to show NoData component\n    PropTypes.shape({\n      energies: PropTypes.array.isRequired,\n      temperatures: PropTypes.array.isRequired,\n      m_path: PropTypes.string // Path of the section containing the data in the Archive\n    })\n  ]),\n  layout: PropTypes.object,\n  className: PropTypes.string,\n  units: PropTypes.object, // Contains the unit configuration\n  'data-testid': PropTypes.string\n}\n\nexport default withErrorHandler('Could not load Helmholtz free energy.')(HelmholtzFreeEnergy)\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useCallback, useMemo } from 'react'\nimport PropTypes from 'prop-types'\nimport { Subject } from 'rxjs'\nimport DOS from './DOS'\nimport BandStructure from './BandStructure'\nimport HeatCapacity from './HeatCapacity'\nimport { PropertyGrid, PropertyItem } from '../entry/properties/PropertyCard'\nimport HelmholtzFreeEnergy from './HelmholtzFreeEnergy'\nimport { Quantity } from '../units/Quantity'\n\nconst VibrationalProperties = React.memo(({\n  bs,\n  dos,\n  freeEnergy,\n  heatCapacity,\n  units\n}) => {\n  // Find minimum and maximum from DOS/BS. Use this range for both plots.\n  const range = useMemo(() => {\n    let range = [undefined, undefined]\n    if (dos) {\n      const energies = []\n      dos.forEach(d => {\n        if (d.energies) energies.push(...d.energies)\n      })\n      const min = Math.min(...energies)\n      const max = Math.max(...energies)\n      range = new Quantity([min, max], 'joule').toSystem(units).value()\n    }\n    return range\n  }, [dos, units])\n\n  // RxJS subject for efficiently propagating y axis changes between DOS and BS\n  const bsYSubject = useMemo(() => new Subject(), [])\n  const dosYSubject = useMemo(() => new Subject(), [])\n  const bsLayout = useMemo(() => ({yaxis: {autorange: false, range: range}}), [range])\n  const dosLayout = useMemo(() => ({yaxis: {autorange: false, range: range}}), [range])\n\n  // Synchronize panning between BS/DOS plots\n  const handleBSRelayouting = useCallback((event) => {\n    const update = {yaxis: {range: [event['yaxis.range[0]'], event['yaxis.range[1]']]}}\n    bsYSubject.next(update)\n  }, [bsYSubject])\n  const handleDOSRelayouting = useCallback((event) => {\n    const update = {yaxis: {range: [event['yaxis.range[0]'], event['yaxis.range[1]']]}}\n    dosYSubject.next(update)\n  }, [dosYSubject])\n\n  return <PropertyGrid>\n    <PropertyItem title=\"Phonon dispersion\" xs={8}>\n      <BandStructure\n        data={bs}\n        layout={bsLayout}\n        units={units}\n        onRelayouting={handleBSRelayouting}\n        onReset={() => { bsYSubject.next({yaxis: {range: range}}) }}\n        layoutSubject={dosYSubject}\n        metaInfoLink={bs ? bs[0].m_path : null}\n        type=\"vibrational\"\n        data-testid=\"bs-phonon\"\n      />\n    </PropertyItem>\n    <PropertyItem title=\"Phonon density of states\" xs={4}>\n      <DOS\n        data={dos}\n        layout={dosLayout}\n        onRelayouting={handleDOSRelayouting}\n        onReset={() => { dosYSubject.next({yaxis: {range: range}}) }}\n        units={units}\n        layoutSubject={bsYSubject}\n        metaInfoLink={dos ? dos[0].m_path : null}\n        type=\"vibrational\"\n        data-testid=\"dos-phonon\"\n      />\n    </PropertyItem>\n    <PropertyItem title=\"Heat capacity\" xs={6}>\n      <HeatCapacity\n        data={heatCapacity}\n        units={units}\n        data-testid=\"heat-capacity\"\n      />\n    </PropertyItem>\n    <PropertyItem title=\"Helmholtz free energy\" xs={6}>\n      <HelmholtzFreeEnergy\n        data={freeEnergy}\n        units={units}\n        data-testid=\"energy-free\"\n      />\n    </PropertyItem>\n  </PropertyGrid>\n})\n\nVibrationalProperties.propTypes = {\n  dos: PropTypes.any, // Set to false if not available, set to other falsy value to show placeholder.\n  bs: PropTypes.any, // Set to false if not available, set to other falsy value to show placeholder.\n  freeEnergy: PropTypes.any, // Set to false if not available, set to other falsy value to show placeholder.\n  heatCapacity: PropTypes.any, // Set to false if not available, set to other falsy value to show placeholder.\n  range: PropTypes.array,\n  units: PropTypes.object // Contains the unit configuration\n}\n\nexport default VibrationalProperties\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { PropertyCard } from './PropertyCard'\nimport { useUnitContext } from '../../units/UnitContext'\nimport { getLocation, resolveInternalRef } from '../../../utils'\nimport { refPath } from '../../archive/metainfo'\nimport VibrationalProperties from '../../visualization/VibrationalProperties'\n\n/**\n * Card displaying vibrational properties.\n */\nconst VibrationalPropertiesCard = React.memo(({index, properties, archive}) => {\n  const {units} = useUnitContext()\n  const urlPrefix = `${getLocation()}/data`\n\n  // Find out which properties are present\n  const hasDos = properties.has('dos_phonon')\n  const hasBs = properties.has('band_structure_phonon')\n  const hasEnergyFree = properties.has('energy_free_helmholtz')\n  const hasHeatCapacity = properties.has('heat_capacity_constant_volume')\n\n  // Do not show the card if none of the properties are available\n  if (!hasDos && !hasBs && !hasEnergyFree && !hasHeatCapacity) {\n    return null\n  }\n\n  // Resolve phonon DOS\n  let dos = hasDos ? null : false\n  const dosData = archive?.results?.properties?.vibrational?.dos_phonon\n  if (dosData) {\n    dos = {}\n    dos.energies = resolveInternalRef(dosData.energies, archive)\n    dos.densities = resolveInternalRef(dosData.total, archive).map(dos => dos.value)\n    dos.m_path = `${urlPrefix}/${refPath(dosData.energies.split('/').slice(0, -1).join('/'))}`\n    dos = [dos]\n  }\n\n  // Resolve phonon band structure\n  let bs = hasBs ? null : false\n  const bsData = archive?.results?.properties?.vibrational?.band_structure_phonon\n  if (bsData) {\n    bs = {}\n    bs.segment = resolveInternalRef(bsData.segment, archive)\n    bs.m_path = `${urlPrefix}/${refPath(bsData.segment[0].split('/').slice(0, -2).join('/'))}`\n    bs = [bs]\n  }\n\n  // Resolve free energy\n  let energyFree = hasEnergyFree ? null : false\n  const energyFreeData = archive?.results?.properties?.vibrational?.energy_free_helmholtz\n  if (energyFreeData) {\n    energyFree = {}\n    energyFree.energies = resolveInternalRef(energyFreeData.energies, archive)\n    energyFree.temperatures = resolveInternalRef(energyFreeData.temperatures, archive)\n    energyFree.m_path = `${urlPrefix}/${refPath(energyFreeData.energies)}`\n  }\n\n  // Resolve heat capacity\n  let heatCapacity = hasHeatCapacity ? null : false\n  const heatCapacityData = archive?.results?.properties?.vibrational?.heat_capacity_constant_volume\n  if (heatCapacityData) {\n    heatCapacity = {}\n    heatCapacity.heat_capacities = resolveInternalRef(heatCapacityData.heat_capacities, archive)\n    heatCapacity.temperatures = resolveInternalRef(heatCapacityData.temperatures, archive)\n    heatCapacity.m_path = `${urlPrefix}/${refPath(heatCapacityData.heat_capacities)}`\n  }\n\n  // TODO implement plotting of multiple dos and bs data\n  return <PropertyCard title=\"Vibrational properties\">\n    <VibrationalProperties\n      bs={bs}\n      dos={dos}\n      heatCapacity={heatCapacity}\n      freeEnergy={energyFree}\n      units={units}\n    />\n  </PropertyCard>\n})\n\nVibrationalPropertiesCard.propTypes = {\n  index: PropTypes.object.isRequired,\n  properties: PropTypes.object.isRequired,\n  archive: PropTypes.object\n}\n\nexport default VibrationalPropertiesCard\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { } from 'react'\nimport PropTypes from 'prop-types'\nimport { SectionTable } from '../Quantity'\nimport { PropertyGrid, PropertyItem } from '../entry/properties/PropertyCard'\nimport EnergyVolumeCurve from '../visualization/EnergyVolumeCurve'\n\n/**\n * Shows a summary of Mechanical properties.\n */\nconst modulusQuantities = {\n  type: {label: 'Type', align: 'left'},\n  value: {label: 'Value', align: 'right'}\n}\nconst MechanicalProperties = React.memo(({\n  evCurves,\n  bulkModulus,\n  shearModulus,\n  units\n}) => {\n  return <PropertyGrid>\n    {evCurves !== false && <PropertyItem title=\"Energy-volume curve\" xs={12} height=\"500px\">\n      <EnergyVolumeCurve\n        data={evCurves}\n        units={units}\n        data-testid=\"energy-volume-curve\"\n      />\n    </PropertyItem>}\n    <PropertyItem title=\"Bulk modulus\" xs={6} height=\"auto\">\n      <SectionTable\n        horizontal\n        section=\"results.properties.mechanical.bulk_modulus\"\n        quantities={modulusQuantities}\n        data={bulkModulus}\n        units={units}\n        data-testid=\"bulk-modulus\"\n      />\n    </PropertyItem>\n    <PropertyItem title=\"Shear modulus\" xs={6} height=\"auto\">\n      <SectionTable\n        horizontal\n        section=\"results.properties.mechanical.shear_modulus\"\n        quantities={modulusQuantities}\n        data={shearModulus}\n        units={units}\n        data-testid=\"shear-modulus\"\n      />\n    </PropertyItem>\n  </PropertyGrid>\n})\n\nMechanicalProperties.propTypes = {\n  evCurves: PropTypes.any, // Set to false if not available, set to other falsy value to show placeholder.\n  bulkModulus: PropTypes.any, // Set to false if not available, set to other falsy value to show placeholder.\n  shearModulus: PropTypes.any, // Set to false if not available, set to other falsy value to show placeholder.\n  units: PropTypes.object // Contains the unit configuration\n}\n\nexport default MechanicalProperties\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { PropertyCard } from './PropertyCard'\nimport { useUnitContext } from '../../units/UnitContext'\nimport { getLocation, resolveInternalRef } from '../../../utils'\nimport { refPath } from '../../archive/metainfo'\nimport MechanicalProperties from '../../visualization/MechanicalProperties'\n\n/**\n * Card displaying mechanical properties.\n */\nconst MechanicalPropertiesCard = React.memo(({index, properties, archive}) => {\n  const {units} = useUnitContext()\n  const urlPrefix = `${getLocation()}/data`\n\n  // Find out which properties are present\n  const hasEVCurves = properties.has('energy_volume_curve')\n  const hasBulkModulus = properties.has('bulk_modulus')\n  const hasShearModulus = properties.has('shear_modulus')\n\n  // Do not show the card if none of the properties are available\n  if (!hasBulkModulus && !hasEVCurves && !hasShearModulus) {\n    return null\n  }\n\n  // Resolve EV curves\n  let evCurves = hasEVCurves ? null : false\n  if (hasEVCurves && archive) {\n    const evCurveData = archive?.results?.properties?.mechanical?.energy_volume_curve\n    evCurves = {\n      m_path: `${urlPrefix}/${refPath(evCurveData[0].volumes.split('/').slice(0, -1).join('/'))}`,\n      data: evCurveData.map(ev => ({\n        volumes: resolveInternalRef(ev.volumes, archive),\n        energies: resolveInternalRef(ev.energies_raw || ev.energies_fit, archive),\n        name: ev.type\n      }))\n    }\n  }\n\n  // Resolve bulk modulus\n  let bulkModulus = false\n  if (hasBulkModulus) {\n    bulkModulus = {\n      data: index?.results?.properties?.mechanical?.bulk_modulus\n    }\n  }\n\n  // Resolve shear modulus\n  let shearModulus = false\n  if (hasShearModulus) {\n    shearModulus = {\n      data: index?.results?.properties?.mechanical?.shear_modulus\n    }\n  }\n\n  return <PropertyCard title=\"Mechanical properties\">\n    <MechanicalProperties\n      evCurves={evCurves}\n      bulkModulus={bulkModulus}\n      shearModulus={shearModulus}\n      units={units}\n    />\n  </PropertyCard>\n})\n\nMechanicalPropertiesCard.propTypes = {\n  index: PropTypes.object.isRequired,\n  properties: PropTypes.object.isRequired,\n  archive: PropTypes.object\n}\n\nexport default MechanicalPropertiesCard\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useState, useEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport { isNil, get } from 'lodash'\nimport { useTheme, makeStyles } from '@material-ui/core/styles'\nimport { Box } from '@material-ui/core'\nimport Plot from '../plotting/Plot'\nimport { mergeObjects, getLocation } from '../../utils'\nimport {\n  PropertyProvenanceItem,\n  PropertyProvenanceList\n} from '../entry/properties/PropertyCard'\nimport { Quantity } from '../units/Quantity'\nimport { Unit } from '../units/Unit'\nimport { useUnitContext } from '../units/UnitContext'\nimport { withErrorHandler } from '../ErrorHandler'\nimport { getPlotLayoutVertical, getPlotTracesVertical } from '../plotting/common'\n\nconst timeUnit = new Unit('second')\nconst energyUnit = new Unit('joule')\nconst temperatureUnit = new Unit('kelvin')\nconst pressureUnit = new Unit('pascal')\nexport const trajectoryPath = ['results', 'properties', 'thermodynamic', 'trajectory']\nexport const trajectoryError = 'Could not load trajectory data.'\n\n/**\n * Plot for the thermodynamic properties reported during molecular dynamics.\n */\nconst useStyles = makeStyles((theme) => ({\n  trajectory: {}\n}))\nconst Trajectory = React.memo(({\n  temperature,\n  pressure,\n  energyPotential,\n  provenance,\n  layout,\n  className,\n  classes,\n  archiveURL,\n  ...other\n}) => {\n  let nPlots = 0\n  if (temperature !== false) ++nPlots\n  if (pressure !== false) ++nPlots\n  if (energyPotential !== false) ++nPlots\n  const styles = useStyles({classes: classes})\n  const theme = useTheme()\n  const {units} = useUnitContext()\n  const [finalData, setFinalData] = useState(nPlots === 0 ? false : undefined)\n  const [finalLayout, setFinalLayout] = useState()\n\n  // Create a configuration for the plot data\n  useEffect(() => {\n    // Since the properties are plotted together, if any of them is laoding, show the\n    // placeholder\n    if ([temperature, pressure, energyPotential].some(isNil)) {\n      setFinalData(undefined)\n      return\n    }\n    // If there is no data, show the NoData component.\n    if (nPlots === 0) {\n      setFinalData(false)\n      return\n    }\n    const traces = [\n      {\n        data: temperature && {\n          x: new Quantity(temperature.time, timeUnit).toSystem(units).value(),\n          y: new Quantity(temperature.value, temperatureUnit).toSystem(units).value()\n        },\n        ytitle: {text: `Temperature (${temperatureUnit.toSystem(units).label()})`}\n      },\n      {\n        data: pressure && {\n          x: new Quantity(pressure.time, timeUnit).toSystem(units).value(),\n          y: new Quantity(pressure.value, pressureUnit).toSystem(units).value()\n        },\n        ytitle: {text: `Pressure (${pressureUnit.toSystem(units).label()})`}\n      },\n      {\n        data: energyPotential && {\n          x: new Quantity(energyPotential.time, timeUnit).toSystem(units).value(),\n          y: new Quantity(energyPotential.value, energyUnit).toSystem(units).value()\n        },\n        ytitle: {text: `Potential energy (${energyUnit.toSystem(units).label()})`}\n      }\n    ]\n    const defaultLayout = getPlotLayoutVertical(\n      traces,\n      {text: `Time (${timeUnit.toSystem(units).label()})`},\n      theme\n    )\n    const mergedLayout = mergeObjects(layout, defaultLayout)\n    setFinalData(getPlotTracesVertical(traces, theme))\n    setFinalLayout(mergedLayout)\n  }, [temperature, pressure, energyPotential, layout, units, theme, nPlots])\n\n  return <Box display=\"flex\" flexDirection=\"column\" height=\"100%\" width=\"100%\">\n    <Box flex=\"1 1 auto\">\n      <Plot\n        data={finalData}\n        layout={finalLayout}\n        floatTitle=\"Trajectory\"\n        fixedMargins={true}\n        className={styles.trajectory}\n        data-testid='trajectory'\n        metaInfoLink={archiveURL}\n        {...other}\n      />\n    </Box>\n    {provenance && <Box flex=\"0 0 auto\">\n      <PropertyProvenanceList xs={12}>\n        <PropertyProvenanceItem\n          title=\"Molecular dynamics\"\n          data={provenance.molecular_dynamics}\n          path={([...trajectoryPath, 'provenance', 'molecular_dynamics']).join('.')}\n        />\n      </PropertyProvenanceList>\n    </Box>}\n  </Box>\n})\n\nconst dynamicShape = PropTypes.oneOfType([\n  PropTypes.bool,\n  PropTypes.shape({\n    value: PropTypes.arrayOf(PropTypes.number),\n    time: PropTypes.arrayOf(PropTypes.number)\n  })\n])\n\nTrajectory.propTypes = {\n  temperature: dynamicShape,\n  pressure: dynamicShape,\n  energyPotential: dynamicShape,\n  provenance: PropTypes.object,\n  layout: PropTypes.object,\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  archiveURL: PropTypes.string // Path for the data in the archive browser\n}\n\nexport default withErrorHandler(trajectoryError)(Trajectory)\n\n/**\n * Fetches all trajectories from the archive and displays them.\n */\nconst useTrajectoriesStyles = makeStyles((theme) => ({\n  trajectory: {height: '450px'}\n}))\nconst TrajectoriesRaw = React.memo(({index, archive}) => {\n  const styles = useTrajectoriesStyles()\n  const urlPrefix = `${getLocation()}/data`\n\n  // Resolve and return component for showing the list of trajectories\n  const trajsIndex = get(index, trajectoryPath) || []\n  const trajsArchive = get(archive, trajectoryPath) || []\n\n  return trajsIndex.map((trajIndex, i) => {\n    const trajProperties = new Set(trajIndex?.available_properties || [])\n    const trajArchive = trajsArchive[i]\n    const hasPressure = trajProperties.has('pressure')\n    const pressure = hasPressure ? trajArchive?.pressure : false\n    const hasTemperature = trajProperties.has('temperature')\n    const temperature = hasTemperature ? trajArchive?.temperature : false\n    const hasEnergyPotential = trajProperties.has('energy_potential')\n    const energyPotential = hasEnergyPotential ? trajArchive?.energy_potential : false\n    const provenance = trajIndex?.provenance || false\n\n    return <Trajectory\n      key={i}\n      pressure={pressure}\n      temperature={temperature}\n      energyPotential={energyPotential}\n      provenance={provenance}\n      classes={{trajectory: styles.trajectory}}\n      archiveURL={`${urlPrefix}/${trajectoryPath.join('/')}:${i}`}\n    />\n  })\n})\n\nTrajectoriesRaw.propTypes = {\n  index: PropTypes.object,\n  archive: PropTypes.object\n}\n\nexport const Trajectories = withErrorHandler(trajectoryError)(TrajectoriesRaw)\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { } from 'react'\nimport PropTypes from 'prop-types'\nimport { PropertyGrid, PropertyItem } from '../entry/properties/PropertyCard'\nimport { Trajectories } from './Trajectory'\n\n/**\n * Shows a summary of thermodynamic properties for the given entry data.\n */\nconst ThermodynamicProperties = React.memo(({index, archive}) => {\n  return <PropertyGrid>\n    <PropertyItem xs={12} title=\"Trajectory\" height=\"auto\">\n      <Trajectories index={index} archive={archive}/>\n    </PropertyItem>\n  </PropertyGrid>\n})\n\nThermodynamicProperties.propTypes = {\n  index: PropTypes.any,\n  archive: PropTypes.any\n}\n\nexport default ThermodynamicProperties\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { PropertyCard } from './PropertyCard'\nimport ThermodynamicProperties from '../../visualization/ThermodynamicProperties'\n\n/**\n * Card displaying molecular dynamics properties.\n */\nconst ThermodynamicPropertiesCard = React.memo(({index, properties, archive}) => {\n  // Check what data is available and do not show the card if none of the\n  // properties are available.\n  const hasTrajectory = properties.has('trajectory')\n  if (!hasTrajectory) return null\n\n  return <PropertyCard title=\"Thermodynamic properties\">\n    <ThermodynamicProperties index={index} archive={archive} />\n  </PropertyCard>\n})\n\nThermodynamicPropertiesCard.propTypes = {\n  index: PropTypes.object.isRequired,\n  properties: PropTypes.object.isRequired,\n  archive: PropTypes.object\n}\n\nexport default ThermodynamicPropertiesCard\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useState, useEffect, useMemo, useCallback} from 'react'\nimport PropTypes from 'prop-types'\nimport assert from 'assert'\nimport { set, get, isNil, isArray, has, capitalize, isPlainObject} from 'lodash'\nimport { useTheme } from '@material-ui/core/styles'\nimport Plot from '../plotting/Plot'\nimport { PropertyGrid, PropertyItem } from '../entry/properties/PropertyCard'\nimport { getLocation, formatNumber, DType } from '../../utils'\nimport { Quantity } from '../units/Quantity'\nimport { Unit } from '../units/Unit'\nimport { useUnitContext } from '../units/UnitContext'\nimport { ErrorHandler, withErrorHandler } from '../ErrorHandler'\nimport { getLineStyles } from '../plotting/common'\n\nconst timeUnit = new Unit('second')\nconst distanceUnitSquared = new Unit('meter**2')\nconst diffusionUnit = new Unit('meter**2 / second')\nexport const msdPath = ['results', 'properties', 'dynamical', 'mean_squared_displacement']\nexport const msdError = 'Could not load mean squared displacement data.'\n\n/**\n * Creates plots for a set of mean squared displacements (msds). The\n * different types of msds (molecular, atomic, etc.) get their own subtitle and\n * all MSDs (regardless of label) are plotted in the same graph.\n */\nconst MeanSquaredDisplacement = React.memo(({\n  msd,\n  className,\n  'data-testid': testID\n}) => {\n  const theme = useTheme()\n  const [finalData, setFinalData] = useState(msd)\n  const [finalLayout, setFinalLayout] = useState()\n  const {units} = useUnitContext()\n\n  // Check that the data is valid. Otherwise raise an exception.\n  assert(isPlainObject(msd), 'Invalid msd data provided.')\n\n  // Side effect that runs when the data that is displayed should change. By\n  // running all this heavy stuff within useEffect (instead of e.g. useMemo),\n  // the first render containing the placeholders etc. can be done as fast as\n  // possible.\n  useEffect(() => {\n    // Loop through different types\n    const tracesAll = {}\n    const layoutAll = {}\n    for (const [type, values] of Object.entries(msd)) {\n      const path = [type]\n      if (isNil(values)) {\n        set(tracesAll, path, undefined)\n        set(layoutAll, path, undefined)\n        continue\n      }\n      if (values === false) {\n        set(tracesAll, path, false)\n        continue\n      }\n      let i = 0\n      const traces = []\n      const lineStyles = getLineStyles(values.length, theme)\n      const layout = {\n        showlegend: true,\n        legend: {\n          x: 1,\n          y: 1,\n          xanchor: 'right'\n        },\n        xaxis: {\n          title: {\n            text: `time (${timeUnit.toSystem(units).label()})`\n          },\n          type: 'log',\n          autorange: true,\n          zeroline: false\n        },\n        yaxis: {\n          title: {\n            text: `msd (${distanceUnitSquared.toSystem(units).label()})`\n          },\n          type: 'log',\n          autorange: true,\n          zeroline: false\n        }\n      }\n      for (const value of values) {\n        assert(isArray(value?.times), `Mean squared displacent was expecting an array of times, but instead got: ${msd?.times}`)\n        assert(isArray(value?.value), `Mean squared displacement was expecting an array of values, but instead got: ${msd?.value}`)\n        const t = new Quantity(value?.times, timeUnit).toSystem(units).value()\n        const val = new Quantity(value?.value, distanceUnitSquared).toSystem(units).value()\n        const diffusionConstant = new Quantity(value?.diffusion_constant_value, diffusionUnit).toSystem(units)\n        const D = formatNumber(diffusionConstant.value(), DType.Float, 'scientific', 2)\n        const D_label = diffusionConstant.label()\n        const diffusionConstantError = new Quantity(value?.diffusion_constant_errors, diffusionUnit)\n        const R = formatNumber(diffusionConstantError.value(), DType.Float, 'standard', 2)\n\n        traces.push({\n          x: t,\n          y: val,\n          name: `${value?.label}: D=${D} ${D_label}; R=${R}`,\n          type: 'scatter',\n          showlegend: true,\n          line: lineStyles[i]\n        })\n        ++i\n      }\n      set(tracesAll, path, traces)\n      set(layoutAll, path, layout)\n      // }\n    }\n    setFinalData(tracesAll)\n    setFinalLayout(layoutAll)\n  }, [msd, units, theme])\n\n  const plots = useMemo(() => {\n    const plots = []\n    finalData && Object.entries(finalData).forEach(([type, values]) => {\n      const title = `${capitalize(type)} mean squared displacements`\n      plots.push(\n        <ErrorHandler message={`Could not load ${title.toLowerCase()}`} key={type}>\n          <PropertyItem xs={12} title={title} height=\"500px\" key={type}>\n            <Plot\n              data={finalData?.[type]}\n              layout={finalLayout?.[type]}\n              floatTitle={title}\n              fixedMargins={true}\n              className={className}\n              data-testid={`${testID}-${type.toLowerCase()}`}\n            /></PropertyItem>\n        </ErrorHandler>\n      )\n    })\n    return plots\n  }, [className, finalData, finalLayout, testID])\n\n  return <PropertyGrid>\n    {plots}\n  </PropertyGrid>\n})\n\nconst msdPlotShape = PropTypes.oneOfType([\n  PropTypes.oneOf([false, undefined]),\n  PropTypes.shape({\n    times: PropTypes.arrayOf(PropTypes.number),\n    value: PropTypes.arrayOf(PropTypes.number)\n  })\n])\nconst msdLabelShape = PropTypes.arrayOf(msdPlotShape)\nconst msdShape = PropTypes.objectOf(msdLabelShape)\n\nMeanSquaredDisplacement.propTypes = {\n  msd: msdShape,\n  className: PropTypes.string,\n  'data-testid': PropTypes.string\n}\n\nMeanSquaredDisplacement.defaultProps = {\n  'data-testid': 'mean-squared-displacement'\n}\n\nexport default withErrorHandler(msdError)(MeanSquaredDisplacement)\n\n/**\n * Returns the plots for all mean squared displacements that are contained in\n * the given archive.\n */\nconst MeanSquaredDisplacementsRaw = React.memo(({\n  index,\n  archive\n}) => {\n  const fromEntry = useCallback((index, archive) => {\n    let msdAll = {}\n    const urlPrefix = `${getLocation()}/data`\n    const msdIndex = get(index, msdPath)\n\n    // No data\n    if (!msdIndex) return msdAll\n\n    // Load the basic information from the index in order to show the plot\n    // layout with placeholders\n    msdIndex.forEach((msd) => {\n      set(msdAll, [msd.type], undefined)\n    })\n\n    // Loading archive\n    if (!archive) return msdAll\n\n    // Full data ready\n    msdAll = {}\n    msdIndex.forEach((msd, i) => {\n      const type = msd.type\n      if (!has(msdAll, type)) msdAll[type] = []\n      const msdArchive = get(archive, msdPath)?.[i]\n      msdAll[type].push({\n        ...msd,\n        ...msdArchive,\n        archiveUrl: `${urlPrefix}/${msdPath.join('/')}:${i}`\n      })\n    })\n    return msdAll\n  }, [])\n  const msd = fromEntry(index, archive)\n\n  return <MeanSquaredDisplacement msd={msd} />\n})\n\nMeanSquaredDisplacementsRaw.propTypes = {\n  index: PropTypes.object,\n  archive: PropTypes.object\n}\n\nexport const MeanSquaredDisplacements = withErrorHandler(msdError)(MeanSquaredDisplacementsRaw)\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { PropertyCard } from './PropertyCard'\nimport { MeanSquaredDisplacements } from '../../visualization/MeanSquaredDisplacement'\n\n/**\n * Card for displaying dynamical properties.\n */\nconst DynamicalPropertiesCard = React.memo(({index, properties, archive}) => {\n  // Check what data is available and do not show the card if none of the properties are\n  // available.\n  const hasMsd = properties.has('mean_squared_displacement')\n  if (!hasMsd) return null\n\n  return <PropertyCard title=\"Dynamical properties\">\n    {hasMsd && <MeanSquaredDisplacements index={index} archive={archive}/>}\n  </PropertyCard>\n})\n\nDynamicalPropertiesCard.propTypes = {\n  index: PropTypes.object.isRequired,\n  properties: PropTypes.object.isRequired,\n  archive: PropTypes.object\n}\n\nexport default DynamicalPropertiesCard\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useState, useEffect, useMemo, useCallback} from 'react'\nimport PropTypes from 'prop-types'\nimport assert from 'assert'\nimport { set, get, isNil, isArray, has, capitalize, isPlainObject} from 'lodash'\nimport { useTheme } from '@material-ui/core/styles'\nimport Plot from '../plotting/Plot'\nimport { PropertyItem, PropertySubGrid } from '../entry/properties/PropertyCard'\nimport { getLocation } from '../../utils'\nimport { Quantity } from '../units/Quantity'\nimport { Unit } from '../units/Unit'\nimport { useUnitContext } from '../units/UnitContext'\nimport { ErrorHandler, withErrorHandler } from '../ErrorHandler'\nimport { getLineStyles } from '../plotting/common'\n\nconst distanceUnit = new Unit('meter')\nexport const rdfPath = ['results', 'properties', 'structural', 'radial_distribution_function']\nexport const rdfError = 'Could not load radial distribution function data.'\n\n/**\n * Creates plots for a set of radial distribution functions (RDFs). The\n * different types of rdfs (molecular, atomic, etc.) get their own subtitle and\n * all RDFs with the same label are plotted in the same graph.\n */\nconst RadialDistributionFunction = React.memo(({\n  rdf,\n  className,\n  'data-testid': testID\n}) => {\n  const theme = useTheme()\n  const [finalData, setFinalData] = useState(rdf)\n  const [finalLayout, setFinalLayout] = useState()\n  const {units} = useUnitContext()\n\n  // Check that the data is valid. Otherwise raise an exception.\n  assert(isPlainObject(rdf), 'Invalid rdf data provided.')\n\n  // Side effect that runs when the data that is displayed should change. By\n  // running all this heavy stuff within useEffect (instead of e.g. useMemo),\n  // the first render containing the placeholders etc. can be done as fast as\n  // possible.\n  useEffect(() => {\n    // Loop through different types\n    const tracesAll = {}\n    const layoutAll = {}\n    for (const [type, labels] of Object.entries(rdf)) {\n      for (const [label, values] of Object.entries(labels)) {\n        const path = [type, label]\n        if (isNil(values)) {\n          set(tracesAll, path, undefined)\n          set(layoutAll, path, undefined)\n          continue\n        }\n        if (values === false) {\n          set(tracesAll, path, false)\n          continue\n        }\n        let i = 0\n        const traces = []\n        const lineStyles = getLineStyles(values.length, theme)\n        const layout = {\n          showlegend: true,\n          legend: {\n            x: 1,\n            y: 1,\n            xanchor: 'right'\n          },\n          xaxis: {\n            title: {\n              text: `${label} distance (${distanceUnit.toSystem(units).label()})`\n            },\n            zeroline: false\n          },\n          yaxis: {\n            title: {\n              text: `g(r)`\n            },\n            zeroline: false\n          }\n        }\n        for (const value of values) {\n          assert(isArray(value?.bins), `Radial distribution function was expecting an array of bins, but instead got: ${rdf?.bins}`)\n          assert(isArray(value?.value), `Radial distribution function was expecting an array of values, but instead got: ${rdf?.value}`)\n          const r = new Quantity(value?.bins, distanceUnit).toSystem(units).value()\n          traces.push({\n            x: r,\n            y: value.value,\n            name: `Frames: ${value.frame_start}-${value.frame_end}`,\n            type: 'scatter',\n            showlegend: true,\n            line: lineStyles[i]\n          })\n          ++i\n        }\n        set(tracesAll, path, traces)\n        set(layoutAll, path, layout)\n      }\n    }\n    setFinalData(tracesAll)\n    setFinalLayout(layoutAll)\n  }, [rdf, units, theme])\n\n  const plots = useMemo(() => {\n    const plots = []\n    finalData && Object.entries(finalData).forEach(([type, labels]) => {\n      const title = `${capitalize(type)} radial distribution functions`\n      plots.push(\n        <ErrorHandler message={`Could not load ${title.toLowerCase()}`} key={type}>\n          <PropertyItem xs={12} title={title} height=\"auto\" key={type}>\n            <PropertySubGrid>\n              {Object.keys(labels).map((label, i) => <PropertyItem\n                xs={12}\n                key={`${type}_${label}_${i}`}\n                height=\"300px\"\n              ><Plot\n                data={finalData?.[type]?.[label]}\n                layout={finalLayout?.[type]?.[label]}\n                floatTitle={title}\n                fixedMargins={true}\n                className={className}\n                data-testid={`${testID}-${type.toLowerCase()}-${label.toLowerCase()}`}\n              /></PropertyItem>)}\n            </PropertySubGrid>\n          </PropertyItem>\n        </ErrorHandler>\n      )\n    })\n    return plots\n  }, [className, finalData, finalLayout, testID])\n\n  return plots\n})\n\nconst rdfPlotShape = PropTypes.oneOfType([\n  PropTypes.shape({\n    bins: PropTypes.arrayOf(PropTypes.number),\n    value: PropTypes.arrayOf(PropTypes.number)\n  }),\n  PropTypes.oneOf([false, undefined])\n])\nconst rdfLabelShape = PropTypes.objectOf(PropTypes.arrayOf(rdfPlotShape))\nconst rdfShape = PropTypes.objectOf(rdfLabelShape)\n\nRadialDistributionFunction.propTypes = {\n  rdf: rdfShape,\n  className: PropTypes.string,\n  'data-testid': PropTypes.string\n}\n\nRadialDistributionFunction.defaultProps = {\n  'data-testid': 'radial-distribution-function'\n}\n\nexport default withErrorHandler(rdfError)(RadialDistributionFunction)\n\n/**\n * Returns the plots for all radial distribution functions that are contained in\n * the given archive.\n */\nconst RadialDistributionFunctionsRaw = React.memo(({\n  index,\n  archive\n}) => {\n  const fromEntry = useCallback((index, archive) => {\n    let rdfAll = {}\n    const urlPrefix = `${getLocation()}/data`\n    const rdfIndex = get(index, rdfPath)\n\n    // No data\n    if (!rdfIndex) return rdfAll\n\n    // Load the basic information from the index in order to show the plot\n    // layout with placeholders\n    rdfIndex.forEach((rdf, i) => {\n      set(rdfAll, [rdf.type, rdf.label], undefined)\n    })\n\n    // Loading archive\n    if (!archive) return rdfAll\n\n    // Full data ready\n    rdfAll = {}\n    rdfIndex.forEach((rdf, i) => {\n      const type = rdf.type\n      const label = rdf.label\n      if (!has(rdfAll, type)) rdfAll[type] = {}\n      if (!has(rdfAll[type], label)) rdfAll[type][label] = []\n      const rdfArchive = get(archive, rdfPath)?.[i]\n      rdfAll[type][label].push({\n        ...rdf,\n        ...rdfArchive,\n        archiveUrl: `${urlPrefix}/${rdfPath.join('/')}:${i}`\n      })\n    })\n    return rdfAll\n  }, [])\n  const rdf = fromEntry(index, archive)\n\n  return <RadialDistributionFunction rdf={rdf} />\n})\n\nRadialDistributionFunctionsRaw.propTypes = {\n  index: PropTypes.object,\n  archive: PropTypes.object\n}\n\nexport const RadialDistributionFunctions = withErrorHandler(rdfError)(RadialDistributionFunctionsRaw)\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useState, useEffect, useMemo, useCallback} from 'react'\nimport PropTypes from 'prop-types'\nimport assert from 'assert'\nimport { set, get, isNil, isEqual, isArray, has, capitalize, isPlainObject} from 'lodash'\nimport { useTheme } from '@material-ui/core/styles'\nimport Plot from '../plotting/Plot'\nimport { PropertyItem, PropertySubGrid } from '../entry/properties/PropertyCard'\nimport { getLocation } from '../../utils'\nimport { Quantity } from '../units/Quantity'\nimport { Unit } from '../units/Unit'\nimport { useUnitContext } from '../units/UnitContext'\nimport { ErrorHandler, withErrorHandler } from '../ErrorHandler'\nimport { getLineStyles } from '../plotting/common'\n\nconst timeUnit = new Unit('second')\nconst distanceUnit = new Unit('meter')\nexport const rgPath = ['results', 'properties', 'structural', 'radius_of_gyration']\nexport const rgError = 'Could not load radius of gyration data.'\n\n/**\n * Creates plots for a set of radii of gyration (Rgs). The\n * different types of rgs (molecular, atomic, etc.) get their own subtitle and\n * all Rgs (regardless of label) are plotted in the same graph.\n */\nconst RadiusOfGyration = React.memo(({\n  rg,\n  className,\n  'data-testid': testID\n}) => {\n  const theme = useTheme()\n  const [finalData, setFinalData] = useState(rg)\n  const [finalLayout, setFinalLayout] = useState()\n  const {units} = useUnitContext()\n\n  // Check that the data is valid. Otherwise raise an exception.\n  assert(isPlainObject(rg), 'Invalid rg data provided.')\n\n  // Side effect that runs when the data that is displayed should change. By\n  // running all this heavy stuff within useEffect (instead of e.g. useMemo),\n  // the first render containing the placeholders etc. can be done as fast as\n  // possible.\n  useEffect(() => {\n    // Loop through different types\n    const tracesAll = {}\n    const layoutAll = {}\n    for (const [type, values] of Object.entries(rg)) {\n      const path = [type]\n      if (isNil(values)) {\n        set(tracesAll, path, undefined)\n        set(layoutAll, path, undefined)\n        continue\n      }\n      if (values === false) {\n        set(tracesAll, path, false)\n        continue\n      }\n\n      let i = 0\n      const traces = [[], []]\n      const lineStyles = getLineStyles(values.length, theme)\n      const layout = []\n      layout.push({\n        showlegend: true,\n        legend: {\n          x: 1,\n          y: 1,\n          xanchor: 'right'\n        },\n        xaxis: {\n          title: {\n            text: `Time (${timeUnit.toSystem(units).label()})`\n          },\n          autorange: true,\n          zeroline: false\n        },\n        yaxis: {\n          title: {\n            text: `Rg (${distanceUnit.toSystem(units).label()})`\n          },\n          autorange: true,\n          zeroline: false\n        }\n      })\n      layout.push({\n        showlegend: true,\n        legend: {\n          x: 1,\n          y: 1,\n          xanchor: 'right'\n        },\n        yaxis: {\n          title: 'Occurrence (%)',\n          autorange: true,\n          zeroline: false\n        },\n        xaxis: {\n          title: {\n            text: `Rg (${distanceUnit.toSystem(units).label()})`\n          },\n          autorange: true,\n          zeroline: false\n        }\n      })\n\n      for (const value of values) {\n        assert(isArray(value?.time), `Radius of gyration was expecting an array of times, but instead got: ${rg?.time}`)\n        assert(isArray(value?.value), `Radius of gyration was expecting an array of values, but instead got: ${rg?.value}`)\n        const t = new Quantity(value?.time, timeUnit).toSystem(units).value()\n        const val = new Quantity(value?.value, distanceUnit).toSystem(units).value()\n\n        traces[0].push({\n          x: t,\n          y: val,\n          name: `${value?.label}`,\n          type: 'scatter',\n          showlegend: true,\n          line: lineStyles[i]\n        })\n\n        traces[1].push({\n          x: val,\n          name: `${value?.label}`,\n          type: 'histogram',\n          histnorm: 'percent',\n          showlegend: true,\n          line: lineStyles[i]\n        })\n        ++i\n      }\n      set(tracesAll, path, traces)\n      set(layoutAll, path, layout)\n    }\n    setFinalData(tracesAll)\n    setFinalLayout(layoutAll)\n  }, [rg, units, theme])\n\n  const plots = useMemo(() => {\n    const plots = []\n    finalData && Object.entries(finalData).forEach(([type, values]) => {\n      const title = `${capitalize(type)} radii of gyration`\n      plots.push(\n        <ErrorHandler message={`Could not load ${title.toLowerCase()}`} key={type}>\n          <PropertyItem xs={12} title={title} height=\"auto\" key={type}>\n            <PropertySubGrid>\n              <PropertyItem xs={12} height=\"300px\">\n                <Plot\n                  data={values && values?.[0]}\n                  layout={finalLayout?.[type]?.[0]}\n                  floatTitle={title}\n                  fixedMargins={true}\n                  className={className}\n                  data-testid={`${testID}-${type.toLowerCase()}-0`}\n                />\n              </PropertyItem>\n              <PropertyItem xs={12} height=\"300px\">\n                <Plot\n                  data={values && values?.[1]}\n                  layout={finalLayout?.[type]?.[1]}\n                  floatTitle={title}\n                  fixedMargins={true}\n                  className={className}\n                  data-testid={`${testID}-${type.toLowerCase()}-1`}\n                />\n              </PropertyItem>\n            </PropertySubGrid>\n          </PropertyItem>\n        </ErrorHandler>\n      )\n    })\n    return plots\n  }, [className, finalData, finalLayout, testID])\n\n  return plots\n})\n\nconst rgPlotShape = PropTypes.oneOfType([\n  PropTypes.shape({\n    time: PropTypes.arrayOf(PropTypes.number),\n    value: PropTypes.arrayOf(PropTypes.number)\n  }),\n  PropTypes.oneOf([false, undefined])\n])\nconst rgLabelShape = PropTypes.arrayOf(rgPlotShape)\nconst rgShape = PropTypes.objectOf(rgLabelShape)\n\nRadiusOfGyration.propTypes = {\n  rg: rgShape,\n  methodology: PropTypes.object,\n  className: PropTypes.string,\n  'data-testid': PropTypes.string\n}\n\nRadiusOfGyration.defaultProps = {\n  'data-testid': 'radius-of-gyration'\n}\n\nexport default withErrorHandler(rgError)(RadiusOfGyration)\n\n/**\n * Returns the plots for all radii of gyration that are contained in\n * the given archive.\n */\nconst RadiiOfGyrationRaw = React.memo(({\n  index,\n  archive\n}) => {\n  const fromEntry = useCallback((index, archive) => {\n    const data = {\n      rg: false,\n      methodology: false\n    }\n    const urlPrefix = `${getLocation()}/data`\n    const rgIndex = get(index, rgPath)\n\n    // No data\n    if (!rgIndex) {\n      return data\n    }\n\n    // Load the basic information from the index. If clashing methodologies are\n    // found, an error is raised for now. In the future several methodologies\n    // could be supported by plotting them separately.\n    rgIndex.forEach((rg, i) => {\n      if (rg.methodology) {\n        if (data.methodology && !isEqual(data.methodology, rg.methodology)) {\n          throw Error('Multiple methodologies for Rg not yet supported.')\n        }\n        data.methodology = rg.methodology\n      }\n      set(data.rg, [rg.kind], undefined)\n    })\n\n    // Still loading archive but the amount of plots is already known\n    if (!archive) {\n      return data\n    }\n\n    // Full data ready\n    data.rg = {}\n    rgIndex.forEach((rg, i) => {\n      const kind = rg.kind\n      if (!has(data.rg, kind)) {\n        data.rg[kind] = []\n      }\n      const rgArchive = get(archive, rgPath)?.[i]\n      data.rg[kind].push({\n        ...rg,\n        ...rgArchive,\n        archiveUrl: `${urlPrefix}/${rgPath.join('/')}:${i}`\n      })\n    })\n    return data\n  }, [])\n  const data = fromEntry(index, archive)\n\n  return <RadiusOfGyration {...data} />\n})\n\nRadiiOfGyrationRaw.propTypes = {\n  index: PropTypes.object,\n  archive: PropTypes.object\n}\n\nexport const RadiiOfGyration = withErrorHandler(rgError)(RadiiOfGyrationRaw)\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { RadialDistributionFunctions } from './RadialDistributionFunction'\nimport { RadiiOfGyration } from './RadiusOfGyration'\nimport { PropertyGrid } from '../entry/properties/PropertyCard'\n\nexport const rdfPath = ['results', 'properties', 'structural', 'radial_distribution_function']\nexport const rdfError = 'Could not load radial distribution function data.'\nexport const rgPath = ['results', 'properties', 'structural', 'radius_of_gyration']\n\nconst StructuralProperties = React.memo(({\n  index,\n  properties,\n  archive\n}) => {\n  // Find out which properties are present\n  const hasRdf = properties.has('radial_distribution_function')\n  const hasRg = properties.has('radius_of_gyration')\n\n  return <PropertyGrid>\n    {hasRdf && <RadialDistributionFunctions index={index} archive={archive}/>}\n    {hasRg && <RadiiOfGyration index={index} archive={archive}/>}\n  </PropertyGrid>\n})\n\nStructuralProperties.propTypes = {\n  index: PropTypes.object.isRequired,\n  properties: PropTypes.object.isRequired,\n  archive: PropTypes.object\n}\n\nexport default StructuralProperties\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { PropertyCard } from './PropertyCard'\nimport StructuralProperties from '../../visualization/StructuralProperties'\n\n/**\n * Card for displaying structural properties.\n */\nconst StructuralPropertiesCard = React.memo(({index, properties, archive}) => {\n  // Check what data is available and do not show the card if none of the properties are\n  // available.\n   // Find out which properties are present\n  const hasRdf = properties.has('radial_distribution_function')\n  const hasRg = properties.has('radius_of_gyration')\n\n  // Do not show the card if none of the properties are available\n  if (!hasRdf && !hasRg) {\n    return null\n  }\n\n  return <PropertyCard title=\"Structural properties\">\n    <StructuralProperties\n      index={index}\n      properties={properties}\n      archive={archive}\n    />\n  </PropertyCard>\n})\n\nStructuralPropertiesCard.propTypes = {\n  index: PropTypes.object.isRequired,\n  properties: PropTypes.object.isRequired,\n  archive: PropTypes.object\n}\n\nexport default StructuralPropertiesCard\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useState, useMemo, useEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport assert from 'assert'\nimport { isNil, isArray } from 'lodash'\nimport { useTheme } from '@material-ui/core/styles'\nimport Plot from '../plotting/Plot'\nimport { QuantityTable, QuantityRow, QuantityCell } from '../Quantity'\nimport { ErrorHandler, withErrorHandler } from '../ErrorHandler'\nimport { diffTotal } from '../../utils'\nimport { Quantity } from '../units/Quantity'\nimport { Unit } from '../units/Unit'\nimport { useUnitContext } from '../units/UnitContext'\nimport { PropertyGrid, PropertyItem } from '../entry/properties/PropertyCard'\n\nconst energyUnit = new Unit('joule')\n/**\n * Component for visualizing the results of a geometry optimization workflow.\n */\nconst GeometryOptimization = React.memo(({\n  energies,\n  convergence,\n  className,\n  classes,\n  'data-testid': testID\n}) => {\n  const [finalData, setFinalData] = useState(!energies ? energies : undefined)\n  const {units} = useUnitContext()\n  const theme = useTheme()\n\n  // Side effect that runs when the data that is displayed should change. By\n  // running all this heavy stuff within useEffect (instead of e.g. useMemo),\n  // the first render containing the placeholders etc. can be done as fast as\n  // possible.\n  useEffect(() => {\n    if (!energies) {\n      setFinalData(energies)\n      return\n    }\n\n    // Convert energies into the correct units and calculate the total difference\n    assert(\n      isArray(energies),\n      `Geometry optimization was expecting an array of energies, but instead got: ${energies}`\n    )\n    const energyDiffTotal = new Quantity(diffTotal(energies), energyUnit).toSystem(units).value()\n    const convergenceCriteria = isNil(convergence?.convergence_tolerance_energy_difference)\n      ? undefined\n      : new Quantity(convergence.convergence_tolerance_energy_difference, energyUnit).toSystem(units).value()\n\n    const steps = [...Array(energies.length).keys()]\n    const energyDiff = []\n    for (let i = 0; i < energyDiffTotal.length - 1; ++i) {\n      energyDiff.push(Math.abs(energyDiffTotal[i + 1] - energyDiffTotal[i]))\n    }\n    const traces = [\n      {\n        x: steps,\n        y: energyDiffTotal,\n        name: 'Total change',\n        type: 'scatter',\n        showlegend: false,\n        line: {\n          color: theme.palette.primary.main,\n          width: 2\n        }\n      },\n      {\n        x: steps.slice(1, steps.length),\n        y: energyDiff,\n        yaxis: 'y2',\n        name: 'Abs. change per step',\n        type: 'scatter',\n        showlegend: false,\n        line: {\n          color: theme.palette.secondary.main,\n          width: 2\n        }\n      }\n    ]\n    if (convergenceCriteria) {\n      traces.push({\n        x: [steps[0], steps[steps.length - 1]],\n        y: [\n          convergenceCriteria,\n          convergenceCriteria\n        ],\n        yaxis: 'y2',\n        name: 'Convergence criteria',\n        showlegend: true,\n        type: 'line',\n        mode: 'lines',\n        line: {\n          color: theme.palette.secondary.main,\n          width: 1,\n          dash: '10px,10px'\n        }\n      })\n    }\n    setFinalData(traces)\n  }, [energies, convergence, units, theme])\n\n  const plotLayout = useMemo(() => {\n    if (!energies) {\n      return null\n    }\n    return {\n      showlegend: true,\n      legend: {\n        x: 0,\n        y: 1,\n        xanchor: 'left'\n      },\n      xaxis: {\n        showexponent: 'first',\n        title: {\n          text: 'Step number'\n        },\n        tickmode: 'auto',\n        tickformat: ',d',\n        autorange: false,\n        range: [0, energies.length - 1],\n        zeroline: false,\n        showspikes: true,\n        spikethickness: 2,\n        spikedash: 'dot',\n        spikecolor: '#999999',\n        spikemode: 'across' },\n      yaxis: {\n        title: {\n          text: `Total change (${energyUnit.toSystem(units).label()})`\n        },\n        tickfont: {\n          color: theme.palette.primary.dark\n        },\n        autorange: true,\n        zeroline: false\n      },\n      yaxis2: {\n        title: {\n          text: `Abs. change per step (${energyUnit.toSystem(units).label()})`\n        },\n        tickfont: {\n          color: theme.palette.secondary.dark\n        },\n        type: 'log',\n        autorange: true,\n        zeroline: false,\n        overlaying: 'y',\n        side: 'right'\n      }\n    }\n  }, [energies, theme, units])\n\n  return <PropertyGrid>\n    <PropertyItem title=\"Energy convergence\" xs={12}>\n      <ErrorHandler message='Could not load energies.'>\n        <Plot\n          data={finalData}\n          layout={plotLayout}\n          floatTitle=\"Energy convergence\"\n          data-testid={`${testID}-plot`}\n        />\n      </ErrorHandler>\n    </PropertyItem>\n    <PropertyItem title=\"Convergence results\" xs={12} height=\"auto\">\n      <QuantityTable>\n        <QuantityRow>\n          <QuantityCell\n            quantity='results.properties.geometry_optimization.final_energy_difference'\n            value={convergence?.final_energy_difference}\n          />\n          <QuantityCell\n            quantity='results.properties.geometry_optimization.final_displacement_maximum'\n            value={convergence?.final_displacement_maximum}\n          />\n          <QuantityCell\n            quantity='results.properties.geometry_optimization.final_force_maximum'\n            value={convergence?.final_force_maximum}\n          />\n        </QuantityRow>\n      </QuantityTable>\n    </PropertyItem>\n  </PropertyGrid>\n})\n\nGeometryOptimization.propTypes = {\n  energies: PropTypes.oneOfType([\n    PropTypes.bool,\n    PropTypes.oneOf([undefined]),\n    PropTypes.arrayOf(PropTypes.number)\n  ]),\n  convergence: PropTypes.oneOfType([\n    PropTypes.bool,\n    PropTypes.oneOf([undefined]),\n    PropTypes.shape({\n      final_energy_difference: PropTypes.number,\n      final_displacement_maximum: PropTypes.number,\n      final_force_maximum: PropTypes.number\n    })\n  ]),\n  className: PropTypes.string,\n  classes: PropTypes.object,\n  'data-testid': PropTypes.string\n}\n\nGeometryOptimization.defaultProps = {\n  'data-testid': 'geometry-optimization'\n}\n\nexport default withErrorHandler('Could not load geometry optimization data.')(GeometryOptimization)\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { PropertyCard } from './PropertyCard'\nimport { resolveInternalRef } from '../../../utils'\nimport GeometryOptimization from '../../visualization/GeometryOptimization'\n\nconst GeometryOptimizationCard = React.memo(({index, archive, properties}) => {\n  const geoOptProps = index?.results?.properties?.geometry_optimization\n\n  // Find out which properties are present. If only one step is calculated\n  // (n_calculations == 1 and none of the convergence criteria are available),\n  // the card will not be displayed.\n  const hasEnergies = properties.has('geometry_optimization') &&\n    index?.results?.properties?.n_calculations > 1\n  const hasConvergence = properties.has('geometry_optimization') &&\n    (\n      index?.results?.properties?.geometry_optimization?.final_energy_difference ||\n      index?.results?.properties?.geometry_optimization?.final_displacement_maximum ||\n      index?.results?.properties?.geometry_optimization?.final_force_maximum\n    )\n\n  // Do not show the card if none of the properties are available\n  if (!hasEnergies && !hasConvergence) {\n    return null\n  }\n\n  // Resolve energies\n  let energies = hasEnergies ? null : false\n  const energiesArchive = archive?.results?.properties?.geometry_optimization?.energies\n  if (hasEnergies && energiesArchive) {\n    energies = resolveInternalRef(energiesArchive, archive)\n  }\n\n  // Resolve convergence properties\n  const convergence = hasConvergence ? geoOptProps : false\n\n  return <PropertyCard title=\"Geometry optimization\">\n    <GeometryOptimization\n      energies={energies}\n      convergence={convergence}\n    />\n  </PropertyCard>\n})\n\nGeometryOptimizationCard.propTypes = {\n  index: PropTypes.object.isRequired,\n  properties: PropTypes.object.isRequired,\n  archive: PropTypes.object\n}\n\nexport default GeometryOptimizationCard\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { PropertyCard, PropertyGrid, PropertyItem } from './PropertyCard'\nimport Spectra from '../../visualization/Spectra'\n\n/**\n * Card displaying spectroscopic properties.\n*/\nconst SpectroscopicPropertiesCard = React.memo(({index, properties, archive}) => {\n  // Find out which properties are present\n  const hasSpectra = properties.has('spectra')\n\n  // Do not show the card if none of the properties are available\n  if (!hasSpectra) return null\n\n  // Check index for which types of spectras exist. Create a mapping based on\n  // this: this will allow the GUI to show a placeholder while the data is\n  // loaded from archive.\n  const spectras = hasSpectra ? {} : false\n  for (const spectra of index?.results?.properties?.spectroscopic?.spectra) {\n    spectras[spectra.type] = undefined\n  }\n\n  // When archive is loaded, fill out the information\n  if (archive) {\n    let spectraReferences = archive?.results?.properties?.spectroscopic?.spectra\n    if (!Array.isArray(spectraReferences)) spectraReferences = [spectraReferences]\n    if (spectraReferences) {\n      for (const spectra of spectraReferences) {\n        const data = {}\n        data.type = spectra.type\n        data.label = spectra.label === 'computation' ? 'comp.' : 'exp.'\n        data.intensities = spectra.intensities\n        data.energies = spectra.energies\n        if (data.energies) {\n          if (spectras[spectra.type]) {\n            spectras[spectra.type].push(data)\n          } else {\n            spectras[spectra.type] = [data]\n          }\n        }\n      }\n    }\n  }\n\n  return <PropertyCard title=\"Spectroscopic properties\">\n    <PropertyGrid>\n    {spectras && Object.entries(spectras).map(([key, value]) => {\n      return <PropertyItem key={key} title={key} xs={12}>\n        <Spectra\n          data={value}\n          layout={{yaxis: {autorange: true}}}\n        />\n      </PropertyItem>\n    })}\n    </PropertyGrid>\n  </PropertyCard>\n})\n\nSpectroscopicPropertiesCard.propTypes = {\n  index: PropTypes.object.isRequired,\n  properties: PropTypes.object.isRequired,\n  archive: PropTypes.object\n}\n\nexport default SpectroscopicPropertiesCard\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useState, useEffect, useMemo } from 'react'\nimport PropTypes from 'prop-types'\nimport { Link, IconButton, Typography, makeStyles, Box } from '@material-ui/core'\nimport TooltipButton from '../../utils/TooltipButton'\nimport NavigateNextIcon from '@material-ui/icons/NavigateNext'\nimport { useApi } from '../../api'\nimport { useErrors } from '../../errors'\nimport { Datatable, DatatableTable, DatatablePagePagination } from '../../datatable/Datatable'\nimport { formatTimestamp } from '../../../utils'\nimport Quantity from '../../Quantity'\nimport { PropertyCard } from './PropertyCard'\nimport Ellipsis from '../../visualization/Ellipsis'\n\nconst useResourceDetailsStyles = makeStyles(theme => ({\n  resourceDetails: {\n    padding: theme.spacing(1)\n  },\n  resourceDetailsContents: {\n    display: 'flex',\n    width: '100%',\n    margin: '0'\n  },\n  resourceDetailsRow: {\n    paddingRight: theme.spacing(3)\n  },\n  resourceDetailsActions: {\n    display: 'flex',\n    flexBasis: 'auto',\n    flexGrow: 0,\n    flexShrink: 0,\n    justifyContent: 'flex-end',\n    marginBottom: theme.spacing(1),\n    marginTop: theme.spacing(2)\n  },\n  resourceURL: {\n    overflow: 'hidden',\n    textOverflow: 'ellipsis',\n    width: '11rem'\n  }\n}))\n\nconst ResourceDetails = React.memo(({data}) => {\n  const classes = useResourceDetailsStyles()\n  const downloadTime = {download_time: formatTimestamp(data?.download_time)}\n\n  return <div className={classes.resourceDetails}>\n    <div className={classes.resourceDetailsContents}>\n      <div className={classes.resourceDetailsRow}>\n        <Quantity quantity='download_time' label='Last time accessed' data={downloadTime}></Quantity>\n        <Quantity quantity='available_data' label='Available data' data={data}></Quantity>\n      </div>\n      <div className={classes.resourceDetailsRow}>\n        <Quantity quantity='database_version' label='Database version' data={data}></Quantity>\n      </div>\n      <div className={classes.resourceDetailsRow}>\n        <Quantity quantity='comment' label='Comment' data={data}></Quantity>\n      </div>\n    </div>\n  </div>\n})\n\nResourceDetails.propTypes = {\n  data: PropTypes.object.isRequired\n}\n\nconst ResourceActions = React.memo(({data}) => {\n  return <TooltipButton\n    title=\"Go to resource page.\" component={IconButton}\n    onClick={() => { window.location = data.url }}\n  >\n    <NavigateNextIcon/>\n  </TooltipButton>\n})\n\nResourceActions.propTypes = {\n  data: PropTypes.object.isRequired\n}\n\nconst RelatedResourcesCard = React.memo(({index, archive}) => {\n  const {resourcesApi} = useApi()\n  const {raiseError} = useErrors()\n  const [externalResources, setExternalResources] = useState()\n  const [pagination, setPagination] = useState({\n    page_size: 10, page: 1, order_by: 'id', order: 'asc', total: 0\n  })\n\n  useEffect(() => {\n    const material = archive?.results?.material\n    const spg = material?.symmetry?.space_group_number\n    const structures = archive?.results?.properties?.structures\n    const wyckoffSets = structures?.structure_conventional?.wyckoff_sets\n    const wyckoff = wyckoffSets ? wyckoffSets.map((set) => set?.wyckoff_letter || '') : null\n    const species = structures?.structure_original?.species_at_sites || null\n    const nsites = species ? species.length : null\n    const formula = material?.chemical_formula_reduced\n    const params = []\n    if (spg) {\n      params.push(`space_group_number=${spg}`)\n    }\n    if (wyckoff) {\n      params.push(`wyckoff_letters=${wyckoff.join('&wyckoff_letters=')}`)\n    }\n    if (nsites) {\n      params.push(`n_sites=${nsites}`)\n    }\n    if (formula) {\n      params.push(`chemical_formula_reduced=${formula}`)\n    }\n    resourcesApi.get(`/?${params.join('&')}`).then(response => {\n        setExternalResources(response)\n        setPagination(pagination => ({...pagination, total: response.data.length}))\n      }).catch(raiseError)\n    }, [archive, resourcesApi, raiseError, setExternalResources, setPagination])\n\n  const columns = useMemo(() => [\n    {\n      key: 'id',\n      sortable: true,\n      align: 'left',\n      render: data => (\n        <Typography noWrap>\n          <Ellipsis>{data.id}</Ellipsis>\n        </Typography>\n      )\n    },\n    {\n      key: 'url',\n      sortable: true,\n      align: 'left',\n      render: data => (\n        <Typography noWrap>\n          <Link href={data.url}>\n            <Ellipsis>{data.url}</Ellipsis>\n          </Link>\n        </Typography>\n      )\n    },\n    {\n      key: 'database',\n      sortable: true,\n      align: 'left',\n      render: data => data.database_name\n    }\n  ], [])\n\n  if (!externalResources || (!externalResources.is_retrieving_more && externalResources.data.length === 0)) {\n    return ''\n  }\n\n  const {page_size, page, total, order, order_by} = pagination\n  const compare = (a, b) => {\n    const value = data => String(data[order_by])\n    return value(a).localeCompare(value(b)) * (order === 'asc' ? 1 : -1)\n  }\n  const start = page_size * (page - 1)\n  const end = page_size + start\n  const length = (end > total) ? total - start : page_size\n  const data = [...externalResources.data].sort(compare).slice(start, start + length)\n\n  return <PropertyCard title=\"Related resources\">\n    {externalResources.is_retrieving_more && externalResources.data.length === 0 && (\n      <Box padding={2}>\n        <Typography>Updating external resources, try again later</Typography>\n      </Box>\n    )}\n    {(externalResources.data.length > 0) && (\n      <Datatable\n        columns={columns}\n        data={data}\n        pagination={pagination} onPaginationChanged={setPagination}\n      >\n        <DatatableTable details={ResourceDetails} actions={ResourceActions}>\n          <DatatablePagePagination pageSizeValues={[10, 50, 100]}/>\n        </DatatableTable>\n      </Datatable>\n    )}\n  </PropertyCard>\n})\n\nRelatedResourcesCard.propTypes = {\n  index: PropTypes.object.isRequired,\n  archive: PropTypes.object\n}\n\nexport default RelatedResourcesCard\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useEffect, useMemo, useRef, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport * as d3 from 'd3'\nimport { makeStyles, Tooltip, IconButton, TextField, FormControl } from '@material-ui/core'\nimport grey from '@material-ui/core/colors/grey'\nimport blueGrey from '@material-ui/core/colors/blueGrey'\nimport red from '@material-ui/core/colors/red'\nimport { Replay, Undo, Label, LabelOff, PlayArrowSharp, StopSharp, Clear } from '@material-ui/icons'\nimport { useHistory } from 'react-router-dom'\nimport { isPlainObject } from 'lodash'\nimport { PropertyCard, PropertyGrid } from './PropertyCard'\nimport { resolveNomadUrl, resolveInternalRef, createEntryUrl } from '../../../utils'\nimport { useApi } from '../../api'\nimport { getUrl } from '../../nav/Routes'\nimport { nomadFontFamily, apiBase } from '../../../config'\nimport { useAsyncError } from '../../../hooks'\n\nconst useWorkflowGraphStyles = makeStyles(theme => ({\n  root: {\n    width: '100%',\n    minWidth: 1000,\n    '& .link': {\n      fill: 'none',\n      strokeOpacity: 0.5,\n      fillOpacity: 0.5,\n      strokeWidth: 2.5\n    },\n    '& .text': {\n      fontFamily: nomadFontFamily,\n      fontSize: 12,\n      dy: '0.35em',\n      textAnchor: 'middle'\n    },\n    '& .icon': {\n      strokeWidth: 2,\n      strokeOpacity: 0.5\n    }\n  }\n}))\n\nlet archives = {}\n\nconst resolveSection = async (source, query) => {\n  if (isPlainObject(source.section)) {\n    // already resolved\n    return source\n  }\n\n  let path = source.path\n  if (typeof path !== 'string') path = source.section || '/'\n  const pathSegments = path.split('#').filter(p => p)\n\n  let archive = source.archive\n  let baseUrl = createEntryUrl(apiBase, archive?.metadata?.upload_id, archive?.metadata?.entry_id)\n  let section\n  if (pathSegments.length === 1) {\n    // internal reference\n    path = pathSegments[0]\n    try {\n      section = source.section ? source.path : resolveInternalRef(path, archive)\n    } catch (error) {\n      console.error(`Cannot resolve section ${path}`)\n      return\n    }\n  } else {\n    // external reference\n    // temporary fix for path following the format /entries/entry_id/archive\n    // TODO extend resolveNomadUrl for other reference formats\n    let entryId\n    const match = path.match('/entries/(.+?)/archive')\n    if (match) {\n      entryId = match[1]\n    } else {\n      const url = resolveNomadUrl(path, baseUrl)\n      entryId = url.entryId\n    }\n    const {api, required} = query\n    try {\n      archive = archives[entryId]\n      if (!archive) {\n        const response = await api.post(`/entries/${entryId}/archive/query`, {required: required})\n        archive = response.data.archive\n        archives[entryId] = archive\n      }\n      path = pathSegments[1]\n      if (!path.startsWith('/')) path = `/${path}`\n      section = source.section ? source.path : resolveInternalRef(path, archive)\n    } catch (error) {\n      console.error(`Cannot resolve entry ${entryId}: ${error}`)\n      return\n    }\n  }\n\n  if (!section) return\n\n  baseUrl = createEntryUrl(apiBase, archive?.metadata?.upload_id, archive?.metadata?.entry_id)\n  const match = path.match('.*/([^/]+)/(\\\\d+)$')\n\n  const sectionKeys = query.sectionKeys || []\n  const nChildren = (section) => (sectionKeys.map(key => (section[key] || []).length)).reduce((a, b) => a + b)\n  if (section.task) {\n    const task = await resolveSection({path: section.task, archive: archive}, query)\n    if (!task) return\n    task.section.inputs = section.inputs && section.inputs.length ? section.inputs : task.section.inputs\n    task.section.outputs = section.outputs && section.outputs.length ? section.outputs : task.section.outputs\n    task.nChildren = nChildren(task.section)\n    return task\n  }\n\n  return {\n    name: section.name,\n    section: section,\n    sectionType: match ? match[1] : path.split('/').pop(),\n    path: path,\n    archive: source.section ? null : archive,\n    url: [baseUrl, path].join('#'),\n    entryId: archive?.metadata?.entry_id,\n    color: section.color,\n    nChildren: nChildren(section)\n  }\n}\n\nconst range = (start, stop) => Array.from(Array(stop - start).fill(start).map((n, i) => n + i))\n\nconst getNodes = async (source, query) => {\n  let {resolveIndices, maxNodes} = query\n  const {sectionKeys} = query\n\n  let nodes = source.nodes || []\n  if (nodes.length && !resolveIndices) return nodes\n\n  if (!maxNodes) maxNodes = 7\n\n  const resolved = await resolveSection(source, query)\n  if (!resolved) return nodes\n  const parent = resolved.section\n  if (!parent) return nodes\n\n  nodes = []\n  const archive = resolved.archive\n  for (const key of sectionKeys) {\n    let children = parent[key] || []\n    const nChildren = children.length\n    if (!Array.isArray(children)) children = [children]\n\n    let sectionIndices = range(0, nChildren)\n    if (resolveIndices && resolveIndices[key]) {\n      sectionIndices = resolveIndices[key] || sectionIndices\n    } else if (maxNodes < nChildren) {\n      const mid = Math.floor(maxNodes / 2)\n      // show first and last few nodes\n      sectionIndices = [...range(0, mid), ...range(nChildren - mid, nChildren)]\n    }\n\n    for (const index of sectionIndices) {\n      const child = children[index]\n      if (!child) continue\n\n      let path = child\n      if (!child.section) path = `${source.path}/${key}/${index}`\n      const section = await resolveSection({section: child.section, path: path, archive: archive}, query)\n      if (!section) continue\n\n      section.name = child.name\n      section.type = key\n      section.index = index\n      section.parent = source\n      section.total = nChildren\n      nodes.push(section)\n    }\n  }\n\n  return nodes\n}\n\nconst getLinks = async (source, query) => {\n  if (source.links) return source.links\n\n  const nodes = source.nodes\n  if (!source.nodes) return\n\n  const links = []\n  for (const node of nodes) {\n    if (node.type === 'tasks') {\n      node.nodes = await getNodes(node, query)\n    }\n  }\n\n  const isLinked = (source, target) => {\n    if (source.url === target.url) return false\n\n    const outputs = []\n    if (source.type === 'tasks' && source.nodes) {\n      outputs.push(...source.nodes.filter(node => node.type === 'outputs').map(node => node.url))\n    } else {\n      outputs.push(source.url)\n    }\n\n    const inputs = []\n    if (target.type === 'tasks' && target.nodes) {\n      inputs.push(...target.nodes.filter(node => node.type && node.type.startsWith('inputs')).map(node => node.url))\n    } else {\n      inputs.push(target.url)\n    }\n\n    let linked = false\n    for (const output of outputs) {\n      if (!output) continue\n      if (inputs.includes(output)) {\n        linked = true\n        break\n      }\n    }\n    return linked\n  }\n\n  // links from inputs to source\n  const inputs = nodes.filter(node => node.type && node.type.startsWith('inputs') && node.url)\n  inputs.forEach(input => {\n    links.push({source: input, target: source, label: 'Input'})\n  })\n  // links from source to outputs\n  const outputs = nodes.filter(node => node.type === 'outputs' && node.url)\n  outputs.forEach(output => {\n    links.push({source: source, target: output, label: 'Output'})\n  })\n\n  // source and target are linked if any of the outputs of source or source itself is any of the\n  // inputs of target or target itself\n  for (const source of ['inputs', 'tasks']) {\n    for (const target of ['outputs', 'tasks']) {\n      const sourceNodes = nodes.filter(node => node.type && node.type.startsWith(source) && node.url)\n      const targetNodes = nodes.filter(node => node.type === target && node.url)\n      sourceNodes.forEach(sourceNode => {\n        targetNodes.forEach(targetNode => {\n          if (isLinked(sourceNode, targetNode)) {\n            let label = ''\n            if (source === 'inputs') {\n              label = 'Input'\n            } else if (target === 'outputs') {\n              label = 'Output'\n            } else {\n              label = 'Click to see how tasks are linked'\n            }\n            links.push({source: sourceNode, target: targetNode, label: label})\n          }\n        })\n      })\n    }\n  }\n\n  return links\n}\n\nconst Graph = React.memo(({\n  source,\n  query,\n  layout,\n  setTooltipContent,\n  setCurrentNode,\n  setShowLegend,\n  setEnableForce\n  }) => {\n  const classes = useWorkflowGraphStyles()\n  const svgRef = useRef()\n  const history = useHistory()\n  const asyncError = useAsyncError()\n  const finalLayout = useMemo(() => {\n    const defaultLayout = {\n      width: 700,\n      margin: {top: 60, bottom: 60, left: 40, right: 40},\n      circleRadius: 20,\n      markerWidth: 4,\n      scaling: 0.35,\n      color: {\n        text: grey[800],\n        link: red[800],\n        outline: blueGrey[800],\n        workflow: '#192E86',\n        task: '#00AC7C',\n        input: '#A59FFF',\n        output: '#005A35'\n      },\n      shape: {\n        input: 'circle',\n        workflow: 'rect',\n        task: 'rect',\n        output: 'circle'\n      }\n    }\n    return {...defaultLayout, ...layout}\n  }, [layout])\n  archives = {}\n\n  useEffect(() => {\n    const {width, markerWidth, scaling, color} = finalLayout\n    const nodeShape = finalLayout.shape\n    const whRatio = 1.6\n    const legendSize = 12\n    const height = width / whRatio\n\n    const svg = d3.select(svgRef.current)\n\n    const inOutColor = d3.interpolateRgb(color.input, color.output)(0.5)\n\n    let nodes, node, line\n    let id = 0\n    let view\n    let focus\n    let previousNode = 'root'\n    let root\n    const dquery = {...query, resolveIndices: {}}\n    let currentNode = root\n    let hasError = false\n    let enableForce = false\n    let dragged = false\n    let zoomTransform = d3.zoomIdentity\n\n    const isWorkflow = (d) => {\n      if (d.sectionType && d.sectionType.startsWith('workflow')) return true\n      const tasks = (d.nodes || []).filter(n => n.type === 'tasks')\n      return tasks.length > 0\n    }\n\n    const nodeColor = (d) => {\n      if (d.color) return d.color\n      if (d.type === 'link') return '#ffffff'\n      if (isWorkflow(d)) return color.workflow\n      if (d.type === 'tasks') return color.task\n      if (d.type === 'inputs-outputs') return inOutColor\n      return d.type === 'inputs' ? color.input : color.output\n    }\n\n    const trimName = (name) => name && name.length > 25 ? `${name.substring(0, 22)}...` : name\n\n    svg.attr('width', width)\n      .attr('height', height)\n\n    svg.append('g')\n      .attr('class', 'svgGroup')\n\n    const svgGroup = svg.select('.svgGroup')\n\n    svg.append('defs')\n      .attr('class', 'defs')\n\n    const addLinkMarkers = (links) => {\n      svg.select('.defs')\n        .selectAll('marker')\n        .exit().remove()\n        .data(links.map(link => link.id))\n        .enter()\n        .append('marker')\n        .attr('class', d => `marker-${d}`)\n        .attr('id', String)\n        .attr('viewBox', '0 -5 10 10')\n        .attr('refX', 0)\n        .attr('refY', 0)\n        .attr('markerWidth', markerWidth)\n        .attr('markerHeight', markerWidth)\n        .attr('xoverflow', 'visible')\n        .attr('orient', 'auto')\n        .style('fill', color.link)\n        .attr('fill-opacity', 0.5)\n        .append('path')\n        .attr('d', 'M0,-5L10,0L0,5')\n    }\n\n    svg.append('g')\n      .attr('class', 'legend')\n      .attr('visibility', 'visible')\n\n    const legend = svg.select('.legend')\n\n    const addLegend = (label, index) => {\n      const gLegend = legend.append('g')\n        .attr('cursor', 'pointer')\n        .attr('pointer-events', 'all')\n      const shape = nodeShape[label]\n      const icon = gLegend.append(shape)\n      const dx = width / 8\n      const x = width / 2 + dx * index - dx * 1.5\n      const y = height - legendSize * 2\n\n      if (shape === 'rect') {\n        icon.attr('width', legendSize * whRatio)\n          .attr('height', legendSize)\n          .attr('rx', legendSize * 0.1)\n          .attr('x', x - legendSize * whRatio / 2)\n          .attr('y', y - legendSize / 2)\n      } else {\n        icon.attr('r', legendSize / 2)\n          .attr('cx', x)\n          .attr('cy', y)\n        }\n      icon\n        .attr('fill', nodeColor({type: label + 's', sectionType: label + 's'}))\n\n      gLegend.append('text')\n        .attr('class', 'text')\n        .text(label)\n        .style('text-anchor', 'middle')\n        .attr('x', x)\n        .attr('y', y + legendSize * 1.2)\n        .style('alignment-baseline', 'middle')\n\n      gLegend\n        .on('mouseover', () => {\n          let tooltip = ''\n          if (label === 'input') {\n            tooltip = <p>\n              Input to a task or workflow.\n            </p>\n          } else if (label === 'output') {\n            tooltip = <p>\n              Output from a task or workflow.\n            </p>\n          } else if (label === 'workflow') {\n            tooltip = <p>\n              Task containing further sub-tasks.\n            </p>\n          } else if (label === 'task') {\n            tooltip = <p>\n              Elementary task with inputs and outputs.\n            </p>\n          }\n          setTooltipContent(tooltip)\n        })\n        .on('mouseout', () => {\n          setTooltipContent('')\n        })\n    }\n\n    // add legend\n    legend.append('path')\n      .attr('d', () => {\n        const line = d3.line().x(d => d[0]).y(d => d[1])\n        return line([\n          [width / 4 + 70, height - legendSize * 3],\n          [3 * width / 4, height - legendSize * 3],\n          [3 * width / 4, height],\n          [width / 4, height],\n          [width / 4, height - legendSize * 3],\n          [width / 4 + 10, height - legendSize * 3]\n        ])\n      })\n      .attr('stroke', grey[900])\n      .attr('stroke-width', 0.5)\n      .attr('fill', 'none')\n    legend.append('text')\n      .text('Legend')\n      .attr('class', 'text')\n      .attr('font-weight', 'bold')\n      .attr('x', width / 4 + 40)\n      .attr('y', height - legendSize * 2.8)\n\n    const legendLabels = Object.keys(nodeShape)\n    legendLabels.forEach((label, index) => addLegend(label, index))\n\n    // add zoom\n    const zoomBehaviors = d3.zoom()\n      .on('zoom', () => {\n        zoomTransform = d3.event.transform\n        svgGroup.attr('transform', zoomTransform)\n      })\n\n    svg.call(zoomBehaviors)\n\n    // set zoom factor to <1 inorder to see the inputs and outputs\n    const zoomF = (r) => width * scaling / r\n\n    // add force directed behavior for tasks inside box\n    const simulation = d3.forceSimulation()\n      .force('link', d3.forceLink().id(d => d.id))\n      .force('charge', d3.forceManyBody())\n      .velocityDecay(0.2)\n      .alphaDecay(0.2)\n\n    // add drag\n    const dragBehaviors = d3.drag()\n      .on('drag', d => {\n        if (!d.parent || d.id === nodes[0].id) return\n        const event = d3.event.sourceEvent\n        const k = zoomF(view[2])\n        const x = ((event.offsetX - zoomTransform.x) / zoomTransform.k - width / 2) / k + view[0]\n        const y = ((event.offsetY - zoomTransform.y) / zoomTransform.k - height / 2) / k + view[1]\n        setTooltipContent('')\n        if (enableForce) {\n          d.fx = x\n          d.fy = y\n        } else {\n          d.x = x\n          d.y = y\n          zoomTo(view)\n        }\n      })\n      .on('start', d => {\n        if (!enableForce) return\n        simulation.alphaTarget(0.7).restart()\n      })\n      .on('end', d => {\n        dragged = true\n        if (!enableForce) return\n        simulation.alphaTarget(0)\n        d.fx = null\n        d.fy = null\n      })\n\n    const gNode = svgGroup.append('g')\n      .attr('class', 'node')\n      .attr('cursor', 'pointer')\n      .attr('pointer-events', 'all')\n\n    const gLink = svgGroup.append('g')\n      .attr('class', 'link')\n      .attr('cursor', 'default')\n      .attr('pointer-events', 'all')\n      .attr('stroke', color.link)\n\n    const setNodesPosition = (root) => {\n      // layout root and its nodes horizontally from inputs (left) root and tasks (middle)\n      // and outputs (right)\n      if (!root.nodes || root.children) return\n\n      const circleRadius = root.r / 12\n      const dx = circleRadius * 4\n      const fx = 1.4\n      const tasks = root.nodes.filter(node => node.type === 'tasks')\n      root.children = tasks\n      // tasks are arranged in a circle inside the parent workflow\n      tasks.forEach((node, index) => {\n        const theta = (2 * Math.PI * index / tasks.length) - Math.PI / 4\n        node.r = Math.sqrt(node.size || 1) * circleRadius * 1.5\n        const r = root.r - node.r\n        node.x = -r * 0.95 * Math.cos(theta) * whRatio + root.x\n        node.y = -r * (theta < 0 || theta > Math.PI ? 0.95 : 0.85) * Math.sin(theta) + root.y\n      })\n\n      // inputs left\n      const inputs = root.nodes.filter(node => node.type === 'inputs')\n      let offsetX = (inputs.length - 1) * dx / 2\n      inputs.forEach((node, index) => {\n        node.y = index * dx - offsetX + root.y\n        node.x = -root.r * fx * whRatio + root.x\n        node.r = circleRadius\n      })\n\n      // inputs-outputs top\n      const inouts = root.nodes.filter(node => node.type === 'inputs-outputs')\n      offsetX = (inouts.length - 1) * dx\n      inouts.forEach((node, index) => {\n        node.x = index * dx * 2 - offsetX + root.x\n        node.y = -root.r * fx + root.y\n        node.r = circleRadius\n      })\n\n      // outputs right\n      const outputs = root.nodes.filter(node => node.type === 'outputs')\n      offsetX = (outputs.length - 1) * dx / 2\n      outputs.forEach((node, index) => {\n        node.y = index * dx - offsetX + root.y\n        node.x = root.r * whRatio * fx + root.x\n        node.r = circleRadius\n      })\n      root.nodes = [...inputs, ...inouts, ...root.children, ...outputs]\n    }\n\n    const fLink = (source, target) => {\n      let vx = target.x - source.x\n      let vy = target.y - source.y\n      const vr = Math.sqrt(vx * vx + vy * vy)\n      const sin = vy / vr\n      const cos = vx / vr\n      const sx = vy ? Math.max(-1, Math.min(cos / sin, 1)) * Math.sign(sin) : Math.sign(vx)\n      const sy = vx ? Math.max(-1, Math.min(sin / cos, 1)) * Math.sign(cos) : Math.sign(vy)\n      const targetR = (f) => Math.abs(target.r) * f\n      let offsetxt, offsetyt, offsetxs, offsetys\n      if (source.r > 0) {\n        // offset from edge of circle\n        offsetxs = cos * source.r\n        offsetys = sin * source.r\n      } else {\n        // offset from edge of square\n        offsetxs = -sx * source.r * whRatio\n        offsetys = -sy * source.r\n      }\n      if (target.r > 0) {\n        // offset to edge of circle\n        offsetxt = cos * targetR(1)\n        offsetyt = sin * targetR(1)\n      } else {\n        // offset to edge of square\n        offsetxt = sx * targetR(whRatio)\n        offsetyt = sy * targetR(1)\n      }\n      source = {x: source.x + offsetxs, y: source.y + offsetys}\n      target = {x: target.x - offsetxt, y: target.y - offsetyt}\n      vx = target.x - source.x\n      vy = target.y - source.y\n      const line = d3.line().x(d => d[0]).y(d => d[1])\n        .curve(d3.curveBasis)\n      const points = [[source.x, source.y]]\n      if (Math.abs(vx) > Math.abs(vy)) {\n        target.x = target.x - markerWidth * 2 * Math.sign(vx)\n        // points.push([source.x + vx / 2, source.y])\n        // points.push([source.x + vx / 2, target.y])\n      } else {\n        target.y = target.y - markerWidth * 2 * Math.sign(vy)\n        // points.push([source.x, source.y + vy / 2])\n        // points.push([target.x, source.y + vy / 2])\n      }\n      points.push([target.x, target.y])\n      return line(points)\n    }\n\n    const zoomTo = (v) => {\n      if (!node) return\n\n      // for elementary tasks, set radius to 1/6\n      const k = zoomF(v[2])\n      const rk = (node) => {\n        return node.id === focus.id && !isWorkflow(node) ? 1 / 6 : 1\n      }\n      const bound = (d) => {\n        let x = (d.x - v[0]) * k + width / 2\n        let y = (d.y - v[1]) * k + height / 2\n        const s = 0.8 * scaling\n        if (d.type === 'tasks' && d.id !== source.id) {\n          x = Math.min(Math.max(x, s * width), (1 - s) * width)\n          y = Math.min(Math.max(y, s * height), (1 - s) * height)\n        }\n        return [x, y]\n      }\n\n      view = v\n      node\n        .attr('transform', d => {\n          const [x, y] = bound(d)\n          return `translate(${x},${y})`\n        })\n      node.selectAll('circle').attr('r', d => d.r * rk(d) * k)\n      node.selectAll('rect')\n        .attr('x', d => -d.r * rk(d) * k * whRatio)\n        .attr('y', d => -d.r * rk(d) * k)\n        .attr('rx', d => d.r * rk(d) * k * 0.05)\n        .attr('width', d => d.r * 2 * rk(d) * k * whRatio)\n        .attr('height', d => d.r * 2 * rk(d) * k)\n      line.attr('d', d => {\n        const translate = (node) => {\n          const isCircle = ['inputs', 'outputs', 'inputs-outputs'].includes(node.type)\n          const dr = node.r * rk(node) * k\n          const [x, y] = bound(node)\n          return {\n            x: x,\n            y: y,\n            r: isCircle ? dr : -dr\n          }\n        }\n        return fLink(translate(d.source), translate(d.target))\n      })\n      node.selectAll('text').attr('y', d => -1.2 * d.r * rk(d) * k)\n    }\n\n    const zoom = (d) => {\n      focus = d\n      if (!focus) return\n      const transition = svg.transition()\n        .duration(500)\n        .tween('zoom', d => {\n          const i = d3.interpolateZoom(view, [focus.x, focus.y, focus.r * 2])\n          return t => zoomTo(i(t))\n        })\n\n      node.selectAll('text')\n        .transition(transition)\n    }\n\n    const update = (source) => {\n      if (!source) return\n\n      if (!source.nodes || !source.nodes.length) return\n\n      dragged = false\n\n      const setShowNodes = (inputValue) => {\n        const value = []\n        if (hasError) setCurrentNode(currentNode)\n        let sourceNode = currentNode\n        if (['inputs', 'outputs'].includes(currentNode.type)) {\n          sourceNode = currentNode.parent\n        }\n        if (!sourceNode) return\n        let total = 1\n        const nodes = sourceNode.nodes.filter(node => node.type === (currentNode.type || 'tasks'))\n        if (nodes.length) total = nodes[0].total\n        const toNumber = (value) => {\n          if (value.includes('%')) return Math.floor(parseFloat(value.replace('%')) * total / 100)\n          if (value.includes('.')) return Math.floor(parseFloat(value.replace('%')) * total)\n          value = parseInt(value)\n          if (value < 0) value = total + value\n          return value\n        }\n        for (const query of inputValue.split(',')) {\n          try {\n            const q = query.split(':')\n            if (q.length === 2) {\n              value.push(...range(...q.map((qi, n) => qi ? toNumber(qi) : n === 0 ? 0 : total)))\n            } else {\n              value.push(toNumber(q[0]))\n            }\n          } catch (error) {\n            console.error(error)\n            hasError = true\n            setCurrentNode(null)\n            break\n          }\n        }\n        if (!value.length) return\n        dquery['resolveIndices'][currentNode.type || 'tasks'] = [...new Set(value)]\n        source.nodes = source.nodes.filter(node => node.id !== currentNode.id)\n        // set children and links to recalculate node positions and links\n        const d = source\n        d.children = undefined\n        d.links = undefined\n        d.parent = source.parent\n        resolveSection(d, query).then(d => {\n          if (!d) return\n          getNodes(d, dquery).then(nodes => {\n            d.nodes = nodes\n            getLinks(d, query).then(links => {\n              d.links = links\n              update(d)\n              zoom(d)\n            }).catch(asyncError)\n          }).catch(asyncError)\n          .catch(asyncError)\n        })\n      }\n\n      d3.select('#nodes-filter-clear')\n        .on('click', () => {\n          const mid = (query.maxNodes || 6) / 2\n          setShowNodes(`:${mid},${-mid}:`)\n      })\n\n      d3.select('#nodes-filter-enter')\n        .on('keydown', () => {\n          const inputValue = d3.event.target.value\n          if (d3.event.key === 'Enter' && inputValue) setShowNodes(inputValue)\n        })\n\n      d3.select('#backbutton')\n        .on('click', () => {\n          previousNode = source.parent\n          handleClickIcon(source)\n        })\n\n      d3.select('#resetbutton')\n        .on('click', () => {\n          previousNode = 'root'\n          root.nodes = null\n          root.links = null\n          root.children = null\n          dquery.resolveIndices = {}\n          resolveSection(root, query).then(d => {\n            if (!d) return\n            getNodes(d, query).then(nodes => {\n              d.nodes = nodes\n              getLinks(d, query).then(links => {\n                d.links = links\n                update(d)\n                zoom(d)\n              }).catch(asyncError)\n            }).catch(asyncError)\n            .catch(asyncError)\n          })\n          svg.call(zoomBehaviors.transform, d3.zoomIdentity)\n          if (enableForce) simulation.alphaTarget(0)\n        })\n\n      d3.select('#legendtogglebutton')\n        .on('click', () => {\n          const visibility = legend.attr('visibility') === 'visible' ? 'hidden' : 'visible'\n          legend.attr('visibility', visibility)\n          setShowLegend(visibility === 'visible')\n        })\n\n      d3.select('#forcetogglebutton')\n        .on('click', () => {\n          enableForce = !enableForce\n          setEnableForce(enableForce)\n          update(source)\n          zoom(source)\n          if (enableForce) {\n            simulation.alphaTarget(0.7).restart()\n          } else {\n            simulation.alphaTarget(0)\n          }\n        })\n\n      // set ids and size\n      const maxLength = Math.max(...source.nodes\n        .filter(node => node.type === 'tasks').map(node => node.nChildren || 0))\n      source.size = source.nChildren / maxLength\n      source.id = id\n      id = id + 1\n      source.nodes.forEach((node) => {\n        node.size = isWorkflow(node) ? node.nChildren / maxLength : 1\n        // put a lower limit on size so node will not get too small\n        node.size = Math.max(node.size, 0.1)\n        node.id = id\n        id = id + 1\n      })\n\n      setNodesPosition(source)\n\n      nodes = [source, ...source.nodes]\n      const links = source.links\n\n      links.forEach((link) => {\n        link.id = `${link.source.id}-${link.target.id}`\n      })\n\n      addLinkMarkers(links)\n\n      if (enableForce) {\n        const k = zoomF(source.r * 2)\n        simulation\n          .nodes(source.nodes.filter(node => node.type === 'tasks'))\n          .on('tick', () => zoomTo(view))\n\n        simulation\n          .force('charge')\n          .strength(-10 / k ** 2)\n\n        simulation\n          .force('link')\n          .strength(0.005 / k)\n          .distance(source.r)\n          .links(source.links.filter(link => link.source.type === 'tasks' && link.target.type === 'tasks'))\n\n        simulation\n          .force('center', d3.forceCenter(source.x, source.y))\n\n        simulation\n          .force('collide', d3.forceCollide(source.r / 3).strength(2))\n      }\n\n      const handleMouseOverIcon = (d) => {\n        d3.select(`#icon-${d.id}`).style('stroke-opacity', 1)\n        if (d.id === source.id) {\n          if (!previousNode || previousNode === 'root') return\n          setTooltipContent(<p>Click to go back up</p>)\n          return\n        }\n        if (['inputs', 'outputs'].includes(d.type)) {\n          setTooltipContent(<p>Click to switch {d.type} filter</p>)\n        }\n        const sectionType = d.sectionType === 'tasks' ? 'task' : 'workflow'\n        if (d.type === 'tasks') setTooltipContent(<p>Click to expand {sectionType}</p>)\n      }\n\n      const handleMouseOutIcon = (d) => {\n        setTooltipContent('')\n        d3.select(`#icon-${d.id}`).style('stroke-opacity', 0.5)\n      }\n\n      const handleClickIcon = (d) => {\n        if (dragged) d.children = null\n        d3.event.stopPropagation()\n        setCurrentNode(d)\n        dquery['resolveIndices'][d.type || 'tasks'] = null\n        currentNode = d\n        if (!d.nodes || !d.nodes.length) {\n          return\n        }\n        if (d.id === source.id) {\n          if (!previousNode || previousNode === 'root') return\n          setCurrentNode(previousNode)\n          currentNode = previousNode\n          update(previousNode)\n          zoom(previousNode)\n          previousNode = previousNode.parent\n          return\n        }\n        d.parent = source\n        previousNode = d.parent\n        resolveSection(d, query).then(d => {\n          if (!d) return\n          getNodes(d, query).then(nodes => {\n            d.nodes = nodes\n            getLinks(d, query).then(links => {\n              d.links = links\n              update(d)\n              zoom(d)\n            }).catch(asyncError)\n          }).catch(asyncError)\n          .catch(asyncError)\n        })\n      }\n\n      node = gNode.selectAll('g')\n        .attr('visibility', 'hidden')\n        .attr('pointer-events', 'none')\n        .exit().remove()\n        .data(nodes, d => d.id)\n        .attr('cursor', d => d.nodes ? null : 'pointer')\n        .join('g')\n        .call(dragBehaviors)\n\n      node\n        .filter(d => d.type === 'tasks' || d.id === source.id)\n        .append('rect')\n        .attr('class', 'icon')\n        .attr('id', d => `icon-${d.id}`)\n        .attr('stroke', color.outline)\n        .attr('fill', d => nodeColor(d))\n        .attr('fill-opacity', d => {\n          if (d.type === 'link') return 0\n          if (!d.nodes || !d.nodes.filter(node => node.type === 'tasks').length) return 1\n          if (d.id === source.id) return 0.2\n          return 1\n        })\n        .on('mouseover', handleMouseOverIcon)\n        .on('mouseout', handleMouseOutIcon)\n        .on('click', handleClickIcon)\n\n      node\n        .filter(d => d.type === 'inputs' || d.type === 'outputs' || d.type === 'inputs-outputs')\n        .append('circle')\n        .attr('class', 'icon')\n        .attr('id', d => `icon-${d.id}`)\n        .attr('stroke', color.outline)\n        .attr('fill', d => nodeColor(d))\n        .on('mouseover', handleMouseOverIcon)\n        .on('mouseout', handleMouseOutIcon)\n        .on('click', handleClickIcon)\n\n      node.append('text')\n        .attr('class', 'text')\n        .attr('fill', color.text)\n        .attr('font-weight', d => d.id === source.id ? 'bold' : 'none')\n        .attr('id', d => `text-${d.id}`)\n        .text(d => trimName(d.name))\n        .style('font-size', d => d.id === nodes[0].id ? 18 : 14)\n        .on('click', d => {\n          d3.event.stopPropagation()\n          if (!d.entryId || !d.parent) return\n          let path = `entry/id/${d.entryId}`\n          const sectionPath = d.path ? d.path.replace(/\\/(?=\\d)/g, ':') : null\n          path = isWorkflow(d) ? path : sectionPath ? `${path}/data${sectionPath}` : path\n          const url = getUrl(path)\n          history.push(url)\n        })\n        .on('mouseover', d => {\n          if (!d.type || !d.parent) return\n          if (!d.sectionType) return\n          d3.select(`#text-${d.id}`).style('font-weight', 'bold')\n            .text(d.name)\n          const text = isWorkflow(d) ? 'overview page' : 'archive section'\n          if (d.entryId) {\n            setTooltipContent(<p>Click to go to {text} for entry<br/>{d.entryId}</p>)\n          }\n        })\n        .on('mouseout', d => {\n          setTooltipContent('')\n          d3.select(`#text-${d.id}`).style('font-weight', null)\n            .text(d => trimName(d.name))\n        })\n\n      const link = gLink.selectAll('path')\n        .attr('visibility', 'hidden')\n        .attr('pointer-events', 'none')\n        .exit().remove()\n        .data(links)\n\n      line = link.enter()\n        .append('path')\n        .attr('pointer-events', 'all')\n        .attr('id', d => `link-${d.id}`)\n        .attr('marker-end', d => `url(#${d.id})`)\n        .attr('visibility', 'visible')\n        .on('click', d => {\n          d3.event.stopPropagation()\n          const parent = d.source.parent || d.target.parent\n          if (!parent) return\n          // use the parent node to containt source and target nodes\n          const linkNode = parent\n          const sourceNode = d.source\n          const targetNode = d.target\n          if (sourceNode.type !== 'tasks' || targetNode.type !== 'tasks') return\n\n          const store = (node, recursive) => {\n            if (typeof node !== 'object') return\n            node._name = node.name\n            node._type = node.type\n            node.children = null\n            if (node.links) {\n              node._links = [...node.links]\n              node.links = null\n            }\n            if (node.nodes) {\n              node._nodes = [...node.nodes]\n              if (recursive) {\n                node.nodes.forEach(n => {\n                  store(n)\n                })\n              }\n            }\n          }\n\n          const restore = (node) => {\n            if (typeof node !== 'object' || !node._nodes) return\n            node.nodes = node._nodes\n            node.links = node._links\n            node.children = null\n            node.name = node._name || node.name\n            node.type = node._type || node.type\n          }\n\n          // store the original nodes info\n          store(linkNode)\n          store(sourceNode)\n          store(targetNode)\n\n          // include into sourceNode the tagetNode inputs\n          const inputs = [...targetNode.nodes.filter(node => node.type === 'inputs')]\n          let url = {}\n          sourceNode.nodes.forEach(node => {\n            url[node.url] = node.name\n          })\n          inputs.forEach(input => {\n            if (Object.keys(url).includes(input.url)) {\n              sourceNode.nodes.push(input)\n              input._name = input.name\n              const sourceName = url[input.url]\n              if (sourceName !== input.name) input.name = `${input.name}/${url[input.url]}`\n              input._type = input.type\n              input.type = 'inputs-outputs'\n            }\n          })\n\n          linkNode.type = 'link'\n          // parent nodes should contain the source, target\n          linkNode.nodes = [sourceNode, targetNode]\n          // and the targetNode inputs\n          linkNode.nodes.push(...inputs)\n\n          // and the sourceNode outputs\n          url = inputs.map(node => node.url)\n          const outputs = sourceNode.nodes.filter(node => node.type === 'outputs' && !url.includes(node.url))\n          linkNode.nodes.push(...outputs)\n\n          // and the tagetNode outputs\n          linkNode.nodes.push(...targetNode.nodes.filter(node => node.type === 'outputs'))\n\n          // generate links for this configuration\n          getLinks(linkNode, query).then(links => {\n            for (const [index, link] of links.entries()) {\n              if (link.target.url === sourceNode.url) {\n                // flip source and target since node is output of sourceNode\n                links[index] = {source: link.target, target: link.source, id: link.id, label: 'Output'}\n              } else if (link.target.url === linkNode.url || link.source.url === linkNode.url) {\n                // remove link to and from rootNode\n                links[index] = null\n              } else if (link.source.url === sourceNode.url && link.target.url === targetNode.url) {\n                // remove link from sourceNode to targetNode, unnecessary\n                links[index] = null\n              }\n            }\n            linkNode.links = links.filter(link => link)\n            linkNode.name = null\n            // linkNode.type = 'link'\n            update(linkNode)\n            zoom(linkNode)\n            previousNode = linkNode\n            // reset original nodes info\n            inputs.forEach(input => {\n              input.type = 'inputs'\n              input.name = input._name || input.name\n              input.children = null\n            })\n            linkNode.type = linkNode._type\n            restore(linkNode)\n            restore(sourceNode)\n            restore(targetNode)\n            setNodesPosition(linkNode)\n        })\n        })\n        .on('mouseover', d => {\n          d3.select(`#link-${d.id}`).style('stroke-opacity', 1.0)\n          svg.select(`.marker-${d.id}`).attr('fill-opacity', 1.0)\n          d3.select(`#icon-${d.source.id}`).style('stroke', color.link).style('stroke-opacity', 1.0)\n          d3.select(`#icon-${d.target.id}`).style('stroke', color.link).style('stroke-opacity', 1.0)\n          setTooltipContent(<p>{d.label}</p>)\n        })\n        .on('mouseout', d => {\n          d3.select(`#link-${d.id}`).style('stroke-opacity', 0.5)\n          svg.select(`.marker-${d.id}`).attr('fill-opacity', 0.5)\n          d3.select(`#icon-${d.source.id}`).style('stroke', color.outline).style('stroke-opacity', 0.5)\n          d3.select(`#icon-${d.target.id}`).style('stroke', color.outline).style('stroke-opacity', 0.5)\n          setTooltipContent('')\n        })\n    }\n\n    resolveSection(source, query).then(source => {\n      if (!source) return\n      getNodes(source, query).then(nodes => {\n        source.nodes = nodes\n        source.x = 0\n        source.y = 0\n        source.r = width / 2\n        getLinks(source, query).then(links => {\n          source.links = links\n          focus = source\n          root = source\n          setCurrentNode(source)\n          currentNode = source\n          update(source)\n          zoomTo([source.x, source.y, source.r * 2])\n        }).catch(asyncError)\n      }).catch(asyncError)\n      .catch(asyncError)\n    })\n  }, [\n    history,\n    setTooltipContent,\n    setCurrentNode,\n    setShowLegend,\n    setEnableForce,\n    query,\n    source,\n    svgRef,\n    finalLayout,\n    asyncError\n  ])\n\n  return <svg className={classes.root} ref={svgRef}></svg>\n})\n\nGraph.propTypes = {\n  source: PropTypes.object.isRequired,\n  query: PropTypes.object.isRequired,\n  layout: PropTypes.object,\n  setTooltipContent: PropTypes.any,\n  setCurrentNode: PropTypes.any,\n  setShowLegend: PropTypes.any,\n  setEnableForce: PropTypes.any\n}\n\nconst WorkflowCard = React.memo(({archive}) => {\n  const {api} = useApi()\n  const [tooltipContent, setTooltipContent] = useState('')\n  const [tooltipPosition, setTooltipPosition] = useState({x: undefined, y: undefined})\n  const [showLegend, setShowLegend] = useState(true)\n  const [enableForce, setEnableForce] = useState(false)\n  const [currentNode, setCurrentNode] = useState({type: 'tasks'})\n  const [inputValue, setInputValue] = useState('')\n  const query = useMemo(() => ({\n    api: api,\n    required: { 'workflow2': '*', 'metadata': '*', 'data': '*' },\n    sectionKeys: ['inputs', 'tasks', 'outputs'],\n    maxNodes: 6\n  }), [api])\n\n  const graph = useMemo(() => {\n    if (!archive || !archive.workflow2) return ''\n\n    const source = {\n      path: '/workflow2',\n      archive: archive\n    }\n\n    return <Graph\n      source={source}\n      query={query}\n      setTooltipContent={setTooltipContent}\n      setCurrentNode={setCurrentNode}\n      setShowLegend={setShowLegend}\n      setEnableForce={setEnableForce}\n    ></Graph>\n  }, [archive, query])\n\n  let nodeType = 'tasks'\n  let nodesCount = 0\n  if (currentNode) {\n    nodeType = currentNode.type || 'tasks'\n    let sourceNode = currentNode\n    if (['inputs', 'outputs'].includes(nodeType)) sourceNode = currentNode.parent || currentNode\n    const nodes = sourceNode.nodes ? sourceNode.nodes.filter(node => node.type === nodeType) : []\n    if (nodes.length) nodesCount = nodes[0].total\n  }\n\n  let label = `No ${nodeType.slice(0, -1)} to show`\n  if (nodesCount) label = `Filter ${nodeType} (N=${nodesCount})`\n\n  const actions = <div>\n    <FormControl margin='none'>\n      <TextField\n        error={!currentNode}\n        size='medium'\n        id='nodes-filter-enter'\n        label={currentNode ? label : 'Invalid input'}\n        disabled={!nodesCount || !currentNode}\n        placeholder={'Enter range: 5, 4:-1, :50%'}\n        variant='outlined'\n        value={inputValue}\n        onChange={(event) => setInputValue(event.target.value)}\n        InputProps={{\n          endAdornment: (\n            <IconButton id='nodes-filter-clear' onClick={() => setInputValue('')} size='medium'>\n              <Clear />\n            </IconButton>\n          )\n        }}\n      ></TextField>\n    </FormControl>\n    <IconButton id='forcetogglebutton'>\n      <Tooltip title={`${enableForce ? 'Disable' : 'Enable'} force simulation`}>\n        {enableForce ? <StopSharp /> : <PlayArrowSharp />}\n      </Tooltip>\n    </IconButton>\n    <IconButton id='legendtogglebutton'>\n      <Tooltip title={showLegend ? 'Hide legend' : 'Show legend'}>\n        {showLegend ? <LabelOff /> : <Label />}\n      </Tooltip>\n    </IconButton>\n    <IconButton id='backbutton'>\n      <Tooltip title=\"Back\">\n        <Undo />\n      </Tooltip>\n    </IconButton>\n    <IconButton id='resetbutton'>\n      <Tooltip title=\"Reset\">\n        <Replay />\n      </Tooltip>\n    </IconButton>\n  </div>\n\n  return graph && <PropertyCard title='Workflow Graph' action={actions}>\n    <PropertyGrid>\n      <Tooltip title={tooltipContent}\n        onMouseMove={event => setTooltipPosition({x: event.pageX, y: event.pageY})}\n        PopperProps={\n          {anchorEl: {\n            clientHeight: 0,\n            clientWidth: 0,\n            getBoundingClientRect: () => ({\n              top: tooltipPosition.y,\n              left: tooltipPosition.x,\n              right: tooltipPosition.x,\n              bottom: tooltipPosition.y,\n              width: 0,\n              height: 0\n            })\n          }}\n        }\n        >\n        <div>\n          {graph}\n        </div>\n      </Tooltip>\n    </PropertyGrid>\n  </PropertyCard>\n})\n\nWorkflowCard.propTypes = {\n  index: PropTypes.object,\n  properties: PropTypes.object,\n  archive: PropTypes.object\n}\n\nexport default WorkflowCard\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport {PropertyCard} from './PropertyCard'\nimport { useEntryStore } from '../EntryContext'\nimport { Box, IconButton, Typography, Link } from '@material-ui/core'\nimport MoreIcon from '@material-ui/icons/MoreVert'\nimport { ArchiveButton } from '../../nav/Routes'\n\nconst DefinitionsCard = React.memo(function DefinitionsCard({index, archive}) {\n  const {entryId, uploadId} = useEntryStore()\n\n  if (!index?.quantities?.includes('definitions')) {\n    return null\n  }\n\n  const actions = (\n    <ArchiveButton\n      component={IconButton}\n      entryId={entryId} uploadId={uploadId}\n      path={'definitions'}\n    >\n      <MoreIcon/>\n    </ArchiveButton>\n  )\n  const name = archive ? archive.definitions?.name || '' : '...'\n  const sections = archive ? archive.definitions?.section_definitions?.length : '...'\n  return <PropertyCard title=\"Schema definitions\" action={actions}>\n    <Box margin={2}>\n      <Box marginBottom={1}>\n        <Typography>\n          This entry contains a schema package {name} with {sections} section definitions.\n        </Typography>\n      </Box>\n      {archive?.definitions?.section_definitions?.map(sectionDef => {\n        const path = 'definitions/' + sectionDef.name\n        return <Typography key={sectionDef.name}>\n          <ArchiveButton component={Link} path={path} entryId={entryId} uploadId={uploadId}>\n            {sectionDef.more?.label || sectionDef.name}\n          </ArchiveButton>\n        </Typography>\n      })}\n\n    </Box>\n  </PropertyCard>\n})\nDefinitionsCard.propTypes = {\n  index: PropTypes.object,\n  archive: PropTypes.object\n}\n\nexport default DefinitionsCard\n","/* eslint-disable quotes */\n/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { memo, useEffect, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { PropertyCard } from './PropertyCard'\nimport { Box, Collapse, List, ListItem, ListItemText, Tooltip } from '@material-ui/core'\nimport { useApi } from '../../api'\nimport { useErrors } from '../../errors'\nimport Quantity from '../../Quantity'\nimport { Datatable, DatatableTable } from '../../datatable/Datatable'\nimport EntryDetails, { EntryRowActions } from '../EntryDetails'\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore'\nimport ExpandLessIcon from '@material-ui/icons/ExpandLess'\nimport { Alert } from '@material-ui/lab'\n\nconst columns = [\n  {\n    key: 'entry_name',\n    label: 'Name',\n    align: 'left',\n    sortable: false,\n    render: entry => <Quantity quantity={'entry_name'} noWrap noLabel placeholder=\"unnamed\" data={entry}/>\n  },\n  {key: 'entry_type', align: 'left', sortable: false, label: 'Type'},\n  {\n    key: 'mainfile',\n    align: 'left',\n    render: entry => <Quantity quantity={'mainfile'} noLabel noWrap withClipboard data={entry}/>\n  },\n  {\n    key: 'upload_id',\n    render: upload => <Quantity quantity={'upload_id'} noLabel noWrap withClipboard data={upload}/>\n  }\n]\n\nconst defaultColumns = [\n  'entry_name',\n  'entry_type',\n  'mainfile'\n]\n\nconst baseQuery = {\n  'required': {\n    'metadata': '*'\n  },\n  'owner': 'visible',\n  'pagination': {\n    'order_by': 'upload_create_time', 'order': 'desc', 'page_size': 20\n  }\n}\n\nexport const ReferenceTable = memo(({refPool, defaultColumns, noAction}) => {\n  return <Datatable\n    columns={columns} shownColumns={defaultColumns}\n    data={refPool.map(entry => ({...entry.entry_metadata, ...entry}))}\n  >\n    <DatatableTable actions={!noAction && EntryRowActions} details={EntryDetails}>\n    </DatatableTable>\n  </Datatable>\n})\nReferenceTable.propTypes = {\n  refPool: PropTypes.arrayOf(\n    PropTypes.shape({\n      entry_metadata: PropTypes.object\n    })\n  ),\n  defaultColumns: PropTypes.arrayOf(PropTypes.string),\n  noAction: PropTypes.bool\n}\n\nconst ReferenceUsingCard = memo(({index}) => {\n  const [referencingPool, setReferencingPool] = useState(null)\n  const [referencedPool, setReferencedPool] = useState(null)\n  const [openReferencing, setOpenReferencing] = useState(true)\n  const [openReferenced, setOpenReferenced] = useState(false)\n\n  const {api} = useApi()\n  const {raiseError} = useErrors()\n\n  // the referencing list from the archive itself\n  useEffect(() => {\n    if (!index?.entry_references) {\n      setReferencingPool(null)\n      return\n    }\n\n    const targetEntryIds = new Set()\n    for (const entry of index.entry_references) targetEntryIds.add(entry.target_entry_id)\n\n    const referencing_query = {\n      ...baseQuery,\n      query: {\n        'entry_id:any': [...targetEntryIds]\n      }\n    }\n    api.query('entries', referencing_query, {noLoading: true})\n      .then((data) => {\n        setReferencingPool(data.data)\n      })\n      .catch(raiseError)\n  }, [api, index, raiseError])\n\n  const referencingList = referencingPool?.length > 0\n    ? <ReferenceTable refPool={referencingPool} defaultColumns={defaultColumns}/>\n    : <Alert severity=\"info\">Not referencing other entries.</Alert>\n\n  // load the referenced list of references from search\n  useEffect(() => {\n    const referenced_query = {\n      ...baseQuery,\n      ...{query: {'entry_references.target_entry_id': index.entry_id}}\n    }\n    api.query('entries', referenced_query, {noLoading: true}).then((data) => {\n      setReferencedPool(data.data)\n    }).catch(raiseError)\n  }, [api, index, raiseError])\n\n  // the referenced by list via search\n  const referencedList = referencedPool?.length > 0\n    ? <ReferenceTable refPool={referencedPool} defaultColumns={defaultColumns}/>\n    : <Alert severity=\"info\">Not referenced by other entries.</Alert>\n\n  return (<PropertyCard title=\"Entry References\">\n    <List dense={true}>\n      <ListItem button onClick={() => setOpenReferencing(!openReferencing)}>\n        <Tooltip title=\"Click to expand/collapse\">\n          <ListItemText primaryTypographyProps={{variant: 'subtitle1'}}\n                        primary=\"Referencing the following entries\"/>\n        </Tooltip>\n        {openReferencing ? <ExpandLessIcon fontSize=\"small\"/> : <ExpandMoreIcon fontSize=\"small\"/>}\n      </ListItem>\n      <Collapse in={openReferencing} timeout=\"auto\">\n        <Box marginBottom={3}>\n          {referencingList}\n        </Box>\n      </Collapse>\n      <ListItem button onClick={() => setOpenReferenced(!openReferenced)}>\n        <Tooltip\n          title={(referencedPool?.length >= 20 ? 'Only showing the latest 20 entries. ' : '') + 'Click to expand/collapse'}>\n          <ListItemText primaryTypographyProps={{variant: 'subtitle1'}}\n                        primary=\"Referenced by the following entries\"/>\n        </Tooltip>\n        {openReferenced ? <ExpandLessIcon fontSize=\"small\"/> : <ExpandMoreIcon fontSize=\"small\"/>}\n      </ListItem>\n      <Collapse in={openReferenced} timeout=\"auto\">{referencedList}</Collapse>\n    </List>\n  </PropertyCard>)\n})\nReferenceUsingCard.propTypes = {\n  index: PropTypes.shape({\n    entry_id: PropTypes.string.isRequired,\n    entry_references: PropTypes.arrayOf(PropTypes.shape({\n      target_entry_id: PropTypes.string.isRequired,\n      target_path: PropTypes.string.isRequired\n    }))\n  }).isRequired\n}\n\nexport default ReferenceUsingCard\n","/* eslint-disable quotes */\n/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\")\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { memo, useMemo } from 'react'\nimport PropTypes from 'prop-types'\nimport { PropertyCard } from './PropertyCard'\nimport { SearchContext, useSearchContext } from \"../../search/SearchContext\"\nimport { SearchResultsWithContext } from \"../../search/SearchResults\"\nimport { cloneDeep } from \"lodash\"\nimport { ui } from \"../../../config\"\n\nconst context = cloneDeep(ui?.apps?.options?.entries)\nconst shownColumns = ['entry_name', 'entry_type', 'entry_create_time']\n\nconst options = {\n  'entry_name': {'label': 'Name', 'align': 'left'},\n  'entry_type': {'label': 'Entry type', 'align': 'left'},\n  'entry_create_time': {'label': 'Entry creation time', 'align': 'left'},\n  'upload_name': {'label': 'Upload name', 'align': 'left'},\n  'upload_id': {'label': 'Upload id', 'align': 'left'},\n  'upload_create_time': {'label': 'Upload time', 'align': 'left'},\n  'authors': {'label': 'Authors', 'align': 'left', 'sortable': false},\n  'results.eln.lab_ids': {'label': 'IDs'}\n}\n\nObject.keys(options).forEach(key => { options[key].key = key })\ncontext.columns.options = options\ncontext.columns.selected = shownColumns\ncontext.rows.details = { enabled: false }\ncontext.rows.actions = { enabled: true }\n\nconst HistoryCard = memo(() => {\n  const { useResults } = useSearchContext()\n  const { data } = useResults()\n\n  if (!data || data.length === 0) {\n    return null\n  }\n\n  return (\n    <PropertyCard title='History'>\n      <SearchResultsWithContext\n        title='activity'\n        multiSelect={false}\n        PaperProps={{elevation: 0}}\n      />\n    </PropertyCard>\n  )\n})\n\nconst SampleHistoryUsingCard = memo(({ index }) => {\n  const filtersLocked = useMemo(() => ({\n    'entry_references.target_entry_id': [index.entry_id],\n    'section_defs.definition_qualified_name': ['nomad.datamodel.metainfo.basesections.Activity']\n  }), [index.entry_id])\n\n  if (!index.section_defs?.some(def => def?.definition_qualified_name === 'nomad.datamodel.metainfo.basesections.Entity')) {\n    return null\n  }\n\n  return (\n    <SearchContext\n      resource={context?.resource}\n      initialPagination={context?.pagination}\n      initialColumns={context?.columns}\n      initialRows={context?.rows}\n      initialFilterMenus={context?.filter_menus}\n      initialFiltersLocked={filtersLocked}\n      initialSearchSyntaxes={context?.search_syntaxes}\n    >\n      <HistoryCard />\n    </SearchContext>\n  )\n})\n\nSampleHistoryUsingCard.propTypes = {\n  index: PropTypes.shape({\n    entry_id: PropTypes.string.isRequired,\n    section_defs: PropTypes.arrayOf(PropTypes.shape({\n      definition_qualified_name: PropTypes.string.isRequired\n    })).isRequired,\n    entry_references: PropTypes.arrayOf(PropTypes.shape({\n      target_entry_id: PropTypes.string.isRequired,\n      target_path: PropTypes.string.isRequired\n    }))\n  }).isRequired\n}\n\nexport default SampleHistoryUsingCard\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useMemo} from 'react'\nimport PropTypes from 'prop-types'\nimport {DialogContentText} from '@material-ui/core'\nimport {Datatable} from '../datatable/Datatable'\nimport Quantity from '../Quantity'\n\nconst columns = [\n  {key: 'mainfile', align: 'left', label: 'Mainfile'},\n  {key: 'upload_id', align: 'left', label: 'Upload Id', render: data => <Quantity quantity={'upload_id'} noLabel noWrap withClipboard data={data}/>}\n]\n\nexport const DeletingReferencesTable = React.memo(({entryReferences, brokenEntries, message}) => {\n  const normalizedEntryReferences = useMemo(() => {\n    return entryReferences.map(reference => ({...reference, mainfile: reference.target_mainfile, upload_id: reference.target_upload_id}))\n  }, [entryReferences])\n\n  return (\n    brokenEntries.length > 0 ? <React.Fragment>\n    <DialogContentText>\n      <span style={{color: 'red'}}>{message || 'Warning: There are some entries which are referenced somewhere else.'}</span>\n    </DialogContentText>\n    <DialogContentText>\n      References Being Deleted\n      <Datatable columns={columns} data={normalizedEntryReferences}/>\n    </DialogContentText>\n    <DialogContentText>\n      Broken Entries\n      <Datatable columns={columns} data={brokenEntries}/>\n    </DialogContentText>\n  </React.Fragment> : null)\n})\nDeletingReferencesTable.propTypes = {\n  entryReferences: PropTypes.arrayOf(PropTypes.object).isRequired,\n  brokenEntries: PropTypes.arrayOf(PropTypes.object).isRequired,\n  message: PropTypes.string\n}\n\nexport default DeletingReferencesTable\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useState, useCallback, useEffect } from 'react'\nimport PropTypes from 'prop-types'\nimport {\n  Tooltip, IconButton, Dialog, DialogContent, DialogContentText, DialogActions, Button,\n  Checkbox, FormControlLabel\n} from '@material-ui/core'\nimport DeleteIcon from '@material-ui/icons/Delete'\nimport { useUploadPageContext } from './UploadPageContext'\nimport {useApi} from '../api'\nimport {useErrors} from '../errors'\nimport {pluralize} from '../../utils'\nimport {useEntryStore} from '../entry/EntryContext'\nimport {useHistory} from 'react-router-dom'\nimport DeletingReferencesTable from './DeletingReferencesTable'\n\nexport const DeleteEntriesButton = React.memo(({tooltip, disabled, buttonProps, dark, selectedEntries, selectedCount, setSelected}) => {\n  const history = useHistory()\n  const uploadContext = useUploadPageContext()\n  const entryContext = useEntryStore()\n  const {api} = useApi()\n  const {raiseError} = useErrors()\n  const [openDeleteConfirmDialog, setOpenDeleteConfirmDialog] = useState(false)\n  const [deleteFolders, setDeleteFolders] = useState(false)\n  const {uploadId} = uploadContext || entryContext\n  const {updateUpload} = uploadContext || {}\n  const {entryId, editable} = entryContext || {}\n  const count = entryId ? 1 : selectedCount\n  const [entryReferences, setEntryReferences] = useState([])\n  const [brokenEntries, setBrokenEntries] = useState([])\n\n  const handleClick = useCallback(() => {\n    setOpenDeleteConfirmDialog(true)\n  }, [setOpenDeleteConfirmDialog])\n\n  useEffect(() => {\n    if (!openDeleteConfirmDialog) {\n      return\n    }\n    const requestBody = selectedEntries?.entry_id\n        ? {owner: 'visible', query: {entry_references: {'target_entry_id:any': selectedEntries?.entry_id || []}}}\n        : {owner: 'visible', query: {entry_references: {'target_upload_id:any': selectedEntries?.upload_id ? [selectedEntries?.upload_id] : []}}}\n    api.post(`entries/query`, requestBody)\n      .then(results => {\n        const data = results?.data || []\n        if (data.length > 0) {\n          const brokenEntries = selectedEntries?.entry_id\n              ? data.filter(entry => !selectedEntries?.entry_id.includes(entry.entry_id))\n              : data.filter(entry => entry.upload_id !== selectedEntries?.upload_id)\n          setBrokenEntries(brokenEntries)\n          const allReferences = data.map(entry => entry.entry_references).flat()\n          const references = [...new Map(allReferences.map(entry => [entry.target_entry_id, entry])).values()]\n          setEntryReferences(references)\n        }\n      })\n      .catch(err =>\n        raiseError(err)\n      )\n  }, [api, openDeleteConfirmDialog, raiseError, selectedEntries])\n\n  const handleDelete = useCallback(() => {\n    setOpenDeleteConfirmDialog(false)\n    const requestBody = {query: selectedEntries || {entry_id: entryId}, include_parent_folders: deleteFolders}\n    api.post(`uploads/${uploadId}/action/delete-entry-files`, requestBody)\n      .then(results => {\n        updateUpload && updateUpload({upload: results.data})\n        setSelected && setSelected(new Set())\n        entryId && history.push(`/user/uploads/upload/id/${uploadId}`)\n      })\n      .catch(err =>\n        raiseError(err)\n      )\n  }, [setOpenDeleteConfirmDialog, api, raiseError, uploadId, selectedEntries, setSelected, updateUpload, entryId, history, deleteFolders])\n\n  return (\n    uploadContext || (entryContext && editable) ? <React.Fragment>\n      <IconButton\n        {...buttonProps}\n        disabled={disabled}\n        onClick={handleClick}\n        style={dark ? {color: 'white'} : null}\n      >\n        <Tooltip title={tooltip || entryContext ? 'Delete entry' : 'Delete selected entries'}>\n          <DeleteIcon />\n        </Tooltip>\n      </IconButton>\n      <Dialog\n        open={openDeleteConfirmDialog}\n        aria-describedby=\"alert-dialog-description\"\n      >\n        <DialogContent>\n          <DialogContentText id=\"alert-dialog-description\">\n            <b>{`Please confirm deleting the ${pluralize('entry', count, false)}.`}</b>\n          </DialogContentText>\n          <DialogContentText>\n            You have selected {pluralize('entry', count, true)}. Are you sure you want to delete the selected {pluralize('entry', count, false)}?\n          </DialogContentText>\n          <FormControlLabel\n            control={<Checkbox\n              onChange={event => setDeleteFolders(event.target.checked)}\n              color='primary'\n              checked={deleteFolders}\n              name='Delete folders'\n            />}\n            label={`Delete also the ${pluralize(\"entry's\", count, false)} folders. There might be more entries in them.`}\n          />\n          <DeletingReferencesTable entryReferences={entryReferences} brokenEntries={brokenEntries}/>\n        </DialogContent>\n        <DialogActions >\n          <Button onClick={() => setOpenDeleteConfirmDialog(false)} autoFocus>Cancel</Button>\n          <Button onClick={() => handleDelete()} data-testid={'delete-dialog-delete-button'}>\n            {deleteFolders\n            ? `${brokenEntries.length > 0 ? 'Delete anyway' : 'Delete'} ${pluralize('entry', count, true)} and the ${pluralize('folder', count, false)}`\n            : `${brokenEntries.length > 0 ? 'Delete anyway' : 'Delete'} ${pluralize('entry', count, true)}`}\n          </Button>\n        </DialogActions>\n      </Dialog>\n    </React.Fragment> : null)\n})\nDeleteEntriesButton.propTypes = {\n  selectedEntries: PropTypes.object,\n  selectedCount: PropTypes.number,\n  setSelected: PropTypes.func,\n  tooltip: PropTypes.string,\n  disabled: PropTypes.bool,\n  buttonProps: PropTypes.object,\n  dark: PropTypes.bool\n}\n\nexport default DeleteEntriesButton\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useEffect, useMemo, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { isEmpty } from 'lodash'\nimport { Typography, makeStyles, Box, Grid, Divider } from '@material-ui/core'\nimport { Alert } from '@material-ui/lab'\nimport { resolveNomadUrlNoThrow } from '../../utils'\nimport Quantity from '../Quantity'\nimport ElectronicPropertiesCard from '../entry/properties/ElectronicPropertiesCard'\nimport SolarCellPropertiesCard from '../entry/properties/SolarCellPropertiesCard'\nimport MaterialCard from '../entry/properties/MaterialCard'\nimport MaterialCardTopology from '../entry/properties/MaterialCardTopology'\nimport MaterialCardFormula from './properties/MaterialCardFormula'\nimport NexusCard from './properties/NexusCard'\nimport VibrationalPropertiesCard from '../entry/properties/VibrationalPropertiesCard'\nimport MechanicalPropertiesCard from '../entry/properties/MechanicalPropertiesCard'\nimport ThermodynamicPropertiesCard from '../entry/properties/ThermodynamicPropertiesCard'\nimport DynamicalPropertiesCard from '../entry/properties/DynamicalPropertiesCard'\nimport StructuralPropertiesCard from '../entry/properties/StructuralPropertiesCard'\nimport GeometryOptimizationCard from '../entry/properties/GeometryOptimizationCard'\nimport SpectroscopicPropertiesCard from './properties/SpectroscopicPropertiesCard'\nimport RelatedResourcesCard from '../entry/properties/RelatedResourcesCard'\nimport WorkflowCard from './properties/WorkflowCard'\nimport { MethodMetadata } from './EntryDetails'\nimport Page from '../Page'\nimport { SourceApiCall, SourceApiDialogButton, SourceDialogDivider } from '../buttons/SourceDialogButton'\nimport SectionCard from './properties/SectionCard'\nimport { useMetainfoDef, traverse } from '../archive/metainfo'\nimport {\n  ArchiveSaveButton, ArchiveReloadButton, ArchiveReUploadButton\n} from '../archive/ArchiveBrowser'\nimport { useErrors } from '../errors'\nimport DefinitionsCard from './properties/DefinitionsCard'\nimport { ErrorHandler } from '../ErrorHandler'\nimport ReferenceUsingCard from \"./properties/ReferenceCard\"\nimport SampleHistoryUsingCard from \"./properties/SampleHistoryCard\"\nimport { useEntryStore, useEntryContext, useIndex } from './EntryContext'\nimport DeleteEntriesButton from '../uploads/DeleteEntriesButton'\n\nfunction MetadataSection({title, children}) {\n  return <Box marginTop={2} marginBottom={2}>\n    {title && <Typography component=\"div\">\n      <Box fontSize=\"h6.fontSize\" marginBottom={1}>\n        {title}\n      </Box>\n    </Typography>}\n    {children}\n  </Box>\n}\n\nMetadataSection.propTypes = {\n  title: PropTypes.string,\n  children: PropTypes.any\n}\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    marginBottom: theme.spacing(4)\n  },\n  leftColumn: {\n    maxWidth: '32%',\n    flexBasis: '32%',\n    flexGrow: 0,\n    paddingRight: theme.spacing(3)\n  },\n  rightColumn: {\n    maxWidth: '67.99%',\n    flexBasis: '67.99%',\n    flexGrow: 0,\n    '& > div': {\n      marginBottom: theme.spacing(2)\n    }\n  },\n  editActions: {\n    marginBottom: `${theme.spacing(1)}px !important`\n  },\n  divider: {\n    marginTop: theme.spacing(1),\n    marginBottom: theme.spacing(1)\n  }\n}))\n\n// Optimization: for the overview page, we only need to fetch some of the archive data\nconst required = {\n  metadata: '*',\n  data: '*',\n  definitions: '*',\n  workflow2: '*',\n  results: {\n    material: '*',\n    method: '*',\n    properties: {\n      structural: '*',\n      structures: '*',\n      dynamical: '*',\n      electronic: {\n        greens_functions_electronic: 'include-resolved',\n        dos_electronic: 'include-resolved',\n        // We explicitly ask for everything except the projected DOS: retrieving\n        // the projected DOS can get very expensive and ATM we don't visualize\n        // them.\n        dos_electronic_new: {\n          data: {\n            energies: 'include-resolved',\n            total: 'include-resolved',\n            energy_fermi: '*',\n            energy_ref: '*',\n            spin_channel: '*',\n            band_gap: 'include-resolved'\n          }\n        },\n        band_structure_electronic: 'include-resolved',\n        band_gap: '*'\n      },\n      mechanical: 'include-resolved',\n      spectroscopic: 'include-resolved',\n      vibrational: 'include-resolved',\n      thermodynamic: 'include-resolved',\n      geometry_optimization: {\n        energies: 'include-resolved'\n      }\n    }\n  }\n}\n\nconst OverviewView = React.memo(() => {\n  const { cards } = useEntryContext()\n  const { data: index, response: indexApiData } = useIndex()\n  const { url, exists, editable, archive: archiveTmp, archiveApiData } = useEntryStore(required)\n  const [sections, setSections] = useState([])\n\n  // The archive is accepted only once it is synced with the index. Notice that\n  // we need to get the entry_id from data.entry_id, as some older entries will\n  // not have entry_id stored under data.archive.metadata.entry_id\n  const archive = index?.entry_id === archiveApiData?.response?.data?.entry_id\n    ? archiveTmp\n    : undefined\n\n  const classes = useStyles()\n  const {raiseError} = useErrors()\n  const m_def = archive?.data?.m_def_id ? `${archive.data.m_def}@${archive.data.m_def_id}` : archive?.data?.m_def\n  const dataMetainfoDefUrl = url && resolveNomadUrlNoThrow(m_def, url)\n  const dataMetainfoDef = useMetainfoDef(dataMetainfoDefUrl)\n\n  const properties = useMemo(() => {\n    return new Set(index?.results?.properties?.available_properties || [])\n  }, [index])\n\n  useEffect(() => {\n    if (!dataMetainfoDef || !archive?.data) {\n      return\n    }\n    const getSections = async () => {\n      const sections = []\n      traverse(archive.data, dataMetainfoDef, 'data', (section, sectionDef, path) => {\n        if (path === 'data' || sectionDef.m_annotations?.eln?.[0]?.overview) {\n          sections.push({\n            archivePath: path,\n            sectionDef: sectionDef,\n            section: section\n          })\n        }\n      })\n      return sections\n    }\n    getSections().then((sections) => {\n      setSections(sections)\n    }).catch(raiseError)\n  }, [archive, dataMetainfoDef, setSections, raiseError])\n\n  // Determine the cards to show\n  const cardComps = useMemo(() => {\n    if (!exists || !index) return []\n    const cardMap = {\n      definitions: DefinitionsCard,\n      nexus: NexusCard,\n      material: index?.results?.material?.topology\n        ? MaterialCardTopology\n        : index?.results?.properties?.structures\n          ? MaterialCard\n          : MaterialCardFormula,\n      electronic: ElectronicPropertiesCard,\n      solarcell: SolarCellPropertiesCard,\n      vibrational: VibrationalPropertiesCard,\n      mechanical: MechanicalPropertiesCard,\n      thermodynamic: ThermodynamicPropertiesCard,\n      structural: StructuralPropertiesCard,\n      dynamical: DynamicalPropertiesCard,\n      geometry_optimization: GeometryOptimizationCard,\n      spectroscopic: SpectroscopicPropertiesCard,\n      workflow: WorkflowCard,\n      references: ReferenceUsingCard,\n      history: SampleHistoryUsingCard,\n      relatedResources: RelatedResourcesCard\n    }\n\n    if (isEmpty(cards?.options)) {\n      return <Alert severity=\"warning\">\n        No overview cards defined in the entry context. Ensure that all GUI artifacts are created.\n      </Alert>\n    }\n\n    return Object.values(cards.options).map((option) => {\n      let comp = null\n      const msg = option.error || \"Could not render card.\"\n      const key = option.key\n      if (key === 'sections') {\n        comp = <React.Fragment key={key}>\n            {sections\n            .map((section, index) => (\n              <ErrorHandler key={index} message={msg}>\n                <SectionCard\n                  {...section}\n                  archivePath={section.archivePath.replace(/\\./g, '/')}\n                  readOnly={!editable}\n                />\n              </ErrorHandler>\n            ))}\n        </React.Fragment>\n      } else {\n        const Comp = cardMap[key]\n        if (Comp) {\n          comp = <ErrorHandler key={key} message={msg}>\n            <Comp index={index} archive={archive} properties={properties}/>\n          </ErrorHandler>\n        }\n      }\n      return comp\n    })\n  }, [exists, index, cards, sections, editable, archive, properties])\n\n  if (!exists) {\n    return <Page>\n      <Typography>\n        This entry does not exist.\n      </Typography>\n    </Page>\n  }\n\n  if (!index) return null\n\n  return <Page limitedWidth>\n    <Grid container spacing={0} className={classes.root}>\n      <Grid item xs={4} className={classes.leftColumn}>\n        <MetadataSection title=\"Metadata\">\n          <MethodMetadata data={index} />\n        </MetadataSection>\n        <Divider className={classes.divider} />\n        <MetadataSection>\n          <Quantity flex>\n            <Quantity quantity='comment' data={index} />\n            <Quantity quantity='references' data={index}/>\n            <Quantity quantity='authors' data={index}/>\n            <Quantity quantity=\"datasets\" data={index}/>\n          </Quantity>\n        </MetadataSection>\n        <Divider className={classes.divider}/>\n        <MetadataSection>\n          <Quantity column style={{maxWidth: 350}}>\n            <Quantity quantity=\"mainfile\" data={index}/>\n            <Quantity quantity=\"entry_id\" data={index}/>\n            <Quantity quantity=\"results.material.material_id\" data={index}/>\n            <Quantity quantity=\"upload_id\" data={index}/>\n            <Quantity quantity=\"upload_create_time\" data={index}/>\n            <Quantity quantity=\"raw_id\" data={index}/>\n            <Quantity quantity=\"external_id\" data={index}/>\n            <Quantity quantity=\"last_processing_time\" data={index}/>\n            <Quantity quantity=\"last_processing_version\" data={index}/>\n          </Quantity>\n        </MetadataSection>\n        <SourceApiDialogButton label=\"API\" maxWidth=\"lg\" fullWidth ButtonProps={{variant: 'contained', size: 'small'}}>\n          {indexApiData && <SourceApiCall\n            {...indexApiData}\n            description=\"The basic metadata shown on this page is retrieved from the *entry metadata* API.\"\n          />}\n          <SourceDialogDivider />\n          {archiveApiData && <SourceApiCall\n            {...archiveApiData}\n            description=\"The detailed property information is retrieved from the *entry archive* API. Only a specific parts of the archive are *required*.\"\n          />}\n        </SourceApiDialogButton>\n      </Grid>\n\n      <Grid item xs={8} className={classes.rightColumn}>\n        {editable && (\n          <Box textAlign=\"right\" className={classes.editActions} display={'flex'} justifyContent={'flex-end'}>\n            <ArchiveReloadButton />\n            <ArchiveSaveButton />\n            <ArchiveReUploadButton />\n            <DeleteEntriesButton\n              isIcon\n              buttonProps={{color: \"primary\"}}\n            />\n          </Box>\n        )}\n        {cardComps}\n      </Grid>\n    </Grid>\n  </Page>\n})\n\nOverviewView.whyDidYouRender = true\n\nexport default OverviewView\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport { Card, CardContent, Typography, makeStyles } from '@material-ui/core'\nimport ArchiveBrowser from '../archive/ArchiveBrowser'\nimport Page from '../Page'\nimport { useEntryStore } from './EntryContext'\nimport { ApiDataContext } from '../buttons/SourceDialogButton'\n\nexport const help = `\nThe NOMAD **archive** provides data and meta-data in a common hierarchical format based on\nwell-defined quantity definitions that we call *metainfo*. This representation\nis independent from the raw data format and provides a homogenous data stock.\n\nYou can click the various quantity values to see the quantity definition. Similarly,\nyou can click section names to get more information. Browse the *metainfo* to\nlearn more about NOMAD's archive format [here](/metainfo).\n`\n\nconst useStyles = makeStyles(theme => ({\n  archiveBrowser: {\n    marginTop: theme.spacing(2)\n  },\n  error: {\n    marginTop: theme.spacing(2)\n  },\n  downloadFab: {\n    zIndex: 1,\n    right: 32,\n    bottom: 32,\n    position: 'fixed !important'\n  }\n}))\n\nexport default function ArchiveEntryView(props) {\n  const classes = useStyles()\n  const {url, archive, archiveApiData, exists} = useEntryStore('*')\n\n  if (!exists) {\n    return (\n      <Page>\n        <Typography className={classes.error}>\n          No archive exists for this entry. Either the archive was not generated due\n          to parsing or other processing errors (check the log tab), or the entry it\n          self does not exist.\n        </Typography>\n      </Page>\n    )\n  }\n\n  return (\n    <Page width={'100%'}>\n      {\n        archive && typeof archive !== 'string'\n          ? <div className={classes.archiveBrowser}>\n            <ApiDataContext.Provider value={archiveApiData}>\n              <ArchiveBrowser url={url} />\n            </ApiDataContext.Provider>\n          </div> : <div>{\n            archive\n              ? <div>\n                <Typography>Processed data is not valid JSON. Displaying plain text instead.</Typography>\n                <Card>\n                  <CardContent>\n                    <pre>{archive || ''}</pre>\n                  </CardContent>\n                </Card>\n              </div>\n              : <Typography>loading ...</Typography>\n          }</div>\n      }\n    </Page>\n  )\n}\nArchiveEntryView.propTypes = {}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useEffect, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { Typography, Accordion, AccordionSummary, AccordionDetails, makeStyles, FormGroup, Button, Grid, FormControl, InputLabel, Input, Select, MenuItem, Chip } from '@material-ui/core'\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore'\nimport ReactJson from 'react-json-view'\nimport { amber } from '@material-ui/core/colors'\nimport Page from '../Page'\nimport { useErrors } from '../errors'\nimport { useApi } from '../api'\nimport { useEntryStore } from './EntryContext'\nimport Checkbox from '@material-ui/core/Checkbox'\nimport FormControlLabel from '@material-ui/core/FormControlLabel'\nimport { pluralize } from '../../utils'\n\nconst useLogEntryStyles = makeStyles(theme => ({\n  warning: {\n    color: amber[700]\n  },\n  exception: {\n    overflowX: 'scroll',\n    margin: 0\n  }\n}))\n\nconst LogEntry = React.memo(function LogEntry(props) {\n  const classes = useLogEntryStyles()\n  const {data, keyNames} = props\n\n  const summaryProps = {}\n  if (data.level === 'ERROR' || data.level === 'CRITICAL') {\n    summaryProps.color = 'error'\n  } else if (data.level === 'WARNING') {\n    summaryProps.classes = {root: classes.warning}\n  }\n  return (\n    <Accordion data-testid='Accordions'>\n      <AccordionSummary expandIcon={<ExpandMoreIcon />}>\n        <Typography {...summaryProps}>{data.level}: {(keyNames.map((key) => `${data[key]}`).join(' | '))}</Typography>\n      </AccordionSummary>\n      <AccordionDetails>\n        <ReactJson\n          src={data}\n          enableClipboard={false}\n          displayObjectSize={false} />\n      </AccordionDetails>\n      {data.exception && <AccordionDetails>\n        <pre className={classes.exception}>{data.exception}</pre>\n      </AccordionDetails>}\n    </Accordion>\n  )\n})\nLogEntry.propTypes = {\n  data: PropTypes.object.isRequired,\n  keyNames: PropTypes.array.isRequired\n}\n\nconst useStyles = makeStyles(theme => ({\n  moreLogs: {\n    marginTop: theme.spacing(2)\n  },\n  downloadFab: {\n    zIndex: 1,\n    right: 32,\n    bottom: 32,\n    position: 'fixed !important'\n  },\n  formControl: {\n    margin: theme.spacing(1),\n    minWidth: 120,\n    maxWidth: 350\n  },\n  chips: {\n    display: 'flex',\n    flexWrap: 'wrap'\n  },\n  chip: {\n    margin: 2\n  },\n  noLabel: {\n    marginTop: theme.spacing(3)\n  },\n  seeMore: {\n    margin: theme.spacing(3)\n  }\n}))\n\nconst FilterLogsByLevel = React.memo(function FilterLogsByLevel(props) {\n  const {logLevels, onCheckListChanged} = props\n  return (\n    <FormGroup row >\n      <Typography style={{padding: '8px', textAlign: 'bottom'}}>\n          Filter Logs by Level:\n      </Typography>\n      {['ERROR', 'CRITICAL', 'WARNING', 'INFO', 'DEBUG'].map((key, i) => {\n        return (\n          <FormControlLabel key={i}\n            control={<Checkbox\n              checked={logLevels[key]}\n              onChange={onCheckListChanged}\n              name={key} id={`${i}`}/>}\n            label={key}\n          />\n        )\n      })}\n    </FormGroup>\n  )\n})\nFilterLogsByLevel.propTypes = {\n  logLevels: PropTypes.object.isRequired,\n  onCheckListChanged: PropTypes.func.isRequired\n}\n\nconst FilterLogTagsByKeys = React.memo(function FilterLogTagsByKeys(props) {\n  const {className, keyNames, onKeyNamesChanged, uniquekeys} = props\n  return (\n    <FormControl data-testid='dropdown-menu' className={className.formControl}>\n      <InputLabel data-testid='multipleSelect' id=\"mutiple-chip-label\">Filter keys by:</InputLabel>\n      <Select\n        labelId=\"mutiple-chip-label\"\n        id=\"mutiple-chip\"\n        data-testid={'selectOption'}\n        multiple\n        value={keyNames}\n        onChange={onKeyNamesChanged}\n        input={<Input id=\"select-multiple-chip\" />}\n        renderValue={(selected) => (\n          <div className={className.chips}>\n            {selected.map((value) => (\n              <Chip key={value} label={value} className={className.chip} />\n            ))}\n          </div>\n        )}\n      >\n        {uniquekeys.map((name) => (\n          <MenuItem data-testid={`${name}`} key={name} value={name}>\n            {name}\n          </MenuItem>\n        ))}\n      </Select>\n    </FormControl>\n  )\n})\nFilterLogTagsByKeys.propTypes = {\n  className: PropTypes.object.isRequired,\n  keyNames: PropTypes.array.isRequired,\n  onKeyNamesChanged: PropTypes.func.isRequired,\n  uniquekeys: PropTypes.array.isRequired\n}\n\nexport default function ArchiveLogView(props) {\n  const classes = useStyles()\n  const {entryId, metadata} = useEntryStore()\n  const {api} = useApi()\n  const {raiseError} = useErrors()\n\n  const [data, setData] = useState(null)\n  const [doesNotExist, setDoesNotExist] = useState(false)\n\n  const [logLevels, setLogLevels] = useState({\n    DEBUG: true,\n    ERROR: true,\n    CRITICAL: true,\n    WARNING: true,\n    INFO: true\n  })\n\n  const [numberOfLogs, setNumberOflogs] = useState(10)\n  const [keyNames, setkeyNames] = useState(['parser', 'event'])\n\n  const handlekeyNamesChanged = (e) => {\n    setkeyNames(e.target.value)\n  }\n\n  const handleCheckListChanged = (e) => {\n    setLogLevels({...logLevels, [e.target.name]: e.target.checked})\n  }\n\n  useEffect(() => {\n    api.post(`/entries/${entryId}/archive/query`, {required: {processing_logs: '*'}})\n      .then(response => {\n        const data = response.data.archive.processing_logs || []\n        setData(data)\n      })\n      .catch(error => {\n        if (error.name === 'DoesNotExist') {\n          setDoesNotExist(true)\n        } else {\n          raiseError(error)\n        }\n      })\n  }, [setData, setDoesNotExist, api, raiseError, entryId])\n\n  // Calculate extendedData, which is the log entries fetched + a synthetic log entry, created\n  // if the metadata object from the entry page context contains anything in processing_errors.\n  // The reason for this is that the processing_logs is fetched from the archive file, and\n  // does not include errors occuring after the archive file is written, but these can (in most\n  // cases) be found in metadata.processing_errors.\n  const extendedData = data ? [...data] : []\n  if (metadata?.processing_errors?.length) {\n    extendedData.push({\n      event: 'processing error',\n      level: 'ERROR',\n      timestamp: metadata.last_processing_time,\n      processing_errors: metadata.processing_errors\n    })\n  }\n\n  if (doesNotExist && !extendedData.length) {\n    return (\n      <Page>\n        <Typography>\n          No archive log does exist for this entry. Most likely the entry itself does not\n          exist.\n        </Typography>\n      </Page>\n    )\n  }\n\n  let content = 'loading ...'\n  if (extendedData.length) {\n    const uniquekeys = [...new Set(\n      extendedData.reduce((aggregatedKeys, item) => [...aggregatedKeys, ...Object.keys(item)], []))]\n    const filteredIndices = extendedData.map((entry, i) => logLevels[entry.level] ? i : null).filter(el => el !== null)\n\n    content =\n      <Grid container alignItems='flex-end'>\n        <Grid container alignItems='flex-end'>\n          <Grid item xs={8}>\n            <FilterLogsByLevel logLevels={logLevels} onCheckListChanged={handleCheckListChanged}/>\n          </Grid>\n          <Grid item xs={4} >\n            <FilterLogTagsByKeys\n              className={classes}\n              keyNames={keyNames}\n              onKeyNamesChanged={handlekeyNamesChanged}\n              uniquekeys={uniquekeys}\n            />\n          </Grid>\n          <Grid container spacing={1}>\n          {filteredIndices.slice(0, numberOfLogs).map(i =>\n            <Grid item xs={12} key={i}><LogEntry key={i} data={extendedData[i]} keyNames={keyNames}/></Grid>)}\n          </Grid>\n          <Grid container alignItems='center' justifyContent='center'>\n            {filteredIndices.length === 0\n              ? <Typography color=\"error\">No log entries matching selected criteria</Typography>\n              : filteredIndices.length > numberOfLogs\n                ? <Typography>{`Showing ${numberOfLogs} of ${filteredIndices.length} matching entries`}</Typography>\n                : <Typography>{`${filteredIndices.length} matching log ${pluralize('entry', filteredIndices.length)} found`}</Typography>}\n          </Grid>\n          <Grid container alignItems='center' justifyContent='center'>\n            {filteredIndices.length > numberOfLogs &&\n              <Button\n                className={classes.seeMore} variant='contained' color='primary'\n                onClick={() => setNumberOflogs(numberOfLogs + 10)}>\n              Load More\n            </Button>}\n          </Grid>\n        </Grid>\n      </Grid>\n  }\n\n  return (\n    <Page limitedWidth>\n      {content}\n    </Page>\n  )\n}\nArchiveLogView.propTypes = {}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useState, useEffect } from 'react'\nimport { Typography, makeStyles } from '@material-ui/core'\nimport { useErrors } from '../errors'\nimport FileBrowser from '../archive/FileBrowser'\nimport { useApi } from '../api'\nimport Page from '../Page'\nimport { useEntryStore } from './EntryContext'\nimport { createUploadUrl } from '../../utils'\nimport { apiBase } from '../../config'\n\nconst useStyles = makeStyles(theme => ({\n  error: {\n    marginTop: theme.spacing(2)\n  }\n}))\nconst BrowseEntryFilesView = React.memo((props) => {\n  const {entryId} = useEntryStore()\n  const classes = useStyles()\n  const {api} = useApi()\n  const {raiseError} = useErrors()\n\n  const [data, setData] = useState(null)\n  const [doesNotExist, setDoesNotExist] = useState(false)\n\n  useEffect(() => {\n    api.get(`/entries/${entryId}?include=mainfile&include=upload_id&include=writers&include=published`)\n      .then(response => {\n        setData(response.data)\n      })\n      .catch(error => {\n        if (error.name === 'DoesNotExist') {\n          setDoesNotExist(true)\n        } else {\n          raiseError(error)\n        }\n      })\n  }, [setData, setDoesNotExist, api, raiseError, entryId])\n\n  if (doesNotExist) {\n    return (\n      <Page>\n        <Typography className={classes.error}>\n          This entry does not exist.\n        </Typography>\n      </Page>\n    )\n  }\n  if (data && data?.upload_id && data?.mainfile) {\n    const lastSlash = data.mainfile.lastIndexOf('/')\n    const mainfileDirname = lastSlash === -1 ? '' : data.mainfile.substr(0, lastSlash)\n    const mainfileBasename = data.mainfile.split('/').pop()\n    return <Page>\n      <FileBrowser\n        uploadUrl={createUploadUrl(apiBase, data.upload_id, mainfileDirname)} // TODO: deploymentUrl should come from entry context\n        rootTitle=\"Entry files\"\n        highlightedItem={mainfileBasename}\n      />\n    </Page>\n  } else {\n    return <Page><Typography>loading ...</Typography></Page>\n  }\n})\nBrowseEntryFilesView.propTypes = {}\nexport default BrowseEntryFilesView\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useEffect, useMemo, useRef} from 'react'\nimport PropTypes from 'prop-types'\nimport { makeStyles, Tab, Tabs } from '@material-ui/core'\nimport { trimEnd } from 'lodash'\nimport OverviewView from './OverviewView'\nimport ArchiveEntryView from './ArchiveEntryView'\nimport ArchiveLogView from './ArchiveLogView'\nimport BrowseEntryFilesView from './BrowseEntryFilesView'\nimport { useRouteMatch, useHistory, matchPath, Redirect } from 'react-router-dom'\nimport { CacheRoute, CacheSwitch } from 'react-router-cache-route'\nimport { EntryContext, useEntryStore } from './EntryContext'\nimport ErrorOutlineIcon from '@material-ui/icons/ErrorOutline'\nimport {useDataStore} from '../DataStore'\n\nconst useStyles = makeStyles(theme => ({\n  errorLogs: {\n    color: theme.palette.error.main\n  },\n  errorIcon: {\n    verticalAlign: 'middle',\n    paddingRight: 10\n  }\n}))\n\nfunction EntryTabs({tab, onChange}) {\n  const {metadata} = useEntryStore()\n  const dataStore = useDataStore()\n  const styles = useStyles()\n  const entryHasProcessingError = metadata?.processing_errors?.length > 0\n\n  useEffect(() => {\n    dataStore.breadcrumb.setUpload(metadata?.upload_name || 'Upload')\n    dataStore.breadcrumb.setEntry(metadata?.entry_name || metadata?.mainfile || 'Entry')\n  }, [dataStore.breadcrumb, metadata?.entry_name, metadata?.mainfile, metadata?.upload_name])\n\n  const renderLogsTabLabel = () => {\n    if (entryHasProcessingError) {\n      return (\n        <div className={styles.errorLogs}>\n          <ErrorOutlineIcon className={styles.errorIcon} />\n          Logs\n        </div>\n      )\n    }\n    return 'Logs'\n  }\n\n  return <Tabs\n      value={tab}\n      onChange={onChange}\n      indicatorColor=\"primary\"\n      textColor=\"primary\"\n      variant=\"fullWidth\"\n    >\n      <Tab label=\"Overview\" value=\"overview\" />\n      <Tab label=\"Files\" value=\"files\" />\n      <Tab label=\"Data\" value=\"data\"/>\n      <Tab label={renderLogsTabLabel()} value=\"logs\" />\n    </Tabs>\n}\n\nEntryTabs.propTypes = {\n  tab: PropTypes.string,\n  onChange: PropTypes.func\n}\n\nexport const help = `\nThe *overview* tab gives you an insightful overview about the most prominent\ncontents found in an entry. You can find more details in the *archive* tab.\n\nThe *raw data* tab will show you all files that belong to the entry and offers a download\non individual, or all files. The files can be selected and downloaded. You can also\nview the contents of some files directly here on this page.\n\nThe *archive* tab shows you the parsed data as a tree\ndata structure. This view is connected to NOMAD's [metainfo](/metainfo), which acts a schema for\nall parsed data.\n\nThe *log* tab will show you a log of the entry's processing.\n`\n\nconst EntryPage = React.memo(() => {\n  const history = useHistory()\n  const currentPath = history.location.pathname\n  const {path, url} = useRouteMatch()\n  const match = matchPath(currentPath, { path: `${path}/:tab?` })\n  const {params: {tab = 'overview'}} = match\n  const entryId = match?.params?.entryId\n  const defaultUrls = useMemo(() => {\n    const urlNoSlash = trimEnd(url, '/')\n    return {\n      'overview': `${urlNoSlash}/overview`,\n      'files': `${urlNoSlash}/files/_mainfile`,\n      'data': `${urlNoSlash}/data`,\n      'logs': `${urlNoSlash}/logs`\n    }\n  }, [url])\n\n  // We use a useRef object to keep track of the current urls of each tab. Switching\n  // tabs would go to the previous tab url. This way, the views behind a tab can add\n  // state to the URL (e.g. path to section on the ArchiveEntryView).\n  const urls = useRef(defaultUrls)\n\n  const handleChange = (_, value) => {\n    urls.current[tab] = currentPath\n    history.push(urls.current[value])\n  }\n\n  // Reset the urls if a new entry is visited\n  useMemo(() => {\n    if (entryId) {\n      urls.current = defaultUrls\n    }\n  }, [entryId, defaultUrls, urls])\n\n  return <EntryContext entryId={entryId}>\n    <EntryTabs tab={tab} onChange={handleChange} />\n    <CacheSwitch>\n      <CacheRoute path={`${path}`} exact render={() => <OverviewView/>} />\n      <CacheRoute when=\"always\" path={`${path}/files`} render={() => <BrowseEntryFilesView />} />\n      <CacheRoute when=\"back\" path={`${path}/data`} render={() => <ArchiveEntryView />} />\n      <CacheRoute path={`${path}/logs`} render={() => <ArchiveLogView />}/>\n      <Redirect strict from={`${path}/overview`} to={`${path}`} />\n    </CacheSwitch>\n  </EntryContext>\n})\n\nexport default EntryPage\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Button } from '@material-ui/core'\nimport React, { useState } from 'react'\nimport { useHistory, useLocation } from 'react-router-dom'\nimport { useApi } from '../api'\nimport { useErrors } from '../errors'\nimport { getUrl } from '../nav/Routes'\nimport PropTypes from 'prop-types'\n\nexport default function NewUploadButton({...props}) {\n  const {api} = useApi()\n  const errors = useErrors()\n  const history = useHistory()\n  const location = useLocation()\n  const [clicked, setClicked] = useState(false)\n  const handleClick = () => {\n    setClicked(true)\n    api.post('/uploads')\n      .then((upload) => {\n        history.push(getUrl(`upload/id/${upload.upload_id}`, location))\n      })\n      .catch((error) => {\n        setClicked(false)\n        errors.raiseError(error)\n      })\n  }\n\n  return <Button variant=\"contained\" onClick={handleClick} disabled={clicked} {...props}>\n    Create a new upload\n  </Button>\n}\nNewUploadButton.propTypes = {\n  isDisable: PropTypes.bool\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Box, Button, Dialog, DialogActions, DialogContent, DialogTitle, Typography } from '@material-ui/core'\nimport React, { useCallback, useState, useMemo } from 'react'\nimport PropTypes from 'prop-types'\nimport { useApi } from '../api'\nimport { useErrors } from '../errors'\nimport Markdown from '../Markdown'\nimport { useHistory } from 'react-router-dom'\nimport { ui, exampleUploads } from '../../config'\n\nconst ExampleUploadDialog = React.memo(function ExampleUploadDialog(props) {\n  const { onSelect, ...dialogProps } = props\n\n  const exampleUploadsConfig = useMemo(() => ui?.exampleUploads || {}, [])\n  const filterExamples = useCallback(key => (\n    (key => !exampleUploadsConfig.include || exampleUploadsConfig.include.includes(key)) &&\n    (key => !exampleUploadsConfig.exclude || !exampleUploadsConfig.exclude.includes(key))\n  ), [exampleUploadsConfig])\n\n  const renderCategory = useCallback(category => {\n    return Object.keys(category)\n      .filter(filterExamples)\n      .map(key => {\n        const exampleUpload = category[key]\n        return (\n          <Box key={key} display=\"flex\" flexDirection=\"row\" marginBottom={2} alignItems=\"baseline\">\n            <Box marginRight={2} flexGrow={1}>\n              <Typography variant=\"h6\">{exampleUpload.title}</Typography>\n              <Markdown>{`${exampleUpload.description}`}</Markdown>\n            </Box>\n            <Button\n              variant=\"contained\" color=\"primary\" size=\"small\"\n              onClick={() => onSelect(exampleUpload)}\n            >\n              add\n            </Button>\n          </Box>\n        )\n      })\n  }, [filterExamples, onSelect])\n\n  return (\n    <Dialog {...dialogProps}>\n      <DialogTitle id=\"Uploads-dialogBox\">Select a sample Upload</DialogTitle>\n      <DialogContent>\n        <Box maxHeight={800}>\n          {Object.keys(exampleUploads).map(categoryKey => (\n            <Box key={categoryKey} marginBottom={6}>\n              <Typography variant='h5'>{categoryKey}</Typography>\n              <Box marginTop={2}>{renderCategory(exampleUploads[categoryKey])}</Box>\n            </Box>\n          ))}\n        </Box>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={dialogProps.onClose}>cancel</Button>\n      </DialogActions>\n    </Dialog>\n  )\n})\n\nExampleUploadDialog.propTypes = {\n  onClose: PropTypes.func.isRequired,\n  onSelect: PropTypes.func.isRequired\n}\n\nexport default function ExampleUploadButton(props) {\n  const {api} = useApi()\n  const {raiseError} = useErrors()\n  const history = useHistory()\n\n  const [isOpen, setOpen] = useState(false)\n\n  const handleClickOpen = () => {\n    setOpen(true)\n  }\n\n  const handleClose = () => setOpen(false)\n\n  const handleSelect = (exampleUpload) => {\n    api.post(`/uploads?local_path=${exampleUpload.local_path}&upload_name=${exampleUpload.title}`)\n      .then((data) => {\n        history.push(`/user/uploads/upload/id/${data.upload_id}`)\n      })\n      .catch(raiseError)\n      .finally(() => {\n        setOpen(false)\n      })\n  }\n\n  return (\n    <div>\n      <Button variant=\"contained\" onClick={handleClickOpen}>\n        Add Example Uploads\n      </Button>\n      <ExampleUploadDialog\n        open={isOpen}\n        onClose={handleClose}\n        onSelect={handleSelect}\n      />\n    </div>\n  )\n}\nExampleUploadButton.propTypes = {\n  isDisable: PropTypes.bool\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useState, useCallback, useEffect, useMemo} from 'react'\nimport PropTypes from 'prop-types'\nimport {\n  Tooltip,\n  IconButton,\n  Dialog,\n  DialogContent,\n  DialogContentText,\n  DialogActions,\n  Button\n} from '@material-ui/core'\nimport DeleteIcon from '@material-ui/icons/Delete'\nimport {pluralize} from '../../utils'\nimport {useApi} from '../api'\nimport {useErrors} from '../errors'\nimport DeletingReferencesTable from './DeletingReferencesTable'\n\n/**\n * Button for deleting uploads. Shows a confirmation dialog with additional\n * information about the effects of the deletion.\n */\nconst DeleteUploadsButton = React.memo(({\n  tooltip,\n  disabled,\n  buttonProps,\n  dark,\n  uploads,\n  onConfirm,\n  'data-testid': testID\n}) => {\n  const [openDialog, setOpenDialog] = useState(false)\n  const {api} = useApi()\n  const {raiseError} = useErrors()\n  const [entryReferences, setEntryReferences] = useState([])\n  const [brokenEntries, setBrokenEntries] = useState([])\n  const {uploadIDs, nUploads, shared, uploadText, haveText} = useMemo(() => {\n    const nUploads = uploads?.length || 0\n    const uploadText = pluralize('upload', nUploads, false)\n    const haveText = pluralize('has', nUploads, false)\n    return {\n      uploadIDs: uploads?.map(upload => upload.upload_id) || [],\n      nUploads,\n      shared: uploads?.some(entry => entry?.coauthors?.length > 0 || entry?.reviewers?.length > 0),\n      uploadText,\n      haveText\n    }\n  }, [uploads])\n\n  // Fetch information about whether deleting the uploads will result in broken\n  // references.\n  useEffect(() => {\n    if (!openDialog) return\n\n    api.post(`entries/query`,\n      {\n        owner: 'visible',\n        query: {entry_references: {'target_upload_id:any': uploadIDs}}\n      }\n    )\n      .then(results => {\n        const data = results?.data || []\n        if (data.length > 0) {\n          const brokenEntries = data.filter(entry => !uploadIDs.includes(entry.upload_id))\n          setBrokenEntries(brokenEntries)\n          const allReferences = data.map(entry => entry.entry_references).flat()\n          const references = [...new Map(allReferences.map(entry => [entry.target_entry_id, entry])).values()]\n          setEntryReferences(references)\n        }\n      })\n      .catch(raiseError)\n  }, [api, openDialog, raiseError, uploadIDs])\n\n  const handleClick = useCallback(() => {\n    setOpenDialog(true)\n  }, [])\n\n  const handleDelete = useCallback(() => {\n    setOpenDialog(false)\n    onConfirm && onConfirm()\n  }, [onConfirm])\n\n  return (\n    <React.Fragment>\n      <IconButton\n        {...buttonProps}\n        disabled={disabled}\n        onClick={handleClick}\n        style={dark ? {color: 'white'} : null}\n        data-testid={testID}\n      >\n        <Tooltip title={tooltip || `Delete selected ${uploadText}`}>\n          <DeleteIcon />\n        </Tooltip>\n      </IconButton>\n      <Dialog open={openDialog}>\n        <DialogContent>\n          <DialogContentText>\n            <b>{`Please confirm deleting the ${uploadText}`}</b>\n          </DialogContentText>\n          <DialogContentText>\n            {nUploads > 1 ? `You have selected ${nUploads} ${uploadText}. ` : ''}\n            {shared ? `The ${uploadText} you are about to delete ${haveText} been shared with at least one coauthor or reviewer. ` : ''}\n            {`Are you sure you want to delete the selected ${uploadText}?`}\n          </DialogContentText>\n          <DeletingReferencesTable entryReferences={entryReferences} brokenEntries={brokenEntries}/>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => setOpenDialog(false)} autoFocus>Cancel</Button>\n          <Button onClick={() => handleDelete()}>{brokenEntries.length > 0 ? 'Delete anyway' : 'Delete'}</Button>\n        </DialogActions>\n      </Dialog>\n    </React.Fragment>)\n})\nDeleteUploadsButton.propTypes = {\n  uploads: PropTypes.arrayOf(PropTypes.object).isRequired,\n  onConfirm: PropTypes.func.isRequired,\n  tooltip: PropTypes.string,\n  disabled: PropTypes.bool,\n  buttonProps: PropTypes.object,\n  dark: PropTypes.bool,\n  'data-testid': PropTypes.string\n}\n\nexport default DeleteUploadsButton\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useCallback, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { Button, Dialog, DialogActions, DialogContent, DialogTitle, Link } from '@material-ui/core'\n\n/** A link that opens a simple help/explanation dialog */\nconst DialogLink = React.memo(function DialogLink(props) {\n  const {title, text, linkProps, children, ...dialogProps} = props\n  const [open, setOpen] = useState(false)\n\n  const handleClick = useCallback(() => {\n    setOpen(true)\n  }, [setOpen])\n\n  const handleClose = useCallback(() => {\n    setOpen(false)\n  }, [setOpen])\n\n  return (\n    <React.Fragment>\n      <Dialog open={open} onClose={handleClose} {...dialogProps}>\n        <DialogTitle>{title}</DialogTitle>\n        <DialogContent>\n          {children}\n        </DialogContent>\n        <DialogActions>\n          <Button color=\"primary\" onClick={handleClose}>close</Button>\n        </DialogActions>\n      </Dialog>\n      <Link onClick={handleClick} href=\"#\" {...linkProps}>\n        {text}\n      </Link>\n    </React.Fragment>\n  )\n})\nDialogLink.propTypes = {\n  /** The dialog title. */\n  title: PropTypes.string.isRequired,\n  /** The text to render the link. */\n  text: PropTypes.string.isRequired,\n  /** The dialog contents. */\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ]),\n  /** Additional optional dialog props. */\n  linkProps: PropTypes.object\n  /** Other props are forwarded to the dialog compotnent. */\n}\n\nexport default DialogLink\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { IconButton, makeStyles, Tooltip } from '@material-ui/core'\nimport CopyToClipboard from 'react-copy-to-clipboard'\nimport ClipboardIcon from '@material-ui/icons/Assignment'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    display: 'flex',\n    flexDirection: 'row',\n    alignItems: 'center',\n    '& div': {\n      marginRight: theme.spacing(1)\n    }\n  }\n}))\n\nexport default function WithButton({children, button, icon, tooltip, onClick, clipboard, ...rest}) {\n  const classes = useStyles()\n\n  if (!icon && clipboard) {\n    icon = <ClipboardIcon style={{fontSize: 16}} />\n    rest.size = rest.size || 'small'\n  }\n\n  if (!button) {\n    button = <IconButton onClick={onClick} {...rest}>\n      {icon}\n    </IconButton>\n  }\n\n  if (tooltip) {\n    button = <Tooltip title={tooltip}>\n      {button}\n    </Tooltip>\n  }\n\n  if (clipboard) {\n    button = <CopyToClipboard\n      text={clipboard} onCopy={() => null}\n    >\n      <div onClick={e => e.stopPropagation()}>\n        {button}\n      </div>\n    </CopyToClipboard>\n  }\n\n  return <div className={classes.root}>\n    <div>{children}</div>\n    {button}\n  </div>\n}\n\nWithButton.propTypes = {\n  children: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ]),\n  button: PropTypes.node,\n  icon: PropTypes.node,\n  tooltip: PropTypes.string,\n  onClick: PropTypes.func,\n  clipboard: PropTypes.string\n}\n","import React, { useCallback, useEffect, useMemo, useState } from 'react'\nimport {\n  Button, TextField, Dialog, DialogTitle, IconButton, DialogContent,\n  DialogContentText, DialogActions, Tooltip, makeStyles, Box, RadioGroup, FormControlLabel, Radio,\n  FormControl\n} from '@material-ui/core'\nimport { Autocomplete } from '@material-ui/lab'\nimport { useApi } from '../api'\nimport { useErrors } from '../errors'\nimport { getUrl } from '../nav/Routes'\nimport { useHistory, useLocation } from 'react-router-dom'\nimport { getUrlFromDefinition, SectionMDef, useGlobalMetainfo } from '../archive/metainfo'\nimport { useUploadPageContext } from './UploadPageContext'\nimport SearchIcon from '@material-ui/icons/Search'\nimport SectionSelectDialog from './SectionSelectDialog'\nimport SectionSelectAutocomplete from './SectionSelectAutocomplete'\n\nconst useStyles = makeStyles(theme => ({\n  dialog: {\n    width: '100%',\n    minWidth: 600\n  },\n  nameField: {\n    marginBottom: theme.spacing(3),\n    width: '100%'\n  },\n  schemaField: {\n    marginBottom: theme.spacing(1),\n    width: '100%'\n  },\n  radioGroup: {\n    marginTop: 0,\n    display: 'flex'\n  }\n}))\n\nfunction addSearchIconToEndAdornment(endAdornment, onClick) {\n  const children = React.Children.toArray(endAdornment.props.children)\n  children.push(<IconButton key={'searchButton'} size={'small'} onClick={onClick}>\n    <Tooltip title=\"Search custom schema\">\n      <SearchIcon/>\n    </Tooltip>\n  </IconButton>)\n  return React.cloneElement(endAdornment, {}, children)\n}\n\nconst CreateEntry = React.memo((props) => {\n  const classes = useStyles()\n  const {deploymentUrl, uploadId, isProcessing} = useUploadPageContext()\n  const {api} = useApi()\n  const {raiseError} = useErrors()\n  const globalMetainfo = useGlobalMetainfo()\n  const [builtInTemplates, setBuiltInTemplates] = useState([])\n  const [builtInTemplate, setBuiltInTemplate] = useState(null)\n  const [customTemplate, setCustomTemplate] = useState(null)\n  const [name, setName] = useState('')\n  const [open, setOpen] = useState(false)\n  const history = useHistory()\n  const location = useLocation()\n  const [openEntryAlreadyExistsDialog, setOpenEntryAlreadyExistsDialog] = useState(false)\n  const [openCreateEntryDialog, setOpenCreateEntryDialog] = useState(false)\n  const [schemaType, setSchemaType] = useState('built-in')\n  const [error, setError] = useState()\n\n  useEffect(() => {\n    // TODO this whole thing is quite expensive to repeat on each upload page?\n    // There needs to be a register/cache based on hashes or something\n    if (!globalMetainfo) {\n      return\n    }\n\n    // Do not reload all possible entries while still processing.\n    if (isProcessing) {\n      return\n    }\n\n    const getTemplatesFromGlobalDefinitions = (definitions, prefix, archive, getReference) => {\n      const templates = definitions.filter(definition => {\n        if (definition.m_def !== SectionMDef) {\n          return false\n        }\n        return definition._allBaseSections?.find(baseSection => baseSection.name === 'EntryData')\n      }).map(definition => {\n        const label = definition.label || definition.name\n        const template = definition.m_annotations?.template?.[0] || {}\n        const findCategory = definition => (\n          definition.categories.find(category => (\n            category.categories.find(category => category._qualifiedName === 'nomad.datamodel.data.EntryDataCategory')\n          ))\n        )\n        let category\n        for (const baseDefinition of [definition, ...definition._allBaseSections]) {\n          category = findCategory(baseDefinition)\n          if (category) {\n            break\n          }\n        }\n        return {\n          id: `${prefix}:${definition._qualifiedName}`,\n          categoryLabel: category?.label || category?.name || 'Other',\n          categoryName: category?.name || 'Other',\n          definition,\n          label,\n          archive: {\n            data: {\n              m_def: getReference(definition),\n              ...template\n            }\n          }\n        }\n      })\n      const categoryNames = templates.map(template => template.categoryName)\n      const categoryOrder = ['BasicElnCategory', 'ElnExampleCategory', 'ElnIntegrationCategory', 'UseCaseElnCategory', 'WorkflowsElnCategory', 'Other']\n      categoryNames.sort((a, b) => categoryOrder.indexOf(a) - categoryOrder.indexOf(b))\n      templates.sort((a, b) => a.label.localeCompare(b.label))\n      templates.sort((a, b) => categoryNames.indexOf(a.categoryName) - categoryNames.indexOf(b.categoryName))\n      return templates\n    }\n\n    const getTemplates = async () => {\n      const globalDefinitions = await globalMetainfo.getDefs()\n      const globalTemplates = getTemplatesFromGlobalDefinitions(\n        globalDefinitions, '__global__', null, section => section._qualifiedName)\n      return globalTemplates.map(template => ({group: 'OASIS', ...template}))\n    }\n\n    getTemplates().then(templates => {\n      setBuiltInTemplates(templates)\n      setBuiltInTemplate(templates[0])\n    }).catch(raiseError)\n  }, [api, raiseError, setBuiltInTemplates, globalMetainfo, isProcessing, deploymentUrl, uploadId])\n\n  const handleAdd = useCallback(() => {\n    const selectedTemplate = schemaType === 'built-in' ? builtInTemplate : customTemplate\n    api.put(`uploads/${uploadId}/raw/?file_name=${name}.archive.json&overwrite_if_exists=false&wait_for_processing=true`, selectedTemplate.archive)\n      .then(response => {\n        // TODO handle processing errors\n        const entryId = response.processing.entry_id\n        history.push(getUrl(`entry/id/${entryId}/data/data`, location))\n        setOpenCreateEntryDialog(false)\n      })\n      .catch(error => {\n        if (error.apiMessage?.startsWith('The provided path already exists')) {\n          setOpenEntryAlreadyExistsDialog(true)\n        } else {\n          raiseError(error)\n        }\n      })\n  }, [setOpenEntryAlreadyExistsDialog, api, raiseError, schemaType, builtInTemplate, customTemplate, name, uploadId, history, location])\n\n  const handleBuiltInChange = useCallback((event, value) => {\n    setBuiltInTemplate(value)\n  }, [])\n\n  const getTemplateFromDefinition = useCallback((dataSection, prefix, archive, getReference) => {\n    let label = dataSection.name\n    const entry_name = archive?.metadata?.entry_name\n    const mainfile = archive?.metadata?.mainfile\n\n    if (entry_name) {\n      label = `${label} (${entry_name})`\n    } else if (mainfile) {\n      const file_name = mainfile.substring(mainfile.lastIndexOf('/') + 1)\n      label = `${label} (${file_name})`\n    } else if (prefix === '__global__') {\n      label = `${label} (OASIS)`\n    }\n    const template = dataSection.m_annotations?.template?.[0] || {}\n    return {\n      id: `${prefix}:${dataSection._qualifiedName}`,\n      label: label,\n      entry_id: prefix,\n      value: dataSection.name,\n      archive: {\n        data: {\n          m_def: getReference(dataSection),\n          ...template\n        }\n      }\n    }\n  }, [])\n\n  const handleCustomChange = useCallback((value) => {\n    const data = value?.data\n    if (!data) {\n      setCustomTemplate(null)\n      return\n    }\n    const customTemplate = getTemplateFromDefinition(data.sectionDef, data.archive.metadata.entry_id, data.archive,\n      section => {\n        return getUrlFromDefinition(section, {deploymentUrl, uploadId}, true)\n      })\n    setCustomTemplate(customTemplate)\n  }, [deploymentUrl, getTemplateFromDefinition, uploadId])\n\n  const handleSelect = useCallback((value) => {\n    const data = value?.data\n    if (!data) {\n      setCustomTemplate(null)\n      return\n    }\n    const customTemplate = getTemplateFromDefinition(data.sectionDef, data.archive.metadata.entry_id, data.archive,\n        section => {\n          return getUrlFromDefinition(section, {deploymentUrl, uploadId}, true)\n        })\n    setCustomTemplate(customTemplate)\n    setOpen(false)\n  }, [getTemplateFromDefinition, deploymentUrl, uploadId])\n\n  const filtersLocked = useMemo(() => ({'section_defs.definition_qualified_name': ['nomad.metainfo.metainfo.Definition']}), [])\n\n  const handleChangeTab = (event) => {\n    setSchemaType(event.target.value)\n  }\n\n  const handleError = useCallback((error) => {\n    setError(error)\n  }, [])\n\n  return <React.Fragment>\n    <Button\n      onClick={() => setOpenCreateEntryDialog(true)}\n      disabled={isProcessing}\n      {...props}\n    />\n    <Dialog\n      classes={{paper: classes.dialog}}\n      open={openCreateEntryDialog}\n      onClose={() => setOpenCreateEntryDialog(false)}\n      data-testid='create-entry-dialog'\n    >\n      <DialogTitle>Create new entry from schema</DialogTitle>\n      <DialogContent>\n        <DialogContentText>\n          Name of the entry\n        </DialogContentText>\n        <TextField\n          className={classes.nameField}\n          variant=\"filled\"\n          label=\"name\"\n          value={name}\n          onChange={event => setName(event.target.value.replace(/ /g, '_'))}/>\n        <DialogContentText>\n          Select a schema\n        </DialogContentText>\n        <FormControl component=\"fieldset\" className={classes.radioGroup}>\n          <RadioGroup\n            row\n            aria-label=\"position\"\n            name=\"position\"\n            value={schemaType}\n            onChange={handleChangeTab}\n            className={classes.radioGroup}\n          >\n            <FormControlLabel\n              value=\"built-in\"\n              control={<Radio color=\"primary\" />}\n              label=\"Built-in schema\"\n              labelPlacement=\"end\"\n            />\n            <FormControlLabel\n              value=\"custom\"\n              control={<Radio color=\"primary\" data-testid='custom-schema-radio'/>}\n              label=\"Custom schema\"\n              labelPlacement=\"end\"\n            />\n          </RadioGroup>\n        </FormControl>\n        {schemaType === 'built-in' && <Autocomplete\n          className={classes.schemaField}\n          disabled={!builtInTemplates}\n          value={builtInTemplates && builtInTemplates?.find(template => template.id === builtInTemplate?.id) ? builtInTemplate : null}\n          onChange={handleBuiltInChange}\n          options={builtInTemplates || []}\n          groupBy={option => option.categoryLabel}\n          getOptionLabel={option => option.label}\n          renderInput={(params) => {\n            return (\n                <TextField\n                  {...params}\n                  label='built-in schema'\n                  variant='filled'\n                  data-testid='builtin-select-schema'\n                />\n              )\n          }}\n        />}\n        {schemaType === 'custom' && <Box>\n          <SectionSelectAutocomplete\n              onValueChanged={handleCustomChange}\n              value={customTemplate}\n              filtersLocked={filtersLocked}\n              onError={handleError}\n              renderInput={(params) => {\n                return (\n                    <TextField\n                        {...params}\n                        variant='filled'\n                        error={!!error}\n                        helperText={error}\n                        label='custom schema'\n                        placeholder={'search by entry name or file name'}\n                        InputProps={{\n                          ...params.InputProps,\n                          endAdornment: addSearchIconToEndAdornment(\n                              params.InputProps.endAdornment,\n                              () => setOpen(true)\n                          )\n                        }}\n                        data-testid='custom-select-schema'\n                    />\n                )\n              }}\n          />\n        </Box>}\n        <DialogContentText>\n          {name ? `File name: ${name}.archive.json` : ''}\n        </DialogContentText>\n        <SectionSelectDialog\n          open={open}\n          onCancel={() => setOpen(false)}\n          onSelectedChanged={handleSelect}\n          selected={customTemplate && {entry_id: customTemplate?.entry_id, value: customTemplate?.value}}\n          filtersLocked={filtersLocked}\n        />\n      </DialogContent>\n      <DialogActions>\n        <span style={{flexGrow: 1}} />\n        <Button onClick={() => setOpenCreateEntryDialog(false)} color=\"secondary\">\n          Cancel\n        </Button>\n        <Button disabled={!name || name === '' || !(schemaType === 'built-in' ? builtInTemplate : customTemplate)} onClick={handleAdd} color=\"secondary\">\n          Create\n        </Button>\n      </DialogActions>\n    </Dialog>\n    <Dialog\n      open={openEntryAlreadyExistsDialog}\n      onClose={() => setOpenEntryAlreadyExistsDialog(false)}\n    >\n      <DialogTitle>Entry already exists</DialogTitle>\n      <DialogContent>\n        <DialogContentText>\n          A mainfile with the specified name already exists. Please choose a different name.\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => setOpenEntryAlreadyExistsDialog(false)} autoFocus>OK</Button>\n      </DialogActions>\n    </Dialog>\n  </React.Fragment>\n})\n\nexport default CreateEntry\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useCallback, useEffect, useMemo, useState} from 'react'\nimport {\n  makeStyles, DialogTitle, DialogContent, Dialog, IconButton, Tooltip, Divider,\n  Typography, TextField, Box\n} from '@material-ui/core'\nimport DialogContentText from '@material-ui/core/DialogContentText'\nimport EditIcon from '@material-ui/icons/Edit'\nimport Button from '@material-ui/core/Button'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport PropTypes from 'prop-types'\nimport AutoComplete from '@material-ui/lab/Autocomplete'\nimport {useApi} from '../api'\nimport {useErrors} from '../errors'\nimport {useLocation} from 'react-router'\nimport {Link} from 'react-router-dom'\nimport {getUrl} from '../nav/Routes'\nimport {Datatable, DatatableTable} from '../datatable/Datatable'\nimport DeleteIcon from '@material-ui/icons/Delete'\nimport OpenInNewIcon from '@material-ui/icons/OpenInNew'\nimport Quantity from '../Quantity'\nimport {DOI} from '../dataset/DOI'\nimport { useUploadPageContext } from './UploadPageContext'\n\nfunction EditComments(props) {\n  const {value, onChange} = props\n\n  return <Box display={'block'}>\n    <Box marginBottom={1} marginTop={1}>\n      <Typography variant='subtitle2'>\n        Comments\n      </Typography>\n    </Box>\n    <TextField\n      fullWidth label='Comment' multiline\n      minRows={6} defaultValue={value} variant='filled' size='small'\n      onChange={(event) => onChange(event.target.value)}\n      inputProps={{ 'data-testid': 'metadata-comment-field' }}\n    />\n  </Box>\n}\nEditComments.propTypes = {\n  value: PropTypes.string.isRequired,\n  onChange: PropTypes.func.isRequired\n}\n\nfunction EditReferences(props) {\n  const {values, onAdd, onRemove} = props\n  const [newReference, setNewReference] = useState('')\n  const [urlValidation, setUrlValidation] = useState('')\n\n  const validateURL = useCallback((value) => {\n    try {\n      const url = new URL(value)\n      if (url) {}\n    } catch (_) {\n      return 'Pleas enter a valid URL ...'\n    }\n  }, [])\n\n  const validation = useMemo(() => {\n    if (newReference === '') return undefined\n    if (values?.includes(newReference)) return 'The URL is already in the references'\n    return undefined\n  }, [values, newReference])\n\n  const columns = useMemo(() => {\n    return [\n      {key: 'url',\n        align: 'left',\n        render: reference => {\n          return <Box maxWidth='300px' whiteSpace='nowrap' textOverflow='ellipsis' overflow='hidden'>\n            <Quantity quantity='data' noLabel noWrap data={{data: reference.url}} withClipboard />\n          </Box>\n        }\n      }\n    ]\n  }, [])\n\n  const handleChangeReference = useCallback((event) => {\n    setUrlValidation(undefined)\n    setNewReference(event.target.value)\n  }, [])\n\n  const handleAdd = useCallback(() => {\n    const validateURLError = validateURL(newReference)\n    setUrlValidation(validateURLError)\n    if (validateURLError) return\n    onAdd(newReference)\n    setNewReference('')\n  }, [newReference, onAdd, validateURL])\n\n  const apiError = useMemo(() => values && values.find(value => !!(value?.error_reference))?.error_reference, [values])\n\n  return <Box display={'block'}>\n    <Box marginBottom={1} marginTop={3}>\n      <Typography variant='subtitle2'>\n        References\n      </Typography>\n    </Box>\n    <TextField\n      style={{width: '100%'}} label='Enter the URL' onChange={handleChangeReference}\n      error={!!(validation || urlValidation)} helperText={validation || urlValidation} variant='filled' size='small' value={newReference}\n      inputProps={{ 'data-testid': 'new-reference-field' }}\n    />\n    <Box display=\"flex\" justifyContent=\"right\" marginY={1}>\n      <Button variant=\"contained\" color=\"primary\" onClick={handleAdd} disabled={!!(validation || newReference === '')} data-testid='reference-add-button'>\n        add\n      </Button>\n    </Box>\n    {columns && values.length > 0 && <React.Fragment>\n      {apiError && <Typography color=\"error\" role='reference-api-error'>\n        {apiError}\n      </Typography>}\n      <Divider />\n      <Datatable columns={columns} data={values.filter(value => !(value?.error_reference)).map(value => Object({url: value, onRemove: onRemove}))}>\n        <DatatableTable actions={ReferencesActions} noHeader />\n      </Datatable>\n    </React.Fragment>}\n  </Box>\n}\nEditReferences.propTypes = {\n  values: PropTypes.arrayOf(PropTypes.string).isRequired,\n  onAdd: PropTypes.func.isRequired,\n  onRemove: PropTypes.func.isRequired\n}\n\nconst ReferencesActions = React.memo((props) => {\n  const {data} = props\n\n  const handleOpenLink = () => {\n    window.open(data.url, '_blank')\n  }\n\n  return <Box display={'inline-block'}>\n    <IconButton size='small' onClick={handleOpenLink}>\n      <Tooltip title='Open in new tab'>\n        <OpenInNewIcon />\n      </Tooltip>\n    </IconButton>\n    <IconButton size='small' onClick={() => data.onRemove(data.url)} data-testid='reference-delete-action'>\n      <Tooltip title='Remove the reference'>\n        <DeleteIcon />\n      </Tooltip>\n    </IconButton>\n  </Box>\n})\nReferencesActions.propTypes = {\n  data: PropTypes.object.isRequired\n}\n\nfunction EditDatasets(props) {\n  const {values, userDatasets, onCreate, onAdd, onRemove} = props\n  const [newDataset, setNewDataset] = useState('')\n  const [datasetToAdd, setDatasetToAdd] = useState('')\n\n  const columns = useMemo(() => ([\n    {key: 'dataset', align: 'left', render: row => ('doi' in row.dataset ? <span> {`${row.dataset.dataset_name},  DOI:`} <DOI doi={row.dataset.doi} /></span> : row.dataset.dataset_name)}\n  ]), [])\n\n  const isDuplicated = useMemo(() => {\n    return !!values.find(dataset => dataset.dataset_id && dataset.dataset_id === datasetToAdd.dataset_id)\n  }, [datasetToAdd, values])\n\n  const validation = useMemo(() => {\n    if (userDatasets.map(dataset => dataset.dataset_name).includes(newDataset)) return `There is already a dataset with name ${newDataset}`\n    if (values.map(dataset => dataset.dataset_name).includes(newDataset)) return `There is already a dataset with name ${newDataset}`\n    if (newDataset[0] === ' ') return `Invalid name for dataset`\n    return ''\n  }, [newDataset, values, userDatasets])\n\n  const handleDatasetToAddChanged = useCallback((event, value) => {\n    (value && value?.dataset_id ? setDatasetToAdd(value) : setDatasetToAdd(''))\n  }, [])\n\n  const handleNewDatasetChanged = useCallback((event) => {\n    setNewDataset(event.target.value)\n  }, [])\n\n  const handleCreate = useCallback(() => {\n    onCreate(newDataset)\n    setNewDataset('')\n  }, [newDataset, onCreate])\n\n  const handleAdd = useCallback(() => {\n    onAdd(datasetToAdd)\n    setDatasetToAdd('')\n  }, [datasetToAdd, onAdd])\n\n  const addDatasetButton = useMemo(() => {\n    if (validation === '' && newDataset !== '') {\n      return <Button color=\"primary\" variant=\"contained\" onClick={handleCreate}>\n        add entry to new dataset\n      </Button>\n    } else if (!isDuplicated && datasetToAdd !== '') {\n      return <Button variant=\"contained\" color=\"primary\" onClick={handleAdd}>\n        add entry to existing dataset\n      </Button>\n    } else {\n      return <Button color=\"primary\" variant=\"contained\" disabled>add</Button>\n    }\n  }, [datasetToAdd, newDataset, handleAdd, handleCreate, validation, isDuplicated])\n\n  const apiError = useMemo(() => values && values.find(value => !!(value?.error_dataset))?.error_dataset, [values])\n\n  return <Box display={'block'}>\n    <Box marginBottom={1} marginTop={3}>\n      <Typography variant='subtitle2'>\n        Datasets\n      </Typography>\n    </Box>\n    <Box marginBottom={1}>\n      <TextField\n        value={newDataset} onChange={handleNewDatasetChanged}\n        style={{width: '100%'}} label='Create a new dataset' placeholder='Dataset name'\n        error={validation !== ''} helperText={(validation !== '' && validation)}\n        variant='filled' size='small'\n        inputProps={{ 'data-testid': 'new-dataset-field' }}\n      />\n    </Box>\n    <AutoComplete\n      style={{width: '100%'}}\n      options={userDatasets}\n      getOptionLabel={option => option.dataset_name || ''}\n      onChange={handleDatasetToAddChanged}\n      value={datasetToAdd}\n      getOptionSelected={(option, value) => (value ? option?.dataset_name === value?.dataset_name : true)}\n      renderInput={params => (\n        <TextField\n          {...params}\n          variant='filled' label='Search for an existing dataset'\n          placeholder='Dataset name' margin='normal' fullWidth size='small'\n          error={isDuplicated || (datasetToAdd.dataset_name && validation.value === datasetToAdd.dataset_name)}\n          helperText={(isDuplicated ? 'The data is already in the selected dataset' : (validation.value === datasetToAdd.dataset_name ? validation.error : ''))}\n        />\n      )}\n    />\n    <Box display=\"flex\" justifyContent=\"right\" marginY={1}>\n      {addDatasetButton}\n    </Box>\n    {apiError && <Typography color=\"error\" role='dataset-api-error'>\n      {apiError}\n    </Typography>}\n    <Divider/>\n    {columns && values.length > 0 && <Datatable columns={columns} data={values.filter(value => !(value?.error_dataset)).map(value => Object({dataset: value, onRemove: onRemove}))}>\n      <DatatableTable actions={DatasetsActions} noHeader />\n    </Datatable>}\n  </Box>\n}\nEditDatasets.propTypes = {\n  values: PropTypes.arrayOf(PropTypes.object).isRequired,\n  userDatasets: PropTypes.arrayOf(PropTypes.object).isRequired,\n  onCreate: PropTypes.func.isRequired,\n  onAdd: PropTypes.func.isRequired,\n  onRemove: PropTypes.func.isRequired\n}\n\nconst DatasetsActions = React.memo((props) => {\n  const {data} = props\n  const location = useLocation()\n\n  const openDatasetUrl = useMemo(() => {\n    const path = `datasets/dataset/id/${data.dataset.dataset_id}`\n    return getUrl(path, location)\n  }, [data, location])\n\n  return <Box display={'inline-block'}>\n    {data.dataset.dataset_id && <IconButton size='small' component={Link} to={openDatasetUrl} target=\"_blank\">\n      <Tooltip title=\"Open in new tab\">\n        <OpenInNewIcon />\n      </Tooltip>\n    </IconButton>}\n    <IconButton size='small' onClick={() => data.onRemove(data.dataset)} disabled={!!data.dataset.doi && !data.dataset?.notSubmitted} style={{pointerEvents: 'auto'}} data-testid='dataset-delete-action'>\n      <Tooltip title={(data.dataset.doi && !data.dataset?.notSubmitted ? 'The dataset cannot be removed. A DOI has been assigned to the dataset.' : 'Remove the dataset')}>\n        <DeleteIcon />\n      </Tooltip>\n    </IconButton>\n  </Box>\n})\nDatasetsActions.propTypes = {\n  data: PropTypes.object.isRequired\n}\n\nconst useEditMetaDataDialogStyles = makeStyles(theme => ({\n  dialog: {\n    width: '100%'\n  }\n}))\n\nfunction EditMetaDataDialog({...props}) {\n  const {isIcon, selectedEntries} = props\n  const classes = useEditMetaDataDialogStyles()\n  const {api, user} = useApi()\n  const {raiseError} = useErrors()\n  const {uploadId, upload, entries, updateUpload} = useUploadPageContext()\n  const [open, setOpen] = useState(false)\n  const [openConfirmDialog, setOpenConfirmDialog] = useState(false)\n  const isProcessing = upload?.process_running\n  const nSelected = (selectedEntries.upload_id ? upload?.entries : selectedEntries.entry_id.length)\n  const [userDatasets, setUserDatasets] = useState([])\n  const [userDatasetsFetched, setUserDatasetsFetched] = useState(false)\n  const [actions, setActions] = useState([])\n\n  const handleDiscardChanges = useCallback(() => {\n    setOpenConfirmDialog(false)\n    setOpen(false)\n  }, [])\n\n  useEffect(() => {\n    if (open && !userDatasetsFetched) {\n      setUserDatasetsFetched(true)\n      api.get(`/datasets/?page_size=${1000}&page=${1}&user_id=${user.sub}`)\n        .then(datasets => {\n          setUserDatasets(datasets?.data)\n        })\n        .catch(err => {\n          setUserDatasets([])\n          raiseError(err)\n        })\n    }\n  }, [api, user, raiseError, open, userDatasetsFetched, setUserDatasetsFetched])\n\n  const selectedEntriesObjects = useMemo(() => {\n    return selectedEntries.upload_id ? entries : entries.filter(entry => selectedEntries.entry_id.includes(entry?.entry_id))\n  }, [entries, selectedEntries.entry_id, selectedEntries.upload_id])\n\n  const defaultComment = useMemo(() => (\n    entries?.length > 0 ? selectedEntriesObjects[0]?.entry_metadata?.comment || '' : ''\n  ), [entries, selectedEntriesObjects])\n\n  const defaultReferences = useMemo(() => {\n    if (entries?.length < 0) {\n      return []\n    }\n    const referencesList = selectedEntriesObjects.map(entry => entry?.entry_metadata?.references).flat()\n    return referencesList.filter((value, index) => referencesList.indexOf(value) === index)\n  }, [entries.length, selectedEntriesObjects])\n\n  const defaultDatasets = useMemo(() => {\n    if (entries?.length < 0) {\n      return []\n    }\n    const datasetsList = selectedEntriesObjects.map(entry => entry?.entry_metadata?.datasets)\n    return userDatasets.filter(datasetFullData => datasetsList.flat().map(dataset => dataset.dataset_id).includes(datasetFullData.dataset_id))\n  }, [selectedEntriesObjects, entries.length, userDatasets])\n\n  const handleOpenDialog = useCallback(() => {\n    setActions([])\n    setOpen(true)\n  }, [])\n\n  const createNewDatasets = useCallback(() => {\n    const promises = actions.filter(action => action.create_dataset).map(action => api.post(`/datasets/`, {dataset_name: action.create_dataset}))\n    return Promise.all(promises)\n  }, [api, actions])\n\n  const edit = useCallback((metadata, verify_only) => {\n    return new Promise((resolve, reject) => {\n      try {\n        const requestBody = {metadata: metadata, verify_only: verify_only, owner: 'user'}\n        if (selectedEntries.entry_id) requestBody.query = selectedEntries\n          api.post(`uploads/${uploadId}/edit`, requestBody)\n            .then(() => resolve(''))\n            .catch(error => reject(error.apiMessage))\n      } catch (error) {\n        reject(error.apiMessage)\n      }\n    })\n  }, [api, uploadId, selectedEntries])\n\n  const submitChanges = useCallback((metadata) => {\n    edit(metadata, true)\n      .then(response => {\n        edit(metadata, false)\n          .then(results => {\n            setActions([])\n            updateUpload({upload: results.data})\n          }).catch(err => {\n            raiseError(err)\n          })\n      })\n      .catch(errors => {\n        errors.forEach(error => {\n          if (error.loc.includes('references')) setActions(oldActions => [...oldActions, {'error_reference': error.msg}])\n          if (error.loc.includes('datasets')) setActions(oldActions => [...oldActions, {'error_dataset': error.msg}])\n        })\n      })\n  }, [edit, updateUpload, raiseError])\n\n  const isCommentChanged = useMemo(() => !!actions.find(action => 'set_comment' in action), [actions])\n  const isReferencesChanged = useMemo(() => !!actions.find(action => 'add_reference' in action || 'remove_reference' in action), [actions])\n  const isDatasetChanged = useMemo(() => !!actions.find(action => 'add_dataset' in action || 'remove_dataset' in action || 'create_dataset' in action), [actions])\n\n  const comment = useMemo(() => {\n    const action = actions.find(action => 'set_comment' in action)\n    return (action ? action.set_comment : defaultComment)\n  }, [actions, defaultComment])\n\n  const references = useMemo(() => {\n    let references = [...defaultReferences]\n    actions.forEach(action => {\n      if (action.add_reference) references = [...references, action.add_reference]\n      if (action.remove_reference) references = references.filter(reference => reference !== action.remove_reference)\n      if (action.error_reference) references = [...references, action]\n    })\n    return references\n  }, [actions, defaultReferences])\n\n  const datasets = useMemo(() => {\n    let datasets = [...defaultDatasets]\n    actions.forEach(action => {\n      if (action.add_dataset) {\n        const notSubmittedDataset = userDatasets.find(datasetFullData => action.add_dataset === datasetFullData.dataset_id)\n        notSubmittedDataset.notSubmitted = true\n        datasets = [...datasets, notSubmittedDataset]\n      }\n      if (action.create_dataset) datasets = [...datasets, {'dataset_name': action.create_dataset}]\n      if (action.remove_dataset) datasets = datasets.filter(dataset => dataset.dataset_id !== action.remove_dataset)\n      if (action.error_dataset) datasets = [...datasets, action]\n    })\n    return datasets\n  }, [actions, defaultDatasets, userDatasets])\n\n  const handleSubmitChanges = useCallback(() => {\n    if (isCommentChanged || isReferencesChanged || isDatasetChanged) {\n      const metadata = {}\n      if (isCommentChanged) metadata.comment = comment\n      if (isReferencesChanged) {\n        metadata.references = {}\n        if (actions.find(action => 'add_reference' in action)) metadata.references.add = actions.flatMap(action => action.add_reference || [])\n        if (actions.find(action => 'remove_reference' in action)) metadata.references.remove = actions.flatMap(action => action.remove_reference || [])\n      }\n      if (isDatasetChanged) {\n        metadata.datasets = {}\n        createNewDatasets().then(newDatasets => {\n          const newDatasetsIDs = newDatasets.map(_dataset => _dataset.dataset_id)\n          if (actions.find(action => 'add_dataset' in action || 'create_dataset' in action)) metadata.datasets.add = actions.flatMap(action => action.add_dataset || []).concat(newDatasetsIDs)\n          if (actions.find(action => 'remove_dataset' in action)) metadata.datasets.remove = actions.flatMap(action => action.remove_dataset || [])\n          submitChanges(metadata)\n        })\n      } else {\n        submitChanges(metadata)\n      }\n    } else {\n      setOpen(false)\n    }\n  }, [actions, comment, createNewDatasets, isCommentChanged, isDatasetChanged, isReferencesChanged, submitChanges])\n\n  const handleSetComment = useCallback((value) => {\n    const action = actions.find(action => 'set_comment' in action)\n    if (action) {\n      const newActions = [...actions]\n      if (value === defaultComment) {\n        newActions.splice(actions.indexOf(action), 1)\n      } else {\n        newActions[actions.indexOf(action)] = {set_comment: value}\n      }\n      setActions(newActions)\n    } else {\n      setActions(oldActions => [...oldActions, {set_comment: value}])\n    }\n  }, [actions, defaultComment])\n\n  const handleAddReference = useCallback((value) => {\n    setActions(oldActions => oldActions.filter(action => !('error_reference' in action)))\n    if (actions.flatMap(action => action.remove_reference || []).includes(value)) {\n      setActions(_actions => _actions.filter(action => action.remove_reference !== value))\n    } else {\n      setActions(_actions => [..._actions, {add_reference: value}])\n    }\n  }, [actions])\n\n  const handleRemoveReference = useCallback((value) => {\n    setActions(oldActions => oldActions.filter(action => !('error_reference' in action)))\n    if (actions.flatMap(action => action.add_reference || []).includes(value)) {\n      setActions(_actions => _actions.filter(action => action.add_reference !== value))\n    } else {\n      setActions(_actions => [..._actions, {remove_reference: value}])\n    }\n  }, [actions])\n\n  const handleCreateDataset = useCallback((value) => {\n    setActions(oldActions => oldActions.filter(action => !('error_dataset' in action)))\n    if (value && !actions.find(action => action.create_dataset === value)) {\n      setActions(_actions => [..._actions, {create_dataset: value}])\n    }\n  }, [actions])\n\n  const handleAddDataset = useCallback((value) => {\n    if (value) {\n      setActions(oldActions => oldActions.filter(action => !('error_dataset' in action)))\n      if (actions.flatMap(action => action.remove_dataset || []).includes(value.dataset_id)) {\n        setActions(_actions => _actions.filter(action => action.remove_dataset !== value.dataset_id))\n      } else {\n        setActions(_actions => [..._actions, {add_dataset: value.dataset_id}])\n      }\n    }\n  }, [actions])\n\n  const handleRemoveDataset = useCallback((value) => {\n    setActions(oldActions => oldActions.filter(action => !('error_dataset' in action)))\n    if (actions.flatMap(action => action.create_dataset || []).includes(value.dataset_name)) {\n      setActions(_actions => _actions.filter(action => action.create_dataset !== value.dataset_name))\n    } else if (actions.flatMap(action => action.add_dataset || []).includes(value.dataset_id)) {\n      setActions(_actions => _actions.filter(action => action.add_dataset !== value.dataset_id))\n    } else {\n      setActions(_actions => [..._actions, {remove_dataset: value.dataset_id}])\n    }\n  }, [actions])\n\n  const handleConfirm = useCallback(() => {\n    if (isCommentChanged || isReferencesChanged || isDatasetChanged) {\n      setOpenConfirmDialog(true)\n    } else {\n      setOpen(false)\n    }\n  }, [isCommentChanged, isDatasetChanged, isReferencesChanged])\n\n  return <React.Fragment>\n    {isIcon && <IconButton onClick={() => handleOpenDialog()}>\n      <Tooltip title=\"Edit metadata\">\n        <EditIcon />\n      </Tooltip>\n    </IconButton>}\n    {!isIcon && <Button onClick={() => handleOpenDialog()} variant='contained' color='primary' disabled={isProcessing} data-testid='edit-metadata-button'>\n      {upload?.entries && (upload?.entries > 1 ? `Edit metadata of all ${upload?.entries} entries` : `Edit metadata of all the entries`)}\n    </Button>}\n    {open && <Dialog classes={{paper: classes.dialog}} open={open} disableEscapeKeyDown data-testid='edit-metadata-dialog'>\n      <DialogTitle>Edit upload metadata</DialogTitle>\n      <DialogContent>\n        <DialogContentText>\n          You can add, edit, or remove the metadata for the selected entries.\n          <br/>\n          {nSelected} of {upload?.entries} {upload?.entries === 1 ? 'entry' : 'entries'} is selected.\n        </DialogContentText>\n        <Divider/>\n        <div>\n          <EditComments value={defaultComment} onChange={handleSetComment}/>\n          <EditReferences values={references} onAdd={handleAddReference} onRemove={handleRemoveReference}/>\n          <EditDatasets values={datasets} userDatasets={userDatasets} onCreate={handleCreateDataset} onAdd={handleAddDataset} onRemove={handleRemoveDataset}/>\n        </div>\n      </DialogContent>\n      <DialogActions>\n        <span style={{flexGrow: 1}} />\n        <Button onClick={handleConfirm} color=\"secondary\">\n          Cancel\n        </Button>\n        <Button onClick={handleSubmitChanges} disabled={!(isCommentChanged || isReferencesChanged || isDatasetChanged)} color=\"secondary\">\n          Submit\n        </Button>\n      </DialogActions>\n      <Dialog\n        open={openConfirmDialog}\n        aria-describedby=\"alert-dialog-description\"\n      >\n        <DialogContent>\n          <DialogContentText id=\"alert-dialog-description\">\n            Your changes are not submitted yet. Discard changes?\n          </DialogContentText>\n        </DialogContent>\n        <DialogActions>\n          <Button onClick={() => setOpenConfirmDialog(false)} autoFocus>Cancel</Button>\n          <Button onClick={handleDiscardChanges}>Discard</Button>\n        </DialogActions>\n      </Dialog>\n    </Dialog>}\n  </React.Fragment>\n}\nEditMetaDataDialog.propTypes = {\n  isIcon: PropTypes.bool,\n  selectedEntries: PropTypes.object\n}\n\nexport default EditMetaDataDialog\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useRef, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { Button, Dialog, DialogActions, DialogContent, DialogTitle, makeStyles } from '@material-ui/core'\nimport InfiniteScroll from 'react-infinite-scroller'\n\nconst useFilePreviewStyles = makeStyles(theme => ({\n  contents: {\n    width: '85%',\n    overflowX: 'auto',\n    color: theme.palette.primary.contrastText,\n    backgroundColor: theme.palette.primary.dark,\n    marginTop: theme.spacing(1),\n    padding: '3px 6px',\n    fontFamily: 'Consolas, \"Liberation Mono\", Menlo, Courier, monospace',\n    fontSize: 12\n  }\n}))\n\nexport default function FilePreview({uploadId, path, onClose}) {\n  const scrollRef = useRef()\n  const [content] = useState(null)\n  const classes = useFilePreviewStyles()\n\n  return <Dialog open>\n    <DialogTitle>File preview: {path}</DialogTitle>\n    <DialogContent ref={scrollRef}>\n      <InfiniteScroll\n        className={classes.fileContents}\n        pageStart={0}\n        loadMore={() => console.log('### load more')}\n        hasMore={false}\n        useWindow={false}\n        getScrollParent={() => scrollRef.current}\n      >\n        <pre style={{margin: 0}}>\n          {`${content}`}\n          &nbsp;\n        </pre>\n      </InfiniteScroll>\n    </DialogContent>\n    <DialogActions>\n      <Button onClick={onClose} color=\"primary\">\n        Cancel\n      </Button>\n    </DialogActions>\n  </Dialog>\n}\n\nFilePreview.propTypes = {\n  uploadId: PropTypes.string.isRequired,\n  path: PropTypes.string.isRequired,\n  onClose: PropTypes.func\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect, useMemo, useRef, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { Box, Chip, CircularProgress, Collapse, IconButton, makeStyles, Paper, Tooltip, Typography } from '@material-ui/core'\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore'\nimport ChevronRightIcon from '@material-ui/icons/ChevronRight'\nimport NavigateIcon from '@material-ui/icons/ArrowForward'\nimport { useApi } from '../api'\nimport { useErrors } from '../errors'\nimport FilePreview from './FilePreview'\nimport { EntryButton } from '../nav/Routes'\n\nconst useFolderStyles = makeStyles(theme => ({\n  root: {},\n  item: {\n    '&:hover': {\n      backgroundColor: theme.palette.grey[100]\n    },\n    width: '100%',\n    display: 'flex',\n    flexDirection: 'raw',\n    alignItems: 'center',\n    flexWrap: 'nowrap',\n    height: 32,\n    paddingRight: theme.spacing(1)\n  },\n  icon: {\n  },\n  name: {\n\n  },\n  tags: {\n    // textTransform: 'uppercase',\n    marginLeft: theme.spacing(1)\n  },\n  info: {\n    marginLeft: theme.spacing(1)\n  },\n  actions: {\n    marginLeft: theme.spacing(1),\n    display: 'flex',\n    flexDirection: 'row',\n    justifyContent: 'flex-end',\n    flexWrap: 'nowrap'\n  },\n  children: {\n    marginLeft: theme.spacing(3)\n  }\n}))\n\nfunction FileOrFolder({onToggle, open, hasChildren, children, name, parser, info, entry_id, path}) {\n  const classes = useFolderStyles()\n  const handleToggle = event => {\n    event.stopPropagation()\n    if (onToggle) {\n      onToggle()\n    }\n  }\n  const iconProps = {\n    className: classes.icon,\n    fontSize: 'small'\n  }\n  const icon = hasChildren\n    ? (open ? <ExpandMoreIcon {...iconProps} /> : <ChevronRightIcon {...iconProps}/>)\n    : <div className={classes.icon} />\n\n  return <div className={classes.root}>\n    <div onClick={handleToggle} className={classes.item}>\n      {icon}\n      <Box marginLeft={icon ? 1 : 0}>\n        <Typography className={classes.name}>{name || '/'}</Typography>\n      </Box>\n      {(info || parser) && <div className={classes.info}>\n        {info}\n      </div>}\n      <div className={classes.tags}>\n        {parser && <Chip size=\"small\" label={parser.replace('archive', 'nomad')} color=\"default\" />}\n      </div>\n      {entry_id && (\n        <React.Fragment>\n          <Box flexGrow={1} />\n          <Tooltip title=\"Go to the entry page\">\n            <EntryButton entryId={entry_id} component={IconButton} size=\"small\">\n              <NavigateIcon />\n            </EntryButton>\n          </Tooltip>\n        </React.Fragment>\n      )}\n    </div>\n    <Collapse in={open} className={classes.children}>\n      {children || 'loading ...'}\n    </Collapse>\n  </div>\n}\n\nFileOrFolder.propTypes = {\n  onToggle: PropTypes.func,\n  open: PropTypes.bool,\n  hasChildren: PropTypes.bool,\n  children: PropTypes.arrayOf(PropTypes.object),\n  name: PropTypes.string,\n  path: PropTypes.string,\n  entry_id: PropTypes.string,\n  parser: PropTypes.string,\n  info: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.node),\n    PropTypes.node\n  ])\n}\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    padding: theme.spacing(2),\n    position: 'relative'\n  },\n  disabled: {\n    position: 'absolute',\n    left: 0,\n    right: 0,\n    top: 0,\n    bottom: 0,\n    borderRadius: 4,\n    background: 'rgba(200, 200, 200, 0.5)',\n    zIndex: 10\n  },\n  disabledProgress: {\n    position: 'absolute',\n    margin: 0,\n    top: '50%',\n    left: '50%',\n    transform: 'translate(-50%, -50%)'\n  }\n}))\n\nexport default function FilesBrower({uploadId, disabled}) {\n  const classes = useStyles()\n  const {api} = useApi()\n  const errors = useErrors()\n  const [renderCounter, setRenderCounter] = useState(-1)\n  const [previewPath, setPreviewPath] = useState(null)\n  const allData = useRef({})\n\n  const fetchData = useMemo(() => (path, open) => {\n    async function fetchData() {\n      const encodedPath = path.split('/').map(segment => encodeURIComponent(segment)).join('/')\n      const results = await api.get(`/uploads/${uploadId}/rawdir/${encodedPath}?page_size=500&include_entry_info=true`)\n      allData.current[path] = {\n        open: open,\n        ...results\n      }\n      const resultsByPath = {}\n      results.directory_metadata.content\n        .filter(item => item.is_file)\n        .forEach(item => {\n          resultsByPath[`${path}/${item.name}`] = item\n          if (item.parser_name) {\n            item.parser = item.parser_name.replace('parsers/', '').replace('parser/', '')\n          }\n        })\n      setRenderCounter(renderCounter => renderCounter + 1)\n    }\n    if (!disabled) {\n      fetchData().catch(errors.raiseError)\n    }\n  }, [uploadId, api, errors, setRenderCounter, disabled])\n\n  useEffect(() => {\n    if (!disabled) {\n      fetchData('')\n    }\n  }, [fetchData, disabled])\n\n  const handleToggle = (path) => {\n    const folderData = allData.current[path]\n    if (folderData) {\n      // TODO this can be avoided, if this component gets notified about possible file\n      // changes behind\n      // the api.\n      if (!folderData.open) {\n        fetchData(path, true)\n      }\n      folderData.open = !folderData.open\n      setRenderCounter(renderCounter + 1)\n    } else {\n      fetchData(path, true)\n    }\n  }\n\n  function renderFileOrFolder(path, item) {\n    const {is_file} = item\n    const data = allData.current[path]\n    const pathPrefix = path ? `${path}/` : ''\n    const mapContent = item => renderFileOrFolder(`${pathPrefix}${item.name}`, item)\n    const props = {\n      key: path,\n      path: path,\n      uploadId: uploadId,\n      hasChildren: !is_file,\n      open: data?.open,\n      children: data?.directory_metadata?.content?.map(mapContent),\n      onToggle: is_file ? null : () => handleToggle(path),\n      // TODO\n      // info: !is_file && data?.content?.length === 0 && <Typography variant=\"caption\">\n      //   {'empty directory'}\n      // </Typography>,\n      ...item\n    }\n\n    return <FileOrFolder {...props} />\n  }\n\n  const root = allData.current['']\n\n  return <Paper className={classes.root} elevation={disabled ? 0 : undefined}>\n    {disabled && <div className={classes.disabled} />}\n    {disabled && <div className={classes.disabledProgress}><CircularProgress color=\"inherit\" /></div>}\n    {root && renderFileOrFolder('', root)}\n    {previewPath && <FilePreview uploadId={uploadId} path={previewPath} onClose={() => setPreviewPath(null)} />}\n  </Paper>\n}\n\nFilesBrower.propTypes = {\n  uploadId: PropTypes.string.isRequired,\n  disabled: PropTypes.bool\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, {useMemo, useState} from 'react'\nimport PropTypes from 'prop-types'\nimport { Paper, Link } from '@material-ui/core'\nimport EntryDetails, { EntryRowActions } from '../entry/EntryDetails'\nimport {\n  addColumnDefaults,\n  Datatable, DatatablePagePagination, DatatableTable,\n  DatatableToolbar, DatatableToolbarActions } from '../datatable/Datatable'\nimport EntryDownloadButton from '../entry/EntryDownloadButton'\nimport DeleteEntriesButton from './DeleteEntriesButton'\nimport Quantity from '../Quantity'\nimport EditMetaDataDialog from './EditMetaDataDialog'\nimport {authorList, formatTimestamp, pluralize} from '../../utils'\nimport { useUploadPageContext } from './UploadPageContext'\nimport { defaultFilterData } from '../search/FilterRegistry'\n\nconst columns = [\n  {\n    key: 'entry_name',\n    label: 'Name',\n    align: 'left',\n    sortable: false,\n    render: entry => <Quantity quantity={'entry_name'} noWrap noLabel placeholder=\"unnamed\" data={entry} />\n  },\n  {key: 'entry_type', align: 'left', sortable: false, label: 'Type'},\n  {\n    key: 'mainfile',\n    align: 'left',\n    render: entry => <Quantity quantity={'mainfile'} noLabel noWrap withClipboard data={entry}/>\n  },\n  {\n    key: 'entry_id',\n    align: 'left',\n    sortable: false,\n    render: entry => <Quantity quantity={'entry_id'} noLabel noWrap withClipboard data={entry}/>\n  },\n  {key: 'parser_name', align: 'left'},\n  {key: 'authors', align: 'left', render: row => authorList(row)},\n  {key: 'process_status', align: 'left'},\n  {\n    label: 'Modified',\n    key: 'complete_time',\n    align: 'left',\n    sortable: false,\n    render: entry => formatTimestamp(entry.complete_time)\n  },\n  {key: 'comment', sortable: false, align: 'left'},\n  {\n    key: 'references',\n    sortable: false,\n    align: 'left',\n    render: row => {\n      const refs = row.references || []\n      if (refs.length > 0) {\n        return (\n          <div style={{display: 'inline'}}>\n            {refs.map((ref, i) => <span key={ref}>\n              <Link href={ref}>{ref}</Link>{(i + 1) < refs.length ? ', ' : <React.Fragment/>}\n            </span>)}\n          </div>\n        )\n      } else {\n        return <i>no references</i>\n      }\n    }\n  },\n  {\n    key: 'datasets',\n    align: 'left',\n    sortable: false,\n    render: entry => {\n      const datasets = entry.datasets || []\n      if (datasets.length > 0) {\n        return datasets.map(dataset => dataset.dataset_name).join(', ')\n      } else {\n        return <i>no datasets</i>\n      }\n    }\n  }\n]\n\naddColumnDefaults(columns, defaultFilterData)\n\nconst defaultSelectedColumns = [\n  'entry_name',\n  'entry_type',\n  'mainfile',\n  'process_status'\n]\n\nexport default function ProcessingTable(props) {\n  const [selected, setSelected] = useState(new Set())\n  const {pagination, customTitle} = props\n  const {upload, isEditable} = useUploadPageContext()\n\n  const selectedQuery = useMemo(() => {\n    if (selected === 'all') {\n      return {'upload_id': upload.upload_id}\n    }\n\n    return {entry_id: [...selected]}\n  }, [selected, upload])\n\n  return <Paper data-testid={'processing-table'}>\n    <Datatable\n      columns={columns} shownColumns={defaultSelectedColumns} {...props}\n      selected={selected} getId={option => option.entry_id} onSelectedChanged={setSelected}\n    >\n      <DatatableToolbar title={pluralize((customTitle || 'search result'), pagination.total, true)}>\n        <DatatableToolbarActions selection>\n          <EntryDownloadButton tooltip=\"Download files\" query={selectedQuery} />\n          {isEditable &&\n            <EditMetaDataDialog\n              isIcon\n              selectedEntries={selectedQuery}\n            />}\n          {isEditable &&\n            <DeleteEntriesButton\n              isIcon\n              selectedEntries={selectedQuery}\n              selectedCount={selected === 'all' ? pagination.total : selected?.size}\n              setSelected={setSelected}\n            />}\n        </DatatableToolbarActions>\n      </DatatableToolbar>\n      <DatatableTable actions={EntryRowActions} details={EntryDetails}>\n        <DatatablePagePagination pageSizeValues={[5, 10, 50, 100]} />\n      </DatatableTable>\n    </Datatable>\n  </Paper>\n}\nProcessingTable.propTypes = {\n  data: PropTypes.arrayOf(PropTypes.object).isRequired,\n  pagination: PropTypes.object.isRequired,\n  onPaginationChanged: PropTypes.func.isRequired,\n  customTitle: PropTypes.string\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useCallback, useEffect, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { makeStyles, Typography, Button, TextField } from '@material-ui/core'\nimport EditIcon from '@material-ui/icons/Edit'\nimport WithButton from '../utils/WithButton'\n\n/**\n * Displays the upload name and controls for updating it.\n */\nconst useStyles = makeStyles(theme => ({\n  row: {\n    display: 'flex',\n    alignItems: 'center',\n    '& :not(:first-child)': {\n      marginLeft: theme.spacing(2)\n    }\n  }\n}))\n\nexport const UploadName = React.memo(({upload_name, onChange}) => {\n  const [edit, setEdit] = useState(false)\n  const [value, setValue] = useState()\n  const styles = useStyles()\n\n  // Any changes to the upload name through the prop override the shown value.\n  useEffect(() => {\n    setValue(upload_name)\n  }, [upload_name])\n\n  // The upload name is trimmed, and an untouched input field is considered as\n  // an empty string. Currently the only way to unset upload name is to post an\n  // empty string, posting 'undefined' gives an error.\n  const handleSave = useCallback(() => {\n    setEdit(false)\n    const trimmedValue = value?.trim() || ''\n    onChange && onChange(trimmedValue)\n    setValue(trimmedValue)\n  }, [onChange, value])\n\n  const handleEdit = useCallback(() => {\n    setEdit(true)\n  }, [])\n\n  const handleChange = useCallback((event) => {\n    setValue(event.target.value)\n  }, [])\n\n  return edit\n    ? <div className={styles.row}>\n        <TextField value={value || \"\"} onChange={handleChange} fullWidth/>\n        <Button size=\"small\" variant=\"contained\" onClick={handleSave}>save</Button>\n      </div>\n    : <WithButton size=\"small\" icon={<EditIcon/>} onClick={handleEdit}>\n        <Typography variant=\"h6\">\n          {value || <i>unnamed upload</i>}\n        </Typography>\n      </WithButton>\n})\nUploadName.propTypes = {\n  upload_name: PropTypes.string,\n  onChange: PropTypes.func\n}\n\nexport default UploadName\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isEmpty } from 'lodash'\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { Divider } from '@material-ui/core'\nimport { MenuBarItem, MenuBarList, MenuBarMenu } from './MenuBar'\n\nconst MenuBarRoute = React.memo(({\n  menu,\n  label,\n  initialFilters,\n  children\n}) => {\n    let filters = initialFilters && Object.entries(initialFilters).length > 0 && Object.entries(initialFilters).map(x => x.join('=')).join('&')\n    filters = filters ? `?${filters}` : ''\n    if (!menu.menu) return null\n    // Gather all categories for the items in this menu\n    const categories = {}\n    menu.routes\n      .filter(item => item.category)\n      .forEach(item => {\n        if (!categories[item.category]) categories[item.category] = []\n        categories[item.category].push(item)\n      })\n\n    // Items without a category are laid out linearly\n    let content\n    if (isEmpty(categories)) {\n      content = menu.routes.filter(route => route.menu).map((itemRoute, i) => (\n        <MenuBarItem\n          key={i} label={itemRoute.menu} tooltip={itemRoute.tooltip}\n          route={itemRoute.path && `/${menu.path}/${itemRoute.path}${filters}`}\n          href={itemRoute.href}\n        />\n      ))\n    // Categorized items are laid out in columns\n    } else {\n      content = Object.entries(categories).map(([category, values], index) => {\n          return <div key={category}>\n            {index ? <Divider style={{marginBottom: 8}}/> : null}\n            <MenuBarList header={category}>\n              {values.map(item => (\n                <MenuBarItem\n                  key={item.path} label={item.menu} tooltip={item.tooltip}\n                  route={item.path && `/${menu.path}/${item.path}${filters}`}\n                  href={item.href}\n                />\n              ))}\n            </MenuBarList>\n          </div>\n        })\n    }\n\n  return <MenuBarMenu key={menu.path} label={label} route={'/' + menu.path} icon={children}>\n        {content}\n      </MenuBarMenu>\n})\n\nMenuBarRoute.propTypes = {\n  menu: PropTypes.object.isRequired,\n  label: PropTypes.string.isRequired,\n  // The 'initialFilters' property is optional and should be a object representing\n  // the initial set of filters for the menu. For ex, it could be set to '{upload_id:abc}'\n  // to preselect items based on the 'upload_id' parameter with the value 'abc'\n  initialFilters: PropTypes.object,\n  children: PropTypes.node\n}\n\nexport default MenuBarRoute\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { routes } from '../nav/Routes'\nimport MenuBarRoute from '../nav/MenuBarRoute'\nimport SearchIcon from '@material-ui/icons/Search'\n\nconst UploadSearchMenu = React.memo(({\n  uploadId\n}) => {\n  const filteredMenus = routes.filter((menu) => menu.menu === 'Explore')\n  if (filteredMenus.length !== 1) {\n    return null\n  }\n  const menu = filteredMenus[0]\n    return (\n      <MenuBarRoute menu={menu} label={'Search in this upload'} initialFilters={{upload_id: uploadId}}>\n        <SearchIcon/>\n      </MenuBarRoute>\n    )\n})\n\nUploadSearchMenu.propTypes = {\n  uploadId: PropTypes.string.isRequired\n}\n\nexport default UploadSearchMenu\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  Accordion, AccordionDetails, AccordionSummary, Box, Button, Checkbox, Dialog,\n  DialogContent, DialogTitle, FormControl, FormHelperText, Grid, IconButton, Input,\n  InputLabel, Link, makeStyles, MenuItem, Select, Step, StepContent, StepLabel, Stepper,\n  Tooltip, Typography\n} from '@material-ui/core'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport DialogContentText from '@material-ui/core/DialogContentText'\nimport FormControlLabel from '@material-ui/core/FormControlLabel'\nimport ReprocessIcon from '@material-ui/icons/Autorenew'\nimport DownloadIcon from '@material-ui/icons/CloudDownload'\nimport UploadIcon from '@material-ui/icons/CloudUpload'\nimport ExpandMoreIcon from '@material-ui/icons/ExpandMore'\nimport MembersIcon from '@material-ui/icons/Group'\nimport ReloadIcon from '@material-ui/icons/Replay'\nimport PropTypes from 'prop-types'\nimport React, { useCallback, useEffect, useState } from 'react'\nimport { useDropzone } from 'react-dropzone'\nimport { appBase, oasis } from '../../config'\nimport { formatTimestamp } from '../../utils'\nimport { CodeList } from '../About'\nimport { useDataStore } from \"../DataStore\"\nimport Markdown from '../Markdown'\nimport Page from '../Page'\nimport { useApi } from '../api'\nimport { SourceApiCall, SourceApiDialogButton } from '../buttons/SourceDialogButton'\nimport { combinePagination } from '../datatable/Datatable'\nimport Download from '../entry/Download'\nimport { useErrors } from '../errors'\nimport DialogLink from '../utils/DialogLink'\nimport WithButton from '../utils/WithButton'\nimport CreateEntry from './CreateEntry'\nimport DeleteUploadsButton from './DeleteUploadsButton'\nimport EditMembersDialog from './EditMembersDialog'\nimport EditMetaDataDialog from './EditMetaDataDialog'\nimport FilesBrower from './FilesBrowser'\nimport ProcessingTable from './ProcessingTable'\nimport UploadName from './UploadName'\nimport { useUploadPageContext } from './UploadPageContext'\nimport UploadProgressDialog from './UploadProgressDialog'\nimport UploadSearchMenu from './UploadSearchMenu'\nimport UploadStatusIcon from './UploadStatusIcon'\n\nconst useDropButtonStyles = makeStyles(theme => ({\n  dropzone: {\n    width: '100%'\n  },\n  dropzoneAccept: {\n    '& button': {\n      background: theme.palette.secondary.main,\n      color: theme.palette.common.white\n    }\n  },\n  dropzoneReject: {\n    '& button': {\n      background: theme.palette.error.main,\n      color: theme.palette.common.white\n    }\n  }\n}))\n\nfunction DropButton({onDrop, ...buttonProps}) {\n  const classes = useDropButtonStyles()\n  const {getRootProps, getInputProps, isDragAccept, isDragReject} = useDropzone({onDrop})\n  const className = (isDragAccept && classes.dropzoneAccept) || (isDragReject && classes.dropzoneReject) || classes.dropzone\n  return (\n    <div className={className}>\n      <div {...getRootProps()}>\n        <input {...getInputProps()} />\n        <Button\n          variant=\"contained\"\n          color=\"primary\"\n          startIcon={<UploadIcon/>}\n          {...buttonProps}\n        >\n          Drop files here or click to open dialog\n        </Button>\n      </div>\n    </div>\n  )\n}\nDropButton.propTypes = {\n  onDrop: PropTypes.func\n}\n\nfunction EmbargoSelect({embargo, onChange, disabledReason}) {\n  return <FormControl style={{width: '100%'}}>\n    <InputLabel shrink htmlFor=\"embargo-label-placeholder\">\n      Embargo period\n    </InputLabel>\n    <Select\n      value={embargo}\n      onChange={event => onChange(event.target.value)}\n      input={<Input name=\"embargo\" id=\"embargo-label-placeholder\"/>}\n      displayEmpty\n      name=\"embargo\"\n      disabled={!!disabledReason}\n    >\n      <MenuItem value={0}>\n        <em>No embargo</em>\n      </MenuItem>\n      <MenuItem value={3}>3</MenuItem>\n      <MenuItem value={6}>6</MenuItem>\n      <MenuItem value={12}>12</MenuItem>\n      <MenuItem value={24}>24</MenuItem>\n      <MenuItem value={36}>36</MenuItem>\n    </Select>\n    <FormHelperText>\n      {disabledReason ||\n        (embargo > 0 ? 'months before the data becomes public' : 'publish without embargo')}\n    </FormHelperText>\n  </FormControl>\n}\n\nEmbargoSelect.propTypes = {\n  embargo: PropTypes.number,\n  onChange: PropTypes.func,\n  disabledReason: PropTypes.string\n}\n\nfunction PublishUpload({upload, onPublish, isVisibleForAll}) {\n  const [embargo, setEmbargo] = useState(upload.embargo_length === undefined ? 0 : upload.embargo_length)\n  const [openConfirmDialog, setOpenConfirmDialog] = useState(false)\n  const handlePublish = () => {\n    setOpenConfirmDialog(false)\n    onPublish({embargo_length: embargo, to_central_nomad: false})\n  }\n\n  useEffect(() => {\n    if (isVisibleForAll) {\n      setEmbargo(0)\n    }\n  }, [isVisibleForAll])\n\n  if (upload.published) {\n    return <Markdown>{`\n      This upload has already been published.\n    `}</Markdown>\n  }\n\n  const buttonLabel = embargo > 0 ? 'Publish with embargo' : 'Publish'\n\n  return <React.Fragment>\n    <Dialog\n      open={openConfirmDialog}\n      onClose={() => setOpenConfirmDialog(false)}\n    >\n      <DialogTitle>Confirm that you want to publish the upload</DialogTitle>\n      <DialogContent>\n        <DialogContentText>\n          You are about the publish this upload. The upload cannot be removed and\n          the files and entries in this upload cannot be changed after publication.\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => setOpenConfirmDialog(false)} autoFocus>Cancel</Button>\n        <Button onClick={handlePublish}>{buttonLabel}</Button>\n      </DialogActions>\n    </Dialog>\n    <Markdown>{`\n      If you agree this upload will be published and move out of your private staging\n      area into the public NOMAD. This step is final. All public data will be made available under the Creative\n      Commons Attribution license ([CC BY 4.0](https://creativecommons.org/licenses/by/4.0/)).\n\n      If you wish, you can put an embargo on your data. This makes some metadata (e.g.\n      chemical formula, system type, spacegroup, etc.) public, but the raw-file\n      and archive contents remain hidden (except to you, and users you explicitly\n      share the data with).\n      You can already create datasets and assign DOIs for data with embargo, e.g.\n      to put it into your unpublished paper.\n      The embargo will last up to 36 month. Afterwards, your data will be made publicly\n      available. You can also lift the embargo sooner if you wish.\n    `}</Markdown>\n    <Box marginTop={2}>\n      <Grid container direction=\"row\" spacing={2}>\n        <Grid item style={{width: 300}}>\n          <EmbargoSelect\n            embargo={embargo}\n            onChange={setEmbargo}\n            disabledReason={isVisibleForAll ? 'Upload is publicly visible, embargo disabled' : null}\n          />\n        </Grid>\n        <Grid item>\n          <Box marginTop={2} >\n            <Button\n              style={{height: 32, minWith: 100}}\n              size=\"small\" variant=\"contained\"\n              onClick={() => setOpenConfirmDialog(true)} color=\"primary\"\n              disabled={upload.process_running}\n              data-testid='publish-upload-button'\n            >\n              {buttonLabel}\n            </Button>\n          </Box>\n        </Grid>\n      </Grid>\n    </Box>\n  </React.Fragment>\n}\nPublishUpload.propTypes = {\n  upload: PropTypes.object,\n  onPublish: PropTypes.func,\n  isVisibleForAll: PropTypes.bool\n}\n\nfunction PublishUploadExternally({upload, onPublish, isPublished, isVisibleForAll}) {\n  const [embargo, setEmbargo] = useState(upload.embargo_length === undefined ? 0 : upload.embargo_length)\n  const [openConfirmDialog, setOpenConfirmDialog] = useState(false)\n  const handlePublish = () => {\n    setOpenConfirmDialog(false)\n    onPublish({embargo_length: embargo, to_central_nomad: true})\n  }\n\n  useEffect(() => {\n    if (isVisibleForAll) {\n      setEmbargo(0)\n    }\n  }, [isVisibleForAll])\n\n  if (upload?.published_to?.find(server => server === 'https://nomad-lab.eu/prod/v1/api')) {\n    return <Markdown>{`\n      This upload has already been published to central NOMAD.\n    `}</Markdown>\n  }\n\n  const buttonLabel = 'Publish to Central NOMAD'\n\n  return <React.Fragment>\n    <Dialog\n      open={openConfirmDialog}\n      onClose={() => setOpenConfirmDialog(false)}\n    >\n      <DialogTitle>Confirm that you want to publish the upload to central NOMAD</DialogTitle>\n      <DialogContent>\n        <DialogContentText>\n          You are about to publish this upload to central NOMAD.\n        </DialogContentText>\n        <DialogContentText>\n          Please note that this upload will be published under the pre-configured account of this OASIS, which may or\n          may not be your current account.\n        </DialogContentText>\n        <DialogContentText>\n          The upload will be published to the central NOMAD with the chosen embargo period. Please check the central\n          NOMAD for the status of the upload.\n          If this upload is already published, this action has no effect.\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => setOpenConfirmDialog(false)} autoFocus>Cancel</Button>\n        <Button onClick={handlePublish}>{buttonLabel}</Button>\n      </DialogActions>\n    </Dialog>\n    <Typography>\n      After publishing locally on this OASIS. You can choose to publish this upload to the central NOMAD.\n    </Typography>\n    <Box marginTop={2}>\n      <Grid container direction=\"row\" spacing={2}>\n        <Grid item style={{width: 300}}>\n          <EmbargoSelect\n            embargo={embargo}\n            onChange={setEmbargo}\n            disabledReason={isVisibleForAll ? 'Upload is publicly visible, embargo disabled' : null}\n          />\n        </Grid>\n        <Grid item>\n          <Box marginTop={2}>\n            <Button\n              style={{height: 32, minWith: 100}}\n              size=\"small\" variant=\"contained\"\n              onClick={() => setOpenConfirmDialog(true)} color=\"primary\"\n              disabled={!isPublished}\n              data-testid='publish-upload-externally-button'\n            >\n              {buttonLabel}\n            </Button>\n          </Box>\n        </Grid>\n      </Grid>\n    </Box>\n  </React.Fragment>\n}\n\nPublishUploadExternally.propTypes = {\n  upload: PropTypes.object,\n  onPublish: PropTypes.func,\n  isPublished: PropTypes.bool,\n  isVisibleForAll: PropTypes.bool\n}\n\nfunction ProcessingStatus({data}) {\n  const {pagination, upload, processing_successful, processing_failed} = data\n  let mainMessage = null\n  if (upload.process_running) {\n    mainMessage = 'Processing ...'\n  } else {\n    if (upload.process_status === 'SUCCESS') {\n      mainMessage = 'Processing completed'\n    } else if (upload.process_status === 'FAILURE') {\n      mainMessage = 'Processing failed ' + upload.errors.join(', ')\n    } else {\n      mainMessage = 'Waiting for processing ...'\n    }\n  }\n  return <Box marginTop={1} marginBottom={2}>\n    <Typography>\n      {mainMessage}, {processing_successful}/{pagination?.total} entries processed{(processing_failed > 0) && `, ${processing_failed} failed`}\n    </Typography>\n  </Box>\n}\nProcessingStatus.propTypes = {\n  data: PropTypes.object\n}\n\nconst useStyles = makeStyles(theme => ({\n  stepper: {\n    backgroundColor: 'inherit',\n    paddingLeft: 0,\n    paddingRight: 0\n  },\n  stepContent: {\n    marginBottom: theme.spacing(2)\n  },\n  mixedButtonIcon: {\n    fontSize: '150%',\n    marginRight: theme.spacing(1)\n  }\n}))\n\nexport function SupportedCodes({children}) {\n  return <DialogLink title=\"Supported codes\" text={children}>\n    <Typography>\n      For the following codes, we support automatic parsing of data into\n      entries: <CodeList withUploadInstructions />. Click the code to get more\n      specific information about how to prepare your files.\n    </Typography>\n  </DialogLink>\n}\nSupportedCodes.propTypes = {\n  children: PropTypes.node\n}\n\nexport function UploadDocumentation({children}) {\n  return <Link href={`${appBase}/docs/web.html#uploading-and-publishing-data`}>\n    {children}\n  </Link>\n}\nUploadDocumentation.propTypes = {\n  children: PropTypes.node\n}\n\nexport function SchemaDocumentation({children}) {\n  return <Link href={`${appBase}/docs/schema/basics.html`}>\n    {children}\n  </Link>\n}\nSchemaDocumentation.propTypes = {\n  children: PropTypes.node\n}\n\nfunction UploadOverview(props) {\n  const classes = useStyles()\n  const dataStore = useDataStore()\n  const {api, user} = useApi()\n  const {raiseError} = useErrors()\n  const {\n    uploadId, upload, entries, apiData, hasUpload, isProcessing, error, isVisibleForAll,\n    isWriter, pagination, deleteRequested, updateUpload, requestRefreshUpload, isMainAuthor} = useUploadPageContext()\n  const [uploading, setUploading] = useState(null)\n  const [openEmbargoConfirmDialog, setOpenEmbargoConfirmDialog] = useState(false)\n  const [readme, setReadme] = useState(null)\n  const [openEditMembersDialog, setOpenEditMembersDialog] = useState(false)\n\n  const handleIsVisibleForAll = useCallback((event) => {\n    const action = event.target.checked ? 'add' : 'remove'\n    api.post(`/uploads/${uploadId}/edit`, {metadata: {\n      'reviewer_groups': { [action]: 'all'}\n    }})\n    .then(requestRefreshUpload)\n    .catch(raiseError)\n  }, [api, requestRefreshUpload, raiseError, uploadId])\n\n  useEffect(() => {\n    if (uploading) return\n    dataStore.breadcrumb.setUpload(upload?.upload_name || 'Upload')\n    api.get(`/uploads/${uploadId}/raw/README.md`)\n      .then(setReadme)\n      .catch(error => {\n        setReadme(null)\n        if (error.name !== 'DoesNotExist') {\n          raiseError(error)\n        }\n      })\n  }, [api, raiseError, uploadId, uploading, setReadme, dataStore.breadcrumb, upload?.upload_name])\n\n  const handleDropFiles = useCallback(files => {\n    if (!files[0]?.name) {\n      return // Not dropping a file, but something else. Ignore.\n    }\n    const formData = new FormData() // eslint-disable-line no-undef\n    for (const file of files) {\n      formData.append('file', file)\n    }\n    setUploading(0)\n    api.put(`/uploads/${uploadId}/raw/`, formData, {\n      onUploadProgress: (progressEvent) => {\n        const percentCompleted = Math.round((progressEvent.loaded * 100) / progressEvent.total)\n        setUploading(percentCompleted)\n      }\n    })\n      .then(results => updateUpload({upload: results.data}))\n      .catch(raiseError)\n      .finally(() => {\n        setUploading(null)\n      })\n  }, [uploadId, updateUpload, setUploading, api, raiseError])\n\n  const handleNameChange = (upload_name) => {\n    api.post(`/uploads/${uploadId}/edit`, {metadata: {upload_name: upload_name}})\n      .then(() => requestRefreshUpload())\n      .catch(raiseError)\n  }\n\n  const handlePublish = ({embargo_length, to_central_nomad}) => {\n    api.post(`/uploads/${uploadId}/action/publish?embargo_length=${embargo_length}&to_central_nomad=${to_central_nomad}`)\n      .then(results => updateUpload({upload: results.data}))\n      .catch(raiseError)\n  }\n\n  const handleLiftEmbargo = () => {\n    setOpenEmbargoConfirmDialog(false)\n    api.post(`/uploads/${uploadId}/edit`, {metadata: {embargo_length: 0}})\n      .then(() => requestRefreshUpload())\n      .catch(raiseError)\n  }\n\n  const handleReload = () => {\n    requestRefreshUpload()\n  }\n\n  const handleReprocess = () => {\n    api.post(`/uploads/${uploadId}/action/process`)\n      .then(results => updateUpload({upload: results.data}))\n      .catch(raiseError)\n  }\n\n  const handleDelete = () => {\n    api.delete(`/uploads/${uploadId}`)\n      .then(results => updateUpload({upload: results.data}))\n      .catch(raiseError)\n  }\n\n  if (!hasUpload || !entries) {\n    return <Page limitedWidth>\n      {(error ? <Typography>{error.apiMessage || error.message || 'Failed to load'}</Typography> : <Typography>loading ...</Typography>)}\n    </Page>\n  }\n\n  const isAuthenticated = api.keycloak.authenticated\n  const isPublished = upload.published\n  const isEmpty = upload.entries === 0\n\n  return (\n    <Page limitedWidth>\n      <UploadProgressDialog uploading={uploading} />\n      <Grid container spacing={2} alignItems=\"center\">\n        <Grid item>\n          <UploadStatusIcon data={upload} user={user} fontSize=\"large\" />\n        </Grid>\n        <Grid item style={{flexGrow: 1}}>\n          <UploadName upload_name={upload?.upload_name} onChange={handleNameChange} />\n          <WithButton clipboard={uploadId}>\n            <Typography>upload id: {uploadId}</Typography>\n          </WithButton>\n        </Grid>\n        <Grid item>\n          <Box display={'flex'}>\n            <UploadSearchMenu uploadId={uploadId}/>\n            <IconButton\n              onClick={() => setOpenEditMembersDialog(true)}\n              disabled={!isWriter || isProcessing}\n              data-testid='edit-members-action'\n            >\n              <Tooltip title=\"Edit upload members\">\n                <MembersIcon/>\n              </Tooltip>\n            </IconButton>\n            <EditMembersDialog open={openEditMembersDialog} setOpen={setOpenEditMembersDialog} />\n            <Download\n              component={IconButton} tooltip=\"Download files\"\n              url={`uploads/${uploadId}/raw/?compress=true`}\n              data-testid='upload-download-action'\n            >\n              <DownloadIcon />\n            </Download>\n            <IconButton onClick={handleReload}>\n              <Tooltip title=\"Reload\">\n                <ReloadIcon />\n              </Tooltip>\n            </IconButton>\n            <IconButton disabled={isPublished || !isWriter} onClick={handleReprocess} data-testid='upload-reprocess-action'>\n              <Tooltip title=\"Reprocess\">\n                <ReprocessIcon />\n              </Tooltip>\n            </IconButton>\n            <SourceApiDialogButton maxWidth=\"lg\" fullWidth>\n              <SourceApiCall {...apiData} />\n            </SourceApiDialogButton>\n            <DeleteUploadsButton\n              tooltip=\"Delete upload\"\n              disabled={isPublished || !isMainAuthor}\n              data-testid='upload-delete-action'\n              uploads={[upload]}\n              onConfirm={handleDelete}\n            />\n          </Box>\n        </Grid>\n      </Grid>\n      {readme && (\n        <Box marginLeft={4} marginTop={2} marginBottom={0} marginRight={1}>\n          <Accordion defaultExpanded>\n            <AccordionSummary expandIcon={<ExpandMoreIcon />}>\n              README.md\n            </AccordionSummary>\n            <AccordionDetails>\n              <Markdown>{readme}</Markdown>\n            </AccordionDetails>\n          </Accordion>\n        </Box>\n      )}\n      <Stepper classes={{root: classes.stepper}} orientation=\"vertical\" >\n        <Step expanded active={false}>\n          <StepLabel>Prepare and upload your files</StepLabel>\n          <StepContent>\n            {isPublished && <Typography className={classes.stepContent}>\n              This upload is published and it&apos;s files can&apos;t be modified anymore.\n            </Typography>}\n            {!isPublished && isAuthenticated && isWriter && (\n              <React.Fragment>\n                <Typography className={classes.stepContent}>\n                  Here you can upload files. Top-level .zip/.tar files will be uncompressed automatically. For more information,\n                  see our documentation on <UploadDocumentation>uploading\n                  files</UploadDocumentation> or view the <SupportedCodes>supported codes</SupportedCodes>.\n                  Optionally, you can also create an entry from built-in or\n                  uploaded schemas. Please take a look at our documentation on <SchemaDocumentation>schemas</SchemaDocumentation>.\n                </Typography>\n                <Box display=\"flex\" flexDirection=\"row\">\n                  <Box flexGrow={1}>\n                    <DropButton\n                      className={classes.stepContent}\n                      size=\"large\"\n                      fullWidth onDrop={handleDropFiles}\n                      disabled={isProcessing}\n                    />\n                  </Box>\n                  <Box marginLeft={2}>\n                    <CreateEntry\n                      size=\"large\"\n                      disabled={isProcessing}\n                      variant=\"contained\"\n                      color=\"default\"\n                    >\n                      Create from schema\n                    </CreateEntry>\n                  </Box>\n                </Box>\n              </React.Fragment>\n            )}\n            <div className={classes.stepContent}>\n              <FilesBrower uploadId={uploadId} disabled={isProcessing || deleteRequested} />\n            </div>\n          </StepContent>\n        </Step>\n        <Step expanded={!isEmpty} active={false}>\n          <StepLabel>Process data</StepLabel>\n          <StepContent>\n            <ProcessingStatus data={apiData.response} />\n            <ProcessingTable\n              data={entries.map(entry => ({...entry.entry_metadata, ...entry}))}\n              pagination={combinePagination(pagination, apiData.response?.pagination)}\n              customTitle='entry'\n              onPaginationChanged={newPagination => updateUpload({pagination: newPagination})}/>\n          </StepContent>\n        </Step>\n        {(isAuthenticated && isWriter) && <Step expanded active={false}>\n          <StepLabel>Edit visibility and access</StepLabel>\n          <StepContent>\n            <FormControlLabel\n              data-testid='upload-visible-for-all-label'\n              label=\"Enabling this will allow all users, including guests without an account, to view the upload even before it is published.\"\n              control={\n                <Checkbox\n                  checked={isVisibleForAll}\n                  disabled={upload.with_embargo || isProcessing}\n                  onChange={handleIsVisibleForAll}\n                />\n              }\n            />\n            <Typography className={classes.stepContent}>\n              You can edit the access to the upload by adding or removing users as upload members.\n            </Typography>\n            <Button\n              onClick={() => setOpenEditMembersDialog(true)}\n              variant='contained'\n              color='primary'\n              disabled={isProcessing}\n            >\n              <MembersIcon className={classes.mixedButtonIcon}/> Edit upload members\n            </Button>\n          </StepContent>\n        </Step>}\n        {(isAuthenticated && isWriter) && <Step expanded={!isEmpty} active={false}>\n          <StepLabel>Edit metadata</StepLabel>\n          <StepContent>\n            <Typography className={classes.stepContent}>\n              You can add more information about your data, like <i>comments</i>,\n              <i>references</i> (e.g. links to publications). You can also create\n              <i>datasets</i> from your entries.\n            </Typography>\n            <Typography className={classes.stepContent}>\n              You can either select and edit individual entries from the list above, or\n              edit all entries at once.\n            </Typography>\n            {!isEmpty && <EditMetaDataDialog selectedEntries={{'upload_id': upload.upload_id}}/>}\n          </StepContent>\n        </Step>}\n        {(isAuthenticated && isWriter) && <Step expanded={!isEmpty} active={false}>\n          <StepLabel>Publish</StepLabel>\n          <StepContent>\n            {isPublished && <Typography className={classes.stepContent}>\n              {upload?.with_embargo ? `This upload has been published under embargo with a period of ${upload?.embargo_length} months from ${formatTimestamp(upload?.publish_time)}.`\n                : `This upload has already been published.`}\n            </Typography>}\n            {!isPublished && <PublishUpload\n              upload={upload} onPublish={handlePublish} isVisibleForAll={isVisibleForAll}\n            />}\n            {isPublished && upload?.with_embargo && upload?.embargo_length > 0 &&\n              <Button onClick={() => setOpenEmbargoConfirmDialog(true)} variant='contained' color='primary' disabled={isProcessing}>\n                Lift Embargo\n              </Button>}\n            <Dialog\n              open={openEmbargoConfirmDialog}\n              aria-describedby=\"alert-dialog-description\"\n            >\n              <DialogContent>\n                <DialogContentText id=\"alert-dialog-description\">\n                  You are about lifting the embargo. The data will be publicly accessible.\n                </DialogContentText>\n              </DialogContent>\n              <DialogActions>\n                <Button onClick={() => setOpenEmbargoConfirmDialog(false)} autoFocus>Cancel</Button>\n                <Button onClick={handleLiftEmbargo}>Lift Embargo</Button>\n              </DialogActions>\n            </Dialog>\n          </StepContent>\n        </Step>}\n        {(isAuthenticated && isWriter && oasis) && <Step expanded={!isEmpty} active={false}>\n          <StepLabel>Publish to central NOMAD</StepLabel>\n          <StepContent>\n            <PublishUploadExternally\n              upload={upload}\n              onPublish={handlePublish}\n              isPublished={isPublished}\n              isVisibleForAll={isVisibleForAll}\n            />\n          </StepContent>\n        </Step>}\n      </Stepper>\n    </Page>\n  )\n}\n\nexport default UploadOverview\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useCallback, useEffect, useState, useMemo, useContext, useRef} from 'react'\nimport PropTypes from 'prop-types'\nimport Markdown from '../Markdown'\nimport {\n  Paper, IconButton, Tooltip, Typography,\n  Box, Divider, makeStyles\n} from '@material-ui/core'\nimport ClipboardIcon from '@material-ui/icons/Assignment'\nimport { HelpButton } from '../Help'\nimport { CopyToClipboard } from 'react-copy-to-clipboard'\nimport { guiBase, servicesUploadLimit } from '../../config'\nimport NewUploadButton from './NewUploadButton'\nimport ExampleUploadButton from './ExampleUploadButton'\nimport { useApi, withLoginRequired } from '../api'\nimport Page from '../Page'\nimport { useErrors } from '../errors'\nimport DetailsIcon from '@material-ui/icons/ArrowForward'\nimport { UploadButton } from '../nav/Routes'\nimport {\n  addColumnDefaults, combinePagination, Datatable, DatatablePagePagination,\n  DatatableTable, DatatableToolbar, DatatableToolbarActions\n} from '../datatable/Datatable'\nimport TooltipButton from '../utils/TooltipButton'\nimport ReloadIcon from '@material-ui/icons/Replay'\nimport Quantity from '../Quantity'\nimport { SourceApiCall, SourceApiDialogButton } from '../buttons/SourceDialogButton'\nimport { useHistory } from 'react-router-dom'\nimport DeleteUploadsButton from './DeleteUploadsButton'\nimport UploadStatusIcon from './UploadStatusIcon'\nimport { formatTimestamp } from '../../utils'\nimport { SupportedCodes, UploadDocumentation } from './UploadOverview'\nimport { defaultFilterData } from '../search/FilterRegistry'\n\nexport const help = `\nNOMAD allows you to upload data. After upload, NOMAD will process your data: it will\nidentify parseable files (*mainfiles*) and parse these.\nThe result will be a list of entries (one per identified mainfile).\nEach entry is associated with metadata. This is data that NOMAD acquired from your files and that\ndescribe your entry (e.g. chemical formula, used code, system type and symmetry, etc.).\nFurthermore, you can provide your own metadata (comments, references, co-authors, etc.).\nWhen an upload is created, it is created in the *staging area*, and it will only be visible\nto you (the main author). You can add other users as *co-authors*. They will be listed\nas co-authors of the upload and all its entries, and they can view and edit the upload.\nYou can also add *reviewers*, which are users who are allowed the view the upload. No\nother users can see your data until you *publish* the upload.\n\n#### Prepare and upload files\n\nWhile the upload is in the staging area, you and the co-authors can add and remove files\nto it. You can upload plain files, or \\`*.zip\\` or \\`*.tar.gz\\` archives. We encourage you\nto add all input and output files, as well as any other auxiliary files that you might\nhave created, and to organize your files in a folder structure. Ideally, you should have a\nseparate directory for each entry, as NOMAD considers all files located in a directory where\nthere is a mainfile to be auxiliary files to this entry. If users want to download an entry,\nthey can download all files in the directory where the entry's mainfile is located. The\ndirectory structure can be nested.\n\nDrop your archive file(s) on the dropbox. You can also click the dropbox to select a file from\nyour hard drive. Alternatively, you can upload files via the given shell command.\nReplace \\`<local_file>\\` with your archive file. After executing the command,\nreturn here and press the reload button below).\n\n### Limits\n\nThere is a limit of 10 unpublished uploads per user. Please accumulate all data into as\nfew uploads as possible. But, there is a also an upper limit of 32 GB per upload.\nPlease upload multiple archives, if you have more than 32 GB of data to upload.\nOnly uploads with at least one recognized entry can be published.\n\n#### The uploads page\n\nHere you will find all your unpublished and published uploads. You can see the\nprogress on the processing, you can review your uploads, and publish or delete them.\n\nClick on an upload to see more details about its contents. Click on processed entries\nto see their metadata, archive data, and a processing log. In the details view, you also\nfind buttons for editing user metadata, deleting uploads, and publishing uploads. Entries\ncannot be published individually, only the upload as a whole, with all its entries, can be published.\n\n#### Publishing and embargo\n\nWhen you publish, you can set an *embargo* or publish your data as *Open Access* right away.\nThe embargo allows you to share data with selected users, create a DOI for your data, etc,\nbefore the full upload data is made public. The embargo might last up to 36 months, and when\nit expires the data becomes public automatically. While embargoed, some metadata (and datasets\ncreated from this data) are publicly visible and findable, but only you and users you share\nthe upload with (i.e. users added as co-authors or reviewers) can view and download the raw\ndata and archive.\n\n#### Processing errors\n\nWe distinguish between uploads that fail processing completely and uploads that contain\nentries that could not be processed. The former might be caused by issues during the\nupload, bad file formats, etc. The latter (far more common) case means that not all of the\nidentified mainfiles could be parsed. The processing logs of the failed entries might\nprovide some insight.\n\nYou cannot publish uploads that failed processing completely. In most\ncases they wouldn't have any entries to publish anyway. In the case of failed processing of\nsome entries however, the data can still be published. You will be able to share it and create\nDOIs for it, etc. The only shortcomings will be missing metadata (labeled *not processed*\nor *unavailable*) and missing archive data. We continuously improve our parsers and\nthe now missing information might become available in the future automatically.\n\n#### Co-Authors, References, Comments, Datasets, DOIs\n\nYou can edit additional *user metadata*. Some of these fields are set on the upload level,\nothers on the entry level. You can select and edit many entries at once. Edit buttons for\nuser metadata are available in many views on this web-page. For example, you can edit user\nmetadata when you click on an upload to open its details, and press the edit button there.\nThe metadata fields cannot be changed after the upload has been published (except for dataset members).\nThe documentation on the [user data page](${guiBase}/userdata) contains more information.\n`\nexport const uploadsPageContext = React.createContext()\nexport function useUploadsPageContext() {\n  return useContext(uploadsPageContext)\n}\n\nconst useUploadCommandStyles = makeStyles(theme => ({\n  root: {\n    width: '100%'\n  },\n  commandContainer: {\n    display: 'flex',\n    flexDirection: 'row',\n    alignItems: 'center'\n  },\n  commandMarkup: {\n    flexGrow: 1,\n    marginRight: theme.spacing(1),\n    overflow: 'hidden'\n  }\n}))\n\nfunction UploadCommands({uploadCommands}) {\n  const classes = useUploadCommandStyles()\n\n  return <div className={classes.root}>\n    <div className={classes.commandContainer} role='upload-commands'>\n      <div className={classes.commandMarkup}>\n        <Markdown>{`\n          \\`\\`\\`\n            ${uploadCommands.upload_command}\n          \\`\\`\\`\n        `}</Markdown>\n      </div>\n      <CopyToClipboard text={uploadCommands.upload_command} onCopy={() => null}>\n        <Tooltip title=\"Copy command to clipboard\">\n          <IconButton>\n            <ClipboardIcon />\n          </IconButton>\n        </Tooltip>\n      </CopyToClipboard>\n      <Tooltip title=\"Alternative shell commands\">\n        <HelpButton maxWidth=\"md\" heading=\"Alternative shell commands\" content={`\n          As an experienced shell and *curl* user, you can modify the commands to\n          your liking.\n\n          The given command can be modified. To see progress on large files, use\n          \\`\\`\\`\n            ${uploadCommands.upload_progress_command}\n          \\`\\`\\`\n          To \\`tar\\` and upload multiple folders in one command, use\n          \\`\\`\\`\n          ${uploadCommands.upload_tar_command}\n          \\`\\`\\`\n\n          ### Form data vs. streaming\n          NOMAD accepts stream data (\\`-T <local_file>\\`) (like in the\n          examples above) or multi-part form data (\\`-X PUT -f file=@<local_file>\\`):\n          \\`\\`\\`\n          ${uploadCommands.upload_command_form}\n          \\`\\`\\`\n          We generally recommend to use streaming, because form data can produce very\n          large HTTP request on large files. Form data has the advantage of carrying\n          more information (e.g. the file name) to our servers (see below).\n\n          #### Upload names\n          With multi-part form data (\\`-X PUT -f file=@<local_file>\\`), your upload will\n          be named after the file by default. With stream data (\\`-T <local_file>\\`)\n          there will be no default name. To set a custom name, you can use the URL\n          parameter \\`name\\`:\n          \\`\\`\\`\n          ${uploadCommands.upload_command_with_name}\n          \\`\\`\\`\n          Make sure to user proper [URL encoding](https://www.w3schools.com/tags/ref_urlencode.asp)\n          and shell encoding, if your name contains spaces or other special characters.\n        `}/>\n      </Tooltip>\n    </div>\n  </div>\n}\n\nconst UploadActions = React.memo(function UploadActions({data}) {\n  return <Tooltip title=\"Open this upload\">\n    <UploadButton component={IconButton} uploadId={data.upload_id}>\n      <DetailsIcon />\n    </UploadButton>\n  </Tooltip>\n})\nUploadActions.propTypes = {\n  data: PropTypes.object.isRequired\n}\n\nUploadCommands.propTypes = {\n  uploadCommands: PropTypes.object.isRequired\n}\n\nexport function UploadsPage() {\n  const {api, user} = useApi()\n  const errors = useErrors()\n  const [apiData, setApiData] = useState(null)\n  const data = useMemo(() => apiData?.response, [apiData])\n  const [unpublished, setUnpublished] = useState(null)\n  const [uploadCommands, setUploadCommands] = useState(null)\n  const [selected, setSelected] = useState(new Set())\n  const fetchTimer = useRef(-1)\n  const [pagination, setPagination] = useState({\n    page_size: 10,\n    page: 1,\n    order_by: 'upload_create_time',\n    order: 'desc'\n  })\n  const history = useHistory()\n\n  const fetchData = useCallback(() => {\n    const {page_size, page, order_by, order} = pagination\n    const url = `/uploads?page_size=${page_size}&page=${page}&order_by=${(order_by === 'published' ? 'publish_time' : order_by)}&order=${order}`\n    api.get(url, null, {returnRequest: true})\n      .then(uploads => {\n        setApiData(uploads)\n        const deleteStatus = uploads.response.data.filter(upload => upload?.current_process === 'delete_upload' && (upload?.process_status === 'PENDING' || upload?.process_status === 'RUNNING'))\n        if (deleteStatus.length === 0) {\n          if (fetchTimer.current !== -1) {\n            clearInterval(fetchTimer.current)\n          }\n          fetchTimer.current = -1\n        } else {\n          if (fetchTimer.current === -1) {\n            fetchTimer.current = setInterval(fetchData, 2000)\n          }\n        }\n      })\n      .catch(errors.raiseError)\n    api.get(`/uploads?is_published=false&roles=main_author&page_size=10000&order_by=${(order_by === 'published' ? 'publish_time' : order_by)}&order=${order}`)\n      .then(response => {\n        setUnpublished(response)\n      })\n      .catch(errors.raiseError)\n  }, [pagination, setApiData, setUnpublished, errors, api])\n\n  const handleReload = () => {\n    fetchData()\n  }\n\n  // This history dependency makes sure that the uploads are reloaded after page navigating\n  // back to the UploadsPage. E.g. if an upload was deleted on the UploadPage, we are\n  // history.pushed back to the UploadsPage and want to reload the list of uploads.\n  useEffect(() => {\n    fetchData()\n    return () => {\n      if (fetchTimer.current !== -1) clearInterval(fetchTimer.current)\n      fetchTimer.current = -1\n    }\n  }, [fetchData, history])\n\n  const isDisabled = unpublished\n    ? (unpublished.pagination ? unpublished.pagination.total >= servicesUploadLimit : false)\n    : false\n\n  useEffect(() => {\n    api.get('/uploads/command-examples')\n      .then(setUploadCommands)\n      .catch(errors.raiseError)\n  }, [api, errors, setUploadCommands])\n\n  const selectedUploads = useMemo(() => selected === 'all'\n    ? unpublished.data\n    : data?.data?.filter(upload => selected.has(upload.upload_id)\n  ), [data, selected, unpublished])\n\n  // A map to store whether each of the upload object's main author is the current user\n  const currentUserUploadsMap = useMemo(() => {\n    const map = new Map()\n    if (data && user) {\n      data.data.forEach((d) => {\n        map[d.upload_id] = d.main_author === user.sub\n      })\n    }\n    return map\n  }, [data, user])\n\n  // boolean to disable the Delete button if any of the upload's main author is not the current user\n  const disableDeleteButton = useMemo(() => {\n    if (selected === 'all' && data) {\n      return data.data.some(({upload_id}) => !currentUserUploadsMap[upload_id])\n    } else {\n      return Array.from(selected).some((id) => !currentUserUploadsMap[id])\n    }\n  }, [data, selected, currentUserUploadsMap])\n\n  const deleteUploads = useCallback(() => {\n    const promises = selectedUploads.map(upload => api.delete(`uploads/${upload.upload_id}`))\n    return Promise.allSettled(promises)\n  }, [selectedUploads, api])\n\n  const handleDeleteSubmitted = useCallback(() => {\n    deleteUploads().then(responses => {\n      responses.forEach((response) => {\n        if (response.status === 'fulfilled') {\n          // No error occurred\n        } else if (response.status === 'rejected') {\n          errors.raiseError(new Error(response.reason.apiMessage))\n        } else {\n          errors.raiseError(new Error('Unexpected error!'))\n        }\n      })\n      setSelected(new Set([]))\n      fetchData()\n    })\n  }, [deleteUploads, errors, fetchData])\n\n  // Setup columns\n  const columns = useMemo(() => {\n    const columns = [\n      {\n        key: 'upload_create_time',\n        render: upload => formatTimestamp(upload.upload_create_time)\n      },\n      {key: 'upload_name'},\n      {\n        key: 'upload_id',\n        render: upload => <Quantity quantity={'upload_id'} noLabel noWrap withClipboard data={upload}/>\n      },\n      {key: 'last_status_message', label: 'Status'},\n      {key: 'entries', render: upload => upload.entries, align: 'center'},\n      {key: 'published', render: upload => <UploadStatusIcon data={upload} user={user} />, align: 'center'}\n    ]\n    addColumnDefaults(columns, {align: 'left'}, defaultFilterData)\n    return columns\n  }, [user])\n\n  return (\n    <Page loading={!(data && uploadCommands)}>\n      <Box marginBottom={2}>\n        <Typography>\n          You can either create an upload and upload files through the browser:\n        </Typography>\n      </Box>\n      <Box alignItems='center' style={{display: 'flex'}}>\n        <NewUploadButton color=\"primary\" disabled={isDisabled}/>\n        <Typography color='initial' style={{padding: '10px'}} >or</Typography>\n        <ExampleUploadButton color=\"inherit\" disabled={isDisabled} />\n        <Box display=\"inline-block\" marginLeft={2}>\n          {isDisabled && <Typography color=\"error\" role='error-maximum-number-of-unpublished'>\n            You have reached maximum number of unpublished uploads!\n          </Typography>}\n        </Box>\n      </Box>\n      <Box marginTop={4}>\n        <Typography>\n          Or, you can create an upload by sending a file-archive via shell command:\n        </Typography>\n      </Box>\n      <Box>\n        {uploadCommands && <UploadCommands uploadCommands={uploadCommands}/>}\n      </Box>\n      <Box>\n        <Typography>\n          Visit our documentation on <UploadDocumentation>uploading files</UploadDocumentation> or show <SupportedCodes>supported codes</SupportedCodes>.\n        </Typography>\n      </Box>\n      {(data?.pagination?.total || 0) > 0 && <React.Fragment>\n        <Box marginTop={2} marginBottom={2}>\n          <Divider/>\n        </Box>\n        <Paper>\n          <Datatable\n            columns={columns} shownColumns={columns.map(column => column.key)}\n            sortingColumns={['upload_create_time', 'upload_name', 'last_status_message', 'published']}\n            data={data.data || []}\n            pagination={combinePagination(pagination, data.pagination)}\n            onPaginationChanged={setPagination}\n            selected={selected}\n            getId={option => option.upload_id}\n            onSelectedChanged={setSelected}\n          >\n            <DatatableToolbar title=\"Your existing uploads\">\n              <DatatableToolbarActions>\n                <TooltipButton\n                  title=\"Reload the uploads\"\n                  component={IconButton}\n                  onClick={handleReload}\n                >\n                  <ReloadIcon/>\n                </TooltipButton>\n                <SourceApiDialogButton maxWidth=\"lg\" fullWidth>\n                  <SourceApiCall {...apiData} />\n                </SourceApiDialogButton>\n              </DatatableToolbarActions>\n              <DatatableToolbarActions selection>\n                <DeleteUploadsButton\n                  isIcon\n                  disabled={disableDeleteButton}\n                  uploads={selectedUploads}\n                  onConfirm={handleDeleteSubmitted}\n                />\n              </DatatableToolbarActions>\n            </DatatableToolbar>\n            <DatatableTable actions={UploadActions}>\n              <DatatablePagePagination />\n            </DatatableTable>\n          </Datatable>\n        </Paper>\n      </React.Fragment>}\n    </Page>\n  )\n}\n\nexport default withLoginRequired(UploadsPage)\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport { ui } from '../config'\nimport { cloneDeep } from 'lodash'\nimport { withLoginRequired } from './api'\nimport { SearchContext } from './search/SearchContext'\nimport SearchPage from './search/SearchPage'\n\nexport const help = `\nThis page allows you to **inspect** and **manage** your own data. It is similar to the\n*entry search page*, but it will only show data that was uploaded by you or is shared with you.\n\nBesides giving you a filter for your data, this page also allows you to edit the *user metadata*\non all entries. User metadata is assigned to individual entries, but of course you can\nedit many entries at once. User metadata comprises comments, references, datasets, co-authors,\nand users to share data with.\n\n#### Selecting entries for edit\n\nYou can use the search in combination with the entries, dataset, or uploads table to\nhelp select sets of entries that you like to edit. If you select individual entries,\nonly these entries will be edit. If you select all entries, all entries fitting your\nsearch (including those\n  on further pages) will be edited. If you hit edit on datasets or uploads all entries\n  in these dataset or upload will be edited.\n\n#### The edit user metadata dialog\n\nIf you click an edit button, a dialog will appear. It is pre-filled with the values of\nthe first selected entry. However, the settings will be applied to all selected entries,\npotentially overwriting existing data. Only those settings that you change will be applied.\nFor example, if you only set a new comment, only the comments on all entries will be overwritten.\nIf you add a co-author, you changed the co-authors and all co-authors on all entries will be\nset with the new authors.\n\n#### Datasets\n\nThe edit dialog also allows you to put entries into datasets. Just enter the name of\nan existing or new dataset. We only consider datasets with data. You should never see\nan empty dataset. Entries can be put into many datasets. There is no explicit hierarchy\nbetween datasets, but of course you can effectively form super-sets by assigning entries\nrespectively.\n\nTo remove entries from datasets, simple set the list of datasets for those entries to a\nlist that is empty or does not contain the respective dataset anymore. If you remove\nall entries from a dataset like this, it will effectively disappear. You can also\ndelete datasets from the dataset table with the delete button. The dataset will be removed\nfrom the dataset list of all its current entries.\n\n#### DOIs\n\nOn the dataset table, you can also click the DOI button to assign a DOI to a dataset.\nThis DOI can be used in publications to link to your dataset. If people resovle the\nDOI, they will be redirected to a NOMAD view that shows the dataset and allows its download.\n\nOnce you assigned a DOI to a dataset, no entries can be removed or added to the dataset.\n`\n\n// Use the same context as in the global entries search, but with free-text\n// query enabled\nconst context = cloneDeep(ui?.apps?.options?.entries)\ncontext.search_syntaxes.exclude = undefined\n\nconst initialFiltersLocked = {\n  'visibility': 'user'\n}\nconst UserdataPage = React.memo(() => {\n  return <SearchContext\n    resource={context?.resource}\n    initialPagination={context?.pagination}\n    initialColumns={context?.columns}\n    initialRows={context?.rows}\n    initialFilterMenus={context?.filter_menus}\n    initialFilters={context?.filters}\n    initialFiltersLocked={initialFiltersLocked}\n    initialDashboard={context?.dashboard}\n    initialSearchSyntaxes={context?.search_syntaxes}\n  >\n    <SearchPage/>\n  </SearchContext>\n})\n\nexport default withLoginRequired(UserdataPage, 'Please login to search your data.')\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { React, useEffect, useState } from 'react'\n\nimport { addSeconds, endOfDay, format, formatDistanceToNow, getUnixTime, isValid,\n         subDays } from \"date-fns\"\nimport { Box, IconButton, Tooltip, makeStyles } from '@material-ui/core'\nimport ClipboardIcon from '@material-ui/icons/Assignment'\nimport { DatePicker } from '@material-ui/pickers'\nimport { CopyToClipboard } from 'react-copy-to-clipboard'\nimport { useKeycloak } from '@react-keycloak/web'\nimport { LoginRequired, useApi } from './api'\nimport { appTokenMaxExpiresIn } from '../config'\nimport { useErrors } from './errors'\n\nconst useStyles = makeStyles({\n  root: {\n    padding: 0\n  }\n})\n\nexport default function AppTokenForm() {\n  const classes = useStyles()\n  const {keycloak} = useKeycloak()\n  const {api} = useApi()\n  const errors = useErrors()\n\n  const [error, setError] = useState()\n  const [dateValue, setDateValue] = useState(new Date())\n  const [token, setToken] = useState()\n\n  let maxDate = subDays(addSeconds(new Date(), appTokenMaxExpiresIn), 1)\n  if (!isValid(maxDate)) maxDate = undefined\n\n  useEffect(() => {\n    if (error) setError(undefined)\n\n    const expiresAt = endOfDay(dateValue)\n    const expiresInS = getUnixTime(expiresAt) - getUnixTime(new Date())\n    api.get(`/auth/app_token?expires_in=${expiresInS}`)\n      .then((response) => {\n        setToken(response.app_token)\n      })\n      .catch((exception) => {\n        setToken(undefined)\n\n        if (exception.status !== 422) {\n          if (exception.status !== 401) {\n            errors.raiseError(exception)\n          }\n          return\n        }\n\n        const limitExpiresInS = exception.apiMessage[0].ctx.limit_value\n        const limitExpiresAt = subDays(addSeconds(new Date(), limitExpiresInS), 1)\n        setError(`Choose not later than ${format(limitExpiresAt, 'yyyy-MM-dd')} ` +\n                 `(in ${formatDistanceToNow(limitExpiresAt)}).`)\n      })\n  }, [dateValue, api, setToken, error, errors])\n\n  const handleDateChange = value => setDateValue(value)\n\n  return (\n    <LoginRequired classes={{root: classes.root}}>\n      <Box display=\"flex\" marginTop={1}>\n        <DatePicker\n          autoOk\n          error={error}\n          helperText={error}\n          disabled={!keycloak.authenticated}\n          disablePast\n          maxDate={maxDate}\n          size='small'\n          variant='inline'\n          inputVariant='filled'\n          label='App token expires after'\n          onChange={handleDateChange}\n          format='yyyy-MM-dd'\n          value={dateValue}\n        />\n        <Box marginLeft={1}>\n          <CopyToClipboard text={token} >\n            <Tooltip title=\"Copy token to clipboard\">\n              <IconButton disabled={!token}>\n                <ClipboardIcon />\n              </IconButton>\n            </Tooltip>\n          </CopyToClipboard>\n        </Box>\n      </Box>\n    </LoginRequired>\n  )\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { makeStyles } from '@material-ui/core'\nimport React from 'react'\nimport { apiBase, appBase } from '../config'\nimport Markdown from './Markdown'\nimport AppTokenForm from './AppTokenForm'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    padding: theme.spacing(3),\n    maxWidth: 1024,\n    margin: 'auto',\n    width: '100%'\n  }\n}))\n\nexport default function About() {\n  const classes = useStyles()\n\n  return <div className={classes.root}>\n    <Markdown>{`\n      # APIs\n\n      NOMAD's Application Programming Interface (API) allows you to access NOMAD data\n      and functions programatically. For all APIs, we offer dashboards that let you use\n      each API interactively, right in your browser.\n\n      ## NOMAD's API\n\n      - [API dashboard](${apiBase}/v1/extensions/docs)\n      - [API documentation](${apiBase}/v1/extensions/redoc)\n\n      We started to implement a more consise and easier to use API for access NOMAD\n      data. This will step-by-step reimplement all functions of NOMAD's old main API.\n      At some point, it will replace it entirely. For new users, we recommend to start\n      using this API. API Dashboard and documentation contain a tutorial on how to get started.\n\n      There is a [tutorial on how to use the API with plain Python](${appBase}/docs/api_tutorial.html).\n      Another [tutorial covers how to install and use NOMAD's Python client library](${appBase}/docs/archive_tutorial.html).\n      The [NOMAD Analytics Toolkit](https://nomad-lab.eu/AIToolkit) allows to use\n      this without installation and directly on NOMAD servers.\n\n      ###  App token\n\n      Next to the usual access token based on OpenID Connect, we provide an\n      [app token](${appBase}/docs/apis/api.html#app-token) with custom expiration date.\n      You may request one via the [API](${apiBase}/v1/extensions/docs) or the following form:\n    `}</Markdown>\n\n    <AppTokenForm />\n\n    <Markdown>{`\n\n      ### Old API\n\n      You can still use NOMAD's old REST API. The data it provides might miss the most\n      recent contributions:\n\n      - [v0 API dashboard](https://nomad-lab.eu/prod/rae/api/)\n\n      ## OPTIMADE\n\n      - [OPTIMADE API overview page](${appBase}/optimade/)\n      - [OPTIMADE API dashboard](${appBase}/optimade/v1/extensions/docs)\n      - [OPTIMADE API documentation](${appBase}/optimade/v1/extensions/redoc)\n\n      [OPTIMADE](https://www.optimade.org/) is an\n      open API standard for materials science databases. This API can be used to search\n      and access NOMAD metadata in a standardized way that can also be applied to many\n      [other materials science databses](https://providers.optimade.org/).\n\n      ## DCAT\n\n      - [DCAT API dashboard](${appBase}/dcat/)\n\n      [DCAT](https://www.w3.org/TR/vocab-dcat-2/) is a RDF vocabulary designed to facilitate\n      interoperability between data catalogs published on the Web. This API allows you\n      access to NOMAD via RDF documents following DCAT. You can access NOMAD entries as\n      DCAT Datasets or all NOMAD entries as a DCAT Catalog.\n\n      ## Resources\n\n      - [Resources API dashboard](${appBase}/resources/extensions/docs)\n\n      The resources API provides links from NOMAD entries to related external resources.\n      These include the [Aflow Encyclopedia of Crystallographic Prototypes](https://www.aflowlib.org/prototype-encyclopedia/),\n      [Springer Materials Database of Inorganic Solid Phases](https://materials.springer.com)\n      and [OPTIMADE providers](https://providers.optimade.org/).\n    `}</Markdown>\n  </div>\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useEffect, useMemo, useState } from 'react'\nimport { Typography, Link, makeStyles } from '@material-ui/core'\nimport { useHistory, useLocation } from 'react-router'\nimport qs from 'qs'\nimport { useApi } from '../api'\nimport { useErrors } from '../errors'\nimport { getUrl } from '../nav/Routes'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    padding: theme.spacing(3)\n  }\n}))\n\nexport default function EntryQuery(props) {\n  const classes = useStyles()\n  const history = useHistory()\n  const location = useLocation()\n  const {api} = useApi()\n  const {raiseError} = useErrors()\n\n  const [doesNotExist, setDoesNotExist] = useState(false)\n\n  const queryParams = useMemo(() => qs.parse(location.search.substring(1)), [location])\n\n  useEffect(() => {\n    api.get('/entries', {...queryParams})\n      .then(response => {\n        if (response.pagination.total > 0) {\n          const {entry_id, upload_id} = response.data[0]\n          history.push(getUrl(`entry/id/${upload_id}/${entry_id}`))\n        } else {\n          setDoesNotExist(true)\n        }\n      })\n      .catch(raiseError)\n  }, [history, api, raiseError, setDoesNotExist, queryParams])\n\n  let message = 'loading ...'\n\n  if (doesNotExist) {\n    if (queryParams && queryParams['external_id'] && queryParams['external_id'].startsWith('mp-')) {\n      message = <React.Fragment>\n        This particular entry <Link href={`https://materialsproject.org/tasks/${queryParams['external_id']}#`}>\n          {queryParams['external_id']}\n        </Link> has not yet been provided to NOMAD by the Materials Project.\n      </React.Fragment>\n    } else if (api.isLoggedIn) {\n      message = `\n          This URL points to an entry that either does not exist, or that you are not\n          authorized to see.`\n    } else {\n      message = `\n          This URL points to an entry that either does not exist, or that is not\n          publically visibile. Please login; you might be authorized to view it.`\n    }\n  }\n\n  return (\n    <Typography className={classes.root}>{message}</Typography>\n  )\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useEffect, useState } from 'react'\nimport { Typography, makeStyles } from '@material-ui/core'\nimport { matchPath, useLocation, useRouteMatch, useHistory } from 'react-router'\nimport {useApi} from '../api'\nimport {useErrors} from '../errors'\nimport { getUrl } from '../nav/Routes'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    padding: theme.spacing(3)\n  }\n}))\n\nexport default function ResolvePID() {\n  const classes = useStyles()\n  const {api, user} = useApi()\n  const {raiseError} = useErrors()\n  const history = useHistory()\n  const location = useLocation()\n  const match = useRouteMatch()\n\n  const [doesNotExist, setDoesNotExist] = useState(false)\n\n  useEffect(() => {\n    const pidMatch = matchPath(location.pathname, {\n      path: `${match.path}/:pid/:handle?`\n    })\n    const { pid, handle } = pidMatch.params\n    const pidWithHandle = handle ? pid + '/' + handle : pid\n\n    api.post('/entries/query', {owner: 'all', query: {pid: pidWithHandle}})\n      .then(response => {\n        if (response.pagination.total >= 1) {\n          const entry = response.data[0]\n          history.push(getUrl(`entry/id/${entry.upload_id}/${entry.entry_id}`, location))\n        } else {\n          setDoesNotExist(true)\n        }\n      })\n      .catch(raiseError)\n  }, [setDoesNotExist, history, location, match, api, raiseError])\n\n  let message = 'loading ...'\n\n  if (doesNotExist) {\n    if (user) {\n      message = `\n          This URL points to an entry that either does not exist, or that you are not\n          authorized to see.`\n    } else {\n      message = `\n          This URL points to an entry that either does not exist, or that is not\n          publically visibile. Please login; you might be authorized to view it.`\n    }\n  }\n\n  return (\n    <Typography className={classes.root}>{message}</Typography>\n  )\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useContext, useState, useEffect, useMemo } from 'react'\nimport PropTypes from 'prop-types'\nimport { cloneDeep } from 'lodash'\nimport { Typography, makeStyles } from '@material-ui/core'\nimport { ui } from '../../config'\nimport { errorContext } from '../errors'\nimport { useApi } from '../api'\nimport SearchPage from '../search/SearchPage'\nimport { SearchContext } from '../search/SearchContext'\nimport { DOI } from './DOI'\n\nexport const help = `\nThis page allows you to **inspect** and **download** NOMAD datasets. It also allows you\nto explore a dataset with similar controls that the search page offers.\n`\n\n// Use the same context as in the global entries search, but with free-text\n// query enabled\nconst context = cloneDeep(ui?.apps?.options?.entries)\ncontext.search_syntaxes.exclude = undefined\n\nconst useStyles = makeStyles(theme => ({\n  header: {\n    display: 'flex',\n    flexDirection: 'column'\n  }\n}))\nconst DatasetPage = React.memo(({match}) => {\n  const styles = useStyles()\n  const [dataset, setDataset] = useState()\n  const {raiseError} = useContext(errorContext)\n  const {api} = useApi()\n\n  // Router provides the URL parameters via props, here we read the dataset ID.\n  const datasetId = match?.params?.datasetId\n  const datasetFilter = useMemo(() => ({\n    'visibility': 'all',\n    'datasets.dataset_id': datasetId\n  }), [datasetId])\n\n  // Fetch the dataset information from API.\n  useEffect(() => {\n    api.datasets(datasetId)\n      .then(setDataset)\n      .catch(error => {\n        setDataset(undefined)\n        raiseError(error)\n      })\n  }, [datasetId, api, raiseError])\n\n  // Show a customized search page for this dataset. Basic dataset information\n  // shown in the header.\n  return dataset\n    ? <SearchContext\n      resource={context?.resource}\n      initialPagination={context?.pagination}\n      initialColumns={context?.columns}\n      initialRows={context?.rows}\n      initialFilterMenus={context?.filter_menus}\n      initialFilters={context?.filters}\n      initialFiltersLocked={datasetFilter}\n      initialDashboard={context?.dashboard}\n      initialSearchSyntaxes={context?.search_syntaxes}\n      id='dataset-search'\n    >\n      <SearchPage header={\n        <div className={styles.header}>\n          <Typography variant=\"h4\">\n            {dataset.dataset_name || (dataset.isEmpty && 'Empty or non existing dataset') || 'loading ...'}\n          </Typography>\n          <Typography>\n            dataset{dataset.doi ? <span>, with DOI <DOI doi={dataset.doi} /></span> : ''}\n          </Typography>\n        </div>}\n      />\n    </SearchContext>\n    : null\n})\nDatasetPage.propTypes = {\n  match: PropTypes.object\n}\n\nexport default DatasetPage\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useCallback, useContext, useEffect, useState, useMemo } from 'react'\nimport PropTypes from 'prop-types'\nimport {Paper, IconButton, Tooltip, DialogContent, Button, Dialog, DialogTitle} from '@material-ui/core'\nimport { useApi, withLoginRequired } from '../api'\nimport Page from '../Page'\nimport { useErrors } from '../errors'\nimport DetailsIcon from '@material-ui/icons/ArrowForward'\nimport DeleteIcon from '@material-ui/icons/Delete'\nimport DOIIcon from '@material-ui/icons/Bookmark'\nimport { DatasetButton } from '../nav/Routes'\nimport {\n  addColumnDefaults, combinePagination, Datatable,\n  DatatablePagePagination,\n  DatatableTable, DatatableToolbar } from '../datatable/Datatable'\nimport Quantity from '../Quantity'\nimport DialogContentText from '@material-ui/core/DialogContentText'\nimport DialogActions from '@material-ui/core/DialogActions'\nimport { SourceApiCall, SourceApiDialogButton } from '../buttons/SourceDialogButton'\nimport { formatTimestamp } from '../../utils'\n\nexport const help = `\nNOMAD allows you to create *datasets* from your data. A dataset is like a tag that you\ncann attach to one or many entries. An entry can have abitrary many datasets assign.\nThis way you can create datasets that overlap or contain each other. Datasets work\nvery similar to labels, albums, or tags on other platforms.\n`\n\nconst columns = [\n  {key: 'dataset_name'},\n  {\n    key: 'doi',\n    label: 'Digital object identifier (DOI)',\n    render: dataset => {\n      if (dataset.doi) {\n        return <Quantity\n          quantity={'datasets.doi'} noLabel noWrap withClipboard\n          data={{datasets: dataset}}\n        />\n      }\n      return null\n    }\n  },\n  {\n    key: 'dataset_id',\n    render: dataset => <Quantity quantity={'datasets.dataset_id'} noLabel noWrap withClipboard data={{datasets: dataset}}/>\n  },\n  {\n    key: 'dataset_create_time',\n    label: 'Create time',\n    render: dataset => formatTimestamp(dataset.dataset_create_time)\n  },\n  {\n    key: 'dataset_modified_time',\n    label: 'Modify time',\n    render: dataset => (dataset.dataset_modified_time ? formatTimestamp(dataset.dataset_modified_time) : '')\n  }\n]\n\naddColumnDefaults(columns, {align: 'left'})\n\nconst PageContext = React.createContext({})\n\nconst DatasetActions = React.memo(function VisitDatasetAction({data}) {\n  const {api} = useApi()\n  const {raiseError} = useErrors()\n  const {refresh} = useContext(PageContext)\n  const [openConfirmDeleteDialog, setOpenConfirmDeleteDialog] = useState(false)\n  const [openConfirmDoiDialog, setOpenConfirmDoiDialog] = useState(false)\n\n  const handleDelete = useCallback(() => {\n    setOpenConfirmDeleteDialog(false)\n    api.delete(`/datasets/${data.dataset_id}`)\n      .then(refresh).catch(raiseError)\n  }, [api, raiseError, data.dataset_id, refresh, setOpenConfirmDeleteDialog])\n\n  const handleAssignDoi = useCallback(() => {\n    setOpenConfirmDoiDialog(false)\n    api.post(`/datasets/${data.dataset_id}/action/doi`)\n      .then(refresh)\n      .catch(raiseError)\n  }, [api, raiseError, data.dataset_id, refresh, setOpenConfirmDoiDialog])\n\n  return <React.Fragment>\n    <Tooltip title=\"Assign a DOI\">\n      <span>\n        <IconButton onClick={() => setOpenConfirmDoiDialog(true)} disabled={!!data.doi}>\n          <DOIIcon />\n        </IconButton>\n      </span>\n    </Tooltip>\n    <Tooltip title={(data.doi ? 'The dataset cannot be deleted. A DOI has been assigned to the dataset.' : 'Delete the dataset')}>\n      <span>\n        <IconButton onClick={() => setOpenConfirmDeleteDialog(true)} disabled={!!data.doi} style={{pointerEvents: 'auto'}}>\n          <DeleteIcon />\n        </IconButton>\n      </span>\n    </Tooltip>\n    <Tooltip title=\"Open the dataset\">\n      <DatasetButton component={IconButton} datasetId={data.dataset_id}>\n        <DetailsIcon />\n      </DatasetButton>\n    </Tooltip>\n    <Dialog\n      open={openConfirmDeleteDialog}\n    >\n      <DialogContent>\n        <DialogContentText id=\"alert-dialog-description\">\n          Are you sure you want to permanently delete the dataset?\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => setOpenConfirmDeleteDialog(false)} autoFocus>Cancel</Button>\n        <Button onClick={handleDelete}>Delete</Button>\n      </DialogActions>\n    </Dialog>\n    <Dialog\n      open={openConfirmDoiDialog}\n      onClose={() => setOpenConfirmDoiDialog(false)}\n    >\n      <DialogTitle>Confirm that you want to assign a DOI</DialogTitle>\n      <DialogContent>\n        <DialogContentText>\n          Assigning a DOI is permanent. You will not be able to remove entries from\n          datasets with a DOI. You cannot delete datasets with a DOI.\n        </DialogContentText>\n      </DialogContent>\n      <DialogActions>\n        <Button onClick={() => setOpenConfirmDoiDialog(false)} autoFocus>Cancel</Button>\n        <Button onClick={handleAssignDoi}>Assign DOI</Button>\n      </DialogActions>\n    </Dialog>\n  </React.Fragment>\n})\nDatasetActions.propTypes = {\n  data: PropTypes.object.isRequired\n}\n\nfunction DatasetsPage() {\n  const {api, user} = useApi()\n  const errors = useErrors()\n  const [apiData, setApiData] = useState(null)\n  const data = useMemo(() => apiData?.response, [apiData])\n  const [pagination, setPagination] = useState({\n    page_size: 10,\n    page: 1,\n    order_by: 'dataset_create_time',\n    order: 'desc'\n  })\n\n  const load = useCallback(() => {\n    if (!user) {\n      return\n    }\n    const {page_size, page, order_by, order} = pagination\n    const url = `/datasets/?page_size=${page_size}&page=${page}&order_by=${order_by}&order=${order}&user_id=${user.sub}`\n    api.get(url, null, {returnRequest: true})\n      .then(setApiData)\n      .catch(errors.raiseError)\n  }, [pagination, setApiData, errors, api, user])\n\n  useEffect(() => {\n    load()\n  }, [load])\n\n  return <Page loading={!data}>\n    <PageContext.Provider value={{refresh: load}}>\n      {data &&\n        <Paper>\n          <Datatable\n            columns={columns} selectedColumns={columns.map(column => column.key)}\n            sortingColumns={['dataset_create_time', 'dataset_modified_time', 'dataset_name']}\n            data={data.data || []}\n            pagination={combinePagination(pagination, data.pagination)}\n            onPaginationChanged={setPagination}\n          >\n            <DatatableToolbar title=\"Your datasets\">\n              <SourceApiDialogButton maxWidth=\"lg\" fullWidth>\n                <SourceApiCall {...apiData} />\n              </SourceApiDialogButton>\n            </DatatableToolbar>\n            <DatatableTable actions={DatasetActions}>\n              <DatatablePagePagination />\n            </DatatableTable>\n          </Datatable>\n        </Paper>\n      }\n    </PageContext.Provider>\n  </Page>\n}\n\nexport default withLoginRequired(DatasetsPage)\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useEffect, useState } from 'react'\nimport { Typography, makeStyles } from '@material-ui/core'\nimport { matchPath, useLocation, useRouteMatch, useHistory } from 'react-router'\nimport {useApi} from '../api'\nimport {useErrors} from '../errors'\nimport { getUrl } from '../nav/Routes'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    padding: theme.spacing(3)\n  }\n}))\n\nexport default function ResolveDOI() {\n  const classes = useStyles()\n  const {api} = useApi()\n  const {raiseError} = useErrors()\n  const history = useHistory()\n  const location = useLocation()\n  const match = useRouteMatch()\n\n  const [doesNotExist, setDoesNotExist] = useState(false)\n\n  useEffect(() => {\n    const doiMatch = matchPath(location.pathname, {\n      path: `${match.path}/:doi*`\n    })\n    const { doi } = doiMatch.params\n\n    api.get('/datasets/', {doi: doi})\n      .then(response => {\n        if (response.pagination.total >= 1) {\n          const dataset_id = response.data[0].dataset_id\n          history.push(getUrl(`dataset/id/${dataset_id}`, location))\n        } else {\n          setDoesNotExist(true)\n        }\n      })\n      .catch(raiseError)\n  }, [setDoesNotExist, history, location, match, api, raiseError])\n\n  let message = 'loading ...'\n\n  if (doesNotExist) {\n    message = 'This URL points to a dataset that does not exist.'\n  }\n\n  return (\n    <Typography className={classes.root}>{message}</Typography>\n  )\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useEffect, useMemo, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { IconButton, Paper, Tabs, Tab, Box } from '@material-ui/core'\nimport TooltipButton from '../utils/TooltipButton'\nimport EditIcon from '@material-ui/icons/Edit'\nimport NavigateNextIcon from '@material-ui/icons/NavigateNext'\nimport { Datatable, DatatableToolbar, DatatableToolbarActions, DatatableTable,\n  DatatablePagePagination, DatatableScrollPagination, DatatableLoadMorePagination } from './Datatable'\nimport Page from '../Page'\nimport { sleep } from '../../utils'\n\nconst createExampleData = (length) => Array.from({length: length}, (_, i) => ({\n  id: (i + 1).toString(), value: i + 1\n}))\n\nconst columns = [\n  {\n    key: 'id',\n    sortable: true,\n    align: 'right',\n    render: data => data.id\n  },\n  {\n    key: 'value',\n    sortable: true,\n    render: data => `This is value for id ${data.value}.`\n  }\n]\n\nfunction DetailsExample({data}) {\n  return <div>Details: {data.id}</div>\n}\nDetailsExample.propTypes = {\n  data: PropTypes.object.isRequired\n}\n\nfunction ActionsExample({data}) {\n  return <TooltipButton\n    title=\"A row action.\" component={IconButton}\n    onClick={() => console.log(`Perform row action for ${data.id}.`)}\n  >\n    <NavigateNextIcon/>\n  </TooltipButton>\n}\nActionsExample.propTypes = {\n  data: PropTypes.object.isRequired\n}\n\nfunction ScrollDatatableExample() {\n  const exampleData = useMemo(() => createExampleData(1024), [])\n  const [pagination, setPagination] = useState({\n    total: 1024, page_size: 100\n  })\n  const [data, setData] = useState([])\n  const [selected, setSelected] = useState(new Set())\n\n  useEffect(() => {\n    sleep(100).then(() => {\n      const nextPageAfterValueInt = parseInt(pagination.page_after_value || 0) + pagination.page_size\n      setData(exampleData.slice(0, nextPageAfterValueInt))\n      setPagination(pagination => ({\n        ...pagination,\n        next_page_after_value: nextPageAfterValueInt > exampleData.length ? null : String(nextPageAfterValueInt)\n      }))\n    })\n  }, [pagination.page_after_value, pagination.page_size, exampleData])\n\n  return <Paper style={{height: '100%'}}>\n    <Datatable\n      columns={columns} data={data}\n      pagination={pagination} onPaginationChanged={setPagination}\n      selected={selected}\n      getId={option => option.id}\n      onSelectedChanged={setSelected}\n    >\n      <DatatableToolbar title=\"Example table.\" />\n      <DatatableTable\n        details={DetailsExample}\n        actions={ActionsExample}\n      >\n        <DatatableScrollPagination loadingMessage=\"loading more example items ...\"/>\n      </DatatableTable>\n    </Datatable>\n  </Paper>\n}\n\nfunction LoadMoreDatatableExample() {\n  const exampleData = useMemo(() => createExampleData(1024), [])\n  const [pagination, setPagination] = useState({\n    total: 1024, page_size: 10\n  })\n  const [data, setData] = useState([])\n  const [selected, setSelected] = useState(new Set())\n\n  useEffect(() => {\n    sleep(100).then(() => {\n      const nextPageAfterValueInt = parseInt(pagination.page_after_value || 0) + pagination.page_size\n      setData(exampleData.slice(0, nextPageAfterValueInt))\n      setPagination(pagination => ({\n        ...pagination,\n        next_page_after_value: nextPageAfterValueInt > exampleData.length ? null : String(nextPageAfterValueInt)\n      }))\n    })\n  }, [pagination.page_after_value, pagination.page_size, exampleData])\n\n  return <Paper>\n    <Datatable\n      columns={columns} data={data}\n      pagination={pagination} onPaginationChanged={setPagination}\n      selected={selected}\n      getId={option => option.id}\n      onSelectedChanged={setSelected}\n    >\n      <DatatableToolbar title=\"Example table.\" />\n      <DatatableTable\n        details={DetailsExample}\n        actions={ActionsExample}\n      >\n        <DatatableLoadMorePagination color=\"primary\">\n          load more\n        </DatatableLoadMorePagination>\n      </DatatableTable>\n    </Datatable>\n  </Paper>\n}\n\nexport function DatatableExamples() {\n  const exampleData = useMemo(() => createExampleData(23), [])\n\n  const [data, setData] = useState([])\n  const [pagination, setPagination] = useState({\n    page_size: 10, page: 1, order_by: 'id', order: 'asc', total: exampleData.length\n  })\n  const [selected, setSelected] = useState(new Set())\n\n  useEffect(() => {\n    const {page_size, page, total, order, order_by} = pagination\n    const compare = (a, b) => {\n      const value = data => parseInt(String(data[order_by]))\n      return (value(a) - value(b)) * (order === 'asc' ? 1 : -1)\n    }\n    const data = [...exampleData].sort(compare)\n    const start = page_size * (page - 1)\n    const end = page_size + start\n    const length = (end > total) ? total - start : page_size\n    setData(data.slice(start, start + length))\n  }, [pagination, exampleData])\n\n  const [tab, setTab] = useState(3)\n\n  return <Box height=\"100%\" display=\"flex\" flexDirection=\"column\">\n    <Tabs value={tab} onChange={(event, tab) => setTab(tab)}>\n      <Tab label=\"details paginated\" />\n      <Tab label=\"paginated\" />\n      <Tab label=\"plain\" />\n      <Tab label=\"scroll\" />\n      <Tab label=\"load more\" />\n    </Tabs>\n\n    <Box flex={1}>\n      <Page limitedWidth hidden={tab !== 0}>\n        <Paper>\n          <Datatable\n            columns={columns}\n            data={data}\n            pagination={pagination}\n            onPaginationChanged={setPagination}\n            selected={selected}\n            getId={option => option.id}\n            onSelectedChanged={setSelected}\n          >\n            <DatatableToolbar title=\"Example table.\">\n              <DatatableToolbarActions selection>\n                <IconButton onClick={() => console.log('Perform action on selection.')}>\n                  <EditIcon/>\n                </IconButton>\n              </DatatableToolbarActions>\n              <DatatableToolbarActions>\n                <IconButton onClick={() => console.log('Perform general action.')}>\n                  <EditIcon/>\n                </IconButton>\n              </DatatableToolbarActions>\n            </DatatableToolbar>\n            <DatatableTable details={DetailsExample} actions={ActionsExample}>\n              <DatatablePagePagination pageSizeValues={[5, 10, 50, 100]}/>\n            </DatatableTable>\n          </Datatable>\n        </Paper>\n      </Page>\n\n      <Page limitedWidth hidden={tab !== 1}>\n        <Paper>\n          <Datatable\n            columns={columns}\n            data={data}\n            pagination={pagination}\n            onPaginationChanged={setPagination}\n            selected={selected}\n            getId={option => option.id}\n            onSelectedChanged={setSelected}\n          >\n            <DatatableToolbar title=\"Example table.\">\n              <DatatableToolbarActions selection>\n                <IconButton onClick={() => console.log('Perform action on selection.')}>\n                  <EditIcon/>\n                </IconButton>\n              </DatatableToolbarActions>\n              <DatatableToolbarActions>\n                <IconButton onClick={() => console.log('Perform general action.')}>\n                  <EditIcon/>\n                </IconButton>\n              </DatatableToolbarActions>\n            </DatatableToolbar>\n            <DatatableTable>\n              <DatatablePagePagination pageSizeValues={[5, 10, 50, 100]}/>\n            </DatatableTable>\n          </Datatable>\n        </Paper>\n      </Page>\n      <Page limitedWidth hidden={tab !== 2}>\n        <Paper>\n          <Datatable columns={columns} data={exampleData} />\n        </Paper>\n      </Page>\n      <Page limitedWidth limitedHeight hidden={tab !== 3}>\n        <ScrollDatatableExample/>\n      </Page>\n      <Page limitedWidth limitedHeight hidden={tab !== 4}>\n        <LoadMoreDatatableExample/>\n      </Page>\n    </Box>\n  </Box>\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useCallback, useMemo, useState} from 'react'\nimport {\n  Box,\n  FormControl,\n  FormLabel, Slider\n} from '@material-ui/core'\nimport PropTypes from 'prop-types'\nimport {Quantity} from '../units/Quantity'\nimport {Unit} from '../units/Unit'\nimport {useUnitContext} from '../units/UnitContext'\nimport {UnitSelect} from './NumberEditQuantity'\nimport {getDisplayLabel} from \"../../utils\"\nimport {useRecoilValue} from \"recoil\"\nimport {configState} from \"../archive/ArchiveBrowser\"\n\nexport const SliderEditQuantity = React.memo((props) => {\n  const {quantityDef, value, onChange, minValue, maxValue, ...sliderProps} = props\n  const config = useRecoilValue(configState)\n  const label = getDisplayLabel(quantityDef, true, config?.showMeta)\n\n  const {units} = useUnitContext()\n  const defaultUnit = useMemo(() => quantityDef.unit && new Unit(quantityDef.unit), [quantityDef])\n  const dimension = defaultUnit && defaultUnit.dimension()\n  const [unit, setUnit] = useState(units[dimension]?.definition || quantityDef.unit)\n  const minValueConverted = useMemo(() => {\n    return unit\n      ? new Quantity(minValue, quantityDef.unit).to(unit).value()\n      : minValue\n  }, [minValue, quantityDef, unit])\n  const maxValueConverted = useMemo(() => {\n    return unit\n      ? new Quantity(maxValue, quantityDef.unit).to(unit).value()\n      : maxValue\n  }, [maxValue, quantityDef, unit])\n  const sliderValue = useMemo(() => {\n    return unit\n      ? new Quantity(value || 0, quantityDef.unit).to(unit).value()\n      : value || 0\n  }, [unit, quantityDef, value])\n\n  const handleChangeValue = useCallback((event, value) => {\n    const convertedValue = unit ? new Quantity(value, unit).to(quantityDef.unit).value() : value\n    if (onChange) {\n      onChange(convertedValue)\n    }\n  }, [unit, onChange, quantityDef])\n\n  return <FormControl fullWidth>\n    <FormLabel>{label}</FormLabel>\n    <Box display=\"flex\" alignItems=\"center\">\n      <Slider\n        value={sliderValue}\n        min={minValueConverted}\n        max={maxValueConverted}\n        onChange={handleChangeValue}\n        valueLabelDisplay={(!unit ? 'on' : 'off')}\n        {...sliderProps}\n      />\n      {unit && (\n        <UnitSelect dimension={dimension} unit={unit} onChange={setUnit}/>\n      )}\n    </Box>\n  </FormControl>\n})\nSliderEditQuantity.propTypes = {\n  quantityDef: PropTypes.object.isRequired,\n  value: PropTypes.number,\n  minValue: PropTypes.number.isRequired,\n  maxValue: PropTypes.number.isRequired,\n  onChange: PropTypes.func\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, {useRef, useState} from 'react'\nimport PropTypes from 'prop-types'\nimport {Card, Box, Typography, Grid, CardContent} from '@material-ui/core'\nimport {NumberEditQuantity} from './NumberEditQuantity'\nimport {StringEditQuantity, URLEditQuantity} from './StringEditQuantity'\nimport {EnumEditQuantity} from './EnumEditQuantity'\nimport {AutocompleteEditQuantity} from './AutocompleteEditQuantity'\nimport {RadioEnumEditQuantity} from './RadioEnumEditQuantity'\nimport {BoolEditQuantity} from './BoolEditQuantity'\nimport {SliderEditQuantity} from './SliderEditQuantity'\nimport { DateEditQuantity, DateTimeEditQuantity, TimeEditQuantity } from './DateTimeEditQuantity'\nimport RichTextEditQuantity from './RichTextEditQuantity'\nimport ListEditQuantity from './ListEditQuantity'\nimport { Code } from '../buttons/SourceDialogButton'\nimport { stripIndent } from '../../utils'\nimport AuthorEditQuantity from './AuthorEditQuantity'\nimport QueryEditQuantity from \"./QueryEditQuantity\"\n\nconst enumValues = [\n  'Vapor deposition', 'Chemical vapor deposition', 'Metalorganic vapour phase epitaxy', 'Electrostatic spray assisted vapour deposition (ESAVD)', 'Sherardizing',\n  'Some forms of Epitaxy', 'Molecular beam epitaxy', 'Physical vapor deposition', 'Cathodic arc deposition', 'Electron beam physical vapor deposition (EBPVD)',\n  'Ion plating', 'Ion beam assisted deposition (IBAD)', 'Magnetron sputtering', 'Pulsed laser deposition', 'Sputter deposition',\n  'Vacuum deposition', 'Pulsed electron deposition (PED)', 'Chemical and electrochemical techniques', 'Conversion coating', 'Autophoretic', 'Anodising',\n  'Chromate conversion coating', 'Plasma electrolytic oxidation', 'Phosphate', 'Ion beam mixing', 'Pickled and oiled, a type of plate steel coating',\n  'Plating', 'Electroless plating', 'Electroplating', 'Spraying', 'Spray painting', 'High velocity oxygen fuel (HVOF)', 'Plasma spraying',\n  'Thermal spraying', 'Kinetic metallization (KM)', 'Plasma transferred wire arc thermal spraying', 'The common forms of Powder coating', 'Roll-to-roll coating processes',\n  'Common roll-to-roll coating processes include:', 'Air knife coating', 'Anilox coater', 'Flexo coater', 'Gap Coating', 'Knife-over-roll coating', 'Gravure coating',\n  'Immersion dip coating', 'Kiss coating', 'Metering rod (Meyer bar) coating', 'Roller coating', 'Forward roller coating', 'Reverse roll coating',\n  'Silk Screen coater', 'Rotary screen', 'Lithography', 'Flexography', 'Physical coating processes', 'Langmuir-Blodgett', 'Spin coating', 'Dip coating']\n\nfunction Example({code, children}) {\n  return (\n    <Box display=\"flex\" flexDirection=\"row\" alignItems=\"flext-start\" marginBottom={2}>\n      <Box width={500} marginRight={2}>\n        {children}\n      </Box>\n      <Code\n        code={stripIndent(code)}\n      />\n    </Box>\n  )\n}\nExample.propTypes = {\n  code: PropTypes.string,\n  children: PropTypes.any\n}\n\nexport function EditQuantityExamples() {\n  const [, setUpdate] = useState(0)\n  const propsRef = useRef({})\n  const sectionRef = useRef({})\n\n  const createDefaultProps = (name, props) => {\n    if (!propsRef.current[name]) {\n      propsRef.current[name] = {\n        quantityDef: {\n          name: name,\n          _qualifiedName: `${name}-qualifiedName`,\n          description: `\n            This is **MARKDOWN** help text.\n          `,\n          ...(props || {})\n        },\n        onChange: value => {\n          sectionRef.current[name] = value\n          setUpdate(value => value + 1)\n        }\n      }\n    }\n    return {\n      ...(propsRef.current[name]),\n      value: sectionRef.current[name]\n    }\n  }\n\n  const float = {\n    type_kind: 'python',\n    type_data: 'float'\n  }\n\n  const int = {\n    type_kind: 'python',\n    type_data: 'int'\n  }\n\n  const user = {\n    type_kind: 'User',\n    type_data: 'User'\n  }\n\n  return <Box margin={3}>\n    <Grid container direction=\"row\" spacing={2}>\n      <Grid item>\n        <Card>\n          <CardContent>\n            <Box width={1100}>\n              <Grid container direction=\"column\" spacing={1}>\n                <Grid item>\n                  <Example\n                    code={`\n                    string:\n                      type: string\n                      m_annotations:\n                        eln:\n                          component: StringEditQuantity`}\n                  >\n                    <StringEditQuantity {...createDefaultProps('string')} />\n                  </Example>\n                </Grid>\n                <Grid item>\n                  <Example\n                    code={`\n                    url_link:\n                      type: string\n                      m_annotations:\n                        eln:\n                          component: URLEditQuantity`}\n                  >\n                    <URLEditQuantity {...createDefaultProps('url')}/>\n                  </Example>\n                </Grid>\n                <Grid item>\n                  <Example\n                    code={`\n                    float:\n                      type: np.float64\n                      m_annotations:\n                        eln:\n                          component: NumberEditQuantity`}\n                  >\n                    <NumberEditQuantity {...createDefaultProps('float', {type: float})} />\n                  </Example>\n                </Grid>\n                <Grid item>\n                  <Example\n                    code={`\n                    float_unit:\n                      type: np.float64\n                      unit: second\n                      m_annotations:\n                        eln:\n                          component: NumberEditQuantity\n                          defaultDisplayUnit: \"fs\"`}\n                  >\n                    <NumberEditQuantity {...createDefaultProps('float_unit', {type: float, unit: 'second', m_annotations: {eln: [{defaultDisplayUnit: 'fs'}]}})}/>\n                  </Example>\n                </Grid>\n                <Grid item>\n                  <Example\n                    code={`\n                    float_derived_unit:\n                      type: np.float64\n                      unit: joule\n                      m_annotations:\n                        eln:\n                          component: NumberEditQuantity\n                          defaultDisplayUnit: \"eV\"`}\n                  >\n                    <NumberEditQuantity {...createDefaultProps('float_derived_unit', {type: float, unit: 'joule', m_annotations: {eln: [{defaultDisplayUnit: 'eV'}]}})}/>\n                  </Example>\n                </Grid>\n                <Grid item>\n                  <Example\n                    code={`\n                    float_complex_unit:\n                      type: np.float64\n                      unit: ampere / second^2 * meter\n                      m_annotations:\n                        eln:\n                          component: NumberEditQuantity\n                          defaultDisplayUnit: \"milliampere / ms^2 * cm\"`}\n                  >\n                    <NumberEditQuantity {...createDefaultProps('float_complex_unit', {type: float, unit: 'ampere / second^2 * meter', m_annotations: {eln: [{defaultDisplayUnit: 'milliampere / ms^2 * cm'}]}})}/>\n                  </Example>\n                </Grid>\n                <Grid item>\n                  <Example\n                    code={`\n                    float_with_bounds:\n                      type: np.float64\n                      unit: meter\n                      m_annotations:\n                        eln:\n                          component: NumberEditQuantity\n                          minValue: 0\n                          maxValue: 10`}\n                  >\n                    <NumberEditQuantity\n                      {...createDefaultProps('float_with_bounds', {type: float, unit: 'meter'})}\n                      minValue={0} maxValue={10}\n                    />\n                  </Example>\n                </Grid>\n                <Grid item>\n                  <Example\n                    code={`\n                    int:\n                      type: int\n                      m_annotations:\n                        eln:\n                          component: NumberEditQuantity`}\n                  >\n                    <NumberEditQuantity {...createDefaultProps('int', {type: int})} />\n                  </Example>\n                </Grid>\n                <Grid item>\n                  <Example\n                    code={`\n                    int_with_bounds:\n                      type: int\n                      m_annotations:\n                        eln:\n                          component: NumberEditQuantity\n                          minValue: 0\n                          maxValue: 10`}\n                  >\n                    <NumberEditQuantity\n                      {...createDefaultProps('int_with_bounds', {type: int})}\n                      minValue={0} maxValue={10}\n                    />\n                  </Example>\n                </Grid>\n                <Grid item>\n                  <Example\n                    code={`\n                    bool:\n                      type: bool\n                      m_annotations:\n                        eln:\n                          component: BoolEditQuantity`}\n                  >\n                    <BoolEditQuantity {...createDefaultProps('bool')} />\n                  </Example>\n                </Grid>\n                <Grid item>\n                  <Example\n                    code={`\n                    bool_with_labels:\n                      type: bool\n                      m_annotations:\n                        eln:\n                          component: BoolEditQuantity\n                          boolean_labels:\n                            true: on\n                            false: off\n                            undefined: undecided`}\n                  >\n                    <BoolEditQuantity {...createDefaultProps('bool_with_labels')}\n                                      booleanLabels={{true: 'on', false: 'off', undefined: 'undecided'}}/>\n                  </Example>\n                </Grid>\n                <Grid item>\n                  <Example\n                    code={`\n                    radio_enum:\n                      type:\n                        type_kind: enum\n                        type_data:\n                          - one\n                          - two\n                          - three\n                      m_annotations:\n                        eln:\n                          component: RadioEnumEditQuantity`}\n                  >\n                    <RadioEnumEditQuantity {...createDefaultProps('radio_enum', {\n                      type: {\n                        type_data: ['one', 'two', 'three']\n                      }\n                    })} />\n                  </Example>\n                </Grid>\n                <Grid item>\n                  <Example\n                    code={`\n                    select_enum:\n                      type:\n                        type_kind: enum\n                        type_data:\n                          - one\n                          - two\n                          - three\n                      m_annotations:\n                        eln:\n                          component: EnumEditQuantity`}\n                  >\n                    <EnumEditQuantity {...createDefaultProps('select_enum', {\n                      type: {\n                        type_data: ['one', 'two', 'three']\n                      }\n                    })} />\n                  </Example>\n                </Grid>\n                <Grid item>\n                  <Example\n                    code={`\n                    string_with_suggestions:\n                      type: str\n                      m_annotations:\n                        eln:\n                          component: EnumEditQuantity\n                          suggestions: ['one', 'two', 'three']`}\n                  >\n                    <EnumEditQuantity {...createDefaultProps('string_with_suggestions')} suggestions={['one', 'two', 'three']}/>\n                  </Example>\n                </Grid>\n                <Grid item>\n                  <Example\n                    code={`\n                    autocomplete_enum:\n                      type:\n                        type_kind: enum\n                        type_data: [\n                          ...\n                          ]\n                      m_annotations:\n                        eln:\n                          component: AutocompleteEditQuantity`}\n                  >\n                    <AutocompleteEditQuantity {...createDefaultProps('autocomplete_enum', {\n                      type: {\n                        type_data: enumValues\n                      }\n                    })} />\n                  </Example>\n                </Grid>\n                <Grid item>\n                  <Example\n                    code={`\n                    slider:\n                      type: int\n                      m_annotations:\n                        eln:\n                          component: SliderEditQuantity,\n                          minValue: 0\n                          maxValue: 10`}\n                  >\n                    <SliderEditQuantity {...createDefaultProps('slider')} minValue={0} maxValue={10} />\n                  </Example>\n                </Grid>\n                <Grid item>\n                  <Example\n                    code={`\n                    date_time:\n                      type: nomad.metainfo.Datetime\n                      m_annotations:\n                        eln:\n                          component: DateTimeEditQuantity`}\n                  >\n                    <DateTimeEditQuantity {...createDefaultProps('date_time')} />\n                  </Example>\n                </Grid>\n                <Grid item>\n                  <Example\n                    code={`\n                    date:\n                      type: nomad.metainfo.Datetime\n                      m_annotations:\n                        eln:\n                          component: DateEditQuantity`}\n                  >\n                    <DateEditQuantity {...createDefaultProps('date')} />\n                  </Example>\n                </Grid>\n                <Grid item>\n                  <Example\n                    code={`\n                    time:\n                      type: nomad.metainfo.Datetime\n                      m_annotations:\n                        eln:\n                          component: TimeEditQuantity`}\n                  >\n                    <TimeEditQuantity {...createDefaultProps('date')} />\n                  </Example>\n                </Grid>\n                <Grid item>\n                  <Example\n                    code={`\n                    rich_text:\n                      type: str\n                      m_annotations:\n                        eln:\n                          component: RichTextEditQuantity`}\n                  >\n                    <RichTextEditQuantity {...createDefaultProps('rich_text')} />\n                  </Example>\n                </Grid>\n                <Grid item>\n                  <Example\n                    code={`\n                    list:\n                      type: str\n                      shape: ['*']\n                      m_annotations:\n                        eln:\n                          component: StringEditQuantity`}\n                  >\n                    <ListEditQuantity\n                      component={StringEditQuantity}\n                      {...createDefaultProps('list', {shape: ['*']})}\n                    />\n                  </Example>\n                </Grid>\n                <Grid item>\n                  <Example\n                    code={`\n                    list_fixed:\n                      type: str\n                      shape: [3]\n                      m_annotations:\n                        eln:\n                          component: StringEditQuantity`}\n                  >\n                    <ListEditQuantity\n                      component={StringEditQuantity}\n                      {...createDefaultProps('list_fixed', {shape: [3]})}\n                    />\n                  </Example>\n                </Grid>\n                <Grid item>\n                  <Example\n                    code={`\n                    author:\n                      type: User\n                      m_annotations:\n                        eln:\n                          component: AuthorEditQuantity`}\n                  >\n                    <AuthorEditQuantity {...createDefaultProps('User', {type: user})} />\n                  </Example>\n                </Grid>\n                <Grid item>\n                  <Example\n                    code={`\n                    author:\n                      type: Author\n                      m_annotations:\n                        eln:\n                          component: AuthorEditQuantity`}\n                  >\n                    <AuthorEditQuantity {...createDefaultProps('Author')} />\n                  </Example>\n                </Grid>\n                <Grid item>\n                  <Example\n                    code={`\n                    query:\n                      type: Query\n                      m_annotations:\n                        eln:\n                          component: QueryEditQuantity`}\n                  >\n                    <QueryEditQuantity\n                      {...createDefaultProps('myQuery', {value: {}})}\n                      storeInArchive={true}\n                    />\n                  </Example>\n                </Grid>\n              </Grid>\n            </Box>\n          </CardContent>\n        </Card>\n      </Grid>\n      <Grid item>\n        <Box margin={2}>\n          <Typography component=\"pre\">\n            {JSON.stringify(sectionRef.current, null, 4)}\n          </Typography>\n        </Box>\n      </Grid>\n    </Grid>\n  </Box>\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport FileBrowser from '../archive/FileBrowser'\nimport Page from '../Page'\nimport { useUploadPageContext } from './UploadPageContext'\nimport { createUploadUrl } from '../../utils'\nimport { Typography } from '@material-ui/core'\n\nconst UploadFilesView = React.memo(function UploadFilesView() {\n  const {deploymentUrl, uploadId, error, hasUpload} = useUploadPageContext()\n\n  if (!hasUpload) {\n    return <Page limitedWidth>\n      {(error ? <Typography>{error.apiMessage || error.message || 'Failed to load'}</Typography> : <Typography>loading ...</Typography>)}\n    </Page>\n  }\n\n  return <Page>\n    <FileBrowser\n      uploadUrl={createUploadUrl(deploymentUrl, uploadId, '')}\n      rootTitle=\"Upload files\"\n    />\n  </Page>\n})\nUploadFilesView.propTypes = {\n  uploadId: PropTypes.string\n}\nexport default UploadFilesView\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport { CircularProgress, Grid, makeStyles, Paper, Slide, Typography } from '@material-ui/core'\nimport Page from '../Page'\nimport { useUploadPageContext } from './UploadPageContext'\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    position: 'absolute',\n    left: 0,\n    right: 0,\n    marginTop: -20,\n    margin: -10,\n    padding: 10,\n    paddingTop: 20,\n    zIndex: 1000\n  }\n}))\n\nconst UploadProcessingStatus = React.memo(function ProcessingStatus() {\n  const {isProcessing, upload} = useUploadPageContext()\n  const classes = useStyles()\n\n  if (!upload) {\n    return null\n  }\n\n  return (\n    <Slide direction=\"down\" in={isProcessing} mountOnEnter unmountOnExit>\n      <Paper className={classes.root}>\n        <Page limitedWidth>\n          <Grid container spacing={2} alignItems=\"center\">\n            <Grid item>\n              <CircularProgress />\n            </Grid>\n            <Grid item style={{flexGrow: 1}}>\n              <Typography>Upload is processing ...</Typography>\n              <Typography>{upload.last_status_message}</Typography>\n            </Grid>\n          </Grid>\n        </Page>\n      </Paper>\n    </Slide>\n  )\n})\n\nexport default UploadProcessingStatus\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useCallback, useMemo, useState } from 'react'\nimport PropTypes from 'prop-types'\nimport { Card, Box, CardContent } from '@material-ui/core'\nimport { Code } from '../buttons/SourceDialogButton'\nimport { stripIndent } from '../../utils'\nimport { SectionPlots } from './ArchiveBrowser'\nimport { useGlobalMetainfo } from './metainfo'\nimport InputConfig from '../search/input/InputConfig'\nimport Typography from '@material-ui/core/Typography'\n\nconst pvdSection = {\n  name: 'Substrate 1',\n  process_time: [-2099, -2026, -1953, -1880, -1807, -1734, -1661, -1588, -1515, -1442, -1369, -1296, -1223, -1150, -1077, -1004, -931, -858, -785, -712, -639, -566, -493, -419, -346, -273, -200, -127, -54, 19, 92, 165, 238, 311, 384, 457, 530, 603, 676, 749, 822, 895, 968, 1041, 1114, 1187, 1260, 1333, 1406, 1479, 1552, 1625, 1698, 1771, 1844, 1917, 1990, 2063, 2136, 2209, 2282, 2355, 2428, 2501, 2574, 2647, 2720, 2793, 2866, 2939, 3012, 3085, 3158, 3231, 3304, 3377, 3450, 3523, 3596, 3669, 3742, 3815, 3888, 3961, 4034, 4107, 4180, 4253, 4326, 4399, 4472, 4545, 4618, 4691, 4764, 4837, 4910, 4983, 5056, 5129, 5202, 5275, 5348, 5421, 5494, 5567, 5640, 5713, 5786, 5859, 5932, 6005, 6078, 6151, 6225, 6298, 6371, 6444, 6517, 6590, 6663, 6736, 6809, 6882, 6955, 7028, 7101, 7174, 7247, 7320, 7393, 7466, 7539],\n  set_substrate_temperature: [309.356, 309.217, 309.084, 308.958, 308.838, 308.724, 308.616, 308.513, 308.415, 308.322, 308.233, 308.148, 308.068, 307.992, 307.919, 307.85, 307.784, 307.722, 307.662, 307.606, 307.552, 307.501, 307.452, 307.406, 307.362, 307.32, 307.28, 307.242, 307.206, 307.171, 307.139, 307.108, 307.078, 307.05, 307.023, 306.998, 306.974, 306.951, 306.929, 306.908, 306.888, 306.869, 306.851, 306.834, 306.818, 306.803, 306.788, 306.774, 306.761, 306.748, 306.736, 306.725, 306.714, 306.704, 306.694, 306.684, 306.676, 306.667, 306.659, 306.651, 306.644, 306.637, 306.631, 306.624, 306.618, 306.613, 306.607, 306.602, 306.597, 306.593, 306.588, 306.584, 306.58, 306.576, 306.573, 306.569, 306.566, 306.563, 306.56, 306.557, 306.554, 306.552, 306.549, 306.547, 306.545, 306.543, 306.541, 306.539, 306.537, 306.535, 306.534, 306.532, 306.531, 306.529, 306.528, 306.527, 306.525, 306.524, 306.523, 306.522, 306.521, 306.52, 306.519, 306.519, 306.518, 306.517, 306.516, 306.516, 306.515, 306.514, 306.514, 306.513, 306.513, 306.512, 306.512, 306.511, 306.511, 306.51, 306.51, 306.509, 306.509, 306.509, 306.508, 306.508, 306.508, 306.508, 306.507, 306.507, 306.507, 306.507, 306.506, 306.506, 306.506],\n  substrate_temperature: [305.563, 305.527, 305.518, 305.523, 305.506, 305.502, 305.506, 305.515, 305.563, 305.575, 305.591, 305.607, 305.609, 305.637, 305.683, 305.701, 305.74, 305.788, 305.813, 305.871, 305.913, 305.977, 306.003, 306.076, 306.143, 306.179, 306.267, 306.321, 306.374, 306.453, 306.635, 306.871, 307.098, 307.324, 307.549, 307.801, 308.03, 308.264, 308.499, 308.728, 308.971, 309.16, 309.374, 309.6, 309.779, 309.95, 310.16, 310.334, 310.501, 310.668, 310.84, 310.999, 311.145, 311.303, 311.45, 311.58, 311.709, 311.852, 311.991, 312.093, 312.243, 312.336, 312.464, 312.569, 312.664, 312.785, 312.887, 312.973, 313.099, 313.192, 313.27, 313.369, 313.47, 313.568, 313.638, 313.718, 314.497, 317.131, 316.92, 316.736, 316.561, 316.389, 316.204, 316.021, 315.853, 315.692, 315.552, 315.409, 315.284, 315.124, 314.984, 314.851, 314.719, 314.583, 314.466, 314.338, 314.226, 314.085, 313.986, 313.85, 313.765, 313.639, 313.536, 313.44, 313.315, 313.211, 313.123, 313.004, 312.9, 312.801, 312.717, 312.634, 312.553, 312.468, 312.371, 312.257, 312.172, 312.085, 312.004, 311.921, 311.833, 311.75, 311.658, 311.583, 310.238, 310.188, 310.204, 310.208, 310.185, 309.659, 309.457, 309.572, 309.602],\n  chamber_pressure: [0.313, 0.328, 0.319, 0.313, 0.307, 0.306, 0.304, 0.303, 0.304, 0.303, 0.303, 0.303, 0.303, 0.303, 0.303, 0.303, 0.302, 0.303, 0.301, 0.303, 0.303, 0.302, 0.301, 0.303, 0.303, 0.303, 0.303, 0.304, 0.303, 0.303, 0.303, 0.304, 0.304, 0.304, 0.304, 0.305, 0.304, 0.305, 0.304, 0.305, 0.305, 0.307, 0.305, 0.307, 0.308, 0.307, 0.31, 0.309, 0.307, 0.308, 0.314, 0.309, 0.307, 0.31, 0.311, 0.31, 0.312, 0.312, 0.314, 0.313, 0.315, 0.314, 0.314, 0.317, 0.314, 0.315, 0.319, 0.318, 0.317, 0.319, 0.317, 0.318, 0.317, 0.318, 0.318, 0.319, 0.319, 0.318, 0.319, 0.319, 0.319, 0.319, 0.319, 0.319, 0.319, 0.319, 0.319, 0.32, 0.318, 0.32, 0.32, 0.32, 0.32, 0.32, 0.32, 0.32, 0.32, 0.32, 0.321, 0.32, 0.32, 0.32, 0.322, 0.32, 0.32, 0.321, 0.32, 0.32, 0.321, 0.321, 0.321, 0.321, 0.321, 0.321, 0.322, 0.322, 0.323, 0.94, 2.25, 3.49, 4.28, 2.21, 0.72, 0.291, 47700.0, 102000.0, 102000.0, 102000.0, 102000.0, 102000.0, 102000.0, 102000.0, 3220.0]\n}\n\nconst pvdSectionSecond = {\n  name: 'Substrate 2',\n  process_time: [-2099, -2026, -1953, -1880, -1807, -1734, -1661, -1588, -1515, -1442, -1369, -1296, -1223, -1150, -1077, -1004, -931, -858, -785, -712, -639, -566, -493, -419, -346, -273, -200, -127, -54, 19, 92, 165, 238, 311, 384, 457, 530, 603, 676, 749, 822, 895, 968, 1041, 1114, 1187, 1260, 1333, 1406, 1479, 1552, 1625, 1698, 1771, 1844, 1917, 1990, 2063, 2136, 2209, 2282, 2355, 2428, 2501, 2574, 2647, 2720, 2793, 2866, 2939, 3012, 3085, 3158, 3231, 3304, 3377, 3450, 3523, 3596, 3669, 3742, 3815, 3888, 3961, 4034, 4107, 4180, 4253, 4326, 4399, 4472, 4545, 4618, 4691, 4764, 4837, 4910, 4983, 5056, 5129, 5202, 5275, 5348, 5421, 5494, 5567, 5640, 5713, 5786, 5859, 5932, 6005, 6078, 6151, 6225, 6298, 6371, 6444, 6517, 6590, 6663, 6736, 6809, 6882, 6955, 7028, 7101, 7174, 7247, 7320, 7393, 7466, 7539],\n  set_substrate_temperature: [309.356, 309.217, 309.084, 308.958, 308.838, 308.724, 308.616, 308.513, 308.415, 308.322, 308.233, 308.148, 308.068, 307.992, 307.919, 307.85, 307.784, 307.722, 307.662, 307.606, 307.552, 307.501, 307.452, 307.406, 307.362, 307.32, 307.28, 307.242, 307.206, 307.171, 307.139, 307.108, 307.078, 307.05, 307.023, 306.998, 306.974, 306.951, 306.929, 306.908, 306.888, 306.869, 306.851, 306.834, 306.818, 306.803, 306.788, 306.774, 306.761, 306.748, 306.736, 306.725, 306.714, 306.704, 306.694, 306.684, 306.676, 306.667, 306.659, 306.651, 306.644, 306.637, 306.631, 306.624, 306.618, 306.613, 306.607, 306.602, 306.597, 306.593, 306.588, 306.584, 306.58, 306.576, 306.573, 306.569, 306.566, 306.563, 306.56, 306.557, 306.554, 306.552, 306.549, 306.547, 306.545, 306.543, 306.541, 306.539, 306.537, 306.535, 306.534, 306.532, 306.531, 306.529, 306.528, 306.527, 306.525, 306.524, 306.523, 306.522, 306.521, 306.52, 306.519, 306.519, 306.518, 306.517, 306.516, 306.516, 306.515, 306.514, 306.514, 306.513, 306.513, 306.512, 306.512, 306.511, 306.511, 306.51, 306.51, 306.509, 306.509, 306.509, 306.508, 306.508, 306.508, 306.508, 306.507, 306.507, 306.507, 306.507, 306.506, 306.506, 306.506],\n  substrate_temperature: [366.6756, 366.6324, 366.6216, 366.6276, 366.6072, 366.6024, 366.6072, 366.618, 366.6756, 366.69, 366.7092, 366.7284, 366.7308, 366.7644, 366.8196, 366.8412, 366.888, 366.9456, 366.9756, 367.0452, 367.0956, 367.1724, 367.2036, 367.2912, 367.3716, 367.4148, 367.5204, 367.5852, 367.6488, 367.7436, 367.962, 368.2452, 368.5176, 368.7888, 369.0588, 369.3612, 369.636, 369.9168, 370.1988, 370.4736, 370.7652, 370.992, 371.2488, 371.52, 371.7348, 371.94, 372.192, 372.4008, 372.6012, 372.8016, 373.008, 373.1988, 373.374, 373.5636, 373.74, 373.896, 374.0508, 374.2224, 374.3892, 374.5116, 374.6916, 374.8032, 374.9568, 375.0828, 375.1968, 375.342, 375.4644, 375.5676, 375.7188, 375.8304, 375.924, 376.0428, 376.164, 376.2816, 376.3656, 376.4616, 377.3964, 380.5572, 380.304, 380.0832, 379.8732, 379.6668, 379.4448, 379.2252, 379.0236, 378.8304, 378.6624, 378.4908, 378.3408, 378.1488, 377.9808, 377.8212, 377.6628, 377.4996, 377.3592, 377.2056, 377.0712, 376.902, 376.7832, 376.62, 376.518, 376.3668, 376.2432, 376.128, 375.978, 375.8532, 375.7476, 375.6048, 375.48, 375.3612, 375.2604, 375.1608, 375.0636, 374.9616, 374.8452, 374.7084, 374.6064, 374.502, 374.4048, 374.3052, 374.1996, 374.1, 373.9896, 373.8996, 372.2856, 372.2256, 372.2448, 372.2496, 372.222, 371.5908, 371.3484, 371.4864, 371.5224],\n  chamber_pressure: [0.313, 0.328, 0.319, 0.313, 0.307, 0.306, 0.304, 0.303, 0.304, 0.303, 0.303, 0.303, 0.303, 0.303, 0.303, 0.303, 0.302, 0.303, 0.301, 0.303, 0.303, 0.302, 0.301, 0.303, 0.303, 0.303, 0.303, 0.304, 0.303, 0.303, 0.303, 0.304, 0.304, 0.304, 0.304, 0.305, 0.304, 0.305, 0.304, 0.305, 0.305, 0.307, 0.305, 0.307, 0.308, 0.307, 0.31, 0.309, 0.307, 0.308, 0.314, 0.309, 0.307, 0.31, 0.311, 0.31, 0.312, 0.312, 0.314, 0.313, 0.315, 0.314, 0.314, 0.317, 0.314, 0.315, 0.319, 0.318, 0.317, 0.319, 0.317, 0.318, 0.317, 0.318, 0.318, 0.319, 0.319, 0.318, 0.319, 0.319, 0.319, 0.319, 0.319, 0.319, 0.319, 0.319, 0.319, 0.32, 0.318, 0.32, 0.32, 0.32, 0.32, 0.32, 0.32, 0.32, 0.32, 0.32, 0.321, 0.32, 0.32, 0.32, 0.322, 0.32, 0.32, 0.321, 0.32, 0.32, 0.321, 0.321, 0.321, 0.321, 0.321, 0.321, 0.322, 0.322, 0.323, 0.94, 2.25, 3.49, 4.28, 2.21, 0.72, 0.291, 47700.0, 102000.0, 102000.0, 102000.0, 102000.0, 102000.0, 102000.0, 102000.0, 3220.0]\n}\n\nconst processSection = {\n  PVDEvaporation: [pvdSection, pvdSectionSecond]\n}\n\nfunction Example({code, children}) {\n  return (\n    <Box display=\"flex\" flexDirection=\"row\" alignItems=\"flext-start\" marginBottom={2}>\n      <Box width={500} marginRight={2}>\n        {children}\n      </Box>\n      <Code\n        code={stripIndent(code)}\n      />\n    </Box>\n  )\n}\nExample.propTypes = {\n  code: PropTypes.string,\n  children: PropTypes.any\n}\n\nconst pvdExamples = [{\n  plotly_graph_object: {\n    data: {\n      x: '#process_time',\n      y: '#./substrate_temperature'\n    },\n    layout: {title: {text: 'T Substrate'}},\n    config: {\n      editable: true,\n      scrollZoom: false\n    }\n  }\n}, {\n  plotly_graph_object: {\n    data: [\n      {\n        x: '#process_time',\n        y: '#./set_substrate_temperature',\n        mode: 'markers',\n        marker: {\n          color: '#./substrate_temperature'\n        }\n      },\n      {\n        x: '#process_time',\n        y: '#./substrate_temperature'\n      }\n    ],\n    layout: {title: {text: 'Temperature'}}\n  }\n}, {\n  plotly_graph_object: [{\n    data: [\n      {\n        x: '#process_time',\n        y: '#./substrate_temperature',\n        mode: 'markers',\n        marker: {\n          color: 'rgb(40, 80, 130)'\n        }\n      },\n      {\n        x: '#process_time',\n        y: '#./chamber_pressure',\n        mode: 'lines',\n        line: {\n          color: 'rgb(100, 0, 0)'\n        }\n      }\n    ],\n    layout: {title: {text: 'Temperature and Pressure'}}\n  }, {\n    data: {\n      x: '#process_time',\n      y: '#chamber_pressure'\n    },\n    layout: {\n      title: {text: 'T Substrate'},\n      xaxis: {title: 't (sec)'},\n      yaxis: {title: 'P (GPa)', type: 'log'}\n    }\n  }]\n}]\n\nconst processExamples = [\n  {\n    plotly_graph_object: {\n      data: {\n        x: '#PVDEvaporation/0/process_time',\n        y: '#PVDEvaporation/0/chamber_pressure'\n      },\n      layout: {title: {text: 'Chamber Pressure'}}\n    }\n  }, {\n    plotly_graph_object: {\n      data: {\n        x: '#PVDEvaporation/1/process_time',\n        y: '#PVDEvaporation/1/substrate_temperature'\n      },\n      layout: {title: {text: 'Substrate Temperature'}}\n    }\n  }, {\n    plotly_graph_object: {\n      data: [\n        {\n          x: '#PVDEvaporation/0/process_time',\n          y: '#PVDEvaporation/0/substrate_temperature'\n        },\n        {\n          x: '#PVDEvaporation/0/process_time',\n          y: '#PVDEvaporation/2/substrate_temperature'\n        }\n      ],\n      layout: {title: {text: 'Temperature'}}\n    }\n  }, {\n    plotly_graph_object: {\n      data: {\n        x: '#PVDEvaporation/:2/process_time',\n        y: '#PVDEvaporation/:2/substrate_temperature'\n      },\n      layout: {title: {text: 'Substrate Temperature'}}\n    }\n  }\n]\n\nfunction getSection(metainfo, packageName, sectionName) {\n  if (!metainfo) return undefined\n  const packages = metainfo?._data?.packages\n  const eln = packages?.find(section => section.name === packageName)\n  const section_definitions = eln?.section_definitions\n  return section_definitions?.find(section => section.name === sectionName)\n}\n\nexport function PlotExamples() {\n  const metainfo = useGlobalMetainfo()\n  const [plots, setPlots] = useState(pvdExamples.concat(processExamples))\n  const [keys, setKeys] = useState(pvdExamples.concat(processExamples).map((example, index) => `plot${index}-0`))\n\n  const pvdSectionDef = useMemo(() => ({\n    name: 'PVDEvaporation',\n    _allBaseSections: [\n      {\n        m_def: 'nomad.metainfo.metainfo.Section',\n        name: 'PlotSection'\n      }\n    ],\n    _properties: {\n      name: {\n        m_def: 'nomad.metainfo.metainfo.Quantity'\n      },\n      process_time: {\n        m_def: 'nomad.metainfo.metainfo.Quantity',\n        unit: 'second',\n        shape: ['*']\n      },\n      set_substrate_temperature: {\n        m_def: 'nomad.metainfo.metainfo.Quantity',\n        unit: 'kelvin',\n        shape: ['*']\n      },\n      substrate_temperature: {\n        m_def: 'nomad.metainfo.metainfo.Quantity',\n        unit: 'kelvin',\n        shape: ['*']\n      },\n      chamber_pressure: {\n        m_def: 'nomad.metainfo.metainfo.Quantity',\n        unit: 'pascal',\n        shape: ['*']\n      }\n    }\n  }), [])\n  const archiveSectionDef = useMemo(() => metainfo ? getSection(metainfo, 'nomad.datamodel.data', 'ArchiveSection') : undefined, [metainfo])\n\n  if (archiveSectionDef) {\n    archiveSectionDef['sub_section'] = {\n      m_def: 'nomad.metainfo.metainfo.Section',\n      _allBaseSections: [\n        {\n          m_def: 'nomad.metainfo.metainfo.Section',\n          name: 'PlotSection'\n        }\n      ],\n      _properties: {\n        PVDEvaporation: {\n          m_def: 'nomad.metainfo.metainfo.SubSection',\n          repeats: true,\n          sub_section: pvdSectionDef\n        }\n      }\n    }\n  }\n\n  const sections = useMemo(() => {\n    return plots.map((example, index) => {\n      const graphObject = example.plotly_graph_object\n      const examples = Array.isArray(graphObject) ? graphObject : [graphObject]\n      return index < pvdExamples.length\n          ? {sectionDef: pvdSectionDef, figures: examples.map((figure) => ({figure: figure}))}\n          : {sectionDef: archiveSectionDef, figures: examples.map((figure) => ({figure: figure}))}\n      }\n    )\n  }, [plots, pvdSectionDef, archiveSectionDef])\n\n  const handleJsonChange = useCallback((data, index) => {\n    const newPlots = [...plots]\n    newPlots[index] = data\n    setPlots(newPlots)\n    const newKeys = [...keys]\n    const [plotIndex, plotKey] = newKeys[index].split('-')\n    newKeys[index] = `${plotIndex}-${Number(plotKey) + 1}`\n    setKeys(newKeys)\n  }, [keys, plots])\n\n  return sections.map((section, index) => (\n    <Box key={index}>\n      {index === 0 && <Box margin={3} marginLeft={7}>\n        <Typography variant=\"h6\">\n          Examples to show how to plot simple and multiline graphs and how to customize the line styles\n        </Typography>\n      </Box>}\n      {index === pvdExamples.length && <Box margin={3} marginLeft={7}>\n        <Typography variant=\"h6\">\n          Examples to plot data from an array of section\n        </Typography>\n      </Box>}\n      {index === pvdExamples.length + 2 && <Box margin={3} marginLeft={7}>\n        <Typography variant=\"h6\">\n          Non instantiated subsections are ignored\n        </Typography>\n      </Box>}\n      {index === pvdExamples.length + 3 && <Box margin={3} marginLeft={7}>\n        <Typography variant=\"h6\">\n          Subsection index can use python slice notation\n        </Typography>\n      </Box>}\n      <Box display='flex' marginTop={3} width={'100%'} >\n        <Box width={'50%'} marginLeft={6} marginRight={6}>\n          <Card>\n            <CardContent>\n              <SectionPlots key={keys[index]} sectionDef={section.sectionDef} section={index < pvdExamples.length ? {...pvdSection, figures: section.figures} : {...processSection, figures: section.figures}}/>\n            </CardContent>\n          </Card>\n        </Box>\n        <Box width={'50%'} marginLeft={6} marginRight={6}>\n          <InputConfig\n            data={plots[index]}\n            onChange={data => handleJsonChange(data, index)}\n          />\n        </Box>\n      </Box>\n    </Box>\n  ))\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { Route } from 'react-router'\nimport { CacheRoute, CacheSwitch } from 'react-router-cache-route'\nimport { matchPath, useLocation, Redirect, useHistory, Link as RouterLink } from 'react-router-dom'\nimport { Button, Link, makeStyles, Tooltip } from '@material-ui/core'\nimport About from '../About'\nimport { MetainfoPage, help as metainfoHelp } from '../archive/MetainfoBrowser'\nimport EntryPage, { help as entryHelp } from '../entry/EntryPage'\nimport UploadsPage, { help as uploadsHelp } from '../uploads/UploadsPage'\nimport UserdataPage, { help as userdataHelp } from '../UserdataPage'\nimport APIs from '../APIs'\nimport SearchPage from '../search/SearchPage'\nimport { SearchContext } from '../search/SearchContext'\nimport NorthPage, {help as NORTHHelp} from '../north/NorthPage'\nimport { appBase, encyclopediaBase, ui, apps } from '../../config'\nimport EntryQuery from '../entry/EntryQuery'\nimport ResolvePID from '../entry/ResolvePID'\nimport DatasetPage, { help as datasetHelp } from '../dataset/DatasetPage'\nimport DatasetsPage, { help as datasetsHelp } from '../dataset/DatasetsPage'\nimport ResolveDOI from '../dataset/ResolveDOI'\nimport { DatatableExamples } from '../datatable/DatatableExamples'\nimport {EditQuantityExamples} from '../editQuantity/EditQuantityExamples'\nimport UploadPage from '../uploads/UploadPage'\nimport {PlotExamples} from '../archive/PlotExamples'\n\n/**\n * Each route is an object with possible nested sub routes. Therefore, each object only\n * represents one segment of a full path (from root to sub route). Of course sub routes\n * can be re-used by putting them into variables and inserting them at multiple places.\n * Sub routes are matched before there parents. This way, react routers `exact` parameter\n * can be mostly omitted.\n *\n * The following keys are possible:\n * @param {string} path The path segment for this route.\n * @param {array} routes The sub routes.\n * @param {string} breadcrumb An optional breadcrumb. The string is used verbatim.\n * @param {boolean} exact Is passed to react-router routes. Does not match paths that are longer.\n * @param {string} menu This is only allowed on the first two levels. The string is used\n *   verbatim to create menu and menu items respectively.\n * @param {string} tooltip Used as tooltip titles for menu items.\n * @param {object} help  Optional object with string values keys `title` and `help`.\n *   Used for the help dialog.\n * @param {Component} component A react component that will be rendered if this route is\n *   matching the current location. Alternative for render.\n * @param {func} render This is used if this route is matching the current location.\n *   Alternative for component.\n * @param {string} href This can be used for menu items that are not used for navigating\n *   in the app, but linking to other web sites.\n */\n\n/**\n * The reusable sub routes for entries.\n */\nconst entryRoutes = [\n  {\n    path: 'entry',\n    routes: [\n      {\n        path: 'id/:entryId',\n        breadcrumb: 'Entry',\n        component: EntryPage,\n        help: {\n          title: 'The entry page',\n          content: entryHelp\n        },\n        routes: [\n          {\n            path: 'files',\n            exact: true,\n            breadcrumb: 'Files'\n          },\n          {\n            path: 'data',\n            exact: true,\n            breadcrumb: 'Data'\n          },\n          {\n            path: 'logs',\n            exact: true,\n            breadcrumb: 'Logs'\n          }\n        ]\n      },\n      {\n        path: 'query',\n        exact: true,\n        component: EntryQuery\n      },\n      {\n        path: 'pid',\n        component: ResolvePID\n      }\n    ]\n  }\n]\n\n/**\n * The reusable sub routes for datasets\n */\nconst datasetRoutes = [\n  {\n    path: 'dataset',\n    routes: [\n      {\n        path: 'id/:datasetId',\n        cache: 'always',\n        breadcrumb: 'Dataset',\n        component: DatasetPage,\n        routes: entryRoutes,\n        help: {\n          title: 'Datasets',\n          content: datasetHelp\n        }\n      },\n      {\n        path: 'doi',\n        component: ResolveDOI\n      }\n    ]\n  }\n]\n\n/**\n * The reusable sub routes for uploads\n */\nconst uploadRoutes = [\n  {\n    path: 'upload',\n    routes: [\n      {\n        path: 'id/:uploadId',\n        breadcrumb: 'Upload',\n        component: UploadPage,\n        routes: [\n          {\n            path: 'files',\n            exact: true,\n            breadcrumb: 'Files'\n          },\n          ...entryRoutes\n        ]\n      }\n    ]\n  }\n]\n\nconst searchRoutes = apps\n  .map((context) => {\n    const routeMap = {\n      entries: entryRoutes\n    }\n    return {\n      path: context.path,\n      exact: true,\n      cache: 'always',\n      menu: context.label,\n      tooltip: context.description,\n      breadcrumb: context.breadcrumb || context.label,\n      category: context.category,\n      render: (props) => (\n        <SearchContext\n          resource={context.resource}\n          initialPagination={context.pagination}\n          initialColumns={context.columns}\n          initialRows={context.rows}\n          initialFilterMenus={context.filter_menus}\n          initialFilters={context?.filters}\n          initialFiltersLocked={context.filters_locked}\n          initialDashboard={context?.dashboard}\n          initialSearchSyntaxes={context?.search_syntaxes}\n          id={context?.path}\n        >\n          <SearchPage/>\n        </SearchContext>\n      ),\n      help: {\n        title: 'About this page',\n        content: context.readme || context.description\n      },\n      routes: routeMap[context.resource]\n    }\n  })\n\n/**\n * The list with all routes. This is used to determine the routes for routing, the breadcrumbs,\n * and the main menu.\n */\nexport const routes = [\n  {\n    path: 'user',\n    exact: true,\n    redirect: '/user/uploads',\n    menu: 'Publish',\n    routes: [\n      {\n        path: 'uploads',\n        exact: true,\n        component: UploadsPage,\n        menu: 'Uploads',\n        tooltip: 'Upload and publish new data',\n        breadcrumb: 'Your uploads',\n        routes: uploadRoutes,\n        help: {\n          title: 'How to upload data to NOMAD',\n          content: uploadsHelp\n        }\n      },\n      {\n        path: 'datasets',\n        exact: true,\n        component: DatasetsPage,\n        menu: 'Datasets',\n        tooltip: 'Manage your datasets',\n        breadcrumb: 'Your datasets',\n        routes: datasetRoutes,\n        help: {\n          title: 'What are NOMAD datasets',\n          content: datasetsHelp\n        }\n      },\n      {\n        path: 'search',\n        exact: true,\n        cache: 'always',\n        menu: 'Search your data',\n        breadcrumb: 'Search your data',\n        tooltip: 'Search the data you have uploaded',\n        help: {\n          title: 'How to manage your data',\n          content: userdataHelp\n        },\n        component: UserdataPage,\n        routes: [...entryRoutes, ...datasetRoutes, ...uploadRoutes]\n      }\n    ]\n  },\n  {\n    path: 'search',\n    redirect: '/search/entries',\n    menu: 'Explore',\n    routes: searchRoutes\n  },\n  {\n    path: 'analyze',\n    menu: 'Analyze',\n    routes: [\n      {\n        path: 'apis',\n        exact: true,\n        menu: 'APIs',\n        tooltip: 'The list of APIs offered by NOMAD',\n        breadcrumb: 'NOMAD APIs',\n        component: APIs\n      },\n      {\n        path: 'metainfo',\n        menu: 'The NOMAD Metainfo',\n        tooltip: 'Browse the NOMAD Metainfo Schema',\n        breadcrumb: 'NOMAD Metainfo Browser',\n        help: {\n          title: 'About the NOMAD metainfo',\n          content: metainfoHelp\n        },\n        component: MetainfoPage\n      },\n      ...(ui?.north?.enabled ? [\n        {\n          path: 'north',\n          menu: 'NOMAD Remote Tools Hub',\n          tooltip: 'Browse the list of available remote tools.',\n          breadcrumb: 'NOMAD Remote Tools Hub',\n          help: {\n            title: 'NOMAD Remote Tools help page',\n            content: NORTHHelp\n          },\n          component: NorthPage\n        }\n      ] : [])\n    ]\n  },\n  {\n    path: 'about',\n    menu: 'About',\n    redirect: '/about/information',\n    routes: [\n      {\n        path: 'information',\n        exact: true,\n        menu: 'Information',\n        component: About,\n        breadcrumb: 'About NOMAD',\n        tooltip: 'Overview of the NOMAD'\n      },\n      {\n        menu: 'Forum',\n        href: 'https://matsci.org/c/nomad/',\n        tooltip: 'The NOMAD user/developer forum on matsci.org'\n      },\n      {\n        menu: 'FAQ',\n        href: 'https://nomad-lab.eu/repository-archive-faqs',\n        tooltip: 'Frequently Asked Questions (FAQ)'\n      },\n      {\n        menu: 'Docs',\n        href: `${appBase}/docs/index.html`,\n        tooltip: 'The full user and developer documentation'\n      },\n      {\n        menu: 'Sources',\n        href: 'https://gitlab.mpcdf.mpg.de/nomad-lab/nomad-FAIR',\n        tooltip: 'NOMAD\\'s main Gitlab project'\n      },\n      {\n        menu: 'Terms',\n        consent: true,\n        tooltip: 'The terms of service',\n        href: 'https://nomad-lab.eu/nomad-lab/terms.html'\n      }\n    ]\n  },\n  ...datasetRoutes,\n  ...entryRoutes,\n  ...uploadRoutes,\n  {\n    path: 'dev/datatable',\n    render: () => <DatatableExamples />\n  },\n  {\n    path: 'dev/editquantity',\n    render: () => <EditQuantityExamples />\n  },\n  {\n    path: 'dev/plot',\n    render: () => <PlotExamples />\n  }\n]\n\n/**\n * The flattened array of all possible routs with paths starting the the root of the\n * app.\n */\nexport const allRoutes = []\n\nfunction addRoute(route, pathPrefix) {\n  let path = ''\n  if (!(route.path === '' && pathPrefix === '')) {\n    path = route.path && `${pathPrefix}/${route.path}`\n  }\n  if (route.routes) {\n    route.routes.forEach(childRoute => addRoute(childRoute, path))\n  }\n  const fullRoute = {...route, path: path}\n  allRoutes.push(fullRoute)\n}\nroutes.forEach(route => addRoute(route, ''))\n\n/**\n * Renders all the apps routes according to `routes`.\n */\nconst useStyles = makeStyles((theme) => (\n  {\n    wrapper: {\n      height: '100%'\n    }\n  }\n))\nexport const Routes = React.memo(function Routes() {\n  const styles = useStyles()\n  return <CacheSwitch>\n    {allRoutes\n      .filter(route => route.path && (route.component || route.render || route.redirect || route.children))\n      .map((route, i) => {\n        if (route.redirect) {\n          return <Redirect\n            key={i}\n            path={route.path} exact={route.exact}\n            to={route.redirect}\n          />\n        }\n        const Comp = route.cache ? CacheRoute : Route\n        return <Comp\n          key={i}\n          path={route.path}\n          exact={route.exact}\n          component={route.component}\n          render={route.render}\n          when={route.cache}\n          unmount={false}\n          saveScrollPosition={false}\n          className={route.cache && styles.wrapper}\n        >\n          {route.children || undefined}\n        </Comp>\n      })}\n    <Redirect from=\"/\" to=\"/about/information\" />\n  </CacheSwitch>\n})\n\n/**\n * Some routes are available under different prefix routes. E.g., entries under search,\n * uploads, or datasets. This function computes a full url for such a route, based on\n * the given location. E.g., if location is `/search/entries/...`, getUrl for entries\n * would give `/search/entries/entry/id/someuploadid/someentryid`. If the current location\n * does not contain a possible prefix, the url will be returned without prefix.\n *\n * @param {*} path The partial path that should be the end of the returned url.\n * @param {*} location The current react-router location object, e.g. from `useLocation()`.\n * @returns The full url. E.g., that can be put into react-router `<Link to={...}>`.\n */\nexport function getUrl(path, location) {\n  const commonPathPrefix = path.split('/')[0]\n  const pathname = typeof location === 'string' ? location : location?.pathname\n  const match = pathname && allRoutes\n    .filter(route => route.routes?.some(route => route.path === commonPathPrefix))\n    .map(route => matchPath(pathname, route.path)).find(match => match)\n  const url = match?.url || ''\n\n  return `${url}/${path}`\n}\n\nexport const RouteLink = React.forwardRef((props, ref) => {\n  const {path, children, ...moreProps} = props\n  const location = useLocation()\n  const to = getUrl(path, location)\n  return <Link component={RouterLink} to={to} {...moreProps}>{children}</Link>\n})\nRouteLink.propTypes = {\n  path: PropTypes.string.isRequired,\n  children: PropTypes.node\n}\n\nexport const RouteButton = React.forwardRef((props, ref) => {\n  const {component, onClick, path, ...moreProps} = props\n  const location = useLocation()\n  const history = useHistory()\n  const handleClick = (event) => {\n    event.stopPropagation()\n    onClick && onClick(event)\n    history.push(getUrl(path, location))\n  }\n  return React.createElement(component || Button, {onClick: handleClick, ...moreProps, ref: ref})\n})\nRouteButton.propTypes = {\n  path: PropTypes.string.isRequired,\n  onClick: PropTypes.func,\n  component: PropTypes.elementType\n}\n\n/**\n * A button that allows to navigate to the entry page under the current route prefix.\n * @param {string} uploadId\n * @param {string} entryId\n * @param {elementType} component The component to use to render the button. Default is Button.\n */\nexport const EntryButton = React.forwardRef((props, ref) => {\n  const {entryId, ...moreProps} = props\n  const path = `entry/id/${entryId}`\n  return <RouteButton path={path} {...moreProps} ref={ref} />\n})\nEntryButton.propTypes = {\n  entryId: PropTypes.string.isRequired\n}\n\n/**\n * A button that allows to navigate to the entry page's archive view under the current route prefix.\n * @param {string} uploadId\n * @param {string} entryId\n * @param {string} path\n * @param {elementType} component The component to use to render the button. Default is Button.\n */\nexport const ArchiveButton = React.forwardRef((props, ref) => {\n  const {uploadId, entryId, path, ...moreProps} = props\n  const routePath = `entry/id/${entryId}/data/${path}`\n  return <RouteButton path={routePath} {...moreProps} ref={ref} />\n})\nArchiveButton.propTypes = {\n  uploadId: PropTypes.string.isRequired,\n  entryId: PropTypes.string.isRequired,\n  path: PropTypes.string\n}\n\n/**\n * A button that allows to navigate to the dataset page under the current route prefix.\n * @param {string} datasetId\n * @param {elementType} component The component to use to render the button. Default is Button.\n */\nexport const DatasetButton = React.forwardRef((props, ref) => {\n  const {datasetId, ...moreProps} = props\n  const path = `dataset/id/${datasetId}`\n  return <RouteButton path={path} {...moreProps} ref={ref} />\n})\nDatasetButton.propTypes = {\n  datasetId: PropTypes.string.isRequired\n}\n\n/**\n * A button that allows to navigate to the upload page under the current route prefix.\n * @param {string} uploadId\n * @param {elementType} component The component to use to render the button. Default is Button.\n */\nexport const UploadButton = React.forwardRef((props, ref) => {\n  const {uploadId, ...moreProps} = props\n  const path = `upload/id/${uploadId}`\n  return <RouteButton path={path} {...moreProps} ref={ref} />\n})\nUploadButton.propTypes = {\n  uploadId: PropTypes.string.isRequired\n}\n\n/**\n * A link that allows to navigate to the material page (currently an external link).\n * @param {string} materialId\n */\nexport const MaterialLink = React.forwardRef(({materialId, ...rest}, ref) => {\n  const href = `${encyclopediaBase}/material/${materialId}`\n  return <Link href={href} {...rest} />\n})\n\nMaterialLink.propTypes = {\n  materialId: PropTypes.string.isRequired\n}\n\n/**\n * A button that allows to navigate to the material page (currently an external link).\n * @param {string} materialId\n * @param {elementType} component The component to use to render the button. Default is Button.\n */\nexport const MaterialButton = React.forwardRef(({materialId, component, tooltip, ...rest}, ref) => {\n  const href = `${encyclopediaBase}/material/${materialId}`\n  const props = component\n    ? {href: href, ...rest}\n    : {href: href, color: 'primary', ...rest}\n  const comp = React.createElement(component || Button, {...props, ref})\n\n  // The portal is disabled for this tooltip because this button causes a\n  // navigation that otherwise leaves the popup opened (the Tooltip state does\n  // not get updated since the page is cached and a new page is shown\n  // immediately).\n  if (tooltip) {\n    return <Tooltip title={tooltip} PopperProps={{disablePortal: true}}>\n      {comp}\n    </Tooltip>\n  }\n  return comp\n})\n\nMaterialButton.propTypes = {\n  materialId: PropTypes.string.isRequired,\n  component: PropTypes.elementType,\n  tooltip: PropTypes.string\n}\nMaterialButton.defaultProps = {\n  tooltip: 'View this material in the Encyclopedia'\n}\n\nexport default Routes\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React, { useRef } from 'react'\nimport { Tab, Tabs } from '@material-ui/core'\nimport { trimEnd } from 'lodash'\nimport { useRouteMatch, useHistory, matchPath, Redirect } from 'react-router-dom'\nimport { CacheRoute, CacheSwitch } from 'react-router-cache-route'\nimport UploadOverview from './UploadOverview'\nimport UploadFilesView from './UploadFilesView'\nimport UploadPageContext from './UploadPageContext'\nimport UploadProcessingStatus from './UploadProcessingStatus'\nimport PropTypes from 'prop-types'\n\nconst UploadPage = React.memo((props) => {\n  const history = useHistory()\n  const { uploadId: propsUploadId } = props\n  const currentPath = history.location.pathname\n  const {path, url} = useRouteMatch()\n  const urlNoSlash = trimEnd(url, '/')\n  const match = matchPath(currentPath, { path: `${path}/:tab?` })\n  const {params: {tab = 'overview'}} = match\n  const uploadId = propsUploadId || match?.params?.uploadId\n\n  // We use a useRef object to keep track of the current urls of each tab. Switching\n  // tabs would go to the previous tab url. This way, the views behind a tab can add\n  // state to the URL (e.g. path to section on the ArchiveEntryView).\n  const urls = useRef({\n    'overview': `${urlNoSlash}/overview`,\n    'files': `${urlNoSlash}/files`\n  })\n\n  const handleChange = (_, value) => {\n    urls.current[tab] = currentPath\n    history.push(urls.current[value])\n  }\n  // TODO I removed the UploadOverview view from the cache, because\n  // processing in the UploadFile (Browser) view do not update the\n  // upload context and do not refresh the UploadOverview data,\n  // Test\n  return <UploadPageContext uploadId={uploadId}>\n    <UploadProcessingStatus />\n    <Tabs\n      value={tab}\n      onChange={handleChange}\n      indicatorColor=\"primary\"\n      textColor=\"primary\"\n      variant=\"fullWidth\"\n    >\n      <Tab label=\"Overview\" value=\"overview\" />\n      <Tab label=\"Files\" value=\"files\" />\n    </Tabs>\n    {tab === 'overview' && (\n      <UploadOverview/>\n    )}\n    <CacheSwitch>\n      <CacheRoute when=\"always\" path={`${path}/files`} render={() => <UploadFilesView />} />\n      <Redirect strict from={`${path}/overview`} to={`${path}`} />\n    </CacheSwitch>\n  </UploadPageContext>\n})\nUploadPage.propTypes = {\n  uploadId: PropTypes.string\n}\n\nexport default UploadPage\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react'\nimport { MenuBar } from './MenuBar'\nimport { routes } from './Routes'\nimport MenuBarRoute from './MenuBarRoute'\n\nconst MainMenu = React.memo(() => {\n   return <MenuBar>{routes.map((menu) => <MenuBarRoute key={menu.path} label={menu.menu} menu={menu} />)}</MenuBar>\n})\n\nexport default MainMenu\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useCallback, useMemo } from 'react'\nimport { matchPath, useLocation, Link as RouterLink } from 'react-router-dom'\nimport { Typography, Breadcrumbs as MUIBreadcrumbs, Link, Box, makeStyles, Tooltip } from '@material-ui/core'\nimport { HelpButton } from '../Help'\nimport { allRoutes } from './Routes'\nimport {useDataStore} from \"../DataStore\"\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    marginLeft: 5,\n    marginTop: theme.spacing(-0.25)\n  },\n  help: {\n    marginLeft: theme.spacing(0.5)\n  },\n  ellipsis: {\n    direction: 'rtl',\n    textAlign: 'left',\n    whiteSpace: 'nowrap',\n    overflow: 'hidden',\n    textOverflow: 'ellipsis',\n    maxWidth: 350\n  }\n}))\n\nconst Breadcrumbs = React.memo(function Breadcrumbs() {\n  const styles = useStyles()\n  const dataStore = useDataStore()\n  const {pathname} = useLocation()\n  const routes = useMemo(() => allRoutes.slice().reverse(), [])\n\n  const getRef = useCallback((breadcrumb) => {\n    if (breadcrumb === 'Entry') {\n      return dataStore.breadcrumb.entryRef\n    } else if (breadcrumb === 'Upload') {\n      return dataStore.breadcrumb.uploadRef\n    } else {\n      return undefined\n    }\n  }, [dataStore.breadcrumb.entryRef, dataStore.breadcrumb.uploadRef])\n\n  const getFinalBreadcrumb = useCallback((breadcrumb) => {\n    if (breadcrumb === 'Entry') {\n      return dataStore.breadcrumb.getEntry()\n    } else if (breadcrumb === 'Upload') {\n      return dataStore.breadcrumb.getUpload()\n    } else {\n      return breadcrumb\n    }\n  }, [dataStore.breadcrumb])\n\n  return <MUIBreadcrumbs className={styles.root}>\n    {routes\n      .filter(route => route.breadcrumb && route.path)\n      .map(route => ({route: route, match: matchPath(pathname, {path: route.path})}))\n      .filter(({match}) => match)\n      .map(({route, match}, i) => {\n        const title = <Typography\n          className={styles.ellipsis}\n          variant={i ? undefined : 'h6'}\n          color=\"textPrimary\"\n          ref={getRef(route.breadcrumb)}\n        >\n          {getFinalBreadcrumb(route.breadcrumb)}\n        </Typography>\n        if (match.url === pathname) {\n          return <Box key={i} display=\"flex\" flexDirection=\"row\" alignItems=\"center\">\n            {title}\n            {route.help && (\n              <Tooltip title={route?.help?.title || \"\"}>\n                <HelpButton className={styles.help} size=\"small\" IconProps={{fontSize: 'small'}} heading={route?.help?.title} content={route?.help?.content} />\n              </Tooltip>\n            )}\n          </Box>\n        } else {\n          return <Link key={i} component={RouterLink} to={match.url}>{title}</Link>\n        }\n      })}\n  </MUIBreadcrumbs>\n})\n\nexport default Breadcrumbs\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport {\n  AppBar as MuiAppBar,\n  Toolbar,\n  Link,\n  LinearProgress,\n  makeStyles\n} from '@material-ui/core'\nimport LoginLogout from '../LoginLogout'\nimport UnitMenu from '../units/UnitMenu'\nimport MainMenu from './MainMenu'\nimport { useLoading } from '../api'\nimport { guiBase, oasis } from '../../config'\nimport Breadcrumbs from './Breadcrumbs'\n\nexport const appBarHeight = 10\n\n/**\n * Linear indefinite loading indicator that is connceted to API traffic.\n */\nfunction LoadingIndicator({className}) {\n  const loading = useLoading()\n  return loading && <LinearProgress className={className} color=\"primary\" />\n}\n\nLoadingIndicator.propTypes = {\n  className: PropTypes.string\n}\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    zIndex: theme.zIndex.drawer + 1,\n    backgroundColor: 'white',\n    display: 'flex',\n    flexDirection: 'column',\n    padding: theme.spacing(1),\n    height: theme.spacing(appBarHeight)\n  },\n  logo: {\n    display: 'flex',\n    alignItems: 'center',\n    alignContent: 'flex-start',\n    color: theme.palette.primary.main\n  },\n  toolbar: {\n    display: 'flex',\n    flexDirection: 'row'\n  },\n  logoImg: {\n    height: 44,\n    marginLeft: theme.spacing(1),\n    marginRight: theme.spacing(2),\n    marginTop: theme.spacing(1)\n  },\n  actions: {\n    display: 'flex',\n    flexDirection: 'row',\n    alignItems: 'flex-end',\n    justifyContent: 'space-evenly'\n  },\n  menuItem: {\n    borderColor: theme.palette.getContrastText(theme.palette.primary.main),\n    marginRight: 0,\n    minWidth: '6rem',\n    justifyContent: 'flex-start'\n  },\n  navigation: {\n    flexGrow: 1,\n    marginRight: theme.spacing(1),\n    display: 'flex',\n    flexDirection: 'column',\n    alignItems: 'flex-start',\n    justifyContent: 'space-evenly'\n  },\n  progress: {\n    position: 'absolute',\n    bottom: 0,\n    left: 0,\n    right: 0\n  },\n  crumbs: {\n    padding: '9px 0px 9px 5px'\n  }\n}))\n\n/**\n * The App bar that is always shown at the top of the screen.\n */\nexport default function AppBar() {\n  const styles = useStyles()\n\n  return <MuiAppBar position=\"fixed\" className={styles.root}>\n    <Toolbar className={styles.toolbar} disableGutters>\n      <div className={styles.logo}>\n        <Link href={guiBase}>\n          <img alt=\"The NOMAD logo\" className={styles.logoImg} src={`${guiBase}/${oasis ? 'nomad-oasis.png' : 'nomad.png'}`}></img>\n        </Link>\n      </div>\n      <div className={styles.navigation}>\n        <MainMenu />\n        <Breadcrumbs className={styles.crumbs}/>\n      </div>\n      <div className={styles.actions}>\n        <LoginLogout color=\"primary\" classes={{button: styles.menuItem}} />\n        <UnitMenu className={styles.menuItem} />\n      </div>\n    </Toolbar>\n    <LoadingIndicator className={styles.progress}/>\n  </MuiAppBar>\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport React, { useEffect, useMemo, useRef, useState } from 'react'\nimport { makeStyles } from '@material-ui/core/styles'\nimport { useLocation } from 'react-router-dom'\nimport { Snackbar, SnackbarContent, IconButton, Link as MuiLink, Link } from '@material-ui/core'\nimport UnderstoodIcon from '@material-ui/icons/Check'\nimport { amber } from '@material-ui/core/colors'\nimport AppBar, { appBarHeight } from './AppBar'\nimport { guiBase, version } from '../../config'\nimport { Routes } from './Routes'\nimport { ErrorBoundary } from '../errors'\nimport { useCookies } from 'react-cookie'\n\nexport const ScrollContext = React.createContext({scrollParentRef: null})\n\nconst useTermsSnackStyles = makeStyles(theme => ({\n  termsLink: {\n    color: theme.palette.primary.light\n  }\n}))\n\nfunction TermsSnack() {\n  const [cookies, setCookie] = useCookies()\n  const [accepted, setAccepted] = useState(cookies['terms-accepted'])\n  const classes = useTermsSnackStyles()\n\n  const cookieOptions = useMemo(() => ({\n    expires: new Date(2147483647 * 1000),\n    path: '/' + guiBase.split('/').slice(1).join('/')\n  }), [])\n\n  return <Snackbar\n    anchorOrigin={{\n      vertical: 'bottom',\n      horizontal: 'left'\n    }}\n    open={!accepted}\n  >\n    <SnackbarContent\n      message={<span>\n        NOMAD only uses cookies that are strictly necessary for this site&apos;s functionality.\n        No tracking or marketing cookies are used. By using this site you agree to\n        our <Link className={classes.termsLink} href=\"https://nomad-lab.eu/nomad-lab/terms.html\" title=\"terms of service\">terms of service</Link>.\n      </span>}\n      action={[\n        <IconButton\n          size=\"small\" key={0} color=\"inherit\"\n          onClick={() => {\n            setCookie('terms-accepted', true, cookieOptions)\n            setAccepted(true)\n          }}\n        >\n          <UnderstoodIcon />\n        </IconButton>\n      ]}\n    />\n  </Snackbar>\n}\n\nconst useBetaSnackStyles = makeStyles(theme => ({\n  root: {},\n  snack: {\n    backgroundColor: amber[700]\n  }\n}))\nfunction BetaSnack() {\n  const classes = useBetaSnackStyles()\n  const [understood, setUnderstood] = useState(false)\n\n  if (!version) {\n    console.warn('no version data available')\n    return null\n  }\n\n  if (!version.isBeta && !version.isTest) {\n    return null\n  }\n\n  return <Snackbar className={classes.root}\n    anchorOrigin={{\n      vertical: 'bottom',\n      horizontal: 'left'\n    }}\n    open={!understood}\n  >\n    <SnackbarContent\n      className={classes.snack}\n      message={<span style={{color: 'white'}}>\n       You are using a {version.isBeta ? 'beta' : 'test'} version of NOMAD ({version.label}). {\n          version.usesBetaData ? 'This version is not using the official data. Everything you upload here, might get lost.' : ''\n        } Click <MuiLink style={{color: 'white'}} href={version.officialUrl}>here for the official NOMAD version</MuiLink>.\n      </span>}\n      action={[\n        <IconButton size=\"small\" key={0} color=\"inherit\" onClick={() => setUnderstood(true)}>\n          <UnderstoodIcon />\n        </IconButton>\n      ]}\n    />\n  </Snackbar>\n}\n\nconst useStyles = makeStyles(theme => ({\n  root: {\n    minWidth: 1024\n  },\n  appFrame: {\n    zIndex: 1,\n    overflow: 'hidden',\n    position: 'relative',\n    display: 'flex',\n    width: '100%',\n    height: '100vh'\n  },\n  content: {\n    marginTop: theme.spacing(appBarHeight),\n    flexGrow: 1,\n    backgroundColor: theme.palette.background.default,\n    width: '100%',\n    overflow: 'auto'\n  }\n}))\n\nexport default function Navigation() {\n  const classes = useStyles()\n  const { pathname } = useLocation()\n  const scrollParentRef = useRef(null)\n\n  // Scroll to top upon changing page\n  useEffect(() => {\n    if (scrollParentRef.current) {\n      scrollParentRef.current.scrollTo(0, 0)\n    }\n  }, [pathname])\n\n  return (\n    <div className={classes.root}>\n      <div className={classes.appFrame}>\n        <ErrorBoundary>\n          <BetaSnack />\n          <TermsSnack />\n          <AppBar />\n          <main className={classes.content} ref={scrollParentRef}>\n            <ScrollContext.Provider value={{scrollParentRef: scrollParentRef}}>\n              <Routes/>\n            </ScrollContext.Provider>\n          </main>\n        </ErrorBoundary>\n      </div>\n    </div>\n  )\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport React from 'react'\nimport { Helmet } from \"react-helmet\"\nimport { Router, Route } from 'react-router-dom'\nimport { QueryParamProvider } from 'use-query-params'\nimport { RecoilRoot } from 'recoil'\nimport CssBaseline from '@material-ui/core/CssBaseline'\nimport history from '../history'\nimport DateFnsUtils from '@date-io/date-fns'\nimport { MuiPickersUtilsProvider } from '@material-ui/pickers'\nimport { ui, nomadTheme, keycloakBase, keycloakRealm, keycloakClientId } from '../config'\nimport Keycloak from 'keycloak-js'\nimport { ReactKeycloakProvider } from '@react-keycloak/web'\nimport { MuiThemeProvider } from '@material-ui/core/styles'\nimport { ErrorSnacks, ErrorBoundary } from './errors'\nimport Navigation from './nav/Navigation'\nimport GUIMenu from './GUIMenu'\nimport { APIProvider, GlobalLoginRequired, onKeycloakEvent } from './api'\nimport DataStore from './DataStore'\nimport { UnitProvider } from './units/UnitContext'\nimport { GlobalMetainfo } from './archive/metainfo'\n\nconst keycloak = new Keycloak({\n  url: keycloakBase,\n  realm: keycloakRealm,\n  clientId: keycloakClientId\n})\n\nexport default function App() {\n  return <React.Fragment>\n    <Helmet>\n      <title>{ui?.theme?.title || 'NOMAD'}</title>\n    </Helmet>\n    <ReactKeycloakProvider\n      authClient={keycloak}\n      onEvent={onKeycloakEvent(keycloak)}\n      initOptions={{ onLoad: 'check-sso', 'checkLoginIframe': false, promiseType: 'native' }}\n      LoadingComponent={<div />}\n    >\n      <RecoilRoot>\n        <APIProvider>\n          <MuiPickersUtilsProvider utils={DateFnsUtils}>\n            <ErrorSnacks>\n              <ErrorBoundary>\n                <UnitProvider\n                  initialUnitSystems={ui?.unit_systems?.options}\n                  initialSelected={ui?.unit_systems?.selected}\n                  >\n                  <DataStore>\n                    <GlobalMetainfo>\n                      <Router history={history}>\n                        <QueryParamProvider ReactRouterRoute={Route}>\n                          <MuiThemeProvider theme={nomadTheme}>\n                            <CssBaseline />\n                            <GlobalLoginRequired>\n                              <Navigation />\n                              <GUIMenu/>\n                            </GlobalLoginRequired>\n                          </MuiThemeProvider>\n                        </QueryParamProvider>\n                      </Router>\n                    </GlobalMetainfo>\n                  </DataStore>\n                </UnitProvider>\n              </ErrorBoundary>\n            </ErrorSnacks>\n          </MuiPickersUtilsProvider>\n        </APIProvider>\n      </RecoilRoot>\n    </ReactKeycloakProvider>\n  </React.Fragment>\n}\n","/*\n * Copyright The NOMAD Authors.\n *\n * This file is part of NOMAD. See https://nomad-lab.eu for further info.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport './index.css'\nimport '@fontsource/titillium-web/400.css'\nimport '@fontsource/titillium-web/600.css'\nimport './wdyr'\nimport 'react-app-polyfill/ie11'\nimport 'react-app-polyfill/stable'\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport '../node_modules/react-grid-layout/css/styles.css'\nimport '../node_modules/react-resizable/css/styles.css'\nimport App from './components/App'\nimport '@fontsource/material-icons'\n\nReactDOM.render(<App />, document.getElementById('root'))\n","'use strict';\n\nvar tokens = require('./tokens.js');\n\n/** Represents a single value (string or numerical) in a CIF file.\n *  @class\n *  @param  {string}    type      Type of the value (int, float, string, mstring,\n *                                N/A or ?)\n *  @param  {*}         pvalue]   Parsed value itself (should be appropriate to\n *                                type, unnecessary for N/A and ?)\n *  @param  {int}       [prec]    Precision number (only for numerals)\n */\nvar CifValue = function(type, value, prec) {\n    /** @member {string} */\n    this.type = type;\n    /** @member {int} */\n    this.prec = prec;\n\n    switch (type) {\n        case 'int':\n        case 'float':\n            /** @member {number} */\n            this.num = value;\n            break;\n        case 'string':\n        case 'mstring':\n            /** @member {string} */\n            this.text = value;\n            break;\n        default:\n            break;\n    }\n}\n\nCifValue.prototype = {\n    get_value: function() {\n        return (this.num !== undefined) ? this.num : this.text; // Universal function\n    }\n}\n\n\n/** Formats an error message including line number \n *  @param {string} msg    Error message\n *  @param {int}    line   Line number\n */\nfunction errormsg(msg, line) {\n    return new Error(\"ERROR @ line \" + line + \": \" + msg);\n}\n\n\n/**\n *  Split a text CIF file into elementary tokens for further processing.\n *  @param  {string} cif    CIF file in text string format\n *  @return {Array}         Array of parsed tokens\n */\nfunction tokenize(cif) {\n    /* Split into tokens (separated by non-blank characters except for the\n       quoted strings and semicolon text )\n    */\n\n    // Grab a bunch of regular expressions\n    var eol_re = tokens.tokenRegex('end_of_line', false, false);\n    var all_re = [tokens.tokenRegex('whitespace', false, false),\n        tokens.tokenRegex('quotestring', true),\n        tokens.tokenRegex('semicolontext', true),\n        tokens.tokenRegex('tag', true),\n        tokens.tokenRegex('data_header', true),\n        tokens.tokenRegex('loop_kw', true)\n    ];\n    // Now create fake matches for each of them\n    var all_m = [];\n    for (var i = 0; i < all_re.length; ++i) {\n        all_m.push({ 'index': -1 });\n    }\n\n    var tokenized = [];\n\n    var line_index = 1;\n    var cifsl = cif.slice();\n    while (cifsl.length > 0) {\n\n        var slice_i = 0;\n\n        // First, try to see if it's any of the various non-whitespace types\n        var m_type = 1;\n        var m = null;\n        for (; m_type < all_re.length; ++m_type) {\n            m = cifsl.match(all_re[m_type]);\n            if (m)\n                break;\n        }\n        if (m) {\n            tokenized.push({\n                'val': m[0],\n                'type': ['quotestring', 'semicolontext', 'tag',\n                    'data_headers', 'loop_kw'\n                ][m_type - 1],\n                'line': line_index\n            });\n            slice_i = m[0].length;\n            // cifsl = cifsl.slice(m[0].length);\n        }\n\n        else {\n            // Now check for whitespace\n            all_re[0].lastIndex = 0;\n            var w = all_re[0].exec(cifsl);\n            if (w) {\n                if (w.index == 0) {\n                    // Trim\n                    slice_i = w[0].length;\n                    // cifsl = cifsl.slice(w[0].length);\n                } else {\n                    // Capture an unknown\n                    // A regular value/string\n                    tokenized.push({\n                        'val': cifsl.slice(0, w.index),\n                        'type': 'unknown',\n                        'line': line_index\n                    });\n                    slice_i = w.index + w[0].length;\n                    // cifsl = cifsl.slice(w.index + w[0].length);\n                }\n            }\n            else {\n                // Ran out of string to parse\n                if (cifsl.length > 0) {\n                    tokenized.push({\n                        'val': cifsl,\n                        'type': 'unknown',\n                        'line': line_index\n                    });\n                    slice_i = cifsl.length;\n                }                \n            }\n        }\n\n        // Slice out the next part\n        var parsed = cifsl.slice(0, slice_i);\n        cifsl = cifsl.slice(slice_i);\n\n        var newlines = parsed.match(eol_re);\n        if (newlines) {\n            line_index += newlines.length;\n        }\n    }\n\n    return tokenized;\n}\nmodule.exports.tokenize = tokenize;\n\n/**\n *  Parse a single token as a value.\n *  @param  {Object} tok    Token to parse (must not be a reserved keyword\n *                          like a data_ or loop_ token)\n *  @return {CifValue}      Parsed value\n */\nfunction parseValue(tok) {\n\n    // If it's a string, easy one\n    if (tok.type == 'quotestring') {\n        return new CifValue('string', tok.val.slice(1, tok.val.length - 1));\n    }\n    if (tok.type == 'semicolontext') {\n        return new CifValue('mstring', tok.val.slice(1, tok.val.length - 1));\n    }\n\n    if (tok.type != 'unknown') {\n        // Something's wrong\n        return null;\n    }\n\n    // We now know it's unknown, so...\n    var strval = tok.val;\n\n    // First, check for special types\n    if (strval.trim() == '.') {\n        return new CifValue('N/A');\n    } else if (strval.trim() == '?') {\n        return new CifValue('?');\n    }\n\n    var type;\n    // It can be a numeric value\n    var m = tokens.tokenRegex('numeric', true, true).exec(strval.trim());\n    if (m) {\n        // Does it have a precision?\n        var prec = null;\n        var strnum = m[3]; // Will be undefined if there's a precision\n        if (strnum === undefined) {\n            prec = parseInt(m[2]);\n            strnum = m[1];\n        }\n        // Integer or float?\n        var num;\n        if (strnum.match(tokens.tokenRegex('float', true, true))) {\n            num = parseFloat(strnum);\n            type = 'float';\n        } else {\n            num = parseInt(strnum);\n            type = 'int';\n        }\n\n        return new CifValue(type, num, prec);\n    }\n\n    // Or it's just an unquoted string\n    return new CifValue('string', strval);\n}\nmodule.exports.parseValue = parseValue;\n\n/**\n * Finds and splits the data blocks from a tokenized CIF file.\n * @param  {Array}   ciftokens   Array of tokens contained in the file\n * @return {Array}               Array of data blocks in the form \n *                               [name, [tokens]]\n */\nfunction parseDataBlocks(ciftokens) {\n    // Identify all data blocks\n\n    var tagre = tokens.tokenRegex('tag');\n    var data_headers = [];\n    for (var i = 0; i < ciftokens.length; ++i) {\n        var tok = ciftokens[i];\n        if (tok.type == 'data_headers') {\n            var name = tok.val.match(tagre);\n            if (name.length != 1) {\n                throw errormsg('Invalid data header ' + tok.val, tok.line);\n            }\n            data_headers.push([i, name[0].slice(1)]);\n        }\n    }\n\n    // Now gather the blocks\n    var data_blocks = [];\n    for (var i = 0; i < data_headers.length; ++i) {\n        var dh = data_headers[i];\n        var end = ((i < data_headers.length - 1) ? data_headers[i + 1][0] :\n            ciftokens.length);\n        var db = [dh[1], ciftokens.slice(dh[0] + 1, end)];\n        data_blocks.push(db);\n    }\n\n    return data_blocks;\n}\nmodule.exports.parseDataBlocks = parseDataBlocks;\n\n/**\n * Parses a series of tokens defining a data block into data items.\n * @param  {Array}  blocktokens  Array of tokens defining the block\n * @return {Array}               Array of parsed tata items\n */\nfunction parseDataItems(blocktokens) {\n    // Parse the data items inside a data block\n\n    var data_items = [];\n\n    /* There are two possible structures here:\n    1) alternating series of tag - value\n    2) loop with series of tags, then corresponding series of values  \n    */\n\n    // Acceptable value token types\n    var vtypes = ['quotestring', 'semicolontext', 'unknown'];\n\n    data_items = [];\n\n    var btokens = blocktokens.slice();\n    while (btokens.length > 0) {\n        var btok = btokens.shift();\n        // What type is it?\n        if (btok === undefined) {\n            break;\n        }\n        switch (btok.type) {\n            case 'tag':\n                var valtok = btokens.shift();\n                if (valtok == null || !vtypes.includes(valtok.type)) {\n                    throw errormsg('Invalid or missing value for tag ' + btok.val, btok.line);\n                }\n                data_items.push({\n                    'tag': btok.val,\n                    'type': 'single',\n                    'value': parseValue(valtok)\n                });\n                break;\n            case 'loop_kw':\n                // Start by parsing the header\n                var header = [];\n                var ltok = btokens.shift();\n                var loop_end = btok.line; // Keep track of line\n                while (ltok !== undefined && ltok.type == 'tag') {\n                    header.push(ltok.val);\n                    loop_end = ltok.line;\n                    ltok = btokens.shift();\n                }\n                var body = [];\n                while (ltok !== undefined && vtypes.includes(ltok.type)) {\n                    body.push(parseValue(ltok));\n                    loop_end = ltok.line;\n                    ltok = btokens.shift();\n                }\n                // Put back that last one...\n                btokens.unshift(ltok);\n\n                // Check if the loop is correct\n                if (body.length % header.length != 0) {\n                    throw errormsg('Invalid loop - values must be a multiple of tags', loop_end);\n                }\n                var tagn = header.length;\n                var loopn = body.length / header.length;\n\n                for (var i = 0; i < header.length; ++i) {\n                    var di = {\n                        'tag': header[i],\n                        'type': 'loop',\n                        'value': [],\n                    }\n                    for (var j = 0; j < loopn; ++j) {\n                        di.value.push(body[j * tagn + i]);\n                    }\n                    data_items.push(di);\n                }\n                break;\n            default:\n                break;\n        }\n    }\n\n    return data_items;\n}\nmodule.exports.parseDataItems = parseDataItems;\n\n/**\n * Parses a cif file returning the data blocks and items (not interpreted).\n * @param  {string} ciftext CIF file as a string\n * @return {Object}         Parsed CIF file as data structure\n */\nmodule.exports.parseCif = function parseCif(ciftext) {\n\n    // First, extract the tokens\n    var tk = tokenize(ciftext);\n    // Then the blocks\n    var db = parseDataBlocks(tk);\n    // Now on to the items for each block\n    var cifdict = {};\n    for (var i = 0; i < db.length; ++i) {\n        var block = db[i];\n        cifdict[block[0]] = {};\n        // SAVE frames are not supported for now, so we only look \n        // for data items\n        var items = parseDataItems(block[1]);\n        for (var j = 0; j < items.length; ++j) {\n            cifdict[block[0]][items[j].tag] = items[j];\n        }\n    }\n\n    return cifdict;\n}","'use strict';\n\nvar parser = require('./lib/parse.js');\nvar Atoms = require('./lib/cryst.js').Atoms;\n\n/**\n * Parses a cif file in string format, returning it as a data structure\n * @param  {string} ciftext CIF file as a string\n * @return {Object}\n */\nmodule.exports.parseCifStructures = function(ciftext) {\n    return Atoms.readCif(ciftext);\n}\n\n// Additional exports\nmodule.exports.Atoms = Atoms;\nmodule.exports.parseCif = parser.parseCif;","!function(e){var t;\"object\"==typeof exports?module.exports=e():\"function\"==typeof define&&define.amd?define(e):(\"undefined\"!=typeof window?t=window:\"undefined\"!=typeof global?t=global:\"undefined\"!=typeof self&&(t=self),t.objectHash=e())}(function(){return function r(o,i,u){function s(n,e){if(!i[n]){if(!o[n]){var t=\"function\"==typeof require&&require;if(!e&&t)return t(n,!0);if(a)return a(n,!0);throw new Error(\"Cannot find module '\"+n+\"'\")}e=i[n]={exports:{}};o[n][0].call(e.exports,function(e){var t=o[n][1][e];return s(t||e)},e,e.exports,r,o,i,u)}return i[n].exports}for(var a=\"function\"==typeof require&&require,e=0;e<u.length;e++)s(u[e]);return s}({1:[function(w,b,m){!function(e,n,s,c,d,h,p,g,y){\"use strict\";var r=w(\"crypto\");function t(e,t){t=u(e,t);var n;return void 0===(n=\"passthrough\"!==t.algorithm?r.createHash(t.algorithm):new l).write&&(n.write=n.update,n.end=n.update),f(t,n).dispatch(e),n.update||n.end(\"\"),n.digest?n.digest(\"buffer\"===t.encoding?void 0:t.encoding):(e=n.read(),\"buffer\"!==t.encoding?e.toString(t.encoding):e)}(m=b.exports=t).sha1=function(e){return t(e)},m.keys=function(e){return t(e,{excludeValues:!0,algorithm:\"sha1\",encoding:\"hex\"})},m.MD5=function(e){return t(e,{algorithm:\"md5\",encoding:\"hex\"})},m.keysMD5=function(e){return t(e,{algorithm:\"md5\",encoding:\"hex\",excludeValues:!0})};var o=r.getHashes?r.getHashes().slice():[\"sha1\",\"md5\"],i=(o.push(\"passthrough\"),[\"buffer\",\"hex\",\"binary\",\"base64\"]);function u(e,t){var n={};if(n.algorithm=(t=t||{}).algorithm||\"sha1\",n.encoding=t.encoding||\"hex\",n.excludeValues=!!t.excludeValues,n.algorithm=n.algorithm.toLowerCase(),n.encoding=n.encoding.toLowerCase(),n.ignoreUnknown=!0===t.ignoreUnknown,n.respectType=!1!==t.respectType,n.respectFunctionNames=!1!==t.respectFunctionNames,n.respectFunctionProperties=!1!==t.respectFunctionProperties,n.unorderedArrays=!0===t.unorderedArrays,n.unorderedSets=!1!==t.unorderedSets,n.unorderedObjects=!1!==t.unorderedObjects,n.replacer=t.replacer||void 0,n.excludeKeys=t.excludeKeys||void 0,void 0===e)throw new Error(\"Object argument required.\");for(var r=0;r<o.length;++r)o[r].toLowerCase()===n.algorithm.toLowerCase()&&(n.algorithm=o[r]);if(-1===o.indexOf(n.algorithm))throw new Error('Algorithm \"'+n.algorithm+'\"  not supported. supported values: '+o.join(\", \"));if(-1===i.indexOf(n.encoding)&&\"passthrough\"!==n.algorithm)throw new Error('Encoding \"'+n.encoding+'\"  not supported. supported values: '+i.join(\", \"));return n}function a(e){if(\"function\"==typeof e)return null!=/^function\\s+\\w*\\s*\\(\\s*\\)\\s*{\\s+\\[native code\\]\\s+}$/i.exec(Function.prototype.toString.call(e))}function f(o,t,i){i=i||[];function u(e){return t.update?t.update(e,\"utf8\"):t.write(e,\"utf8\")}return{dispatch:function(e){return this[\"_\"+(null===(e=o.replacer?o.replacer(e):e)?\"null\":typeof e)](e)},_object:function(t){var n,e=Object.prototype.toString.call(t),r=/\\[object (.*)\\]/i.exec(e);r=(r=r?r[1]:\"unknown:[\"+e+\"]\").toLowerCase();if(0<=(e=i.indexOf(t)))return this.dispatch(\"[CIRCULAR:\"+e+\"]\");if(i.push(t),void 0!==s&&s.isBuffer&&s.isBuffer(t))return u(\"buffer:\"),u(t);if(\"object\"===r||\"function\"===r||\"asyncfunction\"===r)return e=Object.keys(t),o.unorderedObjects&&(e=e.sort()),!1===o.respectType||a(t)||e.splice(0,0,\"prototype\",\"__proto__\",\"constructor\"),o.excludeKeys&&(e=e.filter(function(e){return!o.excludeKeys(e)})),u(\"object:\"+e.length+\":\"),n=this,e.forEach(function(e){n.dispatch(e),u(\":\"),o.excludeValues||n.dispatch(t[e]),u(\",\")});if(!this[\"_\"+r]){if(o.ignoreUnknown)return u(\"[\"+r+\"]\");throw new Error('Unknown object type \"'+r+'\"')}this[\"_\"+r](t)},_array:function(e,t){t=void 0!==t?t:!1!==o.unorderedArrays;var n=this;if(u(\"array:\"+e.length+\":\"),!t||e.length<=1)return e.forEach(function(e){return n.dispatch(e)});var r=[],t=e.map(function(e){var t=new l,n=i.slice();return f(o,t,n).dispatch(e),r=r.concat(n.slice(i.length)),t.read().toString()});return i=i.concat(r),t.sort(),this._array(t,!1)},_date:function(e){return u(\"date:\"+e.toJSON())},_symbol:function(e){return u(\"symbol:\"+e.toString())},_error:function(e){return u(\"error:\"+e.toString())},_boolean:function(e){return u(\"bool:\"+e.toString())},_string:function(e){u(\"string:\"+e.length+\":\"),u(e.toString())},_function:function(e){u(\"fn:\"),a(e)?this.dispatch(\"[native]\"):this.dispatch(e.toString()),!1!==o.respectFunctionNames&&this.dispatch(\"function-name:\"+String(e.name)),o.respectFunctionProperties&&this._object(e)},_number:function(e){return u(\"number:\"+e.toString())},_xml:function(e){return u(\"xml:\"+e.toString())},_null:function(){return u(\"Null\")},_undefined:function(){return u(\"Undefined\")},_regexp:function(e){return u(\"regex:\"+e.toString())},_uint8array:function(e){return u(\"uint8array:\"),this.dispatch(Array.prototype.slice.call(e))},_uint8clampedarray:function(e){return u(\"uint8clampedarray:\"),this.dispatch(Array.prototype.slice.call(e))},_int8array:function(e){return u(\"int8array:\"),this.dispatch(Array.prototype.slice.call(e))},_uint16array:function(e){return u(\"uint16array:\"),this.dispatch(Array.prototype.slice.call(e))},_int16array:function(e){return u(\"int16array:\"),this.dispatch(Array.prototype.slice.call(e))},_uint32array:function(e){return u(\"uint32array:\"),this.dispatch(Array.prototype.slice.call(e))},_int32array:function(e){return u(\"int32array:\"),this.dispatch(Array.prototype.slice.call(e))},_float32array:function(e){return u(\"float32array:\"),this.dispatch(Array.prototype.slice.call(e))},_float64array:function(e){return u(\"float64array:\"),this.dispatch(Array.prototype.slice.call(e))},_arraybuffer:function(e){return u(\"arraybuffer:\"),this.dispatch(new Uint8Array(e))},_url:function(e){return u(\"url:\"+e.toString())},_map:function(e){u(\"map:\");e=Array.from(e);return this._array(e,!1!==o.unorderedSets)},_set:function(e){u(\"set:\");e=Array.from(e);return this._array(e,!1!==o.unorderedSets)},_file:function(e){return u(\"file:\"),this.dispatch([e.name,e.size,e.type,e.lastModfied])},_blob:function(){if(o.ignoreUnknown)return u(\"[blob]\");throw Error('Hashing Blob objects is currently not supported\\n(see https://github.com/puleos/object-hash/issues/26)\\nUse \"options.replacer\" or \"options.ignoreUnknown\"\\n')},_domwindow:function(){return u(\"domwindow\")},_bigint:function(e){return u(\"bigint:\"+e.toString())},_process:function(){return u(\"process\")},_timer:function(){return u(\"timer\")},_pipe:function(){return u(\"pipe\")},_tcp:function(){return u(\"tcp\")},_udp:function(){return u(\"udp\")},_tty:function(){return u(\"tty\")},_statwatcher:function(){return u(\"statwatcher\")},_securecontext:function(){return u(\"securecontext\")},_connection:function(){return u(\"connection\")},_zlib:function(){return u(\"zlib\")},_context:function(){return u(\"context\")},_nodescript:function(){return u(\"nodescript\")},_httpparser:function(){return u(\"httpparser\")},_dataview:function(){return u(\"dataview\")},_signal:function(){return u(\"signal\")},_fsevent:function(){return u(\"fsevent\")},_tlswrap:function(){return u(\"tlswrap\")}}}function l(){return{buf:\"\",write:function(e){this.buf+=e},end:function(e){this.buf+=e},read:function(){return this.buf}}}m.writeToStream=function(e,t,n){return void 0===n&&(n=t,t={}),f(t=u(e,t),n).dispatch(e)}}.call(this,w(\"lYpoI2\"),\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{},w(\"buffer\").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],\"/fake_9a5aa49d.js\",\"/\")},{buffer:3,crypto:5,lYpoI2:11}],2:[function(e,t,f){!function(e,t,n,r,o,i,u,s,a){!function(e){\"use strict\";var a=\"undefined\"!=typeof Uint8Array?Uint8Array:Array,t=\"+\".charCodeAt(0),n=\"/\".charCodeAt(0),r=\"0\".charCodeAt(0),o=\"a\".charCodeAt(0),i=\"A\".charCodeAt(0),u=\"-\".charCodeAt(0),s=\"_\".charCodeAt(0);function f(e){e=e.charCodeAt(0);return e===t||e===u?62:e===n||e===s?63:e<r?-1:e<r+10?e-r+26+26:e<i+26?e-i:e<o+26?e-o+26:void 0}e.toByteArray=function(e){var t,n;if(0<e.length%4)throw new Error(\"Invalid string. Length must be a multiple of 4\");var r=e.length,r=\"=\"===e.charAt(r-2)?2:\"=\"===e.charAt(r-1)?1:0,o=new a(3*e.length/4-r),i=0<r?e.length-4:e.length,u=0;function s(e){o[u++]=e}for(t=0;t<i;t+=4,0)s((16711680&(n=f(e.charAt(t))<<18|f(e.charAt(t+1))<<12|f(e.charAt(t+2))<<6|f(e.charAt(t+3))))>>16),s((65280&n)>>8),s(255&n);return 2==r?s(255&(n=f(e.charAt(t))<<2|f(e.charAt(t+1))>>4)):1==r&&(s((n=f(e.charAt(t))<<10|f(e.charAt(t+1))<<4|f(e.charAt(t+2))>>2)>>8&255),s(255&n)),o},e.fromByteArray=function(e){var t,n,r,o,i=e.length%3,u=\"\";function s(e){return\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\".charAt(e)}for(t=0,r=e.length-i;t<r;t+=3)n=(e[t]<<16)+(e[t+1]<<8)+e[t+2],u+=s((o=n)>>18&63)+s(o>>12&63)+s(o>>6&63)+s(63&o);switch(i){case 1:u=(u+=s((n=e[e.length-1])>>2))+s(n<<4&63)+\"==\";break;case 2:u=(u=(u+=s((n=(e[e.length-2]<<8)+e[e.length-1])>>10))+s(n>>4&63))+s(n<<2&63)+\"=\"}return u}}(void 0===f?this.base64js={}:f)}.call(this,e(\"lYpoI2\"),\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{},e(\"buffer\").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],\"/node_modules/gulp-browserify/node_modules/base64-js/lib/b64.js\",\"/node_modules/gulp-browserify/node_modules/base64-js/lib\")},{buffer:3,lYpoI2:11}],3:[function(O,e,H){!function(e,n,f,r,h,p,g,y,w){var a=O(\"base64-js\"),i=O(\"ieee754\");function f(e,t,n){if(!(this instanceof f))return new f(e,t,n);var r,o,i,u,s=typeof e;if(\"base64\"===t&&\"string\"==s)for(e=(u=e).trim?u.trim():u.replace(/^\\s+|\\s+$/g,\"\");e.length%4!=0;)e+=\"=\";if(\"number\"==s)r=j(e);else if(\"string\"==s)r=f.byteLength(e,t);else{if(\"object\"!=s)throw new Error(\"First argument needs to be a number, array or string.\");r=j(e.length)}if(f._useTypedArrays?o=f._augment(new Uint8Array(r)):((o=this).length=r,o._isBuffer=!0),f._useTypedArrays&&\"number\"==typeof e.byteLength)o._set(e);else if(C(u=e)||f.isBuffer(u)||u&&\"object\"==typeof u&&\"number\"==typeof u.length)for(i=0;i<r;i++)f.isBuffer(e)?o[i]=e.readUInt8(i):o[i]=e[i];else if(\"string\"==s)o.write(e,0,t);else if(\"number\"==s&&!f._useTypedArrays&&!n)for(i=0;i<r;i++)o[i]=0;return o}function b(e,t,n,r){return f._charsWritten=c(function(e){for(var t=[],n=0;n<e.length;n++)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function m(e,t,n,r){return f._charsWritten=c(function(e){for(var t,n,r=[],o=0;o<e.length;o++)n=e.charCodeAt(o),t=n>>8,n=n%256,r.push(n),r.push(t);return r}(t),e,n,r)}function v(e,t,n){var r=\"\";n=Math.min(e.length,n);for(var o=t;o<n;o++)r+=String.fromCharCode(e[o]);return r}function o(e,t,n,r){r||(d(\"boolean\"==typeof n,\"missing or invalid endian\"),d(null!=t,\"missing offset\"),d(t+1<e.length,\"Trying to read beyond buffer length\"));var o,r=e.length;if(!(r<=t))return n?(o=e[t],t+1<r&&(o|=e[t+1]<<8)):(o=e[t]<<8,t+1<r&&(o|=e[t+1])),o}function u(e,t,n,r){r||(d(\"boolean\"==typeof n,\"missing or invalid endian\"),d(null!=t,\"missing offset\"),d(t+3<e.length,\"Trying to read beyond buffer length\"));var o,r=e.length;if(!(r<=t))return n?(t+2<r&&(o=e[t+2]<<16),t+1<r&&(o|=e[t+1]<<8),o|=e[t],t+3<r&&(o+=e[t+3]<<24>>>0)):(t+1<r&&(o=e[t+1]<<16),t+2<r&&(o|=e[t+2]<<8),t+3<r&&(o|=e[t+3]),o+=e[t]<<24>>>0),o}function _(e,t,n,r){if(r||(d(\"boolean\"==typeof n,\"missing or invalid endian\"),d(null!=t,\"missing offset\"),d(t+1<e.length,\"Trying to read beyond buffer length\")),!(e.length<=t))return r=o(e,t,n,!0),32768&r?-1*(65535-r+1):r}function E(e,t,n,r){if(r||(d(\"boolean\"==typeof n,\"missing or invalid endian\"),d(null!=t,\"missing offset\"),d(t+3<e.length,\"Trying to read beyond buffer length\")),!(e.length<=t))return r=u(e,t,n,!0),2147483648&r?-1*(4294967295-r+1):r}function I(e,t,n,r){return r||(d(\"boolean\"==typeof n,\"missing or invalid endian\"),d(t+3<e.length,\"Trying to read beyond buffer length\")),i.read(e,t,n,23,4)}function A(e,t,n,r){return r||(d(\"boolean\"==typeof n,\"missing or invalid endian\"),d(t+7<e.length,\"Trying to read beyond buffer length\")),i.read(e,t,n,52,8)}function s(e,t,n,r,o){o||(d(null!=t,\"missing value\"),d(\"boolean\"==typeof r,\"missing or invalid endian\"),d(null!=n,\"missing offset\"),d(n+1<e.length,\"trying to write beyond buffer length\"),Y(t,65535));o=e.length;if(!(o<=n))for(var i=0,u=Math.min(o-n,2);i<u;i++)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function l(e,t,n,r,o){o||(d(null!=t,\"missing value\"),d(\"boolean\"==typeof r,\"missing or invalid endian\"),d(null!=n,\"missing offset\"),d(n+3<e.length,\"trying to write beyond buffer length\"),Y(t,4294967295));o=e.length;if(!(o<=n))for(var i=0,u=Math.min(o-n,4);i<u;i++)e[n+i]=t>>>8*(r?i:3-i)&255}function B(e,t,n,r,o){o||(d(null!=t,\"missing value\"),d(\"boolean\"==typeof r,\"missing or invalid endian\"),d(null!=n,\"missing offset\"),d(n+1<e.length,\"Trying to write beyond buffer length\"),F(t,32767,-32768)),e.length<=n||s(e,0<=t?t:65535+t+1,n,r,o)}function L(e,t,n,r,o){o||(d(null!=t,\"missing value\"),d(\"boolean\"==typeof r,\"missing or invalid endian\"),d(null!=n,\"missing offset\"),d(n+3<e.length,\"Trying to write beyond buffer length\"),F(t,2147483647,-2147483648)),e.length<=n||l(e,0<=t?t:4294967295+t+1,n,r,o)}function U(e,t,n,r,o){o||(d(null!=t,\"missing value\"),d(\"boolean\"==typeof r,\"missing or invalid endian\"),d(null!=n,\"missing offset\"),d(n+3<e.length,\"Trying to write beyond buffer length\"),D(t,34028234663852886e22,-34028234663852886e22)),e.length<=n||i.write(e,t,n,r,23,4)}function x(e,t,n,r,o){o||(d(null!=t,\"missing value\"),d(\"boolean\"==typeof r,\"missing or invalid endian\"),d(null!=n,\"missing offset\"),d(n+7<e.length,\"Trying to write beyond buffer length\"),D(t,17976931348623157e292,-17976931348623157e292)),e.length<=n||i.write(e,t,n,r,52,8)}H.Buffer=f,H.SlowBuffer=f,H.INSPECT_MAX_BYTES=50,f.poolSize=8192,f._useTypedArrays=function(){try{var e=new ArrayBuffer(0),t=new Uint8Array(e);return t.foo=function(){return 42},42===t.foo()&&\"function\"==typeof t.subarray}catch(e){return!1}}(),f.isEncoding=function(e){switch(String(e).toLowerCase()){case\"hex\":case\"utf8\":case\"utf-8\":case\"ascii\":case\"binary\":case\"base64\":case\"raw\":case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":return!0;default:return!1}},f.isBuffer=function(e){return!(null==e||!e._isBuffer)},f.byteLength=function(e,t){var n;switch(e+=\"\",t||\"utf8\"){case\"hex\":n=e.length/2;break;case\"utf8\":case\"utf-8\":n=T(e).length;break;case\"ascii\":case\"binary\":case\"raw\":n=e.length;break;case\"base64\":n=M(e).length;break;case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":n=2*e.length;break;default:throw new Error(\"Unknown encoding\")}return n},f.concat=function(e,t){if(d(C(e),\"Usage: Buffer.concat(list, [totalLength])\\nlist should be an Array.\"),0===e.length)return new f(0);if(1===e.length)return e[0];if(\"number\"!=typeof t)for(o=t=0;o<e.length;o++)t+=e[o].length;for(var n=new f(t),r=0,o=0;o<e.length;o++){var i=e[o];i.copy(n,r),r+=i.length}return n},f.prototype.write=function(e,t,n,r){isFinite(t)?isFinite(n)||(r=n,n=void 0):(a=r,r=t,t=n,n=a),t=Number(t)||0;var o,i,u,s,a=this.length-t;switch((!n||a<(n=Number(n)))&&(n=a),r=String(r||\"utf8\").toLowerCase()){case\"hex\":o=function(e,t,n,r){n=Number(n)||0;var o=e.length-n;(!r||o<(r=Number(r)))&&(r=o),d((o=t.length)%2==0,\"Invalid hex string\"),o/2<r&&(r=o/2);for(var i=0;i<r;i++){var u=parseInt(t.substr(2*i,2),16);d(!isNaN(u),\"Invalid hex string\"),e[n+i]=u}return f._charsWritten=2*i,i}(this,e,t,n);break;case\"utf8\":case\"utf-8\":i=this,u=t,s=n,o=f._charsWritten=c(T(e),i,u,s);break;case\"ascii\":case\"binary\":o=b(this,e,t,n);break;case\"base64\":i=this,u=t,s=n,o=f._charsWritten=c(M(e),i,u,s);break;case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":o=m(this,e,t,n);break;default:throw new Error(\"Unknown encoding\")}return o},f.prototype.toString=function(e,t,n){var r,o,i,u,s=this;if(e=String(e||\"utf8\").toLowerCase(),t=Number(t)||0,(n=void 0!==n?Number(n):s.length)===t)return\"\";switch(e){case\"hex\":r=function(e,t,n){var r=e.length;(!t||t<0)&&(t=0);(!n||n<0||r<n)&&(n=r);for(var o=\"\",i=t;i<n;i++)o+=k(e[i]);return o}(s,t,n);break;case\"utf8\":case\"utf-8\":r=function(e,t,n){var r=\"\",o=\"\";n=Math.min(e.length,n);for(var i=t;i<n;i++)e[i]<=127?(r+=N(o)+String.fromCharCode(e[i]),o=\"\"):o+=\"%\"+e[i].toString(16);return r+N(o)}(s,t,n);break;case\"ascii\":case\"binary\":r=v(s,t,n);break;case\"base64\":o=s,u=n,r=0===(i=t)&&u===o.length?a.fromByteArray(o):a.fromByteArray(o.slice(i,u));break;case\"ucs2\":case\"ucs-2\":case\"utf16le\":case\"utf-16le\":r=function(e,t,n){for(var r=e.slice(t,n),o=\"\",i=0;i<r.length;i+=2)o+=String.fromCharCode(r[i]+256*r[i+1]);return o}(s,t,n);break;default:throw new Error(\"Unknown encoding\")}return r},f.prototype.toJSON=function(){return{type:\"Buffer\",data:Array.prototype.slice.call(this._arr||this,0)}},f.prototype.copy=function(e,t,n,r){if(t=t||0,(r=r||0===r?r:this.length)!==(n=n||0)&&0!==e.length&&0!==this.length){d(n<=r,\"sourceEnd < sourceStart\"),d(0<=t&&t<e.length,\"targetStart out of bounds\"),d(0<=n&&n<this.length,\"sourceStart out of bounds\"),d(0<=r&&r<=this.length,\"sourceEnd out of bounds\"),r>this.length&&(r=this.length);var o=(r=e.length-t<r-n?e.length-t+n:r)-n;if(o<100||!f._useTypedArrays)for(var i=0;i<o;i++)e[i+t]=this[i+n];else e._set(this.subarray(n,n+o),t)}},f.prototype.slice=function(e,t){var n=this.length;if(e=S(e,n,0),t=S(t,n,n),f._useTypedArrays)return f._augment(this.subarray(e,t));for(var r=t-e,o=new f(r,void 0,!0),i=0;i<r;i++)o[i]=this[i+e];return o},f.prototype.get=function(e){return console.log(\".get() is deprecated. Access using array indexes instead.\"),this.readUInt8(e)},f.prototype.set=function(e,t){return console.log(\".set() is deprecated. Access using array indexes instead.\"),this.writeUInt8(e,t)},f.prototype.readUInt8=function(e,t){if(t||(d(null!=e,\"missing offset\"),d(e<this.length,\"Trying to read beyond buffer length\")),!(e>=this.length))return this[e]},f.prototype.readUInt16LE=function(e,t){return o(this,e,!0,t)},f.prototype.readUInt16BE=function(e,t){return o(this,e,!1,t)},f.prototype.readUInt32LE=function(e,t){return u(this,e,!0,t)},f.prototype.readUInt32BE=function(e,t){return u(this,e,!1,t)},f.prototype.readInt8=function(e,t){if(t||(d(null!=e,\"missing offset\"),d(e<this.length,\"Trying to read beyond buffer length\")),!(e>=this.length))return 128&this[e]?-1*(255-this[e]+1):this[e]},f.prototype.readInt16LE=function(e,t){return _(this,e,!0,t)},f.prototype.readInt16BE=function(e,t){return _(this,e,!1,t)},f.prototype.readInt32LE=function(e,t){return E(this,e,!0,t)},f.prototype.readInt32BE=function(e,t){return E(this,e,!1,t)},f.prototype.readFloatLE=function(e,t){return I(this,e,!0,t)},f.prototype.readFloatBE=function(e,t){return I(this,e,!1,t)},f.prototype.readDoubleLE=function(e,t){return A(this,e,!0,t)},f.prototype.readDoubleBE=function(e,t){return A(this,e,!1,t)},f.prototype.writeUInt8=function(e,t,n){n||(d(null!=e,\"missing value\"),d(null!=t,\"missing offset\"),d(t<this.length,\"trying to write beyond buffer length\"),Y(e,255)),t>=this.length||(this[t]=e)},f.prototype.writeUInt16LE=function(e,t,n){s(this,e,t,!0,n)},f.prototype.writeUInt16BE=function(e,t,n){s(this,e,t,!1,n)},f.prototype.writeUInt32LE=function(e,t,n){l(this,e,t,!0,n)},f.prototype.writeUInt32BE=function(e,t,n){l(this,e,t,!1,n)},f.prototype.writeInt8=function(e,t,n){n||(d(null!=e,\"missing value\"),d(null!=t,\"missing offset\"),d(t<this.length,\"Trying to write beyond buffer length\"),F(e,127,-128)),t>=this.length||(0<=e?this.writeUInt8(e,t,n):this.writeUInt8(255+e+1,t,n))},f.prototype.writeInt16LE=function(e,t,n){B(this,e,t,!0,n)},f.prototype.writeInt16BE=function(e,t,n){B(this,e,t,!1,n)},f.prototype.writeInt32LE=function(e,t,n){L(this,e,t,!0,n)},f.prototype.writeInt32BE=function(e,t,n){L(this,e,t,!1,n)},f.prototype.writeFloatLE=function(e,t,n){U(this,e,t,!0,n)},f.prototype.writeFloatBE=function(e,t,n){U(this,e,t,!1,n)},f.prototype.writeDoubleLE=function(e,t,n){x(this,e,t,!0,n)},f.prototype.writeDoubleBE=function(e,t,n){x(this,e,t,!1,n)},f.prototype.fill=function(e,t,n){if(t=t||0,n=n||this.length,d(\"number\"==typeof(e=\"string\"==typeof(e=e||0)?e.charCodeAt(0):e)&&!isNaN(e),\"value is not a number\"),d(t<=n,\"end < start\"),n!==t&&0!==this.length){d(0<=t&&t<this.length,\"start out of bounds\"),d(0<=n&&n<=this.length,\"end out of bounds\");for(var r=t;r<n;r++)this[r]=e}},f.prototype.inspect=function(){for(var e=[],t=this.length,n=0;n<t;n++)if(e[n]=k(this[n]),n===H.INSPECT_MAX_BYTES){e[n+1]=\"...\";break}return\"<Buffer \"+e.join(\" \")+\">\"},f.prototype.toArrayBuffer=function(){if(\"undefined\"==typeof Uint8Array)throw new Error(\"Buffer.toArrayBuffer not supported in this browser\");if(f._useTypedArrays)return new f(this).buffer;for(var e=new Uint8Array(this.length),t=0,n=e.length;t<n;t+=1)e[t]=this[t];return e.buffer};var t=f.prototype;function S(e,t,n){return\"number\"!=typeof e?n:t<=(e=~~e)?t:0<=e||0<=(e+=t)?e:0}function j(e){return(e=~~Math.ceil(+e))<0?0:e}function C(e){return(Array.isArray||function(e){return\"[object Array]\"===Object.prototype.toString.call(e)})(e)}function k(e){return e<16?\"0\"+e.toString(16):e.toString(16)}function T(e){for(var t=[],n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<=127)t.push(e.charCodeAt(n));else for(var o=n,i=(55296<=r&&r<=57343&&n++,encodeURIComponent(e.slice(o,n+1)).substr(1).split(\"%\")),u=0;u<i.length;u++)t.push(parseInt(i[u],16))}return t}function M(e){return a.toByteArray(e)}function c(e,t,n,r){for(var o=0;o<r&&!(o+n>=t.length||o>=e.length);o++)t[o+n]=e[o];return o}function N(e){try{return decodeURIComponent(e)}catch(e){return String.fromCharCode(65533)}}function Y(e,t){d(\"number\"==typeof e,\"cannot write a non-number as a number\"),d(0<=e,\"specified a negative value for writing an unsigned value\"),d(e<=t,\"value is larger than maximum value for type\"),d(Math.floor(e)===e,\"value has a fractional component\")}function F(e,t,n){d(\"number\"==typeof e,\"cannot write a non-number as a number\"),d(e<=t,\"value larger than maximum allowed value\"),d(n<=e,\"value smaller than minimum allowed value\"),d(Math.floor(e)===e,\"value has a fractional component\")}function D(e,t,n){d(\"number\"==typeof e,\"cannot write a non-number as a number\"),d(e<=t,\"value larger than maximum allowed value\"),d(n<=e,\"value smaller than minimum allowed value\")}function d(e,t){if(!e)throw new Error(t||\"Failed assertion\")}f._augment=function(e){return e._isBuffer=!0,e._get=e.get,e._set=e.set,e.get=t.get,e.set=t.set,e.write=t.write,e.toString=t.toString,e.toLocaleString=t.toString,e.toJSON=t.toJSON,e.copy=t.copy,e.slice=t.slice,e.readUInt8=t.readUInt8,e.readUInt16LE=t.readUInt16LE,e.readUInt16BE=t.readUInt16BE,e.readUInt32LE=t.readUInt32LE,e.readUInt32BE=t.readUInt32BE,e.readInt8=t.readInt8,e.readInt16LE=t.readInt16LE,e.readInt16BE=t.readInt16BE,e.readInt32LE=t.readInt32LE,e.readInt32BE=t.readInt32BE,e.readFloatLE=t.readFloatLE,e.readFloatBE=t.readFloatBE,e.readDoubleLE=t.readDoubleLE,e.readDoubleBE=t.readDoubleBE,e.writeUInt8=t.writeUInt8,e.writeUInt16LE=t.writeUInt16LE,e.writeUInt16BE=t.writeUInt16BE,e.writeUInt32LE=t.writeUInt32LE,e.writeUInt32BE=t.writeUInt32BE,e.writeInt8=t.writeInt8,e.writeInt16LE=t.writeInt16LE,e.writeInt16BE=t.writeInt16BE,e.writeInt32LE=t.writeInt32LE,e.writeInt32BE=t.writeInt32BE,e.writeFloatLE=t.writeFloatLE,e.writeFloatBE=t.writeFloatBE,e.writeDoubleLE=t.writeDoubleLE,e.writeDoubleBE=t.writeDoubleBE,e.fill=t.fill,e.inspect=t.inspect,e.toArrayBuffer=t.toArrayBuffer,e}}.call(this,O(\"lYpoI2\"),\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{},O(\"buffer\").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],\"/node_modules/gulp-browserify/node_modules/buffer/index.js\",\"/node_modules/gulp-browserify/node_modules/buffer\")},{\"base64-js\":2,buffer:3,ieee754:10,lYpoI2:11}],4:[function(c,d,e){!function(e,t,a,n,r,o,i,u,s){var a=c(\"buffer\").Buffer,f=4,l=new a(f);l.fill(0);d.exports={hash:function(e,t,n,r){for(var o=t(function(e,t){e.length%f!=0&&(n=e.length+(f-e.length%f),e=a.concat([e,l],n));for(var n,r=[],o=t?e.readInt32BE:e.readInt32LE,i=0;i<e.length;i+=f)r.push(o.call(e,i));return r}(e=a.isBuffer(e)?e:new a(e),r),8*e.length),t=r,i=new a(n),u=t?i.writeInt32BE:i.writeInt32LE,s=0;s<o.length;s++)u.call(i,o[s],4*s,!0);return i}}}.call(this,c(\"lYpoI2\"),\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{},c(\"buffer\").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],\"/node_modules/gulp-browserify/node_modules/crypto-browserify/helpers.js\",\"/node_modules/gulp-browserify/node_modules/crypto-browserify\")},{buffer:3,lYpoI2:11}],5:[function(v,e,_){!function(l,c,u,d,h,p,g,y,w){var u=v(\"buffer\").Buffer,e=v(\"./sha\"),t=v(\"./sha256\"),n=v(\"./rng\"),b={sha1:e,sha256:t,md5:v(\"./md5\")},s=64,a=new u(s);function r(e,n){var r=b[e=e||\"sha1\"],o=[];return r||i(\"algorithm:\",e,\"is not yet supported\"),{update:function(e){return u.isBuffer(e)||(e=new u(e)),o.push(e),e.length,this},digest:function(e){var t=u.concat(o),t=n?function(e,t,n){u.isBuffer(t)||(t=new u(t)),u.isBuffer(n)||(n=new u(n)),t.length>s?t=e(t):t.length<s&&(t=u.concat([t,a],s));for(var r=new u(s),o=new u(s),i=0;i<s;i++)r[i]=54^t[i],o[i]=92^t[i];return n=e(u.concat([r,n])),e(u.concat([o,n]))}(r,n,t):r(t);return o=null,e?t.toString(e):t}}}function i(){var e=[].slice.call(arguments).join(\" \");throw new Error([e,\"we accept pull requests\",\"http://github.com/dominictarr/crypto-browserify\"].join(\"\\n\"))}a.fill(0),_.createHash=function(e){return r(e)},_.createHmac=r,_.randomBytes=function(e,t){if(!t||!t.call)return new u(n(e));try{t.call(this,void 0,new u(n(e)))}catch(e){t(e)}};var o,f=[\"createCredentials\",\"createCipher\",\"createCipheriv\",\"createDecipher\",\"createDecipheriv\",\"createSign\",\"createVerify\",\"createDiffieHellman\",\"pbkdf2\"],m=function(e){_[e]=function(){i(\"sorry,\",e,\"is not implemented yet\")}};for(o in f)m(f[o],o)}.call(this,v(\"lYpoI2\"),\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{},v(\"buffer\").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],\"/node_modules/gulp-browserify/node_modules/crypto-browserify/index.js\",\"/node_modules/gulp-browserify/node_modules/crypto-browserify\")},{\"./md5\":6,\"./rng\":7,\"./sha\":8,\"./sha256\":9,buffer:3,lYpoI2:11}],6:[function(w,b,e){!function(e,r,o,i,u,a,f,l,y){var t=w(\"./helpers\");function n(e,t){e[t>>5]|=128<<t%32,e[14+(t+64>>>9<<4)]=t;for(var n=1732584193,r=-271733879,o=-1732584194,i=271733878,u=0;u<e.length;u+=16){var s=n,a=r,f=o,l=i,n=c(n,r,o,i,e[u+0],7,-680876936),i=c(i,n,r,o,e[u+1],12,-389564586),o=c(o,i,n,r,e[u+2],17,606105819),r=c(r,o,i,n,e[u+3],22,-1044525330);n=c(n,r,o,i,e[u+4],7,-176418897),i=c(i,n,r,o,e[u+5],12,1200080426),o=c(o,i,n,r,e[u+6],17,-1473231341),r=c(r,o,i,n,e[u+7],22,-45705983),n=c(n,r,o,i,e[u+8],7,1770035416),i=c(i,n,r,o,e[u+9],12,-1958414417),o=c(o,i,n,r,e[u+10],17,-42063),r=c(r,o,i,n,e[u+11],22,-1990404162),n=c(n,r,o,i,e[u+12],7,1804603682),i=c(i,n,r,o,e[u+13],12,-40341101),o=c(o,i,n,r,e[u+14],17,-1502002290),n=d(n,r=c(r,o,i,n,e[u+15],22,1236535329),o,i,e[u+1],5,-165796510),i=d(i,n,r,o,e[u+6],9,-1069501632),o=d(o,i,n,r,e[u+11],14,643717713),r=d(r,o,i,n,e[u+0],20,-373897302),n=d(n,r,o,i,e[u+5],5,-701558691),i=d(i,n,r,o,e[u+10],9,38016083),o=d(o,i,n,r,e[u+15],14,-660478335),r=d(r,o,i,n,e[u+4],20,-405537848),n=d(n,r,o,i,e[u+9],5,568446438),i=d(i,n,r,o,e[u+14],9,-1019803690),o=d(o,i,n,r,e[u+3],14,-187363961),r=d(r,o,i,n,e[u+8],20,1163531501),n=d(n,r,o,i,e[u+13],5,-1444681467),i=d(i,n,r,o,e[u+2],9,-51403784),o=d(o,i,n,r,e[u+7],14,1735328473),n=h(n,r=d(r,o,i,n,e[u+12],20,-1926607734),o,i,e[u+5],4,-378558),i=h(i,n,r,o,e[u+8],11,-2022574463),o=h(o,i,n,r,e[u+11],16,1839030562),r=h(r,o,i,n,e[u+14],23,-35309556),n=h(n,r,o,i,e[u+1],4,-1530992060),i=h(i,n,r,o,e[u+4],11,1272893353),o=h(o,i,n,r,e[u+7],16,-155497632),r=h(r,o,i,n,e[u+10],23,-1094730640),n=h(n,r,o,i,e[u+13],4,681279174),i=h(i,n,r,o,e[u+0],11,-358537222),o=h(o,i,n,r,e[u+3],16,-722521979),r=h(r,o,i,n,e[u+6],23,76029189),n=h(n,r,o,i,e[u+9],4,-640364487),i=h(i,n,r,o,e[u+12],11,-421815835),o=h(o,i,n,r,e[u+15],16,530742520),n=p(n,r=h(r,o,i,n,e[u+2],23,-995338651),o,i,e[u+0],6,-198630844),i=p(i,n,r,o,e[u+7],10,1126891415),o=p(o,i,n,r,e[u+14],15,-1416354905),r=p(r,o,i,n,e[u+5],21,-57434055),n=p(n,r,o,i,e[u+12],6,1700485571),i=p(i,n,r,o,e[u+3],10,-1894986606),o=p(o,i,n,r,e[u+10],15,-1051523),r=p(r,o,i,n,e[u+1],21,-2054922799),n=p(n,r,o,i,e[u+8],6,1873313359),i=p(i,n,r,o,e[u+15],10,-30611744),o=p(o,i,n,r,e[u+6],15,-1560198380),r=p(r,o,i,n,e[u+13],21,1309151649),n=p(n,r,o,i,e[u+4],6,-145523070),i=p(i,n,r,o,e[u+11],10,-1120210379),o=p(o,i,n,r,e[u+2],15,718787259),r=p(r,o,i,n,e[u+9],21,-343485551),n=g(n,s),r=g(r,a),o=g(o,f),i=g(i,l)}return Array(n,r,o,i)}function s(e,t,n,r,o,i){return g((t=g(g(t,e),g(r,i)))<<o|t>>>32-o,n)}function c(e,t,n,r,o,i,u){return s(t&n|~t&r,e,t,o,i,u)}function d(e,t,n,r,o,i,u){return s(t&r|n&~r,e,t,o,i,u)}function h(e,t,n,r,o,i,u){return s(t^n^r,e,t,o,i,u)}function p(e,t,n,r,o,i,u){return s(n^(t|~r),e,t,o,i,u)}function g(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}b.exports=function(e){return t.hash(e,n,16)}}.call(this,w(\"lYpoI2\"),\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{},w(\"buffer\").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],\"/node_modules/gulp-browserify/node_modules/crypto-browserify/md5.js\",\"/node_modules/gulp-browserify/node_modules/crypto-browserify\")},{\"./helpers\":4,buffer:3,lYpoI2:11}],7:[function(e,l,t){!function(e,t,n,r,o,i,u,s,f){var a;l.exports=a||function(e){for(var t,n=new Array(e),r=0;r<e;r++)0==(3&r)&&(t=4294967296*Math.random()),n[r]=t>>>((3&r)<<3)&255;return n}}.call(this,e(\"lYpoI2\"),\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{},e(\"buffer\").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],\"/node_modules/gulp-browserify/node_modules/crypto-browserify/rng.js\",\"/node_modules/gulp-browserify/node_modules/crypto-browserify\")},{buffer:3,lYpoI2:11}],8:[function(c,d,e){!function(e,t,n,r,o,s,a,f,l){var i=c(\"./helpers\");function u(l,c){l[c>>5]|=128<<24-c%32,l[15+(c+64>>9<<4)]=c;for(var e,t,n,r=Array(80),o=1732584193,i=-271733879,u=-1732584194,s=271733878,d=-1009589776,h=0;h<l.length;h+=16){for(var p=o,g=i,y=u,w=s,b=d,a=0;a<80;a++){r[a]=a<16?l[h+a]:v(r[a-3]^r[a-8]^r[a-14]^r[a-16],1);var f=m(m(v(o,5),(f=i,t=u,n=s,(e=a)<20?f&t|~f&n:!(e<40)&&e<60?f&t|f&n|t&n:f^t^n)),m(m(d,r[a]),(e=a)<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514)),d=s,s=u,u=v(i,30),i=o,o=f}o=m(o,p),i=m(i,g),u=m(u,y),s=m(s,w),d=m(d,b)}return Array(o,i,u,s,d)}function m(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function v(e,t){return e<<t|e>>>32-t}d.exports=function(e){return i.hash(e,u,20,!0)}}.call(this,c(\"lYpoI2\"),\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{},c(\"buffer\").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],\"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha.js\",\"/node_modules/gulp-browserify/node_modules/crypto-browserify\")},{\"./helpers\":4,buffer:3,lYpoI2:11}],9:[function(c,d,e){!function(e,t,n,r,u,s,a,f,l){function b(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function o(e,l){var c,d=new Array(1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298),t=new Array(1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225),n=new Array(64);e[l>>5]|=128<<24-l%32,e[15+(l+64>>9<<4)]=l;for(var r,o,h=0;h<e.length;h+=16){for(var i=t[0],u=t[1],s=t[2],p=t[3],a=t[4],g=t[5],y=t[6],w=t[7],f=0;f<64;f++)n[f]=f<16?e[f+h]:b(b(b((o=n[f-2],m(o,17)^m(o,19)^v(o,10)),n[f-7]),(o=n[f-15],m(o,7)^m(o,18)^v(o,3))),n[f-16]),c=b(b(b(b(w,m(o=a,6)^m(o,11)^m(o,25)),a&g^~a&y),d[f]),n[f]),r=b(m(r=i,2)^m(r,13)^m(r,22),i&u^i&s^u&s),w=y,y=g,g=a,a=b(p,c),p=s,s=u,u=i,i=b(c,r);t[0]=b(i,t[0]),t[1]=b(u,t[1]),t[2]=b(s,t[2]),t[3]=b(p,t[3]),t[4]=b(a,t[4]),t[5]=b(g,t[5]),t[6]=b(y,t[6]),t[7]=b(w,t[7])}return t}var i=c(\"./helpers\"),m=function(e,t){return e>>>t|e<<32-t},v=function(e,t){return e>>>t};d.exports=function(e){return i.hash(e,o,32,!0)}}.call(this,c(\"lYpoI2\"),\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{},c(\"buffer\").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],\"/node_modules/gulp-browserify/node_modules/crypto-browserify/sha256.js\",\"/node_modules/gulp-browserify/node_modules/crypto-browserify\")},{\"./helpers\":4,buffer:3,lYpoI2:11}],10:[function(e,t,f){!function(e,t,n,r,o,i,u,s,a){f.read=function(e,t,n,r,o){var i,u,l=8*o-r-1,c=(1<<l)-1,d=c>>1,s=-7,a=n?o-1:0,f=n?-1:1,o=e[t+a];for(a+=f,i=o&(1<<-s)-1,o>>=-s,s+=l;0<s;i=256*i+e[t+a],a+=f,s-=8);for(u=i&(1<<-s)-1,i>>=-s,s+=r;0<s;u=256*u+e[t+a],a+=f,s-=8);if(0===i)i=1-d;else{if(i===c)return u?NaN:1/0*(o?-1:1);u+=Math.pow(2,r),i-=d}return(o?-1:1)*u*Math.pow(2,i-r)},f.write=function(e,t,l,n,r,c){var o,i,u=8*c-r-1,s=(1<<u)-1,a=s>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:c-1,h=n?1:-1,c=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(i=isNaN(t)?1:0,o=s):(o=Math.floor(Math.log(t)/Math.LN2),t*(n=Math.pow(2,-o))<1&&(o--,n*=2),2<=(t+=1<=o+a?d/n:d*Math.pow(2,1-a))*n&&(o++,n/=2),s<=o+a?(i=0,o=s):1<=o+a?(i=(t*n-1)*Math.pow(2,r),o+=a):(i=t*Math.pow(2,a-1)*Math.pow(2,r),o=0));8<=r;e[l+f]=255&i,f+=h,i/=256,r-=8);for(o=o<<r|i,u+=r;0<u;e[l+f]=255&o,f+=h,o/=256,u-=8);e[l+f-h]|=128*c}}.call(this,e(\"lYpoI2\"),\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{},e(\"buffer\").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],\"/node_modules/gulp-browserify/node_modules/ieee754/index.js\",\"/node_modules/gulp-browserify/node_modules/ieee754\")},{buffer:3,lYpoI2:11}],11:[function(e,h,t){!function(e,t,n,r,o,f,l,c,d){var i,u,s;function a(){}(e=h.exports={}).nextTick=(u=\"undefined\"!=typeof window&&window.setImmediate,s=\"undefined\"!=typeof window&&window.postMessage&&window.addEventListener,u?function(e){return window.setImmediate(e)}:s?(i=[],window.addEventListener(\"message\",function(e){var t=e.source;t!==window&&null!==t||\"process-tick\"!==e.data||(e.stopPropagation(),0<i.length&&i.shift()())},!0),function(e){i.push(e),window.postMessage(\"process-tick\",\"*\")}):function(e){setTimeout(e,0)}),e.title=\"browser\",e.browser=!0,e.env={},e.argv=[],e.on=a,e.addListener=a,e.once=a,e.off=a,e.removeListener=a,e.removeAllListeners=a,e.emit=a,e.binding=function(e){throw new Error(\"process.binding is not supported\")},e.cwd=function(){return\"/\"},e.chdir=function(e){throw new Error(\"process.chdir is not supported\")}}.call(this,e(\"lYpoI2\"),\"undefined\"!=typeof self?self:\"undefined\"!=typeof window?window:{},e(\"buffer\").Buffer,arguments[3],arguments[4],arguments[5],arguments[6],\"/node_modules/gulp-browserify/node_modules/process/browser.js\",\"/node_modules/gulp-browserify/node_modules/process\")},{buffer:3,lYpoI2:11}]},{},[1])(1)});"],"sourceRoot":""}